게시글ID,제목,내용,댓글,URL
7329,[TIP] pnp_oms_dms 의 UDP PORT 가 BPFDoor 취약점 점검 스크립트에 검출되는 현상,"관련 카페 게시글 : pnp_oms_dms 내 UDP LISTEN 중인 포트 정보 확인 요청 [바로가기]
pnp_oms_dms 의 UDP 랜덤포트가 수신 대기 중으로 보이며, 일부 포트가 BPFDoor 취약점 점검 스크립트에 검출되는 현상이 발생할 수 있습니다.
참고 이미지
결론: 실제 수신 대기 포트는 고정되어 있습니다.
pnp_oms_dms 에서 UDP 에 대해 실제로 수신대기하고 있는 포트는 50011 과 3150 입니다.
위 이미지와 같이 랜덤포트가 UDP 수신대기하는 것과 같이 보이는 현상은 수신대기 중인 것이 아닌, UDP 메시지를 전송하기 위해 생성된 소켓이 유지될 때 발생합니다.
(UDP 메시지가 자주 전송될 가능성이 있는 부분 대상으로, 리소스의 재사용을 통해 처리 속도를 올리기 위한 작업)
따라서 pnp_oms_dms 에서 점유중인 UDP 포트와 관련하여 문의사항 발생 시, 위 내용으로 고객사 가이드가 필요합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/7329
7325,[SKMNS]OS업그레이드 이후 구동 서비스 필터링 오류,"DBSAFER 서버 OS 업그레이드 (CentOS7 -> Rocky8) 이후 서비스 리스트 조회시 기존 서비스와 수량차이가 발생
[요약]
- Rocky8 + latin1 PKG의 경우 grep을 통한 필터링 사용시 한글이 포함된 서비스명이 제외됨
- awk '/XXX/' 를 통해 조회 조회 가능
[현상 확인]
1. 전체 서비스 목록을 조회 하면 정상적으로 모든 서비스 출력
2. ""grep"" 을 이용하여 조회조건을 줄 경우 일부 서비스가 누락되어 조회됨
전체 서비스 리스트 - 15개
grep 문 필터링
""grep"" 을 통해 서비스를 필터링 할 경우 Oracle에서 1개, Telnet에서 1개의 서비스가 누락되어 확인 됨
매니저 서비스 목록
전체 서비스 목록 확인
- 서비스 명에 한글이 포함될 경우 grep 조건에 부합 여부와 상관없이 결과에서 제외 됨
[서비스 조회]
- 정확한 조회를 위해서 ""awk"" 를 통한 필터링 시도
예시) 구동중인 Oracle 서비스를 조회할 경우
#./pnp_agent service-list | awk '/Runn/' | awk '/Oracle/'
awk 필터링
"" awk '/XXX/' ""를 이용하여 서비스리스트를 필터링 할 경우, 정상적으로 한글이 포함된 서비스도 확인
not 조건 삽입
"" awk '!/XXX/' ""를 이용하여 예외 조건 설정가능
[발생 조건]
- Rocky8 OS에 Latin1 PKG를 사용할 경우 해당 현상이 발생합니다.
- UTF-8 PKG를 설치한 경우 grep 을 통해 정상적으로 조회가 됩니다.
UTF-8 PKG 설치 시
[GREP 및 AWK 비교](feat.GPT)",댓글 없음,https://cafe.naver.com/pnpsecure2/7325
7323,[OK금융그룹]SSH 옵션을 통한 IP 접근 제어,"[고객사 환경]
1. 기존 서버들에 SSH 접속에 대한 설정이 존재함
> /etc/hosts.allow, /etc/hosts.deny 파일을 통해 제어하고 있음
2. 다만 Rocky OS 에서는 더이상 해당 기능을 지원하지 않음
> hosts.allow, hosts.deny 파일을 생성해도 기능이 동작하지 않습니다.
[요청 사항]
SSH 옵션을 통해 제어할 수 있는 방법이 있으니 해당 방법으로 ACL 적용을 요청
[테스트 및 설정]
1. Match 옵션을 통한 OS 계정별 접속가능 IP주소 설정
2. pnpsecure 계정, root 계정의 허용 IP를 다르게 지정하여 접속 테스트
AI 활용
옵션 설정 화면
설정 상세
- 정책 1
pnpsecure 유저에 대해 134, 122 IP를 제외하고 아래 옵션을 적용
옵션 내용 : 패스워드를 통한 접근차단, TTY 접근 차단
- 정책 2
root 유저에 대해 134, 123 IP를 제외하고 정책 1과 동일 옵션을 적용
* address 전체(*)에 대해 적용하며, ""!""를 통해 not 조건 부여(예외처리)
[사내 테스트]
122 -> 121 접속 시도
- 122번 IP에서 접속 결과 root 계정은 접속 차단, pnpsecure 계정은 접근 허용 확인
123 -> 121 접속 시도
- 123 IP에서 접속 결과 pnpsecure 계정은 접속차단, root 계정은 접속허용 확인
옵션 적용 후에는 ssh 서비스를 재시작 해야 합니다!!!",댓글 없음,https://cafe.naver.com/pnpsecure2/7323
7319,[공유] DBSAFER 7.0 HTTP / HTTPS 웹 접근 제어 기능 공유,"안녕하세요
클라우드기술팀 손혁진입니다.
DBSAFER 7.0에서 HTTP / HTTPS 웹 접근 제어 기능 사용 방법 공유 드리겠습니다.
테스트 환경
- OS : Rocky8
- DBSAFER : V7.0
- Enterprise Manager : 7.0.0.2A (Build-3556)
- pnp_basic
BASIC SERVICE RELEASE VERSION 3.0.4 for RelV7-TBIN-RockyLinux
MAIN VERSION 3.7 (120200101)(Rev: v2697)
COMMON LIBRARY VERSION: 4040
COMMON POLICY MODULE VERSION: 1.2.19
COMMON AUDIT LOG MODULE VERSION: 1.1.02
COMMON FORMAL_QUERY MODULE VERSION: 1.1.0.1
SHARED INTERFACE VERSION: 656
Pol/Log Build: POLICY-(105) LOG-(107)
The latest update of the binary: Sep 20 2024
[요약]
- DBSAFER 7.0에서는 pnp_basic으로 HTTP / HTTPS 웹 접근 제어 기능 사용 가능
. 기존 DBSAFER 5.0에서는 pnp_extransparents 모듈 사용 (pnp_extransparents는 DBSAFER 5.0에서만 사용되는모듈)
- DBSAFER 7.0에서 삼만 모듈 사용하지 고객사는 HTTP / HTTPS 웹 접근 제어 기능 사용 불가
. 삼만 모듈 사용 시에만 pnp_basic 사용 가능하며 DBSAFER 7.0에서는 pnp_basic으로 웹 접근 제어 기능 수행
[설정 방법]
- 아래 pnp_basic.conf에서 접근 권한 확인 할 수 있도록 설정
- 웹 제어 서비스 생성 시 PASS 설정 및 구동
[결과]
- 웹 제어를 위한 서비스 정상 생성 완료
- 웹 제어 정상 동작 확인
[제약사항]
- 접속 제어만 사용이 가능하며, 권한 제어 불가
- 웹 접속 시, 다수의 로그가 로깅
. 사유 : SYN 패킷 기준으로 로깅을 하기 때문에 웹 접속 시 다수의 로그가 로깅
- 접속 계정은 IP로 로깅
. 접속계정 정책 검사 불가
PS.
- Enterprise Manager 7.0 > 시스템 설정 > 객체 설정 > 서비스 설정 > TERMINAL - HTTPS, TTP 설정은 위 기능과 무관
- 기존 DBSAFER 5.0에서는 TERMINAL 서비스에서 ALIAS 설정통해 HTTP/HTTPS 서비스 종류를 만들 수 있었으나 DBSAER 7.0에서는 불가
. HTTP / HTTPS 서비스 생성이 필수적으로 필요한 한 경우 DBMS(추가 DBMS Alias 설정) 으로 생성 필요
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/7319
7309,[TIP] 관리자 패스워드 암호화 강화 설정 후 Manager 접속 불가 시 체크사항,"1. 현상
- ./pnp setup의 'use enhanced encrypt' > 'use manager authentication with enhanced password' 설정 Enable 후 Manager 로그인 불가
2. 체크 필요사항
- desc dbsafer3.auth_users; 결과값에서 passwd 필드의 타입이 varchar(41)인지 확인
- 'use manager authentication with enhanced password' 설정의 경우 passwd 필드가 varchar(64)인 경우에 정상 동작함
- dbsafer 정책 DB를 이관하여 구축하였거나 구축한 지 오래된 DBSAFER일 경우 passwd 필드가 varchar(41)일 수 있음
3. 조치 방법
- passwd 필드의 타입을 varchar(64)로 변경 후
'use manager authentication with enhanced password' 설정 Enable 및 관리자 계정 PW 변경 진행
* 참고 사항
pnp_agent r1345 이상부터는 pnp_agent 모듈 가동 시 passwd 필드가 varchar(41)일 경우 varchar(64)로 자동 alter 처리합니다.(2025/04/18 모듈 수정됨)",댓글 없음,https://cafe.naver.com/pnpsecure2/7309
7301,[TIP] [WEB DMS] 데이터베이스 버전 추가 방법,"[개요]
WEB DMS 에서 대상 데이터베이스 등록시에 버전 및 드라이버가 일치하지 않는 경우에 사용 가능.
현재 WEB DMS 안에 내장되어있는 드라이버 및 버전은 한정적이므로 엔지니어가 상황에 따라 유연하게 추가 및 삭제 진행 필요.
[방법]
1. DBMS 드라이버 파일 다운로드.
> 추가하고 싶은 DBMS의 버전별 드라이버를 인터넷 및 각 경로에서 다운로드 하여 로컬 PC에 저장 필요.
(ex. ojdbc14.jar , mysql-connector-j-8.0.32.jar )
2. WEB DMS 지원 데이터베이스 관리 설정
> 2.1 엔지니어 계정 로그인 -> 원장 관리 -> 지원 데이터베이스 관리 -> 버전별 드라이버 목록 ( 등록 )
3. 임시 드라이버 등록
> WEB DMS에서 드라이버와 버전은, DMS 데이터베이스의 dbms_type_version_file 테이블과 dbms_type_version 테이블을 참조.
dbms_type_version_file (드라이버) 테이블은 dbms_type_vesion (버전) 테이블의 부모 테이블 이므로 FOREIGN KEY인 dbms_type_version_file_idx 를 먼저 생성시켜주기 위해,
드라이버 파일을 먼저 등록 하여 dbms_type_version_file 테이블에 데이터를 넣어준 후 버전 등록 필요.
(dbms_type_version_file_idx 컬럼이 dbms_type_version 테이블의 FOREIGN KEY)
3.1 종류, 버전, 클래스명 임시로 입력후 원하는 드라이버 파일 첨부하여 등록 진행.
3.2 등록
등록 완료.
3.3 DB값 확인
dbms_type_version_file select 시 추가된것 확인.
> dbms_type_version_file 테이블 조회 후 dbms_type_version_file_idx 값 확인 필요.
(추후에 dbms_type_version 테이블에 매핑하여 insert 하기 위함)
4. 버전 추가
dbms_type_version 테이블의 컬럼 값들에 맞추어 insert 쿼리 실행.
ex) insert into dbms_type_version values ('141', '0' , '1.2.3.4.5' , '68', '2025-06-10 00:00:00' , '2025-06-10 00:00:00') ;
==>1.2.3.4.5 라는 버전을 추가하는 쿼리
4.1 dbms_type_version_idx 값은 auto_increment 값이라 1씩 오르는게 정상이지만, 7.0 갈레라 구성에서는 마지막 idx 값에서 부터 2씩 오르는 특성이 있으므로 주의 요망.
(현재 마지막 데이터의 idx 값이139 => 입력할 데이터의 idx 값 = 141)
4.2 dbms_type 은 각 DB 별 type 값이 정해져있음. (dms.dbms 테이블과 dms.dbms_type 에 매핑되어 값 존재.)
> 현재 서버에 등록된 데이터베이스 기준으로 0 = oracle, 1 = mysql
4.3 version 은 실제로 추가하고 싶은 데이터베이스의 버전값 입력.
4.4 date 값은 현재로 입력
5. DB 및 WEB 확인
> select * from dbms_type_version \G ;
생성 완료
> DB에 생성된 값으로 web에서 버전이 매핑되어 변경된 것 확인.
변경 확인
6. 삭제 및 재등록
기존에 임시로 등록했던 드라이버 삭제
6.1 재등록
추가한 버전은 드롭박스에 추가되어있음.
> 추가한 버전 선택, 실제 사용할 클래스명 입력, 드라이버 파일 재첨부하여 등록 진행.
등록 완료.
7. 데이터베이스 등록 진행
> 실제 대상 데이터베이스 등록시에 버전 확인. (초록색 불)
=====================================================
*참고*
해당 방법은 oracle DB와 Mysql DB만 테스트하여 적용 진행한 방법입니다.
DB작업을 통해 임의로 추가하는건 기능 상 문제가 없으면 사용 가능하며,
QA 검증이 불가한 방식인 점 참고드리면 감사드리겠습니다.
버전 및 드라이버를 정식으로 추가하려면, bugs 에 기능 수정요청이 필요합니다.
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/7301
7299,[TIP] Manager 7.0 보안계정 그룹명 변경 후 반영 기능 개선 조치,"[현상]
1. 보안계정 그룹 생성 (생성된 그룹탭 열림)
2. 보안계정 그룹명 변경
3. (1.에서 열린 탭을 새로고침하지 않고)객체 등록 시 변경 전 그룹명으로 등록됨
1. 보안계정 그룹 생성 (before)
2. 생성 시 보안계정 그룹탭 열림
3. 보안계정 그룹명 변경 (before -> after)
4. 보안계정 그룹탭에서 보안계정 aaa를 그룹에 등록
5. 적용
6. 그룹명 변경 전인 before에 등록됨
[원인]
- 그룹명 변경 후 열려있던 탭에 변경된 그룹명이 업데이트되지 않아 발생
(그룹명 변경 후에는 탭을 다시 열거나 수동으로 새로고침해야 하는 것이 로직에 틀리진 않으나, 담당자 입장에서는 번거로울 수 있고, 간과할 경우 정책이 의도한 대로 적용되지 않을 수 있음)
[조치]
- Enteprise Manager 7.0.0.2 ALPHA (Build - 3525) 이상 버전으로 업데이트 적용",댓글 없음,https://cafe.naver.com/pnpsecure2/7299
7295,[TIP] pnp_log_sender 대상 서버 TCP 로그 전달 내부 테스트 방법 공유,"[요약]
- pnp_log_sender 내부 테스트 시 대상서버에 전달되는 내용을 직접 확인할 수 있는 방법 공유 드립니다.
> 대상서버에 TCP로 pnp_log_sender 로그 전달 설정
> 대상서버에서 nc 명령어로 들어오는 데이터에 대해서 특정 경로에 기록하게 설정
> 기록된 데이터파일 확인
- 사내테스트 진행 내역
[DBSAFER 서버 설정 내역]
- DBSAFER 서버 에서 pnp_log_sender.conf 설정 및 pnp_log_sender start
# vi /dbsafer/.conf/pnp_log_sender.conf
# server_ip = [대상서버 ip]
# server_port = [대상서버 데이터 받을 port]
# server_type = 2 (TCP 데이터 전송)
- 정상 connect 시 아래 사진과 같이 pnp_log_sender 모듈 로그에 Target server connect success. 로그 확인 가능
[대상 서버 설정 내역]
- 대상서버 (192.168.102.239)에 nc 명령어를 통해 /root/test/log_sender_output_test.txt 으로 전달받는 데이터 기록하게 설정
# nc -l -p 1468 > /root/test/log_sender_output_test.txt
(** -l 옵션 : 리슨(listen) 모드 : 서버처럼 동작하며 포트 OPEN 및 클라이언트 접속 대기
-p 옵션 : 포트(port) 지정 : 리슨할 포트 번호를 명시함)
# netstat -anp | grep 1468 명령어 수행 시 listen 상태 확인
- 사용자 쿼리 수행
- 대상서버에서 전달받은 txt 파일 읽기
이상입니다.
감사합니다.
* 수정이 필요한 부분이나 개선사항이 있다면 댓글로 남겨주시면 감사하겠습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/7295
7289,[TIP] PC Assist 사용자 식별 정보 어플리케이션명,"pnp_oms_dms.conf 설정에 ""NAT_IDENTITY_EXTEND_TYPE = 1""로 설정하게 될 경우
사용자 식별 정보에 DBMS프로그램명이 포함되게 됩니다.
이때 사용자 식별 정보에 전달되는 어플리케이션명은 작업 관리자에서 확인되는 경로내 파일명이라고 합니다.
[추가 팁]
쿼리박스로 한글명 어플리케이션명 테스트 하는 방법
1. 쿼리박스 설치 경로로 이동
2. Querybox.exe, Querybox.ini 파일명을 똑같이 원하는 명칭으로 변경",댓글 없음,https://cafe.naver.com/pnpsecure2/7289
7247,"[TIP] MAC Agent 설치 과정에서 ""PCAssistTransProxyNE을(를) 활성화 하는데 실패함"" 에러 문구 출력되는 현상","[FAQ분류] (에러로그문의 / 기능로직문의 / 기타문의)
에러로그문의
[고객사/채널사]
카카오뱅크
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크)
- MAC Agent 설치 과정에서 ""PCAssistTransProxyNE을(를) 활성화 하는데 실패함"" 에러 문구 출력되는 현상
> ""로그인 항목 및 확장""에서 PCAssistService를 활성화 하려했으나, 아래 같은 에러가 발생
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 카카오뱅크 고객사 커스텀 Library 설정 들어가 있음
- MAC 자체 PC assist 모듈 로그는 남고있지 않음
4. 사내 재현 정보
5. 요청사항
- 해당 현상 발생 원인 및 해결방법 확인 요청 드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[콘솔 로그]
오류 14:52:31.942750+0900 PCAssist WARNING: Secure coding is automatically enabled for restorable state! However, not on all supported macOS versions of this application. Opt-in to secure coding explicitly by implementing NSApplicationDelegate.applicationSupportsSecureRestorableState:.
오류 14:52:31.969523+0900 tccd Prompting policy for hardened runtime; service: kTCCServiceAppleEvents requires entitlement com.apple.security.automation.apple-events but it is missing for responsible={TCCDProcess: identifier=com.pnpsecure.pcassist.PCAssist, pid=41015, auid=52880260, euid=52880260, responsible_path=/Applications/PCAssist/PCAssist.app/Contents/MacOS/PCAssist, binary_path=/Applications/PCAssist/PCAssist.app/Contents/MacOS/PCAssist}, accessing={TCCDProcess: identifier=com.pnpsecure.pcassist.PCAssist, pid=41018, auid=52880260, euid=52880260, binary_path=/Applications/PCAssist/PCAssist.app/Contents/MacOS/PCAssist}, requesting={TCCDProcess: identifier=com.apple.appleeventsd, pid=274, auid=55, euid=55, binary_path=/System/Library/CoreServices/appleeventsd},
오류 14:52:32.074290+0900 PCAssist ViewBridge to RemoteViewService Terminated: Error Domain=com.apple.ViewBridge Code=18 UserInfo={com.apple.ViewBridge.error.hint=this process disconnected remote view controller -- benign unless unexpected, com.apple.ViewBridge.error.description=NSViewBridgeErrorCanceled}
오류 14:52:44.747879+0900 PCAssistService Failed to get or decode unavailable reasons
오류 14:53:46.507719+0900 runningboardd RBSStateCapture remove item called for untracked item 169-162-8075 (target:[anon<PCAssistService>(52880260):41297])
오류 14:53:46.507740+0900 runningboardd RBSStateCapture remove item called for untracked item 169-134-8074 (target:[anon<PCAssistService>(52880260):41297])
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
version : PCAssist_3.3.4.38
[추가 정보]
Macbook Pro 16(2023)
Mac OS : Seqipoa 15.4
칩 : Apple M2 Pro
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
첨부파일
[카카오뱅크] MAC Assist_log
.txt
null
파일 다운로드","박수아: 증상이 발생한 macOS 버전과 가능하시다면 설치 패키지 전달 요청 드립니다. | 김연수: 본문에도 해당 내용 수정해두었습니다.
설치 패키지는 용량 문제로 따로 전달 드리겠습니다.

[추가 정보]
Macbook Pro 16(2023)
Mac OS : Seqipoa 15.4
칩 : Apple M2 Pro

감사합니다. | 박수아: 고객사 환경에 설치된 MDM 솔루션에 의해 차단된 현상으로 MDM 솔루션에 아래의 정책을 추가하여 정상 동작 확인하였습니다. MDM 정책 참고 부탁드립니다.

. Team ID: 6Z7ZT57XZ4
. Bundle ID: com.pnpsecure.pcassist.PCAssistTransProxyNE
. Types: com.apple.system_extension.network_extension",https://cafe.naver.com/pnpsecure2/7247
7233,[기술본부 공유] SKT 해킹 BPFDoor 악성코드 점검 보안 위협 점검 및 대응 내역,"※ 본 내용은 DBSAFER를 포함한 회사 제품군(INFOSAFER, DATACRYPTO, FACELOCKER) 어플라이언스 장비 전체에 해당됩니다.
0. 환경
- 사이트명 : 포스코이앤씨
- 버전 : INFOSAFER V1- Build 662
- OS : CentOS Linux release 7.8.2003
- 서버 : DELL R740
1. 요청 사항
- 최근 SKT 해킹 사례 관련 INFOSAFER 어플라이언스 장비 내 BPFDoor 악성코드 감염 여부 점검
2. 포스코이앤씨 기준 대응 및 예방 조치 항목
- 항목
1) BPFDoor 탐지 : 패킷 수신 대기 함수(packet_recvmsg, wait_for_more_packets) 사용 여부 확인
2) 비정상 포트 확인 : ss -lp 명령어로 42391~43391 포트 모니터링
3) 악성 파일 존재 여부 : /dev/shm/kdmtmpflush 경로 확인
4) iptables 조작 여부 : 비정상 리디렉션 규칙 존재 여부 확인
5) 위장 프로세스 존재 여부 : kdmtmpflush 등 위장된 백도어 프로세스 탐지
3. 상세 점검 및 대응 가이드
1) BPFDoor 탐지 (패킷 스니핑 프로세스 확인)
# grep packet_recvmsg /proc/*/stack
# grep wait_for_more_packets /proc/*/stack
1-1) 탐지시 대응 절차
- PID 추출 예시 (PID=2050)
# ps -fp 2050
# ls -l /proc/2050/exe
# strings /proc/2050/exe | less
- 악성 의심 시 종료 및 삭제
# kill -9 2050
# rm -f /실제 실행 경로 (ls -l로 확인한 실제 파일 삭제)
2) 비정상 포트(42391~43391) 탐지
# ss -lp | grep -E ':[4][2-3][0-9]{3}|:43000|:43100|:43200|:43300'
2-1) 탐지시 대응 절차
- 포트 → PID 확인
# netstat -anp | grep 42763
# lsof -i :42763
- 상세 정보 확인
# ps -fp 1598
# ls -l /proc/1598/exe
# strings /proc/1598/exe | less
- 악성 의심 시 종료 및 삭제
# kill -9 1598
# rm -f /실제 실행 경로
3) 악성 파일 존재 여부 확인
# ls -al /dev/shm/kdmtmpflush
※ 존재 시 삭제 필요 + 백업 및 해시 수집 권장
4) iptables 비정상 규칙 확인
# iptables -nL
5) 위장 프로세스 점검 (kdmtmpflush 등)
# ps -ef | grep -i kdmtmpflush
# ps -ef | grep -i kdmtmp
[결론]
포스코이앤씨에 납품된 INFOSAFER V1 어플라이언스 장비에서는 이상 징후 없이 정상으로 확인되었습니다.
추후 회사 제품군 전체에 유사 요청이 들어올 수 있으며, 위 내용을 기준으로 동일하게 대응 가능함을 안내드립니다.
이상입니다.
===================================================================
금융위 사무처장 주관 SKT 해킹 관련 긴급 점검 회의 관련 자료 추가 합니다.(2025.04.30 14:11)
[텍스트 변환]
# sudo ss -0bp
# /usr/sbin/smartd -n -q never (smartadm 샘플의 위장 프로세스명)
# /usr/libexec/hald-addon-volume (hald-addon-volume 샘플의 위장 프로세스명)
# dbus-daemon --system (dbus-srv-bin.txt 샘플의 위장 프로세스명)
# hpasmlited -f /dev/hpilo (hpadmmild 샘플의 위장 프로세스명)
# 0x7255(29269), 0x5293(21139), 0x39393939(960051513) [smartadm 샘플]
# 0x7255(29269), 0x5293(21139) [hpadmmild 샘플]
# sudo ss -0pb | grep -EB1 ""$((0x7255))|$((0x5293))|$((0x39393939))""
[텍스트 변환]
# find {검색 디렉토리 경로} -type f -exec sh -c 'hexdump -ve ""1/1 \""%02x\"""" ""$1"" | grep -q ""c6459049c6459135c645922ac6459341c6459459c6459562"" && echo ""$1""' _ {} \;
[텍스트 변환]
# netstat -lpn | grep -E ':42[3-9][0-9]{2}|43[0-3][0-9]{2}'
참고자료 : (20250430)금융위 사무처장 주관SKT해킹관련 긴급점검회의_회의자료.pdf
첨부파일
(20250430)금융위 사무처장 주관SKT해킹관련 긴급점검회의_회의자료
.pdf
null
파일 다운로드","스텝: 수고 많으셨습니다. 고맙습니다. | 김영회: BPFDoor 악성코드 무료 점검 툴 참고용으로 공유 드립니다.
- https://www.piolink.com/kr/service/Security-Analysis.php?bbsCode=security&vType=view&idx=141 | 이민종: KISA에서 배포한 점검 가이드 문서입니다.
https://www.boho.or.kr/kr/bbs/view.do?bbsId=B0000133&pageIndex=1&nttId=71754&menuNo=205020",https://cafe.naver.com/pnpsecure2/7233
7213,[TIP] 마스킹 객체 공유 - 2,"[요약]
- 고객사에서 마스킹 예제를 요청하여 내부 테스트 확인 한 결과 공유 드립니다.
(**데이터 형식에 따라 제약사항도 있으니 사내에서 충분히 테스트 후 고객사에 전달 하시는 것을 권장 드립니다.)
[상세내역]
- 마스킹 전
- 마스킹 후
> 빨간 네모칸은 데이터 형식상 제약사항
- 테스트 진행한 마스킹 객체
- 첨부파일 상세 내용
첨부파일
DBSAFER 마스킹 객체 공유_250228
.xlsx
null
파일 다운로드
이상입니다.
감사합니다.
* 수정이 필요한 부분이나 개선사항이 있다면 댓글로 남겨주시면 감사하겠습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/7213
7210,[공유] 폐쇄망 환경에서 Rsync 보안 업데이트 방법 (Redhat8),"[개요]
- Rsync에서 발생하는 취약점을 해결한 보안 업데이트가 권고되었습니다.
* Rsync : 원격 및 로컬 파일 동기화 데몬
* 관련 공지글 : https://cafe.naver.com/pnpsecure2/7050
- 폐쇄망 환경에서는 dnf, yum 등의 명령어를 사용할 수 없기 때문에 rpm 및 패키지를 수동으로 설치하여 패치하는 방안 공유드립니다.
[요약]
- 인터넷 통신이 가능한 환경에서 필요 rpm 및 패키지를 다운로드하여 패쇄망에 업로드 후, 수동으로 설치하였습니다.
- 사용된 패키지 및 rpm 파일 첨부파일에 업로드하였습니다.
[설치 과정]
1.필수 패키지 설치 확인
- 필수 설치 필요 패키지 : openssl-devel, zlib-devel, development tools
- 패키지 설치 확인 명령어
# rpm -qa | grep openssl-devel
# rpm -qa | grep zlib-devel
# rpm -qa | grep gcc-c++
** 모듈은 서버에 기본적으로 설치되어 있을 확률이 높습니다. 위 명령어를 사용하여 설치가 되어 있지 않은 경우 아래 명령어를 통하여 필요 rpm을 사전에 준비하여야 합니다.
** 인터넷 접속 가능환경에서 필수 패키지 설치 명령어
# sudo dnf groupinstall ""Development Tools""
# sudo dnf install openssl-devel zlib-devel
2. Rsync 버전 업그레이드 진행
가.Rsync 버전 확인
# rsync --version
나. 파일 압축 해제
# cd /usr/local/src/
# tar -zxvf rsync-3.4.1.tar.gz
# tar -zxvf v0.8.2.tar.gz
# tar -zxvf v1.9.4.tar.gz
# tar -zxvf zstd-1.5.5.tar.gz
다. 컴파일 및 설치
1) epel-release 수동 설치
# mv epel-release-latest-8.noarch.rpm /usr/local/src/rsync-3.4.1
#cd /rsync-3.4.1
#sudo rpm -ivh epel-release-latest-8.noarch.rpm
2) powertools 수동 추가
#vi /etc/yum.repos.d/epel.repo
[epel-modular]
name=Extra Packages for Enterprise Linux Modular 8 - $basearch
metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-modular-8&arch=$basearch
enabled=1
gpgcheck=0
3) 저장소 업데이트
#sudo dnf repolist
4) rpm 사용하여 glibc 강제 설치
#cd /tmp
#sudo rpm -ivh --nodeps --force /tmp/glibc-2.28-251.el8_10.14.x86_64.rpm \
/tmp/glibc-common-2.28-251.el8_10.14.x86_64.rpm \
/tmp/glibc-headers-2.28-251.el8_10.14.x86_64.rpm \
/tmp/glibc-devel-2.28-251.el8_10.14.x86_64.rpm \
/tmp/glibc-langpack-en-2.28-251.el8_10.14.x86_64.rpm \
/tmp/glibc-2.28-251.el8_10.14.i686.rpm \
/tmp/glibc-headers-2.28-251.el8_10.14.i686.rpm \
/tmp/glibc-devel-2.28-251.el8_10.14.i686.rpm \
/tmp/kernel-headers-4.18.0-553.45.1.el8_10.x86_64.rpm
5) 설치 확인
#rpm -qa | grep glibc
6) 시스템 안정화
#sudo ldconfig
7) xxhash 수동빌드
#cd /usr/local/src/xxHash-0.8.2
#make
#sudo make install
8) zstd 수동빌드
#cd /usr/local/src/zstd-1.5.5
#make
#sudo make install
9) lz4 수동빌드
#cd /usr/local/src/lz4-1.9.4
#make
#sudo make install
10) configure 실행 전 라이브러리 경로 설정
#export CFLAGS=""-I/usr/local/include""
#export LDFLAGS=""-L/usr/local/lib""
#export LD_LIBRARY_PATH=""/usr/local/lib:$LD_LIBRARY_PATH""
11) configure
#cd /usr/local/src/rsync-3.4.1
#./configure
#make
#sudo make install
라. 업데이트 후 주요 변경 사항 확인
1) 업데이트 확인
# rsync –version
# man rsync (changelog 확인)
[참고사항]
- 버전이 올라가지 않을 경우 확인 사항
가. 라이브버리 경로 수동 등록
#echo ""/usr/local/lib"" | sudo tee -a /etc/ld.so.conf.d/custom-libs.conf
나. 쉘에서 캐시된 rsync 위치 초기화
#hash -r
다. 환경 변수 재적용
# source ~/.bashrc
라. 라이브러리 경로 반영
# sudo ldconfig
첨부파일
epel-release-latest-8.noarch
.rpm
null
파일 다운로드
첨부파일
rsync-3.4.1.tar
.gz
null
파일 다운로드
첨부파일
v0.8.2.tar
.gz
null
파일 다운로드
첨부파일
v1.9.4.tar
.gz
null
파일 다운로드
첨부파일
zstd-1.5.5.tar
.gz
null
파일 다운로드
첨부파일
rpm.tar
.gz
null
파일 다운로드
첨부파일
whl.tar
.gz
null
파일 다운로드",댓글 없음,https://cafe.naver.com/pnpsecure2/7210
7207,[공유] 폐쇄망 환경에서 Rsync 보안 업데이트 방법 (Cent7),"[개요]

- Rsync에서 발생하는 취약점을 해결한 보안 업데이트가 권고되었습니다.

* Rsync : 원격 및 로컬 파일 동기화 데몬

* 관련 공지글 : https://cafe.naver.com/pnpsecure2/7050

​

- 폐쇄망 환경에서는 dnf, yum 등의 명령어를 사용할 수 없기 때문에 rpm 및 패키지를 수동으로 설치하여 패치하는 방안 공유드립니다.

​

[요약]

- 인터넷 통신이 가능한 환경에서 필요 rpm 및 패키지를 다운로드하여 패쇄망에 업로드 후, 수동으로 설치하였습니다.

- 사용된 패키지 및 rpm 파일 첨부파일에 업로드하였습니다.

​

[설치 과정]

1.필수 패키지 설치 확인

- 필수 설치 필요 패키지 : openssl-devel, zlib-devel, development tools

- 패키지 설치 확인 명령어

# rpm -qa | grep openssl-devel

# rpm -qa | grep zlib-devel

# rpm -qa | grep gcc-c++

​

** 모듈은 서버에 기본적으로 설치되어 있을 확률이 높습니다. 위 명령어를 사용하여 설치가 되어 있지 않은 경우 아래 명령어를 통하여 필요 rpm을 사전에 준비하여야 합니다.

​

** 인터넷 접속 가능환경에서 필수 패키지 설치 명령어

# sudo dnf groupinstall ""Development Tools""

# sudo dnf install openssl-devel zlib-devel

​

2. Rsync 버전 업그레이드 진행

가. Rsync 버전 확인

# rsync --version

​

나. 파일 압축 해제

# cd /usr/local/src/

# tar -zxvf rsync-3.4.1.tar.gz

# tar -zxvf xxhash-offline.tar.gz

# tar -zxvf  zstd-1.5.5.tar.gz

# tar -zxvf lz4-offline.tar.gz

​

다. 컴파일 및 설치

1) 오프라인 설치 

# mkdir /usr/local/lib/pkgconfig

# cd xxhash-offline

# sudo cp include/xxhash.h /usr/local/include/   

# sudo cp lib64/libxxhash.so* /usr/local/lib/  

# sudo cp pkgconfig/libxxhash.pc /usr/local/lib/pkgconfig/        

# cd lz4-offline 

# sudo cp include/lz4*.h /usr/local/include           

# sudo cp lib64/liblz4.so* /usr/local/lib/               

# sudo cp pkgconfig/liblz4.pc /usr/local/lib/pkgconfig/     

# sudo ldconfig      //라이브러리 링크 갱신

​

2) zstd 수동 설치

# cd zstd-1.5.5

# make

# sudo make install

​

3) 라이브러리 링크 설정 및 경로 업데이트

# sudo ln -s /usr/local/lib/libzstd.so /usr/lib/libzstd.so

# sudo ln -s /usr/local/lib/libzstd.a /usr/lib/libzstd.a

# sudo ln -s /usr/local/include/zstd.h /usr/include/zstd.h

# sudo ldconfig

​

4) 컴파일 환경 수동 설정

# cd /usr/local/src/rsync-3.4.1

# export CFLAGS=""-I/usr/include -std=gnu11""

# export LDFLAGS=""-L/usr/lib64""

# export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH

​

5) CONFIGURE

# ./configure

# make

# sudo make install

​

라. 업데이트 후 주요 변경 사항 확인

1) 업데이트 확인

# rsync –version

# man rsync (changelog 확인)

​

[참고사항]

- 버전이 올라가지 않을 경우 확인 사항

가. 버전 및 설치 확인

# which rsync

> /usr/bin/rsync 출력시 구버전 반영중

​

# /usr/local/bin/rsync –version

> 업데이트 버전 출력시 정상 설치 완료

​

나. 우선순위 변경

# export PATH=/usr/local/bin:$PATH

# which rsync

# rsync --version

​

다. 영구 적용

# echo 'export PATH=/usr/local/bin:$PATH' >> ~/.bashrc

# source ~/.bashrc

​",댓글 없음,https://cafe.naver.com/pnpsecure2/7207
7206,[공유] itsm 결재 문서 만료일 PC Assist 쪽지 알림 모듈,"[요약]

현대엔지니어링 고객사에서 itsm 문서 DB view를 제공해줄 테니 PC Assist의 쪽지 기능을 활용하여 주기적으로 만료일을 검사하여 쪽지로 안내하는 기능을 요청하여 해당 기능을 제공하는 모듈 개발

​

[관련벅스링크]

0029897: [현대엔지니어링] ITSM 정책 기간 만료 쪽지 알림 개발 요청 - MantisBT

​

[모듈 bbs링크]

[현대엔지니어링] 연동 프로젝트 산출물

​

[모듈명]

itsm_alert_sender

​

[모듈 동작 시 필요 테이블 정보]

idx int(11) NO PRI auto_increment

itsm_num varchar(50) NO

cert_id varchar(255) NO

expire_date datetime NO

​

반드시 ITSM이 아니라고 하더라도 DB의 만료일만 검사하여 쪽지 알림을 보내주는 기능이기 때문에 여러방면에서 활용이 가능한 모듈일 것 같습니다.

쪽지 내용또한 설정파일에서 수정이 가능합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/7206
7196,[한화비전] SCRAM-SHA256-PLUS 알고리즘을 사용하는 PostgreSQL 접속 툴 예외 처리 적용 방법 공유,"[이슈 상세]

- DBeaver의 백업 기능을 사용할 경우 pg_dump.exe가 내부적으로 실행

- AWS PostgreSQL 15 환경에서 pg_dump.exe를 통한 접속 시도 시 ""SCRAM channel binding check failed"" 오류 발생


DBeaver 오류 로그

​

​

[이슈 원인]

- pg_dump.exe가 SCRAM-SHA256-PLUS 알고리즘을 사용하기 때문에 발생된 것으로 확인

- AWS RDS(PostgreSQL)의 파라미터 그룹 ""rds.force_ssl=1""인 경우, SCRAM-SHA256-PLUS 알고리즘 사용(채널 바인딩(channel binding) 지원)

- DBSAFER를 통해 접속을 하게되면 (사용자 ↔ DBSAFER) 구간과 (DBSAFER ↔ 보안대상 DB) 구간 각각에서 TLS 세션을 맺어지며 각 구간의 TLS 세션 정보가 상이하여 채널 바인딩 사용이 불가(제약사항)

- 영향 받는 툴 예시: pg_dump, psql

​

​

[조치 내용]

- pg_dump.exe를 pnp_ssl_proxy 모듈에서 TCP bypass 설정 할 수 있도록 기능 개발

- 지원 버전: pnp_ssl_proxy (trunk) Rev.248

- 설정 방법(pnp_ssl_proxy.conf)

===================
# BYPASS 동작을 수행할 APPLICATION 지정
# - 사용자식별정보 내에 APPLICATION 명이 포함된 경우 사용 가능
#
# 단일설정 포맷 : ([[SERVER_IP:SERVER_PORT]]) or ([[SERVICE_NO]]) or (*) + [[APPLICATION]](,[[APPLICATION]]..)
# - (*) : 전체 서비스 대상 설정 가능
#
# Example : (10.10.10.10:5432) pg_dump.exe,psql.exe
# Example : (1) pg_dump.exe,dbeaver.exe
# Example : (*) pg_dump.exe
BYPASS_APP = (*) pg_dump.exe
1. [한화비전] - AWS PostgreSQL 15에서 pg_dump.exe를 통한 접속 실패 

2. [공지] AWS PostgreSQL 버전 14에서 접속툴 제약사항 공지

3. [한화비전] AWS PostgreSQL 15에서 pg_dump.exe를 통한 접속 예외 처리 기능 추가 요청

https://bugs.pnpsecure.com/view.php?id=29640",댓글 없음,https://cafe.naver.com/pnpsecure2/7196
7187,[TIP] 포스코 사용자 PC Local WAS에서 대상 DBMS 접속 오류,"개요
- 로컬 WAS 접속 시 DB 연결 문제 및 ResultSet 닫힘 오류 발생. MAFAPPDATA 테이블의 APP 컬럼(BLOB 타입) 조회 시 에러 발생.
환경
- 로컬 WAS : WebLogic
- 대상 DBMS : DB2 11
- DBSAFER : 5.0 R24.05
# 로컬 WAS 에러 발생사항
com.ibm.db2.jcc.am.DisconnectRecoverableException: [jcc][t4][2034][11148][4.29.24] 대화가 릴리스되게 만드는 분산 프로토콜 오류로 인해 실행이 실패했습니다.
DRDA 데이터 스트림 구문 오류를 발견했습니다. 이유: 0x3. ERRORCODE=-4499, SQLSTATE=58009
[2025-04-04 10:38:44] [ERROR] [psdi.mbo.MboSet:3256] - BMXAA6713E - The MBO fetch operation failed in the mboset with the SQL error code -4470. The record could not be retrieved from the database. See the log file for more details about the error.
com.ibm.db2.jcc.am.SqlException: [jcc][t4][10120][10898][4.29.24] 유효하지 않은 조작: result set이(가) 닫혔습니다. ERRORCODE=-4470, SQLSTATE=null
at com.ibm.db2.jcc.am.b7.a(b7.java:794) ~[db2jcc.jar:?]
at com.ibm.db2.jcc.am.b7.a(b7.java:66) ~[db2jcc.jar:?]
at com.ibm.db2.jcc.am.b7.a(b7.java:116) ~[db2jcc.jar:?]
at com.ibm.db2.jcc.am.ResultSet.checkForClosedResultSet(ResultSet.java:4836) ~[db2jcc.jar:?]
at com.ibm.db2.jcc.am.ResultSet.findColumnX(ResultSet.java:2109) ~[db2jcc.jar:?]
at com.ibm.db2.jcc.am.ResultSet.getObject(ResultSet.java:1930) ~[db2jcc.jar:?]
at psdi.mbo.MboSet.getNextRecordData(MboSet.java:3619) ~[MboSet.class:?]
at psdi.mbo.MboSet.fetchMbosActual(MboSet.java:3097) [MboSet.class:?]
at psdi.mbo.MboSet.fetchMbos(MboSet.java:3054) [MboSet.class:?]
at psdi.mbo.MboSet.getMbo(MboSet.java:2132) [MboSet.class:?]
at com.ibm.iot.maximo.GraphiteAppService.getActiveVersionRevision(GraphiteAppService.java:231) [GraphiteAppService.class:?]
...
패킷 수집하여 연구소 분석 진행
- 네트워크 패킷 재전송률이 16% 이상 발생하여 DB 연결 안정성에 문제가 확인되었으며 이는 DB와 통신 중 패킷 손실이 빈번하게 일어나 재전송이 많이 발생했음을 의미
- 특히, 네트워크 지연이 주로 Client - DBSAFER 구간에서 발생하고 있으며, 해당 구간의 패킷 분석 결과 클라이언트(WAS)에서 연결을 종료하는 패킷이 발생. 또한, DBSAFER GW는 커넥션 종료 관련 설정이 없고, 중계 및 전달하는 역할 외에 아무런 행위도 하지 않기 때문에 DBSAFER GW는 정상적으로 작동
- 이러한 네트워크 문제로 인해 다음과 같은 증상이 발생
1) DB커넥션 중간에 ResultSet이 닫히는 오류가 발생하여, 데이터베이스 응답이 실패
2) DB 연결 유지 시간이 길어지면서 타임아웃이 발생하고, 연결이 끊기는 현상이 발생
3) 네트워크 지연으로 인해 JDBC 드라이버가 커넥션을 강제 종료
4) 비정상적으로 종료된 커넥션이 Connection Pool 설정에 따라 재사용되면서 ResultSet이 닫힌 상태로 재호출
* Client - DBSAFER 구간 패킷 중 클라이언트 쪽에서 연결을 종료하는 패킷이 발생하는 화면
.Source: WAS
.Destination: DBSAFER GW
.RST(reset): TCP 연결 종료 시 사용되는 플래그
.ACK: TCP 통신 중 정상적으로 패킷 수신 시 사용되는 플래그
주요 분석 및 조치 내역
1. 네트워크 패킷 재전송률 분석
패킷 재전송률: 16.4% (65160/10703)
네트워크 전송 과정에서 높은 재전송률로 인해 데이터 전송 지연 및 연결 손실 발생.
네트워크 연결 불안정으로 인해 DB 연결 요청 실패 및 응답 지연 확인.
2. 오류 로그 및 JDBC 타임아웃 분석
JDBC 드라이버가 네트워크 재전송 및 응답 지연으로 인해 커넥션을 강제 종료한 것으로 추정.
Connection Pool 설정에 따라 비정상 종료된 커넥션이 재사용되어 ResultSet이 닫힌 상태로 호출됨.
3. 로그 주요 흐름 분석
해당 메서드 호출 스택에서 오류 발생 위치:
MboSet.fetchMbosActual(): 데이터를 가져오려고 할 때 오류 발생.
GraphiteAppService.getActiveVersionRevision(): MBO 관련 데이터를 가져오기 위해 쿼리를 실행할 때 발생.
이 로그는 Maximo Framework에서 MBO(Meta Business Object)를 가져올 때 SQL 쿼리 실행 중 오류가 발생.
특히, OSLC Provider Servlet을 통해 HTTP 요청 시 DB2 쿼리 실행 도중 ResultSet 닫힘 문제가 발생한 것으로 추정.
4. 원인요약
네트워크 재전송률 16%로 인한 응답 지연 및 연결 실패
JDBC Connection Pool의 설정 문제로 인한 재사용 커넥션의 비정상 종료
5. 대응방안 및 조치
JDBC 및 Connection Pool 설정 최적화
connection Pool 설정 변경
ex)
initialSize=10 (초기 연결 수)
maxActive=100 (최대 연결 수)
maxWait=30000ms (커넥션 대기 시간)
JDBC 타임아웃 설정
-Dweblogic.jdbc.loginTimeout=60
-Dweblogic.jdbc.queryTimeout=120
위 대응 방안으로 1차 조치 요청 하였지만 동일 현상 발생
6. 후속 조치
고객사 담당자, DBA, IBM 엔지니어, 피앤피시큐어 엔지니어가 개발 환경에서 문제 사항 확이 중 사용자 JDBC에 아래의 옵션을 변경
jdbc:db2://localhost:50000/SAMPLE:progressiveStreaming=2;
*설명
-progressiveStreaming 은 JDBC 드라이버가 LOB 또는 XML 컬럼의 데이터 검색에 점진적 스트리밍을 사용하는지 여부를 지정합니다.
-드라이버가 대형 객체(LOB)를 처리하는 방식을 변경하는 DB2 JDBC 드라이버의 특수 매개변수
-progressiveStreaming 에 대한 JDBC 드라이버 특성 설정
2 (DB2BaseDataSource.NO)
1 (DB2BaseDataSource.YES)
해당 옵션 변경 후 패킷 재전송률 16.4% -> 2%대로 대폭 감소. 정상 동작 확인.
7. JDBC ""progressiveStreaming"" 옵션의 DBSAFER 영향도에 연구소 분석 결과
1) 패킷 분할에 따른 처리 부하 증가
- JDBC progressiveStreaming 옵션이 활성화 되면서 DB2 JDBC 드라이버는 BLOB 데이터를 작은 크기의 패킷으로 나누어 순차적으로 전송합니다.
DBSAFER는 DB2와 client 간 모든 패킷을 개별적으루 수신하고 분석하고, 필요에 따라 재조립하는 과정을 거칩니다.
이 과정에서 progressiveStreaming 옵션이 활성화 되면서 작은 크기의 패킷으로 인해 처리 부하가 증가하고,
네트워크 지연 및 패킷 손실 가능성이 높아져 재손송률 상승의 원인이 된것으로 확인됩니다.
2) 예상치 못한 지연
- DBSAFER에서 데이터 스트림 내의 특정 패턴을 분석하거나 구자거인 작업을 수행하려고 시도할 경우,
progressiveStreaming 옵션이 활성화된 경우 점진적으로 들어오는 작은 크기의 패킷 처리가 병목현상을 유발할 가능성도 있습니다.
3) DB2(DRDA) 프로토콜 처리의 복잡성
- DB2는 DRDA 프로토콜을 사용하며, progressiveStreaming 옵션을 사용할 경우 프로토콜의 특정 매커니즘을 활용합니다.
DBSAFER 가 DRDA 스트리밍 관련된 세부적인 동작 방식이나 특수한 환경에서의 호환성까지 고려하지 못했을 경우,
예상치 못한 데이터 형식이나 순서 처리 과정에서 프로토콜 구문 오류가 발생할 수 있습니다.
특히 BLOB 데이터 스트리밍 방식은 이러한 잠재적인 호환성 문제가 있을 수 있습니다.
결론적으로, DBSAFE가 progressiveStreaming 방식으로 전송되는 BLOB 데이터를 처리하는 과정에서 발생하는 패킷 분할로 인한 부하증가,
예상치 못한 처리 지연, 그리고 DRDA 프로토콜 처리의 복잡성 등이 복합적으로 작용하여 높은 재전송률과 데이터 전송 오류를 유발한 것으로 판단됩니다.
따라서, progressiveStreaming 설정은 2로 변경하면서 데이터를 한번에 전송하는 방식으로 전환함으로써 이러한 문제들이 해결된것으로 확인됩니다.
문제 해결에 도움을 주신 연구소 이지은 책임연구원께 감사 드립니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/7187
7158,[공유] S3 기준 Athena 접속 및 권한 통제,"안녕하세요. 클라우드기술팀 이상민입니다.
코리안리재보험 고객사에서 S3 명칭을 기준으로 접속/권한 제어 정책 적용한 사례를 공유하여 드립니다.
[배경]
1. 고객사 DB Tool
- 코리안리 Athena 사용자는 DBeaver만 사용함
2. Athena 서비스 특징
- 글로벌 서비스 -> 리전 별 독립적인 서비스 운영 -> 리전 별 단일 주소 사용
- Athena는 S3의 데이터를 SQL로 조회하는 서비스
- Athena는 사용자(IAM)의 권한에 따라 접근 가능한 데이터가 달라짐
3. DBeaver > Athena 연결 시
- ID에는 IAM의 AccessKey를, PW에는 IAM의 SecretKey를 입력
- S3 경로 입력(쿼리 결과가 저장되는 버킷)
. 기본은 데이터와 쿼리 결과를 같은 버킷에 저장됨
. 데이터와 쿼리 결과의 다른 버킷에 저장하기도 함(권장)
. DBeaver에 입력하는 S3 경로는 쿼리 결과가 저장되는 버킷에 해당
[문제]
1. 코리안리는 S3버킷을 운영과 개발로 구분하고 있음
2. DBSAFER에는 Athena 단일 서비스가 등록됨
3. 누가 운영데이터에 접근했는지? 누가 개발데이터에 접근했는지? 구분할 방법이 없음
- 서비스: Athena 단일
- 보안계정: 업무그룹 구분
- 접속계정
. IAM을 RDBMS의 접속계정과 같이 생성하고 등록할 것을 요청했으나
. IAM 지속관리에서부터 이어지는 DBSAFER 객체 및 정책 관리업무 증가를 이유로 거부함
[해결]
1. S3 정보를 기준으로 접속 및 권한제어 정책을 수립하고 통제 및 로깅 수행
- ""S3 Name.DB Name""을 인스턴스 객체로 생성하고 정책 조건에 사용할 수 있도록 개선
(https://bugs.pnpsecure.com/view.php?id=29256)
- 범용 NoSQL(pnp_nosql) Athena DB의 경우 DBMS 접속/권한 정책에서 인스턴스 설정이 가능하도록 수정
(https://bugs.pnpsecure.com/view.php?id=29460)
- 범용 NoSQL(pnp_nosql) 설정 사용 시 서비스 번호 별로 지정하는 기능 추가
(https://bugs.pnpsecure.com/view.php?id=29489)
※ ""범용 NoSQL 설정 사용 시 서비스 번호 별로 지정하는 기능"" 부연 설명
1) Athena의 경우 Athena 443, Athena 444, Glue 443 총 3개의 서비스를 등록함
- 3개의 서비스는 /dbsafer/.conf/nosql/nosql_type_1.json 을 참조함
2) S3 정보는 Athena 443 서비스에서만 파싱 가능함
- DBeaver에서 Athena 연결 후 명령 수행 시 Athena 443으로 전달되는 패킷에서 S3 정보 확인 가능
- 접속 직후 아무런 명령을 수행하지 않으면 S3 정보 획득 안 됨
3) 따라서 3개의 서비스가 아래와 같이 json 파일을 구분하여 참조하도록 수정
- Athena 443 : nosql_type_athena_s3_skip.json 참조
- Athena 444, Glue 443 : nosql_type_athena.json 참조
구분
설명
nosql_type_athena.json
기본 Athena 설정으로 접속계정만 확인되면 로그인 처리
nosql_type_athena_s3.json
s3가 확인될 때까지 로그인처리하지 않음
nosql_type_athena_s3_skip.json
s3가 없어도 접속계정만 확인되면 로그인 처리, 추후 s3가 확인되면 재로그인 처리
[결과]",댓글 없음,https://cafe.naver.com/pnpsecure2/7158
7146,[TIP] (KB국민은행) WORKS 사용자별 담당 결재자 지정 기능,"[개요]
KB국민은행에서 인사연동시 인사정보 파일에서 부서정보와 팀정보를 모두 가져오지만,
1. 부서정보는 있지만 팀장 정보가 없는 경우 (부서장만 존재)
2. 부서정보는 있지만 팀 정보가 없는 경우 (부서장만 존재)
3. 부서정보와 팀정보 모두 있는 경우 (부서장, 팀장 존재)
3. 외주직원
등등의 여러 이유로 인해 WORKS 내에서 ""팀장 결재"" 라는 기준이 모호해, 글로벌 옵션으로 결재정보를 기입해주기 위해 개발요청한 기능.
[버전정보]
WORKS_V7.0.2.45-KB 이상 버전
[상세 내역]
해당 설정은 모두 ""KB국민은행"" 사이트에 실제로 적용된 내용이며, 기능 필요시 개발자에게 문의하시어 필요한 버전에 병합하여 사용하시면 될 것 같습니다.
현재 KB국민은행의 인사연동은, 윤진하 부장님께서 metasync 를 통해 인사테이블에서 인사 정보를 가져온후
accountsync_imup 과 accoutsync 를 통해 DBSAFER로 인사정보를 넣어주는 형식으로 적용되어 있습니다.
( ※ ㄱ. 하기 사진 참고)
ㄱ. KB국민은행 인사연동
========================================================================
KB국민은행 인사 연동은 윤진하 부장님께서 자세히 작성해 주셨으니 참고하시면 좋을 거 같습니다!
https://cafe.naver.com/pnpsecure2/6355
cafe.naver.com
cafe.naver.com
==============================================================
1. 인사연동 설정
1.1 metasync를 통해 가져온 인사정보(kb.kb_user) 를 실제로 확인해보면
※ case1
외주직원의 경우 department 부서정보는 정보보호부 이지만,
teamnm : 팀정보 , teammngerempno :팀장 정보 라는 컬럼이 비어있는걸 확인할수 있음. (부서장 미존재)
ㄴ. KB국민은행 인사테이블 조회
※ case2
실제 KB국민은행 접근제어 고도화 담당자분의 인사테이블 정보이며 부서, 팀, 부서장, 팀장 모두 존재하는 것 확인.
(부서장, 팀장 둘다 존재)
ㄷ. KB국민은행 인사테이블 조회 2
개인정보보호를 위해 모자이크 처리하였습니다.
1.2 따라서 이러한 경우를 해결하기위해 accountsync_imup을 통해 글로벌 옵션으로 결재자정보 기입.
ㄹ. pnp_accountsync_imup.properties 의 실제 내용
↓↓↓↓↓↓↓
ㄹ. pnp_accountsync_imup.properties 내 from 절 복사본
1.3 사진 (ㄹ) 의 accountsync_imup 모듈을 돌리게 되면 해당 부서에 맞는 팀장 정보를 결재선에 기입할수 있습니다.
(accountsync_imup 의 from 절은 각 고객사의 환경에 맞게 구성하셔야 합니다.)
ㅁ. imup.pnp_user 안에 user_info3가 부서장으로 지정되어있는 사진
============================================================================
2. WORKS 설정
2.1. imup.pnp_user 안에 user_info3 컬럼 추가.
( ※ user_info3는 imup.pnp_user에 결재자 정보를 넣기위해 추가한 컬럼입니다. ==> 기존에는 user_info1,2밖에없음)
ALTER TABLE imup.pnp_user
ADD user_info3 TEXT NULL DEFAULT NULL;
2.2. user_info3 컬럼 순서 변경 (필수X)
ALTER TABLE imup.pnp_user
MODIFY user_info3 text AFTER user_info2;
2.3. # /home/webproperties/imup/config.properties 내
responsible.approver.column=""동적 컬럼"" 추가(user_info3).
ㅂ. /home/webproperties/imup/config.properties 파일
2.4. WEB 재시작 후 WORKS -> 시스템 관리 -> 결재선 관리 -> 결재선 추가 -> 결재자 구분 (담당 결재자) 추가
ㅅ. 결재선
2.5. 실제 신청서 작성시 결재정보에 담당 결재자 자동 지정 확인.
ㅇ. 신청서
===========================================================================
※ 참고 ※
해당 기능은 부서장, 팀장 정보가 고객사의 인사정보에 있다는 전제하에 사용이 가능합니다.
OR (imup.pnp_user에 수동으로 기입시 사용 가능.)
실제로 부서장, 팀장이 없는 경우 결재선은 선택할 수 있게 변경되며,
선택은 같은 부서, 팀 내의 인원으로 필터링 됩니다.
현재 필터링 조건을 지정(직급, 직위 등)할 수 있는 기능을 추가할 예정이며, 추가되는 데로 후속 글 작성하도록 하겠습니다.
감사합니다.
(글작성에 도움을 주신 윤진하 부장님 감사드립니다!!)",댓글 없음,https://cafe.naver.com/pnpsecure2/7146
7144,[TIP] dasitelk.dll 파일에서 BMP 파일 추출하는 방법,"[요청사항]
- PC-Assist에서 사용하는 CI를 추출해서 신규 PC-Assist에 적용 가능한지?
[답변]
- 가능하다.
[참고사항]
- 기존의 dasitelk.dll 파일로는 최신 Saferuas 모듈의 RADIUS GrippinTower OTP를 지원할 수 없기에
dasitelk.dll 패치가 필요했고, 패치 시 CI로고가 제거되므로 위 요구사항을 처리하기 위해 진행하였습니다.
- 해당 고객사의 경우 예전 버전의 PC-Assist를 사용하고 있어, dasitelk.dll 파일에 고객사 CI(BMP)
이미지가 포함되어 있었습니다.
(현재는 빌드 시 아래 그림과 같이 Image 파일 디렉토리를 생성하고, BMP 파일을 추가하는 방법으로 진행합니다.)
[추출 방법]
- 고객은 기존 CI를 원했기에 dasitelk.dll 파일에서 Resource Hacker 무료 프로그램을 이용하여
BMP 이미지를 추출하였습니다.
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/7144
7143,DBSAFER 통합 관리 구성 Service Scan 활용 사례 공유,"[요약]
1. DBSAFER 통합관리 구성에서 Master, Slave, DR 서버에서 서버/DBMS 계정 동기화 시 Master서버에서만 동기화 결과가 표기가 되므로, IP 대역이 다른 DR망에서 Service Scan 활용
2. SET의 GW에서 Target 대상으로의 통신체크를 하기 위해 crontab으로 데일리 체크 후 결과 파일 저장
[기능]
1. 포트 검사: 특정 IP 주소와 포트에 대한 연결 상태를 확인합니다.
2. 운영 체제 정보: 옵션에 따라 대상 시스템의 운영 체제 정보를 조회합니다.
3. 결과 출력: 결과를 JSON 또는 텍스트 형식으로 출력하고 파일로 저장할 수 있습니다.
[사용방법]
> python service_scanner.py --ip-address <IP 주소> --port <포트> [옵션]
--ip-address, -ip: 대상 IP 주소 (필수)
--port, -p: 대상 포트 (필수)
--os-check, -os: 운영 체제 정보 조회
--output, -o: 결과를 저장할 출력 파일
--file, -f: IP 및 포트 정보가 포함된 입력 파일
--format-text: 결과를 텍스트 형식으로 출력
--timeout: 포트 검사 시간 제한 (기본값: 5초)
※ IP 주소는 단일 주소 또는 범위로 입력할 수 있습니다. 예: 192.168.1.1 또는 192.168.1.1-192.168.1.10
※ 포트는 단일 포트 또는 범위로 입력할 수 있습니다. 예: 80, 80-88, ""88 443""
1. 단일 IP 주소와 포트 스캔:
python service_scanner.py --ip-address 192.168.1.1 --port 22
2. IP 주소 범위와 포트 범위 스캔:
python service_scanner.py --ip-address 192.168.1.1-192.168.1.10 --port 20-25
3. 운영 체제 정보 조회:
python service_scanner.py --ip-address 192.168.1.1 --port 22 --os-check
4. 결과를 파일로 저장 (JSON 형식)
python service_scanner.py --ip-address 192.168.1.1 --port 22 --output results.json
5. 결과를 텍스트 형식으로 출력:
python service_scanner.py --ip-address 192.168.1.1 --port 22 --format-text
[활용 예시]",댓글 없음,https://cafe.naver.com/pnpsecure2/7143
7141,[TIP] Cubrid DB 원격 접속 안되는 현상 분석,"[개요]
- Cubrid DB 접속 안된다는 문의를 받아 분석 도중에 알게된 Cubrid DB 원격 접속 흐름 공유
- 고객사: 국방 DIDC 1센터
- DBSAFER 를 통해 DB 접속이 되지않을때, DBSAFER 의 문제일 확률이 높아 실제 DBSAFER 의 문제가 아니더라도, 문제 분석을 해야할 순간이 있습니다. 아래 공유드리는 내용과 비슷한 현상이 발생했을때 도움이 되고자 공유드립니다.
[지원 요약]
- 사용자 문의: 로컬 Cubrid 에서는 접속이 잘되지만, DBSAFER 를 통해서 원격 접속을 하게되면, 접속이 안됨
(국방 DIDC 특성 상 DBSAFER agent 를 종료 후 방화벽 오픈을 하더라도, 방화벽 구조가 복잡하여 우회 접근 테스트가 불가했음)
- 원인
Cubrid 서버 내부에서 원격 접속을 담당하는 Broker 프로세스의 conf 값이 제대로 들어가있지않아 원격 접속 불가
원격 접속을 위한 포트 설정에서 두개의 conf 가 존재함(cubrid_broker.conf, cubrid_broker.conf.shard)
위 두개의 conf 에서 원격 포트를 지정하는 옵션의 값이 상이함
cubird_broker.conf -> port: 30001
cubrid_broker.conf.shard -> port: 30000
두개의 원격 포트 지정 옵션이 같아야 내부적으로 포트 오픈 및 관련 프로세스가 연결됨
- 조치
Cubrid DB 담당자에게 내용 공유 및 conf 값 수정 조치
[Cubrid 원격 접속 프로세스]
- Cubrid DB 는 원격 접속 시 JDBC 드라이버 - 브로커 - 데이터베이스 서버의 3-tier 구조를 가집니다.
- 브로커란?
클라이언트와 Cubrid 데이터베이스 서버 사이에서 중계 역할을 하는 프로세스
- 접속 과정
1. 클라이언트 요청
2. Cubrid Broker 가 요청을 수신
3. Broker가 Cubrid DB 서버와 연결 후 처리 및 결과 반환
4. Broker 가 클라이언트에게 응답 전달
Cubrid 이외에도 DB에 접속할때 Broker 와 같은 연결 관리 미들웨어를 사용하는 DBMS 일 경우에도 DBSAFER 에는 문제가 없고, DB 로컬 접속은 되며, 원격 접속이 되지 않을때 DB 서버의 원격 프로세스를 확인 해보면 좋을 것 같습니다.
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/7141
7140,[TIP] backup3 모듈로 백업 및 복원시 특정 테이블 예외 처리 관련,"[요약]
OO카드에서 백업한 정책 DB 내에 cert_history 가 인사 연동 모듈의 비밀 번호 연동시 동기화 할 때마다 인사연동되는 모든 계정에 대하여 1행씩 데이터를 증가하여 n천만건 단위의 데이터가 대량 발생한 내역이 있어 인사연동 모듈 수정 및 해당 테이블 백업한 이력이 있음
백업은 dbsafer3.cert_history_bak_YYYYMMDD 로 수행함
이후 backup3 로 매일 / 매월 정책 백업을 수행
백업된 정책 DB be3 파일 용량도 커지고 해당 정책을 복원시 해당 테이블로 인하여 복원이 매우 더딘 현상이 발생함(하루치 정책 DB 복원시 단순 계산으로 50일 소요)
[요구사항]
- 백업시에는 /dbsafer/.conf/pnp_backup3.conf 내에 아래와 같이 예외처리할 경우 백업 skip 기능이 있음
# can use wildcad
# if you want to skip ""dbsafer_log_2024_04"" database
# and tables that include all ""was prifix"" than you can use this example.
# ex)skip_table_list=dbsafer_log*.was*;
- 복원시에도 해당 기능이 동작하도록 수정 요구
[개발사항]
- 복원시에도 해당 기능이 동작하도록 수정
- skip_table_list 에 cert_history_bak_YYYYMMDD 를 입력 후 복원 수행
- 복원 시간이 5분 이내로 획기적으로 개선됨
[잔여사항]
- 해당 기능은 임시로 전달된 모듈로 수행한 내역임
- 개발자에 의해 기능을 좀 더 다듬어 정식 기능으로 산입할 예정",댓글 없음,https://cafe.naver.com/pnpsecure2/7140
7138,[TIP] 5.0 매니저 서비스 및 보안계정 선택 시 오류 발생 및 목록 출력 안되는 현상,"[현상]
- 매니저 - 서비스 및 보안계정 선택 시 오류 메세지와 함께 목록 출력 안됨
[em_log. 확인]
2025_02_03 13:05:54 [ F ] : Unexpected Error occurred! Exception 0xe06d7363] Dump File is created : C:\Users\tsdi_is\AppData\Roaming\PNP SECURE\Enterprise Manager(x64)\Log\dmp\em_error_20250203_130554.dmp, Version : Enterprise Manager 5.0.9.4A (Build-5884)
- 생성된 덤프 파일로는 연구소 원인 분석 불가
- 최신 버전으로 패치 후에도 동일 증상 발생 하였으며, 최신 버전의 em_log에는 오류 로그 기록 안됨
[원인]
- 확인 결과 특정 보안계정의 pw_change_date (패스워드 변경일자) 값이 1970-01-01 00:00:00 으로 입력 확인
- Windows 플랫폼에서 지원 가능한 시간 범위는 1970-01-01 00:00:01인데 이 값 이하의 값이 입력되어 있어 오류가 발생하는 것으로 확인
[조치]
- 해당 pw_change_date 값을 현재 값으로 변경 후 정상 동작 확인
- Enteprise Manager 5.0.9.5 ALPHA (Build - 7466) 이상 버전에서 수정 됨",댓글 없음,https://cafe.naver.com/pnpsecure2/7138
7136,"[Tip] 어플리케이션 패턴매칭 사용 시 세션 로그 정책명이 ""PATTERN MATCHING""로 남는 현상","어플리케이션 패턴 매칭 사용 시, 로깅 제외 정책을 사용한다면
해당 로그는 제외 되지 않고 로깅 됨
그리고 세션 로그 정책명이 ""PATTERN MATCHING""로 남음
어플리케이션 패턴 매칭 적용 전 정책 동작 (허용/ 허용로그) 확인 필요",댓글 없음,https://cafe.naver.com/pnpsecure2/7136
7134,[TIP] 사용자가 비밀번호 초기화 시 출력되는 안내 문구 수정 방법,"[목적]
SAFERUAS를 사용하는 고객사로부터 사용자에게 출력되는 메세지 수정 요청을 받을 시 대응하기 위함
[방법]
PC Agent -> ID입력 -> 잠금해제/비밀번호 초기화 버튼 클릭 -> (팝업창) 비밀번호 초기화 클릭했을 때 출력되는 위 문구를 수정하고자 할 경우,
1. 서버 접속 후 /home/webapps/saferuas/WEB-INF/classes/lang/common/message_ko.properties 파일 vi 편집기로 열기
2. 내용 수정
message.success_self_reset_pw_url = \uBE44\uBC00\uBC88\uD638 \uCD08\uAE30\uD654 URL \uC815\uBCF4\uB97C \uBA54\uC77C({0})\uB85C \uC804\uC1A1 \uD588\uC2B5\uB2C8\uB2E4. \uBA54\uC77C\uC744 \uD655\uC778 \uD574 \uC8FC\uC138\uC694
->
message.success_self_reset_pw_url = \uBE44\uBC00\uBC88\uD638 \uCD08\uAE30\uD654 URL \uC815\uBCF4\uB97C \uBCF4\uC548\uACC4\uC815\uC5D0 \uB4F1\uB85D\uB41C \uBA54\uC77C\uB85C \uC804\uC1A1\uD588\uC2B5\uB2C8\uB2E4. \uBA54\uC77C\uC744 \uD655\uC778\uD574 \uC8FC\uC138\uC694.
(수정하고자 하는 문구를 유니코드로 입력)
3. 변경 확인
+ 비밀번호 초기화 URL 정보 메세지뿐만 아니라 잠금해제 등 다른 메세지도 해당 파일에서 수정 가능합니다.
감사합니다.","강성우: +이런 류의 웹 소스 파일 변경은 war파일을 패치하면 설정 변경한 내용이 날아가고 기본값으로 덮어씌워지므로 유의해야합니다. | 조성빈: 말씀 감사합니다.
작업간 유의하도록 하겠습니다.",https://cafe.naver.com/pnpsecure2/7134
7130,[TIP] CustomSet 설치 시 SSH 포트가 7795로 변경되지 않도록 설정하는 방법,"[개요]
CustomSet을 설치하면 SSH 포트가 기본적으로 22번에서 7795번으로 변경됩니다.
클라우드 환경에서는 클라우드 전용 CustomSet 패지키를 설치하여 22번 포트로 유지할 수 있습니다.
그러나 클라우드 전용 CustomSet은 yum을 통해 패키지를 설치하는데, yum으로 설치할 수 없는 환경에서는 기본 CustomSet(rpm 사용)으로 설치를 해야합니다.
이를 위해 기본 CustomSet 설치 스크립트에서 ssh 포트 변경이 되지 않도록 설정하는 방법을 공유드립니다.
[설정방법]
Customset 설치 스크립트에서 sshd포트를 변경하는 부분을 주석 처리하면 됩니다.
#cd CustomSet_Rocky8.7/
#vi run.sh
> 아래 코드 주석 처리
89 sed -i 's/#Port 22/Port 7795/' /etc/ssh/sshd_config
107 sed -i 's/^ssh\s\+22\/tcp.*/ssh             7795\/tcp
108 sed -i 's/#Port 22/Port 7795/' $sshdconfFile
> 주석 처리 후 코드
84 selinuxFile=""/etc/selinux/config""
85 servicesFile=""/etc/services""
86 sshdconfFile=""/etc/ssh/sshd_config""
87 sshdsvcFile=""/usr/lib/systemd/system/sshd.service""
88
89 #sed -i 's/#Port 22/Port 7795/' /etc/ssh/sshd_config
90
91 # install_rpms()
92
93 # 이전 포트 값
94 OLD_PORT=""22""
95
96 # 새로운 포트 값
97 NEW_PORT=""7795""
98
99 # 이전 값
100 OLD_VALUE=""ExecStart""
101
102 # 새로운 값
103 NEW_VALUE=""ExecStart=/usr/sbin/sshd \$OPTIONS""
104
105
106 sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' $selinuxFile
107 #sed -i 's/^ssh\s\+22\/tcp.*/ssh             7795\/tcp                        # SSH Remote Login Protocol/g' $servicesFile
108 #sed -i 's/#Port 22/Port 7795/' $sshdconfFile
109 sed -i ""s/$OLD_VALUE.*/$NEW_VALUE/g"" $sshdsvcFile
110 sed -i 's/^#AllowAgentForwarding yes/AllowAgentForwarding no/g' /etc/ssh/sshd_config
111
112 fin_set
[결과]
CustomSet 설치 후에도 SSH 포트가 7795번으로 변경되지 않습니다.
이상입니다.
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/7130
7127,[Tip] 매니저 명령어 사용 이력 엑셀 내보내기 시 행 밀림 조치 건,"매니저 명령어 사용 이력 엑셀 내보내기 시 행 밀림 조치 방법 공유드립니다.
[이슈 사항]
1. 아래와 같이 테이블 컬럼에 데이터가 없는것을 확인 후 내보내기 수행
2. 내보내기 후 명령어 일정 길이 이상 넘어갈 경우, 엑셀 파일 열람 시 테이블 컬럼에 명령어가 출력됨
3. 내보내기 시 명령어 컬럼을 체크 해제해도 증상 동일
[원인]
- 개행은 일정 길이 넘으면 다음행으로 넘겨버림
[조치]
- 매니저 시스템 설정 로그 조회 설정에서 Excel 파일로 저장 시 개행 제거 체크
* 일부 낮은 버전 옵션 없음
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/7127
7122,[Tip] pnp_accountsync를 이용한 인사연동 시 데이터에 공백 발생 조치 건,"MSSQL DB 데이터를 연동 하는 과정에서 발생한 이슈 및 조치 방법 공유 드립니다.
[이슈 사항]
- MSSQL DB서버에서 인사 연동 시 데이터가 깨지는 현상(공백 입력)이 발생하였습니다.
[원인]
- MSSQL의 NVARCHAR는 UTF-16을 사용하고, MySQL의 VARCHAR는 일반적으로 UTF-8을 사용하기 때문에, 인코딩 차이로 인해 공백이 생기는 문제가 발생할 수 있습니다.
[조치]
- CONVERT 함수(CONVERT(VARCHAR, COULUM_NAME))를 통해 조치 하였습니다.
- 설정 파일 수정
경로: /dbsafedr/.conf/pnp_accountsync.properties
ex) From = SELECT CONVERT(VARCHAR(50), USER_ID) AS USER_ID from TABLE_NAME
- 모듈 재기동
경로: /dbsafer
./pnp_accountsync.sh stop
./pnp_accountsync.sh start
[추가]
- 추가로 NVARCHAR과 VARCHAR의 차이점에 대해 설명하겠습니다.
varchar
nvarchar
공통점
가변형 문자열 저장
지원 언어
영문 또는 테이블에 설정된 기본 지원 언어
유니코드 지원
영문, 숫자 데이터 크기
1byte
2byte
한글, 한자 데이터 크기
2byte
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/7122
7121,[오케이몰] 대상 서버의 FTP 접속 방식에 따라 접속이 지연되는 이슈 조치 사항,"오케이몰 FTP 접속 방식에 따라 접속이 지연되는 현상
- 배경
1. DBSAFER를 통해 FTP 접속 시 접속 지연되는 현상이 발생 (접속 잘되는 서버는 1초~2초 / 접속이 안되거나 지연이 되는 서버는 10~40초 가량 소요)
2. WINSCP의 TMOUT 시간을 50초로 늘리고 접속 시 접속은 가능
- 확인된 사항
1. FTP를 proftpd, vsftpd를 통해 접속하는 상황
2. Winscp, Filezilla 등의 툴로 접속해도 접속이 지연되는 상황
- 조치
1. 모듈 패치 필요
- 관련 BUGS URL
https://bugs.pnpsecure.com/view.php?id=30471
[DBSAFER를 통한 FTP 접속]
1. DBSAFER 자동 접속을 통한 Winscp로 FTP 접속
- DBSAFER를 통해서 FTP 접속 시도 시 정상 접속 되는 서버 / 접속이 안되는 서버 확인
- WinSCP의 경우 세션 타임아웃이 15초로 Default로 설정되어 있음
- WINSCP의 TMOUT 시간을 50초로 늘리고 접속 시 접속은 가능
FTP 접속이 안되는 서버에서 발생한 Winscp 팝업창
2. 패킷 분석 진행 (고객사의 네트워크 환경이 원활하지 않아 Retransmission 과 Dup Ack가 상당히 많음)
2-1. FTP 접속이 잘되는 서버에 대한 확인
- 처음 접속 요청 구간
DBSAFER - 대상 서버 TCP 연결 요청 정상
- FTP 세션 연결 요청 이후 대상 서버의 DATA 전달 확인
패시브 모드로 실제 대상 서버의 설정된 PORT로 DATA를 전달 받음
- FTP 접속, DATA 전송이 완료되면 226 리스폰스 값을 대상 서버 -> DBSAFER로 전달
226 리스폰스 응답값 이후 FTP 세션 연결 완료 (접속 시 완료 시각 기준 1초가 걸리지 않음)
2-2. FTP 접속이 지연되는 서버에 대한 확인
- 처음 접속 요청 구간
DBSAFER - 대상 서버 TCP 연결 요청 정상
- FTP 세션 연결 요청 이후 대상 서버의 DATA 전달 확인
패시브 모드로 실제 대상 서버의 설정된 PORT로 DATA를 전달 받음
해당 구간에서 문제 발생
- FTP 접속, DATA 전송이 완료되면 226 리스폰스 값을 대상 서버 -> DBSAFER로 전달
Response 226 응답 값이 10초 이후에 DBSAFER로 전달 되면서 FTP 접속 지연 이슈 발생 (접속 시 완료 시각 기준 10초 이상 소요)
[Response 226 응답값이란]
- FTP 프로토콜에서 226 응답은 데이터 전송이 완료되었음을 알리는 메시지 (대상 서버 to DBSAFER)
- 226 응답 코드 자체로, FTP 명령어가 성공적으로 완료되었음을 나타냄
- FTP에서 데이터 연결이 종료될 때 이 응답 코드가 보내지며 전송된 파일이 정상적으로 처리되었음을 알림
[Response 226 응답값이 특정 서버는 빠르고 특정 서버는 느린 이유]
1. 특정 서버에서 FTP 접속이 빠른 이유 (vsftpd)
- 데이터를 전달 받고 클라이언트(DBSAFER)와 서버 간의 데이터 세션에 대한 연결 종료가 필요
- vsftpd의 경우 클라이언트(DBSAFER)에서 FIN 플래그가 전달 되지 않아도 데이터 세션을 대상 서버에서 종료 시켜 다음 스탭으로 넘어감
- 아래에 패킷을 보면 실제 DBSAFER -> 대상서버에 FIN 플래그를 전달하지 않아도 vsftpd의 특성상 FIN 플래그를 전달 받지 않아도 대상 서버에서 데이터 세션을 종료
- 그 이후 다음 단계를 진행하여 정상적으로 접속 가능
FTP 잘되는 서버의 패킷 기준 DBSAFER -> 대상 서버로 FIN 플래그를 전달되지 않아도 대상 서버에서 데이터 세션을 종료
2. 특정 서버에서 FTP 접속이 느린 이유 (Proftpd)
- 데이터를 전달 받고 클라이언트(DBSAFER)와 서버 간의 데이터 세션에 대한 연결 종료가 필요
- Proftpd의 경우 클라이언트(DBSAFER)에서 FIN 플래그가 대상 서버로 전달 되지 않으면 일정 시간을 대상 서버에서 대기하였다가 데이터 세션을 종료
- 연결을 종료하는 절차가 늦어지면, 226 메시지가 그만큼 늦게 반환
- 아래에 패킷을 보면 실제 DBSAFER -> 대상서버에 FIN 플래그를 전달하지 않으면 proftpd의 특성상 일정 시간 기다리고 226 리스폰스 값을 클라이언트로 전달
FTP 접속이 안되는 서버의 패킷 기준 DBSAFER -> 대상 서버로 FIN 플래그를 전달하지 않아 대상 서버에서 대기 상태를 유지
[수정 사항]
- 모듈 FTP-DATA 처리가 완료된 경우 DBSAFER에서 FTP 서버로 FIN이 전달하도록 수정 (Vsftpd, Proftpd 동일하게 FIN 플래그를 전달)
- 모듈 수정 대상 : pnp_ftp_gateway MAIN VERSION (Rev: v2810) 이상에서 수정완료 (가급적 ftp_gateway와 ftp 모듈 같이 패치 권장 / 다른 문제가 발생될 시 확인하기 용이)
==========================================================================
추가로 대상 서버의 FTP 접속 방식에 대하여 확인할 수 있는 방식 전달 드립니다.
[FTP 대상 서버의 차이점]
1. FTP 접속이 잘되는 서버 - Vsftpd
- 패킷상에서 확인 가능한 방법
최초 세션 요청 이후 220 리스폰스 값에 대상 서버의 FTP 방식을 전달 (vsFTPD)
- 서버에 직접 접속하여 확인 가능
프로세스를 통한 확인
경로를 통한 확인
2. FTP 접속이 지연되는 서버 - Proftpd
- 패킷상에서 확인 가능한 방법
최초 세션 요청 이후 220 리스폰스 값에 대상 서버의 FTP 방식을 전달 (ProFTPD)
- 서버에 직접 접속하여 확인 가능
프로세스를 통한 확인
경로를 통한 확인
추가로 FTP의 경우 평문으로 노출되는 보안 취약점이 있기에 사용하는 것을 권장드리지는 않지만 사용하는 고객사에서 접속이 안될 시 확인하면 좋을 것 같습니다.
해당 이슈 해결에 도움을 주신 김태윤 실장님, 박장원 책임님께 감사드립니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/7121
7106,[현대오토에버] Apache Tomcat 취약점 (CVE-2025-24813) 취약점 여부 확인 요청,"[FAQ분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
현대오토에버
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
3. 특이사항 (연동 모듈, 커스텀 개발 등)
4. 사내 재현 정보
5. 요청사항
- DBSAFER에 설치된 Apach-Tomcat이 CVE-2025-24813 취약점에 해당하는지 확인 부탁드리며,
해당 취약점에 노출되었을 경우 조치가능여부 확인 부탁드립니다.
https://feedly.com/cve/CVE-2025-24813
CVE-2025-24813 / apache / 9.8 / exploit + patch
Path Equivalence: 'file.Name' (Internal Dot) leading to Remote Code Execution and/or Information disclosure and/or malicious content added to uploaded files via write enabled Default Servlet in Apache Tomcat. This issue affects Apache Tomcat: from 11.0.0-M1 through 11.0.2, from 10.1.0-M1 through 10....
feedly.com
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
- COMMON_UTIL_V2.44_build-1_20241223.tgz
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)",이임재: https://cafe.naver.com/pnpsecure2/7107 | 이임재: 상기 링크 참고 부탁드립니다.,https://cafe.naver.com/pnpsecure2/7106
7105,[TIP] WEB DMS 실행 전/후 데이터 검증 시 락이 발생하여 프로세스가 0%에서 멈추는 현상,"[현상]
- 실행 전/후 데이터 검증 시 락이 발생하여 프로세스가 0%에서 멈추는 현상
- 검증 취소 버튼을 클릭하면 ""요청 SQL 목록 실행을 취소하시겠습니까?"" 메시지가 표시되며, 확인을 눌러도 창이 닫히지 않는 오류 발생
실행 전/후 데이터 검증 클릭 시
검증 취소 버튼 클릭 시
[원인]
다른 세션에서 DML을 실행한 후 커밋 또는 롤백을 하지 않아 DML LOCK 이 걸림
[해결 방법]
- 정책 생성 하여 다른 툴에서 DML 명령어가 실행에서 멈추지 않도록 설정
- DML LOCK이 발생하는 경우, 데이터베이스 관리자가 LOCK을 모니터링 하여 LOCK을 해제
(세션 킬 또는 락을 발생시킨 사용자의 트랜잭션 종료 요청 등)
- 각 데이터베이스마다 DML LOCK의 타임아웃 설정
※ DMS API에서는 데이터베이스 응답이 없는 것이 LOCK 문제인지 다른 문제인지 모르기 때문에 로그를 남길 수가 없다고 합니다.","박수아: 해결방법 중 각 데이터베이스마다 DML LOCK의 타임아웃 설정 에 대해 첨언 드립니다.


각 데이터베이스들은 DML LOCK 타임아웃 설정 기능을 제공하므로 아래 메뉴에서 LOCK TIME 명령어를 설정하면 됩니다.
[원장관리 > 대상 데이터베이스 > 대상 데이터베이스 정보 > 세션 쿼리] 에 각 데이터베이스에서 제공하는 LOCK 타임아웃 명령어를 입력하면 됩니다.
ex) MYSQL : SET SESSION innodb_lock_wait_timeout = 10;",https://cafe.naver.com/pnpsecure2/7105
7104,삼성 KNOX API 개발문서 공유,"삼성 KNOX 연동 API 개발 문서 공유 드립니다.
문서 외 내용은 해당 게시글에 업데이트 하겠습니다.
#2025-03-19
에러코드 AP513 : aplns에서 seq가 잘못되었을 경우 발생
첨부파일
KNOX_API_결재
.pdf
null
파일 다운로드
첨부파일
KNOX_API_메일
.pdf
null
파일 다운로드
첨부파일
KNOX_API_임직원
.pdf
null
파일 다운로드",댓글 없음,https://cafe.naver.com/pnpsecure2/7104
7097,"[TIP] Ldap 인사연동 시 연동 대상 계정이 1,000건이 넘는 경우 설정 방법","[이슈]
Ldap 프로토콜을 통한 인사연동 시, 서버에 maxPageSize가 설정되어 있는 경우 대상 계정이 1,000건이 넘으면 에러가 발생함.
Mar 07, 2025 1:57:54 PM com.pnpsecure.accountsync.LdapAccountReaderImpl nextAccount
SEVERE: NamingException.
javax.naming.SizeLimitExceededException: [LDAP: error code 4 - Sizelimit Exceeded]; remaining name 'OU=USERS, DC=KAKAOENT, DC=OKTA, DC=COM'
at java.naming/com.sun.jndi.ldap.LdapCtx.mapErrorCode(LdapCtx.java:3311)
at java.naming/com.sun.jndi.ldap.LdapCtx.processReturnCode(LdapCtx.java:3205)
at java.naming/com.sun.jndi.ldap.LdapCtx.processReturnCode(LdapCtx.java:2996)
at java.naming/com.sun.jndi.ldap.AbstractLdapNamingEnumeration.getNextBatch(AbstractLdapNamingEnumeration.java:148)
at java.naming/com.sun.jndi.ldap.AbstractLdapNamingEnumeration.hasMoreImpl(AbstractLdapNamingEnumeration.java:217)
at java.naming/com.sun.jndi.ldap.AbstractLdapNamingEnumeration.hasMore(AbstractLdapNamingEnumeration.java:189)
at com.pnpsecure.accountsync.LdapAccountReaderImpl.nextAccount(LdapAccountReaderImpl.java:472)
at com.pnpsecure.accountsync.Sync.test(Sync.java:1148)
at com.pnpsecure.accountsync.Main.test(Main.java:313)
at com.pnpsecure.accountsync.Main.main(Main.java:146)
null
Exception in thread ""main"" java.lang.NullPointerException
at java.naming/com.sun.jndi.ldap.AbstractLdapNamingEnumeration.getNextBatch(AbstractLdapNamingEnumeration.java:130)
at java.naming/com.sun.jndi.ldap.AbstractLdapNamingEnumeration.nextAux(AbstractLdapNamingEnumeration.java:258)
at java.naming/com.sun.jndi.ldap.AbstractLdapNamingEnumeration.nextImpl(AbstractLdapNamingEnumeration.java:249)
at java.naming/com.sun.jndi.ldap.AbstractLdapNamingEnumeration.next(AbstractLdapNamingEnumeration.java:203)
at java.naming/com.sun.jndi.ldap.AbstractLdapNamingEnumeration.next(AbstractLdapNamingEnumeration.java:40)
at com.pnpsecure.accountsync.LdapAccountReaderImpl.nextAccount(LdapAccountReaderImpl.java:439)
at com.pnpsecure.accountsync.Sync.test(Sync.java:1148)
at com.pnpsecure.accountsync.Main.test(Main.java:313)
at com.pnpsecure.accountsync.Main.main(Main.java:146)
[원인]
Ldap 서버에 maxPageSize가 적용된 경우 한 번의 Ldap 요청을 통해 한 번에 최대 1,000개의 계정만 가지고 올 수 있게 됨.
이 경우 터미널에서는 계정이 1,000개까지는 잘 찍히지만, 정확히 1,001번째 순서에서 위 에러가 발생하며 연동이 중단됨.
[해결방법]
pnp_accountsync.properties 파일에 아래와 같이 설정
AccountReader = com.pnpsecure.accountsync.LdapPagingAccountReaderImpl
LdapPagingSize = 500 (고객사 서버 설정보다 작은 값으로 설정.
* 설정 적용 전 1,000에서 막히는 경우 1,000보다 작게 설정하면 됨.
* Windows AD는 기본값이 1,000임.
[참고 벅스]
https://bugs.pnpsecure.com/view.php?id=22559
https://bugs.pnpsecure.com/view.php?id=30412",댓글 없음,https://cafe.naver.com/pnpsecure2/7097
7093,[TIP] MANAGER Build-7376 ~ 7478 버전에서 Server Agent Terminal 감사로그 조회 시 사용자 실제 접속 시간이 아닌 감사로그 저장 시간을 표기하는 현상 조치 건,"[요약]
- MANAGER Build-7376 ~ 7478 버전에서 Server Agent Terminal 감사로그 조회 시 사용자 실제 접속 시간이 아닌 server_manager가 감사로그를 받아 DB 저장 시간을 표기하는 현상
- Enteprise Manager 5.0.9.5 ALPHA (Build - 7483) 버전에서 수정 되었으니 해당 버전 이상의 매니저 사용 권장 드립니다.
[수정사항] (벅스 링크 : https://bugs.pnpsecure.com/view.php?id=30463)
. server_time으로 출력하는 것이 더 정확한 것으로 확인되어 server_time기준으로 출력되도록 수정 완료
[버전정보]
- Enteprise Manager 5.0.9.5 ALPHA (Build - 7483)
[상세내역]
- shell_acl_DD 테이블 내 in_time, server_time 컬럼 내 데이터
- in_time, out_time
> DBSAFER 서버 내 pnp_server_manager 모듈에서 로그를 수집하여 DB 에 저장한 시간
우회접속세션이기 때문에 out_time (세션 종료) 은 측정이 안되어 in_time과 out_time 은 동일 시간 표기
- server_time
> 대상서버 내 Server Agent(nodesafer 프로세스) 에서 이벤트를 감지한 대상 서버 기준 시간
- 사내테스트 진행 내역 (수정 전 Manager Build - 7478)
- 테이블 내 컬럼 데이터 확인(in_time) / 감사로그 조회 시 in_time 데이터로 표기되는 것 확인
- 사내테스트 진행 내역 (수정 후 Manager Build - 7483)
- 테이블 내 컬럼 데이터 확인(server_time) / 감사로그 조회 시 server_time 데이터로 표기되는 것 확인
이상입니다.
감사합니다.
* 수정이 필요한 부분이나 개선사항이 있다면 댓글로 남겨주시면 감사하겠습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/7093
7089,"[공유] Enterprise Manager 7.0 마이그레이션 기능 사용 시, DB 이름 변경 작업 실패","[이슈 증상]
1. Enterprise Manager 7.0 마이그레이션 기능 사용 시, DB 이름 변경 작업 실패
[버전 정보]
1. 매니저
- Enteprise Manager 7.0.0.2 ALPHA (Build - 3323)
[이슈 상세 내용]
1. 작업 에러 로그 내 'view'가 포함된 테이블 확인
- 실제 VIEW 테이블인지 확인 및 지원가능여부 확인 필요
2. DBSAFER 7.0 dbsafer3에 존재하는 모든 VIEW(뷰) 목록 조회
# SELECT TABLE_NAME FROM information_schema.TABLES WHERE TABLE_SCHEMA = 'dbsafer3' and TABLE_TYPE = 'VIEW';
* 위 내용 확인 전 아래 사항에 대하여 확인했습니다.
1. (DBSAFER7.0) SQL 모드 설정
2. (DBSAFER5.0) 외래 키 제약 조건 설정 여부
3. (DBSAFER7.0) InnoDB 스토리지 엔진에서 테이블을 별도 파일 저장 여부
4. (DBSAFER 5.0, 7.0) /etc/my.cnf
[원인]
1. 마이그레이션 작업 시, dbsafer3 내 모든 테이블 대상으로 RENAME TABLE 구문 처리함.
- RENAME TABLE 구문은 테이블(table) 전용 명령어이기 때문에 VIEW(뷰) 에 대해서는 사용할 수 없음.
2. 마이그레이션 작업 전 IM/WORKS 설치 및 세팅으로 am_policy, auth_policy 등 자동연동정책 관련 뷰테이블이 생성되어 있었으며 RENAME TABLE 대상에 포함되면서 쿼리가 실패함.
[조치]
1. 마이그레이션 대상 테이블 조회 시, VIEW 타입은 제외하도록 수정
- information_schema에서 테이블 수집 시, 테이블 타입이 'BASE TABLE' 인 항목만 수집하도록 쿼리 수정
. 패치 버전 : Enteprise Manager 7.0.0.2 ALPHA (Build - 3379)
[참고]
1. 마이그레이션 실패 시, dbsafer3뒤에 random 값이 붙은 DB가 생성되며 여러 번 시도 시에는 복수 개 생성됨.
- 작업 실패 후 Rollback 처리되므로 마이그레이션 작업 완료 전 생성된 dbsafer3[랜덤값] DB는 DROP 명령어로 삭제해도 영향도 없음.
2. 마이그레이션 기능은 1회만 사용가능하며 수행 이후에는 시스템 설정에서 해당 옵션이 비활성화됨.","조재근: 마이그레이션 뷰 관련 예외처리한 패키지 입니다. 참고바랍니다.

https://bbs.pnpsecure.com/showthread.php?tid=14490",https://cafe.naver.com/pnpsecure2/7089
7088,[공유] 방향키로 차단 명령어 수행 시 로그 상에는 차단으로 적용되나 명령어 수행이 되는 현상,"[요약]
- ssh 명령어를 통해 접속 가능한 사용자를 제한하도록 정책 설정하였으나 히스토리 명령어를 방향키로 수행 시 명령어가 수행되는 현상 확인
- 명령어 결과값에 CR이 포함되며 명령어 분석 정보를 초기화하고, 이에 따라 명령어 인지 불가 현상 확인
- pnp_telnet Build 3495 이상에서 결과값에 CR이 포함되더라도 명령어 분석 정보를 유지하도록 수정 완료
- R25.03 릴리즈에 해당 모듈 반영 예정
[이슈증상]
- 히스토리 명령어를 방향키로 수행 시 로그 상에는 차단으로 적용되나 실제로는 명령어가 수행되는 현상
[고객사 환경 정보]
- 단독구성
- DBSAFER V5.0 (※ DBSAFER V7.0 도 동일한 상황)
- 모듈 정보
[PKG]
PKG_DBSAFER5_RelR23.05-RockyLinux_x86_64_20231219.tar.gz
[root@localhost dbsafer]# ./pnp_telnet --version
Telnet Release version 3.3.473 128bit -SafetyCMD for RelTBINUC-RockyLinux8
Build (3473) Build-Update (Jan 3 2024 16:12:37) MAX-USER : 1000
MAIN VERSION 3.7 (20200101)(Rev: v2558)
ADDED OPTION STATUS: NONE
COMMON MAIN MODULE VERSION: 3.3.473 128bit -SafetyCMD
COMMON LIBRARY VERSION: 3883
COMMON POLICY MODULE VERSION: 1.2.19
COMMON CERTIFICATION MODULE VERSION: V3
COMMON 2FACTOR PROTOCOL : v2
SHARED INTERFACE VERSION: 602
COMMON-API(UTIL) VERSION: 194
[이슈 상세 내용]
- 차단 명령어 그룹 내에 ssh 명령어 존재
- 명령어를 직접 타이핑하여 입력하는 경우 정상적으로 차단이 되나, 방향키 (UP/DOWN) 를 통해 히스토리로 수행 시 차단되지 않는 현상 발생
- ssh 툴에서 해당 명령어는 허용이 되나, DBSAFER 로그에는 차단으로 남는 상황
[이슈원인]
1. 프롬프트보다 긴 명령어가 입력된 후 방향키로 프롬프트보다 짧은 명령어 히스토리 조회 시
- 명령어 분석 정보 초기화 (CR [0x0D] 포함으로 인해 발생)
- 이후 히스토리 조회 중 백스페이스 발생 시 명령어 인지 불가
[2025-03-10 04:11:17] [P:49607][T:140318715459328] [ssh:recv] (SERVER)192.168.111.32:22, (RET)66, (TYPE)94, (LEN)66
00000 0d 1b 5b 43 1b 5b 43 1b 5b 43 1b 5b 43 1b 5b 43 ..[C.[C.[C.[C.[C
00010 1b 5b 43 1b 5b 43 1b 5b 43 1b 5b 43 1b 5b 43 1b .[C.[C.[C.[C.[C.
00020 5b 43 1b 5b 43 1b 5b 43 1b 5b 43 1b 5b 43 1b 5b [C.[C.[C.[C.[C.[
00030 43 1b 5b 43 1b 5b 43 1b 5b 43 1b 5b 43 61 61 1b C.[C.[C.[C.[Caa.
dbsafer_net_tcp_engine.cpp(check_authority_n_masking):4544
[2025-03-10 04:11:17] [P:49607][T:140318715459328] [REPLAY] (CLIENT)10.77.162.69:52449, (SERVER)192.168.111.32:22, (UINDEX)1741547373070008002, (CINDEX)11, (LEN)66
raw_data_manager.cpp(telnetreplayer_collect_raw):326
[2025-03-10 04:11:17] [P:49607][T:140318715459328] [REPLAY:INSERT] (SERVER)192.168.111.32:22, (UINDEX)1741547373070008002, (LEN)66, (TIMESTAMP)104.73, (SIZE)71
raw_data_manager.cpp(insert_packet_raw):557
[2025-03-10 04:11:17] [P:49607][T:140318715459328] [REPLAY:INSERT] (raw_half)821/32768, (0)0, (1)0, (2)0, (3)0/8192
raw_data_manager.cpp(insert_packet_raw):615
)
2. 1번 이후(명령어 분석 정보 초기화 후) 프롬프트보다 긴 명령어 히스토리 조회
- 백스페이스(0x08) 처리로 인해 명령어 인지 불가
[2025-03-10 07:36:26] [P:49607][T:140318715459328] [ssh:recv] (SERVER)192.168.111.32:22, (RET)26, (TYPE)94, (LEN)26
00000 08 08 73 73 68 20 72 6f 6f 74 40 31 39 32 2e 31 ..ssh root@192.1
00010 36 38 2e 31 31 31 2e 31 33 32 68.111.132
dbsafer_net_tcp_engine.cpp(check_authority_n_masking):4544
[2025-03-10 07:36:26] [P:49607][T:140318715459328] [REPLAY] (CLIENT)10.77.162.69:52449, (SERVER)192.168.111.32:22, (UINDEX)1741547373070008002, (CINDEX)41, (LEN)26
raw_data_manager.cpp(telnetreplayer_collect_raw):326
[2025-03-10 07:36:26] [P:49607][T:140318715459328] [REPLAY:INSERT] (SERVER)192.168.111.32:22, (UINDEX)1741547373070008002, (LEN)26, (TIMESTAMP)12413.39, (SIZE)31
raw_data_manager.cpp(insert_packet_raw):557
[2)25-03-10 07:36:26] [P:49607][T:140318715459328] [REPLAY:INSERT] (raw_half)145/32768, (0)0, (1)0, (2)0, (3)0/8192
R( ssh root@192.168.111.30ssh root@192.168.111.132)
dbsafer_net_tcp_engine.cpp(dbsafer_net_tcp_main):3020
[2025-03-10 07:36:26] [P:49607][T:140318715459328] pre=1 c_index=41 n=26 en=0 pnp=0 step=1 login=1 action=0 type=2 flag=9 su:0 sim:0 vi:0
[2025-03-10 07:36:27] [P:49607][T:140318715459328] [sshd:recv] (CLIENT)10.77.162.69, (RET)1, (TYPE)94, (LEN)1
00000 0d .
dbsafer_net_tcp_engine.cpp(dbsafer_net_tcp_main):1612
... (중략)
[2025-03-10 07:36:27] [P:49607][T:140318715459328] [ssh:recv] (SERVER)192.168.111.32:22, (RET)34, (TYPE)94, (LEN)34
00000 0d 72 6f 6f 74 40 31 39 32 2e 31 36 38 2e 31 31 .root@192.168.11
00010 31 2e 31 33 32 27 73 20 70 61 73 73 77 6f 72 64 1.132's password
00020 3a 20 :
dbsafer_net_tcp_engine.cpp(check_authority_n_masking):4544
[조치방안]
- - 프롬프트보다 긴 명령어가 입력된 이후, 방향키로 프롬프트보다 짧은 명령어 출력 시 명령어 분석 정보를 초기화하지 않도록 수정함
. 히스토리 조회에 대한 결과값에 CR이 포함되더라도 명령어 분석 정보를 유지하도록 수정함
- 하단 버전으로 패치 후 정상 차단",댓글 없음,https://cafe.naver.com/pnpsecure2/7088
7087,[TIP] PID 최대 생성 개수 초과에 대한 대응 및 예방책,"[개요]
최근 고객사에서 PID 생성 개수 초과로 인해 서비스 가동 실패 및 모듈 실행 불가 등의 이슈가 발생하였습니다. 이에, Linux OS에서의 PID 관련 기본 개념을 이해하여 증상 발생 시 대응과 사전 예방할 수 있도록 도움되고자 내용을 작성하였습니다.
[PID 정의와 특징]
- Linux/Unix 계열 운영체제에서 각 프로세스를 식별하는 고유한 번호
- 고유성 :
. OS 시스템에서 실행중인 모든 프로세스는 서로 다른 PID를 가지고 있음
. 한번 종료된 PID는 재사용됨
- 할당 방식 :
. 시스템이 새로운 프로세스를 생성(fork(), exec())할 때 자동으로 부여됨
. 가장 낮은 사용 가능한 숫자가 할당됨 (최소 가용 PID 할당 방식)
[Thread 란?]
- Linux OS 에서 Thread는 프로세스 내에서 실행되는 독립적인 실행 흐름
. 하나의 프로세스 안에서 여러 개의 쓰레드가 실행될 수 있음
. 같은 메모리 공간(코드, 데이터, 힙)을 공유하며 동작
. 각 쓰레드는 개별적인 스택(Stack)과 CPU 레지스터를 가짐
[자식 프로세스 vs Thread 차이점]
구분
자식 프로세스 (Child Process)
쓰레드 (Thread)
PID (고유 ID)
부모와 다른 PID (새로운 프로세스)
부모 프로세스와 같은 PID (쓰레드는 내부적으로 TID를 가짐)
메모리 공간
부모와 별도 메모리 공간 사용
부모 프로세스와 메모리 공유
자원 공유
부모 프로세스와 독립적인 자원 사용 (파일, 변수 등)
같은 프로세스 내에서 코드, 데이터, 힙을 공유
생성 비용
상대적으로 높음 (fork() 호출 시 메모리 복사 필요)
가벼움 (pthread_create() 등으로 쉽게 생성 가능)
통신 방식
IPC (파이프, 메시지 큐, 소켓 등) 필요
같은 메모리 공간을 공유하므로 별도 통신 필요 없음
독립성
부모 프로세스가 죽어도 자식 프로세스는 계속 실행 가능
부모 프로세스가 죽으면 쓰레드도 함께 종료됨
예시
fork() 사용
pthread_create(), std::thread 등 사용
[PID와 Thread 연관성]
- Linux OS 에서 Thread는 독립적인 Lightweight Process (LWP)로 취급되며, clone() 시스템 호출을 사용하여 각 Thread에 고유한 PID 할당된다. 따라서 각 쓰레드도 PID 개수 제한에 포함됨
※ 즉, PID(부모 프로세스 + 자식 프로세스) + Thread = 총 PID 개수
[PID 생성 초과 시 발생 로그]
- PID 생성 개수 초과 시 아래와 같은 증상 및 로그가 발생할 가능성이 높습니다.
- 발생 가능한 증상 예시 :
1) 서비스 가동 실패 (프로세스를 생성하지 못하여 서비스 가동 실패)
2) 모듈에서 Thread 및 자식 프로세스 생성 실패
- PID 생성 개수 초과로 인한 로그 형태 :
1) bash, 일반 프로세스 생성 시
- bash: fork: retry: Resource temporarily unavailable / 일정 시간 동안 fork를 재시도하지만 실패한 경우
- bash: fork: Cannot allocate memory / 프로세스를 위한 메모리 할당이 불가능한 경우
2) C, Python 등 프로그래밍 언어에서 프로세스 생성 시
- fork: Resource temporarily unavailable
- OSError: [Errno 11] Resource temporarily unavailable
3) systemd 관련 로그 (dmesg 등)
- kernel: fork: Cannot allocate memory
- kernel: Out of memory: Kill process 1234 (some_process) score 100 or sacrifice child
[대응 및 사전 예방]
※ 당연하게도 대상 서비스와 보안계정 사용자 수가 많은 고객사일 경우 더욱 주의가 필요합니다.
1. PID 개수 초과 시 대응 방법
1) 명령어를 통한 max 값 수정
- PID 제한 값 확인
#cat /proc/sys/kernel/pid_max
- PID 제한 값 변경
#echo ""kernel.pid_max = [변경 값]"" >> /etc/sysctl.conf
#sysctl -p
- PID 제한 값 다시 확인
#cat /proc/sys/kernel/pid_max
2) 설정 파일 직접 수정
- 설정 파일 진입
#vi /etc/sysctl.conf
- 아래 설정 값 수정 후 저장 및 적용
kernel.threads-max = [변경 값]
kernel.pid_max = [변경 값]
#sysctl -p
- PID 제한 값 다시 확인
#cat /proc/sys/kernel/pid_max
2. 사전 예방
1) 정기점검 시 프로세스 개수 확인
#ps -eLf | wc -l // Thread 개수 까지 포함하여 출력
※ ps -ef 는 Thread 개수가 포함되지 않아 max 값 추정치 확인이 어려우니, -eLf 옵션을 통해 개수 확인이 필요
2) 사용중인 프로세스 개수가 max 값에 근접해질 경우 [대응방안]으로 사전에 수정
※ max 값을 너무 높게 잡으면 CPU 에서 메모리 할당할 때 불필요한 리소스가 발생할 수 있으므로 적정치 수정 권고
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/7087
7084,[TIP] [롯데카드] DBSAFER5 WEB 최고관리자 계정(dbsafer) 숨김 기능 사용법,"[개요]
롯데카드 방통위 감사 지적건으로 사용자 미사용 보안계정(dbsafer) 삭제 권고를 받았습니다.
이에 dbsafer 계정을 숨김으로서 감사 대응하였으며, 내용 공유드립니다.
(dbsafer 계정 이외에 다른 보안계정으로 IM 최고관리자 지정하는 방법도 있지만, 해당 보안계정 소유자가 부서이동, 퇴사 했을 경우 다시 다른 보안계정으로 변경해줘야하는 번거로움이 있습니다.)
[방법]
1. 매니저 시스템 설정(Ctrl + Shift + F8) (DBSAFER 5 Build - 7428 이상에서 사용 가능합니다.)
- 시스템 설정 > 보안계정 연동 설정 > IM/IMUP 연동 기능 사용 > 최고 관리자 계정 숨김 처리 활성화
위 기능 활성화하시고 매니저 재기동 하시면 dbsafer 계정은 실제 존재하지만, 매니저에서는 보이지 않습니다!
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/7084
7075,[현대오토에버] 일부 사용자들에 대해 LDAP 인증 오류가 발생하는 현상 확인,"[FAQ분류] (에러로그문의 / 기능로직문의 / 기타문의)
에러로그문의
[고객사/채널사]
현대오토에버
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크)
- 인사 연동 설정 변경 이후 일부 사용자에 대해 LDAP 인증 오류가 발생
> 변경 작업은 3/7(금) 진행되었고, 이슈는 3/10(월) 접수
> 변경한 인사 연동 설정(pnp_accountsync.properties)은 아래와 같으며, 인사 연동은 DB 연동으로 되어있어 이번 이슈와는 크게 영향이 없을 것으로 판단됨
UseReferenceTable = yes
ExtraCondition = reserved1
SpecialValue = Y
DeletedAccountSynvcType = 3
ConditionalAccountSyncType = 3
- 동일한 설정(인사연동 및 LDAP 인증)이 적용된 다른 계정은 정상적으로 접속이 잘 되는 상태
로그인 실패 시 발생하는 메시지
동일한 설정이 적용된 계정임에도 일부 사용자에게서만 로그인 에러 발생
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- saferuas.log 확인 시, 로그인 실패하는 계정에 대해 NamingException 발생하고 있음
3. 특이사항 (연동 모듈, 커스텀 개발 등)
4. 사내 재현 정보
5. 요청사항
- NamingException 발생하는 원인 확인 요청드립니다.
- 추가로, AD인증서버 389통신 관련 도메인네임 LDAP 호출인지 IP 고정인지 확인 부탁드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
- 로그인 실패 시 saferuas.log 디버그 로그
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
- saferuas.war.hyundaiautoever.1.6.1_202407311041.tgz
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
첨부파일
현대오토에버_saferuas
.log
null
파일 다운로드","김영은: 1. NamingException 오류는 고객사 인프라 이슈로 인해 발생된 문제로 확인됩니다.
> 엔지니어 페이지의 LDAP 접속정보에 기입된 IP가 변경되어 발생한 이슈로 확인됩니다.(도메인에 매핑된 IP가 변경됨)

2. LDAP 인증은 설정된 IP를 기준으로 인증 시도하는 것으로 확인됩니다.(도메인에 매핑된 IP로 LDAP 호출은 지원하지 않음)
> 예를 들어, IP가 192.168.111.2 및 192.168.111.3이고, DNS가 test.com으로 설정된 경우,
> ldap://192.168.111.2:389 및 ldap://192.168.111.3:389로 username@test.com / user password를 사용하여 인증을 시도하게 됩니다.",https://cafe.naver.com/pnpsecure2/7075
7061,[TIP] 계정 유효기간 만료 알림 팝업 메세지 깨짐 현상 발생 시 해결 방법,"[요약]
- 계정 유효기간 만료 알림 팝업 메세지 깨짐 현상 발생 시
pnp_oms_dms.conf 에서 LOGOUT_EXPIRED_ACCOUNT_POPUP_MESSAGE 설정 추가 후 latin1 언어로 문구 삽입하여 해당 현상을 해결할 수 있습니다.
> 설정 변경 방법은 pnp_oms_dms.conf를 windows로 옮긴 후 한글로 문구 추가 후 업로드 진행하여야 합니다.
추가로, 해당 설정은 일반 pnp_oms_dms.conf 설정에서는 설정 부분 없이 디폴트로 설정이 되어 있으나, 고객사에서 동일한 현상이 발생할 경우 설정을 추가하여 해결이 가능합니다.
[현상 확인]
1. DBSAFER AGENT 계정 유효기간 만료 알림 팝업이 깨져서 나타나는 현상
팝업 메시지 글자 깨짐 현상 발생 예시
[해결 방법]
1. pnp_oms_dms.conf를 windows로 옮긴 후 설정 변경 진행.
(vi 환경에서 캐릭터 셋이 latin1으로 설정되어 있어도 한글 작성 시 글자가 깨져 작성됩니다.)
> 설정 변경 시 메모장(notepad), nopad++ 두 가지 모두 적용이 되어 기호에 맞게 사용하면 됩니다.
pnp_oms_dms.conf 수정 화면
2. 설정 변경을 마친 pnp_oms_dms.conf 파일을 DBSAFER 서버에 업로드합니다.
(작업 시 pnp_oms_dms restart가 필요합니다.)
팝업 메시지 글자 깨짐 현상 해결 화면 예시
추가로, 해당 기능을 사용하면 팝업 메시지 문구 수정이 가능합니다.
(엔터는 \n를 삽입하여 설정)
문구 수정 설정 예시 화면
문구 수정 예시 화면
이상입니다.
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/7061
7043,[공유] Enterprise Manager7 서비스 세션 대기 시간 일괄 변경 방법 공유,"안녕하세요
클라우드기술팀 손혁진입니다.
카카오페이 고객사에서 사용된 Enterprise Manager 서비스 세션 대기 시간 일괄 변경 기능에 대해 공유 드리겠습니다.
테스트 환경
- OS : Rocky8
- DBSAFER : V7.0
- Enterprise Manager : 7.0.0.2A (Build-3332)
[요약]
- 고객사에서 감사 중 서비스 세션 대기 시간이 길다는 지적으로 기존 설정된 세션 대기 시간을 줄여야 되는 상황 발생
- 고객사에서 사용하고 있는 서비스는 DBMS,FTP,TERMINAL 포함 전체 1500대 이상 사용중
- 고객사에서 서비스 하나씩 세션 대기 시간을 수정 할 수 없어 일괄로 변경 할 수 있는 기능에 대해 기능 추가 요청
- 서비스 삭제 후 엑셀 일괄로 밀어 넣는 방식 사용시 기존 서비스의 idx가 틀려 질 수 있는 상황 발생
>>>> ""요약"" 상황을 고려하여 Enterprise Manager 서비스 > 세션 대기 시간 설정 값을 일괄로 변경 할 수 있도록 기능 추가
[설정 방법]
1. Enterprise Manager 7.0.0.2A (Build-3332) 이상으로 설치
2. 객체 관리 > 서비스 > 일괄변경 할 서비스 유형(DBMS, FTP, TERMIMAL) 클릭
3. 서비스 전체 정지 및 변경 대상 선택 후 우클릭 시 ""세션 대기 시간 설정"" 가능
. 기존과 동일하게 세션 대기 시간 변경 적용은 서비스 정지 상태에서만 가능합니다.
선택된 모든 서비스 대상으로 기존 세션 대기 시간 120분에서 60분으로 변경 시도
[결과]
1. 세션 대기 시간 일괄 변경 정상 확인 완료
선택된 모든 서비스 대상으로 기존 세션 대기 시간 120분에서 60분으로 변경 완료
PS.
- 일괄 설정 가능하며, 세션 대기 시간 불가한 상태나 서비스 타입일 경우에는 스킵처리
- 기존 세션 대기 시간과 동일할 경우에도 수정대상에서 제외
관련 벅스
BUGS : https://bugs.pnpsecure.com/view.php?id=30199",댓글 없음,https://cafe.naver.com/pnpsecure2/7043
7037,GPT를 활용한 네트워크 트래픽 분석(python + Tshark) - 01,"안녕하세요.
채널지원팀 김 건입니다.
1. 들어가며
파트너사 기술 지원을 하다 보면 네트워크 속도나 통신 관련 이슈가 발생할 때가 종종 있습니다.. 이런 경우 tcpdump를 이용한 패킷 덤프를 전달받지만, Wireshark로 열어봐도 정확히 어떤 문제가 있는지 파악하기 어려울 때가 많습니다. 특히 통신이 정상적으로 이루어지고 있는지, 패킷 손실이나 지연이 발생하고 있는지 판단하는 것이 쉽지 않습니다.
본 게시글에서는 GPT를 활용한 Python과 TShark을 결합한 네트워크 트래픽 분석했던 내용을 공유 드립니다.
2. Python 와 Wireshark의 결합
2.1 TShark란 무엇인가?
TShark는 Wireshark의 CLI(명령줄 인터페이스) 버전으로, 네트워크 패킷을 캡처하고 분석하는 강력한 도구입니다. GUI 환경 없이 터미널에서 네트워크 트래픽을 분석할 수 있으며, 필터링, 디코딩, 프로토콜 분석 등 다양한 기능을 제공합니다.
2.2 Wireshark와 Python의 연계
Wireshark는 GUI 기반으로 패킷을 분석할 때 유용하지만, 자동화된 분석을 위해 Python과 결합하여 활용할 수 있습니다. 이를 위해 PyShark를 사용하면 Wireshark의 강력한 디코딩 엔진을 Python 환경에서 실행할 수 있습니다. 이를 통해 자동화된 네트워크 트래픽 분석 코드를 실행해보았습니다.
3. PyShark을 활용한 네트워크 트래픽 분석
3.1 사내 테스트 환경 정보(Windows)
- Python 3.12.7 (최신 버전 권장)
- Wireshark 및 TShark (패킷 캡처 및 분석 도구)
> wireshark 최초 설치 시, Tshark 옵션 체크 필수
- PyShark 라이브러리 (pip install pyshark)
> 설치가 안 될 경우, visual studio 에서 C++ 개발 도구 설치 필요
- Pandas 라이브러리 (pip install pandas) – 데이터 처리 및 저장용
- Excel 또는 CSV 뷰어 – 분석 결과 확인용
- 패킷 캡처 파일(.pcap, .pcapng) – 분석할 네트워크 데이터
3.2 주요 분석 요소
- 패킷 재전송률
- 중복 ACK 개수
- TCP 세그먼트 손실률
- RTT(Round Trip Time)
- 패킷 손실률
3.3 테스트 파일
- 테스트 파일은 OK몰 DBSAFER IM 웹 느림 이슈사항을 참고하였습니다. 자료 사용을 허락해주신 전준호 대리님 감사 드립니다.
> URL : https://cafe.naver.com/pnpsecure2/7023
cafe.naver.com
cafe.naver.com
4. 작성된 python 코드
import pyshark
import pandas as pd
import json
# [파일 경로 설정]
user_pcap_path = ""C:\\Users\\gkim\\Downloads\\im_slow_user.pcap""
server_pcap_path = ""C:\\Users\\gkim\\Downloads\\im_slow_server.pcap""
# [필터링할 클라이언트 & 서버 IP 설정]
client_ip = ""172.17.0.181"" # 클라이언트 IP
server_ip = ""10.10.100.22"" # 서버 IP
print(""\n[1/6] 사용자 & 서버 PCAP 파일 로드 중 (IP 필터 적용)..."")
# [IP 필터 적용하여 패킷 로드]
user_pcap = pyshark.FileCapture(user_pcap_path, display_filter=f""(ip.src == {client_ip} && ip.dst == {server_ip}) && tcp"")
server_pcap = pyshark.FileCapture(server_pcap_path, display_filter=f""(ip.src == {server_ip} && ip.dst == {client_ip}) && tcp"")
print("" IP 필터 적용 완료! (클라이언트 ↔ 서버 패킷만 분석)"")
# [패킷 개수 확인]
user_packet_count = sum(1 for _ in user_pcap)
server_packet_count = sum(1 for _ in server_pcap)
print(f"" 사용자 패킷 개수: {user_packet_count}"")
print(f"" 서버 패킷 개수: {server_packet_count}"")
# [TCP 패킷 필터링]
print(""\n [2/6] TCP 패킷 필터링 중..."")
user_tcp_packets = list(user_pcap)
server_tcp_packets = list(server_pcap)
# [TCP 패킷 개수 확인]
user_tcp_count = len(user_tcp_packets)
server_tcp_count = len(server_tcp_packets)
print(f"" 사용자 TCP 패킷 개수: {user_tcp_count}"")
print(f"" 서버 TCP 패킷 개수: {server_tcp_count}"")
# [TCP 재전송 및 중복 ACK 분석]
print(""\n [3/6] TCP 재전송 및 중복 ACK 분석 중..."")
user_retransmissions = sum(1 for pkt in user_tcp_packets if hasattr(pkt.tcp, 'analysis_retransmission'))
server_retransmissions = sum(1 for pkt in server_tcp_packets if hasattr(pkt.tcp, 'analysis_retransmission'))
user_dup_acks = sum(1 for pkt in user_tcp_packets if hasattr(pkt.tcp, 'analysis_duplicate_ack'))
server_dup_acks = sum(1 for pkt in server_tcp_packets if hasattr(pkt.tcp, 'analysis_duplicate_ack'))
# [패킷 손실률 (%) 계산]
user_loss_rate = (user_retransmissions / user_tcp_count) * 100 if user_tcp_count else None
server_loss_rate = (server_retransmissions / server_tcp_count) * 100 if server_tcp_count else None
# [TCP 세그먼트 손실 분석]
user_lost_segments = sum(1 for pkt in user_tcp_packets if hasattr(pkt.tcp, 'analysis_lost_segment'))
server_lost_segments = sum(1 for pkt in server_tcp_packets if hasattr(pkt.tcp, 'analysis_lost_segment'))
# [RTT 분석]
user_rtt_values = [float(pkt.tcp.analysis_ack_rtt) for pkt in user_tcp_packets if hasattr(pkt.tcp, 'analysis_ack_rtt')]
server_rtt_values = [float(pkt.tcp.analysis_ack_rtt) for pkt in server_tcp_packets if hasattr(pkt.tcp, 'analysis_ack_rtt')]
user_avg_rtt = sum(user_rtt_values) / len(user_rtt_values) if user_rtt_values else None
server_avg_rtt = sum(server_rtt_values) / len(server_rtt_values) if server_rtt_values else None
# [네트워크 품질 평가]
def evaluate_network_quality(loss_rate):
if loss_rate is None:
return ""데이터 없음""
elif loss_rate < 1:
return ""좋음""
elif loss_rate < 5:
return ""보통""
elif loss_rate < 10:
return ""주의""
else:
return ""심각 (패킷 손실 문제 있음!)""
user_network_quality = evaluate_network_quality(user_loss_rate)
server_network_quality = evaluate_network_quality(server_loss_rate)
print(f"" 사용자 TCP 재전송 패킷: {user_retransmissions}"")
print(f"" 서버 TCP 재전송 패킷: {server_retransmissions}"")
print(f"" 사용자 중복 ACK 개수: {user_dup_acks}"")
print(f"" 서버 중복 ACK 개수: {server_dup_acks}"")
print(f"" 사용자 TCP 세그먼트 손실: {user_lost_segments}"")
print(f"" 서버 TCP 세그먼트 손실: {server_lost_segments}"")
print(f"" 사용자 평균 RTT: {user_avg_rtt:.6f} 초"")
print(f"" 서버 평균 RTT: {server_avg_rtt:.6f} 초"")
print(f"" 사용자 패킷 손실률: {user_loss_rate:.2f}% ({user_network_quality})"")
print(f"" 서버 패킷 손실률: {server_loss_rate:.2f}% ({server_network_quality})"")
# [결과 저장]
packet_analysis_result = {
""Client IP"": client_ip,
""Server IP"": server_ip,
""User Packet Count"": user_packet_count,
""Server Packet Count"": server_packet_count,
""User TCP Packet Count"": user_tcp_count,
""Server TCP Packet Count"": server_tcp_count,
""User Retransmissions"": user_retransmissions,
""Server Retransmissions"": server_retransmissions,
""User Duplicate ACKs"": user_dup_acks,
""Server Duplicate ACKs"": server_dup_acks,
""User Lost Segments"": user_lost_segments,
""Server Lost Segments"": server_lost_segments,
""User Avg RTT (s)"": user_avg_rtt,
""Server Avg RTT (s)"": server_avg_rtt,
""User Packet Loss Rate (%)"": user_loss_rate,
""Server Packet Loss Rate (%)"": server_loss_rate,
""User Network Quality"": user_network_quality,
""Server Network Quality"": server_network_quality
}
# [결과 출력]
print(""\n [4/6] 패킷 분석 결과"")
print(packet_analysis_result)
# [DataFrame 변환 및 저장]
df = pd.DataFrame([packet_analysis_result])
df.to_excel(""packet_analysis_enhanced.xlsx"", index=False)
print(""\n 파일 저장 완료"")
print(""\n [6/6] 모든 분석이 완료되었습니다! "")
5. 코드 실행 결과
실행 결과 값
5.1 패킷 분석 결과 정렬
{
""Client IP"": ""172.17.0.181"",
""Server IP"": ""10.10.100.22"",
""User Packet Count"": 6493,
""Server Packet Count"": 11042,
""User TCP Packet Count"": 6493,
""Server TCP Packet Count"": 11042,
""User Retransmissions"": 3151,
""Server Retransmissions"": 214,
""User Duplicate ACKs"": 0,
""Server Duplicate ACKs"": 8063,
""User Lost Segments"": 507,
""Server Lost Segments"": 0,
""User Avg RTT (s)"": 0.0045181625766871165,
""Server Avg RTT (s)"": 2.143694543771693,
""User Packet Loss Rate (%)"": 48.529185276451564,
""Server Packet Loss Rate (%)"": 1.9380547002354647,
""User Network Quality"": ""심각 (패킷 손실 문제 있음!)"",
""Server Network Quality"": ""보통""
}
6. 결과 값 검증
- 계산식 제외, wireshark 필터로 걸었을 때, 동일한 결과 값을 받을 수 있었습니다.
항목
Wireshark 필터
사용자 TCP 재전송 패킷
ip.src == 172.17.0.181 && ip.dst == 10.10.100.22 && tcp.analysis.retransmission
서버 TCP 재전송 패킷
ip.src == 10.10.100.22 && ip.dst == 172.17.0.181 && tcp.analysis.retransmission
사용자 중복 ACK 개수
ip.src == 172.17.0.181 && ip.dst == 10.10.100.22 && tcp.analysis.duplicate_ack
서버 중복 ACK 개수
ip.src == 10.10.100.22 && ip.dst == 172.17.0.181 && tcp.analysis.duplicate_ack
사용자 TCP 세그먼트 손실
ip.src == 172.17.0.181 && ip.dst == 10.10.100.22 && tcp.analysis.lost_segment
서버 TCP 세그먼트 손실
ip.src == 10.10.100.22 && ip.dst == 172.17.0.181 && tcp.analysis.lost_segment
7. 결과 값 분석
7.1 GPT에게 이 결과 값으로 알 수 있는 내용 질의
- 해당 결과 값으로 GPT한테 분석을 맡기면 아래와 같은 답변을 받을 수 있습니다.
Q. 질문 내용 : 5.1 패킷 분석 결과를 보고 알 수 있는 사실에 대해서 알려줘
A. 답변 :
📌 해당 결과 값으로 알 수 있는 사실 정리
1️⃣ 사용자(Client) 네트워크 품질이 매우 나쁨 (패킷 손실율 48.53%)
사용자의 패킷 손실률이 48.53%로 매우 심각함.
→ 이는 사용자가 보낸 데이터가 대량으로 손실되고 있음을 의미
패킷 손실이 높을 경우 발생 가능한 문제:
웹페이지 로딩 지연
다운로드 속도 저하
TCP 연결 지연 및 끊김
온라인 게임, 원격 접속, VoIP 품질 저하
원인 가능성:
네트워크 장애 (Wi-Fi 신호 약함, 유선망 품질 문제)
사용자 측 라우터 또는 방화벽에서 패킷 드롭 발생
서버와의 네트워크 경로 중간에서 패킷 손실 (ISP 문제)
2️⃣ 서버(Server) 네트워크 품질은 보통 (패킷 손실률 1.94%)
서버 측 패킷 손실률이 1.94%로 다소 있지만, 정상적인 범위 내에 있음.
1~2% 정도의 손실은 과부하 시 허용 가능한 수준
서버 자체 문제보다는 사용자 측에서 패킷을 받지 못할 가능성이 높음
3️⃣ 사용자(Client) 측 TCP 재전송이 매우 많음 (3151개)
....................
....................
....................
너무 기네요 답변 내용은 아래의 pdf 파일 참고하시면 전체 내용을 확인하실 수 있습니다.
첨부파일
해당 결과 값으로 알 수 있는 사실 정리
.pdf
null
파일 다운로드
Q. 질문 내용 : 세줄로 요약해줘
A. 답변 :
1️⃣ 사용자(Client) 네트워크 상태가 매우 나쁘며, 패킷 손실률이 48.53%로 심각한 수준 → 네트워크 점검 필요
2️⃣ 서버(Server)는 정상적으로 응답하고 있으나, 사용자 측에서 패킷이 손실되어 재전송 및 중복 ACK가 다량 발생
3️⃣ 서버의 평균 RTT(2.14초)가 비정상적으로 높아 과부하 가능성 있음 → 서버 성능 점검도 필요
7.2 트래픽 분석 결과
1) 사용자의 네트워크 상태가 매우 나쁨.
- 패킷 손실률 48.53% → TCP 세션 유지 어려움
- 사용자 측 네트워크 품질 개선 필요 (네트워크 점검 필요!)
2) 서버는 정상적으로 데이터를 보내고 있지만, 사용자 측에서 데이터가 손실됨.
- 서버 패킷 손실률 1.94%는 큰 문제 아님
- 그러나 서버의 평균 RTT(2.14초)는 비정상적
3) 사용자 측 네트워크 장애 가능성 높음.
- Wi-Fi 문제, 유선 네트워크 장애, 방화벽 설정 확인 필요
- 네트워크 장비 (라우터, 스위치, 방화벽) 점검 필요
4) 서버 성능 문제 가능성도 고려해야 함.
- 서버 응답 속도(RTT) 2초 이상 → 과부하 가능성 있음
- 서버 로드 상태 점검 필요 (CPU, 메모리, 네트워크 I/O 확인)
→ 사용자 네트워크 문제 해결 후에도 문제가 지속되면 서버 측 문제를 추가 분석해야 함.
8. 마치며
GPT를 사용하여 어지럽고 긴 패킷 덤프 파일을 한 번에 정리, 네트워크 트래픽을 분석했던 사례를 공유 드립니다.
코드는 GPT 자체에 내장되어 있는 패킷 덤프 분석 코드를 제 PC에 실행시켜 확인한 결과 값입니다.
GPT에는 패킷 덤프 분석 코드를 짤 수 있는 기능은 있지만, pyshark, scapy와 같은 패킷 덤프를 읽을 수 있는 라이브러리 설치 시, 라이브러리 설치 에러가 발생합니다.
물론 이 분석된 내용이 정확하다고는 장담할 수는 없고, GPT 또한 만능이 아닙니다. 참고할만한 결과를 얻을 수 있었다고 생각합니다.
""이런 사용 방법도 있구나"" 참고하시면 좋을 것 같아 공유 드립니다.","스텝: 좋은 글 공유해 주셨네요. 감사드립니다.

잘 알고 계시겠지만
ChatGPT teams를 제외한 외부 생성형 AI에 고객사 트래픽을 분석시키면 안됩니다.
고객 정보가 우리도 모르게 외부에 노출될 수 있기 때문입니다.",https://cafe.naver.com/pnpsecure2/7037
7034,[SK이노베이션]CouchbaseDB지원 문의,"[FAQ분류] (에러로그문의 / 기능로직문의 / 기타문의)
[고객사/채널사]
SK이노베이션
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
3. 특이사항 (연동 모듈, 커스텀 개발 등)
4. 사내 재현 정보
5. 요청사항
Couchbase DB지원 가능여부에 대하여 문의하였습니다
현재 지원하지 않고 있다면 앞으로 지원계획이 있는지 확인요청 부탁드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","김하림: 'No-SQL Proxy 엔진 서비스' 베타 버전으로 지원 가능할 것으로 보입니다.
다만, 현재 베타 버전으로 사이트 지원 필요한 경우 QA 및 연구소에 내용 전달 부탁드리겠습니다.

카페 공지 > https://cafe.naver.com/pnpsecure2/7038
BBS > https://bbs.pnpsecure.com/showthread.php?tid=14428 | 여성구: 머릿글 없습니다.",https://cafe.naver.com/pnpsecure2/7034
7019,[TIP] SFTP 접속시 한글파일명 깨짐현상에 따른 조치사항,"[고객문의]
대상서버에 접속해서 파일명을 확인해 봤는데, 파일명이 깨져 나오고 다운로드도 안됩니다.
- WINSCP 기준 오류메시지 : Copying files from remote side failed.
[증상]
SFTP 접속시 대상서버의 한글파일명이 깨지는 현상이 발생할 경우 아래와 같이 설정하여 확인한다.
[조치사항]
고급 - 파일이름을 UTF-8 인코딩: 사용, 영문일경우 on",댓글 없음,https://cafe.naver.com/pnpsecure2/7019
7015,[공유] pnp_sshd 사용 환경에서 'no matching mac found'에 의한 라우터 장비 SSH 접속 불가 현상,"1. 고객사명
- 신세계
2. 버전
- pnp_sshd_2.30.195
- ssh_p6 2.32.92
3. 현상
- 라우터 장비 OS 업그레이드 이후부터 DBSAFER를 통한 라우터 장비 SSH 접속 불가 발생(총 2대)
- 접속 실패 간 Terminal 서비스 로그 상에는 아무 로그가 기록되지 않음
4. 확인 내용
- 아래와 같이 no matching mac found 발생 확인
[root@scsic-ifac-gw2 dbsafer]# ./ssh -p22 test@[서버IP]
no matching mac found: client hmac-sha2-256,hmac-sha2-512,hmac-sha1,hmac-md5
server hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com
- pnp_telnet 로그에서 connection refused(111) 확인
[2025-02-13 15:14:00] [167247] [ERROR][ERROR_0606001] Cannot connect to the server.
: IP:Port=10.100.25.193:22 ** Connection refused(111)
5. 원인
- 라우터 장비가 사용하는 mac 알고리즘을 pnp_sshd, ssh_p6 에서 정상적으로 처리하지 못하여 발생
>> 라우터 장비에서 hmac-sha2-256-etm@openssh.com, hmac-sha2-512-etm@openssh.com 알고리즘을 요구
6. 조치
- GW서버에서 /dbsafer/.conf/ssh_config_[서버IP].conf 파일을 생성하고 MAC 알고리즘 내용을 아래와 같이 기재
MACs hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha2-256,hmac-sha2-512,hmac-sha1,hmac-md5
- 이후 SSH 접속 시 접속/로깅 정상
pnp_ssh_proxy 모듈 사용 환경의 경우 아래 사유로 인해 이슈가 발생하지 않습니다.
pnp_sshd/ssh 사용 시에는 대상서버 접속 시 일부 알고리즘만 하드코딩으로 제한하고, 이외의 설정들은 별도 설정파일로 지정하여야 함
반대로, pnp_ssh_proxy 사용 시에는 대상서버 접속 구간에는 모든 사용 가능한 알고리즘들을 허용 가능한 상태로 두고, 일부 알고리즘 제한이 필요한 경우에 사용할 알고리즘들만 별도 설정(/usr/local/etc/ssh_proxy_config)을 통해 지정",댓글 없음,https://cafe.naver.com/pnpsecure2/7015
7011,[TIP] DBSAFER v7.0에서 2-factor 기능을 DBSafer Assist 와 IM에서 동시에 쓰는 방법,"[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
dbsafer agent 통해서는 2-factor 잘 되지만, dbsafer im 자동 접속 통해서는 2-factor가 OTP 창이 출력되지 않고 차단 발생
로그상 Web Assist 접속 계정에 대하여 OTP 창이 출력되지 않고 접속 시도시 바로 차단되는 현상 발생
재생
8
00:30
[교보AXA자산운용] DBSAFER IM 사용시 2-Factor 관련 문
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
dbsafer 매니저에서 2-factor 정책 설정, dbsafer im에서 saferuas 관련 설정 확인
Next image
3. 특이사항 (연동 모듈, 커스텀 개발 등)
dbsafer im 2-factor 사용자는 무조건 '관리자 권한(부)'가 필요함
4. 사내 재현 정보
5. 요청사항
dbsafer agent, dbsafer im 두개 다 2-factor가 OTP 창이 출력되어야 합니다. 확인 요청 드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
PC-ASSIST : 3.2.36.0
DBSAFER IM : 1.6.2.47a
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","이건국: IM 자동접속 시 2-factor 인증을 하고자한다면, PC Assist와는 조금 다르게 기능을 적용해야합니다.
PC Assist의 경우 DBSAFER DB/AM 정책에 의해 2-factor 인증 팝업이 발생하나,
IM은 자체 2-factor 설정을 추가적으로 진행해주어야합니다. (pnp_userauth 모듈 필요없음)

설정은 아래 가이드 문서를 참고해주시기 바랍니다.
IM 기술 매뉴얼 > 환경설정(CONFIG) > 자동 접속 설정 > 2-factor 인증 장비 설정
https://sites.google.com/pnpsecure.com/engineer-manual/%EB%A7%A4%EB%89%B4%EC%96%BC/%EA%B3%84%EC%A0%95%EA%B4%80%EB%A6%AC/im-%EB%A7%A4%EB%89%B4%EC%96%BC/%ED%99%98%EA%B2%BD%EC%84%A4%EC%A0%95-config#h.79f2sidnrh9a | 황재필: 안녕하세요. 이건국 대리님.

본문 ‘특이사항’에 작성하였듯이
해당 사용자는 IM에서 최고관리자(부)로 지정되어있어 2-factor 서버 설정 사용이 불가합니다.

추가로, 보안정책 2-factor 설정시 dbsafer im에서의 2-factor 설정과 별개로 자동접속은 사용이 불가합니다.

보안정책의 2-factor 설정을 제외할 수 없다면
접속제어정책에서 dbsafer im 자동접속은 어떤 기준으로 예외처리를 할 수 있을까요? | 이건국: IM에서 계정사용권한을 부여한다면, 접속제어정책에서 차단정책 혹은 2-factor정책 상단에 WORKS 연동정책 (구 IMUP 연동정책)을 생성하시면 됩니다.
그런데 답글해주신 내용에 대해 문의사항이 있습니다.

1) 최고관리자(부)로 지정되어있어 2-factor 서버 설정 사용이 불가하다고 말씀하신 이유는 무엇인가요?
최고관리자(부)도 2-factor 서버 설정 사용이 가능합니다.

2) 보안정책 2-factor 설정시 자동접속은 사용이 불가한 이유는 무엇인가요? | 황재필: 1) https://m.cafe.naver.com/pnpsecure2/5966 
해당 카페글의 댓글에 보면 최고관리자는 2-factor 사용이 불가하다고 하셨는데 최고관리자(부)는 관계없이 2-factor 지정 가능하다는 말씀이실까요?
해당 설정 재확인 해보겠습니다.

2) 매니저 접속제어 정책에서 2-factor 설정이 있을경우 im 2-factor 설정과 관계없이 본문에 첨부된 동영상처럼 자동접속시에 otp창이 미출력되며 바로 차단 동작을 합니다.

가이드 주신 것처럼 dbsafer v7.0 기준 접속제어 정책에서 접속유형 옵션이 있는지 확인 후 접속유형으로 예외처리를 해보겠습니다. | 이건국: 1) 전달해주신 글에서는 최고관리자(부)가 아닌, 엔지니어페이지에서 설정한 최고관리자(정)을 말씀드린것이었습니다.
혼란을 드려 죄송합니다.
최고관리자(정)과 (부)는 엄연히 다른 권한의 계정임을 참고해주시기 바랍니다.

2) 그렇다면 해당 차단은 어떤 차단 정책에 의해 차단되고 있나요?

추가적으로, IM 2-factor 인증 팝업은 해당 보안계정에 2차인증 설정도 추가적으로 되어있어야 합니다.
(가이드 본문에 설명이 빈약하여 참고차 말씀드립니다.) | 황재필: 1) 설정 후 테스트 해보겠습니다. 감사합니다.

2) 접속제어 2-factor 정책에 의해 차단 발생합니다.
보안계정 2차인증 OTP로 설정되어 있습니다. | 이건국: 접속제어 2-factor 정책에 의해 차단이 발생하는 것은 DBSAFER AM/DB의 2-factor 기능이 IM 자동접속에 대해서는 대응되지 않는 것이 원인인 것으로 예상됩니다.
2-factor 정책은 서비스데몬, userauth, pc assist가 상호 통신하며 수행되는데,
이와 달리 IM에서 자동접속을 할 때에는 userauth가 개입하지 않으며 2-factor 인증을 띄울 주체가 없기 때문에 IM 자체 2-factor를 사용해야하는 것으로 알고있습니다.

IM 자동접속과 PC Assist에서의 2-factor를 혼용하여 쓸 경우에는,
접속제어 2-factor 정책 상단에 WORKS 연동정책을 설정하고, 이 정책에서 접속유형을 WEB ASSIST로 지정해줘야합니다.
(웹에서 접속을 시도하는 것만 WORKS 연동정책을 태울 수 있도록) | 황재필: 자세한 설명 감사합니다.
말씀해주신 가이드대로 예외 처리 후 확인해보겠습니다. | 황재필: 안녕하세요. 이건국 대리님.

Enterprise Manager v7.0 환경에서 Terminal 접속제어 정책에 '접속 유형'으로 통제할 수 있는 기능이 없습니다.
해당 요건 확인 부탁드립니다. | 이건국: 이전 댓글에서 내용을 수정하였습니다. (접속유형으로 정책 생성 > WORKS연동정책 생성)
혼란을 드려 죄송합니다.",https://cafe.naver.com/pnpsecure2/7011
7010,[코리안리재보험] Athena 서비스 접근통제,"안녕하세요. 클라우드기술팀 이상민입니다.
코리안리재보험 Athena 서비스 접근통제를 위한 DBSAFER V7.0 구축 내역을 공유드립니다.
[구성도]
[v7.0 주요 모듈 버전]
- pnp_ssl_proxy (Rev 210 이상)
- pnp_dbms_gateway (Rev 2655 이상)
- pnp_nosql
. MAIN VERSION (Rev: 2740 이상)
. COMMON LIBRARY VERSION: 4116 이상
- pnp_agent (Rev.1290 이상)
. SHARED INTERFACE VERSION: 648 이상 (dbsafer_common Rev: 648이상)
- pnp_slave (Rev.186 이상)
. SHARED INTERFACE VERSION: 648 이상 (dbsafer_common Rev: 648이상)
- pnp_oms_dms (Rev 1145 이상)
. SHARED INTERFACE VERSION IN FO: 650 이상
- Enterprize Manager Build 3165 이상
- COMMON_UTIL_V2.38_build-1_20240430
[Athena DB 서비스 사용하기]
1) 매니저 > 시스템 설정 > 객체 설정 > 서비스 설정 > NoSQL 설정에서 Athena DB 사용으로 변경
(변경 후 Manager 재시작해야 서비스 추가 가능)
2) nosql_type_athena.json 다운로드
- 아래 경로에서 nosql_type_athena.json, nosql_type_athena_s3_json 2개 파일을 사용
. https://drive.google.com/drive/folders/1_Y3eP_9bedICRoZcutCxsAxXysVsdBcc
- DBSAFER 서버에서 파일 위치
. /dbsafer/.conf/nosql/nosql_type_athena.json
. /dbsafer/.conf/nosql/nosql_type_athena_s3.json
3) Athena 444, Glue 443 포트 서비스의 경우 ""범용 NOSQL DB 별 파싱 정보"" 폴더에서 nosql_type_athena.json을 사용
- 기본 Athena 설정으로 사용 (심볼릭 링크 생성 필요)
. ln -s nosql_type_athena.json nosql_type_1.json
※ nosql_type_1.json 파일명에서 1은 NoSQL 인덱스 1을 의미
4) Athena 443 포트 서비스 경우 ""범용 NOSQL DB 별 파싱 정보"" 폴더에서 nosql_type_athena_s3.json을 사용
- Athena 443 포트 서비스의 번호를 확인 후 사용 (심볼릭 링크 생성 필요)
. ln -s nosql_type_athena_s3.json nosql_type_1_{서비스번호}.json
※ Athena 서비스는 Athena 443, Athena 444, Glue 443 서비스 3개를 한 세트로 등록함
※ DBeaver를 통한 Athena 연결 후 SQL 실행 시 S3 정보는 Athena 443으로만 전달됨
※ S3 경로/명칭에 기반한 정책 적용을 위해 Athena 443에서만 nosql_type_athena_s3.json를 별도 사용
※ Athena 444, Glue 443은 nosql_type_athena.json을 사용함
5) pnp_aws_service 모듈 설치 및 구동
- IAM AccessKey, SecretKey 필요
. AmazonS3ReadOnlyAccess 권한 부여
[코리안리 Athena 사용 환경 특이점]
1) 금융권 내/외부 망분리 환경이기 때문에 사용자들은 Athena 서비스 도메인주소에 대한 ip를 lookup 할 수 없음
- Athena/Glue 도메인 주소
. athena.ap-northeast-2.amazonaws.com
. glue.ap-northeast-2.amazonaws.com
2) 모든 사용자 PC의 host 파일에 athena 도메인 주소에 대한 IP가 코리안리 내부 Proxy IP주소로 매핑되어 있었음
3) 따라서 DBSAFER에 Athena 서비스 등록 시 athena.ap-northeast-2.amazonaws.com 도메인 주소가 아닌 코리안리 내부 Proxy IP 주소로 등록함
4) 이 경우 사실상 pnp_aws_service 모듈 불필요함
[DBSAFER V7.0 도입 배경]
No
구분
문제점
개선 방안
1
임시자격증명의
번거로움
PRD 및 DEV 접근을 위해 임시자격증명을
발급받아야 하는 불편함
S3 경로 기반 명령어 통제 기능 제공하여
임시자격증명을 사용하지 않음
2
IAM Credential
관리 필요
Assume-Role을 사용을 위한 IAM
Credential 정보를 별도로 관리해야 함
임시자격증명 미사용에 따라 기본 IAM
Credential 관리를 하지 않음
3
정기자격증명의
비효율성
AWS에서는 보안 강화를 위해
정기자격증명의 사용을 권장하지 않음
DBSAFER 보안 계정을 통해 사용자를
식별하고 접근을 제어하고 로깅
4
CloudTrail
낮은 가독성
CloudTrail 로그는 가독성이 낮아 분석
및 모니터링이 어려움
CloudTrail 로그 대비 높은 가독성의
향상된 로깅 및 가시성 제공
5
명령어 통제
기능 부제
AWS Native 기능만으로는 Athena 서비스에 대한 세부적 SQL 통제 어려움
S3 경로 기반 세분화된 Athena의 SQL 명령어 통제 및 로깅 기능 제공
[DBSAFER 도입 전 Athena 서비스 사용 형태]
- AWS 임시자격증명(sts) 사용하고 있었음
- dev sts : 개발계데이터가 저장된 S3에 접근 가능한 Role 권한을 일시적으로 획득하는 행위
. 획득한 role name은 DBeaver Athena JDBC 드라이버의 AWS Credential Provider 프로필 명으로 정의
- prd sts : 운영계데이터가 저장된 S3에 접근 가능한 Role 권한을 일시적으로 획득하는 행위
. 획득한 role name은 DBeaver Athena JDBC 드라이버의 AWS Credential Provider 프로필 명으로 정의
- 상기 dev, prd 구분은 코리안리재보험의 기준이며, dev sts와 prd sts 2개의 임시자격증명 동시 사용은 불가능함
- 참고사항
. 임시자격증명의 반대는 정기자격증명으로 IAM AccessKey와 SecretKey를 사용하여 로그인
. IAM = 사용자, AccessKey = id, SecretKey = pw
. 임시자격증명 사용 시 AccessKey와 SecretKey를 입력하지 않으며, 획득한 Role의 프로필 명은 Athena JDBC 드라이버에서 AWS Credential Provider의 Value로 사용됨
. 사용자 -> DBeaver 실행 -> 임시자격증명을 통해 획득한 role의 프로필을 인증정보로 사용 > Athena 서비스 연결
[고객 요구사항]
- 임시자격증명 or 정기자격증명 관리를 배제하고 싶음
- DBSAFER의 사용자(보안계정)에 따라 개발계 데이터 S3, 운영계 데이터 S3 접근을 통제하고 로깅하기를 원 함
- 구체적이고 효율적인 방안은 피앤피시큐어에서 마련해주기를 원 함
. S3인스턴스 객체 등록 및 정책 조건 사용가능 하도록 개선 요청
> https://bugs.pnpsecure.com/view.php?id=29256
. S3 인스턴스 객체를 정책으로 사용할 수 있도록 매니저 수정
> https://bugs.pnpsecure.com/view.php?id=29460
. 범용 NoSQL 설정 사용시 서비스 번호별로 지정하는 기능 추가
> https://bugs.pnpsecure.com/view.php?id=29489
[DBSAFER Athena 권한 통제]
- DBeaver를 통해 Athena 서비스 연결된 이후 사용자가 명령어를 실행하면 S3 정보가 전달됨
- 따라서 S3 정보를 토대로 등록된 정책에 의거하여 명령어 실행을 통제할 수 있음
- Athena 서비스는 데이터 조회/분석을 주 목적으로 하는 쿼리 서비스이며,
통제 대상이 되는 실제 명령 유형에는 SELECT, INSERT, CREATE, DROP, ALTER 등이 해당됨
주요 항목
설명
정책명
Athena 서비스 권한제어정책 명
서비스명
Athena 443 서비스를 선택해서 지정
인스턴스
S3 또는 S3 그룹 지정
SQL 유형
SQL 유형 지정(Select Only, INSERT 등)
※ Athena 권한제어정책 관련 주의사항
1) 서비스 지정 시 Athena 443 서비스를 선택해야 함, Athena 444 또는 Glue 443 서비스에는 S3 정보가 전달되지 않음
(제약사항)
2) Athena 443 서비스 선택 후 인스턴스 항목에 S3 그룹을 지정할 수 있음
[기타]
- 멀티AZ 이중화 구조, 단독(Active)-단독(Standby) with AWS NLB
- V7.0 pnp_ha failover 발생 시 고객사 담당자의 메일주소에 알림메일 발송하는 스크립트를 cmd_failover.txt에 등록
- 온프레미스 DBSAFER V5.0과 AWS 환경 DBSAFER V7.0 동시 사용을 위한 SubAssist 기능 사용중
- 기존 DBSAFER Agent or NODESAFER Agent 프로그램 삭제 및 레지스트리 키 삭제, 신규 DBSAFER Agent 설치할 수 있도록 dbsafer_agent_koreanre.exe 배포(https://cafe.naver.com/pnpsecure2/6984)",댓글 없음,https://cafe.naver.com/pnpsecure2/7010
7004,[TIP] 서버 동작 Core 수 제한 관련 설정,"[개요]
특정 고객사에서 서버 동작 Core 수를 제한(12Core->8Core)하여 달라는 요청 관련 대응 방안으로 OS 상에서의 GRUB 설정 변경을 통한 적용입니다.
(참고로 R760xs 이후부터는 기본 CPU Core 수가 12Core 입니다)
[테스트 및 확인 환경]
> 서버 : Dell R760xs, xFusion V6(2288H)
> OS : Rocky 8.6, 8.10
[적용절차]
1) nano 편집으로 grub 파일 열기
# nano /etc/default/grub
2) GRUB_CMDLINE_LINUX 옵션 추가(해당 옵션 값에서 core 수 지정)
> ex) GRUB_CMDLINE_LINUX=""crashkernel=auto rhgb quiet nr_cpus=8""
3) GRUB 설정 업데이트
# grub2-mkconfig -o /boot/efi/EFI/rocky/grub.cfg
4) 적용(reboot)
5) 확인
> 기존(reboot 이전)
> 적용 후(reboot 이후)",댓글 없음,https://cafe.naver.com/pnpsecure2/7004
6985,[공유] 코리안리 Alteon L4 스위치 ssh 연결 실패 증상 조치,"안녕하세요. 이상민입니다.
코리안리재보험 고객사의 DBSAFER V5.0에 등록된 TERMINAL 서비스를 통해 Alteon L4 스위치 ssh 연결에 실패하던 증상에 대해 조치한 내용을 공유하여 드립니다.
[증상]
- DBSAFER를 경유하지 않으면 ssh 연결 및 접속 성공
- DBSAFER를 경유하면 ssh 연결 실패
[원인]
- 대상 Alteon L4 스위치의 KEX Algorithms은 diffie-hellman-group1-sha1 사용
- DBSAFER pnp_ssh_proxy(rev 308)은 기본적으로 상기 알고리즘을 사용하지 않음 (취약함)
- 로그
[조치]
※ https://docs.google.com/presentation/d/16RESYzygRr5eYZFfe78KYxGscdxf5FueGSNLUOZruqw/edit#slide=id.g2c61a61f66f_0_0 문서를 참고하여 KEX Algorithms 추가 (해당 문서 경로와 상세 가이드 해주신 박승민 대리님 감사합니다.)
1) DBSAFER 서버의 /etc/ssh/ssh_config 파일에서 KEXAlgorithms 파라미터를 선언하고 diffie-hellman-group1-sha1 값을 추가하였음
- 단, KEXAlgorithms 선언 자체가 안되어 있기 때문에 ""KEXAlgorithms diffie-hellman-group1-sha1"" 정의 시 diffie-hellman-group1-sha1 알고리즘만 사용하게 됨
2) 따라서 ssh_proxy 로그 상에서 확인된 KEXAlgorithms을 모두 추가하고 가장 마지막에 diffie-hellman-group1-sha1 을 추가해야 함
- vi /etc/ssh/ssh_config
# Host *
# ForwardAgent no
# ... 중략...
KEXAlgorithms curver25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp256,....중략....,deffie-hellman-group1-sha1
3) ssh_config의 KEXAlgorithms에 diffie-hellman-group1-sha1 선언 후 서비스(pnp_ssh_proxy) 재시작
4) putty > Connection > SSH > Kex > Algorithms selection policy > Diffie-Hellman-group 1 최상위로 UP 처리
[결과]
- ssh 연결 성공
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6985
6984,[공유] 코리안리재보험 DBSAFER Agent 삭제 안되는 증상 조치,"안녕하세요. 이상민입니다
코리안리재보험 고객사에서 확인된 DBSAFER Agent 삭제 실패 증상에 대해 조치한 내용을 공유 드립니다.
[삭제 배경]
1) 코리안리의 경우 온프레미스 환경의 DBSAFER V5.0과 AWS 환경의 DBSAFER V5.0을 운영중에 있었음
- DBSAFER Agent와 NODESAFER Agent 사용중
2) DBSAFER V7.0을 추가 도입한 상황으로 기존 DBSAFER Agent를 삭제하고, SubAssist 기능이 포함된 신규 DBSAFER Agent 재설치 진행하고자 함
[증상]
1) 기존 DBSAFER Agent 삭제를 해도 프로그램 추가/제거 패널에 DBSAFER Agent가 표시되며, 클린 삭제가 이루어지지 않음
2) 클린 삭제가 되지 않았기 때문에 재설치 또한 실패할 수 밖에 없음
[확인 사항]
1) 프로그램 추가/제거 패널에 표시되기 위해 저장된 레지스트리 키 확인
2) LOCAL_MACHIN 이하 경로의 키는 삭제되어 있음을 확인
- HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Uninstall\{78B7FE50-44ED-4056-9FC1-B3446FA12FAC}
3) CURRENT_USER 이하 경로에 키 남아 있음을 확인
- HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{78B7FE50-44ED-4056-9FC1-B3446FA12FAC}
4) 코리안리재보험 사용자들이 설치한 기존 DBSAFER Agent는 CURRENT_USER 경로에 레지스트리 키가 생성되어 있었음
- 관리자 권한으로 설치하지 않았을 것으로 추정되나, 현시점에선 해당 원인이 중요하지 않다고 판단
[임시 조치]
1) HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{78B7FE50-44ED-4056-9FC1-B3446FA12FAC} 수동 삭제 가이드
2) 이후 신규 DBSAFER Agent 관리자 권한으로 설치하도록 가이드
3) 재설치 성공 확인
[추가 조치]
0) 일반적으로 관리자 권한으로 DBSAFER Agent or NODEAFER Agent를 설치 시 CURRENT_USER 이하 경로에 레지스트리 키가 생성되지는 않음, 코리안리의 경우 예외적인 상황이었으며, 고객 편의를 위해 아래와 같은 조치를 제공
1) [PC Assist for Windows 0030019]: [코리안리재보험] DBSAFER Agent 설치 시 HKEY_CURRENT_USER uninstall 하위의 레지스트리 키 유무 체크 및 삭제 로직 추가 건의 (https://bugs.pnpsecure.com/view.php?id=30019)
2) 과거 PCAssist 자동 재설치 방안(https://cafe.naver.com/pnpsecure2/6776)을 활용하여 대응하도록 기존의 Bat 스크립트가 업데이트되었음
- 현재(업데이트 버전)
@echo off
pushd %~dp0
if exist ""C:\Program Files (x86)\PNPSECURE\DBSAFER AGENT\dsastlch.exe"" (
""C:\Program Files (x86)\PNPSECURE\DBSAFER AGENT\dsastlch.exe"" ""/runas"" ""%~dp0/dsastkill.exe"" | more
""DSASSIST.exe"" -uninstall -s -f1""%cd%\uninstall.iss"" | more
)
if exist ""C:\Program Files (x86)\PNPSECURE\NSAssist\nsastlch.exe"" (
""C:\Program Files (x86)\PNPSECURE\NSAssist\nsastlch.exe"" ""/runas"" ""%~dp0/nsastkill.exe"" | more
""NSAgtRemove.exe"" | more
)
reg delete ""HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{78B7FE50-44ED-4056-9FC1-B3446FA12FAC}"" /f
reg delete ""HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Uninstall\{78B7FE50-44ED-4056-9FC1-B3446FA12FAC}"" /f
reg delete ""HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{78B7FE50-44ED-4056-9FC1-B3446FA12FAC}"" /f
""DSASSIST.exe"" -s | more
goto DELETE
:DELETE
DEL /F /Q ""%~dp0UpdateWithOutConsole.vbs""
DEL /F /Q ""%~dp0dsastkill.exe""
DEL /F /Q ""%~dp0nsastkill.exe""
DEL /F /Q ""%~dp0NSAgtRemove.exe""
DEL /F /Q ""%~dp0uninstall.iss""
DEL /F /Q ""%~dp0dbsafer_agent_koreanre.exe""
DEL /F /Q ""%~dp0setup.log""
DEL /F /Q ""%~dp0DSASSIST.exe""
DEL /F /Q ""%~dp0UpdateList.bat""
- 과거
pushd %~dp0
""C:\Program Files (x86)\PNPSECURE\DBSAFER AGENT\dsastlch.exe"" ""/runas"" ""%~dp0/dsastkill.exe"" | more
""DSASSIST.exe"" -uninstall -s -f1""%cd%\uninstall.iss"" | more
""DSASSIST.exe"" | more
DEL /F /Q ""%~dp0UpdateWithOutConsole.vbs""
DEL /F /Q ""%~dp0dsastkill.exe""
DEL /F /Q ""%~dp0uninstall.iss""
DEL /F /Q ""%~dp0dbsafer_agent.exe""
DEL /F /Q ""%~dp0setup.log""
DEL /F /Q ""%~dp0DSASSIST.exe""
DEL /F /Q ""%~dp0UpdateList.bat""
3) dbsafer_agent_koreanre.exe (WinRAR 압축파일)
4) dbsafer_agent_koreanre.exe를 관리자 권한으로 실행 시 백그라운드로 기존 DBSAFER Agent or NODESAFER Agent 프로그램 삭제 및 레지스트리 키 삭제, 신규 DBSAFER Agent 설치됨
- DSASSIST는 코리안리재보험으로 배포하기 위해 빌드한 DBSAFER Agent setup.exe 파일을 rename한 파일
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6984
6980,"[TIP] MySQL 8.0 이상에서 caching_sha2_password 사용 시 DB Tools 접근 불가하고, mysql_native_password 사용시 정상 접근되는 현상 문의","[FAQ분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
스마트로
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크
1) ""mysql_native_password"" plugin 방식 사용 시 DB Tools로 정상 접근되는 상황
2) ""caching_sha2_password"" plugin 방식 사용 시 DB Tools로 접근 불가능한 상황
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
3. 특이사항 (연동 모듈, 커스텀 개발 등)
4. 사내 재현 정보
5. 요청사항
1) ""caching_sha2_password"" plugin 방식으로 DB접근제어 지원 가능 여부 확인 요청드립니다.
2) 지원이 가능한 경우 어떤 설정을 해줘야 하는지 추가 문의드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
고객사 대상DB 버전 : MySQL 8.0.40
pnp_mysql 버전 :
root@dbsafer-log1:/dbsafer# ./pnp_mysql --version
MYSQL Release version 3.0.3 for RelR24.05-RockyLinux
MAIN VERSION 3.7 (20200101)(Rev: v2649)
ADDED OPTION STATUS: NONE
COMMON MAIN MODULE VERSION: 1.2.29
COMMON LIBRARY VERSION: 3982
COMMON POLICY MODULE VERSION: 1.2.19
COMMON AUDIT LOG MODULE VERSION: 1.1.02
COMMON FORMAL_QUERY MODULE VERSION: 1.1.0.1
COMMON CERTIFICATION MODULE VERSION: V3
COMMON 2FACTOR PROTOCOL : v2
SHARED INTERFACE VERSION: 638
MySQL PARSER MODULE VERSION(DBParser:MySQL): 1.0.3(3807:3920)
SQL SYNTAX PARSER MODULE VERSION: 1.3.3922
Pol/Log/Decide Build: POLICY-(105) LOG-(107) DECIDE-(8)
Service Session MAX: 13500 Session (Forks:30)(Sessions:450)
LastUpdate(compiled): Aug 1 2024
The latest update of the binary: Aug 1 2024
## Service Define FILE list
: (.conf/pnp_agent_ip.conf) is to get a IP Address of agent
: (.conf/local_policy.conf) is to get policies at local machine for perfo rmance enhancement
: (.conf/service_ip.conf) is MYSQL BIND IPADDRESS
: (.conf/natcertid.conf) is NAT Cert ID Service CONF FILE
: (.conf/ldap.conf) is LDAP SERVICE CONF FILE
: (.conf/mysql_max_session.conf) is SERVICE PACK/ALL SERVICE LIMITED (If error/SESSION 100 )OPTION
: +-- (.conf/mysql_max_session.confSERVICE-NUM) is MAX-SESSION Ext for Ex clude.
(.conf/mysql_max_session.conf) option must be make configure file ( .conf/mysql_max_session.conf)
: (.conf/login_try_audit.conf) is enable to save a login fail log. SERVER OPTION
option :
(NAT Authentification Option) ./pnp_mysql -nat-option [status|start|stop]
(LDAP Option) ./pnp_mysql -ldap-option [status|start|stop]
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","유현진: 1. 해당 MySQL 8.0.40 DB가 대상 DB인지 명시바랍니다.
2. pnp_mysql 버전등 추가적인 정보작성 부탁드립니다. | 김연수: 안녕하세요.

1. 해당 MySQL 8.0.40 DB가 대상 DB인지 명시바랍니다.
> 대상 DB 입니다. 게시글 수정 해두겠습니다.
2. pnp_mysql 버전등 추가적인 정보작성 부탁드립니다.
> 해당 모듈 버전도 추가해 두겠습니다. | 유현진: pc-assist 로그인을 하지 않는 경우에도 접속이 불가한지 확인 부탁드립니다.

추가적인 확인사항 전달드립니다.
접속계정 플러그인이 'caching_sha2_password' 로 설정되어있는 경우
Dbeaver 툴 기준으로 connection settings > Drive properties > allowpublickeyretrieval 설정이 false로 되어있을때
pc-Assist 로그인을 하지 않는 경우에도 접속이 불가한 현상을 확인하였습니다.

해당 설정이 True로 설정되는 경우 pc-Asisst 로그인 후에도 정상적인 접속 및 로깅을 확인하였습니다.

대상 DBMS 버전 : mysql 8.0.39
mysql 버전 : MYSQL Release version 3.0.3 for RelV7-R24.05-RockyLinux | 김태윤: 이와 유사한 사항이 있을 경우에 TP를 통해서 접속 가능 여부에 대해서 필히 올려 주기 바랍니다.
실제 툴 설정과 관련해서 TP로도 접속이 안되는 경우는 DBSAFER의 문제는 아닐 수 있습니다.

참고하세요. | 김연수: 빠르게 확인해주셔서 감사합니다.

확인해주신 내용들로 고객사 측으로 추가 확인 요청 드릴 수 있도록 하겠습니다.

감사합니다.",https://cafe.naver.com/pnpsecure2/6980
6968,[SK C&C] 3306포트 Cipher 취약 알고리즘 비활성화/제외 요청 문의,"[FAQ분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
SK C&C
[문의내용]
- 분석 툴에서 3306 에 대하여 조회되는 알고리즘의 항목을 변경할 수 있는지 문의 드립니다.
[요청사항]
TLS 1.2, 1.3의 Cipher Suites에 대해 취약 알고리즘 비활성화/제외 요청
[TLS v1.2, v1.3 환경의 안전한 알고리즘 정보]
환경
암호화 알고리즘
TLS v1.2
TLS_DHE_RSA_WITH_AES_128_CCM (dh 2048)
TLS_DHE_RSA_WITH_AES_128_GCM_SHA256 (dh 2048)
TLS_DHE_RSA_WITH_AES_256_CCM (dh 2048)
TLS_DHE_RSA_WITH_AES_256_GCM_SHA384 (dh 2048)
TLS_DHE_RSA_WITH_CHACHA20_POLY1305_SHA256 (dh 2048)
TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 (secp256r1)
TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 (secp256r1)
TLS_ECDHE_RSA_WITH_CHACHA20 POI Y130 SHA256 (secp256r1)
TLS v1.3
TLS_AKE_WITH_AES_128_CCM_SHA256 (ecdh_X25519)
TLS_AKE_WITH_AES_128_GCM_SHA256 (ecdh_X25519)
TLS_AKE_WITH_AES_128_GCM_SHA384 (ecdh_X25519)
TLS_AKE_WITH_CHACHA20_PLOY1305_SHA256 (ecdh_X25519)
감사합니다.","김태윤: MariaDB의 ciphers 알고리즘 설정 방법 아래의 내용 추가할 경우에 설정 가능합니다.
다만 관련해서 내부에서 확인 후 진행하시기 바랍니다.

/etc/my.cnf 파일에 아래의 내용 추가 후 mariadb 재 시작하면 반영됩니다.

# /etc/my.cnf 설정 정보
--------------------------------------------------------------------------------------------------------------------------------------
[mysqld]

tls-version = TLSv1.2,TLSv1.3
ssl_cipher = DHE-RSA-AES128-CCM:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-CCM:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-CHACHA20-POLY1305-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-",https://cafe.naver.com/pnpsecure2/6968
6960,[센트비] MongoDB Compass 를 통한 Document DB 접속 시 로직 관련하여 문의 드립니다.,"[FAQ분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타 문의
[고객사/채널사]
센트비
[고객사 환경]
- DBSAFER 를 통하지 않고 접속 , Certificate Authority 에 pem 키 등록하여 DB 접속하는 방식 사용
(해당 pem 키는 AWS에서 제공하는 CA인증서 파일로 DocumentDB에서 SSL 연결을 할 때 사용)
-host_openssl.conf 에 DNS 추가 후 생성한 인증서 pnpsecure-rootca.crt 사용자 PC 에 설치 완료한 상황
[확인내용]
1. Certificate Authority 에 pem 키 등록할 때 현상
- 양방향 패킷은 확인되나 접속 불가
(ssl_proxy 디버그 확인이 추가적으로 있으면 좋을 것으로 판단되나 취합을 못한 상황으로
해당 내용은 필요 시 추후 첨부하도록 하겠습니다.)
2. Certificate Authority + tlsAllowInvalidCertificates 옵션 활성화
- 들어오는 패킷 없음
3. tlsAllowInvalidCertificates 옵션 활성화
- DBSAFER 를 통한 접속 및 로그 확인 가능
4. ssl_proxy 내에 AWS CA 인증서 설정 후 접속
- 설정하기 전과 동일한 현상 확인
[문의 내용]
1. 기존에 접속을 위해 사용한 CA 인증서를 사용하여도 DBSAFER 의 rootca.crt 를 설치하였으면 설정에 추가를 하지 않아도 되는지 확인 부탁드립니다.
> pnp_ssl_proxy 에서 암복호화를 대신 수행하는 구조가 맞는지에 대한 확인
2. CLIENT_PRIVATE_KEY 는 DBSAFER <> Target 구간에서 사용하는 개인키로 알고 있는데, 해당 고객사와 같은 환경에서 사용하는 것이 아닌지와 그게 아니라면 어떤 상황에서 사용하는 것인지 확인 부탁드립니다.
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
MongoDB Compass
version 1.45.1
[root@ip-172-27-10-252 dbsafer]# ./pnp_ssl_proxy
SSL_PROXY Release (Rev 175) Dec 18 2023 11:50:59s
( SHARED INTERFACE VERSION INFO: Rev.566 )
( COMMON-API(UTIL) INFO: Rev.193 )
[root@ip-172-27-10-252 dbsafer]# ./pnp_mongodb --version
Mongodb Release version 3.0.3 for RelR22.05C-CentOS7
MAIN VERSION 3.7 (20150812)(Rev: v2195)
ADDED OPTION STATUS: NONE
COMMON MAIN MODULE VERSION: 1.2.29
COMMON LIBRARY VERSION: 3568
COMMON POLICY MODULE VERSION: 1.2.19
COMMON AUDIT LOG MODULE VERSION: 1.1.02
COMMON FORMAL_QUERY MODULE VERSION: 1.1.0.1
COMMON CERTIFICATION MODULE VERSION: V3
COMMON 2FACTOR PROTOCOL : v2
SHARED INTERFACE VERSION: 512
MONGODB PARSER MODULE VERSION(DBParser:mongodb): 1.0.0(3516:TODO)
SQL SYNTAX PARSER MODULE VERSION: 1.3.3545
Pol/Log/Decide Build: POLICY-(105) LOG-(107) DECIDE-(8)
Service Session MAX: 13500 Session (Forks:30)(Sessions:450)
LastUpdate(compiled): Jun 29 2022
The latest update of the binary: Jun 29 2022
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
첨부파일
mongocap
.zip
null
파일 다운로드
1) tlsAllowInvalidCertificates 옵션 활성화 후 접속 패킷
tlsAllowInvalidCertificates.pcap
DBS_to_Server_TlsAllow.pcap
2) Certificate Authority 설정 내에 AWS DocumentDB pem 등록한 뒤 접속 패킷
ServerAuthority.pcap
DBS_to_Server_Certificate.pcap
3) pnp_ssl_proxy.conf의 CLIENT_PRIVATE_KEY 옵션 추가한 후 각각 옵션 값 설정했을 때의 접속 패킷
addconfig_ServerAuthority.pcap
addconfig_tlsAllowInvalidCertificates.pcap
이상입니다.
감사합니다.","박승민: 기존에 사용하던 ""Ceritificat Authority""는 사용자<>대상서버 TLS 연결 시 상호 인증서 검증을 위해 사용하는 것으로 보입니다.

DBSAFER pnp_ssl_proxy를 사용할 경우, pnp_ssl_proxy<>대상서버 TLS 연결 시 해당 과정을 수행하도록 설정해줘야 합니다.
관련 설정은 다음과 같습니다.
#CLIENT_PUBLIC_KEY = (1) /dbsafer/cert/public_azure.crt
#CLIENT_PRIVATE_KEY = (1) /dbsafer/cert/private_azure.key

이때, 기존 클라이언트에서 사용하던 .pem 파일은 pnp_ssl_proxy에서 지원하지 않는 형식입니다. .pem 파일을 .key 파일과 .crt 파일로 변환 또는 추출을 해줘야 합니다.
추출 과정은 온라인에 많이 검색되니 유사한 글들을 찾아보시면 될 것 같습니다.
- 참고: https://hreeman.tistory.com/m/171
얻어낸 .key, .",https://cafe.naver.com/pnpsecure2/6960
6946,[TIP] In-Place upgrade 이후 DBSAFER PKG 재설치,"[개요]
In-Place OS upgrade 완료 후 DBSAFER PKG 재설치가 필요한 상황에 대한 가이드를 제공
(단, 재설치는 기존 Cent7.x PKG 삭제 후 Rocky8.10 PKG 설치를 기준으로 함)
[작업절차]
1) upgrade.sh restore 실행
> el7용 MariaDB RPM 삭제 후 el8용 MariaDB RPM 설치
> OMSA el8용 설치
# cd /home/dbsafer
# ./upgrade.sh restore
2) 백업
> 백업대상: upgrade.sh
# cd /home/dbsafer
# cp upgrade.sh ../
3) 기존 설치 Cent7.x PKG 삭제
> 패키지 setup에서 uninstall 실행
4) Rocky8.10 PKG 설치
> PKG 내 RPM 설치 관련 설정 파일 수정 후 설치 진행해야 함
> 설정 파일 미 수정 후 설치 시 Perl 모듈 관련 에러 발생하며 PKG 설치되지 않음
> 수정이유: In-Place 업그레이드 과정에서 일부 Perl 모듈들을 자동으로 마이그레이션 하지 못하기 때문
> 수정방향: 설정 파일에서 Perl 모듈을 미설치로 변경(실제 DBSAFER에서는 Perl을 사용하지 않음)
> 수정 관련 아래 예시 참고
# cd ./PKG_DBSAFER7_RelV7-R24.05-RockyLinux_x86_64_20241227/rpm
# cp os_require_rpms os_require_rpms_bak
# sed -i 's/perl[^ ]* //g' os_require_rpms
# cd ../
# setup install
5) upgrade.sh delete 실행
> 미삭제된 el7용 rpm 삭제
> In-Place 업그레이드 관련 생성 디렉터리 삭제
# mv /home/upgrade.sh /home/dbsafer/upgrade.sh
# cd /home/dbsafer
# upgrade.sh delete
참고로 향후 위 관련 엔지니어 매뉴얼에 반영 예정입니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6946
6912,[CJ 올리브네트웍스] LB(VIP)접근 시 SNAT 되어 DB에 들어가는 경우 접근 제어 가능 여부 확인 요청,"[FAQ분류]
- 기능로직문의
[고객사/채널사]
- CJ 올리브네트웍스
[이슈내용]
1. 증상
[보안대상 서버 구성]
- 고객사 DBMS는 물리장비 RIP1, RIP2 / CLOUD LB(VIP)로 구성되어 있음
- 서버는 Active-Standby 구성
* Active : RIP, LB(VIP)
* Standby : RIP
- VIP가 실제 서버에 잡혀 있지 않고 CLOUD에 있는 구성 (사진 첨부 드립니다.)
> (**사진 내 IP는 예시 IP 입니다.)
- 위 사진과 같이 구성되어 있을 때, 사용자가 VIP(LB) 접속을 하게 되면,
SNAT되어 'DBMS 접속제어정책'이 아닌 Server Agent 정책을 타고 있는 상황입니다.
- LB 동작 방식 변경을 요청하여 여러 번 설정을 변경하며 테스트 해봤으나,
결론적으로, 고객사에서 LB 설정을 위와 같이 설정을 해야한다고 하는 상황입니다.
- DBSAFER의 경우 DB 최초 접속 패킷을 기반으로 정책 적용을 한다고 설명을 하여 어느정도 이해는 한 듯 하나,
고객사 네트워크 담당자가 타 사이트에서도 이런 환경이 있었을 것인데, 제어를 했던 히스토리가 있는지 확인 요청을 하여 문의 드립니다. (**해당 구성 불가 시 서버 내에 VIP를 할당 혹은 방화벽으로 제어해달라고 할 예정입니다.)
2. 요청사항
- 위와 같이 VIP 환경이 아닌 외부 LB에 VIP를 구성 한 환경에서 제어 가능한 방법 혹은 히스토리가 있는지 문의 드립니다 !
- 불가한 구성일 경우 불가한 이유만 조금 적어주시면 고객사에 잘 이해시키도록 하겠습니다. 감사합니다.
@@@@@@@@@@@@@@@@@@@@@@ 01/06 추가 내용 @@@@@@@@@@@@@@@@@@
- 위 사진을 보실 경우 RIP1, RIP2, VIP 서비스 객체가 다 등록되어 있으며,
고객사의 네트워크 환경이 VIP 접근 시 'RIP에서 RIP 접근 차단로그', 'RIP에서 VIP 접근 차단로그' 가 발생합니다.
고객사의 네트워크 구조가 위와 같이 이상하게 동작하여 현재 SA 제어를 따로 하고있지 못하는 상황에서 해결 방법이 있는지 궁금합니다 !","김태윤: 정확히 이해 했는지는 모르겠지만. 아래와 같이 회신 드립니다.

현재 서비스로 등록한 IP 또는 도메인 주소는 RIP만 등록한 것으로 보여집니다. LB(VIP)에 대해서 등록 후 확인 바랍니다.

감사합니다. | 이창제: 안녕하세요. 김태윤 실장님.

실제 SA 설치 후 매니저 내 로그가 찍힌 스크린샷을 첨부 드렸습니다.
위와 같이 네트워크 동작을 할 때 해결이 가능할지 확인 한 번 해주시면 감사하겠습니다 ! | 이창제: 안녕하세요. 김태윤 실장님.
기술지원2팀 이창제 대리 입니다.

현재 RIP, VIP, shared_nic 설정이 다 되어 있는 상황에서도 위와 같이 동작하고 있는 상황이었습니다 !
추가로, 담당자에게 로그 찍힌 이력에 대해 사진 한 번 받아서 등록하겠습니다. | 김태윤: SA 통제에 대한 부분이라면 NAT 된 부분에 대해서 지원하지 않습니다.
이창제대리가 처음 생각한 부분과 같이 NAT 되기 전 DBSAFER에서만 가능합니다.

SA의 경우 최종단의 패킷만을 기반으로 통제가 가능하지 NAT 전 IP전에 대해서 알 수 없습니다.

참고하세요 | 이창제: 확인 감사드립니다 !",https://cafe.naver.com/pnpsecure2/6912
6899,[TIP] dbsafer_accountsync 사용 중 인사 연동 서버가 Oracle 19C로 변경 되었을 경우,"[개요]
dbsafer_accountsync 사용 중 인사연동 서버가 Oracle 19C로 변경 되어, 접속 오류 및 캐릭터셋 이슈 발생, 대응 방법을 설명한다.
[상황]
> 버전: dbsafer_accountsync v1.150.R778
> 인사연동서버가 Oracle 19C로 변경되어 Oracle 19C를 지원하는 ojdbc8.jar 파일을
/dbsafer/dbsafer_accountsync/ 경로에 추가하였음.
첨부파일
ojdbc8
.zip
null
파일 다운로드
[오류발생]
SQLException - ORA-17056: Non-supported character set (add orai18n.jar in the classpath): KO16MSWIN949
https://docs.oracle.com/error-help/db/ora-17056/
[오류발생사진]
[조치]
orai18n-19.3.0.0.jar 파일을 /dbsafer/dbsafer_accountsync/ 경로에 추가하여 해결함.
첨부파일
orai18n-19.3.0.0
.zip
null
파일 다운로드
도움 주신 김진용 대리님
감사합니다. 끝.",댓글 없음,https://cafe.naver.com/pnpsecure2/6899
6895,[TIP] PC Assist for Mac 패치간 TCP 서버 확인 에러 발생 대응방법,"[개요]
Mac OS 환경에서 Pc Asssit 패치 진행 시 ""TCP 서버 확인"" 에러 팝업이 발생할 때, 해당 상황에서 임시조치 방법을 작성합니다.
[증상]
Mac Assist 패치 진행 후 사용자 PC에서 아래와 같은 에러 팝업 발생
[원인]
- Mac OS에서 XPC 서버가 재등록이 안되어 발생됨 (원인은 알 수 없음)
[조치방안]
1. 임시 조치
a. 설치 경로로 이동
b. pcassistservice 프로그램 실행
c. 실행 시 비활성화 활성화 여부에 대한 팝업 발생
d. 해당 팝업에서 비활성화 처리 후 다시 활성화
> 해당 과정에서 사용자 암호 물어보는 팝업 발생
e. 활성화 시 pcassistservice 허용 팝업 발생 및 허용 처리
2. 해결 버전 사용
PCAssist for macOS v3.3.4.19
> 수정사항 : XPC 서버의 경우 내부 관리용으로 실제 운영에 불필요하여 TCP 서버의 정상 확인 방법을 추가함. 기존 XPC 통신을 통하여 TCP 서버 확인이 오류가 발생한 경우, TCP 접속을 통하여 TCP 서버 확인 후 정상으로 처리
이상입니다.
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6895
6894,[TIP] AWS AMI 정의 및 복제 기능 활용법,"[개요]
AWS 클라우드 환경에 구성된 DBSAFER 서버를 고객사측 요구로 인한 재구축 사례가 존재하였습니다. 다만, 신규 EC2를 생성하여 재구축하기엔 시간적 소요가 너무 많다고 생각되어 AMI를 통한 DBSAFER 서버 재구축 방법을 소개드리려고 합니다.
[AWS AMI 복제란 ?]
- AMI 란?
AMI는 EC2 인스턴스를 실행하는 데 필요한 모든 요소를 포함하고 있는 집합체를 의미합니다.
EC2에서 실행중인 OS, SW, 인스턴스 저장소, 설정 정보 및 사용자 데이터 등 현재 구동중인 EC2 내 구성되어 있는 인프라적인 모든 요소들의 집합체 입니다.
- AMI 복제 란?
AWS에서 제공하는 기능으로, 기존의 Amazon Machine Image(AMI)를 다른 AWS 리전으로 복사하는 과정입니다. 이는 AWS의 다양한 리전에서 동일한 AMI를 사용할 수 있도록 하여, 리전 간에 일관된 인프라 환경을 유지할 수 있습니다.
==> 해당 기능은 VM WARE 스냅샷과 비슷한 성격의 기능이지만, AWS 에서 제공하는 특정 EC2에 해당된 모든 설정 값을 복제한다는 약간의 차이점이 존재합니다. 또한, 기존 운영중이던 AMI를 중지할 필요없이 복제가 가능한 것이 장점입니다
[고객 요구에 따른 AMI 복제 활용 히스토리]
1. A고객사
- 문의 :
> 현재 VPC 구성이 신규 VPC로 변경 예정에 따른 DBSAFER 서버 이관 필요 (DBSAFER IP 변경됨)
- 고객사 환경 :
> DBSAFER7 이중화(갈레라) 구성 / 총 4식
- 장점 :
> 4대 서버 대상 재구축 수 작업은 시간 소요가 오래 걸리지만, AMI를 통해 복제시 로그 이관 및 config 이관 등 불필요한 작업이 생략됨
> IP 변경만 지원하여 작업 시간 효율성 증대
2. B고객사
- 문의 :
> 신규 망에 DBSAFER 서버를 신규 구축 & 설정 값은 기존 망에 구성된 DBSAFER 서버와 동일하게 구성 요청
- 고객사 환경 :
> DBSAFER5 단독 구성
- 장점 :
> 해당 고객사는 타 고객사에 비해 로그양이 많았지만, AMI 복제를 통해 로그이관 시간적 단축
> 기존 운영중이던 DBSAFER 서버와 동일한 config 값이 이미 설정되어 있으므로, IP 변경만 진행함
관련 작업 방식에 대해 문의사항이 있으실 경우, 라인주시면 자세히 공유드릴 수 있도록 하겠습니다.
별첨. EC2를 활용한 AMI 만들기 및 복제 방법
https://blog.spiralmoon.dev/entry/AWS-EC2-%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4%EB%A1%9C-AMI%EB%A5%BC-%EB%A7%8C%EB%93%9C%EB%8A%94-%EB%B0%A9%EB%B2%95
[AWS] EC2 인스턴스로 AMI를 만드는 방법
EC2 인스턴스로 AMI를 만드는 방법 AWS EC2 인스턴스로 AMI 이미지(사진 아님)를 만들어보자. AWS AMI란? AMI(Amazon Machine Image)는 AWS 환경에서 가상 머신을 생성하는 데 사용되는 이미지이다. AMI는 가상 서버의 기본 구성, 운영 체제, 애플리케이션 및 데이터를 정의한다. 간단히 말해 AMI는 가상 머신을 시작하기 위한 템플릿으로 볼 수 있다. 이미지 만들기 EC2 콘솔로 접속하여 베이스 이미지로 만들고 싶은 EC2 인스턴스를 선택한다. 인스턴스를 선택하고 이미지 및 템플릿 > 이미지 생성...
blog.spiralmoon.dev
감사합니다.
예시",댓글 없음,https://cafe.naver.com/pnpsecure2/6894
6888,[롯데바이오로직스] AWS 멀티 AZ DBSAFER V7.0 이중화 구성 (6) Failover/Failback,"[AWS 멀티AZ DBSAFER V7.0 이중화 프로젝트 정보]
[DBSAFER_PJT] 롯데바이오로직스_통합접근제어 검토
[롯데바이오로직스] AWS 멀티 AZ DBSAFER V7.0 이중화 구성 (1) 멀티 AZ란?
[롯데바이오로직스] AWS 멀티 AZ DBSAFER V7.0 이중화 구성 (2) 설치 작업
[롯데바이오로직스] AWS 멀티 AZ DBSAFER V7.0 이중화 구성 (3) WORKS 설치
[롯데바이오로직스] AWS 멀티 AZ DBSAFER V7.0 이중화 구성 (4) WORKS 기안 팝업
[롯데바이오로직스] AWS 멀티 AZ DBSAFER V7.0 이중화 구성 (5) Server Agent 설정
[Failover&Failback 이란?]
Failover는 주 시스템에 장애가 발생하였을 때, 자동 또는 수동으로 대체 시스템으로 전환하여 서비스를 지속하는 프로세스입니다.
Failback은 장애가 발생했던 주 시스템이 복구된 후, 서비스가 다시 주 시스템으로 복귀하는 프로세스입니다.
분류
ALB (Application Load Balancer)
NLB (Network Load Balancer)
시점
장애 발생 시
장애 복구 후
방향
Active 서버 → Standby 서버
Standby 서버 → Active 서버
목적
서비스 중단 방지
원 상태로 복구
[NLB/ALB Failover&Failback 기준]
AWS의 NLB와 ALB는 고가용성을 위해 트래픽을 여러 대상 그룹으로 분산합니다. 이 과정에서 Failover(장애 전환) 와 Failback (복구 후 복귀) 는 헬스 체크 결과를 기준으로 이루어집니다.
1. 헬스체크란?
- 대상이 정상 상태인지 확인하기 위해 주기적으로 헬스 체크를 수행합니다.
분류
ALB (Application Load Balancer)
NLB (Network Load Balancer)
프로토콜
HTTP, HTTPS
TCP, TLS, HTTP, HTTPS
헬스체크 경로
지정 경로 (/imup-server/api/public/init)
TCP 포트 상태
정상 상태 코드
HTTPS 200 ~ 399 응답
2. Failover 기준
1) ALB
- 대상 서버가 비정상 상태로 판단되면 해당 서버로의 트래픽 전달 중지
- 기준 : 헬스 체크가 연속적으로 실패 (정상 상태로 반단되지 않음)
ALB 상태 검사 기준
2) NLB
- TCP/TLS 연결이 실패하거나 대상이 응답하지 않을 때 대상서버를 비정상으로 간주
- 기준 : 지정된 헬스 체크 포트 또는 프로토콜에서 지정된 횟수만큼 연속 실패
NLB 상태 검사 기준
3. Failback 기준
1) ALB
- 비정상 상태였던 대상 서버가 헬스 체크에 다시 정상 상태로 응답하면 트래픽 전달이 재개
- 지정된 횟수만큼 연속 성공해야 정상 상태로 간주
2) NLB
- 비정상 상태였던 대상 서버가 지정된 헬스 체크 조건을 충족하여 정상 상태로 간주되면 트래픽 전달이 재개
[ALB 502 Bad Gateway 확인]
AWS의 ALB에서 502 Bad Gateway 오류가 발생하는 이유는 주로 ALB와 연결된 백엔드 서버 간의 통신 문제 때문입니다. 이 오류는 ALB가 백엔드 서버로부터 유효한 응답을 받지 못할 때 발생합니다.
- ALB 의 헬스 체크 실패
: ALB가 설정된 헬스 체크 경로에 대해 200 응답을 받지 못하여 백엔드를 비정상 상태로 간주
Failover / Failback 이 발생할 때 헬스 체크가 정상으로 전환되기까지 약간의 시간이 소요됩니다.
주로 이 과정 중에서 웹 접속 시 502 Bad Gateway 가 확인됩니다.
[failover 알림 메일 발송 스크립트 설정]
이중화 상태 모니터링 및 별도 알림에 대한 기능 없기 때문에 서버 전환에 대한 메일 전송 스크립트를 설정하였습니다.
- /dbsafer/failover_mail 디렉토리 생성 후 failover_mail.sh 와 mail_form.html 파일 추가
- /dbsafer/.conf/pnp_ha.services/cmd_failover.txt 에서 failover 메일 전송 스크립트 수행하는 내용 추가
cd /dbsafer/failover_mail && ./failover_mail_send.sh
1) failover_mail_send.sh
첨부파일
failover_mail
.sh
null
파일 다운로드
#!/bin/bash
PW=`cd /dbsafer && expect -c ""spawn ./pnp dbms_info
expect -re ""\>""
sleep 0.2
send ""dbsaferadmin""
send \r
sleep 0.2
interact "" | awk 'NR==8{print $1}'|tr -d '\015\012'`
# HTML 파일 경로를 변수에 저장
FILE_PATH=""mail_form.html""
OUTPUT_PATH=""failover.html""
TITLE_RESERVED=""TITLE_RESERVED""
HOST_RESERVED=""HOST_RESERVED""
IP_RESERVED=""IP_RESERVED""
COMMENT_RESERVED=""COMMENT_RESERVED""
TIME_RESERVED=""TIME_RESERVED""
TITLE=""NODESAFER FAILOVER ALERT""
HOST=$(hostname -f)
STANDBY=BLACLAPP02
IP=$(hostname -I)
COMMENT=""The ACTIVE SERVER has switched from a $HOST to a $STANDBY!""
TIME=$(date)
sed -e ""s/$TITLE_RESERVED/$TITLE/g"" \
-e ""s/$COMMENT_RESERVED/$COMMENT/g"" \
-e ""s/$HOST_RESERVED/$HOST/g"" \
-e ""s/$IP_RESERVED/$IP/g"" \
-e ""s/$TIME_RESERVED/$TIME/g"" \
""$FILE_PATH"" > ""$OUTPUT_PATH""
FILE_STRING=$(cat ""$OUTPUT_PATH"")
QUERY=""INSERT INTO dbsafer3.mail(mailto, subject, content) values (‘shpark916@pnpsecure.com', CONCAT('A Failuer has occurred on : ', @@hostname), '$FILE_STRING');""
# 파일이 존재하는지 확인
if [ -f ""$OUTPUT_PATH"" ]; then
#파일 내용을 출력
mysql -usafeusr -p${PW} -e ""$QUERY""
else
#파일이 존재하지 않는 경우 메시지 출력
echo ""파일이 존재하지 않습니다 : $OUTPUT_PATH""
fi
2) mail_form.html
첨부파일
mail_form
.html
null
파일 다운로드
<html>
<head>
<title>TITLE_RESERVED</title>
<style>
body,td,p,select,option,textarea,a{font-size:12px ;font-family:돋움;color:#58595B;}
}
.copy{font-size:11px ;font-family:굴림 ;color:#58595B;}
}
</style>
</head>
<body topmargin=""0"" leftmargin=""0"" background=""http://www.pnpsecure.com/mail/images/mail_bg.gif"">
<!--메일 폼---->
<table cellpadding=""0"" cellspacing=""0"" border=""0"" width=""600"" align=""center"">
<tr>
<td height=""20""></td>
</tr>
<tr>
<td align=""center"">
<table cellpadding=""5"" cellspacing=""1"" border=""0"" width=""500"" align=""center"" bgcolor=""#E4E4E4"">
<tr bgcolor=""#ffffff"" align=""center"">
<td height=""30""><b>Faulty Server HostName</b>
</td>
<td height=""30"">HOST_RESERVED</td>
</tr>
<tr bgcolor=""#ffffff"" align=""center"">
<td height=""30""><b>Faulty Server IpAddress</b></td>
<td height=""30"">IP_RESERVED</td>
</tr>
<tr bgcolor=""#ffffff"" align=""center"">
<td height=""30""><b>Failure Occurrence Time</b></td>
<td height=""30"">TIME_RESERVED</td>
</tr>
</table>
<br>COMMENT_RESERVED
</td>
</tr>
<tr>
<td height=""20""></td>
</tr>
<tr>
<td height=""20"" bgcolor=""ffffff""></td>
</tr>
[메일 내용]
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6888
6887,[롯데바이오로직스] AWS 멀티 AZ DBSAFER V7.0 이중화 구성 (5) Server Agent 설정,"[AWS 멀티AZ DBSAFER V7.0 이중화 프로젝트 정보]
[DBSAFER_PJT] 롯데바이오로직스_통합접근제어 검토
[롯데바이오로직스] AWS 멀티 AZ DBSAFER V7.0 이중화 구성 (1) 멀티 AZ란?
[롯데바이오로직스] AWS 멀티 AZ DBSAFER V7.0 이중화 구성 (2) 설치 작업
[롯데바이오로직스] AWS 멀티 AZ DBSAFER V7.0 이중화 구성 (3) WORKS 설치
[롯데바이오로직스] AWS 멀티 AZ DBSAFER V7.0 이중화 구성 (4) WORKS 기안 팝업
[서버 구성]
- 사용자들은 서버 접속 시 NAT IP 로 접속을 하며 Real IP 는 알 수 없는 구성
- DBSAFER 는 각각의 다른 Subnet 에 이중화 된 상태로 구성
[AS-IS]
- SA 설정 : Only_PNPSHELL=OFF , Operation_Level=1 , Server Manager IP 설정 = Active+Standby 로 설정
- NAT IP만 서비스 등록 후 우회 접속 수행 시, 하단과 같은 내용이 확인되었습니다.
1) 우회 접속 차단 발생하지 않음
2) SA 로그 남지 않음
3) Terminal 로그 확인 시 서버 IP 주소가 Real IP 주소로 확인됨
[TO-BE]
1. 서버의 Real IP에 대하여 서비스 등록
- Server Agent 의 경우, 등록된 서비스 기반으로 동작하기 때문에 NAT IP와 Real IP에 대하여 모두 등록이 필요합니다.
2. Host IP 관리 설정
- 서버 1대에 2개 이상의 IP 및 NIC 를 사용하는 경우 하나의 서버로 인식하기 위해 IP를 묶어서 설정합니다.
- shared NIC 설정은 관리자 프로그램이 우선이며, /dbsafer/.conf 에서 pnp_server_manager.shared_nic 에서도 설정 가능합니다.
> 고객이 관리하기에 Host IP 관리 설정이 보다 용이하여 해당 설정으로 적용한 상태입니다.
- Enterprise Manager → Server Agent 관리 설정 → Host IP 관리 설정
> Host IP : NAT IP
> Support IP : Real IP
[추가 확인 내용]
Q1. 대상 서버가 NLB 주소와 영향을 받는 부분이 있는가?
A1. NLB 주소는 사용자가 접속할 때만 영향을 받습니다. 즉 대상 서버에서는 NLB 주소를 인지하지 않아도 됩니다.","이상민: 1. DBSAFER는 My NLB주소를 SA/WTA에게 전달할 필요 가 없습니다.
- SA/WTA 입장에서도 DBSAFER NLB주소는 알 필요 없습니다.
- NLB는 DBSAFER로의 Ingress만 관여합니다.
- DBSAFER -> SA/WTA 구간은 out going이며, 해당 구간에서 NLB는 사용되지 않습니다.

2. 롯데바이오로직스의 경우 DBSAFER와 특정서버그룹의 망이 분리되어 있습니다. DBSAFER와 L-Cloud 서버그룹은 서로간의 NAT IP를 통해 통신하는 구조입니다.
- DBSAFER : AWS망
- 특정서버그룹 : L-Cloud망
- SA관리설정에서 L-Cloud 서버그룹 대상 NAT_DBSAFER_IP, NAT_LOGSERVER_IP(Only WTA) 지정 필수

3. 롯데바이오로직스의 경우 TGW, VGW, DX 서비스를 사용하며 AWS VPC, 온프레미스, L-Cloud 환경 간 private network으로 연결되어 있고 public 구간은 없",https://cafe.naver.com/pnpsecure2/6887
6884,innodb database DBSAFER 로그 파일을 tar로 압축한 다음 다른 서버에서 압축해제 후 정상적으로 조회하는 법,"DBSAFER A, B가 있다고 가정하였을때,
A에서 dbsafer_log_2024_12 디렉토리를 tar로 압축한 다음 B에 압축해제한뒤 mariadb에서 dbsafer_log_2024_12 내 테이블을 조회하면 아래 그림과 같이 엔진이 없다는 에러가 발생함.
B에서 dbsafer_log_2024_12 database를 이관한 후 정상적으로 조회하기 위해서는 A서버에서 ibdata1파일도 같이 이관한 다음 조회하면 정상적으로 조회됨.
단, 주의사항으로 B에서의 ibdata1을 A의 ibdata1파일로 교체할 경우 기존 Bㅇ에 있었던 database는 정상적으로 조회 안됨.
ibdata1 파일은 MySQL (또는 MariaDB) 데이터베이스의 InnoDB 스토리지 엔진에서 사용되는 중요한 시스템 파일입니다. InnoDB는 MySQL의 기본 스토리지 엔진으로, 트랜잭션, 외래 키 제약 조건, 데이터 무결성 등을 지원합니다.
ibdata1 파일은 InnoDB 시스템 테이블스페이스의 일부로, 데이터베이스에서 여러 중요한 정보를 저장하는 데 사용됩니다. 이 파일에 저장되는 정보는 다음과 같습니다:
테이블 데이터: InnoDB에서 생성된 모든 테이블의 실제 데이터와 인덱스가 ibdata1 파일에 저장됩니다. 이 파일은 여러 테이블의 데이터가 하나의 큰 파일에 저장되는 경우가 많습니다. (그러나 innodb_file_per_table 설정을 사용하면 각 테이블마다 개별적인 .ibd 파일을 생성할 수 있습니다.)
InnoDB의 내부 관리 정보: 트랜잭션 로그, 복구 정보, 테이블의 상태, 롤백 세그먼트 등의 시스템 데이터도 ibdata1에 포함됩니다.
Undo 로그: 트랜잭션이 롤백되었을 때 이를 처리하기 위한 정보가 ibdata1에 저장됩니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6884
6879,[TIP] 사용자의 과도한 쿼리 사용을 제어하기 위한 QPS 기능,"[요약]
OO카드에서 사용자가 과도한 쿼리 사용으로 인하여 Buffer 대량 생성
사이트 요구 사항으로 대량 쿼리 발생시 제어 가능한 기능 여부 확인 요청
확인 결과 카카오에 QPS 를 활용한 세션 관리 기능 존재하여 공유
[요구사항]
- 쿼리 QPS가 N개이상(ex)이면 알람 전송
. 알람은 default 10분동안 중복 발생안하도록
- 쿼리 QPS가 M개이상(ex)이면 세션 종료 전송
[개발사항]
- QPS를 계산하여 특정 QPS 이상일 경우 알림 및 세션 종료 시키는 기능
: QPS 정보를 계산하는 클래스 추가
: 최근 5초의 평균으로 QPS를 구함
- 서비스 설정 정보 추가
: .conf/pnp_dbms_config.conf
: [QPS ALERT LIMIT] 기본 0(동작안함), 사용자에게 알림이 전달될 QPS 지정
: [QPS ALERT DELAY TIME] 기본 600초 (최소 300초, 최대 86400초), 사용자 알림을 보내고 난 뒤 중복해서 보내지 않는 시간
: [QPS SESSION KILL LIMIT] 기본 0(동작안함), 세션 종료할 QPS 지정
[테스트 환경에서 PC Assist 알림 팝업 예시]
1. QPS Alert Limit 이상 쿼리 수행시
2. QPS SESSION KILL LIMIT 이상 쿼리 수행시 세션 차단
3. 매니저 로그 예시
[관련벅스]
https://bugs.pnpsecure.com/view.php?id=24183",댓글 없음,https://cafe.naver.com/pnpsecure2/6879
6878,[DBSCANNER] 대상DB scan 시 java oom으로 진행상황이 '중지' 상태에서 멈출 경우 확인사항,"1. 버전
- PKG_DBSCANNER_v1.10.44.0
2. 현상
- 대상DB Scan 시 진행상황이 일정 % 이상 올라가지 않고 '중지' 상태에서 멈춤
- 스캔 실패 상세 확인 시 Fail to execute private scan. Java heap space 확인
3. 원인
- 대상 DB의 scan 검출 항목이 많아 dbscanner_scanner.sh 모듈의 java Outofmemory 발생
4. 조치 방법
- dbscanner_scanner.sh 모듈의 heap memory 증량
(dbscanner_scanner.sh 모듈을 vi 편집기로 연 뒤 Xmx500m을 Xmx1024m으로 수정 후 저장하고 모듈 재가동)
설정 이후 대상서버에 대한 scan이 정상적으로 진행됩니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6878
6877,[DBSCANNER] 스캔 샘플 데이터 미저장 옵션 설정방법,"1. 필요상황
DBSCANNER에서 대상 DB 개인정보 Scan 시 실제 DB에 저장된 개인정보를 dbprofer_log_YYYY_MM.private_result_DD 테이블의 result_data 컬럼에 저장하고 있으며 이를 아래와 같이 샘플 데이터로 표시하게 되는데 실제 DB의 개인정보를 DBSCANNER DB 상에 저장하지 않고 개인정보 포함 유무만 확인하고자 할 경우 해당 옵션 적용을 고려해볼 수 있습니다.
2. 적용 방법
- PKG_DBSCANNER_v1.10.56.0_BUILD_312_20241106 버전 이상으로 패치 후 적용 가능
- /home/dbscanner/conf/dbscanner.conf 에 아래 옵션 변경
# 샘플 데이터 저장 옵션
sample.data.save = true → false로 변경 (샘플데이터를 DBSCANNER DB에 저장하지 않고 개인정보 유무만 확인)
설정 변경 후 dbsafer_scanner.sh 재기동 시 적용",댓글 없음,https://cafe.naver.com/pnpsecure2/6877
6876,[TIP] Teradata (테라테이타) 접속계정 및 어플리케이션 파싱 기능 개발 완료,"[요약]
기존에는 13 버전 이상에서 접속계정 파싱이 불가하였으나 우리은행에서 관련 기능을 개선 요청하여
Teradata Korea 에 문의 및 협업한 결과 접속계정 및 어플리케이션 파싱이 가능하도록 모듈 수정 완료
[버전 정보]
수정 완료된 버전 : Common 5.0 : 3894 이상 / 7.0 : 3893 이상
[관련 벅스]
https://bugs.pnpsecure.com/view.php?id=27148
이상입니다.
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6876
6873,2024년 9월 6일 기술본부 세미나 발표자료 공유(전종현),"안녕하세요. 기술지원3팀 전종현 입니다.
2024년 9월 6일 기술본부 세미나에서 발표한 자료 공유드립니다.
Bufferwriter 를 통한 Maria DB buffer Fail 파일 복구 방법 입니다.
첨부파일
[세미나]DBSAFER MariaDB Fail 파일 복구 방법
.pptx
null
파일 다운로드
이상입니다.
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6873
6872,[WORKS] 비정형화 명령어 기안 시 / 를 쿼리 끝부분에 사용하는 경우 대응 방법,"1. 상황
- ORACLE DB에 대한 쿼리 사용 시 /를 끝부분에 사용하는 쿼리를 WORKS 비정형 명령어 기안으로 신청하여 정책 생성
- 툴에서 해당 쿼리문을 그대로 사용 시 패킷상에서는 아래와 같이 /가 제거되어 명령어 불일치로 차단 발생
(DB툴마다 다를 수 있으며 같은 DB 툴에서도 사용 방법에 따라 패킷상 '/' 포함 여부와 쿼리 정상 실행 여부가 다를 수 있음)
2. 대응 방법
- 쿼리 구문 끝 '/' 사용은 일반적으로 SQL*plus 에서 쿼리 사용시 PL/SQL 블록이 끝남을 알려주며 일반적인 GUI DB 툴에서는 사용 의미가 없는 불필요한 기호(일반적인 GUI DB툴에서는 '/'없이 'run' 과 같은 쿼리실행 버튼 사용으로 PL/SQL 블록 실행)
- 아래와 같이 정상적인 사용 용법에 따라 SQL*plus에서 '/'를 사용하더라도 패킷에는 '/'가 포함되어 전달되지 않음
- 즉 일반 GUI DB툴 사용 시 쿼리 끝에 / 를 사용하는 것은 옳은 사용법이 아니며 사용자 측에 /가 제거된 'create or replace procedure ~~~ ;' 형태의 쿼리로 기안하도록 가이드하여야 합니다.(패킷에 '/'가 포함되어 있지 않으므로 DBSAFER에서는 사용자가 쿼리 끝에 '/'를 사용하였는 지 여부를 구분할 수 없음)",댓글 없음,https://cafe.naver.com/pnpsecure2/6872
6868,[롯데바이오로직스] AWS 멀티 AZ DBSAFER V7.0 이중화 구성 (4) WORKS 기안 팝업,"[AWS 멀티AZ DBSAFER V7.0 이중화 프로젝트 정보]
[DBSAFER_PJT] 롯데바이오로직스_통합접근제어 검토
[롯데바이오로직스] AWS 멀티 AZ DBSAFER V7.0 이중화 구성 (1) 멀티 AZ란?
[롯데바이오로직스] AWS 멀티 AZ DBSAFER V7.0 이중화 구성 (2) 설치 작업
[롯데바이오로직스] AWS 멀티 AZ DBSAFER V7.0 이중화 구성 (3) WORKS 설치
[이슈 내용①_WORKS 기안 팝업 미발생]
- 멀티 AZ 환경의 NLB 이중화 구성에서 WORKS PCAssist 기안 팝업 미발생 현상
: WORKS 에서 pnp_msg_tunnel 호출 시 DBSAFER GW IP로 NLB 주소를 사용하게 되어 기안 팝업 요청 미발생
(https://bugs.pnpsecure.com/view.php?id=29142)
10.193.234.233 : DBSAFER IP
10.193.234.2 : AWS DNS 서버 IP
3166 포트
[임시조치]
- pnp_oms_dms.conf 의 SERVER_IP 값을 서버 Real IP 로 변경 후 서비스에 대한 NAT 접속을 NLB 가 아닌 사용자 > 대상서버로 방화벽 변경하는 방식으로 임시조치하였습니다.
> AS-IS : 사용자 > NLB (3970~3999) > 대상 서버
> TO-BE : 사용자 > 대상서버 (3970~3999)
[기능 수정 요청 사항]
- Works에서 사용자가 접속한 GW IP 를 질의하는 행위를 oms_dms 의 SERVER_IP 가 아닌 다른 모듈을 통해 전달 받을 수 있도록 수정 요청하였습니다.
[팝업 메시지 전달 구성 변경]
1. AS-IS
기존 팝업 메시지 전달 로직
① 이벤트 수신을 위해 PC Assist 와 GW 대상 (1대 한정) 메시지 터널 세션 연결 및 유지
② 정책 설정에 의해 결재 팝업 정보(보안계정) 를 pnp_decide3 대상으로 전달
③ pnp_decide3는 결재 팝업 정보(보안계정)를 WORKS 로 전달
④ 결재 팝업 정보를 기준으로 사용자와 메시지 터널 세션 정보 조회
⑤ pnp_oms_dms 에서 보안계정 기준 사용자 IP 및 GW 정보(SERVER_IP 값) 제공
⑥ WORKS 는 결재 팝업 정보를 pnp_msg_tunnel 로 전달
⑦ pnp_msg_tunnel 은 결재 팝업 메시지를 PC Assist 로 전달
⑧ 결재 팝업창 표시
2. TO-BE
기안 팝업 발생 로직 변경으로 인하여 pnp_oms_dms.conf 의 SERVER_IP 옵션이 0.0.0.0으로 설정되어 있는 환경에서 적용 불가능한
제약사항이 해소되었습니다.
변경된 팝업 메시지 전달 로직
① 이벤트 수신을 위해 PC Assist 와 GW 대상 (1대 한정) 메시지 터널 세션 연결 및 유지
② 정책 설정에 의해 결재 팝업 정보 (보안계정+사용자 IP (Public/Private) 를 pnp_decide3 대상으로 전달
③ pnp_decide3는 결재 팝업 정보(보안계정+사용자 IP (Public/Private) 를 WORKS 로 전달
④ WORKS 는 결재 팝업 정보를 pnp_msg_tunnel 대상으로 직접 전달
⑤ pnp_msg_tunnel 은 결재 팝업 메시지를 PC Assist 로 전달
⑥ 결재 팝업창 표시
1) pnp_decide3
- 수정 내용 : pnp_decide3 로 결재 데이터 전송 시 사용자 IP field 에 Public IP 전달하도록 수정
- 수정 버전 : Module_V7_Rocky8_x86_64_decide3_R251_B20241105.tgz
2) WORKS
- 수정 내용 : WORKS 에서 사용자가 접속한 DBSAFER GW IP 질의하는 행위를 pnp_oms_dms.conf 의 SERVER_IP 가 아닌
pnp_decode3 를 통해 전달 받을 수 있도록 수정
- 수정 버전 : PKG_WORKS_V7.0.1.25-b.tar.gz
[이슈 내용②_SSL 통신 DB에 대하여 기안 팝업 미발생]
1차 패치 작업 후 MSSQL 에 대하여 기안 팝업 미발생 현상이 확인되었습니다. (사전 테스트 할 때는 MySQL 로 테스트하여 발생 안 함)
1) 원인 : tp_gateway 와 ssl_proxy 모듈과의 통신 프로토콜 버전을 3으로 확장하면서 사설 IP 로깅 처리가 안 됨
(프로토콜 문서 : SSL 암복호화 모듈(SSL_PROXY 프로토콜 문서)
2) 수정사항
- pnp_ssl_proxy 모듈을 사용하는 서비스에 대하여 프로토콜 버전이 3이라도 사설 IP가 로깅이 되도록 수정
: 세션 정보의 사용자 IP (Public IP)와 사용자 식별 정보의 사용자 (Private IP)를 비교하여 저장하는 기능 추가
3) 수정 버전 : pnp_tp_gateway MAIN VERSION (Rev:2742) 이상에서 수정 완료
[이슈 내용③_기안 단계에 따른 PC Assist 팝업 알림 미발생]
1차 수정버전 PKG_WORKS_V7.0.1.25-b.tar.gz 으로 패치할 경우, 승인요청/결재완료/처리완료/결재 반려 등 결재 단계 수행에 따른 알림 팝업이 발생하지 않는 상황이 확인되었습니다.
1) 수정 사항
- 결재 관련 알림에서 사용하는 Gateway IP를 수정된 pnp_decide3 데몬에서 수집하는 Gateway IP(pnp_ha에서 수집)와 동일하게 변경
> AS-IS : IM
> TO-BE : 1순위(pnp_ha), 2순위(IM)
2) 수정 버전 : PKG_WORKS_V7.0.1.26-b.tar.gz
3) 설정 파일 변경 (/home/webapp/imup/config/properties)
- server.duplex.type=1 로 변경
- server.duplex.config=0
> pnp_ha에 오류가 있거나 실행되지 않을 때, Active/Standby 를 구분하기 위한 설정값
> Active 는 2, Standby 는 1로 변경
> 롯데 바이오로직스의 경우, Standby 에서는 모든 서비스 모듈 및 JAVA 미사용 처리이기 때문에 0으로 설정
- /dbsafer/.conf/pnp_ha.key 파일 권한 660 으로 설정 (읽기 권한 필요)",댓글 없음,https://cafe.naver.com/pnpsecure2/6868
6867,[롯데바이오로직스] AWS 멀티 AZ DBSAFER V7.0 이중화 구성 (3) WORKS 설치,"[AWS 멀티AZ DBSAFER V7.0 이중화 프로젝트 정보]
[DBSAFER_PJT] 롯데바이오로직스_통합접근제어 검토
[롯데바이오로직스] AWS 멀티 AZ DBSAFER V7.0 이중화 구성 (1) 멀티 AZ란?
[롯데바이오로직스] AWS 멀티 AZ DBSAFER V7.0 이중화 구성 (2) 설치 작업
[클라우드 용어 비교 설명]
서비스
온프레미스 예시
내용
ALB
Nginx, HAProxy(L7)
어플리케이션 계층 (OSI 7계층) 에서 작동하며, HTTP/HTTPS 요청을 분석해 경로 또는 호스트 기반으로 트래픽 분산
Route53
DNS Server
DNS 서비스로, 도메인 이름을 IP 주소로 변환하거나 특정 라우팅 정책(지연 시간, 가중치 기반 등) 을 기반으로 트래픽 라우팅
ACM
내부 CA 서버
TLS/SSL 인증서를 자동으로 프로비저닝, 배포, 갱신하여 보안 통신 제공
[ALB와 NLB 비교]
특징
ALB (Application Load Balancer)
NLB (Network Load Balancer)
트래픽 처리 계층
어플리케이션 계층 (7계층 - HTTP/HTTPS)
네트워크 계층 (4계층 - TCP/UDP)
라우팅 방식
URL, 도메인, HTTP 헤더, 쿠키 등을 기준으로 라우팅
IP 주소와 포트 기반으로 라우팅
헬스체크 기능
HTTP/HTTPS 기반으로 구체적인 헬스 체크 가능
TCP 연결 성공 여부로 단순 헬스 체크
HTTPS 지원
HTTPS 및 TLS 인증서 관리 가능
TLS 인증서 관리 가능하지만 HTTP 관련 기능은 없음
주요 사용 사례
웹 어플리케이션, REST API
게임 서버, TCP 기반 데이터베이스
성능
트래픽 분석이 필요하여 약간의 지연 발생
빠른 처리 속도와 낮은 지연 시간
[웹 제품에서 ALB를 써야 하는 이유]
웹 제품의 핵심은 HTTP/HTTPS 요청을 처리하고 사용자에게 빠르고 안정적인 서비스를 제공하는 것입니다.
이처럼 웹 어플리케이션의 특성과 요구사항을 고려할 때, ALB가 더 적합한 사유는 하단과 같습니다.
1) HTTPS 및 보안 강화
- 웹 제품은 사용자 데이터 보호를 위하여 HTTPS(SSL/TLS)를 필수적으로 사용해야 합니다.
- ALB는 AWS ACM을 사용해 TLS 인증서를 쉽게 관리할 수 있으며, HTTPS 트래픽을 자동으로 처리합니다.
- NLB도 TLS 를 지원하나, HTTPS와 관련된 고급 기능 (HTTP 헤더 분석)은 제공하지 않습니다.
2) HTTP/HTTPS 친화적 기능
- ALB는 HTTP/HTTPS 프로토콜에 최적화되어 WebSocket이나 HTTP/2 같은 웹 관련 기능도 지원합니다.
- NLB는 TCP/UDP 처리에 초점이 맞춰져 있어 웹 어플리케이션의 요구사항을 충족시키기 어렵습니다.
3) 헬스체크와 대상 관리
- ALB는 HTTP 상태코드 (200 OK 등)를 기반으로 대상의 상태를 확인해 비정상 서버를 자동을 제외합니다.
이는 웹 서버가 다운되었을 때 서비스 장애를 방지하는 데 유용합니다.
- NLB 는 단순히 TCP 연결 여부로 상태를 확인하므로, 웹 서버의 세부적인 상태를 확인하기 어렵습니다.
* NLB가 적합한 경우
- 고속 처리와 낮은 지연시간이 필요한 환경에 적합합니다.
: 게임서버 (UDP 기반 트래픽), 실시간 데이터 처리 시스템, TCP 기반 데이터베이스 복제나 로그 전송
[ALB 설정]
1) ALB에는 Route53 와 연동된 ACM 인증서 연결
- ACM 인증서은 SSL 서버 인증서로 적용이 되며, 뒷단 (ALB > DBSAFER) 의 사설인증서의 유효성을 검증하지 않기 때문에
DBSAFER 에 별도 인증서를 넣을 필요 없습니다.
2) 리스너 설정
- 사용자가 어떤 프로토콜 및 포트를 사용하여 연결 요청을 할 것인지 설정하는 항목으로 HTTPS:443 으로 설정합니다.
3) 대상그룹 상태검사 속성
- 대상 그룹의 설정에 따라 로드밸런서가 요청을 라우팅하는 방법이 결정됩니다.
: ALB 는 DBSAFER 의 3443 포트로 전달이 되어야 하기 때문에 HTTPS:3443 으로 설정합니다.
: /imup-server/api/public/init URL을 헬스체크로 경로로 설정합니다.
> 정상 응답 코드를 받을 수 있는 항목에 대하여 현재 제품에는 없는 상황으로
부하를 방지하며 최적의 경로를 넣기 위하여 해당 경로를 설정합니다.
: https 헬스체크 및 응답코드 200을 성공으로 처리합니다.
[IM/WORKS 설정 항목]
1) IM 설정
- 엔지니어 페이지에서 GW IP 를 127.0.0.1 로 설정합니다.
2) WORKS 설정
- config.properties 설정값
> cors.allowed.origins=https://pnpsecure-cloudtech.com:443
> im.api.host=10.193.234.233:233
> imup.host=pnpsecure-cloudtech.com:443
3) 관리자 프로그램
- [시스템 설정] > [보안계정 연동 설정] > [IM/IMUP 연동 기능 사용] : pnpsecure-cloudtech.com:443 설정
- [시스템 설정] > [결재시스템 설정] > [결재시스템 URL] : https://pnpsecure-cloudtech.com:443
4) pnp_decide.conf
- USER_SYSTEM_IP = 10.193.234.233
5) pnp_oms_dms.conf
- DECIDE_URL = https://pnpsecure-cloudtech.com:443
구분1
구분2
사설+공인
config.properties
cors.allow.origin
ALB 주소:443
cors.allow.origin
서버 IP
cors.allow.origin
ALB 주소:443
Manager
IM/IMUP 연동기능
ALB 주소:443
결재시스템 URL
ALB 주소:443
pnp_decide.conf
USER_SYSTEM_IP
서버 IP
pnp_oms_dms.conf
DECIDE_URL
ALB 주소:443
[구축 과정 중 추가 확인 내용]
Q1. 앞 구간 통신 시 ACM 과 DBSAFER 내의 사설 인증서가 불일치하여 헬스 체크가 실패하는 건 아닌가?
A1. ALB는 기본적으로 대상 서버와의 연결 구간에서 사설 인증서 유효성 검증을 수행하지 않습니다.
대상 서버의 인증서가 사설 인증서든 자체 서명 인증서든 관계 없이 연결을 시도합니다.
Q2. 앞구간은 HTTPS 로 통신하고, 뒷구간은 HTTP로 통신할 수 있도록 설정이 가능한가?
A2. ALB 기능 상에서는 앞 구간은 HTTPS로 통신하고, 뒷 구간에서는 SSL 을 비활성화하여 HTTP로 통신하도록 구성이 가능하나,
현재 DBSAFER 에서 해당 기능이 지원이 불가능한 상황입니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6867
6866,[공유] DBSAFER IM 서버 계정 권한을 보안계정 그룹으로 부여하는 방법 공유,"안녕하세요
클라우드기술팀 손혁진입니다.
카카오페이 고객사에서 DBSAFER IM 서버 계정 권한을 보안계정 그룹으로 부여 할 수 있도록 기능 추가가 되어 내용 공유 드립니다.
테스트 환경
- OS : Rocky8
- DBSAFER : V7.0
- IM : v1.6.2.47-a
- pnp_imup_policy : V2 Release (Rev 109)
- Enterprise Manager : Ver 7.0.0.2 (Build 3165)
[요약]
- 아래 IM, pnp_imup_policy, Enterprise Manager 버전 이상 사용 필요
. IM : V1.6.2.14-a 이상
. pnp_imup_policy : V2 Release (Rev 109) 이상
. Enterprise Manager : Ver 7.0.0.2 (Build 3015)
- OS, DBMS 장비 계정에 사용권한 추가 시 보안계정 그룹 선택 가능하도록 UI 수정
- os_account_to_user_mapper, dbms_account_to_user_mapper 테이블에 group_idx 컬럼 추가
- os_account_to_user_mapper_history, account_su_change_to_user_mapper_history 테이블에 group, group_idx 컬럼 추가
- am_policy, auth_policy 테이블에 sno_group 컬럼 추가
- 상위 그룹을 먼저 등록 후 하위 그룹 등록 시 상위 그룹과 사용기간 중복 확인
- 하위 그룹을 먼저 등록 후 상위 그룹 등록 시 하위 그룹과 사용기간 중복 확인
- API 사용 권한에 그룹을 등록할 수 있도록 로직 수정
- pnp_imup_policy에서 보안 계정 그룹 기준에으로 정상 정책 검사를 할 수 있도록 기능 추가
[기능 요청 사유]
- 고객사에서는 특정 사용자들 대상으로 모든 서버에 자동 접속이 필요한 상황
- 현재 계정 사용자 추가는 계정 단일만 권한이 부여가 가능하기에 서버마다 N명의 계정 사용자 추가 해야 되는 반복 작업이 생기는 상황
- 계정 사용자 추가를 보안계정 단일이 아닌 그룹(보안계정)으로 추가 가능하도록 수정 요청
[기능 적용 내용]
- DBSAFER IM : V1.6.2.14-a 이상 패치 및 무결성 검사 적용
2. pnp_imup_policy V2 Release (Rev 109)이상으로 패치
3. Enterprise Manager Ver 7.0.0.2 (Build 3015) 이상 패치
4. IM 접속 후 서버 계정 보안계정 그룹 단위로 적용
5. Enterprise Manager에서 정상 반영 확인
6. pnp_imup_policy shm에도 정상 반영 확인
7. 부여된 권한으로 서버 정상 접속 테스트 확인
[별첨]
- 카카오페이 고객사 OS 프로비저닝 시 자체적으로 생성한 스크립트 통해 DBSAFER IM API를 호출 하여 서버 장비 추가, 서버 계정(공용 계정) 추가, 특정 사용자들 대상으로 모든 서버에 접근 가능하도록 권한 부여 되고 있는 상태
. API 통해 보안계정 그룹으로 권한 부여되는 부분 아래와 같이 내부 테스트를 통해 정상 동작 확인 체크
1. 보안계정 그룹 단위로 권한 부여가 필요하기에 IIT 라는 보안계정 그룹 ""GroupNo"" 정보 획득
2. 권한 부여 할 서버 계정 acctNo 데이터 값 획득
3. IIT 보안계정 그룹 대상으로 payeng 라는 서버 계정에 권한 부여
4. IIT 보안계정 그룹 대상으로 payeng 라는 서버 계정에 권한 정상 반영 확인
이상입니다
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6866
6865,[공유] MobaXterm을 통한 PC ASSIST 자동 접속 방법 공유,"안녕하세요
클라우드기술팀 손혁진입니다.
다수 고객사에서 문의한 MobaXterm을 통한 PC ASSIST 자동접속 가능 여부 및 설정 방법 관련 내용 공유드립니다.
테스트 환경
- OS : Rocky8
- DBSAFER : V7.0
- IM : v1.6.2.46-a
- PC ASSIST : 3.3.1.9
[요약]
- Q. MobaXterm을 통해 PC ASSIST 자동접속이 가능한가요?
A. 가능합니다. pc assist 통해 자동 접속 시 프로그램을 실행하고 설정한 명령어를 입력하게 됩니다.
mobaxterm 은 프로그램을 실행하면 바로 명령어 입력이 가능한 탭이 아니라 별도의 메인 화면으로 나타납니다.
이에 명령어 입력이 가능하도록 새로운 탭에서 SSH 명령어가 수행 될 수 있도록 설정해주면 됩니다.
- MobaXterm을 통한 PC ASSIST 자동 접속 필요 시 아래 경로에 프로그램 명령어 설정 필요
설정 경로 : PC ASSIST > 환경설정 > SSH > 고급설정 > 프로그램 이름 지정(ETC) > 프로그램 경로 / 명령어 지정
프로그램 경로 지정 : Mobaxterm 프로그램 경로 지정
프로그램 명령어 지정 : -newtab ""plink.exe -ssh <userid>@<ip> -P <port> -pw <userpw>”
[설정 방법]
1. pnp_oms_dms.conf 파일에서 NAT_MENU_TYPE = 4 설정 변경 후 pnp_oms_dms 재시작
pnp_oms_dms.conf 설정 값
2. PC ASSIST 로그인
3. MobaXterm을 통한 PC ASSIST 자동 접속 설정 방법은 아래와 같습니다.
가. PC Agent 왼쪽 하단 톱니바퀴 아이콘 클릭
나. SSH 탭 고급 설정 클릭
다. 프로그램 이름 지정(ETC)
라. 프로그램 경로 지정을 통해 MobaXterm 실행 파일 경로 지정
마. 프로그램 명령어 지정을 통해 SSH 접속 실행 시 사용되는 명령어 입력
EX) -newtab ""plink.exe -ssh <userid>@<ip> -P <port> -pw <userpw>""
- newtab : 새로운 탭을 열 때 사용하는 옵션
- plink.exe : 원격 서버에 SSH 연결을 설정하고 명령을 실행하는 데 사용
- ssh <userid>@<ip> -P <port> -pw <userpw> : 아래 예약어를 통해 ssh 명령어 수행
. <userid> : 접속계정
. <ip> : 서버 IP
. <port> : 포트
. <userpw> : 비밀번호
PC ASSIST 환경 설정
[결과]
1. payeng 계정 권한 확인 후 자동접속 시도
payeng 계정 접속 시도
2. payeng 계정 MobaXterm 툴 통해 자동접속 성공
이상입니다
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6865
6864,[공유] 서비스별 세션 대기시간 기본값 설정 방법 공유,"안녕하세요
클라우드기술팀 손혁진입니다.
카카오페이 고객사에서 사용하고 있는 서비스별 세션 대기시간 기본값 기능 관련 내용 공유 드리겠습니다.
테스트 환경
- OS : Rocky8
- DBSAFER : V7.0
- Enterprise Manager : 7.0.0.2A (Build-3183)
[요약]
- 현재 서비스 객체 별로 세션 대기시간을 설정하였으나 고객사에서 세션 대기 시간에 대한 기본값을 설정 할 수 있도록 기능 추가 요청
- Enterprise Manager 시스템 설정 > 객체 설정 > 서비스 설정에서 아래 기능 설정 가능
. 서비스 객체 - DBMS 세션 대기시간 기본값 설정
. 서비스 객체 - FTP 세션 대기시간 기본값 설정
. 서비스 객체 - TERMINAL 세션 대기시간 기본값 설정
- 위 설정 시 서비스 별로 세션 대기시간 기본 설정값 반영
[설정 방법]
1. Enterprise Manager 7.0.0.2A (Build-3183) 이상으로 설치
2. 시스템 설정 > 객체 설정 > 서비스 설정에서 아래 내용 설정 진행 (테이블 : dbsafer3.variables)
. 서비스 객체 - DBMS 세션 대기시간 기본값 설정 (테이블 : mgr_default_session_wait_time_dbms)
. 서비스 객체 - FTP 세션 대기시간 기본값 설정 (테이블 : mgr_default_session_wait_time_ftp)
. 서비스 객체 - TERMINAL 세션 대기시간 기본값 설정 (테이블 : mgr_default_session_wait_time_terminal)
[결과]
1. DBMS,FTP,TERMIAL 세션 대기 시간 기본값을 120으로 설정 후 아래와 같이 적용 확인
PS
- DBSAFER IM을 통해 서비스 추가 시 위 ""서비스별 세션 대기시간 기본값"" 을 참조하여 세션 대기시간 설정값이 같이 반영 되도록 기능 추가 진행 중
관련 벅스
BUGS : https://bugs.pnpsecure.com/view.php?id=29376
BUGS : https://bugs.pnpsecure.com/view.php?id=29592",댓글 없음,https://cafe.naver.com/pnpsecure2/6864
6863,[롯데바이오로직스] AWS 멀티 AZ DBSAFER V7.0 이중화 구성 (2) 설치 작업,"[AWS 멀티AZ DBSAFER V7.0 이중화 프로젝트 정보]
[DBSAFER_PJT] 롯데바이오로직스_통합접근제어 검토
[롯데바이오로직스] AWS 멀티 AZ DBSAFER V7.0 이중화 구성 (1) 멀티 AZ란?
[클라우드 용어 비교 설명]
서비스
온프레미스 예시
내용
Security Group (SG)
방화벽, 네트워크접근제어
AWS 리소스에 대한 네트워크 트래픽을 제어하는 가상 방화벽
NLB
F5 BIG-IP, HAProxy(L4)
네트워크 계층(OSI 4계층) 에서 작동하며, IP주소 및 포트를 기준으로 트래픽 분산
NLB 리스너
NLB가 수신하는 트래픽의 프로토콜 및 포트 정의
NLB 대상그룹
NLB 가 트래픽을 라우팅할 실제 서버의 집합
[이중화 구성 설치 ]
DBSAFER 서버는 Default 방식으로 Active 1대, Standby 1대 설치합니다.
1. Security Group 설정
첨부파일
ELB_단독 이중화_방화벽_오픈리스트
.xlsx
null
파일 다운로드
2. 패키지 설치
1) 다운 경로 : 멀티 AZ DBSAFER V7.0 이중화 구성 설치 패키지 모음
2) 기본 설치 패키지 정보
(1) CustomSet_Rocky8.10_20240603.cpio.gz
(2) PKG_DBSAFER7_RelV7-TBIN-RockyLinux_x86_64_20240808.tar
: 설정 값에 도메인 설정이 가능하도록 기능 포함된 패키지
(3) gslb_listener.zip (https://bugs.pnpsecure.com/view.php?id=28356)
: port 바인딩 스크립트를 python2 에서 python3 로 변경
(4) pnp_ha.tar.gz (https://bugs.pnpsecure.com/view.php?id=28395)
: python3 로 사용하기 위해서 Port checker 1.0.5 이상에서 사용 가능하기 때문에
/dbsfer/.conf/pnp_ha.services/ 내의 Port 패치
3. 서버 설정
1) pnp_ha.ini 설정
- 모니터링 할 서비스는 MariaDB, DataDisk, PortBind, NormalExecute, FailExecute 로 설정한다.
- VirtualIP service 에 대한 내용은 주석처리하고, L4 Health Check Port 내용을 새로 추가한다.
[service]
; Service list.
service_list = MariaDB DataDisk PortBind NormalExecute FailExecute
; VirtualIP service. (주석 처리로 전환)
;service_VirtualIP_bin = IPAddr
;service_VirtualIP_param = ip:192.168.2.249
; L4 Health Check Port (해당 내용 추가)
service_PortBind_bin = Port
service_PortBind_param = protocol:tcp port:3442
-- 일반적으로 L4 와 VirtualIP 중에 1개만 사용을 합니다.
2) executeCMD 설정
(1) cmd_failover.txt
cd /dbsafer/failover_mail && ./failover_mail_send.sh
pkill -9 pnp_watcher
pkill -9 pnp_backup3
pkill -9 pnp_statistics
pkill -9 pnp_msg_tunnel
pkill -9 pnp_oms_dms
pkill -9 pnp_agent
pkill -9 pnp_basic
pkill -9 pnp_udb
pkill -9 pnp_ora
pkill -9 pnp_mysql
pkill -9 pnp_mssql
pkill -9 pnp_ssl_proxy
pkill -9 pnp_ssh_proxy
pkill -9 pnp_telnet
pkill -9 pnp_key_manager
pkill -9 pnp_decide3
sleep 1
cd /dbsafer && ./pnp_dbms_gateway stop
cd /dbsafer && ./pnp_telnet_gateway stop
cd /dbsafer && ./pnp_server_manager stop
cd /dbsafer && ./wta_server_manager stop
cd /dbsafer && ./wta_proxy_server  stop
cd /dbsafer && ./wta_player stop
cd /dbsafer && ./pnp_imup_policy stop
sleep 1
pkill -9 pnp_log_bridge
pkill -9 pnp_log
pkill -9 java
(2) cmd_normal.txt
cd /dbsafer && ./pnp_agent start
cd /dbsafer && ./pnp_log start
cd /dbsafer && ./pnp_log_bridge start
cd /dbsafer && ./pnp_oms_dms start
cd /dbsafer && ./pnp_msg_tunnel start
sleep 1
cd /dbsafer && ./pnp_server_manager start
cd /dbsafer && ./wta_server_manager start
cd /dbsafer && ./wta_proxy_server start
cd /dbsafer && ./wta_player start
cd /dbsafer && ./pnp_backup3 start
cd /dbsafer && ./pnp_statistics start
cd /dbsafer && ./pnp_key_manager start
cd /dbsafer && ./pnp_decide3 start
cd /dbsafer && ./pnp_imup_policy start
sleep 1
cd /dbsafer && ./pnp_agent run-watcher
cd /dbsafer && ./pnp_agent policy-reload
cd /dbsafer && ./pnp_agent policy-broadcast
sleep 1
cd /dbsafer && ./pnp_imup_policy sync 0
cd /dbsafer && ./pnp_imup_policy sync 1
cd /dbsafer && ./pnp_imup_policy sync 2
service pnpweb start
cd /dbsafer && ./pnp_watcher start
[NLB 설정
- AWS NLB를 활용한 DBSAFER V7.0 이중화 자료 참고
1. 리스너 설정
- Network Load Balancer에 리스너를 추가하여 클라이언트 요청과 네트워크 트래픽이 라우팅되는 방식을 정의합니다.
NLB 리스너는 요청을 지정된 대상 그룹에 전달하는 기본 작업으로 구성됩니다.
- 프로토콜 선택 후 포트 번호 입력을 통해 설정 가능합니다.
NLB 리스너 목록
2. 대상그룹 설정
- NLB에서 트래픽을 전달할 대상(리소스) 의 집합을 정의합니다.
대상 그룹은 대상의 상태를 모니터링하여 비정상적인 대상을 자동으로 제외합니다.
- 대상 그룹에 상태 검사 포트를 pnp_ha 3442 포트로 설정하여, 서버가 정상적으로 작동하는지 확인이 가능합니다.
NLB 대상그룹 설정
3. DBSAFER 에서 NLB 주소 기입 항목
- pnp_oms_dms.conf 의 SERVER_IP 항목
- PC Assist 의 DBSaferAgt.CFG 의 IP 항목에 NLB 주소 기입
- 관리자 프로그램에서 서버 주소 기입 항목에 NLB 주소 기입
사용자/관리자 접속",댓글 없음,https://cafe.naver.com/pnpsecure2/6863
6860,[TIP] pnp_connector 사용한 view 테이블 생성 참고자료,"1. pnp_connector 로 view 테이블 생성 시 사용할 쿼리문 자료
- DB 명령어, DBMS 세선, OS 명령어, OS 세션 로그, 관리자 로그
- 위 로그에 대한 로그 인터페이스 명세서
* 쿼리문 내용 중 데이터베이스, 테이블_날짜를 pnp_connector 등록 양식에 맞춰 수정하여 등록 시 사용 가능
첨부파일
DBMS 로그관련 view 테이블
.zip
null
파일 다운로드
첨부파일
OS 로그관련 view 테이블
.zip
null
파일 다운로드",댓글 없음,https://cafe.naver.com/pnpsecure2/6860
6856,[TIP] OpenSSL 3.0 패치 후 pnp_ssl_proxy 모듈을 통한 Eclipse 툴로 DBMS 접속 불가 현상 & TLS 및 보안 레벨 설정 방법 공유,"[개요]
- pnp_ssl_proxy 모듈을 통한 OpenSSL 3.0 패치 후 일부 사용자 Eclipse 툴로 DBMS 접속 불가 현상이 있어 원인 확인 결과 신규 개발된 TLS 및 보안 레벨 설정 방법에 대한 공유
- 요청 고객사 : 현대글로비스
[요약]
1. OpenSSL 3.0 부터 TLSv1.0, 1.1이 기본적으로 비활성화되도록 변경되었으나, 현대글로비스 일부 사용자는 TLSv1.0, 1.1로 접속을 시도
2. 사용자/대상서버 구간에 대해 TLS 최소 버전/보안레벨 옵션 설정 기능 추가
3. pnp_ssl_proxy.conf 설정 방법 및 포맷 확인 필요
[이슈 내역]
- pnp_ssl_proxy 모듈을 통한 OpenSSL 3.0 패치 후 Eclipse 접속 불가 현상
- 에러 메시지
드라이버가 SSL(Secure Sockets Layer) 암호화를 사용하여 SQL Sever로 보안 연결을 설정할 수 없습니다.
원인: Received fatal alert: internal_error)
org.springframework.transaction.CannotCreateTransactionException: Could not open JDBC Connection for transaction; nested exception is org.apache.commons.dbcp.SQLNestedException: Cannot create PoolableConnectionFactory (드라이버가 SSL(Secure Sockets Layer) 암호화를 사용하여 SQL Sever로 보안 연결을 설정할 수 없습니다. 원인: Received fatal alert: internal_error)
[확인 내역]
- 22.05 PKG에서 23.05 PKG 로 패치 이후 발생
- openssl 1.0.2 에서 3.0 으로 패치 이후 발생
- openssl 3.0 으로 패치 이후 mssql 서비스가 TLS 1.2 로만 접속 가능
- 현대글로비스에서는 일부 사용자의 java 버전이 낮아 TLS 1.0, 1.1 만 지원 가능한 툴 사용
- 고객사의 java 버전 업그레이드는 안되는 상황
[고객사 버전 정보]
- pnp_ssl_proxy
기존 : Rev 87 / 신규 : Rev 180
[원인]
- OpenSSL 3.0 부터 TLSv1.0, 1.1이 기본적으로 비활성화되도록 변경되었으나, 사용자는 TLSv1.0, 1.1로 접속을 시도
[개발 내역]
- OpenSSL 3.0 이상에서 오래된 서버 대상으로 접속이 가능하도록 수정
- (ASIS) 사용자/대상서버 구간 TLS 연결 시 OpenSSL 기본 TLS 최소 버전과 보안레벨에 따라 접속
- (TOBE) 사용자/대상서버 구간에 대해 TLS 최소 버전과 보안레벨 설정이 가능하도록 옵션을 추가
- 개발 당시 R24.05 패키지 마무리 단계이기에 우선 반영하지 않음, 추후 반영 예정
1) 옵션 미설정 시 사용자 구간에 대해 OpenSSL 기본 TLS 최소 버전과 보안레벨에 따름
2) 옵션 미설정 시 대상서버 구간에 대해 최소 TLSv1.0, 보안레벨 0을 지원
3) 옵션 설정 시 사용자/대상서버 구간에 대해 TLS 최소 버전/보안레벨 설정 적용
[설정 방법]
1. 설정 가능 최소 버전
- pnp_ssl_proxy v228 Trunk 버전
- OpenSSL 1.1.0 이상 적용 가능
- TLSv1.3 미지원
2. pnp_ssl_proxy.conf 설정파일 변경
- 현대글로비스에서 발생한 현상은 사용자가 접속할 때 TLS 낮은 버전 쓰는 사용자들이 있는 경우이기 때문에 SERVER_TLS 설정을 변경
- 사용자가 접속할 때 DBSAFER가 SERVER인 입장이기에 SERVER 쪽을 변경
- 만약, DBSAFER가 CLIENT 인 입장인, 대상 서버에 접속할 때 필요한 설정일 경우 CLIENT_TLS_VERSION_MIN, CLIENT_SECURITY_LEVEL 옵션을 변경
- 전체 서비스를 대상으로 진행하기엔 보안이 취약하다고 판단되어 대상 서비스만 TLS 버전과 보안레벨 설정을 변경
- 또한 해당 설정을 진행할 때에는 단계적으로 설정 및 확인 필요
2.1. SERVER_TLS_VERSION_MIN = (1925) 0
2.2. SERVER_SECURITY_LEVEL = (1925) 0
3. 서비스 재시작 후 동작 확인
2.1 옵션 설정 후 서비스 재시작 및 동작 확인
- 현대글로비스는 SERVER_TLS_VERSION_MIN = (1925) 0 설정 후에도 정상동작 하지 않아 2.2 옵션 변경 진행
2.2 옵션 설정 후 서비스 재시작 및 동작 확인
- 정상동작 확인
[설정 파일 설명]
1. 서비스 별 TLS 최소버전(SERVER)을 설정
- SERVER_TLS_VERSION_MIN : 사용자 접속 시 TLS 최소 버전 / 0:TLSv1.0, 1:TLSv1.1, 2:TLSv1.2
- CLIENT_TLS_VERSION_MIN : 대상서버 접속 시 TLS 최소 버전 / 0:TLSv1.0, 1:TLSv1.1, 2:TLSv1.2
- SERVER_SECURITY_LEVEL : 사용자 접속 시 보안 레벨 / 0 ~ 5
- CLIENT_SECURITY_LEVEL : 대상서버 접속 시 보안 레벨 / 0 ~ 5
2. 최소 버전 설정
- 해당 옵션은 특정 버전만 선택하여 사용이 가능한 것이 아닌, 최소 버전 설정 옵션
# Example : SERVER_TLS_VERSION_MIN = 1 설정 시, TLSv1.1과 TLSv1.2 지원
# Example : SERVER_SECURITY_LEVEL = 3 설정 시, 보안 레벨 3~5 지원
3. 설정 포맷
1) 단일설정 포맷 : { ([SERVER_IP:PORT]) or ([SERVICE_NO]) or (*) } + { [VERSION] }
2) (*) : 전체 서비스 대상 설정 가능
3) FTPS 서비스의 경우, IP/Port 사용으로 지정 불가능
# Example : (192.168.100.100:3306) 2
# Example : (1) 2
# Example : (*) 2
4) TLS VERSION은 0~2의 값을 가질 수 있음
# 0 = TLSv1.0
# 1 = TLSv1.1
# 2 = TLSv1.2
5) 보안 LEVEL은 0~5의 값을 가질 수 있음
✔️주의사항
- TLS 버전과 보안 레벨 설정이 0이거나 권장 값보다 낮은 경우, 보안에 매우 취약하기 때문에 고객사 해당 부분 확인 후 적용 필요
4. 설정 파일 첨부
# DBSAFER SSL PROXY CONFIGURATION FILE Version 1.15
첨부파일
dbsafer_ssl_proxy.conf
.sample
null
파일 다운로드
[관련 벅스 및 참고 자료]
- 벅스 : https://bugs.pnpsecure.com/view.php?id=28460",댓글 없음,https://cafe.naver.com/pnpsecure2/6856
6853,[롯데바이오로직스] AWS 멀티 AZ DBSAFER V7.0 이중화 구성 (1) 멀티 AZ란?,"[AWS 멀티AZ DBSAFER V7.0 이중화 프로젝트 정보]
[DBSAFER_PJT] 롯데바이오로직스_통합접근제어 검토
[클라우드 용어 비교 설명]
서비스
온프레미스 예시
내용
EC2
물리 서버, VMware
클라우드에서 사용 가능한 가상 서버로, 필요에 따라 즉시 생성하거나 삭제할 수 있는 컴퓨팅 자원을 제공
VPC
VLAN, 방화벽 설정
격리된 네트워크를 구성할 수 있는 서비스로, 사용자만 접근 가능한 가상 네트워크를 제공
CloudWatch
Nagios, Zabbix, Splunk
AWS 리소스와 애플리케이션 성능, 시스템 로그를 모니터링하고 경고를 설정할 수 있는 서비스
AZ
다중 데이터 센터
하나의 리전에 속하는 물리적으로 독립된 데이터 센터
ELB
HAProxy, F5 BIG-IP
여러 EC2 인스턴스에 트래픽을 분산하여 부하를 균등하게 나누고 가용성을 높이는 서비스
[멀티 AZ 란?]
**AWS 멀티AZ (Availability Zone) **는 여러 물리적 데이터 센터를 묶어 하나의 AWS 리전 내에서 분산 배치를 하여 장애조치 (Failover) 기능을 제공합니다. 각 AZ 는 동일한 리전 내에서 독립적인 데이터 센터로 구성되며 전력, 네트워크, 냉각 시스템 등의 인프라가 물리적으로 분리되어 있어 한 곳에 문제가 발생하여도 다른 AZ는 정상적으로 작동이 가능합니다.
1. 장점
1) 고가용성 : 한 AZ에서 장애가 발생하여도 다른 AZ에 배포된 리소스가 즉시 서비스를 이어 받아 서비스중단을 최소화합니다.
2) 데이터 보존 : 중요 데이터가 여러 AZ에 복제되어 있어 데이터 손실 위험을 감소시킵니다.
3) 장애 복구 (Failover) : 한 AZ가 다운되더라도 다른 AZ에서 서비스를 지속할 수 있습니다.
2. 고려사항
1) 네트워크 구성
(1) VPC 서브넷 분산 : 여러 AZ에 서브넷을 생성하고 EC2 인스턴스를 각각 다른 서브넷에 배치합니다.
(2) 보안그룹 : 모든 AZ에서 EC2 인스턴스에 동일한 보안 그룹을 적용하여 네트워크 규칙이 일관되도록 설정합니다.
2) 장애대비
(1) 장애 발생 시, 자동 장애 조치 (Standby 전환을 위해 헬스체크를 설정해야 합니다.
AWS EC2 멀티 AZ 구성은 고가용성과 장애 복구를 목표로 하는 설정입니다. 설정 후에는 장애 복구 시나리오를 테스트하고,
**모니터링 도구(Amazon CloudWatch)** 를 활용하여 성능과 안정성을 지속적으로 확인하는 것이 좋습니다.
3. 멀티 AZ EC2 구성 방법
1) 인스턴스 생성 : 동일한 리전 및 설정으로 다른 AZ에 인스턴스를 생성합니다.
AZ는 각기 다른 가용 영역(ex : ap-northeast-1a, ap-northeast-1b)을 선택해야 합니다.
2) 로드밸런서 구성 : 로드밸런서 종류 (ALB, NLB, GLB) 생성 후 타겟 그룹을 생성하고 로드밸런서와 타겟 그룹을 연결합니다.
[AWS ELB(Elastic Load Balancing)란?]
**AWS ELB(Elastic Load Balancing)**는 Amazon Web Services(AWS)에서 제공하는 로드 밸런싱 서비스로, 여러 서버에 걸쳐 트래픽을 자동으로 분산시켜 애플리케이션의 안정성과 가용성을 높이는 역할을 합니다. 다양한 유형의 트래픽을 효과적으로 처리할 수 있는 로드 밸런서 옵션을 제공하며, 트래픽의 종류에 따라 Application Load Balancer(ALB), Network Load Balancer(NLB), Gateway Load Balancer(GLB) 등을 사용할 수 있습니다.
이 중에서 DBSAFER V7.0 단일-단일 이중화 구성에 ALB와 ELB 를 사용하였습니다.
1. Application Load Balancer (ALB)
ALB는 HTTP/HTTPS 트래픽을 처리하는 데 최적화된 7계층(Layer 7) 로드 밸런서입니다. 주로 웹 애플리케이션, API, 마이크로서비스 아키텍처에서 많이 사용되며, URL 기반 라우팅과 헤더 기반 라우팅 같은 고급 기능을 지원합니다.
특징:
1) 경로 기반 라우팅
2) 호스트 이름 기반 라우팅
3) WebSocket 및 HTTP/2 지원
4) 애플리케이션 상태에 따른 라우팅
2. Network Load Balancer (NLB)
NLB는 TCP, UDP, 및 TLS 트래픽을 처리하는 4계층(Layer 4) 로드 밸런서입니다. 고성능, 저지연성 트래픽이 필요한 대규모 애플리케이션에 적합하며, 초당 수백만 건의 요청을 처리할 수 있습니다.
특징:
1) 초고속 성능 및 저지연성
2) 고정 IP 주소 제공
3) 원래 클라이언트 IP 보존
4) TCP/UDP 프로토콜 지원
[도입 배경]
AWS는 다중 가용 영역(Availability Zone)을 활용해 서비스 중단 위험을 최소화합니다. 리소스(ex: EC2)를 여러 가용 영역에 분산시킴으로써 한개의 가용영역에 장애가 발생되어도 다른 가용영역에서 지속적이고 안정적으로 서비스 운영을 보장합니다. 이를 통해 고객에게 고가용성과 연속성 을 보장할 수 있습니다.
최근 여러 고객사에서 퍼블릭 클라우드 환경의 멀티 AZ 구성을 기본 요건으로 요구하고 있습니다. 주요 고객사로는 코리안리, 롯데바이오로직스, 롯데이노베이트, 케이티, 대림, 한국투자증권, 한국도요타(예정) 그리고 현대계열사 한 곳(예정)이 포함됩니다.
이처럼 고가용성과 연속성을 보장하는 이중화 아키텍처는 클라우드 인프라에서 필수적인 전략으로 자리 잡고 있는 상황이나, 표준화 된 멀티AZ 이중화 아키텍처가 정의되지 않은 상황에서 1) 구성 복잡도를 낮춘다 2) AZ간 교차 통신 최소화한다는 관점으로 ELB 를 활용한 DBSAFER V7.0 단일-단일 이중화 구성을 제공하게 되었습니다.
[그림 1] 롯데 바이오로직스 구성도
※ 이는 품질로부터 검증 받지 않은 환경으로, 클라우드기술팀에서 자체적으로 구성한 환경임을 사전에 말씀드립니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6853
6851,[TIP] MongoDB Compass 특정 버전 이후 마스킹 되지 않는 현상 관련 수정 내역 공유,"[개요]
- Mongo DB Compass 특정 버전 이상에서 로깅 방식이 json 형태로 변경되어, 서비스 모듈 수정 내역 공유
- 요청 고객사 : 우아한형제들
[요약]
1. 이슈
- Mongo DB Compass 최신 버전에서 마스킹 되지 않는 현상
2. 원인
- MongoDB Compass v1.43.2 이상 버전에서는 컬럼명으로 로깅되지 않고 __doc 라는 컬럼명의 json 형태로 로깅되어 기존 등록하였던 마스킹 객체와 맞지 않아 발생
3. 개발 내역
- pnp_mongodb MAIN VERSION (Rev: v4012) 이상에서 수정완료
- 마스킹 객체에 {collection}.__doc 객체 추가안해도 마스킹되도록 개발 완료
- 기존에는 컬럼명 기준으로 마스킹 유무를 판단하였지만, json 형식의 결과값이 들어오면 name 값을 기준으로 마스킹 객체에 매칭시켜 마스킹 처리 하도록 수정
[이슈 내역]
- Mongo DB Compass 최신 버전에서 마스킹 되지 않는 현상
[확인 내역]
- MongoDB Compass v1.43.2 최신 버전 설치 이후 해당 현상 발생
- MongoDB Compass v1.31.3 에서는 정상 동작 확인
- 마스킹 객체 : 컬럼명 마스킹 사용
- 정책 : 정상 동작 할 때와 변동사항 없음
- compass의 documents view 에서 마스킹 되지 않음, shell 에서는 정상적으로 마스킹되어 출력 확인
- 접속 및 조회 패킷 첨부
[버전 정보]
- MongoDB 5.0.26
- MongoDB Compass v1.43.2
- pnp_mongodb v2195 / COMMON 3568
- pnp_ssl_proxy v68M
[내부 재현 결과]
- MongoDB Compass v1.31.3 버전에서의 결과값 로깅 결과
- MongoDB Compass v1.43.2 버전에서의 {__doc:0}추가 후 find 결과값 로깅 결과
- MongoDB Compass v1.43.2 버전에서의 결과값 로깅 결과
[원인]
- MongoDB Compass v1.43.2 이상 버전에서는 projection에 ""__doc"":""$$ROOT""이 기본으로 들어가서 컬럼이 __doc 으로 로깅되어 마스킹 정책에 맞는 객체가 없어서 마스킹이 되지않음
- 로그 저장되는 방식이 json 형식으로 변경되어 발생한 현상
[임시 조치 방안]
- 패치가 불가한 경우 다음과 같이 임시 조치 진행
- $collection.__doc 컬럼 마스킹 객체 추가 : 단, 해당 collection 전체 데이터 마스킹 처리 됨
- 우아한 형제들의 경우 orders.__doc 객체를 추가하여 마스킹 처리 필요
- orders.__doc 객체를 추가하게 된다면 컬럼 내 데이터가 전체 마스킹 되므로 개발 필요
[조치 방안]
- pnp_mongodb MAIN VERSION (Rev: v4012) 서버스 모듈 패치
[개발 내역]
- 마스킹 객체에 {collection}.__doc 객체 추가안해도 마스킹되도록 개발 완료
- 기존에는 컬럼명 기준으로 마스킹 유무를 판단하였지만, json 형식의 결과값이 들어오면 name 값을 기준으로 마스킹 객체에 매칭시켜 마스킹 처리
- 특정 name 값이 마스킹 처리로 판단되면 해당 value 값은 마스킹 처리하며, document의 경우에도 모든 value 값을 마스킹 처리
[제약 사항 (Known Issue)]
- 명령어 요청에 여러 테이블을 사용할 경우 특정 테이블, 컬럼 마스킹 객체가 여러 테이블에 영향을 줄 수 있음
- $cond. $switch 사용 시 실제 출력 데이터가 아닌, if 또는 case 조건 필드에 마스킹 정책에 매칭되는 컬럼이 있을 경우에도 마스킹 됨
- 명령어 구문 분석이 필요한 사항이라 추후 개발 예정
[관련 벅스 및 참고 자료]
- 벅스 : https://bugs.pnpsecure.com/view.php?id=28436",댓글 없음,https://cafe.naver.com/pnpsecure2/6851
6850,[TIP] pnp_ssl_proxy 사용 중 암호화 패킷 복호화하여 추출하는 방법,"[개요]
- pnp_ssl_proxy 모듈 사용 중인 서비스의 패킷 추출시, 암호화 패킷을 복호화하여 파일로 저장하는 방 공유
[사용 가능한 버전]
- pnp_ssl_proxy Rev.158 이상
[설정 방법]
# vi /dbsafer/.conf/pnp_ssl_proxy.conf
- 설정파일(.conf/pnp_ssl_proxy.conf) 내 ""SAVE_PACKET_FILE"" 설정으로 복호화 패킷을 저장할 서비스 지정
- 설정 포맷(1) : SAVE_PACKET_FILE = [서비스객체 번호]
- 설정 포맷(2) : SAVE_PACKET_FILE = [대상서버 IP]:[Port]
✔️ [] 제외하고 숫자만 입력
※ SAVE_PACKET_FILE 설정은 pnp_ssl_proxy 재시작 필요 없이 실시간 적용
※ 다만, 설정값 변경시 기존 접속 중인 세션에는 적용되지 않으며, 변경 이후 접속하는 세션에 대해 변경된 설정값이 적용
※ 패킷 수집이 완료되면 불필요하게 패킷 수집이 되지 않도록 꼭 설정 제거 필요
[저장 위치]
- 사용자-DBSAFER 구간(※ 저장 위치(1))과 DBSAFER-대상서버 구간(※ 저장 위치(2))으로 나눠서 복호화 데이터가 저장됨
- 저장 위치(1) : /dbsafer/var/ssl_proxy/packet/[서비스번호]_[사용자IP]_[사용자Port]_user.txt
- 저장 위치(2) : /dbsafer/var/ssl_proxy/packet/[서비스번호]_[사용자IP]_[사용자Port]_target.txt
[추출 결과]
- 패킷 추출 시 다음과 같이 파일이 생성 됨",댓글 없음,https://cafe.naver.com/pnpsecure2/6850
6848,[TIP] setcap 설정으로 톰캣 기본 포트(TCP 443)로 변환하기,"안녕하세요. 프로젝트 1팀 이재진입니다.
setcap 설정으로 톰캣 기본 포트(TCP 443)로 변환하는 방법 공유드립니다.
[setcap등록]
$ setcap 'cap_net_bind_service=+ep' /usr/java/default/bin/java
$ getcap /usr/java/default/bin/java
[setcap 삭제]
$ setcap -r /usr/java/default/bin/java
$ getcap /usr/java/default/bin/java
[라이브러리 적용]
/etc/ld.so.conf.d
$ vi /etc/ld.so.conf.d/java.conf
/usr/java/default/lib/jli (추가)
$ ldconfig
추가) DBSAFER 7.0 pnp_ha 데몬 Tomcat 프로세스 감지 설정
> pnp_ha.ini 파일 내 아래 설정 추가
1. Service list 에 PnpWeb 추가
2. PnpWeb service 주석 제거 및 service_PnpWeb_param = checkmode:app port:443 으로 수정
; PnpWeb service.
service_PnpWeb_bin = PnpWeb
service_PnpWeb_param = checkmode:app port:443
service_PnpWeb_check_period = 60
service_PnpWeb_check_period_on_failure = 5
이상입니다.
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6848
6845,[TIP] pnp_api 고객사 사설 SSL 인증서 적용 방법,"[개요]
- 대한항공 고객사 pnp_api 모듈 설치하는 과정에서 고객사 전용 사설 인증서 적용 요청
- pnp_api SSL 설정 Default는 /dbsafer/.conf/arbit 파일로 적용
- 일반적으로 WEB에서 많이 사용하는 pfx 파일도 변환하여 적용 가능하여 해당 방법 설명
[SSL 설정]
#####################################################################################
# SSL 설정 (선택)
#
# - ssl.enable-type : SSL 활성화 타입 (default : 1)
# 0 : 비활성화
# 1 : 활성화 (클라이언트 인증 미수행)
# - ssl.certificate-file : SSL 인증서 파일 경로 (절대경로, default : /dbsafer/.conf/arbit.dsc)
# - ssl.certificate-key-file : SSL 인증서 키 파일 경로 (절대경로, default : /dbsafer/.conf/arbit.dsk)
#
# (ex)
# ssl.enable-type = 1
# ssl.certificate-file = /dbsafer/.conf/arbit.dsc
# ssl.certificate-key-file = /dbsafer/.conf/arbit.dsk
#####################################################################################
ssl.enable-type = 1
ssl.certificate-file = /dbsafer/.conf/arbit.dsc
ssl.certificate-key-file = /dbsafer/.conf/arbit.dsk
[준비물]
- 고객사 사설 SSL 인증서 필요
> SSL 인증서 파일 : dsc , crt 등
> SSL 인증서 키 파일 : dsk, key 등
[pfx 파일 변환 방법]
(1) pfx -> key 파일 변환
#openssl pkcs12 -in [파일이름].pfx -nocerts -out [파일이름].key
예시) openssl pkcs12 -in dbac.koreanair.com.pfx -nocerts -out dbac.koreanair.com.key
#Enter Import Password: [pfx 비밀번호 입력]
#Enter PEM pass phrase: [설정할 비밀번호 입력]
#Verifying - Enter PEM pass phrase: [설정할 비밀번호 입력]
(2) pfx -> crt 파일 변환
openssl pkcs12 -in [파일이름].pfx -clcerts -nokeys -out [파일이름].crt
예시) openssl pkcs12 -in dbac.koreanair.com.pfx -clcerts -nokeys -out dbac.koreanair.com.crt
Enter Import Password: [pfx 비밀번호]
[설정]
- 고객사 사설 SSL 인증서 적용
ssl.certificate-file = /dbsafer/.conf/dbac.koreanair.com.crt
ssl.certificate-key-file = /dbsafer/.conf/dbac.koreanair.com.key
[기타]
- ssl.enable-type = 0
: SSL 비활성화 되며 https 통신이 아닌 http 통신으로 변경. 보안 취약",댓글 없음,https://cafe.naver.com/pnpsecure2/6845
6844,[카카오뱅크] 접근/권한 제어정책 과 관련된 보안계정 그룹 내 정보를 한 번에 쿼리로 조회 가능 여부 확인 요청,"[분류]
- 기타문의
[고객사/채널사]
- 카카오뱅크
[이슈내용]
1. 요청사항
- 고객사 카카오뱅크에서 접근/권한제어정책 현행화 중에 있는데,
접속/권한제어정책 내 보안계정그룹 존재 시 보안계정그룹 내 객체를 매칭시키는 부분이 힘들다고 합니다.
혹시, 쿼리를 통해 정책과 보안계정그룹 내 존재하는 보안계정 객체를 한 번에 조회 할 수 있는지 여부를 확인해달라고 요청을 받았습니다.
> 가능 여부에 대해 확인해주시면 감사하겠습니다.
가능하다면 쿼리도 같이 전달 주시면 감사하겠습니다 !
감사합니다.","여성구: 쿼리만으로는 해당 데이터 추출이 불가능합니다.

정책의 복합적인 부분과 객체/그룹의 관계성을 고려해야 하기 때문에 그렇습니다.
실제 매니저에서 정책 계산 시에도 쿼리와 프로그램 계산이 함께 이루어집니다. | 이창제: 답변 감사드립니다 !",https://cafe.naver.com/pnpsecure2/6844
6839,[DBSAFER7] 이중화 Fail-over & Fail-back 방안,"[매뉴얼 내용]
1. 이중화 구성 : Master + Slave 단독 이중화 구성에 따른 fail-over, fail-back 방안
[매뉴얼 사용 히스토리]
1. 고객사 : 한국교육학술정보원
2. 프로젝트 : 교육행정데이터통합관리시스템 물적기반 구축 사업
3. 매뉴얼 작성 계기 : 채널사 DBSAFER7.0 이중화 설정 경험 없음
이중화 테스트 시연 방안 가이드
첨부파일
[한국교육학술정보원] DBSAFER _v7.0_이중화 복구매뉴얼_v1.0
.pptx
null
파일 다운로드",댓글 없음,https://cafe.naver.com/pnpsecure2/6839
6838,[DBSAFER7] 이중화 구성 방안 공유,"[매뉴얼 내용]
1. 이중화 구성 : Master + Slave 단독 이중화 구성
2. DBSAFER 설치 경로 변경
3. DBSAFER 7 설치 및 설정 간 이슈사항 대처방안
[매뉴얼 사용 히스토리]
1. 고객사 : 한국교육학술정보원
2. 프로젝트 : 교육행정데이터통합관리시스템 물적기반 구축 사업
3. 매뉴얼 작성 계기 : 전국 시도교육청 동일한 구성 설치
채널사 DBSAFER7 이중화 구성 경험이 없음에 따른 가이드
첨부파일
[한국교육학술정보원] DBSAFER _v7.0_이중화 구성 설치매뉴얼_v1.7
.pptx
null
파일 다운로드",댓글 없음,https://cafe.naver.com/pnpsecure2/6838
6837,[공유][KB국민은행] Galera Cluster N중화 적용 설정 내역 공유,"안녕하세요. 프로젝트 1팀 이재진입니다.
고객사에 적용된 Galera Cluster N중화 적용 방법 공유드립니다.
이전에 구축했던 DMS 프로젝트와 현재 진행중인 접근제어 고도화 프로젝트에서는 Galera Cluster 3중화로 구성되었으며, N중화 설정이 가능합니다. 고객사에 적용된 구성도는 내용이 길어질 것 같아 추후에 게시글에 추가 등록하도록 하겠습니다. (GSLB, 도메인주소..사용 등)
※ 참고 : 설명을 돕기 위해 A서버는 master 서버, B와 C 서버는 slave 서버로 가칭하여 작성하겠습니다.
[A : 192.168.2.30] [B : 192.168.2.31 ] [C : 192.168.2.32]
1. /etc/hosts 에 A,B,C 서버 정보 기입
2. /dbsafer/.conf/pnp_ha.ini 에 A,B, C 서버의 IP 및 weight 정보 입력
3. /etc/my.cnf 파일 복사 및 수정 (C서버에서 수행)
> A 또는 B 서버에서 /etc/my.cnf 파일을 복사하여 다음 항목 수정 (IP 관련 항목)
- wsrep_node_address
- wsrep_node_incoming_address
- wsrep_sst_receive_address
4. DB 실행 전 설정 변경을 위한 디렉토리 생성 및 파일 복사 (C서버에서 수행)
> 디렉토리 생성 : mkdir -p /etc/systemd/system/mariadb.service.d
> A 서버 또는 B 서버에서 /etc/systemd/system/mariadb.service.d/homedir.conf 파일을 동일한 경로로 복사
5./dbsafer/.conf/pnp_ha.key 파일 복사 (C서버에서 수행)
> A 서버 또는 B 서버에서 pnp_ha.key 파일 복사
> pnp_ha 간 통신 데이터는 암호화 처리가 진행되며 이를 위한 key 파일이 존재
6. DBSAFER DB의 접속정보 변경 ( ./pnp_agent dbconfig) (B,C서버에서 수행)
> join 시 최초 cluster를 구성한 node(master)의 정보로 동기화 진행
> 따라서 B,C서버의 safeusr 계정의 비밀번호도 master 서버의 것과 동일하게 변경
7. pnp_galera dbms-status 명령어로 Galera Cluster 상태 확인
※ Join 시 주의사항 : galera cluster 는 반드시 상태가 synced일 때 join을 시도해야 함
> galera cluster에 여러 개의 node가 동시에 join하면 동기화에 문제가 생겨 join 대상 DB 데이터가 삭제될 수 있음
> 만약 동시에 붙여서 DB 실행이 안 될 경우 data가 모두 지워진 것으로, join을 시도한 서버들 모두 mysql_install_db 명령어를 실행하 여 DB를 다시 초기화하고 한 서버씩 join 시도
> 상태를 확인하는 방법은 cluster에 들어있는 node에서 ./pnp_galera dbms-status 로 확인 가능 (wsrep_local_state_comment)
이상입니다.
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6837
6836,[TIP] pnp_ssh_proxy 사용 시 구버전 SecureCRT 7.0 를 통한 ssh 접속 안되는 현상 (알고리즘 키 호환),"안녕하세요. 프로젝트 1팀 이재진입니다.
pnp_ssh_proxy 사용 시 구버전 SecureCRT 접속 안되는 현상 관련하여 DBSAFER GW 서버에 알고리즘을 등록하여 조치하는 방법을 공유드립니다. SecureCRT 버전을 업그레이드하여 더 높은 수준의 알고리즘을 사용하여 해결할 수 있으나, 업그레이드가 불가한 특이 케이스에 해당 설정으로 조치하면, 사용자의 액션 없이 ssh 접속이 가능하게 됩니다.
※ 참고 : SecureCRT 7.0은 최신 버전의 SSH 프로토콜(특히 SSH-2)에 대한 지원이 다소 제한적일 수 있습니다. 최신 버전의 SSH 서버는 더 안전한 키 교환 알고리즘을 사용하며, SecureCRT 7.0에서는 이를 지원하지 않거나 기본 설정이 호환되지 않을 수 있습니다.
1. [DBSAFER GW서버] : /usr/local/etc/sshd_proxy_config 파일 내 pnp_ssh_proxy 데몬 로그에 찍히는 알고리즘 추가
- HostKeyAlgorithms : MACs hmac-sha2-256,hmac-sha2-512,hmac-sha2-256,hmac-sha2-512
- MACs : hmac-sha1,hmac-sha1-96,hmac-md5,hmac-md5-96,umac-64@openssh.com
2. [pnp_ssh_proxy 데몬 로그 예시]
[2024-12-04 16:48:49] [53224] [ERROR] [ERROR 9999099] Error - abnormal status or data proces
rver handle. (NO)50000008 (SERVER)IP:PORT, (USER) IP:PORT
- [CSession.cpp:1590] (ERROR)Not matched protocol. (DESC)Failed to exchange the key for ssh(s
2)kex error : no match for method mac algo client->server: server [hmac-sha2-256,hmac-sha2-512],
client [sha1,hmac-sha1-96,hmac-md5,hmac-md5-96,umac-640openssh.com]
>> 밑줄친 알고리즘을 /usr/local/etc/sshd_proxy_config 에 추가 후 SecureCRT로 ssh 접속 시도 시 정상 접속
3. [알고리즘 적용 전 SecureCRT 접속 시 화면 예시]
고객사 이슈 분석에 도움을 주신 최재규 대리님 감사합니다.
이상입니다.","최재규: 관련 내용 작업할 사항 상세 내용 추가드립니다.
pnp_ssh_proxy 모듈 에러로그에서 매치되지 않은 method를 확인하시고 ""/usr/local/etc/sshd_proxy_config"" 에 추가해주셔야 합니다.

[모듈 에러]
1. no match for method ""kex algos"" : server [알고리즘], client ""[알고리즘]""
>> client에 있는 알고리즘을 sshd_proxy_config 파일 ""KexAlgorithms"" 로 입력

2. no match for method ""server host key algo"" : server [알고리즘], client ""[알고리즘]""
>> client에 있는 알고리즘을 sshd_proxy_config 파일 ""HostKeyAlgorithms"" 로 입력

3. no match for method ""mac algo client->server"" : server [알고리즘], client ""[알고리즘]""
>> client에",https://cafe.naver.com/pnpsecure2/6836
6835,[TIP] PC-Assist 사용자 접속 로그를 이용한 보안계정 IP ACL 일괄 등록 쿼리 공유,"안녕하세요. 프로젝트2팀 강수빈 과장입니다.
사이트 지원 중 아래와 같은 요구사항이 발생하여 처리 후 내용 공유드립니다.
[요구사항] 6개월간 접속한 PC-Assist 사용자 IP를 추출하여 보안계정 IP ACL 적용 요청
[적용 방안] PC-Assist 보안계정 접속 이력을 확인하여, 보안계정 IP ACL 테이블에 인서트 진행
복잡하게 생각할 필요 없이 보안계정의 접속 로그를 기록하는 테이블(dbsafer_log_2024_MM.ldap_history)에서 보안계정, 로그인 IP 컬럼 데이터를 추출하여 중복을 제거한 데이터를 보안계정 IP ACL 관리하는 테이블(dbsafer3.dbsafer_ldap_list_ip_mac)로 인서트 진행하였습니다.
더 좋은 방법들도 많겠지만 짧은 시간 안에 목적에 부합하는 쿼리 작성이 필요하여
단순하게 작성하였습니다.
--1. DB 백업
# mysqldump -usafeusr -p dbsafer3 > /tmp/dbsafer3_bak.sql
--2. 보안계정 IP ACL 조회
SELECT * FROM dbsafer3.dbsafer_ldap_list_ip_mac;
--3. 보안계정 IP ACL 테이블 정보 삭제
truncate table dbsafer3.dbsafer_ldap_list_ip_mac;
--4. 6개월치 보안계정 접속 로그 IP 조회
select DISTINCT sno,login_ip,login_ip as b FROM (select sno,login_ip,login_ip as b FROM dbsafer_log_2024_10.ldap_history union all
select sno,login_ip,login_ip as k FROM dbsafer_log_2024_09.ldap_history union all
select sno,login_ip,login_ip as k FROM dbsafer_log_2024_08.ldap_history union all
select sno,login_ip,login_ip as k FROM dbsafer_log_2024_07.ldap_history union all
select sno,login_ip,login_ip as k FROM dbsafer_log_2024_06.ldap_history union all
select sno,login_ip,login_ip as k FROM dbsafer_log_2024_05.ldap_history) a
--5. 6개월치 보안계정 접속 로그 IP를 보안계정 IP ACL 테이블로 인서트
INSERT INTO dbsafer3.dbsafer_ldap_list_ip_mac(sno,ip_addr,ip_addr_end)
select DISTINCT sno,login_ip,login_ip as b FROM (select sno,login_ip,login_ip as b FROM dbsafer_log_2024_10.ldap_history union all
select sno,login_ip,login_ip as k FROM dbsafer_log_2024_09.ldap_history union all
select sno,login_ip,login_ip as k FROM dbsafer_log_2024_08.ldap_history union all
select sno,login_ip,login_ip as k FROM dbsafer_log_2024_07.ldap_history union all
select sno,login_ip,login_ip as k FROM dbsafer_log_2024_06.ldap_history union all
select sno,login_ip,login_ip as k FROM dbsafer_log_2024_05.ldap_history) a
--6. 보안계정 IP ACL 조회
SELECT * FROM dbsafer3.dbsafer_ldap_list_ip_mac;
[참고사항]
- union all 구문을 사용하기 때문에 기간을 짧게 하여 Select로 데이터 확인 후 INSERT 진행하시면 됩니다.
- 사설 IP(NAT)가 존재하는 경우 dbsafer_log_2024_MM.ldap_history 테이블의 ipaddr_priv 컬럼을 이용하여 추가로 인서트 작업을 해주시면 됩니다.
작업 시간 단축을 위해 조언해 주신 신동진 팀장님 감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6835
6833,[TIP] 마스킹 객체 예제 공유 - 1,"[요약]
- 고객사에서 마스킹 예제를 요청하여 내부 테스트 확인 한 결과 공유 드립니다.
[상세내역]
- 마스킹 전
- 마스킹 후
- 테스트 진행한 마스킹 객체
- 첨부파일 상세 내용
첨부파일
데이터 마스킹 예시 자료_이창제
.xlsx
null
파일 다운로드
이상입니다.
감사합니다.
* 수정이 필요한 부분이나 개선사항이 있다면 댓글로 남겨주시면 감사하겠습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6833
6824,[DBSAFER5][TIP] OS Minimal 설치로 인한 타솔루션 추가 rpm 설치 요구시 TIP (Python 3.6),"1. 고객사 요구사항 (veeam backup 솔루션 기준으로 작성)
- Rocky 8.10 Minimal OS 및 Custom Set 기본 설치되어 있는 환경에서 Veeam backup 솔루션 설치시 Python 3.6 설치가 필요
2. 적용 방안
- 사내 외부 인터넷 연결된 동일한 OS 서버에서 의존성 포함 Python3 rpm 다운로드
# sudo dnf download --resolve python36 python3-pip
- 다운로드된 의존성 포함 rpm 고객사에 DBSAFER 서버에 업로드 및 설치
# rpm -ivh python36-3.6.8-39.module+el8.10.0+1592+61442852.x86_64.rpm --nodeps
# rpm -ivh python3-pip-9.0.3-24.el8.rocky.0.noarch.rpm
# python3 --version
- Veeam backup 솔루션 rpm 설치 지원
# rpm -ivh kmod-veeamsnap-6.2.0.101-1.el8.x86_64.rpm
# rpm -ivh veeam-libs-6.2.0.101-1.x86_64.rpm
# rpm -ivh veeam-6.2.0.101-1.el8.x86_64.rpm",댓글 없음,https://cafe.naver.com/pnpsecure2/6824
6823,[TIP] vormetric 설치되어있을시 dbsafer 설치 방법,"1. 고객사 요구사항
- Vormetric 솔루션이 설치가된 서버에서 DBSAFER를 설치 진행되어야 하는 상황
> Vormetric 암호화가 걸린 상태에서 DBSAFER 설치 불가
* swade의 경우 pnpsecure 자체 솔루션이기 때문에 암호화 대상 디렉터리를 마이그레이션 해주지만 타 암호화 솔루션은 마이그레이션을 해주지 않기 때문에 암호화 대상 디렉터리를 비워놓고 암호화 처리해야합니다.
2. 적용 방안
- Vormetric 가드 경로 확인 (ex] /home/dbsafer/data/mysql)
- Vormetric 가드 설정 해제 요청
- DBSAFER PKG 설치
- /home/dbsafer/data/mysql 경로 데이터베이스 및 파일 타디렉터리로 이관 백업
- Vormetric 가드 설정
- 이관 백업 데이터베이스 및 파일을 가드 경로로 재이관
- 데이터무결성 확인","이민종: (참고) swade의 암호화도 마이그레이션 할 때 대상 디렉터리를 비운 상태에서 작업이 됩니다.
자사 제품이라 정해져 있는 경로를 암호화를 해야 하기 때문에 자동화가 되어 있을 뿐, 절차상으로는 보메트릭과 동일하게 처리됩니다. | 황재필: 추가 답변 감사드립니다.",https://cafe.naver.com/pnpsecure2/6823
6821,[한화비전] - AWS PostgreSQL 15에서 pg_dump.exe를 통한 접속 실패,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타 문의
[고객사/채널사]
한화비전
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크)
- AWS PostgreSQL 15에서 pg_dump.exe를 통한 접속 실패
. dbeaver에서 제공하는 백업 기능을 사용하면 pg_dump.exe 사용하여 접속 시도
. ""SCRAM channel binding check failed"" 오류 발생하며 접속 실패
dbeaver에서 백업 시도 시 발생하는 에러 메시지
cli로 pg_dump를 통한 접속 시 발생하는 에러 메시지
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- SCRAM-SHA256-PLUS 알고리즘을 사용하고 있기 때문에 발생된 것으로 추측
https://cafe.naver.com/pnpsecure2/5747
cafe.naver.com
cafe.naver.com
- 동일 환경에서 옵션 없이 psql를 이용한 접속을 할 때에도 ""SCRAM channel binding check failed"" 오류 발생하며,
""channel_binding=disable"" 옵션을 사용하면 접속 가능
3. 특이사항 (연동 모듈, 커스텀 개발 등)
4. 사내 재현 정보
- 사내 테스트 결과, AWS DB 클러스터 파라미터 옵션 중 rds.force_ssl =1 인 경우에만 접속 오류 발생
. rds.force_ssl =0인 경우 접속 가능
rds.force_ssl =0일 때의 pg_dump 접속 로그
- DBSAFER 서버 접속 정보: 192.168.118.25(root/dbsafer00)
- DB 접속 정보: postgres/dbsafer00
5. 요청사항
- rds.force_ssl =1인 환경에서 pg_dump를 통한 접속은 제약 사항인지 확인 부탁드립니다.
- psql의 ""channel_binding=disable"" 옵션과 동일한 동작을 하는 pg_dump 옵션이 있는지도 확인 부탁드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
- PKG: PKG_DBSAFER7_RelR23.05_RockyLinux_x86_64_P11.11_D2F_ssl30_MariaDB_20240327
- pnp_ssl_proxy R220
- AWS PostgreSQL 15.4
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)",최재규: dbeaver에서 백업을 할때 발생하는 본 이슈는 현재 별도 옵션으로 처리가 불가능한 기존 제약사항으로 확인됩니다.,https://cafe.naver.com/pnpsecure2/6821
6815,백그라운드에서 tomcat_oom_check.sh을 실행하도록 설정하는 방법,"1. 필요상황
- 고객사의 시스템 로그 모니터링 솔루션에서 DBSAFER LOG 서버 /var/log/secure 로그에 'pam_unix(systemd-user:session): session opened for user root' 로그가 5분 주기로 기록되어 이상 행위로 검출
/var/log/secure 로그
* pam_unix.so는 Linux 시스템의 PAM 라이브러리의 하나로 사용자 인증과 관련된 기능을 제공하며
주로 시스템의 /etc/passwd와 /etc/shadow 파일에 저장된 사용자 계정 정보를 사용하여 인증을 처리합니다.
- Redhat 8 환경에서 crontab에 등록된 모든 배치가 실행될 때마다 pam_unix 로그가 기록될 수 있는 것으로 확인(cron 작업이 root 권한으로 실행될 때마다 PAM 세션이 열리고 종료)
- COMMON_UTIL 설치 간 tomcat oom을 체크하는 tomcat_oom_check.sh 스크립트가 crontab에 5분 간격 실행되도록 등록되어 secure 파일에 5분 주기로 pam_unix 로그가 기록됨
(*/5 * * * * /usr/local/apache/bin/tomcat_oom_check.sh)
2. 고객사 요구사항
- 시스템 로그 모니터링 솔루션에서 예외 처리가 불가하여 crontab을 사용하지 않는 방식으로 OOM Check를 요청
3. 적용 방안
- tomcat_oom_check.sh 스크립트를 변형하여 스크립트 자체적으로 5분 주기마다 OOM을 Check 하도록 변형(첨부된 변형 스크립트 파일 사용)
첨부파일
new_tomcat_oom_check
.sh
null
파일 다운로드
- 변형 스크립트를 백그라운드로 실행(nohup /파일경로/new_tomcat_oom_check.sh &)
- /etc/rc.local에 백그라운드 실행 명령어 등록
설정 이후 5분마다 tomcat oom check를 수행하며 /var/log/secure 로그에는 별다른 로그를 기록하지 않습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6815
6807,[공유]웹보고서 에러코드 1020170001,"OZ 리포트 출력시 아래 사진과 같은 에러 발생 시 대처방법 공유
에러코드:1020170001
Fail to connect the TCP-Server(OZ Scheduler)
Connection refused (Connection refused)
#cd /home/reportsvr/ozmng80/bin
#./oz_stop.sh
종료 확인 후
#./oz_start.sh",댓글 없음,https://cafe.naver.com/pnpsecure2/6807
6790,[DBSCANNER] 프로시저 객체 연동 안되는 상황,"[상황]
DBSCANNER 에서 프로시저 스캔 후
아래 화면에서 ""프로시저 객체 추가"" 버튼 클릭 시
Web (dbscanner.war) 모듈은 Server 모듈 (dbscanner.jar) 에 TCP 로 요청하고
Server 모듈은 약속된 경로에 관련 파일을 생성 하도록 되어 있습니다.
/dbsafer/.conf/.sp/ 경로 밑에 파일 생성이 되길 기대했으나 생성되지 않습니다.
[원인]
약속된 경로란 dbprofer.envi_info 테이블에 sp_dir (stored procedure directory) 의 값을 참조하며
dbsafer 환경에서 아래 캡쳐 화면처럼 /dbsafer/.conf/.sp/ .... 가 되어야 합니다.
일부 환경에서 위 값을 조회 해 보면 /infosafer/.conf/.sp/.... 로 설정되어 있는 경우가 있으며
이런 경우 DBSAFER 에서 프로시저 연동이 제대로 동작하지 않게 됩니다.
DBSCANNER 를 INFOSAFER, DBSAFER 양쪽에서 모두 사용하면서 발생한 이슈로 보이며
최초 설치 시 dbsafer mode 로 설치했음에도 /infosafer/.conf/.sp/... 로 들어가는 경우가 있는지 검토해 보겠습니다.
[해결]
- envi_info 의 sp_dir 경로를 /infosafer/.conf/.sp/.... 에서 /dbsafer/.conf/.sp/.... 로 update 하고
- dbscanner 서버 모듈을 재시작 해 주세요.
/home/dbscanner/ 로 이동 후 ./dbsafer_scanner.sh stop ./dbsafer_scanner.sh start",댓글 없음,https://cafe.naver.com/pnpsecure2/6790
6784,[현대백화점그룹] 단독이중화 구성에서 우회접근 로그 게이트웨이 및 정책 기록 관련 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기능로직문의
[고객사/채널사]
현대백화점그룹
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
* LOG/GW + LOG/GW 단독 이중화 구성이며, OPERATION LEVEL 1로 운영중인 환경
- 서버 우회접근 로그가 Terminal 서비스 로그에서 게이트웨이가 Active 서버 IP, Standby 서버 IP가 랜덤으로 찍힘
- 게이트웨이가 Active 서버 IP, Standby 서버 IP중 어떤 서버로 찍히는지에 따라 정책명이 다르게 찍힘
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
3. 특이사항 (연동 모듈, 커스텀 개발 등)
4. 사내 재현 정보
192.168.101.83(Active) + 192.168.101.89(Standby)
5. 요청사항
1. Terminal 서비스 로그에서 조회한 우회접근 로그의 게이트웨이가 Active 서버 IP, Standby 서버 IP 중 랜덤으로 찍히는 게 정상 동작인지, 아니면 일련의 규칙이 있는지 확인 요청드립니다.
2. 우회접근은 실질적으로 DBSAFER 게이트웨이를 경유한 접속이 아니므로 빈 값으로 되어있는 게 바람직할 것 같은데, 빈 값으로 설정하는 방법이 있는지 문의드립니다.
3. 게이트웨이가 Active IP로 찍혀있는 경우 동작과 정책명이 접속 정보에 부합하는 Terminal 접속제어정책명과 동작으로 로깅되나, 게이트웨이가 Standby IP로 찍혀있는 경우 Default로 찍히거나 아예 다른 정책명으로 로깅됩니다.
pnp_policysync 모듈에 의해 정책정보는 모두 동기화중인데, 게이트웨이에 따라 정책명이 상이하게 로깅되는 원인 확인 요청드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
DBSAFER 5.0 RelR22.11-RHEL8
pnp_server_manager 5.1.6.50
Server Agent 5.1.6.x
pnp_agent Rev1170
pnp_log Rev778
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","김태윤: 해당 이슈의 경우에 standby 서버쪽 정책 동기화는 되었으나, 변경 시그널이 없어 발생한 이슈로 보여집니다.
standby 서버에서 명령어 실행 후 확인 바랍니다.

[수행 명령어]
pnp_agent policy-reload
pnp_agent policy-broadcast",https://cafe.naver.com/pnpsecure2/6784
6779,AWS Redshift 접속 간 'SSL error: PKIX path building failed' 에러 발생 시 체크사항,"1. 버전
- pnp_ssl_proxy rev.212
- pnp_postgresql rev.2567
- DBSAFER5
2. 현상
AWS Redshift DB 접속 시도 시 'java.sql.SQLException: SSL error: PKIX path building failed' 메시지 발생 및 접속 불가 현상
3. 원인
pnp_ssl_proxy을 통해 AWS redshift DB 접속 시 사용자 <-> DBSAFER 세션 연결 과정에서 DBSAFER 자체 인증서를 사용하게 되어 Redshift JDBC URL에 SSL 인증서 검증을 비활성화하는 옵션을 추가하여야 하나 해당 옵션이 추가되지 않아 발생
4. 조치 방안
DB툴에서 Redshift JDBC URL에 SSL 인증서 검증을 비활성화하는 옵션을 추가하여 접속
- Dbeaver 사용 시 옵션 추가 방법
- intellij 사용 시 옵션 추가 방법
접속 jdbc url 입력 란에 ssl=true 옵션과 sslfactory=com.amazon.redshift.ssl.NonValidatingFactory 옵션을 적용
* url 입력 예시
jdbc:redshift://<your-redshift-cluster>:5439/dev?ssl=true&sslfactory=com.amazon.redshift.ssl.NonValidatingFactory
해당 설정 후 DB 접속 및 세션/명령어 로깅 정상 확인",댓글 없음,https://cafe.naver.com/pnpsecure2/6779
6776,PC Assist 사일런트 자동 재설치 방법 공유,"PC Assist 사일트 자동 재설치 방법 공유 드립니다.
pnp_update_server모듈을 활용한 방법이며, 기존 업데이트 방식을 사용하는 것이 아닌 재설치를 사용하여야 하는 이유는 PC Asisst 3.2 -> 3.3 업데이트 시 메이저 버전이 변경되는 것이기 때문에 정확히 어떠한 파일들이 업데이트 대상인지 확인이 안될 경우 혹은 업데이트보다는 재설치를 통해 확실한 업데이트를 진행하기 위함입니다.
WinRAR를 통해서 자동재설치파일을 생성하게 되며, 필요파일은 아래와 같습니다.
1. PC Assist 설치파일
2. dsastkill.exe
3. uninstall.iss
4. UpdateList.bat
5. UpdateWithOutConsole.vbs
위 파일들은 한성현 과장님께 전달받은 파일들이며, 파일 및 가이드는 첨부파일을 확인 부탁드립니다.
감사합니다.
첨부파일
UpdateWithOutConsole
.vbs
null
파일 다운로드
첨부파일
UpdateList
.bat
null
파일 다운로드
첨부파일
uninstall
.iss
null
파일 다운로드
첨부파일
dsastkill
.exe
null
파일 다운로드
첨부파일
[세미나]PC Assist 자동 재설치 방법
.pptx
null
파일 다운로드",댓글 없음,https://cafe.naver.com/pnpsecure2/6776
6770,"SSH key 업로드 방식에서 key manager 방식으로 전환될 때, SSH key 그룹 자동 생성 방법 공유","[요약]
- 기존에 SSH 키 접속 방식을 사용할 때는, SSH 키 파일을 서버 IP와 계정명을 기준으로 /dbsafer/.conf/ssh_key 경로에 [Server IP]_[계정명].key 형식으로 저장
. 참고 URL: https://cafe.naver.com/pnpsecure2/2237
- ssh 모듈 패치(sshd -> ssh_proxy), OS 이관 작업 등으로 인해 key_manager를 사용하게 되는 경우, DBSAFER 서버 내에 저장되어있던 [Server IP]_[계정명].key 파일을 매니저 프로그램에 등록해야 함
- 서비스 수가 많아질수록 같은 인증 키를 사용하는 서버를 그룹화하고 매니저 프로그램에 등록하는 과정에 많은 시간이 소요됨
- 이 작업을 단축하기 위해, 파이썬 스크립트를 사용해 SSH 키 파일의 해시값을 기반으로 서버 그룹을 자동 생성하는 방법을 구현함
[착안점]
- 보통 5개 이하의 SSH 키 파일을 여러 서버에서 사용하는 경우가 많음(파일의 이름은 다르지만, 실제로 동일한 파일)
(예시) 같은 내용을 가진 파일은 동일한 색으로 표시
- key_manager를 사용하게 되면 SSH 키 파일을 사용하는 서버를 그룹화하여, ""SSH 인증키 관리""에 등록해야 함
[스크립트 작성 과정]
STEP 1) 먼저, 같은 키 파일을 가진 서버끼리 그룹화해보자
- 키 파일 내용이 같으면 해시 값도 같으니 파일의 해시 값을 기준으로 파일 그룹화 시도
. 사용 명령어
# /dbsafer/.conf/ssh_key 파일 백업
cp -rip /dbsafer/.conf/ssh_key /root/test/ssh_key
# key 파일이 저장된 곳에서 아래 명령어 실행
cd /root/test/ssh_key
# 그룹 저장을 위한 디렉토리 생성
mkdir -p groups
# 파일 해시 값 계산 및 그룹화
for file in *; do
hash=$(md5sum ""$file"" | awk '{print $1}')  # 해시 값 계산
echo ""$hash $file"" >> hash_list.txt        # 해시 값과 파일 명 저장
done
# 해시 값 기준으로 파일을 그룹화
awk '{print $1}' hash_list.txt | sort | uniq | while read hash; do
mkdir -p ""groups/$hash""  # 해시 값 폴더 생성
grep ""^$hash"" hash_list.txt | awk '{print $2}' | xargs -I {} cp {} ""groups/$hash/""  # 같은 해시 값인 파일 이동
done
# 불필요 폴더/파일 삭제
rm -rf  groups/groups
rm -rf hash_list.txt
. 적용 결과
(전) 적용 전 / (우) 적용 후
- 그룹화된 목록을 보고 설정하려고 하니, 수동으로 설정하기 헷갈림
. 서버 수량이 너무 많고, 삭제된 서버도 포함되어있어 번거로움
. 같은 키를 사용하는 서버끼리 그룹을 만들어줄 수 없을까?
STEP 2) DBSAFER 서비스 목록을 CSV 파일로 내보내기 해서 그 파일을 수정해보자!
- 기존 서비스 목록을 CSV 파일로 내보내기해서 수정할 대상 확인
. 2열 [Type] 값이 ""TERMINAL
. 10열 [Server IP]값이 키 파일 명([Server IP]_[계정명].key)과 일치하는 서비스
. 위의 조건과 일치하는 서버의 [Group]에 그룹명 추가
STEP 3) CSV 파일과 키 파일의 경로를 입력했을 때 수정된 CSV 파일이 생성되는 파이썬 코드 작성
- 코드 요약
1) 파일 해시 값 생성: file_hash 함수는 주어진 파일의 MD5 해시 값을 계산하여 반환
2) 키 그룹 생성: ssh_key 폴더 내 .key 확장자를 가진 파일을 읽고, 파일명에서 service_ip 값을 추출한 뒤, 해시값을 기준으로 같은 해시를 가진 파일들을 그룹화하여 file_groups 딕셔너리에 저장
3) CSV 파일 수정: 원본 csv_file.csv 파일을 읽고, 특정 조건을 만족하는 경우 새로운 그룹 정보를 Group 열에 추가한 뒤, 수정된 데이터를 new_csv_file.csv 파일에 작성
new_csv_file.csv 수정 로직
import os
import hashlib
import csv
# 파일 내용으로 MD5 해시 값을 생성하는 함수
def file_hash(filepath):
hasher = hashlib.md5()
with open(filepath, 'rb') as f:
buf = f.read()
hasher.update(buf)
return hasher.hexdigest()
# ssh_key 폴더 경로와 CSV 파일 경로 설정
ssh_key_folder = '/root/test/ssh_key'  # ssh_key 폴더 경로
csv_file_path = '/root/test/csv_file.csv'  # CSV 파일 경로
new_csv_file_path = '/root/test/new_csv_file.csv'  # 새로운 CSV 파일 경로
# 파일 해시 값을 기반으로 동일한 파일끼리 그룹 생성
file_groups = {}
for filename in os.listdir(ssh_key_folder):
if filename.endswith("".key""):
service_ip = filename.split('_')[0]
filepath = os.path.join(ssh_key_folder, filename)
file_hash_value = file_hash(filepath)
if file_hash_value in file_groups:
file_groups[file_hash_value].append(service_ip)
else:
file_groups[file_hash_value] = [service_ip]
# CSV 파일 수정
with open(csv_file_path, 'r', newline='') as csvfile:
reader = csv.reader(csvfile)
header = next(reader)
rows = list(reader)
# 그룹 정보를 새로운 CSV 파일에 반영
with open(new_csv_file_path, 'w', newline='') as csvfile:
writer = csv.writer(csvfile)
writer.writerow(header)
for row in rows:
service_type = row[1]  # Type 열이 2번째 위치
server_ip = row[9]  # Server IP 열이 10번째 위치
current_group = row[7]  # Group 열이 8번째 위치
group_to_add = None
# Type이 TERMINAL인 경우에만 처리
if service_type == ""TERMINAL"":
# V5에서 V7로 업그레이드하는 작업이었기 때문에 Type을 SSH로 변경
row[1] = ""SSH""
# 파일 그룹에 있는지 확인
for group, ips in file_groups.items():
if server_ip in ips:
group_to_add = '[key]' + group
break
# 그룹 정보가 있으면 기존 그룹에 추가 또는 새로운 그룹 입력
if group_to_add:
if current_group:
row[7] = current_group + ',' + group_to_add
else:
row[7] = group_to_add
writer.writerow(row)  # 수정된 행 작성
[적용 결과]
- Terminal이 SSH로 변경되었으며, 서비스 그룹이 정상적으로 추가됨
(전) 적용 전(csv_file.csv) / (우) 적용 후(new_csv_file.csv)
- 매니저 불러오기 기능으로 서비스 그룹 추가 후 해시값으로 생성된 서비스 그룹명 변경
- 서비스 그룹 기준으로 SSH 인증 키 등록",댓글 없음,https://cafe.naver.com/pnpsecure2/6770
6769,[공유] 신한은행 CBDC 2차 인증(Google OTP+몰리메이트 OTP) 적용 사례 공유,"안녕하세요. 클라우드기술팀 김영은입니다.
신한은행 CBDC 2차 인증(Google OTP+몰리메이트 OTP) 적용 사례 공유드립니다.
추가로 필요한 내용이 있으신 경우 댓글 혹은 개인 라인 부탁드립니다.
[적용 배경]
- 신한 CBDC 사업 건에서는 외부 사용자가 많기 때문에 1차 인증은 DBSAFER 보안 계정으로 진행 후 2차 인증(몰리메이트/Google OTP) 적용 요청
. 내부 직원은 몰리메이트 OTP 인증, 외주 직원은 Google OTP 인증 적용
[설정 방법]
1. 사용 패키지 정보
- saferuas.war.shinhanbank.2.0.75.0_2256_202410281711.tgz
(https://bbs.pnpsecure.com/showthread.php?tid=12452)
- dll 파일(dasitelk.dll, libcrypto-3.dll, libssl-3.dll, MagicCrypto.dll)
첨부파일
shinhanbankCBDC
.zip
null
파일 다운로드
2. saferuas 엔지니어 페이지 설정
- saferuas 에서 기본적으로 제공하는 ""Mail"" 방식을 ""몰리메이트 OTP"" 로 변경하여 개발됨
- 사용자 2차 인증: 보안계정 별 2차인증
- 상세 설정
. OTP: Google OTP 별도 페이지 키 발급
. 몰리메이트 OTP: 기본 설정 유지
3. Enterprise Manager 시스템 설정
- 시스템 설정 > 보안계정 인증 설정 > 사용자 인증: 1회 인증 > 메일, OTP 체크
- 2차인증-Mail 명칭 변경: 몰리메이트
4. 보안계정 휴대전화번호 설정
- 보안계정의 휴대전화번호를 기준으로 몰리메이트 인증 서버에 요청 전송
- 2차 인증으로 몰리메이트 OTP를 적용하는 사용자는 휴대전화번호 입력 필수
보안계정 휴대전화번호 설정하지 않을 때 발생하는 메시지
[적용 화면]
[참고#1] 기능 수정 벅스 URL
- https://bugs.pnpsecure.com/view.php?id=29130
- https://bugs.pnpsecure.com/view.php?id=29162
[참고#2] 기존 신한 전용 saferuas 인증 로직
1. 1차 인증: 사이트 연동 - Swing(골드윙)
- Swing 인증 시, 입력받은 사용자 ID(보안계정) 앞에 COMPANY_CODE(SH,SY,TF)를 붙여 순서대로 인증 시도
2. 2차 인증: Google OTP / SMS / 몰리메이트 OTP
- saferuas 에서 기본적으로 제공하는 ""Mail"" 방식을 ""몰리메이트 OTP"" 로 변경하여 개발됨
- Google OTP 키 발급 시에도 Swing 인증 진행
* 패키지 정보
- saferuas: saferuas.war.shinhanbank.2.0.74.0_2255_202401121447.tgz
- dasitelk.dll: https://bbs.pnpsecure.com/showthread.php?tid=8030",댓글 없음,https://cafe.naver.com/pnpsecure2/6769
6767,pnp_mailer 적용 후 특정 시점 이후 메일 전송 오류 발생 시 확인 사항,"[이슈 내용]
1. pnp_mailer 를 통한 2차인증 OTP 인증 메일 수신안됨.
- 최초 세팅 시 정상 동작하였으나 어느 시점부터 메일이 수신되지 않음.
- SEVERE: MESSAGING ERROR, javax.mail.AuthenticationFailedException: ; 오류 확인
2. 고객사 mailer 버전 정보
- 1.3.13(r241)
[확인 사항]
1. SMTP 서버 확인
- 이상 없음.
2. SMTP 서버 계정 정보 및 통신 방식 변경 사항 확인
- 해당사항 없음.
3. mailer debug 로그 확인
- SMTP 서버 로그인 오류 관련 에러 메시지 발생
----------------------------------------------------------------------------------------------------------------------------------
[root@XXXXX-security dbsafer]# ./pnp_mailer.sh test
Test send mail message.
MailAddress:eblim@pnpsecure.com
cy-file version: 1.0.1.802
Oct 29, 2024 10:15:57 AM com.pnpsecure.dbsafer.mailer.Configure loadLangConfig
INFO: Lang Configure is - Language: KOREAN, Mail form: .conf/mail_form.txt, Charset: utf-8
Oct 29, 2024 10:15:57 AM com.pnpsecure.dbsafer.mailer.Configure checkNumberParameter
INFO: Set parameter value as default value. [paramName]smtpProtocol[value]0
DEBUG: JavaMail version 1.5.6
DEBUG: successfully loaded resource: /META-INF/javamail.default.providers
DEBUG: Tables of loaded providers
DEBUG: Providers Listed By Class Name: {com.sun.mail.smtp.SMTPSSLTransport=javax.mail.Provider[TRANSPORT,smtps,com.sun.mail.smtp.SMTPSSLTransport,Oracle], com.sun.mail.smtp.SMTPTransport=javax.mail.Provider[TRANSPORT,smtp,com.sun.mail.smtp.SMTPTransport,Oracle], com.sun.mail.imap.IMAPSSLStore=javax.mail.Provider[STORE,imaps,com.sun.mail.imap.IMAPSSLStore,Oracle], com.sun.mail.pop3.POP3SSLStore=javax.mail.Provider[STORE,pop3s,com.sun.mail.pop3.POP3SSLStore,Oracle], com.sun.mail.imap.IMAPStore=javax.mail.Provider[STORE,imap,com.sun.mail.imap.IMAPStore,Oracle], com.sun.mail.pop3.POP3Store=javax.mail.Provider[STORE,pop3,com.sun.mail.pop3.POP3Store,Oracle]}
DEBUG: Providers Listed By Protocol: {imaps=javax.mail.Provider[STORE,imaps,com.sun.mail.imap.IMAPSSLStore,Oracle], imap=javax.mail.Provider[STORE,imap,com.sun.mail.imap.IMAPStore,Oracle], smtps=javax.mail.Provider[TRANSPORT,smtps,com.sun.mail.smtp.SMTPSSLTransport,Oracle], pop3=javax.mail.Provider[STORE,pop3,com.sun.mail.pop3.POP3Store,Oracle], pop3s=javax.mail.Provider[STORE,pop3s,com.sun.mail.pop3.POP3SSLStore,Oracle], smtp=javax.mail.Provider[TRANSPORT,smtp,com.sun.mail.smtp.SMTPTransport,Oracle]}
DEBUG: successfully loaded resource: /META-INF/javamail.default.address.map
Oct 29, 2024 10:15:57 AM com.pnpsecure.dbsafer.mailer.Configure load
INFO: Configuration is - Configurations (DbUrl:jdbc:mysql://172.25.X.XXX:3306/dbsafer3?zeroDateTimeBehavior=convertToNull&useUnicode=true&characterEncoding=utf-8)(DbUser:safeusr)(DbPasswd:**********)(mailType:com.pnpsecure.dbsafer.mailer.MailSenderSmtp)(server:smtp.mailplug.co.kr)(port:465)(mail:********)(login:2)(loginpw:********)(secure:1)(skipInterval:0)(smtptimeout:5000)(smtpProtocol:SMTP)(secureConnection:SSL)(retry_count:3)(retry_interval:10)(mail_title:)(view_org_query:0)(set_charterset_command:false)(product_type:0)(delaySendTime:20)(serverCharterset:)(maxRtnLength:100000)(maxRtnRowLength:100)(maxRtnFieldDataLength:1000)
DEBUG: getProvider() returning javax.mail.Provider[TRANSPORT,smtp,com.sun.mail.smtp.SMTPTransport,Oracle]
DEBUG SMTP: need username and password for authentication
DEBUG SMTP: protocolConnect returning false, host=smtp.mailplug.co.kr, user=root, password=<null>
DEBUG SMTP: useEhlo true, useAuth true
DEBUG SMTP: trying to connect to host ""smtp.mailplug.co.kr"", port 465, isSSL true
220 mailpx07 ESMTP ready
DEBUG SMTP: connected to host ""smtp.mailplug.co.kr"", port: 465
EHLO XXXXX-security
250-mailpx07
250-STARTTLS
250-AUTH LOGIN PLAIN
250-AUTH=LOGIN PLAIN
250-PIPELINING
250-8BITMIME
250 AUTH PLAIN LOGIN
DEBUG SMTP: Found extension ""STARTTLS"", arg """"
DEBUG SMTP: Found extension ""AUTH"", arg ""LOGIN PLAIN""
DEBUG SMTP: Found extension ""AUTH=LOGIN"", arg ""PLAIN""
DEBUG SMTP: Found extension ""PIPELINING"", arg """"
DEBUG SMTP: Found extension ""8BITMIME"", arg """"
DEBUG SMTP: Found extension ""AUTH"", arg ""PLAIN LOGIN""
DEBUG SMTP: protocolConnect login, host=smtp.mailplug.co.kr, user=user_id@XXXXX.com, password=<non-null>
DEBUG SMTP: Attempt to authenticate using mechanisms: LOGIN
DEBUG SMTP: Using mechanism LOGIN
DEBUG SMTP: AUTH LOGIN command trace suppressed
DEBUG SMTP: exception reading response, THROW:
java.net.SocketTimeoutException: Read timed out
at java.base/java.net.SocketInputStream.socketRead0(Native Method)
at java.base/java.net.SocketInputStream.socketRead(SocketInputStream.java:115)
at java.base/java.net.SocketInputStream.read(SocketInputStream.java:168)
at java.base/java.net.SocketInputStream.read(SocketInputStream.java:140)
at java.base/sun.security.ssl.SSLSocketInputRecord.read(SSLSocketInputRecord.java:484)
at java.base/sun.security.ssl.SSLSocketInputRecord.readHeader(SSLSocketInputRecord.java:478)
at java.base/sun.security.ssl.SSLSocketInputRecord.bytesInCompletePacket(SSLSocketInputRecord.java:70)
at java.base/sun.security.ssl.SSLSocketImpl.readApplicationRecord(SSLSocketImpl.java:1459)
at java.base/sun.security.ssl.SSLSocketImpl$AppInputStream.read(SSLSocketImpl.java:1070)
at com.sun.mail.util.TraceInputStream.read(TraceInputStream.java:124)
at java.base/java.io.BufferedInputStream.fill(BufferedInputStream.java:252)
at java.base/java.io.BufferedInputStream.read(BufferedInputStream.java:271)
at com.sun.mail.util.LineInputStream.readLine(LineInputStream.java:92)
at com.sun.mail.smtp.SMTPTransport.readServerResponse(SMTPTransport.java:2349)
at com.sun.mail.smtp.SMTPTransport.simpleCommand(SMTPTransport.java:2299)
at com.sun.mail.smtp.SMTPTransport$LoginAuthenticator.doAuth(SMTPTransport.java:967)
at com.sun.mail.smtp.SMTPTransport$Authenticator.authenticate(SMTPTransport.java:909)
at com.sun.mail.smtp.SMTPTransport.authenticate(SMTPTransport.java:843)
at com.sun.mail.smtp.SMTPTransport.protocolConnect(SMTPTransport.java:748)
at javax.mail.Service.connect(Service.java:388)
at javax.mail.Service.connect(Service.java:246)
at javax.mail.Service.connect(Service.java:195)
at javax.mail.Transport.send0(Transport.java:254)
at javax.mail.Transport.send(Transport.java:124)
at com.pnpsecure.dbsafer.mailer.MailSenderSmtp.sendMail(MailSenderSmtp.java:400)
at com.pnpsecure.dbsafer.mailer.MailSenderSmtp.sendMail(MailSenderSmtp.java:340)
at com.pnpsecure.dbsafer.mailer.Main.testMail(Main.java:402)
at com.pnpsecure.dbsafer.mailer.Main.checkArguments(Main.java:204)
at com.pnpsecure.dbsafer.mailer.Main.main(Main.java:119)
DEBUG SMTP: AUTH LOGIN failed, THROW:
javax.mail.MessagingException: Exception reading response;
nested exception is:
java.net.SocketTimeoutException: Read timed out
at com.sun.mail.smtp.SMTPTransport.readServerResponse(SMTPTransport.java:2369)
at com.sun.mail.smtp.SMTPTransport.simpleCommand(SMTPTransport.java:2299)
at com.sun.mail.smtp.SMTPTransport$LoginAuthenticator.doAuth(SMTPTransport.java:967)
at com.sun.mail.smtp.SMTPTransport$Authenticator.authenticate(SMTPTransport.java:909)
at com.sun.mail.smtp.SMTPTransport.authenticate(SMTPTransport.java:843)
at com.sun.mail.smtp.SMTPTransport.protocolConnect(SMTPTransport.java:748)
at javax.mail.Service.connect(Service.java:388)
at javax.mail.Service.connect(Service.java:246)
at javax.mail.Service.connect(Service.java:195)
at javax.mail.Transport.send0(Transport.java:254)
at javax.mail.Transport.send(Transport.java:124)
at com.pnpsecure.dbsafer.mailer.MailSenderSmtp.sendMail(MailSenderSmtp.java:400)
at com.pnpsecure.dbsafer.mailer.MailSenderSmtp.sendMail(MailSenderSmtp.java:340)
at com.pnpsecure.dbsafer.mailer.Main.testMail(Main.java:402)
at com.pnpsecure.dbsafer.mailer.Main.checkArguments(Main.java:204)
at com.pnpsecure.dbsafer.mailer.Main.main(Main.java:119)
Caused by: java.net.SocketTimeoutException: Read timed out
at java.base/java.net.SocketInputStream.socketRead0(Native Method)
at java.base/java.net.SocketInputStream.socketRead(SocketInputStream.java:115)
at java.base/java.net.SocketInputStream.read(SocketInputStream.java:168)
at java.base/java.net.SocketInputStream.read(SocketInputStream.java:140)
at java.base/sun.security.ssl.SSLSocketInputRecord.read(SSLSocketInputRecord.java:484)
at java.base/sun.security.ssl.SSLSocketInputRecord.readHeader(SSLSocketInputRecord.java:478)
at java.base/sun.security.ssl.SSLSocketInputRecord.bytesInCompletePacket(SSLSocketInputRecord.java:70)
at java.base/sun.security.ssl.SSLSocketImpl.readApplicationRecord(SSLSocketImpl.java:1459)
at java.base/sun.security.ssl.SSLSocketImpl$AppInputStream.read(SSLSocketImpl.java:1070)
at com.sun.mail.util.TraceInputStream.read(TraceInputStream.java:124)
at java.base/java.io.BufferedInputStream.fill(BufferedInputStream.java:252)
at java.base/java.io.BufferedInputStream.read(BufferedInputStream.java:271)
at com.sun.mail.util.LineInputStream.readLine(LineInputStream.java:92)
at com.sun.mail.smtp.SMTPTransport.readServerResponse(SMTPTransport.java:2349)
... 15 more
DEBUG SMTP: AUTH LOGIN failed
Oct 29, 2024 10:16:03 AM com.pnpsecure.dbsafer.mailer.MailSenderSmtp sendMail
SEVERE: MESSAGING ERROR
javax.mail.AuthenticationFailedException: ;
nested exception is:
javax.mail.MessagingException: Exception reading response;
nested exception is:
java.net.SocketTimeoutException: Read timed out
at com.sun.mail.smtp.SMTPTransport$Authenticator.authenticate(SMTPTransport.java:927)
at com.sun.mail.smtp.SMTPTransport.authenticate(SMTPTransport.java:843)
at com.sun.mail.smtp.SMTPTransport.protocolConnect(SMTPTransport.java:748)
at javax.mail.Service.connect(Service.java:388)
at javax.mail.Service.connect(Service.java:246)
at javax.mail.Service.connect(Service.java:195)
at javax.mail.Transport.send0(Transport.java:254)
at javax.mail.Transport.send(Transport.java:124)
at com.pnpsecure.dbsafer.mailer.MailSenderSmtp.sendMail(MailSenderSmtp.java:400)
at com.pnpsecure.dbsafer.mailer.MailSenderSmtp.sendMail(MailSenderSmtp.java:340)
at com.pnpsecure.dbsafer.mailer.Main.testMail(Main.java:402)
at com.pnpsecure.dbsafer.mailer.Main.checkArguments(Main.java:204)
at com.pnpsecure.dbsafer.mailer.Main.main(Main.java:119)
Caused by: javax.mail.MessagingException: Exception reading response;
nested exception is:
java.net.SocketTimeoutException: Read timed out
at com.sun.mail.smtp.SMTPTransport.readServerResponse(SMTPTransport.java:2369)
at com.sun.mail.smtp.SMTPTransport.simpleCommand(SMTPTransport.java:2299)
at com.sun.mail.smtp.SMTPTransport$LoginAuthenticator.doAuth(SMTPTransport.java:967)
at com.sun.mail.smtp.SMTPTransport$Authenticator.authenticate(SMTPTransport.java:909)
... 12 more
Caused by: java.net.SocketTimeoutException: Read timed out
at java.base/java.net.SocketInputStream.socketRead0(Native Method)
at java.base/java.net.SocketInputStream.socketRead(SocketInputStream.java:115)
at java.base/java.net.SocketInputStream.read(SocketInputStream.java:168)
at java.base/java.net.SocketInputStream.read(SocketInputStream.java:140)
at java.base/sun.security.ssl.SSLSocketInputRecord.read(SSLSocketInputRecord.java:484)
at java.base/sun.security.ssl.SSLSocketInputRecord.readHeader(SSLSocketInputRecord.java:478)
at java.base/sun.security.ssl.SSLSocketInputRecord.bytesInCompletePacket(SSLSocketInputRecord.java:70)
at java.base/sun.security.ssl.SSLSocketImpl.readApplicationRecord(SSLSocketImpl.java:1459)
at java.base/sun.security.ssl.SSLSocketImpl$AppInputStream.read(SSLSocketImpl.java:1070)
at com.sun.mail.util.TraceInputStream.read(TraceInputStream.java:124)
at java.base/java.io.BufferedInputStream.fill(BufferedInputStream.java:252)
at java.base/java.io.BufferedInputStream.read(BufferedInputStream.java:271)
at com.sun.mail.util.LineInputStream.readLine(LineInputStream.java:92)
at com.sun.mail.smtp.SMTPTransport.readServerResponse(SMTPTransport.java:2349)
... 15 more
Oct 29, 2024 10:16:03 AM com.pnpsecure.dbsafer.mailer.MailSenderSmtp sendMail
SEVERE: Failed Send mail. retry(1/3). no(0)
----------------------------------------------------------------------------------------------------------------------------------
4. SMTP 설정 확인
- POP3/SMTP 사용 설정 : '사용 안 함'
- 30일간 사용 기록이 없을 경우 자동 전환되도록 설정되어 있어 기존 정상 동작하다가 30일이 지난 특정 시점에 '사용 안함' 으로 변경된 것으로 추측
[조치]
1. POP3/SMTP 사용 설정 '사용'으로 변경 후, 메일 정상 발신 및 수신 확인
[결론]
1. 고객사 개인 도메인으로 DBSAFER 메일연동 시, 해당 계정의 SMTP 설정이 잠기지 않도록 확인하시기 바랍니다.
https://imweb.me/faq?mode=view&category=29&category2=34&idx=72051
개인 도메인으로 자동 메일 발송하기 (사용자 지정 SMTP 설정)
아임웹으로 만든 사이트에 자동 메일 발송 설정을 마쳤다면, 내 사이트에서 회원가입, 주문, 게시판 글쓰기 등의 회원 활동이 발생했을 때, 아임웹은 운영자와 회원(또는 비회원)에게
imweb.me
[참고]
1. pnp_mailer.sh 디버그 로그 수집 방법
- pnp_mailer.sh 스크립트 내 '-Dmail.debug=true' 옵션 추가 후 모듈 재기동
이슈 해결에 도움주신 유현진 사원님 감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6767
6760,"[카카오페이증권] [IM/WORKS] IM/WORKS페이지 접속 시, ASSIST HOST 무한 다운로드 요청 현상(MAC PC인 경우)","[이슈 내용]
-이미 Assist_host는 설치되어 있으나 특정 사용자PC에서 IM/WORKS 웹페이지 접속 > ASSIST HOST 무한 다운로드 요청이 계속해서 발생하는 현상
-ASSIST HOST 설치/재설치/설치 후 PC 재부팅 등 다양한 방법으로 시도해보았으나 다운로드 창이 계속 발생하여 IM/WORKS접속이 불가한 상황
-크롬 발생
[증상]
- AssistHost는 이미 설치가 되어 있는 상태
[확인 내역]
1. 로컬PC의 설치된 Assist Host와 웹이 통신이 되는지 확인
https://127.0.0.1:22113/api/svc/getversion
> 정상인 경우 : Assist Host의 버전이 출력됨
> 비정상인 경우 : ”이 페이지를 표시할 수 없음”으로 출력
2. PC에 Assist Host 설치 여부확인
3. 문제의 PC에서 22113,22114포트가 정상적으로 리슨중인지 확인
4. ASSIST HOST 강제 삭제
[삭제방법]
1. Terminal 실행
2. ""/Applications/PCAssist/AssistHost.app/Contents/MacOS/Uninstall-AssistHost.tool"" 실행
5. 인증서 삭제
- Pnpsecure CA 인증서 삭제
[분석 결과]
1. 원인 :
-키체인에 등록된 인증서가 삭제 되지 않고 새로 설치할 인증서가 등록되지 않으면서 무한 설치 팝업이 표시됨
2. 조치내용 :
-기존 Assist_Host 삭제, 인증서 삭제 후 PC재부팅 이후 새로 설치 이후 정상 동작
3. 추후 대응
- 미정
[참고사항]
- Assist_host.pkg는 productsign으로 Sign되어 있습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6760
6757,[수협중앙회] pnp_galera 깨짐 이슈 확인 요청,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
에러 문의
[고객사/채널사]
수협중앙회
[버전]
- Custom_Set : CustomSet_Rocky8.7_20240603.cpio.gz
- AM : PKG_DBSAFER7_RelR23.05_RockyLinux_x86_64_P11.11_D2F_ssl30_MariaDB_20240524.tar
- Common_Util : COMMON_UTIL_V2.38_build-1_20240430.tgz
- pnp_galera : Rev27
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
- 사용자 2차 인증 에러 및 관리자 매니저 접속 오류 발생
2. 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- GW / LOG 서버 프로세스 확인
- saferuas / DBSAFER AGENT / EnterpriseManager 로그 확인 시 DB의 데이터를 정상적으로 조회 못하는 증상 확인
- safeusr로 DB 접속 확인 및 show processlist 명령어를 통해 DB 상태 확인
- pnp_galera 확인 진행
: LOG1 pnp_galera dbms-status 확인 시 IP 정보가 없는 것을 확인
: LOG2 pnp_galera dbms-status 확인 시 LOG2 IP 정보만 있는 것을 확인
: grastate.dat 확인
: [hostname].err 확인
> splitbrain 증상으로 보이는 로그 확인 되어 QA 및 개발자에게 확인 요청
- 개발자와 확인 후 LOG1 복구
- LOG2 서버 복구 진행하였으나, DB 실행 지속적으로 실패 확인
- LOG1 서버의 As-Is 데이터(old_dbsafer_log_yyyy_mm) 마이그레이션한 상태
: As-Is(dbsafer5.0) > To-Be로 데이터 마이그레이션하여 OLD DB 데이터가지고 있었음
: 해당 OLD DB 데이터 LOG1에서 전부
삭제 후 정상 복구
> 해당 사항에 대하여 개발자에게 확인 요청(정대한선임에게 확인 요청 상태)
3. 예상 원인
- [hostname].err 로그 확인 시 LOG1과 LOG2의 dbsafer_log_2024_11.was_hash_bind_07 테이블에 대하여 Primary 값이 같아 발생한 것으로 예상
> 현재 로그 반출하여 분석 요청한 상태입니다. (정대한선임님에게 요청 상태)
> 해당 내용 관련 정확한 원인이 나올 경우 수정하여 공유하겠습니다.
5. 요청사항
해당 증상에 대하여 발생 원인 분석 요청
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
- [hostname].err 파일 첨부하였습니다.
첨부파일
241106
.zip
null
파일 다운로드",여성구: pnp_log 모듈에서 테이블 생성 시에 pnp_ha 상태를 보고 마스터에서만 생성이 되어야 한다고 합니다. | 여성구: 상기 건 메일로 연구소와 분석이 된 것으로 확인하여 답변완료로 하였습니다.,https://cafe.naver.com/pnpsecure2/6757
6755,관리 대상 서버 모니터링에서 OS 정보가 Unknown으로 표시되는 현상,"1. 현상
- 대상 서버에 Server Agent 설치 이후 '관리 대상 서버 모니터링'에서 대상 서버의 OS 정보가 Unknown으로 표시
2. 원인
- 대상서버가 Windows Server 2022이고 pnp_server_manager 모듈이 2022년도 이전에 Build된 모듈일 경우 Windows Server 2022 식별 정보가 없어 위 현상 발생
이슈 발생 버전
3. 조치
- pnp_server_manager 모듈 최신 패치 후 '관리 대상 모니터링'에서 'Win2022' 정상 표시 확인
(pnp_server_manager V5.1.6.42 이상 부터 현상 발생하지 않음)",댓글 없음,https://cafe.naver.com/pnpsecure2/6755
6750,"[TIP] Manager 관리자 계정 2차인증(SMS) 발급 버튼 누르면 ""Database Error"" 출력되는 현상 문의 드립니다.","[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
대우건설
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
- Manager 관리자 계정 2차인증(SMS) 발급 버튼 누르면 ""Database Error"" 출력되는 현상
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- 보안계정 사용자들은 정상적으로 SMS 인증 후 로그인되는 부분 확인
- 관리자 계정만 SMS 인증 발급이 안되는 상황이며, 관리자 계정 OTP 인증은 정상적으로 처리됨
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 기존 AS-IS의 LOG서버의 /home/webapps/ 위치에 dbsaferim/dbsaferim.war 존재 (이전/현재 IM 사용 x)
- 신규 TO-BE의 LOG서버에는 이전 dbsaferim/dbsaferim.war 동일하게 존재
> 매니저 로그상에 IM 관련 테이블 내용이 있어 기재하였습니다.
4. 사내 재현 정보
5. 요청사항
- Manager 관리자 계정 2차인증(SMS) 진행 시 ""Database Error"" 발생하는 이유 확인 요청드립니다.
- Manager 에서 2차인증 진행 시 IM 관련 영향도가 있는지 확인 요청드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
> 전달드린 로그 파일에 찍혀있는 시간은 다르나, 동일한 과정 수행했을 때 발생한 로그 입니다.
[매니저 로그]
2024_10_29 10:56:08 [ F ] : Before Load Skin
2024_10_29 10:56:08 [ F ] : Afeter Load Skin
2024_10_29 10:56:51 [ F ] : ####1.CDlg_Login::OnBnClickedBuConnect() - Start : 0.00(sec)
2024_10_29 10:56:52 [ T ] : CPNP_EM_MasterThread_Item::GetLocalMAC - MacAddress : F8:E4:3B:1C:92:52
2024_10_29 10:56:52 [ F ] : Query Execute Error : Table 'webem.variables' doesn't exist
2024_10_29 10:56:52 [ F ] : Query Execute Error : Table 'psync.am_policy' doesn't exist
2024_10_29 10:56:53 [ F ] : ####2.CDlg_Login::OnBnClickedBuConnect() - End : 1.23(sec)
[saferuas 로그]
- ERROR 10:34:52.126 [https-jsse-nio-3443-exec-8 ManagerAuthService.java:122] sendSMS - Exception in insert to site sms database
...
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
PKG : PKG_DBSAFER5_RelR24.05-RockyLinux_x86_64_20241011.tar.gz
WEB : COMMON_UTIL_V2.38_build-1_20240430.tgz
인증 : saferuas.war.2.0.83.0_Build-2276_202410101327.tgz
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
첨부파일
[대우건설] Manager_에러로그
.txt
null
파일 다운로드
첨부파일
[대우건설] saferuas_에러 로그
.txt
null
파일 다운로드","이임재: 추가 정보 요청함 | 이임재: 연구소 확인중 | 이임재: >>https://bbs.pnpsecure.com/showthread.php?tid=13948
>>site DB 연동 시 db connection 문제 관련하여 관리자 2차 인증에도 적용
:
엔지니어 테스트 예정 | 김연수: 내부 테스트 서버에서 관리자계정 2차인증 정상동작하는 것으로 확인하였습니다.

빠르게 지원해주셔서 감사합니다.",https://cafe.naver.com/pnpsecure2/6750
6743,[현대백화점그룹] 우회접근통제를 네트워크 인터페이스나 IP마다 다르게 설정하는 방법이 있는지 문의드립니다.,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기능로직문의
[고객사/채널사]
현대백화점그룹
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
3. 특이사항 (연동 모듈, 커스텀 개발 등)
4. 사내 재현 정보
5. 요청사항
고객사에서는 서버에 서비스용 IP, 백업용 IP, VIP를 위한 네트워크 인터페이스가 각기 존재합니다.
이 때 서비스용 IP와 VIP에 대해서는 사용자 대역에서 우회접근 차단, 일부 서버를 제외한 우회접근 차단
백업용 IP에 대해서는 백업대역을 제외하고 우회접근 차단할 수 있도록 희망하고 있습니다.
다만 Server Agent 우회접근제어정책으로는 매니저 서비스로 등록된 서비스용 IP에 대해서만 통제가 가능하고 다른 인터페이스에 대해서는 통제가 불가하며
고객사에서 DBSAFER OS를 사용하기도 하여 TCP 인바운드 제어설정을 활성화해서 네트워크 인터페이스 상관없이 우회접근제어정책에 허용 등록한 IP 제외하고 모두 차단되도록 설정했으나, 인터페이스별로 허용 IP를 다르게 등록이 필요하다고 하는 상황입니다.
하여 아래와 같이 문의드립니다.
1) 기 개발된 Server Agent 및 DBSAFER OS TCP 인바운드 제어 기능으로 위 요구사항을 만족하는 설정이 가능한지 문의드립니다.
2) 추가로, TCP 인바운드 제어 정책에 아무 정책도 등록되지 않은 상태인데, TCP 인바운드 제어 기능을 활성화하면 모든 인터페이스에 대해서 Server Agent 우회접근제어 정책이 적용되는 것을 확인하였습니다. 해당 동작이 정상적인 동작인지 문의드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
DBSAFER 5.0
pnp_server_manager-V5.1.6.50
SA : 5.1.6.xx
OS : 1.0.1.xx
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","정현교: 1) 기 개발된 Server Agent 및 DBSAFER OS TCP 인바운드 제어 기능으로 위 요구사항을 만족하는 설정이 가능한지 문의드립니다.
>> 네 설정 가능합니다. DBSAFER OS를 사용하는 환경의 경우, 인터페이스 설정과 관계 없이 커널로 들어오는 패킷에 대해 정책 적용을 시키기 때문에 서비스를 IP 별로 등록해 놓고 TCP 제어 정책 적용하시면 됩니다.

2) 추가로, TCP 인바운드 제어 정책에 아무 정책도 등록되지 않은 상태인데, TCP 인바운드 제어 기능을 활성화하면 모든 인터페이스에 대해서 Server Agent 우회접근제어 정책이 적용되는 것을 확인하였습니다. 해당 동작이 정상적인 동작인지 문의드립니다.
>> 네 정상 동작입니다. DBSAFER OS 사용 설정 하는 경우 우회 접근 제어도 커널모듈로 제어하게 됩니다.",https://cafe.naver.com/pnpsecure2/6743
6740,[TIP] 장기 PC 미 사용 시 세션 종료 현상 테스트 정보 공유,"안녕하세요. PM지원팀 서재영입니다.
서울의료원에서 장기 PC 미사용 시 PC Agent 종료 설정을 적용 하였었는데, PC Agent 는 종료되지 않았지만 사용자 DB연결이 끊어진다는 이슈 접수로 인해 테스트를 진행 하게 되었습니다.
예상되는 테스트 케이스를 진행하였고, DB연결을 유지하는 DBMS의 경우 keep alive 동작에서도 참고할 만한 사항이 확인되어 내용 공유 드립니다.
[테스트 진행 항목]
1. 장기 PC 미사용 시 PC Agent 자동종료 기능 테스트 (정상)
- 자동종료 기능 설정 : 매니저(7.0) > 환경설정 > 보안계정 추가 동작 옵션 설정 > 자동종료
. PC 미사용 시 Assist 자동종료 3가지 동작 테스트 시 정상동작
. 자동종료 관련 참고 : https://cafe.naver.com/pnpsecure2/5061
cafe.naver.com
cafe.naver.com
* 고객사는 세션검사에서 세션종료확인 설정으로 변경 예정
2. DBMS 연결 된 세션에 keep alive 패킷이 존재 하는데 끊기는 현상 확인
- 고객사에서 테스트 서버(MariaDB)로 테스트 시 Keep alive 패킷이 존재하는데 끊김을 확인하여 사내 테스트 진행
- 결론 : DB접속툴의 idle timeout 설정 , DBMS 내 idle timeout 설정이 되어 있을 경우 keep alive 패킷이 무시되고 정상 종료 됨
가. DBeaver 툴 idle timeout 설정으로 인한 끊김 (정상종료)
1) DBeaver 툴 기본 설정값
2) 사용자 - DBSAFER 구간 접속 패킷
3) 사용자 - DBSAFER 구간 종료 패킷 (keep alive 패킷이 있지만 14400 초 4시간 후 정상종료 됨)
나. DBMS 내부 DB 연결 유지 시간 설정 사항으로 인한 끊김 (정상종료)
1) DBMS (Mariadb) idle timeout 설정값
2) 사용자 - DBSAFER 구간 접속 패킷 (DB접속 툴은 idle timeout 설정이 없는 QueryBox 이용)
3) 사용자 - DBSAFER 구간 종료 패킷 (keep alive 패킷이 있지만 28800 초 8시간 후 정상종료 됨)
참고로 ssh 접속을 통해 keep alive 시간 테스트를 진행 시에는 ssh 접속은 끊김 발생하지 않습니다.
OS에서 전달하는 keep alive 신호는 방화벽 등의 네트워크 장비에서는 세션을 유지시켜 줄 수 있지만
DB툴 혹은 DBMS 설정에 의한 idle time 이 설정되어 있을 경우 Keep alive 패킷이 존재 해도 쿼리 수행이 없으면 Keep alive 패킷은 무시되는 것으로 생각됩니다.
끊김 증상이 접수되는 경우(패킷상 정상 종료) DB접속툴 및 DBMS의 설정도 같이 검토 요청 해주시기 바랍니다.
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6740
6734,[현대 CCS] Kafka 지원 가능 문의 및 지원 계획이 있는지 확인 요청드립니다.,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타 문의
[고객사/채널사]
현대CCS
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
3. 특이사항 (연동 모듈, 커스텀 개발 등)
4. 사내 재현 정보
5. 요청사항
- Kafka에 대한 DB 접근제어 지원이 가능한지 확인 부탁드립니다.
- kafka가 현재 지원이 안된다면 지원 계획이 있는지도 추가로 확인 부탁드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
- DBSAFER V7.0
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)",이임재: sms 쪽 아닌 접근제어 부분으로 > 기반검증팀 확인중 | 최재규: 우선 해당 DB 서비스는 지원은 불가능하고 현재 개발 및 검증 중인 Protocolless나 Dbeaver에서도 없는 서비스라 빠른 시일 내에 지원은 어려울 것 같습니다. 또한 지원 계획도 현재는 없습니다!,https://cafe.naver.com/pnpsecure2/6734
6730,[카카오]DBSAFER Buffer 파일 처리 지연 현상,"1. 증상
- 10월 11일 오전 07시경 MongoDB 마이그레이션 작업으로 DBSAFER서버에 buffer파일 생성
- 해당 작업은 15시경에 완료되었지만 생성되었던 buffer 파일은 처리되지 않음
2. 원인
- 카카오측에서 connector로 생성한 VIEW테이블에 지속적으로 select 수행(db_user, db_query테이블)
- pnp_log모듈에서 사용자 정보를 갱신하기 위하여 db_user테이블에 update 및 insert를 수행
- pnp_log 모듈이 db_user테이블에 작업을 수행하지 못하여 세션정보를 처리하지 못함
- buffer 파일을 처리하기 위해서는 pnp_log모듈에서 메모리에 쌓아둔 세션정보를 먼저 처리해야 되지만
다른 작업으로 인하여 세션정보를 처리하지 못하게 되었고 buffer파일 역시 처리를 하지 못함
3. 조치
- 카카오측에 당일 로그를 조회 못하게 처리 요청
4. 참고사항
- pnp_log 데몬에 부하가 발생시 세션정보는 미리 db_user테이블에 저장하고 명령어 로그는 buffer파일로 저장
- telnet 127.0.0.1 [pnp_log port] 명령어롤 사용하여 pnp_log데몬의 상태를 체크할 수 있음
[SESSION]Db:1 Ftp:0 Shell:0 -> 현재 세션 개수
[NEW] Db:0/0 Ftp:0/0 Shell:0/0 -> 신규 세션 개수
[LOG]Busy:F Urgency:0 Cur:0 Next:0 Ext:0 Last:0 Files:0 -> 현재 큐에서 처리중인 작업 개수, Files는 buffer파일 개수
[JOB] TotalJob:0 Added:0 Deleted:0 -> 현재 잡의 개수",댓글 없음,https://cafe.naver.com/pnpsecure2/6730
6729,[키움증권] Oralce 모듈 패치후 특정 명령어 차단현상(exec),"1. 증상
- Oracle 모듈 v1946 -> v2687로 패치후 exec가 포함된 명령어 수행시 차단 발생
- 실제로는 select only 정책이 적용되어야 하지만 'EXECUTE'를 차단하는 정책에 의하여 차단 발생
2. 원인
- Revision 3758에서 CALL명령어를 execute로 처리하는 로직이 추가
- excute를 exec로 줄여서 사용하는 경우가 있어 exec를 excute로 처리하는 로칙 추가
- 차단되는 명령어에는 exec명령어가 아닌 'round(exec)' 함수를 사용하였고 execute로 인지되어 차단 발생
3. 조치
- BT: 28818에서 수정 완료
도움을 주신 최재규 대리님 감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6729
6719,[DBSCANNER] 관리자 계정 비밀번호 암호 방식이 pnp_passwd 일 때 로그인 안되는 현상,"[조건]
- DBSCANNER 자체 관리자 계정이 아닌 DBSAFER 관리자 계정을 그대로 이용하도록 설정되어 있음
- DBSAFER 에서 관리자 계정 비밀번호 암호화 방식이 pnp_password 로 설정되어 있음
[문제 상황]
- DBSCANNER Web 에서 로그인 시 ""아이디, 패스워드가 정확하지 않거나, 접속권한이 없습니다"" 라고 나옴
- DBSCANNER Web log 를 봐도 에러 발생 없음
[원인]
- 2023년 7월 17일 v1.10.51.0_BUILD_267 에 커밋된 코드 중 버그 존재
- [BT:22745] DBSAFER UTF-8 에서 DBSCANNER 동작하도록, INFOSAFER v5 지원하도록 수정 중 버그 발생
[원인 상세]
- DBSAFER 관리자 계정 연동 시 dbscanner 에서 로그인 할 때 관리자 계정의 비밀번호 암호화 방식을 가져옴
- 암호화 방식을 가져오는 쿼리에서 dbsafer3.variables 테이블을 참조해야 하는데 dbprofer.variables 를 참조하여 발생
- 암호화 방식이 passwd 인 경우(기본값) 문제 없으나 pnp_passwd 를 사용할 경우 제대로 가져오지 못해 문제 발생
[영향도]
- 2023년 7월 17일 이후 패키지에서 발생함
[해결]
- dbscanner.war 1.10.53.1_BUILD_277 부터 해결 (쿼리 수정), 해당 버전으로 패치
- 패치할 수 없을 경우 아래 쿼리를 직접 수행
SELECT IFNULL(MAX(value), 0) FROM dbsafer3.variables WHERE name = 'manager_enforced_encrypt_use';
INSERT INTO dbprofer.variables (name, value) VALUES ('manager_enforced_encrypt_use', ${value});
> $value 는 SELECT 해서 확인한 값",댓글 없음,https://cafe.naver.com/pnpsecure2/6719
6714,[현대이지웰] Server Agent를 통한 AWS 직렬콘솔 접근 통제 가능 여부 문의드립니다.,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기능로직문의
[고객사/채널사]
현대이지웰
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
3. 특이사항 (연동 모듈, 커스텀 개발 등)
4. 사내 재현 정보
5. 요청사항
클라우드 환경에서 DB/AM 구축 희망하는 고객사로, AWS EC2에 Server Agent를 설치하면 AWS 콘솔에서 직렬콘솔을 통한 서버 접근 통제 가능 여부에 대한 문의사항이 있었습니다.
물리장비의 경우 루프백을 통한 tty 접근에 대해 통제 및 로깅 가능한 것으로 알고 있으나 AWS의 경우에도 가능한 지에 대해 기능 여부 문의드립니다.
항상 감사합니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","정현교: EC2 직렬 콘솔 연결의 경우 해당 기능을 지원하는 유형이 일반적인 ec2 유형이 아닙니다(Nitro System)
해당 유형은 확인된 부분이 없기 때문에 필요 시 환경 구성 및 테스트가 필요합니다.

* 참고
AWS system manager(SSM) 를 통한 SSH, RDP 콘솔 접근의 경우 개발 완료 되어 다음 릴리즈에 포함될 예정입니다.
다음 SA 릴리즈 예정 일정은 1월 중순입니다.",https://cafe.naver.com/pnpsecure2/6714
6712,[공유] 현대 아중동 CCS 인사 연동(HKIM) 및 2차 인증(MPASS FIDO+Google OTP) 적용 사례 공유,"안녕하세요. 클라우드기술팀 김영은입니다.
현대 아중동 CCS에서 진행한 인사 연동 및 2차 인증 적용 사례 공유드립니다.
추가로 필요한 내용이 있으신 경우 댓글 혹은 개인 라인 부탁드립니다.
요약
- 인사연동
. DBSAFER DB에 임시 테이블 생성
. 해당 테이블로 HKIM에서 인사 데이터 전송
. 임시 테이블을 기준으로 인사연동(DB) 적용
. 추가된 보안 사용자가 1차 AD 인증/ 2차 OTP 인증을 사용하도록 배치 스크립트 설정
- AD 인증(LDAP 인증)
- 2차인증:
. MPASS+Google OTP 적용
- 국내 사용자는 AD+MPASS FIDO 인증, 해외 사용자는 보안계정+Google OTP 적용
인사연동(HKIM) 적용 절차
* 인사연동(HKIM) 테이블 생성 및 계정 생성에 사용한 쿼리는 첨부파일에서 확인 부탁드립니다.
첨부파일
현대CCS_HKIM_테이블_SQL
.txt
null
파일 다운로드
1. 인사 데이터 전달 받을 데이터베이스 및 테이블 생성
- 고객사에서 제공한 ""HKIM_표준테이블정의서"" 기준으로 생성
. ""HKIM_CCS"" 데이터베이스 생성
. "" EI_USER_INFO"", "" EI_DEPT_INFO"" 테이블 생성
2. 계정 생성 및 권한 부여
- 생성한 테이블에 접속할 수 있는 계정 생성 후 고객사에 접속 정보 공
- SELECT, INSERT, UPDATE, DELETE 권한 부여
- HKIM AP 서버 IP 접속 권한 부여
3. 뷰 테이블 생성 및 권한 부여
- "" EI_USER_INFO"", "" EI_DEPT_INFO"" 테이블을 조인하여 하나의 뷰 테이블 생성(ldap1)
- saferuas 계정에 생성한 테이블에 대한 SELECT 권한 부여
4. 방화벽 설정 요청 및 데이터 입력 확인
- 인사 데이터 수집을 위해 HKIM AP -> DBSAFER(LOG) 서버 구간 방화벽 오픈 요청
- 데이터 전송 이후 정상적으로 뷰테이블 조회가 되는지 확인
5. pnp_accountsync 설정
- 경로: /dbsafer/.conf/pnp_accountsync.properties
# 계정 동기화 시간을 설정합니다.
SyncType = 0
SyncTime = 06:00:00
## AccountReader클래스를 설정한다.
AccountReader = com.pnpsecure.accountsync.DbmsAccountReaderImpl
#   DBSAFER 인사 정보에 매칭될 DBMS/AD LDAP 컬럼명을 지정합니다.
ColumnSno         =USER_ID
ColumnName        =NAME
ColumnTel         =DEPT_NM
ColumnMail        =EMAIL
ColumnReserved1   =RETIRE_YN
#   갱신/삭제/잠금 대상 비교를 위해 추가적으로 사용될 필드를 입력합니다.
SpecialValue =""Y""
# 데이터를 읽어올 DBMS를 설정합니다.
SrcDriver =com.mysql.jdbc.Driver
SrcUrl =jdbc:mysql://[DBSAFER LOG IP]:3306/HKIM_CCS
SrcUser =safeusr
SrcPasswd =xlo/7MK1EZ0PxcId1un8JgFcnQ1wsT7gytobHUboJ2Y7ftOvDbfu0mhzp14YV14RTtzwYhn1ogQT5mR0M/gVhA==
From   = from ldap1
DbsaferCharacterSet = 1
SrcEncoding = UTF-8
6. 추가된 보안 사용자가 1차 AD 인증, 2차 OTP 인증을 사용하도록 배치 스크립트 설정
- 경로: /PNP_DATA/accountsync/accountsync_batch.sql
UPDATE `dbsafer3`.`dbsafer_ldap_list` SET user_auth_type = 4 where istype=1;
UPDATE `dbsafer3`.`dbsafer_ldap_list` SET default_auth_use = 2 where istype=1;
- 경로: /PNP_DATA/accountsync/accountsync_batch.sh
#####################################
## DBSAFER Config
#####################################
SET_PATH=/PNP_DATA/accountsync
cd /dbsafer
#####################################
## GET dbms_info
####################################
PNPPW=`expect -c ""spawn ./pnp dbms_info
expect -re ""\>""
sleep 0.2
send ""dbsaferadmin""
send \r
sleep 0.2
interact "" | awk 'NR==8 {print $1 }'|tr -d '\015\012'`
sleep 5
mysql -u safeusr -p${PNPPW} dbsafer3 < ${SET_PATH}/accountsync_batch.sql
- 실행 권한 부여 및 crontab 등록
# 실행 권한 부여
chmod 755 accountsync_batch.sh
# accountsync_batch.sh 스크립트 실행될 수 있도록 설정
crontab -e
30 6 * * * /PNP_DATA/accountsync/accountsync_batch.sh
2차 인증(MPASS FIDO+Google OTP 연동) 적용 절차
1. 고객사에 요청할 정보
- MPASS 암호화 키
- MPASS FIDO RestFul API 문서
. 문서에서 ""2.인증 요청 > 2.2.1 업무서버 -> FIDO"" 부분 확인 필요(saferuas 엔지니어 페이지 설정에 필요)
2. 패키지 설치
- 사용 패키지 버전: saferuas.war.hyundaiautoever.1.6.2_202408091459.tgz
. https://bbs.pnpsecure.com/showthread.php?tid=9409
- saferuas config 설정
. 경로: /home/webapps/saferuas/config/config.properties
# HYUNDAI AUTOEVER
HYUNDAI.KEY = [전달받은 MPASS 암호화키 입력]
# HYUNDAI AUTOEVER RSA OTP Enabled
# IF you want diabled rsa otp, set false
RSA.OTP.ENABLE = false
- pnp_oms_dms saferuas 인증 사용하도록 변경
. 경로: /dbsafer/.conf/pnp_oms_dms.conf
AUTH_SITE=9
- saferuas 엔지니어 페이지
. OTP: Google OTP 설정
. MPASS: FIDO 선택 후 URL, Parameter 작성
{
""site"":""#HYUNDAI_SITE#"",
""userId"":""#USER_ID#"",
""fid"":""#FID#"",
""returnurl"":""https://100.124.8.48:3443/saferuas/authFido/result"",
""tasuseyn"":""Y""
}
3. PC Assist 빌드
- Windows v 3.3.0.6 이상
. dll 파일(ASSIST Linkage Library for 현대자동차 V3.3.0.8 (2024.07.11)
> https://bbs.pnpsecure.com/showthread.php?tid=10124&highlight=mpass
. ini 파일
sso_use (0: SSO 미사용, 1: 사용)
mpass_type (1: OTP, 2: FIDO, 3: OTP+FIDO)
use_otp_issue(0: OTP 키발급 버튼 비활성화, 1: 활성화)
use_mpass(0: 구글 OTP 사용, 1: MPASS OTP 사용)
- Mac v3.3.4.9 이상
. ini 파일
4. Enterprise Manager > 보안계정 2차인증 설정
- 보안계정 > 사용자 2차인증을 OTP로 설정(MPASS도 OTP로 취급)
5. 적용 결과
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6712
6711,[공유] DBSAFER 엔지니어 영문 교육자료 공유드립니다,"안녕하세요. 프로젝트 1팀 정진경입니다.
해외 파트너사 교육을 위해 엔지니어 영문 교육자료를 준비하여 공유드립니다.
해당 자료는 5일간 교육을 하기 위한 커리큘럼으로 구성되어 있습니다.
[자료] DBSAFER 7.0
https://drive.google.com/drive/folders/17rrIhp1NXd_oVUSPaBPqL4h7RamT2fER?usp=drive_link
감수완료_240920 - Google Drive
Name Owner Last modified File size More sorting options 과거 자료 Owner hidden Sep 20, 2024 — Download 1_[Manual] DBSAFER PC Agent User Guide.pptx Owner hidden Sep 25, 2024 2.2 MB 1_[Manual] DBSAFER v7.0 Manager Guide.pptx Owner hidden Sep 27, 2024 5.1 MB 2_[Training] DBSAFER WEB Product.pptx Owner hidd...
drive.google.com
내용 확인하시고 첨언할 부분이 있다면 댓글 혹은 개인 라인 부탁드립니다.
자료 감수에 도움을 주신 서버보안기술팀 최은수 대리님 감사드립니다.
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6711
6697,[DBSAFER7]MariaDB 10.2에서 10.6으로 업그레이드 이후 매니저 접속이 안되는 경우,"MariaDB 10.2에서 MariaDB 10.6으로 업그레이드 한 이후 매니저 접속이 안되는 경우
pnp_agnt 에서 아래의 퀄이 오류 발생
""SELECT COUNT(*) FROM auth_users WHERE id='admin' AND binary passwd=pnp_passwd('admin007')""
mariadb 내에서 해당 쿼리를 실행할 경우 아래의 오류 발생
ERROR 1558 (HY000): Column count of mysql.proc is wrong. Expected 21, found 20. Created with MariaDB 100229, now running 100613. Please use mariadb-upgrade to fix this error
해당 오류는 mysql.proc 테이블이 MariaDB의 이전 버전(10.2.29)에서 생성되었고, 현재 실행 중인 MariaDB 버전(10.6.13)과 테이블 구조가 맞지 않아서 발생한 문제입니다. 버전 차이로 인해 테이블 스키마에 차이가 생겼고, 이를 해결하기 위해 mariadb-upgrade 도구를 실행해서 해결할 수 있습니다.
참고하시기 바랍니다.","서재영: mariadb-upgrade 도구 사용방법은 품질혁신실에 문의 하면 되나요? mariadb-upgrade 명령어 사용 시 root(mariadb 계정)이 필요하지는 않나요?

mariadb-upgrade 도구 사용 방법에 대해 설명이 추가 되었으면 좋겠습니다.",https://cafe.naver.com/pnpsecure2/6697
6685,[한국교육시설안전원] DBSAFER OS 기능 및 설정 관련 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
한국교육시설안전원
[문의내용]
1. SA 가 관리서버(DBSAFER)로 신호 호출하는 주기
- resource_view.conf 의 해당 옵션으로 가능한 것으로 알고 있습니다.
- GET_INFO_CYCLE 값이 맞는지와 하단 옵션들에 대한 상세 내용에 대해 문의 드립니다.
2. 운영체제 로그 검색 기능
- 대상 서버의 syslog 를 저장하는 기능인지 문의 드립니다.
(해당 기능이 아닌 경우, 운영체제 로그 검색 기능에 대한 설명 부탁드리겠습니다.)
3. 관리서버(DBSAFER) 장애 발생 시 대상 서버 동작
- 하단 옵션 설정한 경우 관리서버에 이상이 생겼을 때 Bypass 로 전환되는 것으로 알고 있습니다.
이해한 부분이 맞는지, 해당 설정이 안 되어 있을 경우 기본 동작 방식에 대해 문의 드립니다.
이상입니다.
감사합니다.","정현교: 1. resource_view.conf 설정
GET_INFO_CYCLE=30 => cpu, mem, disk 등 자원 정보 수집 주기
GET_NETINFO_CYCLE=90 => netstat 정보 추출 주기
SET_SLOW_MODE=ON => 과부하 문제를 회피하기 위해서 파일 검사 주기등을 2배로 느리게하는 옵션
SET_FAST_SYSLOG=OFF => syslog 수집 시 PAM 또는 Sniffing 에서 발생하는 30초의 고의 지연 회피 옵션
GET_SYSINFO_CYCLE=30 => syslog 정보 검사 주기

2. 해당 기능은 SA 기능인데, OS 설명에 포함된 것 같습니다.
매니저 > 시스템 설정 > SA 설정 > 서버 자원 로그 부분에서 기능 활성화 시 해당 로그들에 대한 수집이 가능합니다.

3. 이해하신 부분이 맞습니다.
DBSAFER 서버에 이상이 생겨 pnp_server_manager 와 통신이 안되는 경우 bypass 시키는 설정입니다.
해당 설정이 없을 경우 | 박상원: DBSAFER OS 적용되어 있으면 PFC_BYPASS_WHEN_SA_FAIL_OPEN=ON 설정해줘야 Bypass 동작하는 걸로 알고 있습니다.
(매니저 > Server Agent 관리 설정 정책 > 추가설정란에 입력) | 이민종: https://sites.google.com/pnpsecure.com/engineer-manual/%EB%A7%A4%EB%89%B4%EC%96%BC/dbsafer-os-%EB%A7%A4%EB%89%B4%EC%96%BC/tip/%EC%98%B5%EC%85%98-%EC%84%A4%EC%A0%95",https://cafe.naver.com/pnpsecure2/6685
6672,pnp_ssh_proxy 로그인 과정 중 행 발생 시 확인 사항,"pnp_ssh_proxy 사용 시 로그인 과정 중에 행이 발생하는 문의가 들어와 관련 내용 정리하여 공유드립니다.
[발생 환경]
- pnp_ssh_proxy 사용
- 로그인 방식: password, keyboard-interactive
[행발생 원인]
- SSH 자동접속 및 su change를 지원하기 위해 account_manager를 통해 계정 및 패스워드를 전달받고 있습니다.
- 이때, account_manager 대상으로 통신에 문제가 있을 경우 행이 발생하여 접속에 실패할 수 있습니다.
- password 또는 keyboard-interactive 방식 사용 중일 때만 account_manager 대상으로 조회를 시도합니다.
[확인 사항]
- 기본적으로 디버그 로그 확인 시 password 또는 keyboard-interactive 인증 방식을 사용하고 있는 과정에서 행이 발생한 것을 확인하여야 합니다.
1. pnp_ssh_proxy 디버그 로그 확인
- 아래와 같은 로그가 나올 경우, 위에서 언급한 행발생 케이스입니다.
[2024-08-23 20:14:11] [11765] [MISC][INFO__000000000] Information message. : [USER : AUTH > PASSWORD] (NO)446, (SERVER)10.110.2.114:22, (USER)10.110.2.107:34235. [PARAM](user)test, (password)*********
[2024-08-23 20:16:23] [11765] [MISC][INFO__000000000] Information message. : Cannot get the account-info from IM. - [CTcpClient.cpp:116] (ERR:110)Connection timed out (ERROR)Connect. (DESC)Failed to connect to server. [SERVER] 10.110.2.51:31115
[2024-08-23 20:16:00] [11765] [MISC][INFO__000000000] Information message. : Terminate the client session. (NO)446, (SERVER)10.110.2.114:22, (USER)10.110.2.107:34235, (SOCK)-1. (ERR:2)Socket error: disconnected
- 단, 위와 같은 로그가 항상 나오는 것은 아닙니다. 통신 문제로 인해 아래와 같이 원인이 포함된 로그가 나오지 않는 경우도 있습니다. 따라서, 이때는 ""확인사항 #2""도 확인을 해야합니다.
[2024-09-02 22:02:40] [113649] [MISC][INFO__000000000] Information message. : [USER : AUTH > PASSWORD] (NO)8, (SERVER)172.25.0.174:22, (USER)1.212.169.66:60696. [PARAM](user)ubuntu, (password)**********
src/handle/CProxyServerHandle.cpp[run_auth_password]:601
[2024-09-02 22:02:40] [113649] [MISC][INFO__000000000] Information message. : Success to get cert for IP. (IP)1.212.169.66, (CERT)test
src/protocol/CProtocolOms.cpp[checkCert]:110
[2024-09-02 22:04:01] [113649] [WARNING][WARN__9999014] Because of timeout, compulsory termination. : Cancel the abnormal thread. (THREAD:ID)140129879529216, (THREAD:STATUS)0, (NO)8, (SERVER)172.25.0.174:22, (USER)1.212.169.66:60696
src/handle/CHandleManager.cpp[cancelAbnormalHandle]:295
2. account_manager 대상 통신 확인
- pnp_ssh_proxy에서 SSH 로그인 행 발생 시점에 account_manager로 통신을 시도하고 있는지 확인을 해야 합니다. account_manager 대상으로 접속이 정상적으로 연결이 되는지 tcpdump 등으로 확인을 해야합니다.
- account_manager IP: (우1).conf/account_manager_ip.conf / (우2).conf/pnp_agent_ip.conf / (우3).conf/service_ip.conf
- account_manager Port: 31115
[조치 사항]
일반적으로 2가지 조치사항이 있을 수 있습니다.
다만, 아래에서 말하는 account_manager 자체는 account_manager 뿐만 아니라 account_manager IP/Port를 사용하고 있는 다른 프로세스를 포함합니다.
1. account_manager 미사용
- account_manager를 사용하지 않는 환경이라면, account_manager를 종료하면 됩니다.
2. account_manager 조회 방지 설정
- account_manager가 사용되지 않고 있는 환경임에도 발생한다면 다른 네트워크 문제일 가능성이 있습니다. 이때 pnp_ssh_proxy에서 account_manager 조회 과정 자체를 생략하는 옵션을 제공하고 있기 때문에 해당 옵션을 사용하면 됩니다.
- 설정지원버전: pnp_ssh_proxy Rev.200 (trunk 기준)
- 설정파일: .conf/pnp_telnet.conf
- 설정예시
[CHECK_ACCOUNT_MANAGER]
disable",댓글 없음,https://cafe.naver.com/pnpsecure2/6672
6665,[TIP] 터미널 명령어 대소문자 구분 기능,"터미널 권한제어에서 명령어 대소문자를 구분할 수 있도록 하는 기능
명령어 객체 생성시 ` 특수문자를 사용해서 대소문자를 구분하지 않도록 설정하는 방법도 있습니다.(벅스 10851 참고)
본 기능은 DBMS에서는 지원하지 않습니다.
> DBMS는 대소문자를 구분하지 않고 처리하고 있습니다.
[관련 벅스]
> [BT:10851] : [telnet] 명령어 대소문자 구분을 청잭적으로 적용할 수 있는 기능 요청
> [BT:11070] : [매니저] 명령어 객체의 대소문자 구분 표시 UI 추가
[예시]
- 대소문자 구분 체크 O = ssh 명령어 적용됨, SSH 명령어 적용 안됨. sshd 명령어 적용 안됨
- 대소문자 구분 체크 X = ssh 명령어 적용됨, SSH 명령어 적용됨. sshd 명령어 적용 안됨
[매니저 시스템 설정]
- 시스템설정 > 객체 동작 작설정 > 명령어 `대소문자 구분` UI 활성화",댓글 없음,https://cafe.naver.com/pnpsecure2/6665
6656,[TIP] 7.0 서버패키지에서 삼만(pnp_service_gateway) 모듈을 사용하지 않을 경우 설정 방법,"DBSAFER 7.0 서버에서 gateway 모듈을 사용하지 않고 기존 DBSAFER 5.0 동작으로 변경하는 설정
설정 파일 : /dbsafer/.conf/pnp_agent.conf
옵션 설명
# Use TP GATEWAY (SAMMAN). The service start method is changed.
# Default 0 (Unused), (DBSAFER 7.0 의 경우, 100000000<=PROTOCOL_TIME Default 1)
use_tp_gateway = 0
DBSAFER 7.0에서 DBSAFER 5.0 처럼 서비스를 가동하기 위해서는 옵션값을 0으로 설정 후 agent모듈 재시작
LOG / GW 서버 분리구성인 경우 반드시 pnp_agent.conf / pnp_slave.conf 설정 동일한 값으로 수정이 필요합니다.
pnp_slave.conf 파일에서 use_tp_gateway = 0 설정을 하지 않을 경우 매니저에서 정책을 변경해도 GW서버에서 1분 이상 적용이 되지 않습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6656
6655,[TIP] DBSAFER 서버에 접속하는 사용자의 행위 탐지를 위한 기능 (pnp_shell),"R24.05 릴리즈 서버패키지에서 추가된 pnp_shell 기능에 대한 내용을 가이드 드립니다.
릴리즈 패키지 설치할 경우 공지드린 것과 같이 pnp_shell 모듈이 포함되며 사용자 행위 탐지 로그가 남습니다.
R24.05 릴리즈 서버패키지가 설치되지 않은 서버에서 해당 기능을 사용하기 위해서는 R24.05 릴리즈 패키지에 포함된 pnp_shell 모듈을 /dbsafer 디렉토리에 복사하고 setup_psterm.sh 스크립트를 실행해주시면 됩니다.
만일 사이트의 magiccrypto 버전이 릴리즈 버전과 다른 경우 pnp_shell 모듈 빌드 요청해주시길 바랍니다.
첨부파일
setup_psterm
.sh
null
파일 다운로드
pnp_shell 모듈을 설치할 경우 DBSAFER 서버에 접속하는 사용자에 대한 로그를 '시스템로그'에 남기고 있습니다.
[로그분류] 항목에서는 pnp_shell이 실행된 DBSAFER 서버 IP가 남고 있습니다.
[내용] 항목에서는 접속한 사용자의 IP, 접속계정 및 명령어에 대한 로그를 남기고 있습니다. 여러 개의 세션이 접속될 경우 idx 기준으로 구분되며 각 idx 세션의 명령어는 c_idx로 구분을 하고 있습니다.
참고로 해당 기능 미사용을 원하시는 경우 /etc/profile 파일 첫째줄에 있는 /dbsafer/pnp_shell 항목을 삭제해주시면 됩니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6655
6644,Manager에서 명령어 로그 조회 조건 중 SQL 유형을 'Create'로 설정할 시 Begin문 출력,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기능로직문의
[고객사/채널사]
신세계
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
Create 유형으로 DBMS 명령어 로그 조회 시 Begin 문이 조회됩니다.
정상동작인지 여부와 정상동작일 경우 Begin문이 조회되는 사유를 문의드립니다.
(Begin 문은 Create 유형, Begin 유형을 각각 명령어 로그에서 조회 조건으로 입력할 때 모두 조회됩니다.)
Create 유형으로 조회
Begin 유형으로 조회
정상동작이 아닐 시 bugs 등록하도록 하겠습니다.
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
Enterprise Manager 5.0.9.5A Build-7289","조재근: Create 유형으로 DBMS 명령어 로그 조회시 Begin 유형이 출력되지 않는 것이 정상동작입니다.
따라서 bugs 등록 부탁드립니다.
감사합니다. | 류현수: https://bugs.pnpsecure.com/view.php?id=28772

manager 시스템 설정의 'DBMS 명령어 로그 - SQL Type 선택 시 LIKE 검색 조건 미사용' 설정 여부에 따라 발생할 수 있는 정상 동작으로 확인되었습니다.",https://cafe.naver.com/pnpsecure2/6644
6643,"SSH 연결과 명령어를 같이 수행 시 ""exec request failed on channel 0""으로 나타나는 현상","[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타 문의
[고객사/채널사]
부산광역시청
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
아래와 같이 SSH 연결과 명령어를 같이 수행 시 ""exec request failed on channel 0""으로 나타나는 현상
ex) ssh -p 1221 linux@ip [명령어]
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- DBSAFER 태우지 않고 SSH 연결과 명령어를 같이 수행 정상 동작 확인
- SSH 연결과 SSH연결 + 명령어 수행에 대한 디버그 로그 확인 시 메시지 유형이 다른 부분 확인
[SSH 연결에 대한 pnp_ssh_proxy 디버그]
[SSH 연결과 명령어를 같이 수행한 pnp_ssh_proxy 디버그]
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 없음
4. 사내 재현 정보
- 사내재현 가능하여 필요 시 정보 전달 드리겠습니다.
5. 요청사항
1. SSH 연결과 명령어 수행(EXE-REQUSET) 동시 처리에 대한 지원 여부 확인 요청 드립니다.
2. 1번 내용 지원이 가능 할 경우 DBSAFER에서 정상 접속 및 로깅이 가능한 설정 가이드 확인 부탁드리겠습니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
첨부파일
SSH 수행에 대한 pnp_ssh_proxy 디버그
.txt
null
파일 다운로드
첨부파일
SSH+명령어 수행에 대한 pnp_ssh_proxy 디버그 로그
.txt
null
파일 다운로드
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
[root@dev-db dbsafer]# ./pnp_ssh_proxy
SSH_PROXY Release (Rev 308) Feb 20 2024 15:47:46s
( SHARED INTERFACE VERSION INFO: Rev.621 )
( COMMON-API(UTIL) INFO: Rev.197 )
( LIBSSH VERSION INFO: 0.10.5/openssl/zlib )
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","김태윤: ssh exec 에 대해서는 현재 지원하지 않습니다.
개발 관련해서 진행 가능 여부에 대해서 연구소에서 확인 중이나, 정확한 일정은 없는 상황입니다.

참고하세요. | 강정근: ",https://cafe.naver.com/pnpsecure2/6643
6639,"[TIP]pnp_mailer.sh 동작 후 test 시 ""Could not convert socket to TLS;"" 에러 현상 관련 문의","[분류] (에러로그문의 / 기능로직문의 / 기타문의)
에러로그문의
[고객사/채널사]
디앤오
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크)
pnp_mailer.properties에서 ""secure = ""설정을 1~5사이로 설정 시 ""Could not convert socket to TLS;"" 에러 발생
(** 0으로 설정시 test 성공하나 고객사 측에서 TLS로 통신이 이루어질 수 있도록 요청한 상황)
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
2-1. 고객사 설정값 확인
[메일서버]
- 인증 없이 메일 발신 가능한 서버
- TLS 버전에 상관없이 들어오는 버전에 맞춰서 메일 발송 가능
[pnp_mailer.sh]
버전 : 1.3.12
[pnp_mailer.properties]
server = [고객사 메일서버]
mail = [암호화 된 고객사 메일서버의 발신자 메일]
port = 25 //고객사 메일서버 사용 포트
login = 0 //고객사 메일서버는 로그인 없이 사용 가능
secure = 0 //현재는 0으로 설정되어있으나, 1~5사이로 변경시 test 메일 발송 실패
2-2. Could not convert socket to TLS 관련 카페게시글 확인
[공유] saferuas 자체 mail 전송이 안되는 경우 (feat. java smtp) - Could not convert socket to TLS
- /usr/java/latest/conf/security/java.security 파일을 열고 jdk.tls.disabledAlgorithms 부분 확인 완료
>해당 내용과 에러 내용이 동일하여 확인하였으나, 해당 값들은 기존부터 빠져있던 상태로 확인.
https://cafe.naver.com/pnpsecure2/5271
3. 특이사항 (연동 모듈, 커스텀 개발 등)
4. 사내 재현 정보
5. 요청사항
- TLS 설정을 위한 추가조치 방법이 있는지 확인 요청드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
[root@sni-codacapp01 dbsafer]# ./pnp_mailer.sh test
Test send mail message.
MailAddress:yunse0@dnocorp.com
Aug 26, 2024 2:28:40 PM com.pnpsecure.dbsafer.mailer.Configure loadLangConfig
INFO: Lang Configure is - Language: KOREAN, Mail form: .conf/mail_form.txt, Charset: euc-kr
Aug 26, 2024 2:28:40 PM com.pnpsecure.dbsafer.mailer.Configure checkNumberParameter
INFO: Set parameter value as default value. [paramName]smtpProtocol[value]0
Aug 26, 2024 2:28:40 PM com.pnpsecure.dbsafer.mailer.Configure checkNumberParameter
INFO: Set parameter value as default value. [paramName]secureConnection[value]1
Aug 26, 2024 2:28:40 PM com.pnpsecure.dbsafer.mailer.Configure load
INFO: Configuration is - Configurations (DbUrl:jdbc:mysql://10.11.131.82:3306/dbsafer3?zeroDateTimeBehavior=convertToNull&useUnicode=true&characterEncoding=latin1)(DbUser:safeusr)(DbPasswd:**********)(mailType:com.pnpsecure.dbsafer.mailer.MailSenderSmtp)(server:ngwmail.dnocorp.com)(port:25)(mail:********)(login:0)(loginpw:********)(secure:5)(skipInterval:0)(smtptimeout:5000)(smtpProtocol:SMTP)(secureConnection:TLS)(retry_count:3)(retry_interval:10)(mail_title:)(view_org_query:0)(set_charterset_command:false)(product_type:0)(delaySendTime:20)(serverCharterset:)(maxRtnLength:100000)(maxRtnRowLength:100)(maxRtnFieldDataLength:1000)
Aug 26, 2024 2:28:41 PM com.pnpsecure.dbsafer.mailer.MailSenderSmtp sendMail
SEVERE: MESSAGING ERROR
javax.mail.MessagingException: Could not convert socket to TLS;
nested exception is:
javax.net.ssl.SSLHandshakeException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
at com.sun.mail.smtp.SMTPTransport.startTLS(SMTPTransport.java:2064)
at com.sun.mail.smtp.SMTPTransport.protocolConnect(SMTPTransport.java:724)
at javax.mail.Service.connect(Service.java:366)
at javax.mail.Service.connect(Service.java:246)
at javax.mail.Service.connect(Service.java:195)
at javax.mail.Transport.send0(Transport.java:254)
at javax.mail.Transport.send(Transport.java:124)
at com.pnpsecure.dbsafer.mailer.MailSenderSmtp.sendMail(MailSenderSmtp.java:400)
at com.pnpsecure.dbsafer.mailer.MailSenderSmtp.sendMail(MailSenderSmtp.java:340)
at com.pnpsecure.dbsafer.mailer.Main.testMail(Main.java:403)
at com.pnpsecure.dbsafer.mailer.Main.checkArguments(Main.java:205)
at com.pnpsecure.dbsafer.mailer.Main.main(Main.java:120)
Caused by: javax.net.ssl.SSLHandshakeException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
at java.base/sun.security.ssl.Alert.createSSLException(Alert.java:128)
at java.base/sun.security.ssl.TransportContext.fatal(TransportContext.java:321)
at java.base/sun.security.ssl.TransportContext.fatal(TransportContext.java:264)
at java.base/sun.security.ssl.TransportContext.fatal(TransportContext.java:259)
at java.base/sun.security.ssl.CertificateMessage$T12CertificateConsumer.checkServerCerts(CertificateMessage.java:642)
at java.base/sun.security.ssl.CertificateMessage$T12CertificateConsumer.onCertificate(CertificateMessage.java:461)
at java.base/sun.security.ssl.CertificateMessage$T12CertificateConsumer.consume(CertificateMessage.java:361)
at java.base/sun.security.ssl.SSLHandshake.consume(SSLHandshake.java:392)
at java.base/sun.security.ssl.HandshakeContext.dispatch(HandshakeContext.java:444)
at java.base/sun.security.ssl.HandshakeContext.dispatch(HandshakeContext.java:421)
at java.base/sun.security.ssl.TransportContext.dispatch(TransportContext.java:178)
at java.base/sun.security.ssl.SSLTransport.decode(SSLTransport.java:164)
at java.base/sun.security.ssl.SSLSocketImpl.decode(SSLSocketImpl.java:1152)
at java.base/sun.security.ssl.SSLSocketImpl.readHandshakeRecord(SSLSocketImpl.java:1063)
at java.base/sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:402)
at com.sun.mail.util.SocketFetcher.configureSSLSocket(SocketFetcher.java:598)
at com.sun.mail.util.SocketFetcher.startTLS(SocketFetcher.java:525)
at com.sun.mail.smtp.SMTPTransport.startTLS(SMTPTransport.java:2059)
... 11 more
Caused by: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
at java.base/sun.security.validator.PKIXValidator.doBuild(PKIXValidator.java:385)
at java.base/sun.security.validator.PKIXValidator.engineValidate(PKIXValidator.java:290)
at java.base/sun.security.validator.Validator.validate(Validator.java:264)
at java.base/sun.security.ssl.X509TrustManagerImpl.validate(X509TrustManagerImpl.java:321)
at java.base/sun.security.ssl.X509TrustManagerImpl.checkTrusted(X509TrustManagerImpl.java:221)
at java.base/sun.security.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:129)
at java.base/sun.security.ssl.CertificateMessage$T12CertificateConsumer.checkServerCerts(CertificateMessage.java:626)
... 24 more
Caused by: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
at java.base/sun.security.provider.certpath.SunCertPathBuilder.build(SunCertPathBuilder.java:141)
at java.base/sun.security.provider.certpath.SunCertPathBuilder.engineBuild(SunCertPathBuilder.java:126)
at java.base/java.security.cert.CertPathBuilder.build(CertPathBuilder.java:297)
at java.base/sun.security.validator.PKIXValidator.doBuild(PKIXValidator.java:380)
... 30 more
Aug 26, 2024 2:28:41 PM com.pnpsecure.dbsafer.mailer.MailSenderSmtp sendMail
SEVERE: Failed Send mail. retry(1/3). no(0)
[버전 정보]
1. pnp_mailer.sh 버전
- 1.3.12
2. Java 버전
- 11.0.1
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
1. pnp_mailer.sh test 진행 시 발생했던 에러 로그
첨부파일
[디앤오]pnp_mailer.sh test 시 발생 에러
.txt
null
파일 다운로드","김태윤: 인증서 관련 오류로 보입니다.
mail 서버에 공인 인증서를 사용하지 않는 경우 오류가 발생할 수 있을 것으로 보여집니다.
우선 담당 개발자에게 해당 내용 전달하였으며, 공인 인증서 여부 체크하는 부분을 무시하도록 해서 적용해 보는 것이 좋을 것으로 판단되어 개발자에게 전달하였으며, 연락 드릴 것입니다. | 김연수: 안녕하세요.
기술지원3팀 김연수입니다.

해당 이슈 빠르게 확인해주셔서 감사합니다.

담당 개발자분과 연락되었습니다.
개발자분과 함께 대응하도록 하겠습니다.

감사합니다.",https://cafe.naver.com/pnpsecure2/6639
6635,[CJ 대한통운] AWS Databrikcs 제어 가능 여부 관련 문의 드립니다.,"[분류] 기타문의
[고객사/채널사]
- CJ 대한통운
[이슈내용]
1. 요청사항
- 고객사 CJ 대한통운에서 dbeaver등의 DB Tool을 사용하여 AWS상의 Databrikcs에 접속하여
쿼리 조회 업무를 수행하여야 하는데 DB접근제어가 필요한 상황이라고 합니다.
그에 따른 아래와 같은 두 가지 사항에 대해서 질의가 들어와 문의 드립니다.
1. AWS 내 Databrikcs에 SQL 수행 시 제어가 가능한지
(**지원 DBMS 문서에는 지원 DBMS에 없는 것 확인하였으나 확인 한 번 받은 후 답변 드리려고 합니다.)
2. Databrikcs가 지원불가라면 향후 계획은 없는지
위 내용 확인 부탁드립니다.
감사합니다.","김태윤: DBeaver를 통한 NoSQL 지원 기능으로 지원 예정입니다.
안정화 단계를 감안할 경우 내년 1분기에 사이트 지원할 수 있을 것으로 예상하고 있습니다.

현재는 ClickHouse에 대해서 테스트 진행하고 있으며, 이후 Arrow Flight SQL 진행 예정입니다.
또한 결재 관련해서는 아직은 미 지원 상황이며, 추후 지원할 예정입니다.

감사합니다.",https://cafe.naver.com/pnpsecure2/6635
6621,[삼성SDI 베트남] 일부 사용자 로그인 정보 표시 불가 현상,"[개요]
매니저 - 보안계정 확인 시 일부 사용자의 로그인 정보가 표시되지 않는 현상 발생
(로그인, 로그인 IP주소, NAT 버전)
[고객사 환경]
Log + G/W, G/W2 총 2식 구성
DBSAFER5
pnp_oms_dms : R670
[증상]
매니저 - 보안계정 조회 시 일부 사용자 대상으로 PC Agent에 접속 중임에도 로그인 정보가 표시되지 않음
DBSAFER를 통해서 서비스 접속은 정상적으로 수행되며 로그 조회 시 사용자 로그 조회 가능
사용자 로그인 정보 표시 불가
[원인]
삼성SDI 베트남 법인의 경우 Log+gw, g/w2 총 2대로 구성되어 있으며 PC Agent 중복 로그인 기능을 사용 중
중복 로그인 기능 사용을 위해서는 multi_agent_login.conf 파일을 생성해야 하는데
Log+g/w 서버에만 multi_agent_login.conf 파일이 존재하고 g/w2 서버에는 파일이 없는 것을 확인
[조치]
g/w 2번 서버에도 multi_agent_login 파일을 생성하여 서버 2대 모두 중복 로그인 기능 활성화 진행하였으나
고객사 담당자 요청으로 중복 로그인 기능 비활성화 진행 후 사용자 접속 정보가 정상적으로 표시됨
[추가사항]
oms_dms v1에서는 multi_agent_login.conf 파일이 존재하면 사용자 접속 기록을 oms_access 테이블에 기록하고
파일이 존재하지 않을 경우에는 dbsafer_ldap_list에 사용자 접속 기록을 로깅
mutil_agent_login.conf 파일이 있을 경우 variables 테이블의 mgr_oms_multi_access 값이 1로 표시됨(중복 로그인)
mgr_oms_multi_access 값이 1일 경우 사용자 접속 정보를 dbsafer3.oms_access에 기록함
중복 로그인 설정 시 mgr_oms_use_multi_access 값
중복 로그인 설정 시 oms_access에 정보를 기록
mutil_agent_login.conf 파일이 없는 경우 variables 테이블의 mgr_oms_multi_access 값이 0으로 표시됨(단일 로그인)
mgr_oms_multi_access 값이 0일 경우 사용자 접속 정보를 dbsafer3.dbsafer_ldap_list에 기록함
단일 로그인 설정 시 mgr_oms_use_multi_access 값
단일 로그인 설정 시 dbsafer_ldap_list에 기록
pnp_oms_dms v1에서는 중복 로그인 설정 시 사용자 접속 ip를 모두 표시하지 못함
pnp_oms_dms v2에서는 해당 부분이 수정되어 중복 로그인 설정 시 사용자 접속 ip를 모두 표시
중복 로그인 설정
mgr_oms_multi_access
pnp_oms_dms : ver v1
단일 로그인
0
pnp_oms_dms : ver v1
중복 로그인
1
pnp_oms_dms : ver v2
단일 로그인
2
pnp_oms_dms : ver v2
중복 로그인
1
[주의사항]
이중화 구성의 경우 모든 G/W 서버에 중복 로그인 혹은 단일 로그인 설정 통일 필요
중복 로그인 설정 시 모든 G/W 서버에 multi_agent_login.conf 파일 생성 필수
단일 로그인 설정 시 모든 G/W 서버에서 multi_agent_login.conf 파일 삭제 필수
한쪽 서버에만 해당 파일이 존재할 경우 마지막으로 실행된 pnp_oms_dms 모듈 기준으로 설정되며
매니저에서 보안계정의 접속 정보 확인이 불가능할 수 있습니다.
서버 설정이 다를경우 사용자 접속 정보 확인 불가
Test 서버의 경우 137번 서버에 multi_agent_login.conf 파일이 존재하며 pnp_oms_dms 모듈을 1분 늦게 가동
138번 서버의 경우 multi_agent_login.conf 설정 파일을 생성하지 않아 단일 로그인으로 설정되어 있음
실제로 사용자가 접속한 G/W 서버는 138번 서버이며 매니저에서 해당 사용자의 접속 정보 확인 불가능
문제 해결에 도움을 주신 강정근 부장님, 이승민 차장님께 감사드립니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6621
6599,"""Being Delayed to process log datas"" 경고로그 관련 내용 정리","Being Delayed to process log datas
해당 메시지는 pnp_log 에서 60초 동안 로그 처리가 지연될때 기록 됩니다.
> 로그큐에 데이터가 저장되고 처리 후 삭제되는 과정에 지연이 60초 동안 발생시 기록
> Bulk insert 진행중에는 기록하지 않음
[히스토리 및 상세]
[BT:8802] [DBSAFER] 장비 장애 상황을 snapshot (top-log) 할 수 있는 GUI 고려
> 최초 기능 추가 시점에 메시지는 ""Error occurred in log daemon, Can not process log data.""
- pnp_log : Rev 582이상
- pnp_sysmon : Rev 130이상
[BT:19048] [페퍼저축은행][신세계아이앤씨] 관리서버 기타 -LOG_PROCESS_001 ERRMSG 에러로그 처리 관련
> 해당 시점에 Bulk insert 예외처리 추가됨
- pnp_log : Rev 673이상
[BT:21304] [현대차] ""Error occurred in log daemon, Can not process log data."" 문구 수정
> 해당 시점에서 문구가 변경됨
- pnp_log : Rev 699이상
""Error occurred in log daemon, Can not process log data."" -> ""Being Delayed to process log datas.""",댓글 없음,https://cafe.naver.com/pnpsecure2/6599
6598,[국방 DIDC 1센터] Cubrid 접속 안되는 현상 분석 및 내용 공유,"국방 DIDC 1센터 Cubrid 접속 안되는 현상
- 배경
1. DBSAFER를 통해 Cubrid 접속 시 접속이 불가능한 현상
2. 샤크라 윈백 사업건이며 DBSAFER로 전환중에 발생한 현상
- 확인된 사항
1. 샤크라를 통해서 접속 시 정상 접속 확인
2. 대상 Cubrid 담당자에게 특이사항 문의 시 Cubrid의 문제는 없다고 전달 받음
- 조치
1. Cubrid ACL 기능 확인
2. ACL 허용 리스트 파일에 DBSAFER IP 추가
[통신 상태 확인]
1. DBSAFER 서버 to Cubrid 서버
- DBSAFER 서버에서 telnet 으로 Cubrid 서버 확인 시 정상 통신 확인
2. DBSAFER 서버, Cubrid 서버 tcpdump를 통한 확인
- DBSAFER 서버에서 Cubrid 서버로 정상 통신 요청 확인
- Cubrid 서버 to DBSAFER 서버에 Fin 패킷을 전달하는 것을 확인
3. 서버 보안(Secuve) 로그 확인 시 정상 통신 확인
4. 대상 객체를 Telnet Pass 객체로 전환 후 접속 시도 시 접속 불가
-> cubrid 모듈의 문제가 아닌 것으로 추정됨
[Cubrid 서버 확인]
※ 서버 접속 정보를 전달 받아 직접 접속하여 설정 값을 확인 ※
1. cubrid 경로 확인
- cd $CUBRID/conf/cubrid.conf
- 위 명령어로 이동이 불가능할 시 CUBRID 경로로 이동하여 conf 경로 이동
2. cubrid.conf 확인 시 ACL 설정은 미적용으로 되어 있음
3. cubrid_broker.conf 파일 확인 시 access_control이 on으로 ACL 관리를 하는 것으로 추정
-> 하단에 ACCESS_CONTROL_FILE = 파일경로 EX) /home/cubrid/CUBRID/conf/acl.access
-> 파일경로에 가서 파일 확인 시 IP 리스트 파일 경로 추가로 기입되어 있음을 확인
-> 추가 기입된 파일 확인 시 IP 리스트가 나열되어 있음
-> 해당 허용 IP 리스트에 샤크라 IP는 있지만 DBSAFER IP는 기입되어 있지 않는 것을 확인
※ Cubrid broker 란 ※
1. DBMS에 접속을 요청하는 외부 요청을 중간에서 중계해주는 역할
2. 여러개의 DB를 운영함에 있어 관리가 용이
3. 외부 - broker - DB 의 구조를 통하여 통신
[결론]
1. Cubrid broker ACL을 통하여 차단되어 접속이 불가능
[조치 방안]
1. ACL IP 허용 파일에 DBSAFER IP 기입
2. Cubrid DBMS 재기동 필요
-> 고객에게 환경 및 현상에 대하여 공유 완료
-> 추후 Cubrid 재기동 진행 예정
--------------------------------사이트 특성상 증적 자료 전달은 어려운점 양해 부탁드립니다------------------------------
해당 설정이후 Cubrid 재기동하여 정상 동작함을 확인하였습니다.
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6598
6596,[공지] BBS 게시판 정리,"장기간 사용되고 있는 BBS 를 정리합니다. 아래의 목적과 기준으로 정리를 진행합니다.
정리 시에 다운로드 가능한 고객사 전용 버전은 예외 할 예정이나 담당 엔지니어 분들께서는 사전에 필요한 것은 확인을 해주시기 바랍니다.
[정리 일정]
2024년 08월 05일(월) 부터 순차 진행 예정
[정리 목적]
장기간 사용되어서 누적된 BBS 에 2024년 기준으로 사용이 되지 않는 게시판 및 다운로드 되지 않는 다수의 게시글로 인한 문제 해결
[게시판 정리 기준]
2016년 이전 기준으로 등록자가 ""Guest"" 인 게시판 삭제 (실제 다운로드 불가 게시글)
최상단 게시판에서 사용성 없거나 적은 게시판의 삭제 및 비활성화
실제 사용이 적으나 필요한 게시판은 ""기타 프로젝트""로 게시판으로 통합 관리
BBS 등록 필수가 아닌 게시글 삭제
필요 시 빌드가 가능한 범위의 매니저 프로그램 삭제 (대상은 하위 ""게시글 삭제 대상"" 참고)
고객사 전용은 삭제 제외
매니저 기타의 경우 게시 내용인 svn 로그는 svn 로그로 확인 가능하며 빌드도 버전 관리로 가능하여 오래 된 게시글을 삭제하고자 합니다.
[기대효과]
최상단의 게시판을 필요 항목으로 구성하여 찾기 쉽도록 구성
게시판 명칭 변경으로 필요한 모듈 찾기가 쉽게 효율성 증대
주요 변경사항은 아래와 같습니다.
게시판 및 게시글 삭제 대상
공지사항 (카테고리) 및 공지사항 게시판
IT 트랜드 & 기술 공유 (내용이 있는 글은 그룹웨어 지식 공유로 이동 예정)
게시판 - 사이트 정보 공유
게시판 - 자유게시판 (하위 아이디어 및 자유게시판 내용 중 일부는 그룹웨어 지식 공유로 이동 예정)
UNISAFER (게시글 없음)
DBSAFER AM (게시글 없음)
INSTAT (""OLD 프로젝트 - 기타"" 게시판으로 게시글 이동 후 삭제)
PNP_SUPPORT (""OLD 프로젝트 - 기타"" 게시판으로 게시글 이동 후 삭제)
WebGateDB (""OLD 프로젝트 - 기타"" 게시판으로 게시글 이동 후 삭제)
DBSAFER 패키지 미포함 모듈 - 윈도우 : 자료실 - 업무용 프로그램 공유 로 게시글 이동 후 삭제
게시글 삭제 대상
DBSAFER v 5.0 - 매니저 기타 하위 게시글
5.0.9.4 ALPHA (Build - 6999) 이하 삭제
DBSAFER v 3.0 - 매니저 기타 하위 게시글
Manager Enterprise 3.0.8.0 ALPHA (Build - 3977) 이하 삭제
NODESAFER 4.0.8.0 (Bulid - 3958) 이하 삭제
DBSAFER v 2.0 - 매니저 설치 릴리즈 하위 제외 전체 게시글
<2.0.5.0> 통신패킷1.21 - 일반
<2.0.4.9> 통신패킷1.23 - 일반
<2.0.4.9> 통신패킷1.19 - 일반
<2.0.5.3> 통신패킷1.21 OTP (+SSL)
<2.0.5.2> 통신패킷1.19 OTP (+SSL)
DBSAFER v 2.0 - 매니저 설치 기타 하위 제외 전체 게시글
[LogViewer 1.21][v1099] 기본 보고서 설치본
2.0용 대량 로그 백업 프로그램
게시판 비활성화 (보이지 않도록 설정) 대상
DBSAFER v 3.0
DBSAFER v 2.0
WASSAFER v 4.0
OLD 프로젝트
게시판 이동
매뉴얼 및 문서 : 매뉴얼 카테고리 구성 후 이동
DB 툴 내보내기 제어 : ""기타 프로젝트"" 게시판 생성 후 하위로 이동
결재시스템 : DECIDE V 3.0 으로 이름 변경 후 결재시스템으로 이동
결재관리시스템 : DMS 로 이름 변경 후 결재시스템으로 이동
사이트 커스터마이징 모듈 : ""연동 및 서버 운용 모듈"" 하위 커스텀 모듈로 명칭 변경 후 이동
DBSAFER 패키지 미포함 모듈 - 서버 : ""연동 및 서버 운용 모듈"" 하위 연동 모듈로 명칭 변경 후 이동
""USER TRACER"" 을 ""개인정보 모니터링 (INFOSAFER)"" 하위로 이동
신규 게시판
연동 및 운용 서포트 모듈 : DBSAFER 운영 보조 모듈 및 사이트 연동 모듈",현승환: BBS게시판 정리는 품질보증실 여성구 팀장님이 진행하고 계십니다 .(참고),https://cafe.naver.com/pnpsecure2/6596
6588,[GS리테일] RDP 클립보드 제어기능 지원 범위 문의드립니다.,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기능로직문의
[고객사/채널사]
GS리테일
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
3. 특이사항 (연동 모듈, 커스텀 개발 등)
4. 사내 재현 정보
5. 요청사항
* DBSAFER 7.0 환경에서 RDP 클립보드 기능 지원 범위 문의드립니다. 기능명세서 상으로는 PC Agent 자동접속 기능을 통해 실행된 remotecon.exe에서만 통제가 가능한 것처럼 보여 문의드립니다.
금번 프로젝트에서 게이트원의 서버접근제어 솔루션을 AM으로 윈백해야 하며, 게이트원으로는 웹을 통해 접속한 원격 데스크톱에서 클립보드 제어가 가능하다고 합니다.
하여 IM에서 자동접속 리스트를 AM 기준으로 출력하도록 설정하여 웹 기반의 자동접속 환경을 제공하면서 클립보드 통제 기능을 적용하는 것을 고려하였으나, 제어가 되지 않아 문의드립니다.
* 별개로 DBSAFER 5.0에서도 클립보드 제어 기능이 동일하게 있는 것으로 아는데, PC Agent 자동접속 기능은 7.0에서만 사용해야 하는 것으로 알고있습니다. 만약 PC Agent를 통한 remotecon에서만 클립보드 제어가 가능하다면 5.0에서는 어떻게 기능적용이 가능한지 문의드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
DBSAFER 7.0 최신패키지
pnp_oms_dms r1122
PC Agent 3.3.1.8
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","박수아: 안녕하세요. 강성우 대리님 문의 주신 사항 답변 드립니다.

1. DBSAFER 7.0 환경에서 RDP 클립보드 기능 지원 범위
- RDP 통제 기능은 PC Agent 의 remoteconn.exe 접속을 통해서만 제공합니다.
- remoteconn.exe 접속이 아닌 경우에는 SA 를 통한 우회 접속 통제 기능의 범위에서 제공 가능하며, IM 의 웹 자동 접속에서는 현재는 기능 제공하지 않아 추가 기능 개발이 필요한 사항입니다.

2. PC Agent를 통한 remotecon에서만 클립보드 제어가 가능하다면 5.0에서는 어떻게 기능 적용이 가능한지 문의 드립니다.
- DBSAFER 5.0 패키지로 PC Assist 3.3 자동접속 기능 적용 사례 카페 게시글 공유 드립니다. (https://cafe.naver.com/pnpsecure2/5823)

참고
- ASSIST 의 접속기능을 통해 실행되는 remoteconn.exe 으로의 접속이라면 '자동접속' 뿐 아니라 '일반접속' (사",https://cafe.naver.com/pnpsecure2/6588
6580,[LG 유플러스 NMS팀] MSSQL 대상으로 ssl_proxy 모듈로 접근 시 접속이 안되는 현상,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
에러로그문의
[고객사/채널사]
LG 유플러스 NMS팀
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크
- ssl_proxy가 적용된 환경에서 mssql 접속 시 접속이 안되는 현상
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- ssl_proxy 로그에서 key가 짧다는 내용의 로그 확인
ssl_proxy 로그
- 대상 서버가 오래된 서버이기에 SSL 키교환 시 대상 서버의 KEY 길이가 짧아 세션이 맺어지지 않는 것으로 추정
- /usr/local/magiccrypto/ssl/openssl.cnf 파일에서 아래의 내용 추가 후 서비스 객체 재기동 진행하여도 동일
[ default_conf ]
ssl_conf = ssl_sect
[ssl_sect]
system_default = ssl_default_sect
[ssl_default_sect]
MinProtocol = TLSv1.2
CipherString = DEFAULT:@SECLEVEL=0
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 없음
4. 사내 재현 정보
- 없음
5. 요청사항
- 해당 에러로그가 발생하는 원인 및 조치 방안에 대한 가이드
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
SSL_PROXY : Rev 116
pnp_mssql : v2227
CUSTOMSET : CustomSet_Rocky8_20221006
OPENSSL : 1.1.1
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
첨부파일
success_mssql
.txt
null
파일 다운로드
첨부파일
fail_mssql
.txt
null
파일 다운로드
-> 테스트하시는 사용자분께서 중간에 외근으로 인하여 txt 파일로 대체합니다.
-> 확인하신 이후 PCAP 파일이 필요하시다면 추출하여 재전달 드리겠습니다.","박승민: 패킷을 자세히 확인할 수 없었으나, 확인 시 TLSv1.3으로 연결을 시도하는 것처럼 보여집니다.
현재 ssl_proxy에서는 MSSQL 대상으로 TLSv1.3 지원이 불가하며 최신 버전에서는 TLSv1.2까지만 지원하도록 낮춰두었습니다.

키 길이가 문제가 되는지는 패킷을 통해 확인하기 어려웠습니다.

MSSQL 서비스 대상으로 TLSv1.2 제한을 포함해 ssl_proxy 에서 이슈(접속 실패 및 끊어짐 현상) 패치가 많이 있었기 때문에,
최신 버전 패치 후 패킷 재취득 가능한지 확인 부탁드립니다. | 여성구: 본 사항 이슈 입니다. bugs 로 등록해주세요. 등록 시에 개발자 요청 정보 포함해서 등록해주세요. | 김태윤: 해당 이슈의 경우 pnp_ssl_proxy 빌드 요청해 주기 바랍니다.

최신 pnp_ssl_proxy 모듈의 경우 TLS 1.2로 통신할 수 있도록 수정되어 있으며, 패치 적용 후 문제 사항이 발생되면 재 문의 바랍니다.

감사합니다.",https://cafe.naver.com/pnpsecure2/6580
6570,[TIP]OS Rocky 8.6에서 Binary Update로 8.10으로 패치 방법 공유드립니다.,"Rocky 8.6에서 Binary Update로 8.10으로 패치 방법 공유드립니다.
작업 후 재기동을 하지않아도 Rocky8.10 으로 변경되지만, 재기동 후에도 정상적으로 Rokcy 8.10으로 반영되어 있습니다.
* 고객사 환경마다 다르므로 꼭 사내테스트 진행해보시길 권장 드립니다.
* 댓글은 Q&A 답변이므로 신경쓰지 않으셔도 됩니다.
작업순서
단계구분
작업상세
1
OS Binary 및 결재시스템 패치 파일 업로드
/path/to/downloads 경로에 하단의 파일 업로드
- os_binary_patch.tar.gz
- drpm-0.4.1-3.el8.x86_64.rpm
- python3-distro-1.4.0-2.module+el8.10.0+1592+61442852.noarch.rpm
- createrepo_c-libs-0.17.7-6.el8.x86_64.rpm
- createrepo_c-0.17.7-6.el8.x86_64.rpm
2
RPM 설치
rpm -ivh drpm-0.4.1-3.el8.x86_64.rpm
rpm -ivh python3-distro-1.4.0-2.module+el8.10.0+1592+61442852.noarch.rpm
rpm -ivh createrepo_c-libs-0.17.7-6.el8.x86_64.rpm
rpm -ivh createrepo_c-0.17.7-6.el8.x86_64.rpm
3
Localrepo 설정
mkdir -p /mnt/localrepo
cp /path/to/downloads/* /mnt/localrepo/
vi /etc/yum.repos.d/localrepo.repo
> 파일에 하단의 내용 추가
[localrepo]
name=Local Repository
baseurl=file:///mnt/localrepo
enabled=1
gpgcheck=0
4
기존 repo 수정
vi /etc/yum.repos.d/Rocky-AppStream.repo
vi /etc/yum.repos.d/Rocky-BaseOS.repo
vi /etc/yum.repos.d/Rocky-Extras.repo
> 파일에 하단의 내용 수정
enabled=1 → enabled=0
5
OS Binary 업그레이드
createrepo /mnt/localrepo
dnf clean all
dnf makecache
dnf upgrade dnf
dnf upgrade -y --skip-broken --nobest
dnf clean all
[파일 첨부]
첨부파일
createrepo_c-0.17.7-6.el8.x86_64
.rpm
null
파일 다운로드
첨부파일
createrepo_c-libs-0.17.7-6.el8.x86_64
.rpm
null
파일 다운로드
첨부파일
drpm-0.4.1-3.el8.x86_64
.rpm
null
파일 다운로드
첨부파일
python3-distro-1.4.0-2.module+el8.10.0+1592+61442852.noarch
.rpm
null
파일 다운로드
https://drive.google.com/file/d/1tBqFCCyF6fn9rVgeukQsoc3bOA1CRof_/view?usp=drive_link
os_binary_patch.tar.gz
drive.google.com","여성구: 내용 확인하였습니다. 담당자에게 확인 요청하였습니다.
Rocky 8.7 미니멀이라면 가능 할 것 같습니다. 단, 고객사 환경과 동일한 것에서 진행이 필요합니다. 고객사 환경을 내부에 구성 부탁드립니다.
라이브러리 때문에 체크가 필요합니다. | 김태윤: AWS Cloud에서 Rocky Linux 8.9에서 8.10으로 업그레이드 하는 부분에 대해서는 가이드 된 부분이 있습니다.
https://cafe.naver.com/pnpsecure2/6536

참고하시기 바랍니다. | 이임재: 1. dnf-utils 설치
sudo dnf install -y dnf-utils

2. 업그레이드 준비
sudo dnf upgrade -y

3. 리포지토리 캐시 재생성
sudo dnf clean all
sudo dnf --releasever=8.10 distro-sync -y

4. 그룹 설치: Base 패키지 그룹을 설치하여 필요한 패키지
sudo dnf groupupdate ""Base"" -y

5. 재부팅 및 확인
sudo reboot
cat /etc/os-release | 이상민: 최근 코리안리재보험 구축 시 Rocky 8.9를 8.10으로 업데이트 해야 하는 요건이 있었습니다.
다만, 해당 고객사는 금융권이기 때문에 yum을 통한 rocky 공식 레파지토리 URL 접근을 허용하지 않았습니다.
(따라서 yum or dnf 사용 불가)

사내 환경의 Rocky 8.9에서 yum을 사용하여 os 업데이트에 필요한 rpm을 모두 다운로드 받은 뒤
또 다른 Rocky 8.9에서 해당 rpm을 사용하여 OS 수동 업데이트 테스트를 진행 했었습니다.
*주의/차이점 : DBSAFER는 설치되지 않은 상태에서 OS 업데이트 진행했었음

[Rocky 버전 업데이트]
1. yum update 파일 다운로드
# yum update -y --downloadonly
- /var/cache/dnf/baseos 경로와 /var/cache/dnf/appstream 경로에 rpm 파일 약 190개가 다운로드 됨
2. 커널 rpm만 다른 경로로 옮겨놓고 ivh로 설치
# rpm -ivh li",https://cafe.naver.com/pnpsecure2/6570
6539,[한국사이버결제] OpenSSH 취약점 확인 문의 (pnp_sshd),"[분류]
- 기타문의
[고객사/채널사]
- 한국사이버결제
[문의내용]
1. 확인요청
- 취약점 항목 : OpenSSH < 3.1 Channel Code Off by One Remote Privilege Escalation
- 취약점 설명 : 3.1 이전 버전의 OpenSSH를 실행하고 있습니다. 이 경우, 원격 권한 상승, 임의 코드 실행 취약점이 발생할 수 있습니다.
- 현재 버전 : SSH-1.99-OpenSSH_3.0 DBSAFER_2.30.164
- 조치 방법으로는 최신 버전 업데이트를 권고 받았으며, 최신 OpenSSH 버전으로 업데이트가 가능한지 확인 요청드립니다.
- 조치 불가 시 불가능한 사유 부탁드립니다.
2. 기타
- DBSAFER에서 사용하는 pnp_sshd 및 ssh_p6 는 자체 개발되어 OpenSSH 3.0 버전은 DBSAFER에서 명시한 버전이다 라고 답변했는데 정확한 확인 및 가이드를 달라고 하여 문의드립니다.","이임재: pnp_sshd가 openssh3 기반으로 만들어진 모듈이라서
모듈 자체의 수정이 불가합니다. 또한
pnp_sshd는 더이상 패치가 진행되고 있지 않아서
ssh_proxy로 패치 및 업그레이드로 가이드 해야할것 같습니다. | 이임재: ssh_proxy는 libssh를 사용하기 때문에 openssh 3 취약점 해당 없습니다.",https://cafe.naver.com/pnpsecure2/6539
6513,[현기차 생산망] openssh 버전 지원 문의 드립니다.,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
현기차 생산망
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
- openssh 버전 업그레이드
- 현재 8.0p1 버전 사용중에 있습니다.
- 업그레이드 요청 버전은 9.8p1 버전 이상입니다.
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
-
3. 특이사항 (연동 모듈, 커스텀 개발 등)
-
4. 사내 재현 정보
-
5. 요청사항
- oepnssh 9.8p1 버전 이상으로 적용해도 문제가 없는지 확인 부탁드립니다.
- 적용해도 문제가 없다면 가이드 부탁드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
- OS : Rocky 8.6
- openssh : 8.0p1
- PKG : PKG_DBSAFER7_RelV7-R22.11-RockyLinux_x86_64_20230413
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","이임재: 관련 카페 내용이 있습니다.
https://cafe.naver.com/pnpsecure2/6514

9.8p1 버전 패치 파일은
차주 12일까지 제공 예정입니다. | 이임재: https://bbs.pnpsecure.com/showthread.php?tid=12689",https://cafe.naver.com/pnpsecure2/6513
6510,[제주항공] Python 라이브러리 js2py RCE 취약점(CVE-2024-28397) 영향도 확인 요청,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
제주항공
1. 요청사항
- CVE-2024-28397 취약점이 발견되었는데, DBSAFER가 받는 영향이 있는지 확인 요청이 들어와 문의 드립니다.
[버전 정보]
- OS : CentOS5.9 / CenOS6.8 총 2대
- python2.6 / python2.4 설치 되어있는 것으로 확인됨","김영회: 참고) INFOSAFER 의 경우 관련 없습니다. | 이창제: 확인 감사드립니다 ! | 이임재: Python 2.6 또는 2.4가 설치된다고 해서
js2py가 자동으로 설치되지는 않습니다.
js2py는 별도로 설치해야 하는 라이브러리이며

현재 DBSAFER에서 사용되고 있지 않습니다.
다른 이유로 고객사 환경에서 설치되어 있는지 확인 하는 법은
아래와 같습니다.

find /usr/lib/python2.*/site-packages/ -name ""js2py"" 2>/dev/null
pip list | grep js2py | 이창제: 확인 감사드립니다 !

알려주신 명령어로 확인 진행 후 고객사에 내용 전달 진행하도록 하겠습니다.",https://cafe.naver.com/pnpsecure2/6510
6505,[TIP] Manager 업그레이드 시 TCP 제어 정책에서 ip그룹이 표시 안 되는 경우,"Build-6297 이전 버전에서 최신 버전으로 Manager 업그레이드를 진행한 경우 TCP 제어정책 > ip 그룹 지정 시 표시가 안 되는 이슈가 발생할 수 있습니다.
[원인]
- ip_group_index 필드가 0으로 설정되는 이슈가 있음
- 정책 적용에는 문제가 없음
> SM에서 그룹명 기준으로 정책을 수집하기 때문에 인덱스가 0이라도 정책 적용에는 문제가 없습니다.
[해결 방법]
대상 테이블에 대하여 아래 쿼리 실행
- 대상 테이블 : policy_hf_auth , policy_hf_auth _history, policy_hf_out_auth, policy_hf_out_auth_history
#### Query ####
UPDATE
policy_hf_auth AS T1,
client_ip_group AS T2
SET
T1.ip_group_index = T2.group_index
WHERE
T1.ip_group_index = 0
AND LENGTH(T1.ip_client_group) > 0
AND T2.group_name = T1.ip_client_group
[관련 내용]
- bugs
- 기술 메뉴얼",댓글 없음,https://cafe.naver.com/pnpsecure2/6505
6497,[공유] 공인 IP를 통해 Works 페이지를 접속하는 환경에서 Assist Host 다운로드 시 사설 IP로 다운로드 되는 현상,"안녕하세요
클라우드기술팀 손혁진입니다.
지엔터프라이즈 고객사는 공인 IP를 통해 Works 페이지를 접속하는 환경입니다.
Works 접속 시 Assist-Host가 설치 되어있지 않는 경우 Assist-Host 다운로드 URL로 redirect 후 Assist-Host가 다운로드가 발생합니다.
이때 공인 IP를 통해 works 페이지를 접속하는 환경에서 AssistHost 다운로드 URL이 사설 IP로 redirect 되어 Assist-Host가 정상적으로 다운로드 되지 않은 현상이 있어 내용 공유드립니다.
고객사 환경
- OS : Rocky8
- DBSAFER : V7.0
- 구성 : 단독
- Works 버전 : WORKS_V7.0.1.0-r
[요약]
- 고객사는 공인 IP를 통해 Works 페이지를 접속하는 환경
- /home/webproperties/imup/config.properties에 아래 내용 설정
. cors.allowed.origins를 공인 IP로 설정
. assisthost.download.url.use.cors=Y으로 설정
- 위와 같이 설정 시 cors.allowed.origins에 설정 된 공인 IP 기준으로 Assist-host 다운로드 URL이 redirect 되어야하나 사설 IP 기준으로 redirect 되는 현상 발생
- 내부 확인 결과 ""assisthost.download.url.use.cors"" 해당 옵션은 사용 불가한 옵션으로 확인
- Works > 시스템옵션관리(엔지니어) > GLOBAL_DEFAULT > 'useCORSURLForAssistHostDownload' 옵션 true로 변경 후 정상 동작 확인
[증상]
- 공인 IP(3.X.X.X)로 Works 접속 시 사설 IP(172.X.X.X)로 Assist-Host 다운로드 URL redirect된 현상
공인 IP로 Works 접속
- 공인 IP로 Works 접속 시 공인 IP로 ASSIST-HOST를 다운로드 받을 수 있도록 아래와 같이 설정
/home/webproperties/imup/config/properties 설정 파일
- pnpweb 재기동
- 기존 이슈와 동일하게 사설 IP(172.X.X.X)로 Assist-Host 다운로드 URL redirect되는 현상 발생
공인 IP로 Works 접속
[원인]
- 내부 확인 결과 /home/webproperties/imup/config/properties 설정 파일 내 ""assisthost.download.url.use.cors"" 옵션은 현재 미사용 옵션으로 확인
[조치 방법]
- Works > 시스템옵션관리(엔지니어) > GLOBAL_DEFAULT > 'useCORSURLForAssistHostDownload' 옵션 true로 변경 후 웹 재기동
Works > 시스템옵션관리(엔지니어) > GLOBAL_DEFAULT 이동
'useCORSURLForAssistHostDownload' 옵션 true로 변경
pnpweb 재기동
ASSIST-HOST 정상 다운로드 완료
감사합니다.","이건국: config.properties의 assisthost.download.url.use.cors 옵션은 헷갈릴 소지가 있어 설정 파일 상에서 제거하도록 요청하였습니다.
https://bugs.pnpsecure.com/view.php?id=28148",https://cafe.naver.com/pnpsecure2/6497
6495,[TIP] DBSAFER 서버 자원 임계치 알림 Slack 연동 방법 공유,"안녕하세요. 클라우드기술팀 김영은입니다.
고객사 칼리버스에서 DBSAFER 서버 자원 임계치 알림 Slack 연동 요청이 있어 적용한 사례 공유드립니다.
Slack 환경 구성
1. 알림을 전달받을 채널 추가
2. Incoming WebHooks 앱 추가
- 생성한 채널 선택 > 채널 상세 > 통합 탭 > 앱 추가
- Incoming WebHooks 설치 후 채널에 포스트하여 WebHooks URL 확인
DBSAFER 설정
1. pnp_mailer.properties
- 경로: /dbsafer/.conf
# Mailer properties file.
################################################################################
# Set class path to send mail (default: com.pnpsecure.dbsafer.mailer.MailSenderSmtp)
# smtp: com.pnpsecure.dbsafer.mailer.MailSenderSmtp
# url: com.pnpsecure.dbsafer.mailer.MailSenderUrl
mailType=com.pnpsecure.dbsafer.mailer.MailSenderUrl
################################################################################
## URL set ##
# HTTP send methods (0:GET, 1:POST) (default:0)
urlSendType=1
# HTTP Url (Required)
# Can use reserved
#i nsertUrl=[Webhooks URL 입력]
insertUrl=https://hooks.slack.com/services/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
# HTTP Header
# Field/Value delimiter(:), Multiple fields delimiter(,)
# ex) {field1}:{value1}, {field2}:{value2} ...
insertUrlHeader=Accept:application/json, Content-Type:application/json; charset=utf-8
# HTTP Body
# Can use reserved
insertUrlBody={ ""username"":""DBSAFER"",""text"":""[[COMMENT]]""}
# set CharterSet
charterSet = UTF-8
# 자동 인코딩설정을 수행할지 여부를 설정함. (default:0)
# 0 - not use (latin 기준으로 메시지를 전달)
# 1 - use (메시지의 인코딩 확인 후 문자열을 인코딩 변환하여 전달)
set_charterset_command =  1
# SMTP Server Characterset. Set the character set of the SMTP server.
# default (KOREAN:""euc-kr"", ENGLISH/JAPANESE=:""utf-8"")
# The Language information can be confirmed by executing given command(./[prefix]_mailer.sh)
serverCharaterset = UTF-8
- 연동 테스트
# ./pnp_mailer.sh test
2. pnp_sysmon.conf
- 경로: /dbsafer/.conf
# 메일 발송 주기를 설정 합니다. (단위:초)
# 0으로 설정하면 발송하지 않습니다.
# Example : 1800
# Default : 0
MAIL_SEND_TIME = 1800
# 메일 수신자를 설정 합니다.
# Example : admin@pnpsecure.com
# Default : NULL
# 임의값 입력 필수
MAIL_TO = test@test.com
# 메일 제목을 설정 합니다. (스페이스 이후의 문자는 무시 됩니다.)
# Example : 경고알림.
# Default : NULL
# 임의값 입력 필수
MAIL_SUBJECT = DBSAFER alert
# DISK, CPU, MEMORY 임계치 초과시 메일로 발송 합니다.
# Example : 90
# Default : 90
# 임계치 값 요구사항에 맞춰 수정
MAIL_LIMIT_DISK = 80
MAIL_LIMIT_CPU = 80
MAIL_LIMIT_MEM = 80
##############################################################################################
# Alert( E-mail, SMS ) options for CPU, Memory, HDD Usage of DBSAFER server module
##############################################################################################
# DBSAFER Process 의 CPU, MEMORY 임계치 초과시 Mail / SMS 발신 설정
# Example : 1
# Default : 0
PROCESS_ALERT_MAIL = 1
#PROCESS_ALERT_SMS = 1
3. sysmon_system_info_mail_form.txt
- 경로: /dbsafer/.conf
- 전달하는 메시지 양식 작성하는 파일
- 작성 예시
*DBSAFER Resource 임계치 초과*
- SERVER IP: [[SERVERIP]]
- SERVER NAME: [[SERVERNAME]]
'''
• CPU  사용률: [[CPUUSE]]% (임계치: [[CPULIMIT]]%)
• MEM  사용률: [[MEMUSE]]% (임계치: [[MEMLIMIT]]%)
• DISK 사용률: [[DISKUSE]]% (임계치: [[DISKLIMIT]]%[[DISKNAME]])
'''
4. 모듈 시작
# ./pnp_mailer.sh start
# ./pnp_sysmon start
적용 결과
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6495
6488,[DBSAFER5][TIP] 감사로그 이관 진행 과정 중 Needs upgrade 지속적으로 발생 시 조치 방법,"[개요]
최근 CentOS EoS 로 인한 OS 업그레이드 작업 건이 많은데, 대게 신규 PKG의 MariaDB 10.6 버전보다 하위의 버전에서 이관되는 경우가 많습니다. 이에, 감사로그 이관 진행 과정 중 mysql_upgrade 명령어를 사용하게 되는데, 해당 과정을 진행하였음에도 Needs upgrade 문구가 지속적으로 발생하는 경우가 존재하여 조치 방안에 대해 공유드립니다.
[발생 환경]
- 감사로그 DB 이관 대상 DBSAFER 서버의 MariaDB 버전이 업그레이드 된 경우(예: 10.2 > 10.6)
[증상]
- mysql_upgrade 명령어를 실행하여 OK 메시지를 확인하였으나, mysqlcheck 시 동일하게 Needs upgrade가 확인되는 경우
upgrade 실행 시 정상 수행
mysqlcheck 시 동일하게 Needs upgrade로 표시
[원인]
- mysql_upgrade를 통해 테이블 구조를 정상적으로 업그레이드 했더라도, 인덱스를 제대로 작성하지 못하는 경우가 존재하여 증상 발생
[조치방안]
1. 단일 조치
- 이관해야되는 DB 수량이 많지 않을 경우
#mysql 접속 후 use [DB명];
#db_error.log 파일 내 zerofilling moved table (테이블 최적화) 내용 확인
db_error.log
2. 일괄 조치
- 이관되는 DB 수량이 많은 경우
#mysqlcheck -uroot -p --optimize --all-databases
--optimize (최적화)
※ mysql_upgrade 후 DB 정상 여부에 대해서 검증 진행 시 optimize 와 auto_repair 파라미터를 함께 사용하시면 개별적으로 조치하지 않고 하나의 단계로 모두 처리가 가능합니다.
# mysqlcheck -u root -p --optimize --all-databases --auto-repair
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6488
6474,Azure AD를 통한 인사연동 및 인증 가능 여부 확인 요청,"[분류] (에러로그문의 / 기능로직문의 / 기타문의) 

기타문의

​

[고객사/채널사] 

GS리테일

​

[이슈내용] 

1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0 

​

​

2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항) 

​

​

3. 특이사항 (연동 모듈, 커스텀 개발 등) 

​

​

4. 사내 재현 정보 

​

​

5. 요청사항 

현재 고객사에서는 인사정보 원장 DB를 통한 인사 연동 및 온프레미스 AD를 통한 LDAP인증을 사용하고 있으나

신규 업그레이드 사업 시 Azure AD 연동 지원이 가능하다면 바꾸고 싶다고 문의하였습니다.

​

Azure AD를 통한 인사연동이 가능한지 문의 드립니다.

Azure에서는 Base DN, User DN을 확인할 수 없는 것으로 알고 있어 별도의 API 개발 이력이 있는지 (Oauth등) 확인 요청드립니다.","김태윤
네 신동진차장님이 얘기하신 것과 같이 일반적인 LDAP 형태로의 접근은 안되는 것으로 보이며, API를 통해서 가능할 것으로 보여집니다. 관련해서는 연구소에 문의할 수 있도록 하겠습니다.
다만 다른 업무가 많은 관계로 회신은 늦어 질 수 있을것 같습니다.

2024.06.25. 10:12
답글쓰기

프로필 사진
신동진
네 알겠습니다. 회신 감사합니다.

2024.06.26. 10:46
답글쓰기

프로필 사진
김태윤
금일 연구소 담당 개발자에게 다시 얘기하였으나, 아직 개발 일정 잡지 못했다고 합니다.

2024.07.16. 12:52
답글쓰기

프로필 사진
여성구
본 사항 개발이 필요한 사항이므로 요청을 bugs 로 다시 등록 부탁드립니다.

2024.07.25. 15:15
답글쓰기

프로필 사진
신동진
네 알겠습니다. 확인 감사합니다.",https://cafe.naver.com/pnpsecure2/6474
6466,[DBSAFER5][TIP] DBSAFER의 주석인식 기능(CI) 테스트 시 유의사항,"주석인식과 관련된 문의가 발생하여 테스트 중 잘못 동작하는 것으로 오해하실 수 있는 부분이 있어 참고용으로 기록합니다.

(관련 내용 : 

https://cafe.naver.com/pnpsecure2/3369

https://cafe.naver.com/pnpsecure2/6016

https://cafe.naver.com/pnpsecure2/6194

)

​

1. 주석인식정보가 포함된 쿼리를 실행하였음에도 보안계정이 파싱되지 않는 현상

  -> 접속계정이 이미 파싱된 상황에서 주석인식이 포함된 쿼리가 접속 3초 이후에 실행되면, 보안계정이 파싱되지 않습니다

(접속계정 정보가 없으면 시간과 무관하게 주석인식정보를 파싱합니다)

​

2. 빌드된 서비스의 버전 반드시 확인

빌드된 서비스 데몬 버전 확인 시 (WAS_UESR_INFO) 항목이 있어야 합니다. 해당 키워드가 없으면 주석인식 기능이 동작하지 않습니다.

TERADATA Release version 3.0.4 for RelTDEVBIN-CentOS7
MAIN VERSION 3.7 (120200101)(Rev: v2630M)
ADDED OPTION STATUS: (WAS_UESR_INFO)
3. 주석인식 쿼리가 기록된 패킷을 packet_tester로 테스트 시 문제 상황이 재현되지 않음

주석인식 정보에는 timestamp가 기록되어 있는데 이 시간이 현재 시간과 1분 이상 차이가 날 경우 주석인식 기능이 동작하지 않습니다.

따라서 동일 환경을 구성하여 직접 NAT 테스트를 하셔야 합니다.

​

관련하여 궁금한 점 있으신 경우 언제든지 연락 부탁드립니다

감사합니다",댓글 없음,https://cafe.naver.com/pnpsecure2/6466
6458,[DBSAFER5][TIP] SAFERUAS 알람 메일 한글 깨지는 증상 발생 시 확인 필요사항,"[개요]

최근 보안성 강화 패키지 업그레이드 작업 건이 많은데, 고객사에서 사용중인 WEB 모듈을 최신 버전으로 함께 업그레이드하는 경우가 많아 아래 증상이 발생하는 경우가 다소 발생할 것으로 예상되어 내용 공유드립니다.

​

많은 고객사가 LATIN1의 DBSAFER5 를 사용하는 경우가 많아, 해당 기준으로 내용 작성하였습니다.

​

[발생 환경]

- Latin1 캐릭터셋을 사용하는 DBSAFER5 버전

- 최신 버전 SAFERUAS PKG 설치 [SAFERUAS 2.0.76.1 Build-2261]

  > 몇가지 PKG 선정하여 확인하였을때, 최신 버전만 UTF-8 설정 값이 기본 값으로 적용된 것으로 확인됩니다.

- 알람 메일 수신받는 모든 기능 사용 시

​

[증상]

사용자가 OTP 인증번호 수신 혹은 잠금해제 및 비밀번호 초기화 등의 알람 메일 수신 시 아래와 같이 한글이 깨지는 증상 발생

​

[증상 이미지]


OTP 수신 알람 메일 설정 값


증상 재현 이미지


비밀번호 초기화 설정 값

​


증상 재현 이미지

​

[조치 방안]

- saferuas config 내 캐릭터셋 설정 값 변경 후 pnpweb 재시작

 > DB.ENCODING = 행의 인코딩 값을 DBSAFER 서버에 맞는 값으로 지정

 > LATIN1=MS949 / UTF-8=UTF-8


경로 및 파일


설정 값

​

​

감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6458
6453,[DBSAFER5][TIP] 권한제어 Select Only 정책 동작 방식 관련 내용 공유,"[이슈 사항]

가. 권한제어 정책 SQL 유형에서 select only 정책으로 체크시 테이블 조건이 있으면, insert나 delete 등 쿼리 실행시 서브쿼리의 select 조회테이블이 테이블/컬럼 조건에 부합시 해당 정책을 타는 이슈

​

 - 권한제어 정책

   > 공통테이블에 dual 테이블 포함


 - 로그 및 정책


 - qry_type : 4098(insert로 인식)


​

[원인 및 분석]

테이블 조건이 있는 명령어 유형 정책은 조건에 수반되는 테이블이 있는 가장 가까운 명령어 유형을 해당 정책의 유형으로 설정하는 기능으로 개발되어 있다보니 유사 사항이 발생함.

즉, create table test as select * from members 예제에서, members 테이블 조건이 걸려 있다면 명령어 유형을 select로 확인하여 처리하는 로직으로 동작함.

명령어 유형 정책 사용 시, 동일한 정책에 테이블을 조건으로 설정 유무에 따라서 동작이 다름.

 

* 테이블 조건이 없는 Select Only 명령어 유형 정책

테이블 조건이 없을 경우, 첫번째로 사용된 명령어 유형을 보고 정책을 판단함.

​

* 테이블 조건이 있는 Select Only 명령어 유형 정책

테이블 조건이 있을 경우, 우선 테이블명이 일치하는 위치를 찾고, 해당 테이블이 사용된 쿼리절의 명령어 유형을 보고 정책을 판단함.

따라서, create table test as select * from members 예제에서, members 테이블 조건이 걸려 있다면 명령어 유형을 select로 확인하여 처리하는 로직으로 동작함.

​

[조치 방법]

DML 유형 및 테이블 조건이 들어간 권한제어 차단 정책을 Select Only 정책 상위에 위치하도록 하여 해당 이슈를 방지할 수 있음.

​

* 혹시라도 부족한 내용이나 궁금하신 점은 편하게 답글로 주시면 감사하겠습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6453
6445,[신한은행] 마스킹 요구기능 충족 확인 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의) 

기타문의

​

[고객사/채널사] 

신한은행

​

[이슈내용] 

1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0 

2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항) 

3. 특이사항 (연동 모듈, 커스텀 개발 등) 

4. 사내 재현 정보 

​

===============================================================

​

5. 요청사항 

​

신한은행은 META 연동을 통해 개인정보 컬럼을 자동 등록하여 데이타마스킹을 적용하고 있습니다.

마스킹 컬럼 중 숫자 형식이 있어 '0'으로 마스킹 되어 업무에 혼선을 주고 있어 문자형과 동일하게 마스킹이 되도록 요청하고 있습니다.

오래전에 동일한 요구사항이 있어 개발이 진행된 적이 있는데 구현이 된 것인지 확인 부탁 드립니다.

구현이 되었다면 적용 방법을 공유해 주시고 반대라면 개발 요건이 드롭된 사유가 필요합니다.

​

​

​

[메일원문]

​

신한은행 이기수 입니다.

 

유선으로 말씀드린대로,

현재 마스킹처리(치환)기준이 숫자인 경우 ""0""으로 치환되어 표현됩니다.

 

이에따라 현업에서 실제 데이터를 구분할떄 마스킹되어 치환된 데이터인지. 실제 데이터가 0인지 구분이 어려워

해당 치환되는 문자를 *로 통일하자는 의견이 있습니다.

 

기존에 해당 안건이 접수는 되었으나 진행이 안되는 상황이라고 들었는데,

관련하여 적극적으로 검토해주셔서 개발하거나 대안을 마련해주시면 감사하겠습니다.","김태윤
해당 이슈의 경우 프로토콜 위배 사항으로 툴에서 오류가 발생되는 상황입니다.

예를 들어 select num from member 라고 할때, 요청하는 데이터에 대해서 숫자 타입으로 요청을 한 부분인데, 문자로 온다고 하면 오류가 발생하는 상황입니다.

따라서 해당 부분에 대해서는 수정할 수 없는 상황입니다.
(예전에도 이와 유사 건이 있어서 연구소에 확인을 했던 사항이며, 금일도 다시 한번 확인한 상황입니다.)

""DBeaver 툴 기반 NoSQL 지원"" 개발 부분에 대해서 지원 가능할지에 대해서는 확인 중입니다.

감사합니다.",https://cafe.naver.com/pnpsecure2/6445
6441,[한국투자증권] DBSAFER 서비스 로그에서 접속종료시각 기록 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의) 

기능로직문의

​

[고객사/채널사] 

한국투자증권

​

[이슈내용] 

1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0 

 : 사용자 PC의 네트워크 순단 등으로 서비스 세션에 대한 종료 시그널을 받지 못할 경우

   서비스로그에서 접속종료시각 기록 가능여부 확인 부탁드립니다.

​

2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항) 

​

​

3. 특이사항 (연동 모듈, 커스텀 개발 등) 

​

​

4. 사내 재현 정보 

​

​

5. 요청사항 

​

[모듈 로그(Debugging 로그 및 ERROR 로그] 

(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함) 

​

​

[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등) 

​

​

​

[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","김태윤
접속세션 중 비정상적인 세션이 생성되는 경우에는 해당 세션에 대해서 마지막으로 수행한 명령어를 기준으로 12시간 이상 명령어 수행 이력이 없는 경우 세션에 대해서 종료 처리를 진행합니다.

체크 주기가 추가 세션이 발생했을때 체크를 합니다.",https://cafe.naver.com/pnpsecure2/6441
6436,[카카오뱅크] DBSAFER 서버 open_ssl 설정 미사용 시 서버 운영에 대한 영향도 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의) 

기타문의

​

[고객사/채널사] 

카카오뱅크

​

[이슈내용] 

1. 요청사항 

- DBSAFER 서버에서 open ssl 미사용 시 서버 운영에 대한 영향도 문의

> 현재 고객사에서 감사로그 연동중에 있습니다. 외부에서 DBSAFER DB 접근 시 암호화 알고리즘이 맞지 않아 감사로그를 가져갈 수 없다고 합니다. 고객사 담당자가 해당 옵션을 변경하고 싶어하는 상황입니다. 고객사 요청대로 변경 시 DBSAFER 서버 운영에 영향도가 있는지 확인 요청 드립니다.

​

(현재 DBSAFER 서버 설정)                   (고객사 다른 서버 설정)

variable_name | Value                         variable_name | Value

have_openssl  | YES                            have_openssl  | NO

have_ssl         | YES                           have_ssl         | DISABLED

​

[첨부파일]


​

[분류] (에러로그문의 / 기능로직문의 / 기타문의) 

​

​

[고객사/채널사] 

​

​

[이슈내용] 

1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0 

​

​

2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항) 

​

​

3. 특이사항 (연동 모듈, 커스텀 개발 등) 

​

​

4. 사내 재현 정보 

​

​

5. 요청사항 

​

[모듈 로그(Debugging 로그 및 ERROR 로그] 

(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함) 

​

​

[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등) 

​

​

​

[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)

[분류] (에러로그문의 / 기능로직문의 / 기타문의) 

​

​

[고객사/채널사] 

​

​

[이슈내용] 

1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0 

​

​

2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항) 

​

​

3. 특이사항 (연동 모듈, 커스텀 개발 등) 

​

​

4. 사내 재현 정보 

​

​

5. 요청사항 

​

[모듈 로그(Debugging 로그 및 ERROR 로그] 

(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함) 

​

​

[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등) 

​

​

​

[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","김태윤
연동을 위해서 DBSAFER가 취약해 지는 부분입니다.
또한 다른 제품에서도 연동을 했을때 문제가 되지 않았는데, 해당 제품만 안되는 건 이해가 가지 않습니다.

따라서 openssl 설정 disable에 대해서는 진행하지 않는 것이 좋을것 같습니다.
감사합니다.",https://cafe.naver.com/pnpsecure2/6436
6432,"[HMMI 생산망] DBSAFER 5.0 패키지 NQVM, RADMIN, VNC 적용 사례","안녕하세요.

프로젝트 1팀 김세린입니다.

DBSAFER 5.0 패키지 NQVM, RADMIN, VNC 적용 방법 공유드립니다.

​

[고객사 환경]

PKG

전

PKG_DBSAFER5_RelTBINUC-CentOS7_x86_64_20210826.tar.gz

후

PKG_DBSAFER5_RelR23.05U_CentOS7_x86_64_P11.11_D2F_ssl102_MariaDB

_20240327.tar.gz

pnp_oms_dms

전

Ver.1 / Rev. 1097    →   PKG Minor 업그레이드 후 Ver2. / Rev.1098

후

Ver.2​ / Rev.1094

PC Assist

V3.3.1.8

Enterprise Manager

Build-7280

​

[요약]

- DBSAFER 5.0 PKG 에서 PC Assist 자동 접속 기능 적용

- DBSAFER 5.0 PKG 에서 NQVM, RADMIN, VNC 적용

- Terminal 서비스 구분 (RDP, SSH, NQVM, RADMIN, VNC)

​

[상세]

1. DBSAFER 5.0 PKG Minor 업그레이드 

- 패치 전:  P9 (20150812)

- 패치 후:  P11 (20200101)

​

2. pnp_oms_dms 패치

- 패치 전:  Ver2. / Rev.1098

- 패치 후:  Ver.2 / Rev.1094


패치 전 자동 접속 불가


접속 시도 시 로그

​

3. Config 파일 설정

- pnp_oms_dms 설정 

   > NAT_MENU_TYPE=4

   > RDP_LOGGING_USE=1

- pnp_telnet 옵션 추가

   > [RDP_LOG_MASK_LIMIT] 3


 

​

4. PC Assist 빌드 

- 3.3.1.8 버전으로 빌드

- Release Wizard 실행 시 ""AM App"" 폴더 및 하위 내역 체크 필수

    > Default AM App

    > Support App

​

​

5. 매니저 설정

- 서비스 설정 > TERMINAL 설정 > TERMINAL 하위 구분 > 추가 TERMINAL 타입 설정 

    RADMIN  <ip>:<port>   혹은  /connect:<ip>:<port>

    NQVM      IP=<ip> AVPORT=8887 FMPORT=8889 PORT=<port>

    VCN          <ip>:<port>

-  추가 기능 설정 > PC Assist 추가 기능 설정 > RDP 로깅 클릭

- 로그 조회 설정 > RDP 세션 재현 사용 > RDP Port에 서비스 포트 입력 (ex. 8888 4899 --> 미입력시 세션재현 불가)


TERMINAL 설정


RDP 설정

​

6. Terminal 서비스 구분

- TERMINAL 서비스 내 TELNET, SSH, RDP, NQVM, VCN, RADMIN 으로 구분 가능

- NQVM의 경우 AVPORT와 FMPORT 수정 가능



NQVM 추가 정보

​

7. PC Assist NAT List

- RADMIN: Radmin.exe

- VCN: vcnviewer.exe

- NQVM: NQViewer.exe


자동 접속 시도 시 발생하는 창

​

​

↓ 필요하신 분은 참고 부탁드립니다. (패키지, 모듈, 매니저 다운로드 링크 포함)

[HMMI]_DBSafer 5.0 NQVM, Radmin, VNC 적용.pptx
1 DBSAFER 5.0 NQVM, RADMIN, VNC 적용

docs.google.com

​

이상입니다.

감사합니다. ",댓글 없음,https://cafe.naver.com/pnpsecure2/6432
6426,"[대한항공] AWS PostgreSQL 15 버전 이하 SSL 암호화 계정별 설정 접속 시, 로깅 및 지원 방법 문의","[분류] (에러로그문의 / 기능로직문의 / 기타문의) 

- 기능로직문의

​

[고객사/채널사] 

- 대한항공

​

[이슈내용] 

1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0 

- SSL Proxy 적용 후, AWS PostgreSQL 15 이하 버전에서 SSL 암호화 없이 접속하던 계정 접속 불가

​

​

2. 예상되는 원인 및 확인한 내용

- AWS PostgreSQL 15 버전 이하는 계정별로 SSL 암호화 접속 설정이 가능하여 특정 계정은 SSL 암호화 없이 사용하다가, SSL Proxy 적용 후에 접속 불가 현상 발생.

- 현재 SSL Proxy는 개별 DBMS 서비스 별로 사용 여부 체크, 접속계정 별로 SSL 사용 여부를 체크하지 못하여 발생한 문제로 판단.

​

​

3. 요청사항 

- 계정별 SSL 암호화 설정되어 있을 경우 해당 DBMS 서비스 로깅 및 통제를 위한 방법 요청

​

​

[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등) 

- pnp_postgresql

POSTGRESQL Release version 3.0.3 for RelR23.05-CentOS6

MAIN VERSION 3.7 (20150812)(Rev: v2567)

​

- pnp_ssl_proxy

SSL_PROXY Release (Rev 197) Apr 24 2024 11:31:38s

   ( SHARED INTERFACE VERSION INFO: Rev.624 )

   ( COMMON-API(UTIL) INFO: Rev.200 )

   ( LIBSSL VERSION INFO: OpenSSL 1.0.2u  20 Dec 2019 )

​","최재규
사내 재현하고자 하는데 접속계정별 SSL 사용 여부 체크에 대한 설정이 없어서 환경 구성에 제한이 되고 있습니다.
추가적으로 확인은 하고 있습니다만 사이트를 통해 가이드 가능할지 확인 부탁드립니다.

2024.05.20. 11:29
답글쓰기

프로필 사진
김순재
넵 사이트에 계정별 SSL 사용 관련 가이드 요청해보겠습니다.",https://cafe.naver.com/pnpsecure2/6426
6423,Rocky Linux 9버전의 DBSAFER 지원 여부 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의) 

기타 문의

​

[고객사/채널사] 

현대차 유럽데이터센터 (체코생산망)

​

[이슈내용] 

1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0 

​

​

2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항) 

​

​

3. 특이사항 (연동 모듈, 커스텀 개발 등) 

​

​

4. 사내 재현 정보 

​

​

5. 요청사항 

현대차 유럽 법인 체코생산망의 VM환경 rocky linux 골든 이미지 형상이 9버전 이상으로만 구성되어 

있다고 해 DBSAFER 설치를 해당 OS 버전에 설치가 가능할지 문의 드립니다.

​

[모듈 로그(Debugging 로그 및 ERROR 로그] 

(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함) 

​

​

[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등) 

​

​

​

[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)

프로필 사진신동진님의 게시글 더보기 ","김태윤
현재 KERIS 에서 RockyLinux 9.2에 대한 요청이 있어 PKG는 준비하고 있으나, 그 외 DBSAFER IM/WORKS/SAFEUAS 등에 대해서는 준비가 필요한 상황입니다.

RockyLinux 8 로 진행해 주셨으면 하고, 9에 대해서는 시간이 더 필요할 것으로 판단됩니다.

단순하게 DBSAFER DB에 대해서만 진행하는 상황이라면, KERIS 상황을 보면서 하는 것이 좋을 것 같습니다.

감사합니다.

2024.05.14. 15:26
답글쓰기

프로필 사진
신동진
네 알겠습니다. 빠른 확인 감사합니다.",https://cafe.naver.com/pnpsecure2/6423
6419,"[메쥬] NCP DBSAFER 서버에 RPM (Object Storage, AWS CLI, NAS) 설치 가능 여부 문의","[분류] (에러로그문의 / 기능로직문의 / 기타문의) 

기타문의

​

[고객사/채널사] 

메쥬 / 지엘정보통신

​

[문의내용] 

NCP DBSAFER 서버에 아래 리스트 중 설치 가능한 rpm 문의 드립니다.

​

1. [object storage]

(s3fs)

automake

fuse

fuse-devel

gcc-c++

git

libcurl-devel

libxml2-devel

make

openssl-devel

​

(goofys)

fuse

fuse-devel

​

2. [AWS CLI]

awscli

​

3. [NAS]

nfs-utils","김태윤
DBSAFER 서버가 Naver Cloud에 설치되어 있는 건가요?
object storage, AWS CLI, NAS 등을 설치해야 하는 이유가 있을까요?

위 rpm을 설치함으로써 취약점이 높아 질수 있습니다. 정확한 사유가 필요해 보입니다.

2024.05.14. 09:35
답글쓰기

프로필 사진
민시원
안녕하세요 김태윤 실장님!
백업 데이터 관리를 위해 설치한다고 하는데 취약점 경고 드리면서 정확한 이유 다시 문의해 보도록 하겠습니다.
감사합니다.

2024.05.14. 09:44
답글쓰기

프로필 사진
민시원
민시원설치 사유 확인 결과, 고객사에서 비용 문제로 별도의 솔루션 도입보다는 직접 관리하기 위해 설치하기를 원해서 문의한다고 합니다.

2024.05.17. 09:21
답글쓰기

프로필 사진
김태윤
rpm에 대해서 설치하는 것은 문제가 되지 않습니다.
goofys를 이용해 AWS S3 mount 해서 사용할 수 있는 것으로 판단됩니다.
다만 DBSAFER로의 접근하여 작업을 하는 부분 자체가 리스크로 보이며, 문제가 발생 시 지원해야 할 사항으로 보여집니다.",https://cafe.naver.com/pnpsecure2/6419
6418,MSSQL 인사 DB를 accountsync 연동할 시 TLS 1.0 사용으로 인한 연동 불가 현상,"1. 현상

- accountsync를 통해 MSSQL DB 인사연동 test 시 The server selected protocol version TLS10 is not accepted by client preferences [TLS13, TLS12] 메시지 발생

사용 모듈 버전 : dbsafer_accountsync_v1.149.7_sinc(신세계 전용 모듈)


​

2. 원인 

- openjdk 11.0.11 이상 사용 시 TLS1.0 및 TLS1.1 가용성을 기본적으로 비활성화하여 발생

  >> COMMON_UTIL_V2.36_build-1_20231213 기준 openjdk 11.0.20.1


​

3. 조치방법

- openjdk 11.0.11 이상 사용환경 DBSAFER에서 accountsync를 통해 인사 DB 연동 간 TLS 1.0, 1.1가 사용될 시  TLS 1.0, 1.1 비활성화 옵션 제거 과정 필요

​

- /usr/java/jdk-11.0.20.1+1/conf/security/java.security 파일을 아래와 같이 편집 후 pnpweb 재시작

​


변경 전

jdk.tls.disabledAlgorithms=SSLv3, TLSv1, TLSv1.1, RC4, DES, MD5withRSA, \ DH keySize < 1024, EC keySize < 224, 3DES_EDE_CBC, anon, NULL, \ include jdk.disabled.namedCurves

변경 후(TLSv1, TLSv1.1 제거)

jdk.tls.disabledAlgorithms=SSLv3, RC4, DES, MD5withRSA, \ DH keySize < 1024, EC keySize < 224, 3DES_EDE_CBC, anon, NULL, \ include jdk.disabled.namedCurves

해당 조치 이후 인사DB를 통한 인사 연동 정상 

​",댓글 없음,https://cafe.naver.com/pnpsecure2/6418
6415,[CJ 올리브네트웍스] AWS Mysql 명령어 미로깅 현상 확인 요청 드립니다.,"[분류] (에러로그문의 / 기능로직문의 / 기타문의) 

- 기타문의

​

[고객사/채널사] 

- CJ 올리브네트웍스

​

[이슈내용] 

1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크)

1) AWS Mysql 사용 간 로깅이 되지 않는 현상 발생

2) SSL 옵션이 DB 쪽에서 활성화 되어 있는지 확인 요청

 - 담당자 확인 결과, SSL 옵션 활성화 되어 있다고 하심

3) pnp_ssl_proxy 모듈 적용 (05/07 작업)

4) 세션 로그는 남으나, 명령어 로그는 남지 않음

5) 패킷 확인 결과, 평문으로 데이터가 들어오는 것 확인

 - pnp_ssl_proxy 적용/미적용 관계없이 명령어 로그가 남지 않음

6) Dbeaver Tool 에서 SSL 관련 옵션 전부 비활성화 후에도 로깅이 되지 않음

​

2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항) 

- 특이사항 없음

​

3. 특이사항 (연동 모듈, 커스텀 개발 등) 

- 특이사항 없음

​

4. 사내 재현 정보 

​

​

5. 요청사항 

- 명령어 로깅이 되지 않는 현상에 대해서 확인 해주시면 감사하겠습니다.

​

Previous imageNext image
pnp_ssl_proxy 프로세스 기동 / pnp_ssl_proxy.conf 설정 사진

Previous imageNext image
명령어 미로깅 사진

​

[모듈 로그(Debugging 로그 및 ERROR 로그] 

(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함) 

​

​

[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등) 

- Dbeaver 24.0.3

- pnp_mysql : rev2567

- pnp_ssl_proxy : rev180

- 대상서버 Mysql DB 버전 : 8.0.32

​

[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)

- GW_to_DB.pcap // DBSAFER <> DB 구간

- PC_to_DBSAFER.pcap // PC <> DBSAFER 구간

- 사용자PC_to_DBSAFER.pcapng // 사용자 PC Wireshark

​

- 사용자 PC IP : 10.184.5.125

- DBSAFER IP : 10.65.98.94 4023

- 대상서버 IP : 10.75.189.205 3306","김태윤
23.05 release PKG의 pnp_mysql로 보입니다.
내부에서 CentOS6에 해당 PKG 설치 후 패킷을 통해서 확인 결과 정상적으로 로깅 되는 것을 확인하였습니다.



첨부사진
2024.05.08. 15:19
답글쓰기

프로필 사진
김태윤
해당 건에 대해서는 원격으로 볼수 있으면 봤으며 좋겠습니다.

2024.05.08. 15:32
답글쓰기

프로필 사진
이창제
안녕하세요. 김태윤 실장님.
기술지원2팀 이창제 대리 입니다.

빠른 확인 해주셔서 감사합니다.

해당 건 원격 일정 조율하여 말씀드리겠습니다.
현재, 특이사항으로 05/07 야간 작업 간 수행했던 명령어가 05/08에 다시 확인 시 명령어가 로깅 됐다고 합니다.

추가로, 05/08 다시 한 번 로깅 테스트 하였으나, 세션, 명령어 로그가 남지 않았습니다.
말씀 주신대로 해당 상황에 버퍼 파일이 생겼는지 확인해봤으나 서버에서 버퍼 파일이 생기진 않았던 것으로 확인됩니다.

추가 내용 있을 시 공유 드리겠습니다.

감사합니다.

2024.05.09. 09:38
답글쓰기

프로필 사진
이창제
안녕하세요.

해당 건 05/14(화) 오전 10:00 으로 원격 진행하려고 하는데 시간 확인 부탁드립니다!

감사합니다 !

2024.05.10. 16:44
답글쓰기

프로필 사진
박상원
SSL/TLS 암호화 통신하고 있는 것으로 보이고,
pnp_ssl_proxy.conf 설정이 잘못되어 있는 상황 같습니다.

SERVER_PUBLIC_KEY = /dbsafer/key/pnpsecure.cloud.crt
SERVER_PRIVATE_KEY = /dbsafer/key/pnpsecure.cloud.key

현재 DBSAFER 서버에 이렇게 설정되어 있는 것 같은데 아래와 같이 설정해보는게 좋을 것 같습니다.

SERVER_PUBLIC_KEY = (서비스 객체번호 or MYSQL 등 서비스타입 설정) /dbsafer/key/pnpsecure.cloud.crt
SERVER_PRIVATE_KEY =(서비스 객체번호 or MYSQL 등 서비스타입 설정) /dbsafer/key/pnpsecure.cloud.key

2024.05.13. 10:42
답글쓰기

프로필 사진
이창제
도움 주셔서 감사합니다 !!

2024.05.14. 10:19
답글쓰기

프로필 사진
이창제
해당 건 05/14 원격 진행 완료하였습니다.

원격 간 대상 DB 접속 시 별다른 처리 없이 정상적으로 로깅 되는 것 확인하였습니다...
빠른 지원 감사드립니다.",https://cafe.naver.com/pnpsecure2/6415
6409,[중앙선거관리위원회] 감사로그 명령어의 시각 부분에서 ms 단위 처리 로직 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의) 

감사로그 명령어 시각 부분에서 초(s)단위 까지 나오는데 밀리초(ms) 단위 처리 로직 문의

​

[고객사/채널사] 

중앙선거관리위원회

​

[이슈내용] 

1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0 

-

2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항) 

-

3. 특이사항 (연동 모듈, 커스텀 개발 등) 

-

4. 사내 재현 정보 

-

5. 요청사항 

감사로그 명령어 요청시각, 응답시각, 완료시각 등 시각 표시에서 초(s)단위 까지만 표기가 되고 있습니다.

해당 초 단위 표기 시 밀리초(ms)단위를 어떻게 처리하여 표기하는지 로직 확인 요청드립니다.

예) 15:44:27.40    ---> 15:44:27

예) 15:44:27.51    ---> 15:44:28

​","전지웅
위 문의 내용과 별개로 시각 관련 내용 참고용으로 작성해두겠습니다.

- 요청 시각 : 쿼리의 시작시간
- 응답 시각 : 요청 후에 첫 번째가 오는 시간
- 완료 시각 : 모든 응답이 도작하는 시각
- 응답 시간 : 요청 후 첫 번째 응답까지 걸린 시간
- 소요 시간 : 완료 시각 - 요청 시각

2024.05.07. 11:36
답글쓰기

프로필 사진
김태윤
안녕하세요. 해당 부분에 대해서는 현재 로그가 초 단위로 감사로그를 저장하고 있습니다.
모듈에서 DB롷 저장할 때 초 단위로 저장하고 있으며, ms 단위로 보여주기 위해서는 모듈에 해당 로직 변경이 필요해 보입니다.

감사합니다.",https://cafe.naver.com/pnpsecure2/6409
6404,[국방 DIDC 1센터] VPN을 사용하는 사용자들에 대하여 샤크라 윈백 시 DBSAFER로 NAT 되지 않는 현상에 대하여 확인 사항 및 조치 방법,"국방 DIDC 1센터 샤크라 윈백 시 DBSAFER로 NAT 되지 않는 현상

- 배경

1. 샤크라 윈백 사업이며 DBSAFER로 NAT 되지 않는 현상

​

- 확인된 사항

1. 사용자들이 VPN을 사용하여 DB 접근제어(DBSAFER, 샤크라)를 사용하고 있는 환경

2. VPN을 사용하는 사용자가 샤크라 Agent를 로그인 중에 VDI나 VPN이 비정상적으로 종료 시 발생하는 현상

3. 기존 샤크라를 사용하고 있는 사용자들이 샤크라 Agent가 비정상적으로 종료된 상황에서 DBSAFER Agent를 접속하여 대상서버로 접속 시 접속이 안되는 현상

​

- 조치

1. 샤크라 Agent를 접속 후 정상 종료시킨 후 DBSAFER Agent 접속

-> VDI 재부팅 VPN 재설정 등 으로 해결 불가능

[샤크라 Agent 동작 방식]

- 기본적으로 두가지의 방식의 Agent가 존재하는 것으로 확인

1. OS 커널에 샤크라 서버로 패킷이 유입되게끔 적용하는 Agent

- OS 커널쪽을 수정하여 샤크라 서버로 라우팅을 수정하는 것으로 보여짐

- OS 커널쪽에서 샤크라에 등록된 대상 서버의 정보를 샤크라쪽으로 틀어서 가져가게끔 설정이 되어 있음

           -> 국방 DIDC에서 사용하는 방식

​

2. Nat Driver와 같이 Agent 단에서 샤크라 서버로 패킷이 유입되게끔 적용하는 Agent

- 샤크라 Agent를 통해서 NAT Drvier와 같은 방식으로 샤크라로 패킷이 들어가게끔 설정

​

[사용자 환경]

- 다음과 같은 순서로 접속

1. VPN 접속하여 내부망까지 연결

2. 그 이후 DBSAFER or 샤크라 Agent 로그인

3. 대상 서버에 접속 요청

​

[확인한 방법]

1. VPN 접속하여 샤크라 Agent 로그인 후 비정상적으로 VDI 혹은 VPN 종료

2. 다시 VPN 접속하여 DBSAFER Agent 로그인 후 대상 서버 접속 시도

3. DBSAFER 서버에서 패킷 수집 시 패킷이 들어오지 않는 것을 확인

-> 기존에 샤크라에 등록된 대상 서버 IP를 DBSAFER에 등록해서 DBSAFER 사용시 접속 불가

-> 기존에 샤크라에 등록되지 않은 대상 서버 IP를 DBSAFER에만 추가해서 DBSAFER 사용시 접속 가능

​

[샤크라 사용하던 사용자가 DBSAFER로 NAT가 안되는 현상]

- 원인

1. VPN을 통해 접속하던 사용자의 VDI 혹은 VPN이 강제로 종료될 때 샤크라 서버에서 FIN 패킷을 받지 못하여 샤크라 Agent가 종료된 것을 인지하지 못함 -> (해당 현상에 대해서는 DBSAFER도 동일)

​

2-1. OS 커널을 수정하는 샤크라 Agent의 경우 비정상적으로 샤크라 Agent가 종료되어 OS 커널에서 대상 서버의 정보를 샤크라 쪽으로 넘기는 값들이 삭제되지 않고 OS 커널에서 가지고 있어 DBSAFER 쪽으로 패킷이 들어오지 않고 샤크라쪽으로 패킷이 넘어감

       -> 비정상적으로 종료되어 OS 커널에 설정된 값들을 삭제하지 못한 상태로 유지

​

2-2. Nat Drvier와 같은 방식을 사용하는 샤크라 Agent의 경우 샤크라 Agent가 종료됨에 따라 정상적으로 접속이 가능할 것으로 보여짐 (국방 DIDC의 경우 2-1의 Agent를 사용하고 있어 2-2에 대한 확인은 못하였지만 가능할 것으로 추정 -> 국방 DIDC 다른 채널사 엔지니어의 말을 인용하여 추정)

       -> NAT Driver와 같은 형식이며, 샤크라 Agent가 비정상적으로 종료되어도 DBSAFER Agent와 연관이 없음

​

[조치 방법]

- 샤크라 Agent를 다시 접속하여 정상적으로 종료시킨 후 DBSAFER Agent 로그인 후 대상 서버 접속 시 정상 동작 확인

      -> 기존에 비정상적으로 종료되어 남아있는 값들을 정상 접속 후 종료 시 초기화하는 것으로 추정

​

--------------------------------사이트 특성상 증적 자료 전달은 어려운점 양해 부탁드립니다------------------------------------

​

감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6404
6391,[TIP]일반 관리자에 정책 최고 관리 권한 부여 기능 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
▶ 5.0 매니저
일반 관리자에 정책 최고 관리 권한 부여 기능 옵션 활성화 → 일반 관리자에 정책 최고 관리 권한 부여
→ 관리자 서비스 권한 설정 → 객체에 대한 관리 권한 부여 → 객체 조회 가능
즉, 서비스 객체가 추가 될때마다 일반 관리자에게 해당 서비스에 대한 권한 부여 필요
▶ 7.0 매니저
일반 관리자에 정책 최고 관리 권한 부여 기능 옵션 활성화 → 일반 관리자에 정책 최고 관리 권한 부여
→ 객체 조회 가능
일일이 서비스에 대한 권한 부여 불필요
위와 같이 5.0과 7.0 매니저 각각 ""정책 최고 관리 권한 부여"" 옵션의 기능이 상이한 것으로 보입니다.
5. 요청사항
일반 관리자에 정책 최고 관리 권한 부여 기능 옵션의 정확한 기능이 어떻게 되는지 문의드립니다.","조재근: 해당 기능은 열람 권한을 가진 일반 관리자 계정일지라도 정책에 대한 내용 수정 또는 우선순위를 변경을 위해 사용됩니다.

사이트 커스텀으로 개발되었습니다.

7.0과 달리 5.0 매니저에서 서비스 객체 추가에 따라 일일이 권한을 부여해야 하는 내용은 7.0의 기능이 merge되지 않은 상태라 추후 merge할 예정이라고 합니다.

감사합니다.",https://cafe.naver.com/pnpsecure2/6391
6390,[신세계] DBSAFEROS 설치 대상서버 비정상 재기동 시 pfcflt.sys load 실패(F) 상태 표시 관련 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기능로직문의
[고객사/채널사]
신세계
[이슈내용]
1. 문의사항
- DBSAFEROS가 설치된 Windows Server 대상서버를 종료하는 방법에 따라(ex. 다시 시작 버튼, 전원강제종료 등) 서버 재기동 후 DBSAFEROS 상태를 'pfcflt.sys load 실패(F)'로 표시하며 DBSAFEROS가 가동되지 않는 사례가 있는 것으로 알고 있습니다. 서버가 재기동 되었을 때 'pfcflt.sys load 실패(F)' 상태가 발생되도록 하는 체크 조건에 대해 확인 요청 드립니다.
ex) Windows 특정 폴더에 dmp 파일이 존재한 상태로 서버가 가동되었을 경우, Windows 이벤트 로그에 XXXX 코드가 기록된 상태로 서버가 기동되었을 경우
고객사에서 확인요청한 사항으로 04월 25일(목)까지 답변주시면 감사하겠습니다.","정현교: 비정상 종료로 인해 덤프 파일 생성 기록이 있는 경우, pfcflt.sys 드라이버가 로드 되지 않습니다.
덤프 파일 생성 후 30분까지 적용되며, 그 이후 부터는 부팅 또는 SA 재시작 시에 드라이버가 자동으로 로드 됩니다.
Server Agent가 처음 실행될 때만 덤프파일을 확인하여, 재기동 시에는 해당 사항이 없습니다.

* 커널 모듈 문제로 인해 다운된 서버가 리부팅 후 다시 다운되는 현상을 방지하기 위해 추가된 기능입니다.",https://cafe.naver.com/pnpsecure2/6390
6386,[카카오뱅크] NoSQL 지원 범위 및 로드맵 관련 문의 드립니다.,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
- 기타문의
[고객사/채널사]
- 카카오뱅크
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
3. 특이사항 (연동 모듈, 커스텀 개발 등)
4. 사내 재현 정보
5. 요청사항
고객사 카카오뱅크에서 NoSQL DB 중 impala 지원 여부에 대해서 확인 요청이 들어와 문의 드립니다.
현재 제품별 지원 기능 리스트에는 impala 의 경우 2.10.0-cdh5.13.0 까지 지원 가능한 것으로 확인됩니다.
version 4.0.0.7.1.9.0-387 버전의 경우 지원 여부 혹은 로드맵 확인해 주시면 감사하겠습니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","여성구: FAQ 가이드를 확인해 주세요. 기능 지원 범위는 팀장을 통하여 문의 요청입니다. | 김하림: 안녕하세요 기반검증팀 김하림입니다.

Impala 4.1.0 버전으로 검증 완료했으며 지원 가능합니다.

지원 기능 리스트에 버전 정보 및 기능 업데이트했으니 확인 부탁드리겠습니다!
https://docs.google.com/spreadsheets/d/1Kirv0y9t06z59EvXiKUE6Pa6U1REpWfGTeiZCnhYMm4/edit#gid=0 | 김하림: 안녕하세요 이창제 대리님,
Impala 서비스 관련하여 현재 기능 추가 요청한 내용이 있어 전달드립니다.
https://bugs.pnpsecure.com/view.php?id=27749

- DB 툴에서 로그아웃 패킷을 보내지 않을 때, 서버에서 timeout 기능 등으로 세션 로그아웃 처리를 할 수 있도록 기능 추가 요청

> Impala 서비스 접속 시, DBeaver / SQL Workbench / SQuirrel SQL 등의 툴 확인 결과 세션 로그아웃 신호를 간헐적으로 전송하고 있음
> 실제로 DB 서버와 세션이 맺어져 있으며, PC Assist 미사용 시에도 동일하기에 툴 제약사항으로 보입니다.
> 사용자 입장에서 세션을 끊었지만, DBSAFER Manager 세션 모니터링에서는 세션이 맺어져 있는 것으로 보이기에 DBSAFER에서 timeout 기능추가 등의 대응이 필요함

참고 부탁드립니다. 감사합니다. | 김하림: 안녕하세요 이창제 대리님, 메신저로 연락드렸지만 다른 엔지니어 분들도 확인할 수 있도록 카페 댓글 추가로 남깁니다.

Impala JDBC 드라이버 단에서, 쿼리를 임의로 변환하는 코드가 탑재되어 있어 사용자가 요청한 SQL문과 실제 수행되는 SQL문이 다른 경우들이 발견되었습니다. (ex. Impala DB 대상 테이블의 컬럼이 VARCHAR, CHAR 인 경우 INSERT 수행 시 CAST 함수를 통해 코드 변환되는 현상)

위 현상이 있어 현재 지원 불가로 판단되며, 번복드려 죄송합니다. 더 꼼꼼하게 확인 후 연락드리겠습니다.",https://cafe.naver.com/pnpsecure2/6386
6374,[TIP] 한글 이름의 중간 글자를 마스킹할 수 있는 정규식 공유,"안녕하세요. 클라우드기술팀 김영은입니다.
한글 이름의 중간 글자를 마스킹할 수 있는 정규식 공유드립니다.
""DBSAFER 데이터 마스킹 방법"" 문서를 참고하여 작성되었으며 지원 함수에 대한 자세한 내용은 아래 문서 참고 바랍니다.
https://drive.google.com/file/d/1_EZ5dx_Tluk0r4An3tj64ZN_619G4PHG/view?usp=drive_link
[고객사 요구사항]
- 한글 이름의 중간 글자만 마스킹 처리
- 한글 깨짐 현상 없이 마스킹
. DB 암호화가 적용된 고객사로, 컬럼명/위치지정 마스킹 적용하는 경우 풀 마스킹 처리되는 환경(정규식 방식의 마스킹만 적용 가능)
- 한글 이름 마스킹 예시
. 성명 두글자: 김영 -> 김*
. 성명 세글자: 김영은 -> 김*은
. 성명 네글자: 김영영은 -> 김**은
[정규식 마스킹 객체]
^[^0-9][^A-Za-z]{1,12}$::<mloc><,6,4,2>::<mloc><,9,4,2>::<mloc><,12,4,4>::<utf8>
정규식
설명
마스킹 대상
^[^0-9][^A-Za-z]{1,12}$
숫자와 영어가 아닌 1~12byte의 글자(한글)
1~4글자의 한글
(한글은 1글자가 3byte로 사용됨)
""::"" 기호
[데이터1]::[정규식1]일 때, 데이터1의 문자열을 정규식1의 규칙으로 마스킹한다는 의미, 중첩해서 사용 가능
<mloc> 함수
문자열 길이에 따른 마스킹 범위 지정 함수
<비교식, 길이, 시작위치, 마스킹길이>
<mloc><,6,4,2>
6byte(2글자 한글)일 때, 4byte(2번째 글자)부터 2byte만큼 마스킹 처리
2글자 한글 데이터인 경우,
두번째 글자 마스킹 처리
<mloc><,9,4,2>
9byte(3글자 한글)일 때, 4byte(2번째 글자)부터 2byte만큼 마스킹 처리
3글자 한글 데이터인 경우,
두번째 글자 마스킹 처리
<mloc><,12,4,4>
12byte(4글자 한글)일 때, 4byte(2번째 글자)부터 4byte만큼 마스킹 처리
4글자 한글 데이터인 경우,
두번째~세번째 글자 마스킹 처리
<utf8>
한글 깨짐 없이 처리하기 위해 추가하는 힌트
(https://bugs.pnpsecure.com/view.php?id=16991의 코멘트 참고)
[마스킹 적용 결과 화면]
마스킹 적용 전
마스킹 적용 후
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6374
6370,[현대제철] MongoDB 지원 버전 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타 문의
[고객사/채널사]
현대제철
[이슈내용]
1. 요청사항
현대제철에서 현재 MongoDB 7.0.6 버전 사용을 원하여 문의드립니다.
현재 제품별 지원 기능 리스트에는 MongoDB의 경우 5.0까지 지원 가능한 것으로 확인됩니다.
7.0.6 버전의 경우 지원 여부 혹은 개발 일정 문의드립니다.","유현진: 요청하신 MongoDB 7.0.8 기능테스트 결과 전달드립니다.
MongoDB 7.0.6의 경우 하위호환 가능할 것으로 내부논의하였습니다.
기능테스트는 DB접속툴인 Studio 3T (2024.2.0 version), NoSQLBooster (8.1.8 version), NoSQLManager(7.3.1 version) 어플리케이션에 대해서 테스트를 진행했습니다.

접속제어/명령어제어/결과값제어/마스킹 등을 포함해서 특이사항 없이 사용 가능한 것을 확인하였으며
제품별 지원 기능 리스트 업데이트 완료하였습니다.

테스트케이스의 경우 아래 링크에서 확인가능합니다. (Studio3T, NoSQLBooster, NoSQLManager 테스트 케이스 모두 동일합니다.)
https://docs.google.com/spreadsheets/d/1n5StN4jEXT2-p2dg0wKrbSkoFUyudaJpSwof28Lv1HM/edit?usp=sharing
감사합니다.",https://cafe.naver.com/pnpsecure2/6370
6365,[H패션몰] AWS Bastion Host 서버 자체를 SSH 서비스 객체로 등록 시 동작 관련 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
H패션몰
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
- 아래 구성과 같이 AWS Bastion host(1.1.1.1:22) 를 통해 EC2 A서버(2.2.2.2:22) 를 접속하는 환경
- DBSAFER 서비스 객체에는 1.1.1.1:22 가 서비스 객체로 등록, 2.2.2.2:22는 라이선스 구매하지 않은 서버로 서비스 객체 미등록
- DBSAFER Agent 로그인 후 bastion host(1.1.1.1:22)를 통한 2.2.2.2:22 서버 SSH 접속 시도 시 접속 불가
- DBSAFER Agent 미로그인 상태에서 bastion host(1.1.1.1:22)를 통한 2.2.2.2:22 서버 SSH 접속 시도시 정상접속
- 고객사에서는 Bastion host(1.1.1.1:22) 서버를 DBSAFER 서비스 객체로 등록함에 따라 DBSAFER 서비스 객체로 관리하지 않는 2.2.2.2:22 서버로의 접속이 불가한 상태
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- DBSAFER Agent 로그인 후 bastion host(1.1.1.1:22)를 통한 2.2.2.2:22 서버 SSH 접속 시도 시 접속 불가 현상의 패킷을 확인하면 최초 세션 연결을 1.1.1.1:22로 시도함에 따라 패킷이 사용자PC -> DBSAFER:4000번대 포트로 NAT 처리되며 이후 뒷단에서 처리되어야 할 DBSAFER -> 1.1.1.1:22 -> 2.2.2.2:22 세션 처리가 정상적으로 되지 않는 것으로 보임
- DBSAFER Agent 미로그인 상태에서 bastion host(1.1.1.1:22)를 통한 2.2.2.2:22 서버 SSH 접속 시도시 패킷을 확인하면 사용자 PC > 1.1.1.1:22 > 2.2.2.2:22 순으로 정상 연결
- DBSAFER Agent 로그인 후 목적지를 단순히 1.1.1.1:22로 하여 SSH 접속 시도할 경우 DBSAFER를 통해 1.1.1.1:22와 정상 연결되는 것으로 확인
3. 확인 요청사항
- AWS Bastion host(1.1.1.1:22)를 Terminal 서비스 객체로 등록할 경우 DBSAFER Agent 로그인 이후 AWS Bastion host를 통해 접속하는 뒷단의 EC2 SSH 서버(DBSAFER에서 서비스 객체로 등록되지 않아 우회접속되어야 하는 서버)들 접속 패킷이 DBSAFER로 NAT됨에 따라 정상적인 연결처리가 불가한 것으로 보입니다.
사용자 PC -> DBSAFER -> 1.1.1.1:22 -> 2.2.2.2:22
AWS Bastion host의 경우 SSH 서비스 객체로 등록할 수 없는 제약사항으로 보아야 하는지 또는 DBSAFER 서비스 객체로 등록하지 않는 2.2.2.2:22 서버로의 우회접속을 정상 처리하기 위한 기능적 처리가 가능한지 확인 요청드립니다.
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
pnp_telnet build 3384
pnp_sshd 2.30.190
ssh 2.32.88","김태윤: 안녕하세요. 해당 이슈에 대해서는 아직 지원하지 않는 부분입니다.
기본적인 가이드는 bastion host 를 사용하지 않는 것으로 가이드 하고 있습니다.
참고하시기 바랍니다. | 강정근: 기능추가 요청해주시기 바랍니다. | 류현수: DBSAFER에서 관리하지 않는 대상서버로의 SSH 접속이 불가한 제약사항이 있어
Bastion host 서버의 SSH의 경우 DBSAFER의 Terminal 서비스에 등록하지 못하는 것으로 1차 전달하였습니다.",https://cafe.naver.com/pnpsecure2/6365
6362,[현대CCS2] MAC Assist 설치 후 사용 시 발생 에러 팝업창,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
에러팝업창 문의
[고객사/채널사]
현대CCS2
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
MAC Assist 설치 후 이용에는 문제가 없으나, 아래와 같은 팝업창이 발생한다고 문의옮
5. 요청사항
에러팝업창이 왜 발생하는지 답변 부탁드립니다.
MAC Assist 버전 : 3.3.2.22","김태윤: 기본적인 버전 정보는 올려 주시기 바랍니다.
DBSAFER Assist 버전 정보와 MAC OS에 대한 정보를 올려 주시기 바랍니다.

MAC OS에서 DBSAFER Assist에서 사용하고 있는 Extension 모듈 구동이 실패하여 발생한 문제로 보여집니다.
우선 DBSAFER Assist Service 를 실행해서 Extension 모듈을 재 설치해야 할 것 같습니다.
Try 매뉴에 관리 매뉴에서 할 수 있을 것 같습니다.

감사합니다. | 한두영: 답변감사드립니다.
안내주신 사항 확인해보겠습니다. | 한두영: MAC Assist 재설치 후 정상동작 확인 완료하였습니다.",https://cafe.naver.com/pnpsecure2/6362
6361,[현기차CCS2] MILVUS DB(VECTOR) 지원 가능 여부 확인 요청,"[고객사/채널사]
현기차CCS2
5. 요청사항
MILVUS DB 지원 가능한가요?
지원 가능하다면 레퍼런스가 있는지도 확인 부탁드립니다.
VECTOR에 대한 지원 가능하다는 건 지원DB관리 문서에서 확인하였으나, MILVUS와 동일한건지도 확실치 않아 문의드립니다.","김태윤: Milvus DB(밀부스 디비)는 오픈소스 벡터 데이터베이스로서 벡터 검색 및 유사도 계산을 위해 만들어진 DB입니다.

현재 해당 DBMS의 경우 확인되지 않은 DB이며, 구글 정보를 봤을 때 현재는 지원되지 않는 DB이며, 내부 확인을 통해서 지원 가능 여부에 대한 확인 필요합니다.

감사합니다. | 한두영: 답변 감사합니다.
지원불가로 답변하였으며, 방안으로는 TELNET PASS 서비스로 지원할 수 있다고 답변 완료하였습니다.",https://cafe.naver.com/pnpsecure2/6361
6353,[국방 DIDC 1센터] jenkins를 통한 배포 불가 현상,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
국방 DIDC 1센터
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
- DBSAFER Agent 로그인 후 jenkins에서 배포 시 배포가 되지 않는 현상
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- 사용자가 배포 시 jenkins에서 행걸림 현상 발생
- 스크립트 상에서 scp 프로토콜을 사용하고 있음
- scp 프로토콜 사용으로 인한 배포 불가가 원인으로 예상
- 샤크로 윈백 사업으로 샤크라에서 jenkins를 통한 배포는 정상 동작
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 없음
4. 사내 재현 정보
- 없음
5. 요청사항
- pnp_ssh_proxy 모듈을 통해서 jenkins에서 scp 프로토콜을 사용하는 케이스가 고려가 되어 있는지 확인해주시면 감사하겠습니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[jenkins ant 스크립트]
<scp todir=""${user2}@${host2}:${remote2}"" trust=""yes"" verbose=""true"" password=""${passwd2} port=""${port}>
<fileset dir=""${target}"">
<patternset refid=""files.for.opr"" />
<date when ....생략.... />
</fileset>
</scp>
[샤크라맥스 로그]
[scp] Remote version string: SSH-2.0-Sun_SSH_2.4
[scp] Local version string: SSH-2.0-JSCH-0.1.42
...
[scp] key: server->client ase128-ctr hmac-md5 none
-> 정상 동작
[DBSAFER 로그]
[scp] Remote version string: SSH-2.0-libssh_0.9.6
[scp] Local version string: SSH-2.0-JSCH-0.1.42
...
[scp] key: server->client ase128-ctr hmac-sha1 none
-> 비정상 동작
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
PC-ASSIST : 3.3.1.6
pnp_ssh_proxy : Rev 258
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","조재용: ssh_proxy.conf 설정파일에 TRANSPARENT_EXECUTE 옵션에 scp가 추가되어있는지 확인 바랍니다. | 전준호: 안녕하세요. 조재용 과장님.
피앤피시큐어 전준호입니다.

해당 옵션에 대해서 확인하였고 담당자 협의 후 적용해보도록 하겠습니다.
감사합니다. | 전준호: 현재 jenkins에서 사용하는 ant 스크립트에서 sftp로 변환하여 사용할 수 있도록 스크립트 가이드 안내하여 임시조치 요청하였습니다.
해당 부분이 정상 적용이 되지 않을 시 TRANSPARENT_EXECUTE 옵션을 차선책으로 가져가는 방향으로 적용 할 예정입니다.

추가로 해당 옵션으로 사용하게 되면 명령어 사용에는 문제가 없지만 로깅에 제약사항이 있는 것으로 알고 있습니다.
해당 방법 이외에 추가로 적용해볼만한 사항이 있으시면 공유 부탁드리겠습니다. | 전준호: 해당 사항에 대해서는 TRANSPARENT_EXECUTE 옵션을 사용하여 문제 해결하였습니다.",https://cafe.naver.com/pnpsecure2/6353
6347,[내부 테스트] pnp_userauth 모듈 가동이 안되는 현상,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기능로직문의
[고객사/채널사]
내부테스트
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
- pnp_userauth 모듈 실행 시 기동이 안되는 현상
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- pnp_userauth 모듈 실행 시 .dbsafer.conf를 바라보는 것으로 보여짐
- pnp_userauth.jar -> com -> pnpsecure -> userauth -> DbsaferDbConfig.class에서 .dbconifg.conf로 셋팅 되어 있는 것을 확인
- 현재 패키지에서는 .access.conf 로 수정되어 pnp_userauth에서 DB값을 읽어드리지 못하는 것으로 확인되어짐
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 없음
4. 사내 재현 정보
- 192.168.112.121
5. 요청사항
- Bugs에 수정요청을 올려야하는건지 확인 부탁드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
PKG_DBSAFER7_RelR23.05_RockyLinux_x86_64_P11.11_D2F_ssl111_MariaDB.tar.gz
pnp_userauth : 1.0.73 / 1.0.75
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","김태윤: 해당 이슈에 대해서 인지하여 2024년도 03월 28일에 PKG 관련 재공지한 부분이 있습니다.
공지한 내용 중에 userauth 도 언급되어 있으며, 아래의 URL을 통해서 다시 올려진 버전 다운로드 하시면 정상 동작될 것입니다.

https://bbs.pnpsecure.com/showthread.php?tid=12773

감사합니다. | 전준호: 안녕하세요. 김태윤 실장님.
프로젝트 1팀 전준호입니다.

빠른 답변 주셔서 정말 감사합니다.

패치 후 다시 테스트 해보겠습니다.
감사합니다.",https://cafe.naver.com/pnpsecure2/6347
6343,"Azure Synapse Analytics, Azure Virtual Machines(Windows 2019 Datacenter) 제품별 지원 가능 여부 문의","[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
신세계
[문의사항]
고객사에서 아래 2가지 사항에 대해 문의하여 확인요청드립니다.
현재 지원 불가한 경우 향후 지원계획에 대한 내용도 공유주시면 감사하겠습니다.
- Azure Synapse Analytics에 대한 DBSAFER DB 제품 지원가능 여부
- Azure Virtual Machines(Windows 2019 Datacenter) 에 대한 DBSAFER AM/OS 지원가능 여부
Azure Synapse Analytics의 경우 AWS의 Aurora,
Azure Virtual Machines(Windows 2019 Datacenter) 의 경우 AWS의 EC2와 비슷한 개념의 서비스 인것으로 보입니다.","김태윤: Azure Synapse Analytics 에 대해서 패킷 수집해 주시면 확인 가능할 것으로 판단되며,
Azure Virtual Machines(Windows 2019 Datacenter) 의 경우 AWS EC2 와 동일한 가상 머신으로 보여집니다.
DBSAFER SA, OS 에 대한 문의는 정현교 대리에게 문의 부탁합니다. | 정현교: Azure Virtual Machines(Windows 2019 Datacenter) 에서 Private IP 기준으로 SA/OS 기본 동작 테스트 시 정상동작 하는것을 확인했습니다.

[테스트 항목]
* 구성 : Azure Cloud 내 DBSAFER / Windows 서버 생성

- Server Agent > terminal 제어
- DBSAFER OS > 파일 접근 제어 / TCP 접근 제어

전체 기능 테스트가 필요한 경우 테스트 요청 부탁드립니다. | 정현교: 추가 요청에 대한 테스트 결과입니다.
(수정 : 추가로 tproxy 관련 이슈가 있는것으로 보여 확인중입니다)

[요약]
- SA(우회접근제어),OS (파일 접근 통제, TCP 제어) 지원가능하나, 확인된 이슈 및 제약사항이 존재합니다.

[테스트 구성]
사내 - DBSAFER7.0 / Azure Cloud - Windows VM (SA 5.1.8.x)


[기능 동작 확인]
- 우회 접근 시 아래 기능들에 대해서 동작하는 것을 확인했습니다.
> Server Agent > terminal 제어
> DBSAFER OS > 파일 접근 제어 / TCP 접근 제어

[제약사항]
1. SA에서 일반접속 / 우회접속 구분 불가
> (테스트 환경 구성 기준) 사내 DBSAFER / 사내 사용자 모두 회사 public IP로 Azure Windows 서버에 접근하게됨
- 즉, 일반접속 IP / 우회접속 IP가 동일
> SA 설정 시 DBSAFER의 wta_server_manager가 대상 서버 W | 정현교: 해당 내용 정정합니다.

[요약]
- 우회 접속 : SA(우회접근제어),OS (파일 접근 통제, TCP 제어) 지원 가능
- 일반 접속 : 지원 불가 (로그에 보안계정이 남는 우회접속으로 기록됨)

[테스트 구성]
사내 - DBSAFER7.0 / Azure Cloud - Windows VM (SM/SA 5.1.8.x)

[제약사항]
1. SA에서 일반접속 / 우회접속 구분 불가 (첨부 구성도 참고)
- 서비스 IP에 NAT된 DBSAFER IP 를 추가한 경우
> wa는 일반 접속, 우회 접속 모두 일반접속으로 판단하여, 일반 접속의 src ip, port 로 역접속 하는 구조
> 사내에서 일반 접속하는 경우 회사 Public IP 를 통해 Cloud 에 있는 서버로 접근하는데, 이 때 포트가 변경됨
. ex) DBSAFER PrivateIP:50001 > 회사 Public IP:50021(변경) > RDP PORT
> 사내 공인 IP와 변경된 src port(211.181.26.2",https://cafe.naver.com/pnpsecure2/6343
6333,[앱솔릭스] PC Assist 잠금해제 버튼 문구 siteres_kr/en.cfg 파일로 변경 가능 여부 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기능로직문의
[고객사/채널사]
앱솔릭스
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
3. 특이사항 (연동 모듈, 커스텀 개발 등)
4. 사내 재현 정보
5. 요청사항
고객사는 미국법인으로 내부에 한글OS와 영문OS를 사용하는 사용자가 혼재해있습니다.
saferuas를 통한 보안계정 잠금해제 및 비밀번호 초기화 기능을 활성화하여 버튼 텍스트를 ""잠금해제 및 초기화""로 설정하였으나, 영문OS 환경에서 텍스트가 깨져 출력되는 현상이 있습니다.
혹시 PC Assist가 영문버전으로 설치된 경우 siteres_en.cfg 파일을 통해 버튼 텍스트 문구를 변경하는 기능이 있는지 확인 요청드립니다.
saferuas 설정
버튼 문구 깨짐
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
saferuas : 2.0.72.0 Build-2248
PC Assist : 3.2.36.1
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","여성구: 해당 값은 DB 에 저정되는 값 입니다. 확인 후에 답변을 하겠습니다. | 여성구: @이임재 과장님 @박수아 사원과 본 사항 체크해주세요. | 이임재: >>질문 1. siteres_en.cfg 파일을 통해 버튼 텍스트 문구를 변경하는 기능이 있는지 확인 요청드립니다.
:
기능 로직 확인 결과 , 해당 기능은 제공하지 않습니다.

>>질문 2 -영문OS 환경에서 텍스트가 깨져 출력되는 현상이 있습니다.
:
한글OS와 영문OS 둘 다 사용곳이라면
버튼 명을 영어로 가이드 부탁드립니다.",https://cafe.naver.com/pnpsecure2/6333
6332,AWS keyspace 또는 구축형 카산드라DB에 대한 서비스 객체 지원 가능여부,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
빗썸
[문의사항]
고객사 문의사항으로 AWS keyspace 또는 구축형 카산드라DB에 대해 현재 서비스 객체로 등록하여 접근제어가 가능한지 여부 문의드립니다.
(AWS keyspace의 경우 nosql workbench 툴을 통해 관리하는 것으로 보입니다)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
DBSAFER5 PKG 사용중","진선태: 카산드라DB는 현재 지원하지 못하고 있습니다.
다만 연구소에서 Cassandra 지원을 위한 분석 작업을 최근에 진행한 바 있으며,
프로토콜 특성상 지원 가능성이 높은 것까지는 확인되었습니다.

보고 상으로는 10월말까지 개발이라고 되어 있으나,
검증 포함하면 올해 12월 정도 지원될 것으로 예상은 됩니다.

참고하시기 바랍니다. | 김태윤: 카산드라DB 의 경우 개발 일정이 3분기에 개발 진행 예정인 상황이며, AWS keyspace 의 경우 Apache Cassandra 호환 으로 확인되어 동일하게 하반기에 개발 완료 후 확인이 필요한 사항으로 보여집니다.
감사합니다. | 진선태: 정보 공유 감사합니다.",https://cafe.naver.com/pnpsecure2/6332
6330,오라클 ClOB 데이터마스킹 지원 여부,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
K2코리아
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
3. 특이사항 (연동 모듈, 커스텀 개발 등)
4. 사내 재현 정보
5. 요청사항
오라클 ClOB 타입에 대해서 데이터마스킹이 제약사항으로 알고 있습니다.
향후에 ClOB타입도 데이터마스킹 기능을 사용할 수 있도록 개선할 수 있는지
이미 예정에 있다면 일정도 알려주면 감사드리겠습니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
[고객사 테스트 테이블 스키마정보]
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
첨부파일
k2korea_clob
.pcap
null
파일 다운로드","김태윤: 올려 주신 내용과 같이 BLOB, CLOB 등 에 대한 대용량 처리의 경우 데이터마스킹에 대한 제약사항이 있습니다.
우선 사이트의 상황에 따라 대응을 해야 할 것으로 판단됩니다.
CLOB 데이터 조회한 패킷을 최대한 수집해 주시면 내부에서 가능 여부 판단해 볼 수 있을 것 같습니다.
감사합니다. | 한두영: 답변 감사드립니다.
우선 고객사측에서는 이미 제약사항으로 협의 완료된 상태입니다.
그럼에도 고객사측에서 많이 아쉬워해서 혹시 지금 당장은 아니더라도 향후에 개선할 여지가 있는지 문의한 상태입니다.
말씀주신것처럼 CLOB데이터 조회패킷을 수집할 수 있으면 수집하여 전달드릴 수 있도록 하겠습니다.
감사합니다. | 한두영: 고객사측에 요청하여 실운영데이터는 아니지만 최대한 비슷한 환경으로 테스트 테이블 구성하여 패킷덤프 반출받아 게시글에 파일첨부하였습니다.
확인해주시면 감사드리겠습니다. | 김태윤: 해당 이슈에 대해서는 Bugs 27599를 통해서 진행하는 것으로 하였습니다.
연구소 분석 후 답변 예정입니다.",https://cafe.naver.com/pnpsecure2/6330
6327,끝에서 n개의 글자를 데이터마스킹하는 방법,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
KCP
[이슈내용]
1. 문의사항
고객사 요청으로 아래 이미지처럼 데이터 글자수와 상관없이(한글,영문,숫자,모든특수기호사용) 끝에서 n개의 글자를 마스킹하도록 하는 컬럼명 데이터마스킹 객체 생성 방법이 있는지 문의드립니다.
특수기호에는 하트, 별 등 다양한 특수기호도 포함되어있어 모든 특수기호가 적용되어야 합니다.
2. 확인한 내용
아래 이미지와 같이 특정 글자 (ex. 0~9)를 지정하여 마스킹하는 방법은 확인되나 글자지정없이 설정하는 방법은 확인되지 않아 문의드립니다.","김태윤: 숫자 부분은 [0-9] 로 하면 되구요, 영문의 경우 [a-zA-Z] 로 하시면 됩니다.
추가적으로 아래의 내용 참고하세요.
https://drive.google.com/drive/search?q=%EB%AC%B8%EC%9E%90%20%EB%A7%88%EC%8A%A4%ED%82%B9 | 최재규: 특수문자 및 한글의 경우 byte 단위가 영문자나 숫자와 다르기 때문에 동일하게 n 글자 개념으로 마스킹은 어렵습니다.
- 숫자, 영문자 1글자 = 마스킹 1글자
- 한글, 특수문자 1글자 = 마스킹 3글자 (UTF8mb3 기준) | 최재규: 이해를 돕기 위해 비정상으로 마스킹 깨짐 처리가 되는 현상 첨부드립니다. ....$ (마지막 4글자 마스킹)
5번 데이터에서만 정상으로 마스킹 처리되지만 2글자만 처리됨. (영문자1개 + 특수문자1개)",https://cafe.naver.com/pnpsecure2/6327
6324,userauth 모듈 cache_time 옵션,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기능로직문의
[고객사/채널사]
한국투자증권
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
3. 특이사항 (연동 모듈, 커스텀 개발 등)
4. 사내 재현 정보
5. 요청사항
1. cache_time옵션의 최대 설정값이 궁금합니다.
2. 인증 한건당 잡아먹는 메모리 수치가 궁금합니다.
(cache_time옵션을 길게 설정함에 따라서 발생할 수 있는 이슈 예측 위함)
[문의 사유]
AM접속 시 2-factor인증을 최초 한번 받으면 설정시간(30분이 될수도 2시간이 될수도 있음)동안 2-factor인증을 받지 않기를 원함
위 요청사항의 답변으로 고객사쪽에는 두가지 방안을 제안함
1. 기존 userauth옵션인 cache_time옵션을 활용
> 시간을 길게 설정함으로서 부하 혹은 정상동작에 대한 검증 필요
> 원래 해당기능을 위해서 존재하는 기능이 아님은 설명함
2. 개발비용을 받아서 추가개발 진행
> 개발내용은 미정
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","김태윤: 고객사 요청 사유에 대해서 작성 바랍니다.
이렇게 요청한 사이트는 현재 없을 것으로 보이며, 보안 홀이 발생하는 부분으로 내부 검토가 필요할 것 같습니다. | 한두영: 작성하여 업데이트 해놓았으며,
3월25일 미팅이 있는데 보안 홀을 언급하여 협의 해보겠습니다. | 한두영: 이재진 대리님 통해서 세션 한개당 최대 500byte 소모하는것으로 확인하였습니다.
추가적으로 고객사측에는 보안홀 문제점이 있을것 같아서 해당 기능 사용은 어려울 것으로 의사 전달 하였습니다",https://cafe.naver.com/pnpsecure2/6324
6322,[모트라스] mssql_account_finder 접속계정 IP로깅에 대한 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
에러 로그 문의
[고객사/채널사]
모트라스
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
- mssql_account_finder 적용 후 접속계정이 IP로 찍히는 현상
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- DB에 접속해서 mssql_account_finder에서 사용하는 쿼리 실행 확인
- 로깅되는 현상 확인
- mssql_account_finder.sh test 시 OK 확인
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 없음
4. 사내 재현 정보
- 없음
5. 요청사항
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
- mssql_account_finder 에러로그
- 해당 에러 로그가 발생하는 원인에 대하여 확인 부탁드립니다.
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
- mssql_account_finder.sh 버전
- pnp_dbms_gateway 버전
- pnp_mssql 버전
-java 버전
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","유현진: 엔지니어에게 추가적으로 전달받은 내용 : 매니저에서 관리자 설정 >mssql 접속계정 관리 서버 접속검사를 실행하는 경우 실패로 표시

./mssql_account_finder test 명령어와 매니저의 mssql접속계정 관리서버 접속검사는 같은 과정으로 mssql_account_finder 동작여부 확인 요청드립니다. (둘 다 성공 / 실패해야하는 동작이 정상 - 연구소 확인사항)

매니저 mssql 접속계정 관리서버 접속검사 수행 시 pnp_agent , mssql_account_finder 로그 확인 요청드립니다. | 전준호: 추가 요청하신 로그 및 캡쳐화면 라인으로 전달드렸습니다. | 유현진: 추가적으로 전달받은 내용 : 이중화 구조 (LOG 2식, GW 2식)

매니저 > mssql 접속계정 관리 > 서버 접속검사를 하는 경우 GW 중 랜덤한 GW와 통신하기 때문에 모든 GW에서 mssql_account_finder 모듈이 동작되어야합니다.
GW서버에서 ./mssql_account_finder test를 하는 경우에는 OK로 표시되지만 매니저에서 확인 하는 경우에는 실패로 뜨는 이유에는 log 서버와 gw서버의 통신문제로 보여집니다.
(참고 : 테스트 시 LOG --> GW TCP 3142 포트 접속) | 전준호: 확인해주셔서 감사합니다. | 박상원: 키 교환 알고리즘이 달라 실패할 수도 있을 것 같습니다.
아래 게시글 참고해보면 좋을 거 같습니다.
https://cafe.naver.com/pnpsecure2/4178?tc=shared_link | 전준호: 안녕하세요.
프로젝트 1팀 전준호입니다.

해당 문의에 대하여 도움 주셔서 감사합니다.

전달해주신 항목도 확인해보도록 하겠습니다.
감사합니다.",https://cafe.naver.com/pnpsecure2/6322
6321,[현대백화점그룹] Sniff 서버 10G 와 1G 호환 가능성 여부 확인 요청 드립니다.,"[분류] (기타문의)
[고객사/채널사]
- 현대백화점그룹
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크)
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
3. 특이사항 (연동 모듈, 커스텀 개발 등)
4. 사내 재현 정보
5. 요청사항
1) Sniff 서버 구성
> DEFAULT 서버
> 기존 사용중이었으나, 2021년 11월 업그레이드 사업 이후 사용하지 않는 중입니다.
2) 문의사항
> 현대백화점그룹 에서 Sniff 서버를 활용하여 스니핑을 진행하고 싶어하는 상황입니다.
> 현재, 현대백화점그룹 에서 DB단 네트워크는 10G를 사용중이나, Sniff 서버의 NIC는 1G 지원중입니다.
> DB단에서의 10G 네트워크를 Sniff 서버의 1G NIC에서 설정을 통해 지원 할 수 있는 방법이 있는지 확인 요청 드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","진선태: * 결론: DBSAFER NIC에 1G도 가능, 만약 문제가 생길 경우 스위치 장비에서 neogotiation을 수동으로 1G full-duplex로 맞춰 주면 됩니다.

* 일반 설명
원칙적으로는 DBSAFER 장비에서도 10G NIC를 탑재하는 것이 좋지만 DBSAFER 장비 자체가 1G 이상의 미러링 트래픽을 처리할 경우 장비 안에서 손실이 발생됩니다. 즉 10G NIC를 교체 설치해도 큰 의미가 없을 것으로 보입니다.

* 추가 설명
추가적으로 설명 드리면 스위치의 mirror port의 NIC가 10G라도 auto-negotiation이 1G로 결정되기 때문에 일반적인 통신에는 문제가 없습니다. 이론적으로는 1G full-duplex로 협상되면서, 10G의 미러링 데이터가 순간 순간 폭증할 때에 packet loss가 일어날 수 있는 있습니다만 서두에서 설명 드린 바와 같이 10G 트래픽을 NIC에서 다 받아 주더라도 DBSAFER Sniffing 데몬의 성능이 해당 트래픽 | 김태윤: 부사장님께서 얘기해주신 사항이 맞습니다.
권장은 10G를 사용하는 것을 권고하지만, 1G라 하더라도 안되는 부분은 아니며, 특정 트렉픽량 이상일 경우 누락이 발생합니다.
참고하시기 바랍니다. | 이창제: 빠른 답변 감사드립니다.

고객사에 해당 내용 기반으로 기술지원 진행하도록 하겠습니다.

감사합니다.",https://cafe.naver.com/pnpsecure2/6321
6317,[SKOY] 정책을 타지 않는 현상 공유드립니다,"안녕하세요. 프로젝트 1팀 김세린입니다.
얼마 전 한 고객사에서 정책을 타지 않는 현상이 발생하여 그 원인과 해결방안 공유드립니다.
* 설명에 사용된 모든 사진은 예시입니다.
[요약]
보안계정 그룹의 유효기간 날짜 형식이 yy-m-dd hh:mm pm 형식으로 잘못들어가있어 정책 조건에 해당 보안계정 그룹이 지정되어 있을 경우 허용 정책을 타지 않고 전체 차단에 걸리는 현상
clientgroup_cert / cert_group 테이블의 expire 컬럼값을 YYYY-MM-DD HH:MM:SS 형식으로 변경
[현상]
같은 조건의 정책임에도 불구하고 한 정책만 정상 동작하지 않고 차단이 되는 현상
> 2번 정책 ""B그룹 허용""만 비정상 동작
[그림 1] 전체적인 정책 구성
[그림 2] 정책 내용 (모든 정책의 구성 내용이 동일함)
각 그룹에 서로 겹치는 객체가 있는 경우도 있음 (한 서비스가 두 그룹에 포함)
[그림 3] 같은 조건의 정책에 대한 허용로그와 차단로그
: 3번 정책은 정상 동작하여 “C그룹 허용”으로 기록되지만 2번 정책은 비정상 동작하여 차단 됨
[확인 사항]
1. 차단된 사용자의 NAT List 확인
> 접속 시도했던 서버에 대한 권한이 있는 것으로 확인됨 (NAT List 동기화 정상)
2. 서비스 모듈 로그 및 DBSAFER ↔ 사용자 구간 패킷 확인
> 특이사항 없음
3. 정책 내 조건을 하나씩 적용시켜 접속 테스트 진행
> 보안계정 그룹이 조건에 들어가면 차단되는 것을 발견
4. dbsafer3.clientgroup_cert와 dbsafer3.cert_group 확인
> expire 컬럼에 들어가있는 날짜 형식이 yy-m-dd hh:mm pm 형식으로 등록되어 있었음
csv 작업 시 잘못된 날짜 형식으로 등록한 것으로 추정
5. update문을 통해 yyyy-mm-dd hh:mm:ss 형식으로 변경 후 접속 테스트
> 정상 접속 확인
[해결 방안]
날짜 형식이 잘못 들어가있는 그룹을 확인하여 매니저에서 수동 변경
1. 매니저 → 보안계정 → 해당되는 그룹 우클릭 → 그룹 수정 → 유효기간을 다른 날짜로 변경
2. 매니저 → 보안계정 → 해당되는 그룹 우클릭 → 그룹 수정 → 원래 유효기간으로 변경
3. DB 확인 > yyyy-mm-dd hh:mm:ss 형식으로 바뀌었는지 확인
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6317
6315,[현대오토에버] fireeye CPU 과다 사용에 따른 원인 및 동작 확인,"[분류]
- 기능로직문의 / 기타문의
[고객사/채널사]
- 현대오토에버
[이슈내용]
1. 증상
- fireeye 설치 및 운영이 되는 상황에서 LOG Server에서 비정상 적으로 CPU를 과다 사용하고 있음
- 1core에서 대해 사용을 하지만 평균 70 ~ 80% 정도 사용
- xagt라는 프로세스가 CPU를 사용하고 있으며, 이에 대한 원인 분석을 고객사에 요청
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- 동작은 정상이며, CPU 부하가 많은 원인은 아래와 같이 확인이 됨
- 약 39분 간 148,201 건의 Network Connection Event 발생 process : pnp_server_manager
- 약 7시간 동안 232,943 건의 Process Event 발생
. ProcessCount.ksh, pnp_sysmon, pnp_watcher 에서 합 134,807 건으로 총 이벤트 중 절반 이상의 이벤트를 발생
- 특정 시간에 체크를 한 것이지만 지속적으로 꾸준히 발생하고 있음
- ProcessCount.ksh는 어떤 내용인지 추가 확인 필요(DBSAFER를 운영하면서 별도로 우리가 실행한 것이 아님)
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 서버 구성: DBSAFER v5, duplex 구성
- 서비스 수량: DBMS 927개, Telnet 5174개
- 이벤트 발생이 많은건 모두 기본 모듈 입니다.
- 정상적인 동작인지 확인이 필요하며, 정상적인 동작일 경우 개선이 있어야 할 것 같습니다.
(fireeye 같은 분석 솔루션이 많이 설치가 되고 있는데 앞으로 유사 이슈가 지속적으로 발생 될 수 있음)
4. 사내 재현 정보
- N/A
5. 요청사항
- 정상적인 동작인지 확인이 필요합니다.
- 정상적인 동작일 경우 개선이 가능한지 확인 필요
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","진선태: server_manager이 대상 서버로의 상태를 체크하는 토폴로지 구조가 IP/Port scan 구조이고, 스캔 주기와 정책 복잡도에 따라서 트래픽이 많을 수 있습니다. 일단 세션 생성과 대상이 많은 부분에 대해서는 당연히 Fireeye에서는 예외 처리해야 되고,
트래픽 bytes 수가 많은 것에 대해서는 정책이 통상적인 부분인지, 아니면 정책이 많은지를 먼저 분석해 주셔야 할 듯 합니다.
Fireeye와 같은 제품의 경우 DDoS와 Scan판독에 CPU를 많이 먹을 수 밖에 없는 구조입니다. 참고하시기 바랍니다.

서비스/서버 약 5천개에 대해서 정책 업데이트가 없어도 체크 주기별 1회에 5천여개의 connection이 발생됩니다

따라서 현재 사이트의 트래픽 이상 유무는 유지보수 엔지니어가 기초 판단을 해 주셔야 할 듯 합니다. | 하충현: 우선 현재 동작하는 부분에 대해서는 정상 동작으로 판단을 하였으며 기본 동작에 대해서는 고객사쪽에서 설명은 하였습니다. 프로세스 체크/감시에 대한 예외처리 가능 유무에 대한 확인을 해달라고 요청을 하였습니다.

=============================================================================
* 현대오토에버 악성코드분석센터의 예외 처리에 대한 회신 내용을 추가 확인 하였으며, 내용은 아래와 같습니다.

- 이벤트를 많이 발생시키는 프로세스는 grep, awk, sh, egrep라 예외처리 불가
> 리눅스 기본 프로세스로 보안 공격에 악용될 소지가 있음

- 네트워크 이벤트는 개별 예외 처리가 불가능하고 ON/OFF만 가능
> 네트워크 이벤트 모듈을 OFF하게 될 경우 3way-handshake 이벤트는 수집하지 않으므로
> 추후 사고 발생 시 네트워크 분석이 어려울 수 있음
============================= | 진선태: 현구조에서 특징은 안고 가야 하며, 그 빈도를 줄이기 위해서는 체크 주기를 늘려서 과부하가 발생되는 빈도를 줄이는 방안이 당장 수행할 수 있을 것 같습니다.

추가적인 방안은 연구소가 검토해 줘야 하지만,
통상적으로 매번 상태 체크를 하지 않고, NAT로 서비스 사용량이 있는 경우는 짧게 체크하고, 그렇지 않는 서비스에 대해서는 체크 주기를 자동으로 길게 늘려서 현재의 트래픽을 대비 1/10 이상 줄일 수도 있을 것 같습니다.

그리고

ProcessCount.ksh 의 내용은 확인 부탁 드립니다. | 하충현: 넵 확인 감사합니다. ProcessCount.ksh는 위에서 언급 드린것과 같이 제가 지원하면서 적용한 부분이 아니기 때문에 추가 확인 필요한 상황입니다. 고객과 해당 부분에 대한 확인은 필요하다고 전달은 하였으며, 금일 중 확인 예정입니다. | 하충현: ProcessCount.Ksh 출처 확인
설치 경로 및 파일 확인 후 ibm IBM SmartCloud Analytics - Log Analysis 로 확인 완료
서버 로그 취합 및 분석 툴로 확인이 되었으며, 해당 툴은 현대오토에버서 설치 및 운영을 하고 있습니다.

* 고객사 추가 조치 사항
- FireEye에서 실행되는 네트워크 분석 기능 OFF
> 네트워크 분석 기능 OFF 후 CPU 과점유 없어짐
- '앞으로도 네트워크 분석 기능은 OFF해서 사용 할 것 같다'고 박하영 책임과 유선 확인 완료 하였습니다 | 진선태: 수고하셨습니다. 적절하게 조치하신 것 같습니다. 감사합니다. | 하충현: 다들 잘 아시는 내용이지만 아래 내용 참고하시면 좋을 것 같습니다.
[참고]
xagt 프로세스가가 FireEye로 확인한 방법
1. xagt의 PID 확인
2. /proc/[PID] 디렉토리로 이동
3. bin 파일의 링크 정보 및 기타 정보 확인",https://cafe.naver.com/pnpsecure2/6315
6313,[앱솔릭스] RDP 일반접속 시 서비스 로그에 접속유형이 우회접속으로 남는 현상,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
에러로그문의
[고객사/채널사]
앱솔릭스
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크)
사용자가 DBSAFER Agent 실행 후 서버에 접속시 접속유형이 ""우회접속""으로 기록되는 현상
매번 우회접속으로 기록되지 않으며 간헐적으로 발생함.
우회접속과 일반접속로그가 함께 남는것이 아닌, 우회접속으로만 남음.
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
대상 윈도우 서버 SA WTA에서 RDP 세션정보 수집 과정에서 오류가 발생하여, 해당 세션을 일반접속 세션이 아닌 우회접속 세션으로 판단한 것으로 보임.(nodesaferwa 로그에서 Conntype: 2로 기록된 것으로 발견됨)
3. 특이사항 (연동 모듈, 커스텀 개발 등)
고객사가 위치한 미국 동부 시간과 서버 시간이 4시간 차이남(서버가 4시간 빠름)
RDP 로깅 기능 미사용
4. 사내 재현 정보
없음(시도 중)
5. 요청사항
위 현상이 발생할 때마다, nodesaferwa 로그에 아래와 같이 기록됩니다.
[2024-03-14 20:42:05] [CRITICAL] [13800] [SOCK_00000013] [CSendUtil::checkServerCommand, 1570] - recv() failed[An established connection was aborted by the software in your host machine.(10053)]
해당 로그가 어떤 경우에 발생하는지 확인해주시면 원인 분석을 시도해보겠습니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
구글드라이브 업로드하여 링크 첨부하였습니다.
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
OS : RHEL 8.8
PKG : PKG_DBSAFER5_RelR23.05_RHEL8_x86_64_P11.11_D2F_ssl30_MariaDB
PC Agent : 3.2.36.1
클라이언트 툴 : mstsc
pnp_server_manager : 5.1.8.30 Build(255)
wta_server_manager : 1.1.5 (Rev 65)
wta_proxy_server : 1.1.1 (Rev 46)
Server Agent : 5.1.8.4
대상 OS : Windows Server 2019 (AWS EC2)
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
현상 발생한 서버 내 nodesaferwa, nodesaferws 로그 구글드라이브 업로드
https://drive.google.com/file/d/15rf8PUgnRJsnngfK0N9lzzKlC-1xcM4o/view?usp=sharing
앱솔릭스 RDP 비정상 로깅 현상 관련 wta로그.zip
drive.google.com
항상 감사합니다.","정현교: 강영묵 차장님과 확인한 내용 전달드립니다.

[로그 분석 내용]
1. 예상 발생 시나리오
1) 처음 접속 시 대상 서버 우회 접속
> 근거 : 일반 접속 시 RECV WTS SessionInfo에서 SRC IP 가 DBSAFER GW IP(10.184.50.196,10.184.50.197)로 나와야합니다.
> 로그에는 계속 10.184.23.187로 계속 찍히고 있음

- [2024-03-14 13:50:24] wta_server_manager conf 로그 중 SERVICE_IP=10.184.50.196,10.184.50.197(GW IP)
....
- [2024-03-14 13:50:24] [DEBUG] CNetworkHelper::RecvConnectInfo:1022 - [SID:2] RECV WTS SessionInfo (SID:2, SRC:10.184.23.187:52123)
- [2024-03-14 13:50:24] [DEBUG] CNetworkHelper::SearchR | 강성우: 안녕하세요 대리님, 자세한 분석 감사드립니다.

1. 10.184.23.187이 사용자 PC IP가 맞습니다.
2. 해당 내용은 고객이 현지에 있어 확인이 어려우나, 우회접속 로그가 생성된 시점을 봤을 때 동일 접속지에서 우회접속(보안계정X) 로그 생성 -> 약 30분~1시간 뒤 우회접속(보안계정O) 로그가 생성되어 있는걸 보아 말씀하신 케이스가 맞는 것 같습니다. 또한 두 로그 사이에 보안계정 접속로그도 있는 것을 확인하였습니다.
3. 해당 케이스에 pnp_telnet에서 일반접속으로 로그가 남았습니다.

유사 현상 내부재현도 성공하여, 답변주신대로 조치하고 고객에게 가이드하도록 하겠습니다.
감사합니다.",https://cafe.naver.com/pnpsecure2/6313
6312,[TIP] pnp_ha 설정시 pnp_ha.ini 설정 주의사항,"[개요]
- DBSAFERv7.0에서는 Galera Cluster로 DB이중화 구성을 하여 DBSAFER이중화 구성을 하고 있습니다.
. DBSAFERv5.0에서는 pnp_duplex모듈을 통해 진행을 하였으나 DBSAFERv7.0에서는 pnp_ha모듈을 통해 Failover 옵션을 지정할 수 있습니다.
[pnp_ha설정 후 에러 발생]
- 기존 운영중이었던 서버에서 pnp_ha.ini 설정값을 COPY&PAST를 통해 수정을 하였으나 pnp_ha모듈 가동시 아래와 같이 pnp_ha.ini파일에 설정된 옵션을 정확히 읽어오지 못하여 에러가 발생
*pnp_ha 모듈 가동시 필수 환경설정 파일 : pnp_ha.ini, ha_env.conf, pnp_ha.key, pnp_ha.service(Checker)가 필수로 있어야 함
[pnp_ha설정 후 pnp_ha.ini파일정보를 제대로 읽지 못하여 에러 발생]
[pnp_ha.ini 설정시 주의 사항]
- Failover조건을 설정은 아래와 같이 진행을 하지만 pnp_ha.ini에서 주석 "";"" 처리를 하고 있습니다. 즉 "";"" 제거를 하면 해당 옵션을 활성화되게 됩니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6312
6309,[공유] DBSAFER V7.0 (단독 - 단독) Galera 환경 구성 세팅 방법 공유,"안녕하세요
클라우드기술팀 손혁진입니다.
[배경]
케이티 고객사는 최초 DBSAFER 이중화를 요청했습니다. 이후 킥오프 미팅에서 AWS Multi AZ 환경의 이중화이였음을 확인하였습니다. AZ 별로 DBSAFER(단독(AZ1) - 단독(AZ2)) 이중화를 구성한다라는 의미이고 이는 서로 다른 서브넷에 DBSAFER 설치하고 이중화를 구성해야된다는 요건입니다.
위와 같은 고객의 요건 분석 시 아래의 조건이 반드시 고려해야되는 상황
# 고객사의 EC2 관리 포인트를 줄여야 한다.
# AWS NLB는 활용할 수 없다.
# 데이터 Write I/O는 항시 Active(Master)에서만 이루어져야 한다.
# 각 가용영역의 서브넷은 동일한 CIDR 주소를 사용할 수 없으며 이는 VIP를 할당 불가
> 위 상황의 경우 NLB(Network Loadbalancer)를 활용하여 각 AZ에 구성된 노드를 이중화로 구성 할 수 있으나
현재 DBSAFER에서는 NLB를 활용한 이중화 구성을 지원 불가
이에 위 조건을 고려하여 아래와 같이 협의 진행
# AZ별 1대씩 총 2대로 구성하되 Active-Standby로 동작
# Failover 발생 시를 대비하여 관리자는 Enteprise Manager Standby 접속 IP 인지 필요
# WEB APP(EX)Works등) 미사용
> WEB APP 사용 시 Enterprise Manager 등 여러 설정 부분에서 이중화 구성의 기준 정보(EX) VIP or 도메인)가
설정이 되어야하나 VIP 및 도메인을 활용 할 수 없는 환경에서 Active or Standby IP를 세팅 시 Galera Cluster 환경에 따라 반대 DBSAFER에도 동일하게 세팅되어 정상적인 설정이 불가 합니다. 이에 WEB APP는 사용이 불가합니다.
Active - Standby 구조에서 Failover 및 Activate 진행 시 각 DBSAFER 마다 start/stop을 수행 해줄 기능이 필요하였습니다. 이에 유사한 기능을 찾던 중 기술지원매뉴얼에서 pnp_ha executecmd라는 기능을 확인하였습니다. 결과적으로 pnp_ha executecmd 기능을 사용하여 Failover 및 Activate 진행 시 각 DBSAFER 마다 start/stop이 필요한 모듈들을 처리하였습니다.
아래는 DBSAFER V7.0 (단독 - 단독) Galera 환경 구성 세팅 방법이며 pnp_ha executecmd 사용 내용도 포함되어있으니 참고 부탁드리겠습니다.
고객사 환경
- OS : Rocky8
- DBSAFER : V7.0
- 구성 : (단독 - 단독) 이중화
[요약]
- 케이티에서 고가용성 확보를 위해 Multi AZ 구성으로 필수로 요구한 상황
- DBSAFER V7.0 (단독 - 단독) Multi AZ 구성 시 환경적인 제약 조건으로 VIP 사용 불가
. VIP 사용이 불가 하기에 ExecuteCmd 통해서 (Master - Slave) 서버 컨트롤
- DBSAFER Failover 및 Activate 진행 시 pnp_ha ExecuteCmd 서비스를 활용하여 필수 프로세스 중지 및 구동 명령어 파일 실행
★ 현재 기준에서 DBSAFER V7.0 (단독 - 단독) Multi AZ 구성에서 웹서비스 사용이 불가
[구성 방법]
- DBSAFER V7.0 (단독 - 단독) Multi AZ DBSAFER 설치 완료
- DBSAFER Galera Cluster 구성 적용
Galera Cluster(단독-단독) 구성 완료
- /dbsafer/.conf/pnp_ha.services 하위에 ExecuteCmd 서비스 활용
. ExecuteCmd 서비스란 Failover To Normal / Normal To Failover 될 때 *.txt 파일에 등록됨 명령어를 실행하는 서비스
. ExecuteCmd는 별도 빌드 요청 필요
/dbsafer/.conf/pnp_ha.services 하위 ExecuteCmd 서비스
- ExecuteCmd 서비스 수행 시 실행되는 명령어 파일 작성(명령어 파일는 /dbsafer/.conf/pnp_ha.services 하위 존재)
. cmd_failover.txt : Failover 모드 전환 시 수행되는 명령어 파일 입니다.
# 아래 내용은 예시이며 cmd_failover.txt 내용입니다.
cd /dbsafer
#Failover 시 Slave 서버와 연결되도록 Master 서버 pnp_oms_dms 중지
pkill -9 pnp_oms_dms
#Failover 시 Slave 서버와 연결되도록 Master 서버 pnp_agent 중지
pkill -9 pnp_agent
. cmd_normal.txt : Activate 모드 전환 시 수행되는 명령어 파일 입니다.
# 아래 내용은 예시이며 cmd_normal.txt 내용입니다.
cd /dbsafer
#Activate 진행 시 Master 서버와 연결되도록 pnp_oms_dms 시작
./pnp_oms_dms start
sleep 1
#Activate 진행 시 Master 서버와 연결되도록 pnp_agent 시작
./pnp_agent start
sleep 2
./pnp_agent run-watcher
- ExecuteCmd 서비스 수행을 위한 pnp_ha.ini 설정 진행
. Service list에 NormalExecute FailExecute 서비스 추가
. Failover To Normal / Normal To Failover 진행 시 실행 될 명령어 파일 경로 기입
[service]
; Service list.
service_list = MariaDB VirtualIP DataDisk AgentProcess LogProcess NormalExecute FailExecute
; NormalExecute service
service_NormalExecute_bin = ExecuteCmd
service_NormalExecute_param = cmdFilePath:/dbsafer/.conf/pnp_ha.services/cmd_normal.txt executeType:activate
; FailExecuteCmd service.
service_FailExecute_bin = ExecuteCmd
service_FailExecute_param = cmdFilePath:/dbsafer/.conf/pnp_ha.services/cmd_failover.txt executeType:deactivate
- pnp_ha 재기동 혹은 reload 진행 시 아래와 같이 status 및 프로세스 구동
pnp_ha ExecuteCmd 프로세스
- pnp_ha status 통해 NormalExecute, FailExexecute 서비스 정상 확인
[테스트]
1. Master 서버 pnp_oms_dms, pnp_agent 정상 구동 상태
2. Master 서버 pnp_log 중지
3. Master 서버 Failover 발생 및 ExectueCmd(cmd_failover.txt)로 인해 pnp_oms_dms, pnp_agent 중지 확인
MASTER 서버 FAILOVER 발생
pnp_oms_dms, pnp_agent 프로세스 X
4. pnp_log start 및 Master 서버 Activate 진행
pnp_log start
Master 서버 Activate 진행
5. ExectueCmd(cmd_normal.txt)로 인해 pnp_oms_dms, pnp_agent 프로세스 구동 확인
pnp_oms_dms, pnp_agent 프로세스 구동 확인
[기타]
- 단독 이중화 구성에서 pnp_galera dbms-status 명령어 실행 시 Wrong server type 에러 발생
- 해당 이슈는 pnp_galera Rev 23이상 사용시 해결 가능함
- 관련 카페 글 및 벅스 정보 공유
> 기술본부 카페 : https://cafe.naver.com/pnpsecure2/6184
> 벅스 : https://bugs.pnpsecure.com/view.php?id=24734","윤진하: KB국민은행도 ExectueCmd 관련 내용이 필요했는데 내용 정리 고마워요~ | 이건국: ""VIP 혹은 도메인을 사용할 수 없는 환경""에서
# WEB APP(EX)Works등) 미사용
위 제약사항은 다음과 같은 이유를 들 수 있으며,
이외에도 비슷한 기능 상의 설정이라면 제약사항입니다.

1. WORKS가 도입되어야 할 경우, C/S매니저에서 보안계정 연동 설정(IP:PORT)을 해주어야 함.
2. 그러나, 갈레라 클러스터로 인해 DBSAFER의 DB간 실시간 동기화가 이뤄지기 때문에,
Active 서버에서 보안계정 연동 설정을 할 경우 Standby 서버에도 동일한 IP로 설정이 됨
3. FailOver 될 경우, Standby 서버에는 이미 Active 서버의 IP가 입력되었기 때문에 dbsafer_ldap_list <-> imup.pnp_user 간 연동이 정상적이지 않음.
4. FailOver / Recovery 될 때 마다 위의 설정을 변경해줘야 하는 번거로움이 있으므로 제약사항.

이 제약사항의 포인트는 VIP 혹은 도메인을 사용할 수 없는 환경입니다.",https://cafe.naver.com/pnpsecure2/6309
6307,[신세계] Agent Ip Group Lost IP or more 시스템 로그 발생,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
에러로그문의
[고객사/채널사]
신세계
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
매니저 Agent Ip Group Lost IP or more 시스템 로그 발생
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
IP그룹내 IP 객체가 과도하게 많을 경우 Server Agent로 IP객체 리스트를 모두 전달하지 못하는 부분과 관련있어 보입니다.(Server Agent / Server Manager 관련 제약사항)
3. 요청사항
고객사에서는 IP그룹내 IP객체가 과도하게 많을경우 정책이 정상적으로 배포되지 않을 수 있다는 점은 인지하고 있으나 해당 시스템 로그 발생 원인에 대해서 정확한 확인을 요청한 상태입니다.
IP 그룹내 IP객체가 과도하게 많을경우 Server Manager > Manager 로 해당 시스템 로그를 전달하는것인지 아니면 해당로그의 다른 발생원인이 있는 것인지 확인요청 드립니다.
현재 2개의 관리대상 서버에 대해서만 발생중이며 두서버 모두 IP그룹내 IP 객체수가 200개를 초과하여 제대로된 IP객체 리스트들을 대상서버로 전달하지 못할 수 있는 것으로는 확인하였습니다.
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
pnp_server_manager v.5.1.2.55","정현교: 현재 릴리즈 버전에서는 정책 별 IP 객체 수 제한이 254개로,
IP 그룹에 등록된 IP 수가 제한을 넘어가게 되면 Server Manager 에서 정책에 넣지 못한 IP 객체가 생깁니다.
올려주신 로그는 위 상황에서 SM 이 발생시킨 로그입니다.

IP 객체 누락을 방지하려면 IP 그룹을 나눠서 정책에 등록해야 합니다.

참고로, IP 객체 수 제한은 수정되어 있으며, 추후 릴리즈 시 반영될 예정입니다.
수정 내용 : https://bugs.pnpsecure.com/view.php?id=25470 | 하충현: 매니저 환경설정(Ctrl + Shift + F8)에서 Server Agent 사용 시 IP그룹에 대한 제한 옵션을 설정 할 수 있습니다.
지정된 byte 초과 시 알림 메시지가 나옴",https://cafe.naver.com/pnpsecure2/6307
6305,DBSCANNER 계정 비밀번호 암호화 알고리즘 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
신세계
[이슈내용]
1.확인 요청사항
고객사 요청으로 인해 DBSCANNER 웹페이지 로그인 계정 비밀번호 암호화에 사용되는 알고리즘 확인 요청드립니다.
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
PKG_DBSCANNER_v1.10.44.0_BUILD_249_20191114
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
첨부파일
PKG_DBSCANNER_v1.10.44.0_BUILD_249_20191114.tar
.gz
null
파일 다운로드","정소혜: dbsafer3.variables에 저장된 encrypt타입에 따른 암호화 방식 확인이 가능합니다.

select ifnull ((select value from dbsafer3.variables where name = 'cert_enforced_encrypt_use'),0);

[결과]
0 : 미사용 / SHA1
1 : SHA-256
2 : SHA-512",https://cafe.naver.com/pnpsecure2/6305
6289,[PACKAGE] V5-R23.05 for Rocky 8 설치 시 DBSAFER 서버 PEM KEY 로그인 방법,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
- 기타문의
[고객사/채널사]
- 내부테스트
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
- [PACKAGE] V5-R23.05 for Rocky 8 설치 시 DBSAFER 서버 OS를 PEM KEY로 로그인 불가
- PW로그인은 문제 없음
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- DBSAFER PKG 설치 시 구성되는 /usr/local/sbin/sshd (OpenSSH_9.3p2, OpenSSL 3.0.9 30 May 2023)가
Source 인스톨 과정에서 ./configure를 통한 소스파일 환경설정(with pam)을 누락한 것처럼 동작함
- usermod -p ""*"" ID를 통해 인증수단 없음에 해당한 ""!!"" 제거 시 PEM KEY 로그인 성공함
> 계정 생성 시 기본 패스워드 필드는 !!이고, 이경우 PAM인증을 사용하지 않으면 PEM Key로도 로그인 불가
> UserDATA or RC스크립트에서 usermod -p '*' 처리하고 있음(임시방편)
> UsePAM 옵션을 사용할 필요없게 만든 상황
- /var/log/message 확인 시 UsePAM 옵션을 지원하지 않음 에러 발견
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 없음
4. 사내 재현 정보
- 192.168.111.141
5. 요청사항
- [PACKAGE] V5-R23.05 for Rocky 8 설치 후 usermod -p ""*"" 명령을 사용하지 않고도
PEM KEY 로그인할 수 있는 방법 가이드 요청드립니다.
- 온프레미스는 상관없지만, 클라우드 환경의 경우 PEM KEY 인증을 더 많이 사용합니다.","김태윤: ""UsePAM yes"" 는 PEM Key 로그인 부분과 관련이 없는 다른 설정입니다.

우선 내부 테스트한 결과를 기반으로 가이드 드립니다.
root에 대해서만 PEM Key 인증이 가능하며, 사용자 계정에 대해서는 설정이 안되는 문제에 대해서 확인하였습니다.

# 설정 방법
vi /usr/local/etc/ssh./sshd_config 에서 ""PubkeyAuthentication yes"" 로 설정 후 restart 하시면 PEM Key를 사용할 수 있습니다.


# Key 생성 방법
# ssh-keygen -t rsa -b 4096 <- 명령어로 key 생성 .ssh 디렉토리에 id_rsa, id_rsa.pub 확인

# cat id_rsa.pub > authorized_keys <- authorized_keys 파일 생성


# 원격에서 접속 방법
위 key 생성 방법에서 생성한 id_rsa 파일을 이용하여 접속 가능하며, putty 를 통해서 접속할 경우 Puttygen 을 이 | 이상민: 계정을 생성한 직후 shadow file 두번째 필드를 보면 !! 로 표시됩니다. 이 경우 PAM 인증 사용하지 않으면 pem key 로그인을 할 수 없습니다.

PAM 인증을 사용하지 않으려면 shadow file의 두번째 필드를 * 로 업데이트 해주면 pem key login이 가능해집니다.


그래서 저는 /usr/local/etc/ssh/sshd_config에 UsePAM yes 옵션을 활성화하려 했으나
- pubkeyauthentication 활성화 포함

syslog(messages)에 UsePAM 옵션을 지원하지 않는다고 떠서 문의드렸습니다.

실장님께서 테스트하신 내부 환경 정보를 알려주시면
좀더 확인해볼 수 있도록 하겠습니다.",https://cafe.naver.com/pnpsecure2/6289
6288,[국방 DIDC 1센터] pnp_ssh_proxy를 통하여 접속 시 접속 불가 현상,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
국방 DIDC 1센터
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
- pnp_ssh_proxy 모듈을 통해서 접속이 안되는 현상
- Telnet Pass 로 전환하여 접속 시 정상적으로 접속
- pnp_sshd 모듈을 통해서 정상적으로 접속
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- 대상 서버의 버전이 낮음
- 대상 서버에서 aes-256-gcm 알고리즘을 사용하지 않음 (주석처리로 되어 있음)
- 통신상에 문제는 없음
hpux 정보 (대상서버)
- openssh 6.2- ssh v1,2 (ssh_config에서 확인)
- aes-256-ctr 사용 (hpux 담당자가 확인)
- aes-256-gcm은 주석처리
- openssl 0.9.8Y
dbsafer
- 서버에서 ssh로 명령어 접속 요청 시 connection closed by server 발생
- 해당 객체를 pnp_sshd 모듈로 돌리고 dbsafer통해서 접속하면 정상접속
- pnp_ssh_proxy 모듈 태워서 접속하면 접속 불가
- pnp_ssh_proxy 로그에서 프로토콜 미스매치 발생
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 없음
4. 사내 재현 정보
- 없음
5. 요청사항
- ssh 버전, openssh 버전, cipher 알고리즘의 영향이 문제인지 확인 부탁드립니다.
- pnp_ssh_proxy (rev 258) 버전에서 대상 서버로 연결시 사용하는 ciphers에 대하여 전달 부탁드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
- 사이트 특성상 반출이 불가능합니다.
- pnp_ssh_proxy 에서는 protocol mismatch 로그 확인
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
- CustomSet_Redhat8_20230726.tgz
- PKG_DBSAFER7_RelV7-R22.11-RHEL8_x86_64_20230615.tar.gz
- pnp_ssh_proxy : Rev 258 / LIBSSH VERSION INFO: 0.9.6/openssl/zlib
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
- 사이트 특성상 반출이 불가능합니다.","진선태: 참고:

> pnp_sshd / ssh 구조는 오래된 프로토콜을 지원할 수 있도록 되어 있습니다. 그러나 pnp_ssh_proxy는 오래된 프로토콜의 지원에는 한계가 있을 수도 있습니다.
> 특히 HPUX의 경우는 SSH 프로토콜이 오래된 부분이라서, 온전한 SSH Protocol 2.0이 아니라 1.0과 2.0 사이의 특성을 가지고 있서 telnet 192.168.x.x. 22 로 접속해 보면 프로토콜 버전이 1.5로 나오는 경우도 많습니다.
> 그리고 SSH Protocol 2.0을 지원하더라도 암호키 지원에서 AES-256-CTR 이하까지만 지원(최신 Cipher 지원 불가)이 되어 최신 버전의 OpenSSH는 ssh_config를 고치지 않으면 접속이 안될 수도 있습니다. (소스 코드 상으로는 AES-256-CTR 알고리즘도 내장되어있으나, privateeky_dek_header() 처리 부분에서는 AES-256-CTR의 경우는 에러 처리하도록 되어 있음)
> 따라서 위와 같 | 전준호: 안녕하세요. 진선태 부사장님.
프로젝트 1팀 전준호입니다.

고객측에는 현재 pnp_telnet_gateway 설정에서 use_pnp_sshd_service_list 설정으로 임시대응 해두었습니다.
전체 Terminal 객체에 대해서 접근이 가능한 것을 확인하였습니다.

금일 테스트 환경에서 확인 시 고객사와 동일한 현상이 발생한 환경 공유드립니다.

1. 정상 접속 가능할 때
DBSAFER : /etc/ssh/ssh_config cipher 옵션 주석처리(defaut) 설정
-> Ciphers chacha20-poly1305@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com 사용 (기본 알고리즘)
HP-UX : OpenSSH_4.5p1+sftpfilecontrol-v1.1-hpn12v14, OpenSSL 0.9.7l 28 Sep 2006 HP-UX Secure Shell | 진선태: 수고하셨습니다. 감사합니다 | 김태윤: 사이트에 설정된 sshd.config 정보와 ssh debug 정보가 있으면 도움이 될 것 같습니다.

현재 사내 HP 서버에 대해서 단순 접속 테스트 결과 정상적으로 접속되는 것을 확인하였습니다.
버전 정보는 ""OpenSSH_4.5p1+sftpfilecontrol-v1.1-hpn12v14, OpenSSL 0.9.7l 28 Sep 2006 HP-UX Secure Shell-A.04.50.021, HP-UX Secure Shell version"" 입니다.

정보 공유해 주시면 서버에 설정 후 확인해 볼수 있도록 하겠습니다.

감사합니다. | 전준호: 안녕하세요. 김태윤 실장님.
프로젝트 1팀 전준호입니다.

문의주신 정보들에 대해서는 사이트 특성상 반출이 어려워 전달이 불가능할 것으로 보여집니다.

말씀해주신 서버를 기반으로 테스트 진행하였습니다.

위에 댓글에서 공유드린 내용을 토대로 고객사 설정에 대하여 다시 한번 확인해보겠습니다.

감사합니다. | 전준호: 안녕하세요. 프로젝트 1팀 전준호입니다.

DBSAFER 서버 /etc/ssh/ssh_config 에
Ciphers 3des-cbc,aes128-cbc,aes192-cbc,aes256-cbc,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com,chacha20-poly1305@openssh.com
옵션 추가하여 해당 현상에 대하여 조치 완료하였습니다.

도움주셔서 대단히 감사합니다. | 박승민: DBSAFER-대상서버 구간의 알고리즘 설정을 위해, DBSAFER 서버의 /etc/ssh/ssh_config 설정을 통해 이슈 대응한 것으로 확인했습니다.

pnp_ssh_proxy Rev.311 이상에서는 해당 파일을 보지 않고 /usr/local/etc/ssh_proxy_config 를 참조하도록 수정되었습니다.
추후 pnp_ssh_proxy 패치 진행 전에 /usr/local/etc/ssh_proxy_config 설정에 해당 알고리즘들을 설정하는 조치가 필요합니다.",https://cafe.naver.com/pnpsecure2/6288
6284,[신세계] pnp_oms_dms.conf 의 WATCHER_USE 옵션 관련 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
신세계
[문의사항]
1. 현재 pnp_oms_dms.conf의 default 옵션에서는 WATCHER_USE = NO 인것으로 알고있습니다. 해당 설정 상태에서도 작업관리자에서 DBSAFER Assist Service 프로세스를 강제종료하면 DBSAFER Assist Watcher 프로세스가 자동으로 프로세스를 살려주도록 동작하는 것으로 보입니다.
WATCHER_USE = YES 설정시에는 위 동작과 다르게 어떤 부분에서 추가적으로 비정상종료 Assist를 자동 기동해주는지 문의드립니다.(WATCHER_USE = NO에서 YES 변경시 상세한 동작 차이점)
2. WATCHER_USE = YES 옵션이 비정상종료 DBSAFER Agent를 살려주는 옵션이라면 defualt YES로 oms_dms 모듈에 설정되어야 하는게 아닌지 문의드립니다.(현재 defualt는 NO인 것 같습니다.)
3. WATCHER_USE = YES 옵션 사용을 위해 필요한 pnp_oms_dms 최소버전, PC Assist 최소버전이 있는지 문의드립니다.
[참고 이슈]
아래 신세계 이슈에 대한 대응 방안으로 WATCHER_USE = YES 설정을 권고받아 설정에 대해 문의드리게 되었습니다.
https://bugs.pnpsecure.com/view.php?id=27220","김태윤: WATCHER_USE = YES 를 설정할 경우 PC Assist에서 설정이되며, 비정상 종료로 판단되는 경우 watcher를 통해서 재실행하는 옵션인 것으로 확인 되었습니다.

예를 들어 프로세스 kill과 같이 비정상적으로 종료한 경우에 재 실행하는 것으로 확인 되었습니다.

참고로 해당 옵션의 경우 오래전에 PC Assist가 자주 종료되는 현상으로 인해서 생성한 옵션이며, 일부 고객사에서는 필수 모듈로 지속적으로 실행해 달라는 부분으로 구현된 부분입니다.
최근에는 자주 사용되지는 않습니다.

참고하세요. | 류현수: 답변주신 사항 관련하여 추가로 문의드립니다.

WATCHER_USE=NO 설정 상태에서도 작업관리자에서 DBSAFER Agent를 '작업 끝내기'로 종료 시 자동으로 DBSAFER Agent를 재실행(자동로그인처리 포함) 하는 것으로 확인하였습니다.

WATCHER_USE=YES 상태에서는 이것 외에 추가로 어떤 case에서 비정상종료 DBSAFER Agent를 재실행하게 해주는지 문의드립니다.",https://cafe.naver.com/pnpsecure2/6284
6279,[현기차생산망] Assist RDP로깅시 한영전환 상관 없이 영문만 로깅되는 사항,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기능로직문의
[고객사/채널사]
현기차생산망
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
RDP접속 후 한영전환을 하여 한글을 입력하더라도 로깅은 영문으로 로깅됨
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
명령어 차단정책에 ""dd""라는 명령어가 포함되어 있는데 RDP 접속 후 ""ㅇㅇ""이라고 입력하더라도 차단됨
3. 특이사항 (연동 모듈, 커스텀 개발 등)
4. 사내 재현 정보
5. 요청사항
한글 로깅은 제약사항인지 확인 부탁드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","김태윤: 해당 건에 대해서 연구소 의견 확인 결과
- 입력된 값이 키 이벤트에 대한 부분으로 한글/영문 등에 대해서 구분이 불가로 한글 로깅이 안되는 것으로 확인하였습니다.
(위와 같이 한글 키를 입력하였다고 하더라도, 한글이 입력되고 있는지 여부는 알 수 없음)

해당 기능 부분의 경우 제약 사항으로 판단됩니다. 감사합니다. | 한두영: 제약사항으로 대응 완료하였습니다.
감사합니다.",https://cafe.naver.com/pnpsecure2/6279
6273,[트레블월렛] pnp_sshd 보안취약점(CVE-2023-48795) 조치 가이드 요청,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
- 기타문의
[고객사/채널사]
- 트레블월렛
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
## 고객 메일 원문 ##
안녕하세요
트래블월렛 이정섭입니다.
1분기 내부 취약점 점검을 통해서 도출된 아래 취약점에 대해서 확인 바랍니다.
=============================================
취약점명 : SSH Terrapin Prefix Truncation Weakness
CVE : CVE-2023-48795
대상 : DBSAFER 서버
서비스 포트 : TCP 4000 ~ (ssh)
=============================================
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- 과거 조재용 과장님이 OS의 기본 sshd에 대한 해당 보안취약점 조치 가이드 하였음
. https://cafe.naver.com/pnpsecure2/6191
- 그러나 이번 고객 문의는 pnp_sshd에 대한 취약점 조치 문의임
- 해당 고객사는 DBSAFER V5.0(Rocky 8)을 사용중
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- /usr/local/etc/sshd_config에 아래 설정 추가 시 pnp_sshd 구동 안 됨
Ciphers aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com
MACs umac-64@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512
4. 사내 재현 정보
- 192.168.110.201
5. 요청사항
- pnp_sshd에서 CVE-2023-48795 취약점을 제거방법(해결방안) 또는 회피할 수 있는 방법(대안) 문의","김태윤: 기본적으로 DBSAFER 서버에 설치된 OS에 대한 부분에 대한 부분은 조재용과장이 얘기한 가이드로 진행하시면 됩니다.
이 사이트의 경우 DBSAFER에 등록된 서비스에 대한 부분으로 확인하면서 진행되어야 할것 같습니다.

우선 pnp_sshd에 대한 설정은 /usr/local/etc에 있는 파일을 기반으로 동작하게 되어 있습니다.
조재용과장이 얘기한 설정 부분을 추가할 경우 pnp_sshd에서는 지원하지 않는 것으로 보여집니다.
따라서 pnp_ssh_proxy 로 변경 후 진행해 주시기 바랍니다.

이를 조치할 경우 서버에서도 해당 알고리즘을 지원해야하는 상황으로 체크 후 하나씩 진행하시기 바랍니다.
(참고로 ssh 버전이 낮은 서버의 경우 접속이 안될 수 있습니다. )

감사합니다. | 이상민: 상세한 답변 감사합니다.",https://cafe.naver.com/pnpsecure2/6273
6271,[유니투스] mssql 행걸림 현상에 대한 확인 요청드립니다.,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타 문의
[고객사/채널사]
유니투스
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크
순서
시간
작업 내용
1
09:45
H_WORKDATA_22 조회
2
09:45
조회 후, 로딩 확인 후 새 탭 추가 (로딩 현상이 반복적으로 계속 발생하여 로딩 발생 시 습관적으로 새탭으로 상세 조회 진행)
3
09:46
새 탭에서 H_WORKDATA_22 조건 추가하여 조회
4
09:46~17:10
1) 조회 구문은 계속해서 로딩 중 (취소를 해도 취소가 불가하며, 강제 종료 시까지 계속 돌아서 급한대로 방치함)
5
17:15
퇴근 시점, 행이 걸렸던 select 문이 실행되면서 비슷한 시점에 insert 배치 쿼리가 실행 됨
6
17:20
Lock 구문 조회 시, 1 쿼리 와 insert문에 의해 Lock 발생 확인
(장애보고서 상, 17:40이나 관련 로그 등 확인해봤을 때 17:20으로 추정, 서열 수신 후, 약 30분 뒤 작업이 진행되어 인지가 늦음)
- 2월 20일 09시 45분에 조회한 쿼리가 행이 걸림
- 탭을 열어 다른 작업 진행 후 퇴근시간이 되었지만 행 걸렸던 것이 풀리면서 select 쿼리 실행됨
- select 쿼리 실행 시점에 대상 DB에서 insert 배치쿼리가 돌아 일괄적으로 데이터를 인서트하는 스케줄이 있음
- 그 시점에 DB행 걸림현상 발생 (select 쿼리 와 insert문에 의해 Lock 발생 확인)
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- URL : https://cafe.naver.com/pnpsecure2/6123
cafe.naver.com
cafe.naver.com
- 위의 현상에 대하여 패치하기 이전에 발생한 현상입니다.
- 위의 사항에 대하여 대상DB에 행이 발생한 것으로 보여집니다.
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 없음
4. 사내 재현 정보
- 없음
5. 요청사항
- 대용량 데이터를 송수신하게 될 때 쿼리 수행 시 간헐적으로 행걸리는 현상에 대하여 대상 DB에 행이 걸리는 영향을 주는지 확인 필요합니다.
- 아래의 쿼리 파일 중에 대상 DB에 행을 유발하는 쿼리가 있는지 고객사측에서 확인 요청하셨습니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
- 없음
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
pnp_dbms_gateway : Rev: v2491
pnp_mssql : v2466
pnp_ora : v2466
pnp_ssl_proxy : Rev 154 / COMMON-API(UTIL) INFO: Rev.188
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
첨부파일
20240220_칵핏db 쿼리조회
.csv
null
파일 다운로드
첨부파일
장애보고서(240220_칵핏22작업생성프로그램장애)
.pptx
null
파일 다운로드","진선태: 타사이트의 중복 이슈로 패치 필요한 것 같은데요. 품질과 기술에서 대응 사이클을 좀 더 빠르게 해 주시는 것이 필요할 듯 합니다. | 전준호: 안녕하세요. 진선태 부사장님.

전달해주신 중복 이슈에 대하여 확인 후 패치 완료하였습니다.
허나 패치 이후 현상이 줄어들었다고 전달받았지만 종종 발생한다고 합니다.

현재는 고정 포트로 설정해두고 사용하고 있습니다.

이전에 현대차증권에서도 패치 이후 간헐적으로 재발하는 것으로 확인하였습니다.
박장원 책임이 이전에 방문하여 해결한 것으로 알고 있어 문의드리고자 합니다.

전달해 주셔서 감사합니다. | 진선태: 패치버전이 증상을 호전시킬 뿐 완전한 해결이 아닌 것이 확인되었군요. 적절히 대응하신 것 같습니다. 감사합니다. | 전준호: 안녕하세요. 진선태 부사장님.
프로젝트 1팀 전준호입니다.

문의 결과 전달드립니다.

pnp_dbms_gateway.conf 설정에 service_recv_timeout_usec = 500000 추가 또는 변경 하시면 됩니다.

- 기존에 0.05초에서 0.5초로 설정 변경 (service_recv_timeout_usec = 500000)
- 기존에 default 설정(0.05초)이 너무 짧아서 문제가 발생된것으로 확인

추가로 DB 서비스 모듈(ora, tibero, mssql 이외에 DB 모듈)도 같이 패치하는게 좋다고 합니다.

도움주셔서 감사합니다. | 진선태: 감사합니다.
쉬운 일이 아니기는 하지만
앞으로는 장애 대응 관련해서는 발생 당일 완료(분석 또는 해결)할 수 있으면 좋을 듯 합니다.
잘 부탁 드립니다. | 전준호: 도움주셔서 다시 한번 감사합니다.
당일 해결을 목적으로 많이 노력하도록 하겠습니다.",https://cafe.naver.com/pnpsecure2/6271
6262,7.0 매니저 프로그램에서 객체나 정책 등록 시 적용 후 보이지 않는 현상 문의드립니다.,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
LG CNS
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크)
매니저 프로그램에서 객체나 정책 등록 시 적용 후 보이지 않는 현상
> 실제 DB에는 인서트가 되나 새로고침이 정상적으로 적용되지 않는 것으로 보여짐
> 매니저 로그아웃 후 재접속 시 데이터 확인 가능
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
> 매니저 버전 2644 → 2576 다운 후에도 현상 동일
3. 특이사항 (연동 모듈, 커스텀 개발 등)
없음
4. 사내 재현 정보
사내 재현 불가
5. 요청사항
매니저 프로그램에서 객체나 정책 등록 시 적용 후 보이지 않는 현상 개선 방법 문의드립니다.
(모듈 버전, 모듈별 설정파일, 매니저 버전 외 추가로 확인해야할 사항이 있다면 확인해보도록 하겠습니다.)
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함
> 매니저 로그 첨부합니다.
첨부파일
em_log_2024_02
.txt
null
파일 다운로드
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
- pnp_log : R782
- pnp_log_bridge : R162
- pnp_agent : R1212
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
설정 값 및 현상 화면 첨부합니다.
>설정 값
pnp_log.conf
pnp_log_bridge.conf
pnp_agent
> 현상 화면
1. 정책 생성전 (정책 추가함)
2. 정책 생성후 (추가한 정책이 보이지 않음, update가 안됨)
3. DB값 확인 (DB에서는 추가한 정책 조회 가능)
4. 매니저 재기동 후 (매니저 재기동 후 추가한 정책 조회 가능)
감사합니다.",조재근: https://cafe.naver.com/pnpsecure2/6237 참고하시면 됩니다.,https://cafe.naver.com/pnpsecure2/6262
6255,pnp_connector 사용 시 실행되는 query 확인 요청드립니다.,"[분류]
기능 로직문의
[고객사/채널사]
현대오토에버
[이슈내용]
1. 증상
pnp_connector 사용 후 query가 오래 실행이 되어 CPU를 많이 사용함
2. 예상되는 원인 및 확인한 내용
* 로그 취합서버에서 실행하는 Query가 실행시간이 너무 오래 걸림
* 문제가 되는 Query가 로그 취합서버에서 실행하는 Query인지 pnp_connector에서 실행하는 Query인지
. 정확한 확인 필요
* 고객사에서 실행하는 Query인 경우 부하가 최대한 없도록 가이드가 필요
3. 특이사항 (연동 모듈, 커스텀 개발 등)
* 문제가 되는 Query
connector_select | 127.0.0.1:32856 | connector | Query | 1910 | Sending data |
select CONVERT(CONVERT(b.ldap_name USING binary) USING euckr) AS ldap_name,b.ldap_sno,a.u_index,a.c_index,a.query_bind,date_format(c_time,'%Y-%m-%d %H:%i:%s') as c_time,query_info,rtn,date_format(r_time,'%Y-%m-%d %H:%i:%s') as r_time,a.elapsed,a.r_size,a.row_size,a.policy_no,a.policy_name,a.denied,a.alert,a.loglevel
from connector.db_query_view a join connector.db_user_view b on a.u_index=b.index
where date_format(c_time,'%Y-%m-%d %H:%i:%s') > '2024-02-20 00:18:35' order by c_time limit 500
4. 사내 재현 정보
N/A
5. 요청사항
[모듈 로그(Debugging 로그 및 ERROR 로그]
* 연동 Table: db_query_view, db_user_view, shell_cmd_view, shell_user_view
> view 생성 query는 첨부파일 확인 부탁드립니다.
첨부파일
현대오토에버_CPU부하_뷰테이블정보
.txt
null
파일 다운로드
[버전 정보]
connector Release for RelR19.05C-CentOS7 (Rev 1771) Jan 21 2020
COMMON LIBRARY VERSION: 3152
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","김태윤: 해당 이슈에 대해서 확인해 볼 수 있도록 하겠습니다.

우선 order by, group by 등의 쿼리를 사용할 경우에 속도 저하가 발생되는 부분이 있으며, 관련해서 확인해 볼수 있도록 하겠습니다. | 이진욱: 쿼리의 내용으로만 봤을 경우 일단 뷰 테이블끼리 조인을 하는 부분이 성능에 큰 부하 사항으로 보입니다.

또한 ""CONVERT(CONVERT(b.ldap_name USING binary) USING euckr)"" 구문도 대량의 데이터에서는 성능 저하 사항로 판단됩니다.

view 테이블에서 가져올때 세션 테이블과 명령어 테이블을 조인 및 인코딩 변환을 하여 가져 온후

view 자체는 조인을 하지 않고 단순 Select 조회만 진행해야 성능이 나올 것으로 판단됩니다",https://cafe.naver.com/pnpsecure2/6255
6254,[공유][DBSAFER 7.0] 소켓 FD 초과 오류에 대한 로그 저장 기능 추가,"[요청사항]
- 기술지원 엔지니어가 소켓FD 초과로 인한 상황을 인지 할 수 있도록 내부 데몬로그에 FD 부족 오류에 대한 로깅 요청
[원인]
- too many open files 에러가 발생할 경우 로그 파일 open도 실패하여 로깅을 남길 수 없음
[수정사항]
- 자식프로세스(ChildProcess)에서 대신 에러로그를 남겨줄 수 있도록 수정
: 세션 연결, Trace 요청 연결 등 Too many open files 에러로 Accept 실패 시 자식프로세스에 에러메시지 전달
: 30분동안은 동일 에러가 발생하지 않음
[확인사항]
- 에러 발생 시 자식프로세스로 에러로그가 전달되어 로깅되는것을 확인
[에러 출력 예시]
- [2024-02-19 16:50:18] [639682] [MISC][INFO__000000000] Information message. : [639644][ERROR_0609099] Accept Function Error. : Failed to accept fd:7 ** Too many open files(24)
/data1/dev/dbsafer5/src/dbsafer_service_v3.0/gateway_service/tp_service/src/poller/handler/ListenEventHandler.cpp[onEvent]:59
/data1/dev/dbsafer5/src/dbsafer_service_v3.0/gateway_service/tp_service/src/process/ChildProcess.cpp[requestLoggingMsg]:563
[벅스 정보]
- https://bugs.pnpsecure.com/view.php?id=27161
[수정 버전 정보]
- 수정 데몬: pnp_tp_gateway (pnp_dbms_gateway, pnp_telnet_gateway, pnp_ftp_gateway)
- 버전: MAIN VERSION (Rev: v2576) / COMMON LIBRARY VERSION: 3900 이상에서 수정완료",댓글 없음,https://cafe.naver.com/pnpsecure2/6254
6253,[TIP] 서버에서 명령어 실행 시 -bash: fork: cannot allocate memory 에러 발생,"[이슈 내용]
- 사용자: 간헐적 서버 접속이 되지 않음
- DBSAFER 서버 접속 시 접속이 되는 경우도 있고 되지 않는 경우도 있음
- DBSAFER 서버 접속 후 명령어 실행을 하면 -bash: fork: cannot allocate memory 에러 발생
[모듈 에러로그 확인]
- 대상 모듈: pnp_sysmon
- 발생에러:
[10938] [ERROR][ERROR_0503002] File Open Error. : File(df -Pm 2>/dev/null) Open Error. - ** Cannot allocate memory(12)
[예상 가능한 발생 원인]
- 메모리 부족
> 메모리가 부족한 경우 임시로 swap file를 생성하여 활용하는 방안도 있습니다.
. fallocate -l [할당용량] /swapfile ## 예시: fallocate -l 2G /swapfile
. chmod 600 /swapfile
. mkswap /swapfile
. swapon /swapfile
. ==================================================
. wapon: /swapfile: read swap header failed: Invalid argument 에러 발생 시
. ==================================================
. dd if=/dev/zero of=/swapfile bs=[블럭사이즈] count=[블럭수]
. ##예시: dd if=/dev/zero of=/swapfile bs=1024K count=1024 - 1024K블럭을 1024개 생성(1GB의 swapfile 생성)
. mkswap /swapfile
. swapon /swapfile
. swapoff /swapfile 을 통해 회수 가능
- 시스템 상에서 열수 있는 최대 File 수 초과
> lsof를 이용해서 현재 열려있는 수량 확인
> sysctl 명령어를 이용하여 OS에서 설정되어 있는 값 확인: fs.file-max
- 시스템 상에서 생성할 수있는 최대 PID 초과
>sysctl 명령어를 이용하여 OS에서 설정되어 있는 값 확인: kernel.pid_max
[조치]
- 해당 고객사의 경우 PID가 초과 되어 kernel.pid_max 설정을 변경하여 조치 완료
> vi /etc/sysctl.conf
> kernel.pid_max=65534 추가
> sysctl -p
[참고]
- PID가 무한정으로 늘어나는 경우 모듈상의 문제가 있어서 발생할 수 있습니다.
> 이런 경우 kernel.pid_max를 늘리는 것은 임시 조치가 될 뿐이며, 결국 동일한 상황이 재발하게 됩니다.
> 해당 고객사의 경우 PID를 계속 체크한 결과 세션 증가(ssh 관련 접속이 계속 증가)를 하면서 PID가 초과 된 것으로 확인 됨
. 고객사에서 기존에 사용하던 공유폴더를 모두 SFTP 형태로 변경을 하면서 세션이 많이 증가된 것으로 확인 완료
- 생성된 프로세스가 정상적으로 잘 종료가 되는지 체크가 필요 합니다.
#","하충현: 여러가지 고려할 부분이 너무 많아 주요 내용에 대해 축약하여 작성하였습니다. pid, openfile 등에 대한 체크를 함께 해보시면 좋을 것 같습니다. 저도 모르는 부분이 많아서 많이 찾아보고 있습니다... 다들 화이팅..!",https://cafe.naver.com/pnpsecure2/6253
6244,PC Assist 최초 접속 시 발생하는 접속 팝업에 대한 문구 확인 요청,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
선거관리위원회
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
PC Assist 최초 접속 시 우측 하단에 아래와 같이 접속 팝업이 발생하게 됩니다.
해당 접속시간과 종료시간은 현재 접속한 시간이 아닌 해당 보안계정의 마지막 접속시간과 종료시간인데,
일반 사용자 입장에서 문구를 보고 오해의 소지가 있을 것 같아 문구 수정이 가능한지 확인 요청드립니다.
예시) 1월 30일 접속 이후 2월 6일 접속 시 접속 시간이 1월 30일로 나와 오해의 소지가 발생함
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
3. 특이사항 (연동 모듈, 커스텀 개발 등)
4. 사내 재현 정보
5. 요청사항",여성구: 이미 전화상으로 가이드 하였습니다. 기능 자체가 이전 최종 접속 시간을 보여주는 기능입니다.,https://cafe.naver.com/pnpsecure2/6244
6243,[선거관리위원회] ORACLE DB에서 바인드 로깅 사용 시 변수명이 'PROCEDURE' 남는 현상 확인 요청,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
선거관리위원회
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
ORACLE DB에서 바인드 변수 로깅을 위해 pnp_dbms_config.conf에서 BIND 옵션 Enable 후 DBMS서비스 재시작하여
바인드 변수 로깅을 진행하였으나 변수명이 PROCEDUER1~ 로 남는 증상
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
1) pnp_dbms_config.conf 설정 적용
2) db_qbind 로그 확인
> db_qbind에 바인드 변수명이나 PROCEDURE1~ 모두 남아있지는 않았습니다.
3. 특이사항 (연동 모듈, 커스텀 개발 등)
4. 사내 재현 정보
5. 요청사항
pnp_dbms_config.conf 설정 외에도 바인드 변수 로깅을 위한 상세 설정 방법이 있다면 확인 요청드립니다.
db_qbind쪽 로그도 확인하였으나 바인드 변수 값은 확인하지 못하였으며, bind변수가 어디에 저장되는 로직 알려주시면 확인해보도록 하겠습니다.
추가 확인 사항이 있으시다면 알려주시면 확인하도록 하겠습니다.
감사합니다.
[결과 증상 화면 / pnp_ora / pnp_log 버전 정보]","김태윤: 바인드 변수 명이 PROCEDURE1 에 대해서 확인 결과 매니저 결함 사항으로 확인되었습니다.
아래의 버전 다운로드 후 확인 부탁드립니다.

[7.0]
https://bbs.pnpsecure.com/showthread.php?tid=13367

[5.0 BETA]
https://bbs.pnpsecure.com/showthread.php?tid=12903",https://cafe.naver.com/pnpsecure2/6243
6228,[공유] DBSAFER V7.0 Galera Cluster 환경에서 pnp_connector 구성 시 발생된 이슈 공유,"안녕하세요
클라우드기술팀 손혁진입니다.
카카오페이 적용에 앞서 사내 DBSAFER V7.0 Galera Cluster 환경에서 pnp_connector 구성 테스트 진행 중 확인된 이슈 및 조치 내역을 공유드립니다.
고객사 환경
- OS : Rocky8
- DBSAFER : V7.0
- 구성 : LOG 이중화
- pnp_connector Release for RelV7-R23.05-RockyLinux (Rev 2543)
[요약]
- DBSAFER V7.0 Galera Cluster 환경에서 pnp_connector 구성을 시도했으나 실패함
- Galera Cluster 데이터 동기화 환경에서 pnp_connector 동작 방식이 적합하지 않음을 확인
- pnp_connector rev 2562 이상부터 Galera Cluster 환경에서 운용될 수 있도록 개선되었음
[첫번째 증상]
- pnp_connector LOG#1, LOG#2 양쪽에 모두 구동되어 있음에도 connector DB(TCP 3366) 접속은 한쪽 노드만 가능한 이슈(LOG#1의 connector DB 접속 시 ""Access.denied for user connector_select"" 에러 발생)
Connector DB 접속 불가
[두번째 증상]
- LOG#2의 connector DB 및 뷰테이블은 LOG#1로부터 데이터 동기화가 되나 LOG#2의 pnp_connecotor는 해당 DB/뷰테이블을 인지하지 못하는 이슈.(뷰테이블 생성 시 이미 존재하는 테이블이므로 생성 불가)
Master LOG#1 서버 뷰테이블 확인 및 생성 완료
Slave LOG#2 서버 뷰테이블 확인 및 생성 불가
[원인]
- pnp_connector는 데몬 구동 시 connector_select 계정 정보를 패스워드까지 포함하여 초기화 함
- LOG#2에서 pnp_connector 구동 시 LOG#1의 connector_select 계정에 Password 업데이트 됨
(Galera Cluster 데이터 동기화 때문)
- 결국 LOG#1 pnp_connector 메모리와 mysql.user 테이블의 connector_select Password 불일치 발생
[원인 상세 예시]
EX1) MASTER LOG#1 pnp_connector 구동 시 아래 Password가 DB 및 pnp_connector 모듈 메모리에 저장
LOG#1 mysql.user 테이블에서 확인한 Password > *00EB54BAD217AE3DCAB1440602EDFB14C271C772
Master LOG#1
EX2) Slave LOG#2 pnp_connector 구동 시 아래 Password가 DB 및 pnp_connector 모듈 메모리에 저장
LOG#2 mysql.user 테이블에서 확인한 Password > *9362C37CFBB85DA02DCC2AAC30646E7288501488
EX3) Master LOG#1 Connector DB 접속 시 Slave LOG#2 pnp_connector 구동으로 동기화 된 Password 데이터와 pnp_connector 메모리상에 가지고 있는 아래 Password가 불일치하여 접속 불가
[해결]
- Galera Cluster 환경일 경우 Master/Slave 노드 구분에 따라 connector 계정을 달리하여 운영할 수 있도록 개선 완료
. pnp_connector r2562이상 사용 필요
> Master LOG : connector_select
> Slave LOG : connector_select_slave
(변경 전) Slave LOG서버 DB 계정 리스트 (변경 후) Slave LOG서버 DB 계정 리스트
- Master, Slaver LOG 서버 Connector DB 접속 확인 완료
Master LOG#1 서버 Connector DB 접속 후 뷰테이블 확인 완료
Slave LOG#2 서버 Connector DB 접속 후 뷰테이블 확인 완료
※ 기존에 Master, Slave LOG#2 서버에 pnp_connector가 세팅 되어있는 상태에서 connector_select_slave 계정 사용 필요 시 Slave LOG#2서버에서 아래 경로의 모든 dat 파일 제거 후 모듈 재기동 필요
. 경로 : /dbsafer/.conf/.connector
/dbsafer/.conf/.connector 경로 dat 파일
- 이슈 해결 된 상세 내용은 아래와 같습니다.
. pnp_connector는 데몬 구동 시 connector_select 계정 정보를 패스워드까지 포함하여 초기화하기에 Slave LOG서버에 구동되어있는 pnp_connectorsms connector_select_slave라는 계정으로 사용
. Slave의 pnp_connector 모듈은 pnp_ha 에서 판단된 상태 값을 통해 본인이 Slave 서버라고 판단함
. Master LOG 서버는 connector_select 계정 사용, Slave LOG : connector_select_slave 계정 사용 시 아래와 같이 pnp_connector 재구동 시 Master/Slave 각 사용 계정에 맞는 패스워드 값만 업데이트
> pnp_connector 메모리에 가지고 있는 패스워드가 맞지 않아 발생 되는 문제점 해결
EX1)Master LOG 서버 pnp_connector 재구동 전 상태
Master LOG 서버 pnp_connector 재구동 전/후 mysql.user 상태
Slave LOG 서버 pnp_connector 재구동 전/후 mysql.user 상태
[기타]
- Galera Cluster 데이터 동기화 방식에 MariaDB-Backup / binlog_ignore_db 옵션을 통해 데이터 동기화에서 제외 시키는 방법도 생각해보았으나 아래의 이유로 pnp_connector의 수정이 필요하다고 판단되어 개선 진행
- MariaDB-Backup / binlog_ignore_db 옵션을 특정 스키마로 설정 시 실제 스키마/테이블은 정상적으로 생성이 되며 테이블 내 데이터만 동기화 되지 않는 부분을 확인
. Connector 및 뷰테이블 생성에 대한 동기화는 ingore 불가
- Galera Cluster 데이터 동기화로 인해 LOG#2에서 pnp_connector 구동 시 초기화 된 패스워드가 LOG#1에 업데이트 되는 부분을 방지하고자 mysql에 대한 스키마를 binlog_ignore_db 옵션로 설정 시 사이드 이펙트가 발생될 것으로 예상
- binlog_ignore_db 옵션은 스키마/ 테이블 생성에 대한 제외를 처리하지 못하기에 LOG#2의 pnp_connecotor가 LOG#1에서 생성된 DB/뷰테이블을 인지하지 못하는 이슈에 대해 처리 할 수 없는 부분 확인",댓글 없음,https://cafe.naver.com/pnpsecure2/6228
6221,CVE-2023-38545 취약점 해당 여부 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
SKOY
[문의 내용]
보안취약점 해당 여부 문의
CVE-2023-38545
: Curl 패키지의 SOCKS5 프록시 핸드셰이크에서 힙 기반 버퍼 오버플로 결함이 발견되었습니다. Curl이 주소 자체를 확인할 수 없는 경우 호스트 이름을 SOCKS5 프록시에 전달합니다. 그러나 전달할 수 있는 호스트 이름의 최대 길이는 255바이트입니다. 호스트 이름이 더 길면 Curl은 로컬 이름 확인으로 전환하고 확인된 주소를 프록시에만 전달합니다. Curl에 ""호스트가 이름을 확인하도록"" 지시하는 로컬 변수는 느린 SOCKS5 핸드셰이크 중에 잘못된 값을 얻을 수 있으며, 결과적으로 의도한 것이 아닌 확인된 주소 대신 너무 긴 호스트 이름이 대상 버퍼에 복사될 수 있습니다.
curl - SOCKS5 heap buffer overflow - CVE-2023-38545
curl / Docs / curl CVEs / SOCKS5 heap buffer overflow Related: Bug Bounty Changelog curl CVEs JSON metadata Original report Vulnerability Disclosure Vulnerabilities Table Awarded 4660 USD CVE-2023-38545 SOCKS5 heap buffer overflow Project curl Security Advisory, October 11 2023 - Permalink VULNERABI...
curl.se
[사용 버전]
PKG_DBSAFER5_RelR21.09UC-RHEL7_x86_64_20220119.tar.gz
CustomSet_for_RHEL7_20210722.tgz
COMMON_UTIL_V2.21_build-1_20210901.tgz
WEBREPORT_3.0.0.1A_71_Build-4525_20220509.tgz
상단 보안 취약점 내용에 해당되는지 문의드립니다.
감사합니다.","여성구: 답변 드립니다. 영향도 없습니다.

제품 자체적으로 curl 을 사용하지 않지만 os 에 명령어 및 라이브러리는 존재합니다. 하지만 저 취약점은 공격을 당하는 것 보다는 공격을 하는 부분에서의 취약점입니다.

예를 들어서 curl 을 통하여 쿠키를 삽입하여 특정 host 에 보안 위협을 가하는 것 입니다. 하여 본 사항을 기반으로 본사 제품에 영향이 있지는 않습니다.",https://cafe.naver.com/pnpsecure2/6221
6218,"[SK C&C] Manager에 TCP 3118, 3306 로 접근할 시 사용되는 암호화 프로토콜 및 알고리즘 취약점 관련 문의","[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
SK C&C
[고객사 측 취약점 결과 내용]
1. 취약한 암호화 프로토콜 허용 (TLS 1.0, 1.1)
2. 취약한 암호화 알고리즘 허용 (TLS_RSA_*, 3DES, MD5, SHA-1, CBC 운용모드 등)
[문의내용]
1. TLS 1.2, TLS1.3 으로 사용 가능 여부 문의
2. DSA, ECDSA 등의 안전한 암호화 알고리즘 사용 가능 여부 문의
3. 취약점 대응 방안 유무 확인 요청
상단 내용 문의 드립니다.
감사합니다.","최재규: 사용은 가능합니다. 현재는 TLS 1.0, 1.1, 1.2 중에 가장 높은 암호화 방식으로 통신을 하게 되어 있는 상태입니다.

다만 아래 이슈 사이트에서도 유사한 요청(TLS1.2로만 통신)이 있어서 커스텀 처리를 한 사항이 있습니다.
현재 상황에서는 문의주신 사이트의 경우에도 마찬가지로 커스텀으로 조율해야 할 것으로 예상됩니다. 벅스 등록 부탁드립니다.
https://bugs.pnpsecure.com/view.php?id=16622",https://cafe.naver.com/pnpsecure2/6218
6214,[한국교육시설안전원] Jenkins 의 ssh 기능으로 배포 및 수행 작업 시 pending 현상 발생 관련 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타 문의
[고객사/채널사]
한국교육시설안전원
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크)
- Jenkins 에서 빌드 후 배포(ftp) 수행 시 일부 작업 진행 후 pending 현상 발생
> 수행 방식
: 1) 이클립스에서 업로드
2) 로컬 PC 에서 tomcat 수행하여 jenkins (WAS) 서버 가동
3) 자동 빌드 수행
(압축된 파일을 Jenkins ssh 로 대상 서버에 업로드한 후 대상 서버에서 압축을 푸는 스크립트 수행)
- DBSAFER SFTP 로그 확인 시, 일부 로그 확인됨
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- 내부 테스트 수행 시, git 연동을 통한 일반 파일 자동 배포는 정상적으로 수행되는 것 확인함으로써 jenkins가 제공 안 된다는 가정은 제외된 상황
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 없음
4. 사내 재현 정보
- 재현 시도 중
5. 요청사항
- Jenkins 의 ssh 기능으로 배포 및 수행 작업을 DBSAFER 통해서 지원이 가능한지 여부 확인 부탁드립니다.
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
- PKG_DBSAFER7_RelV7-R23.05-RockyLinux_x86_64_20230908.tar.gz
- pnp_ssh_proxy
SSH_PROXY Release (Rev 297) Nov 17 2023 09:29:52s
( SHARED INTERFACE VERSION INFO: Rev.575 )
( COMMON-API(UTIL) INFO: Rev.191 )
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
- jenkins 수행하는 PC 의 와이어샤크
https://bigfile.mail.naver.com/download?fid=Ufecb9emWNgjK3eOb4JmKxuqaxtZKxMjKogZFAgwKx2wFAEmKoEjKxbmaAu/Kxvla3eSMoM9aAJCazulax+CMxtwpoulF4ivM6KlpoE/F63Spt==
- 자동 빌드 작업 수행 시 tcpdump 수행 내역
https://bigfile.mail.naver.com/download?fid=Ufecb9emWNgjK3eOb4JmKxudKAuZFoujKogZFAgwKx2wFAEqKA2jKxbmaAu/Kxvla3eoKz3oFxMZM6t9Krk0ax0op4kSpoMra6koa6t/KA29K2==
- 배포 성공 시 jenkins 콘솔 로그
- 배포 실패 시 jenkins 콘솔 로그
첨부파일
[교육시설안전원]jenkin 콘솔 (실패)
.txt
null
파일 다운로드
- jenkins 설정 내용
첨부파일
[한국교육시설안전원] jenkins 설정
.zip
null
파일 다운로드","여성구: 이슈로 판단됩니다. bugs 에 등록해주세요. | 김태윤: 해당 이슈에 대해서 추가 정보 요청 합니다.

Jekins에서 타겟 서버로 파일 업로드시에 사용하는 프로토콜 확인 부탁합니다.
FTP, SFTP, SCP 를 사용하는지 정확한 확인 바랍니다.

또한 어떤 동작에서 문제가 되는지에 대해서는 명확하지 않는데요, 조금 더 명확한 정보 올려 주기 바랍니다.

현재 SSH를 통해서 SCP, ssh execute command 에 대해서는 지원하지 않습니다. | 여성구: jenkins 의 배포 관련 연결 부분으로 생각됩니다. 아래 설정 부분을 첨부합니다.
배포 방법은 하나가 아닙니다. 아래도 하나의 케이스입니다. 다른 방식일 수도 있습니다. | 이상민: 고객사 환경은 ssh reomote host 설정을 하고 있음을 제한된 캡쳐로 확인한 상태입니다.

(추정) PublishOverSSH 플러그인이 아닌 SSH 플러그인을 사용하고 execute shell에 스크립트를 기재하여 업로드 할 것으로 추정하고 있습니다.

1월 29일에 고객사를 직접 방문하여 어떤 플러그인을 쓰는지 어떤 프로토콜을 사용하는지 상세 설정을 확인하겠습니다. | 박소현: 고객사는 jenkins 배포 관련 연결 부분을 publish over ssh와 ssh를 함께 사용하고 있는 것으로 확인됐습니다.
해당 플러그인 관련하여 구글링 검색 시, scp 프로토콜을 기반으로 동작되는 것으로 확인되었고 고객 측에 지원 불가로 고지한 상태입니다.

상세 설정 내용은 본문 내에 추가 첨부하겠습니다.

감사합니다.",https://cafe.naver.com/pnpsecure2/6214
6207,[파르나스호텔] 통신 구간 변경에 따른 DBSAFER Agent 로그아웃 현상 관련 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
파르나스호텔
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
고객사에서 AWS 통신구간 변경 작업 후 사용자가 로그인후 dbsafer로 전달하는 패킷이 n초 간격으로 경로를 다르게하여 전송하고 있습니다.
경로1.
사용자(삼성동) > TGW2 > AZ1 방화벽 FW1(x.x.x.152) > TGW1 > VMware cloud on AWS내에 존재하는 DBSAFER
경로2.
사용자(삼성동) > TGW2 > AZ2 방화벽 FW2(x.x.x.137) > TGW1 > VMware cloud on AWS내에 존재하는 DBSAFER
Agent로그인후 경로1로 패킷전달중이다가 몇초뒤 패킷전달 경로가 경로2로 변경되어 OMSDMS에서 인식하는 사용자 IP가 x.x.x.152에서 x.x.x.137로 변동될때 Agent를 로그아웃 시키는 것 같습니다.(매니저 보안계정에는 x.x.x.x(사설:x.x.x.x) 형태로 기록됨)
n초 정도의 간격으로 통신구간이 경로2에서 경로1로 변경되기도 하고 경로1에서 경로2로 변경되고 있습니다.
로그아웃시 팝업
Agent 로그아웃 로그
OMS DMS 로그상 연결중인 IP가 AZ1 FW(152)에서 AZ2 FW(137)로 변경
모든 사용자가 통신구간 변경 작업이 진행된 이후 DBSAFER Agent 로그인 진행시 n초마다 agent가 로그아웃되고 있는데
이런 환경에서 agent가 로그아웃되지 않게 설정할 수 있는 부분이 있는지 확인이 필요합니다.
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
Agent로그인후 경로1로 패킷전달중이다가 몇초뒤 패킷전달 경로가 경로2로 변경되어 OMSDMS에서 인식하는 사용자 IP가 x.x.x.152에서 x.x.x.137로 변동될때 Agent를 로그아웃 시키는 것 같습니다.(매니저 보안계정에는 x.x.x.x(사설:x.x.x.x) 형태로 기록됨)
AZ 내 FW 방화벽은 포티넷 방화벽으로 확인
OMS_DMS의 DENY_CHANGED_IP = NO 적용하여도 현상 동일하며 아래 옵션들 변경으로 테스트 하여도 현상이 동일하였습니다.
# 이중 로그인 사용 유무를 설정
OVERLAP_LOGIN = YES
# 다른 PC에서 접속 허용 유무를 설정
AUTH_LOGIN = YES
# 중복 로그인 시, 기존 사용자 및 신규 사용자를 로그아웃 상태로 설정.
AUTH_DOUBLE_ACCESS_DENY = NO
3. 특이사항 (연동 모듈, 커스텀 개발 등)
기존에는 AZ1, AZ2 를 통한 통신분배 형식이 아니었다가 고객사에서 통신분배 적용을 진행하면서 부터 사용자 로그아웃 현상 발생중입니다.
우회접근제어를 주로 사용하고 DBSAFER Agent를 통한 사용자 연결은 사용량이 거의 없는 편이나 모든 사용자에서 발생하는 증상이어 빠른 확인이 필요합니다.
기존에는 사용자 PC IP가 Manager 보안계정 로그인 IP에 기록되었으나 통신구간 변경 작업 후 모든 사용자의 로그인 IP가 x.x.x.152(사설:x.x.x.x) 또는 x.x.x.137(사설:x.x.x.x) 형태로 기록되고 있습니다.
4. 사내 재현 정보
동일한 AWS 환경 구현이 어려워 진행하지 못하였으나
사내에서 사용자 PC IP를 단순히 교체하였을때는 로그아웃 되지 않는 것으로 확인하였습니다.
로그내용상으로는 고객사의 DBSAFER와 연결하는 실제 장비가 AZ FW1에서 AZ FW2로 변경됨에 따라 로그아웃 발생하는 것으로 추정됩니다.
5. 요청사항
로그인후 n초마다 agent가 로그아웃되고 있는데 상위 환경에서 agent가 로그아웃되지 않게 설정할 수 있는 부분이 있는지 확인이 필요합니다.
지원 불가한 환경일 경우 고객사에서 정확한 지원 불가 사유에 대한 소명을 요청하였습니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
파일 첨부하였습니다.
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
[root@dbsafer dbsafer]# ./pnp_oms_dms
pnp_oms_dms Release RelR22.05C-CentOS7 (Rev 970) Jun 29 2022 14:36:10s
pcagent 3.2.36.1
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
고객사명 : 파르나스호텔
첨부파일
omsdmslog
.zip
null
파일 다운로드
첨부파일
DBSAFER AGENT log
.zip
null
파일 다운로드","여성구: 현 상황은 Client 에서 IP 가 바뀌는 것이 아닌 경로 전환의 문제입니다. DENY_CHANGED_IP 옵션은 pc assist 가 ip 변경 인지 시에 re-login 하는 것이라서 본 문제와 영향이 없습니다.

멀티 로그인으로 테스트를 해볼 수 있을 까요. ""multi_agent_login.conf"" 이것을 .conf 하위 생성 후 동작 체크를 부탁드립니다.
re-login 처리가 되는지 확인을 해야 합니다.

일반적 환경에서 경로가 바뀌는 경우 로그아웃이 맞습니다. | 류현수: multi login 적용후에도 현상 동일하여 연구소 추가 검토 예정입니다. | 류현수: 연구소 검토 결과 AZ1, AZ2 통신구간 변동 환경에서는 2W~4W 가량 소요되는 추가 개발이 필요한 것으로 확인되어 고객사에 전달하였으나 고객사 측에서 개발 진행을 원치 않았으며 고객사 자체적으로 AZ1, AZ2 영역중 하나의 AZ 영역만 사용하는 것으로 AWS 구성을 변경하였습니다.
이후 통신구간 변동 없이 DBSAFER Agent가 정상 사용되는 것으로 확인하였습니다.",https://cafe.naver.com/pnpsecure2/6207
6205,DBSAFER 접속 차단 방식 상세 로직에 대한 문의 건,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기능로직문의
[고객사/채널사]
카카오뱅크
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
3. 특이사항 (연동 모듈, 커스텀 개발 등)
4. 사내 재현 정보
5. 요청사항
- '사용자 <> DBSAFER <> 대상 DB' 차단 로직, 변경 가능여부, 변경 불가 시 불가한 로직에 대해서 궁금해 합니다.
> 사용자가 DBSAFER 접속 차단 정책에 의해 차단 될 경우 DBSAFER GW 에서 대상 DB로 패킷을 보낸 뒤
DBSAFER GW 서버에서 사용자, DB 에 RST 패킷을 보내는 로직으로 동작 한다고 알고 있습니다.
> 고객사 카카오뱅크에서는 접속 정책 차단의 경우 대상 DB 서버에 패킷을 안보내게 변경이 가능하냐고 물어봅니다.
> 추가적으로, 로직으로 인해 변경이 불가하다면 불가한 사유와 로직에 대해서 상세하게 알고 싶다고 합니다.
++ 추가 문의 등록 내용
- 추가 문의 사항
> 고객사에서 대상 DB 로그 파일( ex, 리스너 로그 등)에 DBSAFER 에서 차단 동작 임에도 불구하고 패킷이 넘어가 로그가 찍히는 것을 원치 않는다고 합니다. (사내에서 테스트 한 사진 첨부 드립니다.)
> 해당 대상서버에 로그가 찍히는 이유가 패킷이 넘어가서 인 것으로 보입니다.
: 그렇다면 답변 주신것과 동일하게 DBSAFER 쪽에서 접속계정, APP명 을 확인하기 위해서는 어쩔 수 없이 접속 정보가 담긴 패킷을 대상서버 까지 보내야 하는 것으로 이해하면 되는지 궁금합니다 !
위 내용 확인해주시면 감사하겠습니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","김태윤: 접속 차단의 경우 여러 경우의 수가 있는데요,
접속 계정, Application 명, 보안 계정, IP 등에 따라서 달라질 수 있습니다.
이중 접속 계정, Application 명에 대해서 확인하기 위해서는 PC-DB 간 접속이 완료 후 패킷에 정보를 전달하게 됩니다.
따라서 해당 부분에 대해서는 접속 차체를 차단하는 것은 불가합니다.
다만, 보안 계정, IP 등에 대한 정책만 있는 경우에 대해서는 DB로 접속 패킷을 전달하기 전에 접속 차단 하는 것으로 알고 있습니다.
참고하시기 바랍니다. | 이창제: 안녕하세요. 김태윤 실장님.
빠른 확인 감사 드립니다.

추가적으로 한 가지 더 문의 사항이 있어 본문에 추가 하겠습니다 ! | 김태윤: 추가적인 질문 사항에 대한 회신입니다.

기본적으로 위에서 얘기한 보안계정, IP에 대해서 제외한 다른 조건의 경우에는 필요한 정보를 모두 수집할때까지는 관련 패킷에 대해서 DB서버에 전송하게 되어있습니다.

예를 들면 첫번째 쿼리가 수행 할때까지 필요한 정보를 수집할 수 있고, 수집된 정보를 가지고, 정책과 비교하여 차단 동작을 수행한다고 보면 될것 같습니다.
또한 첫 번째 쿼리는 DBSAFER 에서 차단으로 판단되면 DB에 전송하지 않고, 세션을 종료 처리하여 차단하게 되어 있습니다.

참고하였으면 합니다. | 이창제: 확인 감사드립니다 ! 😃 | 정우성: 아래 작성된 게시글 업무에 참고 부탁드립니다.
https://cafe.naver.com/pnpsecure2/5361",https://cafe.naver.com/pnpsecure2/6205
6204,[TIP] pnp_custom_policy 모듈 정책정보(그룹) 공유메모리 이슈 공유,"[이슈 내용]
- 설명 : 정책정보(서비스 그룹)에 대한 공유메모리 참조 오류 발생.
- 원인 : 정책정보(그룹)에 대한 공유메모리 입력 시, 객체정보에 대한 입력길이(64KB)가 제한됨
- 영향도 : 모듈 에러 로그가 지속적으로 생성됨에 따라 Disk Full 문제가 발생할 수 있음.
[패치 대상]
- pnp_custom_policy 모듈 Rev.391 ~ Rev.569 사용 + DBSAFER 그룹 정보 사용
[패치 권고 버전]
- 2024-01-10 Rev.570 버전 이상 사용
[관련 이슈]
- [BT:26937] : 정책정보(서비스 그룹)에 대한 공유메모리 참조 오류 사항 개선","강정근: 해당 이슈에 해당하는 연동정책검사모듈(pnp_custom_policy) 을 사용하는 고객사 담당자분 대상으로, 패치 알림 메일 보내드렸습니다.
(메일 수신하지 않은 분은 무시하셔도 됩니다.)",https://cafe.naver.com/pnpsecure2/6204
6194,[TIP] Oracle CI(주석인식옵션) 모듈 사내 테스트 환경 및 사용 방법 가이드 공유,"[요약]
- CI(주석인식옵션) 옵션이 포함된 서비스 모듈 빌드 후 사내 테스트 방법 공유
(* https://cafe.naver.com/pnpsecure2/6016 에서는 dbeaver를 통한 mysql CI 모듈 주석인식옵션 테스트 방법 확인 가능)
- Oracle CI 모듈은 MySQL CI 모듈과 다르게 Dbeaver에서 테스트가 불가하여 테스트 코드 작성 후 코드 실행
[버전정보]
- visual studio code
- nodejs : ver 20.11.0
- Oracle : 19C
[상세내역]
- 사내테스트 진행 내역
1) 본인 PC 에서 '원격 테스크톱' 이용하여 '192.168.103.222' 서버 접속
- 계정정보
> ID/PWD : Administrator/Dbsafer00)) or dbsafer00 or dbsafer00))
2) CI 모듈 테스트를 진행할 서버로 PC ASSIST 접속
3) Visual Studio Code 실행 및 프로젝트 폴더 열기
- 'File' > 'Open Folder' > '바탕화면' > 'oracle_CI_테스트' > '폴더 선택'
4) Visual Studio Code Terminal 열기 및 코드 실행
- 'Terminal' > 'New Terminal' > 터미널에서 'node ./dbConn.js' 수행 > 'Oracle DB 연결 성공' 문구 확인
> DBSAFER MANAGER 로그 조회 시 정상 로깅 확인
5) 원하는 주석으로 변경 방법
- 'dbConn.js 파일 더블클릭' > 코드 내 'sql' 부분 주석 확인 > 원하는 주석으로 변경 및 저장(Ctrl + s)
> 터미널에서 'node ./dbConn.js' 수행 > 'Oracle DB 연결 성공' 문구 확인 > 매니저 로그 확인
이상입니다.
감사합니다.
* 수정이 필요한 부분이나 개선사항이 있다면 댓글로 남겨주시면 감사하겠습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6194
6175,remotecon 자격증명에 컴퓨터명이 자동으로 붙는 이슈 확인 요청,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기능문의
[고객사/채널사]
현대건설
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
remotecon 접속시 자격 증명에 자동으로 컴퓨터명이 추가되는 이슈
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
mstsc의 경우 이전 접속 자격증명만 자동으로 불러옴
remotecon의 경우 이전 접속 자격증명에 현재 컴퓨터명을 계속 이어 붙임
3. 특이사항 (연동 모듈, 커스텀 개발 등)
4. 사내 재현 정보
192.168.112.21~192.168.112.24
5. 요청사항
자격증명에 불필요 정보를 붙이지 않도록 요청
고객사에서 원하는 것은 자동으로 ""호스트명\아이디"" 이렇게 입력해주는 것을 원하나
이전 자격증명을 저장하는 정도로 협의하고자 함
설정이 잘못된게 아닌 개선이 필요한 사항으로 확인되면 벅스로 등록하여 개선요청 예정
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
PC Assist 버전 : 3.3.1.8
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","여성구: @이건국 사원님 본 사항 기능으로 알고 있습니다. 옵션인지는 모르겠습니다. DC, AD 구성에서 서버 자체 계정으로 로그인을 할 때 hostname 이 붙는 것으로 알고 있습니다. 체크 부탁드립니다. | 여성구: @한두영 대리님 빨강색으로 강조하지 않아도 이해 됩니다. | 이건국: IM과 무관하게, PC Assist에서 RDP 서비스 대상으로 접속 시도 시 remotecon을 실행시키는데,
이 때 항상 hostname이 붙는것을 확인하였습니다.
(접속계정을 클릭 및 IM API를 호출하여 자동접속을 하는 것이 아닌, PC Assist 자체의 AM 기능 사용 시 발생)
버그로 판단되며, 해당 사항에 대해 벅스로 등록 부탁드립니다. | 한두영: 벅스 등록 완료하였습니다.
https://bugs.pnpsecure.com/view.php?id=26888",https://cafe.naver.com/pnpsecure2/6175
6169,사내 교육을 위한 pnp_ha 동작 및 권장 설정값 문의 드립니다.,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
내부 교육
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
- 관련 없음
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- 관련 없음
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 관련 없음
4. 사내 재현 정보
- 관련 없음
5. 요청사항
- pnp_ha모듈에서 checker 의미
- pnp_ha모듈 설정시 QA실에서 권장하는 옵션
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","최재규: Checker는 pnp_ha모듈에서 모니터링하는 서비스를 설정할 때 사용하는 실행파일을 의미합니다.
checker 모듈은 /dbsafer/.conf/pnp_ha.services/ 디렉토리 하단에 위치하고 있으며, 설정파일에서 지정한 파라미터 값을 통해 실행합니다.

Checker 모듈 종류는 아래와 같습니다.
-IPAddr : 서버 상태에 따라 VIP를 활성화하거나 해제한다.
-MariaDB : MariaDB의 상태를 체크한다.
-Disk : 디스크 상태를 체크한다.
-Process : 프로세스 가동여부를 체크한다.
-Ping : 통신 상태를 체크한다.
-PnpWeb : 웹서비스 동작을 체크한다.
-RESTCall : 웹에서 감시 서비스를 수행할 수 있도록 중계한다.
-ExecuteCmd : 모드가 변경이 될 때 실행 시킬 명령어
-Port : L4 의 health check 용 바인드 포트


QA에서 권장하는 옵션은 아래와 같이 설정파일과 함께 배포된 값이며, 사이트 환경에 따라 | 강현구: DataDisk : default path는 /home이고, threshold는 90%",https://cafe.naver.com/pnpsecure2/6169
6158,[TIP] OS 파라미터 변경 레퍼런스 공유,"DBSAFER가 설치된 redhat7 서버에 대해 고객사 요청으로 진행한 OS 파라미터 변경 내용 공유드립니다.
1. 파라미터 변경 방법(재부팅 시 초기화됨)
설정 내용
기존값
고객사 권고값
echo 3000 > /proc/sys/net/core/somaxconn
128
3000
echo 30 > /proc/sys/net/ipv4/tcp_fin_timeout
60
30
echo 15 > /proc/sys/net/ipv4/tcp_keepalive_intvl
75
15
echo 5 > /proc/sys/net/ipv4/tcp_keepalive_probes
9
5
echo 10 > /proc/sys/net/ipv4/tcp_keepalive_time
7200
1200
* 파라미터 별 의미
/proc/sys/net/core/somaxconn : listen()으로 바인딩 된 서버 소켓에서 accept()를 기다리는 소켓의 최대 개수
/proc/sys/net/ipv4/tcp_fin_timeout : tcp 세션 종료후 얼마동안(초) 세션 연결을 유지하고 있을지에 대한 설정값
/proc/sys/net/ipv4/tcp_keepalive_intvl : keepalive 세그먼트를 보내고 다시 확인 하기 위한 시간으로 처음에 keepalive 를 보내고 미응답시 다음 keepalive 보낼 시간
/proc/sys/net/ipv4/tcp_keepalive_probes : tcp_keepalive_time 에 의하여 보낸 keepalive 세그먼트를 보낼 횟수
/proc/sys/net/ipv4/tcp_keepalive_time : 패킷이 지나지 않아도 TCP 커넥션을 유지하는 시간(초)
2. 재부팅 시에도 설정값이 유지되도록 설정하는 방법
# vi /etc/sysctl.conf 명령을 통해 파일을 열고 아래 내용을 파일에 기록
net.core.somaxconn = 3000
net.ipv4.tcp_fin_timeout = 30
net.ipv4.tcp_keepalive_intvl = 15
net.ipv4.tcp_keepalive_probes = 5
net.ipv4.tcp_keepalive_time = 1200",댓글 없음,https://cafe.naver.com/pnpsecure2/6158
6156,"PC Agent에서 ""[PC IP]에서 신규 사용중에 있으므로 프로그램을 종료합니다."" 메시지 발생하는 현상 문의","[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기능로직문의
[고객사/채널사]
오스템임플란트
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
고객사 내 특정 사용자 PC에서 PC Agent 실행 중 불규칙적인 간격으로 ""[PC IP]에서 신규 사용중에 있으므로 프로그램을 종료합니다."" 에러메시지가 발생하며 Agent가 종료됨
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
업무 중에 사용자 PC 시간이 변경되거나, 해당 현상 전후로 VPN 접속 등 PC IP 변경 동작이 있는지 확인하였으나 없다고 답변받았습니다.
3. 특이사항 (연동 모듈, 커스텀 개발 등)
인증관련 커스텀 적용사항 X.
계정관리 적용 사이트로 사용자 PC에 Assst Host 5.0.15.66버전 함께 설치되어있습니다.
4. 사내 재현 정보
고객사 DBSAFER 서버에 언제든지 VPN으로 접속 가능합니다.
5. 요청사항
PC Agent 로그상으로 ""IP 변경 감지"" 및 ""Route 변경 감지"" 로그가 더러 보이긴 하나, 에러메시지 발생 전후로는 보이지 않습니다.
위 에러 메시지가 발생하는 원인과, 조치방안 문의드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
PKG : PKG_DBSAFER5_RelR23.05-RockyLinux_x86_64_20230908
PC Agent : 3.2.36.1
pnp_oms_dms : (Ver.2 / Rev.1073)
DBSAFER IM : 1.5.5.89-a
ASSIST-HOST : 5.0.15.66
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
첨부파일
[오스템임플란트]_22031224_PC Agent 로그
.txt
null
파일 다운로드","여성구: 아래의 옵션을 NO 로 변경 이후에 상태 체크를 부탁드립니다. 확인해 보면 route 값이 변경되는 것 같습니다. 그로 인한 접속 경로의 변화가 영향을 주고 있습니다.

# 사용자의 IP가 변경되었을 경우 PC-AGENT가 연결상태를 해제할지 설정
# Example : YES, NO
# Default : NO
DENY_CHANGED_IP = NO",https://cafe.naver.com/pnpsecure2/6156
6154,Windows Server Agent 설치시 환경설정 창 공백 에러 출력현상 확인 요청,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
- 에러로그문의
[고객사/채널사]
- 롯데월드
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
- Windows Server Agent 설치시 환경설정 창 공백 에러 출력현상 확인 요청
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- Server Agent를 통한 Win10pcap 설치가 아닌, 기존에 설치되어있는 Win10pcap 환경에 Server Agent 설치시 발생
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- compatible 모드로 설치 진행
4. 사내 재현 정보
- 사내재현 불가
5. 요청사항
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
- server_manager : v5.1.8.4
- server_agent : v5.1.8.18
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","정현교: SA Windows 는 win10pcap 을 지원하고 있지 않습니다.
win10pcap 삭제 후 winpcap 4.1.3 으로 설치하여 사용해주세요.",https://cafe.naver.com/pnpsecure2/6154
6151,Server Agent for windows 5.1.6.7 무한 재가동 이슈 확인 요청,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
덤프파일 분석 문의
[고객사/채널사]
삼성물산패션
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
Server Agent for windows 5.1.6.7 설치이후 service가동시 죽었다 살아났다가 반복함
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
첨부한 덤프파일 분석 요청
3. 특이사항 (연동 모듈, 커스텀 개발 등)
대상 OS : windows2022 server
4. 사내 재현 정보
5. 요청사항
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
Server Agent for windows : 5.1.6.7
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
Service 덤프파일
첨부파일
20231215-151417
.dmp
null
파일 다운로드
첨부파일
20231215-151418
.dmp
null
파일 다운로드
첨부파일
20231215-151419
.dmp
null
파일 다운로드
첨부파일
20231215-151420
.dmp
null
파일 다운로드
첨부파일
20231215-151421
.dmp
null
파일 다운로드","여성구: FAQ 사항이 아닙니다. bugs 에 등록해주세요. | 한두영: 동일 벅스 내용 확인하여 조치 완료하였습니다.
내용 공유주신 이창제 대리님 감사드립니다.
https://bugs.pnpsecure.com/view.php?id=26620",https://cafe.naver.com/pnpsecure2/6151
6150,[오스템임플란트] Terminal 일반접속 로그가 간헐적으로 기록되지 않는 현상 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
에러로그문의
[고객사/채널사]
오스템임플란트
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
Terminal 일반접속로그가 간헐적으로 기록되지 않는 현상 발생
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
서비스 재기동, 서비스 테이블 이상유무 확인, pnp_telnet, pnp_log, pnp_log_bridge, pnp_ssh_proxy, pnp_agent 모듈 이상유무 확인
3. 특이사항 (연동 모듈, 커스텀 개발 등)
-
4. 사내 재현 정보
사내 재현정보는 없으나 원격으로 고객사 환경 언제든 접속 가능합니다.
5. 요청사항
위 현상에 대한 원인분석 및 해결방안 요청드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
1. 미로깅 현상이 발생하는 경우 서버 접속과 동시에 pnp_telnet 모듈로그에 아래와 같이 기록되며, 동일한 로그가 2~5줄 불규칙적으로 기록됩니다.
[2023-12-14 14:51:38] [16085] [FATAL][FATAL_9999099] Fatal Error - Abnormal status or data processing. : Index:1 Socket:-1
2. 위 로그가 기록될 때 간헐적으로 pnp_log_bridge 모듈 로그에 아래와 같이 기록됩니다.
[2023-12-14 14:51:40] [1223] [MISC][INFO__000000000] Information message. : Connect to MAIN LOGGER.. [127.0.0.1:3124]
3. 매니저 서비스 모니터링 화면에서 세션 모니터링에는 미로깅 세션이 표시되지 않으나 실시간 명령어 모니터링에는 해당 세션을 통해 수행하는 명령어가 표시되며 서비스 객체 부분에 ""미지정 서비스""로 표시됩니다.
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
OS : Rocky Linux 8.7
PKG : DBSAFER5_RelR23.05-RockyLinux_x86_64_20230908
pnp_log_bridge : Rev 161 -> Rev 162로 패치하였으나 동일 현상 발생합니다.
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
추가적으로 필요하신 정보 있으시면 요청 부탁드리겠습니다.
항상 감사합니다.",여성구: 본 사항은 FAQ 가 아닙니다. bugs 로 등록해주세요.,https://cafe.naver.com/pnpsecure2/6150
6148,"[모니투스, 유트라스] Failover 및 정상화 시 VIP전환이 안되는 현상","[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
모트라스, 유니투스
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
- Failover나 정상화 동작 시 VIP가 올라오지 않는 현상
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- pnp_ha 모듈에서 VIP를 정상적으로 넘기는지 확인 필요
- ip addr VIP dev 추가 시 정상 통신 확인
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- DHCP로 리얼 IP가 잡혀져 있지만 고정IP로 셋팅
- VIP는 Static으로 고정
4. 사내 재현 정보
- 없음
5. 요청사항
- 해당 현상에 대해서 모듈 수정이 필요한 것인지 네트워크 셋팅 설정의 문제인지 확인 부탁드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
오른쪽 스탠드바이서버에서 정상화 시 Active에 VIP가 올라오지 않음
통신 시 통신 안됨
정상화 동작 후 10분이 지나고 ip addr VIP /dev/ 추가
이후 VIP 통신 상태 정상
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
- OS 정보
Rocky Linux 8.7
- PKG 정보
PKG_DBSAFER7_RelV7-R23.05-RockyLinux_x86_64_20231121.tar.gz
- ha 버전
PNP_HA v1.2.21 [Aug 22 2023]
SHARED LIBRATY VERSION : 565
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","여성구: pnp_ha 모듈에서 이중화 시 VIP 관리는 아래의 명령어를 사용 합니다.

- VIP 추가 명령어 : ip addr add {IP}/24 dev {디바이스}
- VIP 등록 명령어 : arping -A -w 1 -I {디바이스} {IP}
- VIP 삭제 명령어 : ip addr del {IP} dev {디바이스}

보통 VIP 전환이 안되는 경우 VIP 등록이 문제입니다. 등록은 route 에 VIP 를 나에게 전환해 달라는 시그널 전송입니다.
그런데 전환 이전 기존 디바이스에서 VIP 삭제가 네트워크 단에서 이루어 지지 않았을 경우 already use 로 처리가 됩니다.

확인 시에 VIP등록이 지연되는 것 같습니다.
pnp_ha 에서 Active 에서 vip 삭제가 다 이루어 지기 이전에 standby 에서 vip 등록이 처리 되는 것 같습니다.

이슈 원인 파악 이 후 원인이 맞다면 pnp_ha 에 전환 딜레이 기능을 추가해야 할 것 같습니다.",https://cafe.naver.com/pnpsecure2/6148
6147,[신세계] pnp_log 데몬 'Wrong Fparam ID' 에러로그 발생 원인 확인요청,"[분류]
에러로그문의
[고객사/채널사]
신세계
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크)
- 2023/12/14 서버접근제어 pnp_log데몬에서 아래와 같은 에러로그 발생
[2023-12-14 06:23:44] [9873] [ERROR][ERROR_0499003] Wrong Fparam ID. : [3627124]
src/dbutil/db_logquery.cpp[dbutil_exec_query]:333
고객사에서 에러로그 발생원인 확인을 요청함
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- log서버의 pnp_agent, gw서버의 pnp_log_bridge 등에는 해당시점에 관련한 로그 없음
- pnp_log 데몬 에러도 14일 일자에는 상단에 작성한 2줄 로그 외에 아무것도없음
- 해당시점에 에러로그 발생 서버 관련 작업 없음
- 기능 동작상 큰 이상은 없어보임
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 기존 운영간에 발생된 적 없는 에러로그이며 14일 06시경에 1회만 발생 이후 아직까지 미발생중인 에러로그
- Server Agent, DBSAFEROS 병행 운영중인 서버접근제어 서버
4. 사내 재현 정보
- 재현불가
5. 요청사항
- 해당 에러로그 발생원인 확인을 요청드립니다.
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
- DBSAFER5, Redhat7, mysql 5.7.29
- LOG 서버
[root@scsic-ifac-log dbsafer]# ./pnp_log
LOG Release Version 3.0 for RelR19.05C-RHEL7 SE(Rev635) [Sep 18 2019] !!
SHARED INTERFACE VERSION: 378
MAIN 3.7(20150812),AGENT:103,DBMS:107,FTP:106,TELNET:107,SQLPARSER:1.3.3072
- GW 서버
[root@scsic-ifac-gw1 dbsafer]# ./pnp_log_bridge
LOG BRIDGE Release Version 3.1.3 for RelR19.05C-RHEL7 (Rev 144) [Sep 18 2019] !!
MAIN VERSION 3.7 (20150812) - DBMS:107, FTP:106, TELNET:107","최재규: 우선 심각한 에러는 아니고 내부에 스레드 끼리 요청할 때 나올 수 있는 에러입니다
프로토콜이 안 맞거나 log모듈 내부 통신에서 발생할 수 있을 것 같습니다.

모듈 내부에서 처리할 것들을 function id로 해서 전달해주는데 원래 3자리 수 정도인데 7자리 수로 통신하면서 에러가 발생한 내용입니다.

로그 유실이나 크리티컬한 문제를 발생하지는 않을 것으로 보입니다.
다만 원인을 알 수 있으면 좋을 것 같은데 에러가 발생한 시점에 감사로그는 무엇이 있는지, /var/log/messages 등 시스템에 로그가 남은 건 없는지 체크해보시고 공유해주시면 좋을 것 같습니다.",https://cafe.naver.com/pnpsecure2/6147
6139,WireShark 패킷을 통한 SSL인증서 확인,"안녕하세요 기술지원 2팀 남민우입니다.
클라우드 서비스 DBMS 저변이 확대되면서, DB통신을 기본적으로 암호화로 서비스하는 사이트가 많아졌습니다.
SSL 인증서 문제로 클라우드 접속에 통신실패하는 현상이 확인되어, DBSAFER GW서버에서 캡쳐된 패킷을 기반으로 인증서 정보를 확인하는
방법이 있어 공유 드립니다.
WireShark로 저장된 패킷을 이용하는 방법으로 간단하게 인증서를 추출할 수 있습니다.
1. 저장된 패킷을 이용하여 인증서(Certificate) 패킷 확인
- Cilent의 요청에 따른 서버 Hello를 전송하면서 인증서를 같이 전송
2. 해당 패킷 선택 후, Export
Export Packet Bytes.. 클릭
3. Crt 파일로 저장해 줍니다.
4. 인증서 정보 확인
패킷을 통해 저장한 인증서와 /dbsafer/key 폴더의 인증서 정보가 동일함이 확인됩니다.
[추가]
서버 공개키는 인증서에 포함될 수도 있고 안될 수도 있습니다
TLS1.3에서는 key교환 후 Application Data Protocol을 통해 암호화된 certificate를 전송합니다",댓글 없음,https://cafe.naver.com/pnpsecure2/6139
6131,[TIP] Oracle 특정 CLOB 유형의 컬럼 결과값이 저장되지 않는 현상,"[이슈내용]
- Oracle 특정 CLOB 유형의 컬럼 결과값이 저장되지않는 현상
[조치]
- pnp_ora 서비스 모듈 패치
- common : r3860 이상 버전으로 패치
[원인]
- 데이터 없이 바로 offset이 (0x76) 나오는 유형으로 현재 구현되지 않아 로깅되지 않음
[CLOB 이란?]
- CLOB (Large Object) 이란 size가 큰 데이터를 외부 파일로 저장하기 위한 데이터 타입, 문자열 데이터를 DB 외부에 저장하기 위한 타입
- 데이터의 최대 길이는 외부 저장소에서 생성 가능한 파일 크기
데이터 타입
설명
CLOB
문자형 대용량 객체 고정길이와 가변길이 문자집합 지원
NCLOB
유니코드를 지원하는 문자형 대용량 객체
BLOB
이진형 대용량 객체
BFILE
대용량 이진 파일에 대한 위치,이름 저장
- Toad 에서 CLOB 데이터 조회 시 패킷상에서는 실제 데이터는 전달되지만 토드의 ""Preview CLOB and LONG data"" 옵션 사용 여부에 따라서 (Clob)로 출력되거나 실제 데이터가 보이게 되어 있음
[관련 벅스 및 참고 자료]
- 데이터 없이 바로 offset이 (0x76) 나오는 유형도 (Clob)로 파싱하도록 수정 완료
- 벅스 : https://bugs.pnpsecure.com/view.php?id=26428
- 참고자료 : https://snoopy81.tistory.com/157",댓글 없음,https://cafe.naver.com/pnpsecure2/6131
6122,[공유] DBSAFER 7.0 매니저 로그인 시 DB연결 세션 최소화 옵션,"간혹 구축 초기 방화벽은 오픈했으나 매니저 접속이 막히는 경우가 있습니다.
매니저 로그인시 발생하는 DB 접속 세션에 대해서
IPS에서는 초당 10회 이상 DB 접속을 한 것으로 보고
Mysql brute force attack 공격행위로 탐지하여 차단했던 사례가 있어서
세션 수를 최소화하는 옵션이 최근 생겼고 해당 내용을 공유합니다.
요약 : DBSAFER 7.0 매니져에 로그인 시 DB 세션 수가 초당 10개 이상 생기면서
고객사의 IPS 기본정책에 의해 탐지되고 차단되는 문제가 있었으며
최신 매니저(Build-2576)의 옵션 설정으로 세션 수를 최소화 할 수 있습니다.
관련 벅스 : https://bugs.pnpsecure.com/view.php?id=26489#c97532
BBS 링크 : https://bbs.pnpsecure.com/showthread.php?tid=13050
매니저 버전과 옵션 :
세션수 최소화 옵션을 사용할 수 있는 버전
옵션 위치 : 추가기능설정 - 로그인 시 DB 연결 세션 최소화
테스트 - DB 연결 세션 최소화 옵션 적용 전 :
로그인 시 아래 그림처럼 최초 4개의 세션이 생성되고
(이후 병렬로 세션을 맺어 빠른 처리를 하기 위해)
추가로 세션이 더 생기면서 19개 까지 증가 후
두번째 그림처럼 2개는 closing 된 후 time_out 상태로 바뀌고
최종적으로는 세번째 그림처럼 사용자 PC에서 netstat 로 확인시
20개 이상의 세션이 생성되고 (연결종료된 세션은 time_wait 상태로 변경됨)
IPS에 의해 탐지되고 차단되게 됩니다.
( IPS 솔루션은 SNIPER 라는 IPS 장비이며 기본탐지 정책에서 확인된 정책명은 'Mysql brute force attack'임)
테스트 - DB 연결 세션 최소화 옵션 적용 후 :
로그인 시 최초 4개의 세션이 생성되고 추가적으로 세션이 생기지 않고 세션수 유지됩니다.
언제 이렇게 세션을 많이 늘렸는지... 사전에 인지하지 못 했습니다.
아쉬운 점은 해당 옵션 적용을 위해 처음 한번은 매니저 로그인을 해야하므로
IPS 담당자에게 예외정책 요청을 해야합니다.
(가능하다면 매니저 접근IP는 구축기간동안 IPS에서 예외처리로 해두고 위 옵션을 적용하는 것도 방법)
그러한 요청이 불가한 경우에는
아래 값을 변경하여 바로 옵션을 적용하는 방법도 있습니다.
(dbsafer3.variables 테이블에 mgr_use_minimize_db_session 값을 1로 변경)
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6122
6111,[쿠콘] decide 명령어유형 결재 후 명령어 입력 시 차단됨,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
- 기능로직문의
[고객사/채널사]
- 쿠콘
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
- decide 명령어유형 결재 후 명령어 입력 시 선결재 연동 정책에 의해 허용되지 않고 차단됨
: insert sql 유형 결재를 통해 허용 받아 명령어 입력 > 차단
: 결재 내용과 동일하게 접속하여 진행
: 정책에 select에 대하여 차단하지 않음
3. 특이사항 (연동 모듈, 커스텀 개발 등)
4. 사내 재현 정보
- 없음
5. 요청사항
- 선결재 연동 정책을 통과하거 차단된 이유 확인 요청드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[모듈 버전]
- pnp_postgresql : Rev 1863
- DBSAFER : 5.0
- decide : v3.3.13.0 Build-698
[구성]
- 이중화 구성 ( GW1, GW2, LOG1, LOG2 )
[대상 장비 정보]
- DB 종류 : postgresql
[사용 쿼리]
--장기미사용자 히스토리 등록
INSERT INTO tb_admin_history(
trx_dt,
ID,
SEQ,
chng_tp,
mng_org_cd,
uper_org_cd,
org_cd,
nm,
mob_no,
chng_rsn,
chng_id,
chng_dttm)
select
TO_CHAR(NOW(),'YYYYMMDD'),
a.id,
coalesce((select max(SEQ) from tb_admin_history as tah where tah.id = a.id), 0) +1,
'9',
a.mng_org_cd,
a.uper_org_cd,
a.org_cd,
a.nm,
a.mob_no,
'어드민 장기미사용자 권한 삭제',
'system',
TO_CHAR(NOW(),'YYYYMMDDHH24MISS')
from tb_admin a
WHERE coalesce(fin_conn_dttm, reg_dttm) < TO_CHAR(CURRENT_TIMESTAMP + '-90days', 'yyyymmdd24miss')
and admin_st = '010001'
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
- 사용자가 입력한 쿼리 첨부하였습니다.
- 권한제어 정책(선결재 연동 정책, 차단 정책) 첨부하였습니다.
- 접속 세션 정보 첨부하였습니다.
첨부파일
쿠콘_이슈
.zip
null
파일 다운로드","이임재: 연구소 분석중 입니다. (정대헌 전임)
손범준 대리 - 사내 재현 환경 구성중 | 이상민: 신청SQL과 수행SQL의 명령어 유형 비교 시 통제되지 않을 것으로 예상됩니다.

1) 수행SQL 유형 : INSERT, SELECT
2) 신청SQL 유형 : INSERT

따라서 명령어 유형 신청 시 SELECT도 같이 신청하면 통제될 것 같습니다. | 손범준: 이상님 팀장님이 말씀주신 방법으로 이슈가 해결된 것 같습니다.
확인 정말 감사합니다.",https://cafe.naver.com/pnpsecure2/6111
6107,[대교그룹]시스템 메일 폼 수정 요청 및 경고메일 정보추가,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기능로직문의
[고객사/채널사]
대교그룹
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크)
1-1. 시스템 임계치 알람 메일 전달 시, 이미지 미표기 및 한글깨짐 현상
1-2. 대용량경고메일 함목에 데이터 추가
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
2-1. sysmon_system_info_mail_form.txt파일의 인코딩 및 피앤피시큐어 홈페이지 링크 이미지 삽입
2-2. mail_form.txt 파일의 기본 값 및 예약어에 요청 데이터 없음
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 해당 사항 없음
4. 사내 재현 정보
- 해당 사항 없음
5. 요청사항
1. 시스템 임계치 알람 메일 전송 관련
1-1.) 메일의 이미지 미표기 현상 관련
-> 기존 PKG(22.11)에 포함된 sysmon_system_info_mail_form.txt 파일을 사용할 경우 피앤피시큐어 홈페이지에 링크된 이미지가 표시되지 않는 현상
-> 현재 최신 릴리즈 패키지(23.05)에서 해당 내용이 수정된 것으로 확인됩니다.
-> pnp_sysmon(Rev257) 모듈은 동일하게 사용하고 sysmon_system_info_mail_form.txt 파일만 교체하여 사용해도 문제가 없는지 문의드립니다.
1-2.) 메일 수신자 복수 지정 및 메일 제목 설정 관련
-> pnp_sysmon.conf 파일의 메일 수신자 설정옵션(#MAIL_TO)에 다수의 메일주소 지정이 가능한지 문의드립니다.
-> 메일 제목 설정 옵션(#MAIL_SUBJECT)에 스페이스 이후의 문자가 무시된다면 메일 제목을 모두 띄어쓰기 없이 사용해야하는지
2. 대용량 조회 경고메일 데이터 추가 요청 관련
- 현재 경고객체로 연동된 메일에는 사용자장보(이름, CERT, 부서) 접속 IP, 정책정보, 접속서버, 발생시간, COMMAND 값이 전달됩니다.
- 고객사 요청사항
> DB계정, 결과값 행수, 테이블명 정보 추가요청
- 현재 사용되는 mail_form.txt 파일의 예약어에는 고객사에서 원하는 정보가 없는 것으로 확인됩니다.
- 해당 값을 추가하려면 설정변경으로 가능한지 혹은 추가 개발이 필요한지 문의드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
- pnp_sysmon Rev 257
- pnp_mailer 1.3.9
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","최재규: 1. 시스템 임계치 알람 메일 전송 관련
1-1.) pnp_sysmon(Rev257) 모듈은 동일하게 사용하고 sysmon_system_info_mail_form.txt 파일만 교체하여 사용해도 문제가 없는지 문의드립니다.
>>> R23.05 에서 공지한대로 mail 폼만 수정하시면 됩니다.

1-2.) 메일 수신자 복수 지정 및 메일 제목 설정 관련
-> pnp_sysmon.conf 파일의 메일 수신자 설정옵션(#MAIL_TO)에 다수의 메일주소 지정이 가능한지 문의드립니다.
-> 메일 제목 설정 옵션(#MAIL_SUBJECT)에 스페이스 이후의 문자가 무시된다면 메일 제목을 모두 띄어쓰기 없이 사용해야하는지
>>> 띄어쓰기를 통해 다수 메일 지정 가능합니다.
ex) MAIL_TO = jgchoi@pnpsecure.com pnp_jgchoi@naver.com (2명에게 메일 전송)

>>> 메일 제목은 띄어쓰기를 하는 경우에도 포함할 수 있습니다. 설정파일 설명 수정하겠습니다.
e",https://cafe.naver.com/pnpsecure2/6107
6098,"[국방 DIDC] SFTP 객체 없이 SSH 객체를 통해 SFTP 접속 시 사용자명, 부서명 미로깅 현상","[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타 문의
[고객사/채널사]
국방DIDC
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
- SFTP 객체 없이 SSH 객체로 SFTP 접속 시 접속된 보안계정의 사용자명, 부서명은 로깅되지 않는 현상
SFTP 객체 미등록 후 SSH 객체를 통해 SFTP 접속 시 사용자명, 부서명 미로깅
SFTP로 접속 시 상세 로그
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- 로그 DB에서 확인시에도 사용자명, 부서명이 누락되어 있는 것을 확인
- [NAT_SFTP_FTPSERVICE] 항목 disable 설정
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 없음
4. 사내 재현 정보
- VIP : 192.168.112.33
- IP : 192.168.112.31/32 (단독 이중화 / SSH PORT : 7795)
5. 요청사항
- 해당 현상이 정상 동작인지 궁금합니다.
- 정상 동작이라면 사용자명, 부서명도 남길 수 있는 방법을 가이드 해주시면 감사하겠습니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
- pnp_ssh_proxy : rev 258
- pnp_telnet : v2345
- pnp_log : rev 777
- pnp_log_bridge : rev 153
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","여성구: bugs 로 등록을 해주세요. | 김태윤: pnp 모듈 실행 시 버전 표시될 수 있도록 기능 추가 하였습니다. 빌드 요청해 주시면 됩니다.
해당 버전 정보가 맞는지 확인 후 요청해 주시기 바랍니다. 버전이 다를 경우 해당 버전으로 요청 주시면 됩니다.

# ./pnp
DBSAFER Enterprise V7.0
DBSAFER Server V7.0.0.7",https://cafe.naver.com/pnpsecure2/6098
6097,[건강보험공단] Server Manager과 Telnet모듈의 호환성관련 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의) 

기타문의

​

[고객사/채널사] 

건강보험공단

​

[이슈내용] 

1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0 

​

​

2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항) 

​

​

3. 특이사항 (연동 모듈, 커스텀 개발 등) 

​

​

4. 사내 재현 정보 

​

​

5. 요청사항

 Server Manager Release 5.1.6.21을 사용할 경우 Telnet모듈을 특정 버전이상 사용하라는 내용이 있습니다.

 담당 개발자(양문섭차장님) 말씀으로는 'Telnet모듈 버전에 의존하는 기능을 만들지 않았다'라고 하시는데 

 실제로  Server Manager Release 5.1.6.21을 사용할 경우 Telnet모듈을 특정 버전이상 사용해야 되는지 문의드립니다.

 실제로 특정 Telnet버전이상 사용해야 된다면 사용해야되는 사유도 알려주시면 감사하겠습니다.


또한,  Server Manager Release 5.1.8.18에는 따로 제약사항이 표기되어 있지 않은데 5.1.6.21과 동일한지 문의드립니다.

​

​

[모듈 로그(Debugging 로그 및 ERROR 로그] 

(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함) 

​

​

[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등) 

​

​

​

[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","여성구
@조재용 팀장님 본 건 체크해주세요.

2023.11.22. 18:57
답글쓰기

프로필 사진
조재용
SA 릴리즈 시 Agent와 매니저를 함께 릴리즈하며 주의사항에 작성했던 내용으로 manager는 관련이 없고 Agent쪽 기능과 관련성이 있어 텔넷 버전을 명시한 것입니다. 일반적으로 높은 버전의 Agent 사용시 Manager도 함께 패치하기 때문에 작성한 것으로 매니저만 패치할 경우에는 문제가 되지 않습니다.",https://cafe.naver.com/pnpsecure2/6097
6096,[공유] [카카오페이증권] Works 비정형화 명령어 기안 시 명령어 Value 값에 개행 및 띄어쓰기가 존재할 때 발생하는 이슈 공유해 드립니다.,"안녕하세요.

클라우드기술팀 민시원입니다.

​

카카오페이증권에서 Works 결재 시스템 사용 중 '비정형화 명령어 기안' 시 명령어 Value 값에 개행 및 띄어쓰기가 있을 경우 발생하는 이슈 및 대응에 대해 공유해 드립니다.

​

[요약]

1. Works 비정형화 명령어 기안 시 명령어 Value 값에 개행 및 띄어쓰기가 있을 경우 결재 이후에도 해당 명령어 비정상 차단 발생 (BT: 26395)

2. BT: 26395 해결 버전에서도 비정형화 명령어 기안 시 명령어 Value 값에 개행 및 띄어쓰기가 있을 경우 실제 해당 명령어 실행 시 기안한 명령어 양식과 100% 똑같이 입력하지 않으면 차단되는 현상 확인 (개행 및 띄어쓰기가 다르면 차단)

3. 해당 내용에 대해 추가 개선 벅스 등록 (BT: 26528), 해당 내용 관련하여 기안 명령어 복사 버튼 기능 추가 벅스 등록 (BT: 26524)

4. 패치 전까지 비정형화 명령어 기안 대신 정형화 명령어를 사용하도록 가이드

​

[카카오페이증권 pnp_imup_policy 모듈 버전]

IMUP_POLICY.v2 Release (Rev 67)

​

[첫 이슈 재현]

1. 카카오페이증권에서 실제로 기안 올린 명령어:

INSERT INTO meteor.user_group (user_group_id, rule_id, user_group_name, query, activated, created_at, created_by, updated_at, updated_by) VALUES (1, 2, 'us-starter', 'select sum(dpnt_ord_pr * dpnt_tclsn_q) as sum

     , max(cif) as cif

     , max(kkp_cif) as kkp_cif

from stream.td_usa_clsn_infm

where kkp_cif = :app_user_id

  and wrk_dl_dttm between :created_at and :application_ended_at', 1, '2023-10-12 14:03:10.290276', 'meteor-validator', '2023-10-12 14:03:10.290276', 'meteor-validator');

​

2. 기안 결재 후 pnp_imup_policy shm print 결과


./pnp_imup_policy shm print 결과

3. 기안 결재 후 psync.auth_policy 결과


psync.auth_policy 결과

4. 해당 명령어 실행 결과: 전체 차단 정책으로 차단

- 명령어 결재로 정상 작동한다면 Table이 존재하지 않는다는 에러가 확인돼야 정상

 . 전체 차단 위에 있는 IMUP 연동 정책에 적용되기 때문에 차단 정책에 걸리지 않지만 실제로 table이 존재하지 않음

- 정책에 의해 차단 된다면 비정상


명령어 실행 결과

5. 해당 명령어 정형쿼리 객체로 등록 후 정형화 값 확인


정형쿼리 객체 확인 결과

​

[BT: 26395 해결 버전 테스트]

1. 테스트 결론: 테스트 케이스 증적은 첨부 파일 참고 바랍니다.


BT: 26395 패치 테스트 결과

첨부파일
26395 벅스 패치 모듈 테스트
.zip
null파일 다운로드
 

[대응]

1. 카카오페이증권에 비정형화 명령어 기안 대신 정형화 명령어 기안 사용하도록 가이드

- 정형화 명령어는 개행 및 띄어쓰기 관계 없이 정상 작동

​

2. pnp_imup_policy 기능 수정 전 사용 가능하도록 기안 명령어 복사 버튼 기능 추가 벅스 등록 (BT: 26524)

​

​

감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6096
6093,[대교그룹]LOG서버 무결성 검사 실패이슈,"[분류] (에러로그문의 / 기능로직문의 / 기타문의) 

​

에러로그 문의

​

​

[고객사/채널사] 

​

대교

​

​

​

[이슈내용] 

​

1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크) 

​

- 시스템 무결성 검사 실패

​

- pnp_check_integrity를 통한 업데이트 이후, 매니저 환경설정 > 무결성 검사 > 로그 무결성 검사 결과는 정상

​

- 02:00 동작 하는 무결성 검사는 지속적으로 실패(LOG서버만)

​

- 다음 날 수동 검사시 정상 

​

- 검사사이에 바이너리 및 설정파일 변경사항 없음


무결성 검사실패로그





​

​

2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항) 

​

- 무결성 검사 성공시 dbsafer3.check_integrity 테이블과 실패이후 테이블 데이터는 동일함

​

​

​

3. 특이사항 (연동 모듈, 커스텀 개발 등) 

​

- pnp_duplex를 통한 LOG서버 이중화(VIP 지정)

​

​

​

4. 사내 재현 정보 

​

- N/A

​

​

​

5. 요청사항 

 - 무결성 검사 실패 원인분석 및 조치사항 

요청

 - 무결성 검사 수동 동작과 스케쥴링 동작간의 차이점 요청

​

​

[모듈 로그(Debugging 로그 및 ERROR 로그] 

​

(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함) 

​

실패로그(마지막 부분)

[2023-11-16 02:00:03] [3210] [WARNING][WARN__0501099] Warning related with file. : FILE ./lib/logwriter_plugin_type2.so is not found

src/service.cpp[getSha1]:633

[2023-11-16 02:00:04] [3210] [WARNING][WARN__0501099] Warning related with file. : FILE ./pnp_accountsync/aw_jarlib.jar is not found

src/service.cpp[getSha1]:633

[2023-11-16 02:00:04] [3210] [MISC][INFO__000000000] Information message. : The integrity check is failed (Binary). Please check the system log for details.

src/service.cpp[daemon_service]:859

​

​

성공로그(마지막 부분)

[2023-11-16 10:47:38] [41414] [WARNING][WARN__0501099] Warning related with file. : FILE ./lib/logwriter_plugin_type2.so is not found

src/service.cpp[getSha1]:633

[2023-11-16 10:47:38] [41414] [WARNING][WARN__0501099] Warning related with file. : FILE ./pnp_accountsync/aw_jarlib.jar is not found

src/service.cpp[getSha1]:633

​

​

​

​

[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등) 

​

[root@dbsafer-log1 dbsafer]# ./pnp_checkintegrity

CHECKINTEGRITY Release Version 1.0 for RelR22.05C-RockyLinux (Rev 119) [Sep 14 2022] !!

​

​

​

[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)

​

pnp_checkintegrity_2023111602.log : 검사 실패시 모듈로그

pnp_checkintegrity_2023111610.log : 검사 성공시 모듈로그

​

check_integrity_20231115.txt : 검사 실패전 dbsafer3.check_integrity 테이블데이터

check_integrity_20231116.txt : 검사 실패후 dbsafer3.check_integrity 테이블데이터","여성구
문의에 대해서 이해가 되지 않습니다.
캡쳐를 볼 때 [DBSAFER] 로 되는 로그가 있어야 하는데 없습니다. 그리고 파일을 못 찾는 로그가 있어서 더 이해가 되지 않습니다. 구성이나 설정 문제가 있는 것 아닐가요?

2023.11.21. 17:03
답글쓰기

프로필 사진
여성구
본 건 이해 되지 않아서 원격 지원하기로 하였습니다.

2023.11.28. 17:10
답글쓰기

프로필 사진
여성구
원격지원을 하였습니다. sysmon.conf 설정 변경이후 ntp, checkintegrity 를 재싲가하지 않아서 서버 설정 값을 잘 못 가져왔습니다.",https://cafe.naver.com/pnpsecure2/6093
6090,[삼성SDI] RAC 환경에서 쿼리 수행 중에 네트워크 단절 시 다른 RAC VIP로 전환되지 않는 현상,"[사이트]

삼성SDI

​

​

[문제 발생 모듈 버전]

pnp_ora : Rev: v2437 이하 버전 전체 발생

​

​

[현상]

- RAC 환경에서 DBSAFER 경유하고 쿼리 수행 중에 네트워크 단절 시 다른 RAC VIP로 전환되지 않고 연결 종료되는 현상

- DBSAFER 경유하지 않고 직접 접속 시 다른 RAC VIP로 전환되고 기존 쿼리가 끊김 없이 계속 수행됨

​

​

[재현 방법]

1. golden6 클라이언트 툴 (12c 64bit oracle client)로 RAC1 VIP로 접속

2. 해당 쿼리 수행 (select level, chr(64+mod(level,26)) As alpah from dual connect by level < 600000;)

3. RAC1 서버에서 네트워크 다운 수행 (ifconfig ens192 down)

4. DIRECT VIP: 재전송 5번 후 서버로 부터 RST 전달 받음, RAC1 재접속 실패 확인, RAC2 VIP로 자동 접속 후 기존 쿼리 수행

    DIRECT REAL IP: 클라이언트 툴에서 서버로 재전송 6번 후 서버로 RST 전달, RAC1 재접속 실패 확인, RAC2 접속 후 바로 종료 (SQL Error Cursor must be opened 에러 발생)

    DBSAFER 경유: DBSAFER에서 FIN 전달 받음, RAC1 재접속 실패 확인, RAC2 접속 후 바로 종료 (SQL Error Cursor must be opened 에러 발생)

​

​

[원인]

- Oracle 서버에서 RST을 전달했으나, DBSAFER를 경유하면서 DBSAFER에서 클라이언트에게 FIN을 전달해서 발생

​

​

[수정사항]

- 서버단에서 RST를 받았을 경우 클라이언트에게도 동일하게 RST를 전달하도록 수정

: SO_LINGER 옵션을 사용해서 RST 전달

: epoll_wait에서 EPOLLERR일 경우 recv 해서 ECONNRESET에러 발생 시에만 RST 전달하도록 수정

- 수정 버전 : Rev : v2437

​

​

[조치 사항]

- 사트에서 수정 버전으로 패치 후 정사 동작 확인

- 네트워크 단절과 같은 RAC 전환 과정에서 클라이언트에 RST가 정상적으로 전달되고, 연결 종료 없이 VIP를 통한 쿼리가 계속 수행되는것을 확인",댓글 없음,https://cafe.naver.com/pnpsecure2/6090
6089,"[기업은행-QB] QB를 통한 SQL 수행 시 ORA-20000, ORU-10027 buffer overflow, limit 10000 bytes 오류 발생(QB 공통)","[사이트]

기업은행

​

[문제 발생 모듈 버전]

전체 버전 해당

​

[현상]

 - 사용자가 QB-S를 통해 select 명령어 수행 시 ORA-20000, ORU-10027 buffer overflow, limit 10000 bytes 오류 발생


 - QB-S 접속 시 수행되는 MetaQuery 중 begin dbms_output.enable(:1); end; 바인드 변수 1: = 10000 명령어 수행 확인

​

[오류설명]

 - 해당 오류는 DBMS_OUTPUT.PUT_LINE() 실행시, 설정된 버퍼크기보다 더 큰값이 출력되는 경우 발생하는 오류

 - MetaQuery 중 begin dbms_output.enable(:1); end; 바인드 변수 1: = 10000 해당 명령어가 수행되는 이유

  : 본 명령어는 Oracle에서 지원하는 기능으로, 쿼리 편집기 및 PL/SQL 편집기에서 DBMS_OUTPUT.PUT_LINE() 명령어 실행시 결과값을 출력하기 위해서 버퍼를 지정된 크기로 설정하는 명령어

  : 초기값은 10,000으로 설정되어 있으며, 해당 값보다 큰 버퍼 사이즈가 결과값 출력될 경우 발생.

​

  - 쿼리편집기 : DDL 이 실행되는 경우 본 명령어가 실행되며, DDL 안에 DBMS_OUTPUT.PUT_LINE() 명령어가 있으면 DBMS Output 탭에서 출력값을 확인가능능.

존재하지 않는 이미지입니다.
​

  - PL/SQL 편집기 :  DDL 이 실행되는 경우 본 명령어가 실행되며, DDL 안에 DBMS_OUTPUT.PUT_LINE() 명령어가 있으면 DBMS Output 탭에서 출력값을 확인가능능.

존재하지 않는 이미지입니다.
​

[조치 방법]

 - QB에서 설정 값을 수정하여 해당 변수를 조절 가능

 - 쿼리 편집기

    : Oracle 접속시 쿼리 편집기 실행 결과 탭에 'DBMS Output' 탭이 표시됩니다. 해당 탭의 상단에 톱니바퀴를 클릭하여 버크 크기를 조절.

    : 초기값은 10,000 이며 2,000 ~ 32,767 까지 조절가능능.",댓글 없음,https://cafe.naver.com/pnpsecure2/6089
6087,"[현대모비스][accountsync] LDAP 연동 시, 하위 DN 중 일부 DN 정보를 가져오지 못하는 현상","[사이트]

현대모비스

​

[문제 발생 모듈 버전]

dbsafer_accountsync : v1.143 이하 버전 전체 발생

​

​

[현상]

 - BaseDN 설정 기준 하위 DN 중 일부 DN 정보를 가져오지 못함

 - 일부 DN 기준은 10,000 행 이하의 DN을 읽지 못하는 현상으로 확인

 - 담당자 확인 결과 설정 된 DN의 하위 DN은 12,000개 이상 존재 확인

​

[원인]

 - v1.143 이하 버전의 인사연동 모듈에서 처리할 수 있는 DN의 최대 개 수가 10,000개로 하드코딩되어 있음.

 - 해당 설정은 설정파일 변경을 통해 변경 할 수 없으며, 해당 내용에 대해 개발자 수정 요청

​

[처리현황]

 - v1.143 이상 버전에서 수정 완료

 - 설정 파일 변경 사항 : (.conf/dbsafer_accountsync.properties.sample) 내, SearchDNCountLimit 설정 설명은 아래와 같습니다.

​

################################################################################​

# AD LDAP 탐색 DN의 최대 개수 제한을 설정합니다.

#

# SearchDNCountLimit        : (선택) LDAP DN 탐색 개수 제한 (Default : 10000)

#                             0 : 제한 없음 (no limit)

#                             N : 최대 N개까지 탐색 (최소 10000 이상 설정 가능)

################################################################################​

#SearchDNCountLimit = 10000

​

 - 사이트 옵션 설정 : SearchDNCountLimit = 20000

 - 패치 및 설정 후 정상 동작 확인 완료

​

[결론]

 - AD 인사연동 시 사전에 담당자에게 연동 DN의 하위에 포함된 개수 확인 후 설정 값 변경 필요",댓글 없음,https://cafe.naver.com/pnpsecure2/6087
6085,[대림그룹]VPN 사용시 2-factor 인증 실패로 인한 DB접속 불가,"[분류] (에러로그문의 / 기능로직문의 / 기타문의) 

에러로그 문의

​

[고객사/채널사] 

대림그룹

​

[이슈내용] 

1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0 

 - 특정 상용자가 VPN을 통한 DBMS 서비스 접속 시, 2-factor 인증창이 생성되지 않으면서 정책에 의해 차단됨

​

​

2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항) 

 - 동일 서버에 대해 VPN을 통하지 않은 접속의 경우에는 정상동작 (OTP인증 후, DB서버 접속)

​

 - 고객사에서는 방화벽에서 통신로그가 확인되며, DBSAFER 서버의 통신은 따로 차단하지는 않는다고 함

​

 - 2-factor 인증에 사용되는 포트(TCP-50015) 통신 확인 결과, VPN 사용시, 해당 포트 SYN 요청에 대한 응답이 없음


정상 통신시 50015 통신내역


VPN 사용자 50015 통신내역

3. 특이사항 (연동 모듈, 커스텀 개발 등) 

 - VPN을 연결할 경우 UDP50013 포트 통신오류 메세지 확인 됨

​

 - pnp_userauth 데몬에 서비스 데몬 접속 실패 메세지 확인

​

4. 사내 재현 정보 

- 해당사항 없음

​

5. 요청사항 

- 현상에 대한 원인 및 조치 현상 문의(DBSAFER가 원인이 아니라면 해당 사항에 대한 증명이 필요하다고 합니다)

​

​

[모듈 로그(Debugging 로그 및 ERROR 로그] 

(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함) 

 - saferuas 로그에는 특이사항 없음

​

 - pnp_userauth 데몬 오류 로그

​

정보: Request Data: [AUTH TYPE:1][CERT ID:T019624][CERT NAME:황유신][CERT CONTACT:DL이앤씨][SUB CERT IDT:][CLIENT IP:10.157.3.208][CLIENT PRIVATE IP:][CLIENT ID:DNP][SERVER IP:172.18.194.95][SERVER ADDR:172.18.194.95][SERVER PORT:1521][SERVER NAME:-][SERVICE TYPE:dbms][TIMEOUT:180][COMMAND LEN:0][ADAPTED POLICY TYPE:0][NEGOTIATED PROTOCOL VERSION:5]

11월 13, 2023 5:39:31 오후 com.pnpsecure.userauth.authgw.AuthGwHandler onJob

심각: failed send result to service daemon

java.net.ConnectException: 연결이 거부됨 (Connection refused)

at java.base/java.net.PlainSocketImpl.socketConnect(Native Method)

at java.base/java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:399)

at java.base/java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:242)

at java.base/java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:224)

at java.base/java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)

at java.base/java.net.Socket.connect(Socket.java:609)

at java.base/sun.security.ssl.SSLSocketImpl.connect(SSLSocketImpl.java:299)

at java.base/sun.security.ssl.SSLSocketImpl.<init>(SSLSocketImpl.java:158)

at java.base/sun.security.ssl.SSLSocketFactoryImpl.createSocket(SSLSocketFactoryImpl.java:88)

at com.pnpsecure.userauth.Basic2FactorHandler.getSSLSocket(Basic2FactorHandler.java:381)

at com.pnpsecure.userauth.Basic2FactorHandler.getPcAssistSocket(Basic2FactorHandler.java:464)

at com.pnpsecure.userauth.authgw.AuthGwHandler.onJob(AuthGwHandler.java:71)

at com.pnpsecure.userauth.Basic2FactorHandler.execute(Basic2FactorHandler.java:176)

at com.pnpsecure.userauth.MainServer$1.run(MainServer.java:72)

at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)

at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)

at java.base/java.lang.Thread.run(Thread.java:829)

​

​

[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등) 

 - PKG_DBSAFER5_R22.05R2-CentOS7_x86_64_P9.11_2F.tar.gz

 - pnp_userauth_v1.0.71_20220822_for_dbsafer5.tar.gz

 - saferuas.war.2.0.63.0_Build-2169_20220914.tgz

 - [대림그룹DBSAFERAGENT_202209.exe(V3.2.36.1)

​

​ORACLE Release version 3.1.0 for RelR22.05C-CentOS7

MAIN VERSION 3.7 (20150812)(Rev: v2195)

ADDED OPTION STATUS: (CLIENT_SIDE_MAX_CAPACITY)

COMMON MAIN MODULE VERSION: 1.2.29

COMMON LIBRARY VERSION: 3568

COMMON POLICY MODULE VERSION: 1.2.19

COMMON AUDIT LOG MODULE VERSION: 1.1.02

COMMON FORMAL_QUERY MODULE VERSION: 1.1.0.1

COMMON CERTIFICATION MODULE VERSION: V3

COMMON 2FACTOR PROTOCOL : v2

SHARED INTERFACE VERSION: 512

ORACLE PARSER MODULE VERSION(bind): 1.1.67(3518)

SQL SYNTAX PARSER  MODULE VERSION: 1.3.3545

Pol/Log/Decide Build: POLICY-(105) LOG-(107) DECIDE-(8)

LastUpdate(compiled): Jun 29 2022

The latest update of the binary: Jun 29 2022

​

​

[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)

 1.) pnp_userauth_2023111317.log (사용자 : T019624)

  > 고객사 vpn은 연결 할때 마다 IP가 변경됨

​

 2.) local.pcap

 - vpn 미사용시 정상적인 DB접속 패킷

  > DBSAFER IP 및 서비스PORT = 10.XX.X.71 : 11234

  > 사용자 local네트워크 IP = 10.XX.XX.119

​

 3.) vpn.pcap

 - vpn 사용지 접속오류 패킷

  > DBSAFER IP 및 서비스PORT = 10.XX.X.71 : 11234

  > 사용자 VPN네트워크 IP = 10.XXX.X.140","이임재
msg_tunnel 로그에 사용자의 private IP가 있는지 확인 요청 및
msg_tunnel 관련 설정 확인 요청

2023.11.15. 11:57
답글쓰기

프로필 사진
여성구
이전에 함께 원격을 확인 했던 이슈로 기억합니다.

50015 통신이 도달하지 않고 있습니다. 파일 시각으로 볼 때 동시 시점에 수집된 패킷인데 50015의 패킷을 보면 사용자한테까지 도달이 되지 않고 있습니다.

RST 패킷의 맥주소를 보면 차단 시킨 것과 동일하게 전달이 됩니다.
하지만 그 이전의 통신 데이터는 전달이 되지 않고 있습니다.",https://cafe.naver.com/pnpsecure2/6085
6082,DBSAFER 구축 시 /etc/profile 내 umask 세팅 관련 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의) 

기타 문의

​

[고객사/채널사] 

신한금융그룹

​

[이슈내용] 

1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0 

​

​

2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항) 

​

​

3. 특이사항 (연동 모듈, 커스텀 개발 등) 

​

​

4. 사내 재현 정보 

​

​

5. 요청사항 

DBSAFER 기본 구성 시 생성하는 서버 계정(dbsafer, mysql, webusr)의 파일 생성 권한이

/etc/profile에 umask 007로 기본 적용되어 있는 것으로 확인하였습니다.

​

고객사에서는 취약점 조치중 위 내용을 발견한 뒤 022로 셋팅을 변경해도 되는지 문의하였습니다.

​

기본 umask 세팅을 변경해도 괜찮을지 문의드립니다.","김태윤
안녕하세요.
DBSAFER PKG 설치 및 실행 권한이 root일 경우에는 문제가 되지 않을 것으로 판단됩니다.
root의 경우 umask 022로 문제가 되지 않을 것 같습니다.

감사합니다.",https://cafe.naver.com/pnpsecure2/6082
6081,[공유] [KB헬스케어] 별도 페이지 통한 Google OTP 발급 시 페이지 문구 변경 방법 공유,"[요약] 

- Google OTP 발급 시 별도 페이지 방식을 사용함

- 고객사 측 요청으로 페이지 내의 문구 변경 필요

​

[접근 과정]

- 세부 기능 변동이 아닌 html, css 와 웹페이지의 시각적 부분에 대해서는​ 별도 빌드 없이 자체 수정이 가능할 것으로 판단

- /webapps/saferuas/ 경로 내에 있는 파일들을 확인 중 googleOtpGen.jsp 내용이 별도 페이지와 관련이 있음 판단

  . message code 가 설정된 경로 여부 확인이 필요하여 문의 진행


[변경 방법]

1안) 속성값 변경 (tomcat 재시작 O)

- 경로 : /usr/local/apache/webapps/saferuas/WEB-INF/classes/lang/common/message_ko.properties

- message.gon_google_otp에서 value 변경 


- tomcat 재시작 필요 (service pnpweb stop/start)


2안) JSP 수정 (tomcat 재시작 X)

- 경로 : /usr/local/apache/webapps/saferuas/WEB-INF/views/googleOtpGen.jsp

- <spr:message code=""~~~"" />부분을 주석처리 한 후 하단에 텍스트 삽입


- pnpweb 새로고침 후 즉시 적용 확인 


​

​

감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6081
6080,[현대제철] saferuas FIDO 인증 cipher suites 제거 관련 DBSAFER 동작 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의) 

기능로직문의

​

[고객사/채널사] 

현대제철

​

[이슈내용] 

1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0 

- 해당사항 없음

​

2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항) 

- 해당사항 없음

​

3. 특이사항 (연동 모듈, 커스텀 개발 등) 

- 해당사항 없음

​

4. 사내 재현 정보 

- 해당사항 없음

​

5. 요청사항 

- 고객사에서 FIDO서버의 취약점 조치 예정으로 확인 요청이 들어온 문의사항입니다.

- 현대제철 그룹사 FIDO서버 취약점 조치로 기존에 사용하던 Cipher Suites 일부 제거

- 아래의 항목들이 제거 되어도 DBSAFER 2차인증 통신에 문제가 없는지 확인을 요청 하였습니다.

- 현대제철 적용 버전 : saferuas.war.hyundaeautoever.1.4.1_20220214.tgz

​

- FIDO 웹서버 內 취약 Cipher Suites(아래) 제거

- 취약 Cipher Suites 제거 목록

TLS_DHE_RSA_WITH_AES_128_CBC_SHA256

TLS_DHE_RSA_WITH_CAMELLIA_128_CBC_SHA

TLS_RSA_WITH_AES_256_CBC_SHA256

TLS_DHE_RSA_WITH_CAMELLIA_128_CBC_SHA256

TLS_ECDHE_RSA_WITH_CAMELLIA_128_CBC_SHA256

TLS_RSA_WITH_AES_256_CCM_8

TLS_DHE_RSA_WITH_CAMELLIA_256_CBC_SHA

TLS_RSA_WITH_AES_128_CCM_8

TLS_RSA_WITH_AES_256_CCM

TLS_RSA_WITH_ARIA_128_GCM_SHA256

TLS_RSA_WITH_ARIA_256_GCM_SHA384

TLS_RSA_WITH_SEED_CBC_SHA

TLS_DHE_RSA_WITH_SEED_CBC_SHA

TLS_RSA_WITH_AES_256_GCM_SHA384

TLS_RSA_WITH_AES_128_GCM_SHA256

TLS_RSA_WITH_AES_128_CBC_SHA256

TLS_RSA_WITH_CAMELLIA_256_CBC_SHA256

TLS_ECDHE_RSA_WITH_CAMELLIA_256_CBC_SHA384

TLS_DHE_RSA_WITH_AES_256_CBC_SHA256

TLS_DHE_RSA_WITH_AES_128_CBC_SHA

TLS_RSA_WITH_CAMELLIA_128_CBC_SHA256

TLS_RSA_WITH_AES_128_CCM

TLS_DHE_RSA_WITH_CAMELLIA_256_CBC_SHA256

TLS_RSA_WITH_CAMELLIA_256_CBC_SHA

TLS_RSA_WITH_AES_128_CBC_SHA

TLS_DHE_RSA_WITH_AES_256_CBC_SHA

 

- 권장 Cipher Suites(아래)로 통신이 될 수 있게 서버 조치 필수

- 통신 허용 Cipher Suites 목록

TLS_AES_128_GCM_SHA256

TLS_DHE_RSA_WITH_AES_256_GCM_SHA384

TLS_DHE_RSA_WITH_AES_128_GCM_SHA256

TLS_DHE_RSA_WITH_AES_128_CCM_8

TLS_DHE_RSA_WITH_ARIA_256_GCM_SHA384

TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA

TLS_DHE_RSA_WITH_CHACHA20_POLY1305_SHA256

TLS_DHE_RSA_WITH_AES_128_CCM

TLS_DHE_RSA_WITH_ARIA_128_GCM_SHA256

TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384

TLS_CHACHA20_POLY1305_SHA256

TLS_AES_256_WITH_GCM_SHA384

TLS_DHE_RSA_WITH_AES_256_CCM_8

TLS_DHE_RSA_WITH_AES_256_CCM

TLS_ECDHE_RSA_WITH_ARIA_128_GCM_SHA256

TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256

TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256

TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384

TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA

TLS_ECDHE_RSA_WITH_ARIA_256_GCM_SHA384

TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256

​

​

[모듈 로그(Debugging 로그 및 ERROR 로그] 

(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함) 

​

​

[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등) 

​

​

​

[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)

[분류] (에러로그문의 / 기능로직문의 / 기타문의) 

​

​

[고객사/채널사] 

​

​

[이슈내용] 

1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0 

​

​

2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항) 

​

​

3. 특이사항 (연동 모듈, 커스텀 개발 등) 

​

​

4. 사내 재현 정보 

​

​

5. 요청사항 

​

[모듈 로그(Debugging 로그 및 ERROR 로그] 

(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함) 

​

​

[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등) 

​

​

​

[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","여성구
본 요청 사항은 saferuas 가 아닌 apache-tomcat 이슈입니다.

최근 발급 되는 인증서에서 제시하는 것과 보안 규정에 맞게 설정한 Cipher Suites 입니다. 내부 동작 테스트 시에 문제 없었습니다.
(※조치 참고 : https://www.opa.or.kr/front/bbs/BbsMain.do?menuNo=1000007 > 2019년 권장 알고리즘 및 TLS 1.2 설정 가이드)

ciphers=""TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,
TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,
TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,
TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,
TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256,
TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256,
TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA,
TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA,
TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,
TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384,
TLS_RSA_WITH_AES_128_CBC_SHA256,
TLS_RSA_WITH_AES_256_CBC_SHA256""

@이임재 대리님
상위의 Cipher Suites 로 기본 기능 체크를 부탁드립니다.

2023.11.13. 13:06
답글쓰기

프로필 사진
이임재
상위의 Cipher Suites로 기본 기능 확인해보겠습니다.

2023.11.13. 16:50
답글쓰기

프로필 사진
이임재
/usr/local/apache/conf/server.xml

상기 조건에 맞게 설정한 Cipher Suites로
테스트 한 결과
2차인증 OTP 및 메일이 정상동작하는 것을 확인하였습니다.

version : 2.0.70.0 Build-2245",https://cafe.naver.com/pnpsecure2/6080
6079,[한국투자증권] DBSAFER LOG서버의 /home/dbsafer/data 파티션을 스토리지로 마운트 후 SWADE로 구성 가능여부,"[분류] (에러로그문의 / 기능로직문의 / 기타문의) 

기타문의

​

[고객사/채널사] 

한국투자증권

​

[이슈내용] 

1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0 

 - 해당사항 없음

​

2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항) 

 - 해당사항 없음

​

3. 특이사항 (연동 모듈, 커스텀 개발 등) 

 - 해당사항 없음

​

4. 사내 재현 정보 

 - 해당사항 없음

​

5. 요청사항 

 - 고객사에서 DBSAFER 서버 신규구축시 나온 문의사항입니다.

 - /home/dbsafer/data 영역을 스토리지로 mount 후 SWADE로 구성가능한지 확인 부탁드립니다. 

​

[모듈 로그(Debugging 로그 및 ERROR 로그] 

(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함) 

​

​

[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등) 

​

​

​

[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","김태윤
담당자를 통해서 확인 결과 별도 스토리지로 mount할 경우에 대해서는 지원이 어려운 것으로 확인되었습니다.",https://cafe.naver.com/pnpsecure2/6079
6078,[TIP] Oracle Exadata Database Machine에 설치 된 Oracle 서비스 미로깅 및 정책 제어 불가 현상 조치 내역 공유,"[요약]

- Exadata Database Machine에 올려져 있는 Oracle DBMS의 리스너에 기본으로 사용자 - 종단 간 암호화 필수 설정이 들어가 있어 DBSAFER가 패킷을 파싱하지 못하여, 제어 및 로깅이 불가할 수 있습니다.

 > SQLNET.ENCRYPTION_SERVER

 > SQLNET.ENCRYPTION_CLIENT

 > SQLNET.CRYPTO_CHECKSUM_CLIENT

 > SQLNET.CRYPTO_CHECKSUM_SERVER

의 설정 값을 REJECTED로 변경하여 해당 현상을 해결 할 수 있습니다. (암호화 필수 설정 시 REQUIRED 값으로 설정됨)

​

[고객환경]

1. 구성 : DBSAFERv5.0 Default 1대

2. OS : CentOS 7.8

​

[이슈내용]

1. 신규로 등록한 Oracle DBMS서비스에 대하여 정책 제어 및 미로깅 현상 발생

​

[확인사항]

1. 해당 Oracle이 설치된 서버장비 확인

- 확인 결과 : Oracle Exadata Database Machine 으로 확인됨

​

2. User to DBSAFER, DBSAFER to DB 패킷덤프하여 확인 

- 확인 결과 : User to DBSAFER 구간 암호화 통신확인

​

3. Exadata Database Machine에 설치된 Oracle의 리스너에 기본적으로 사용자 - 종단 간 암호화 필수 설정이 들어가 있을 수 있음을 확인하여 담당자에게 해당 설정 내용 확인 부탁함

- 확인결과 사용자 - 종단 간 암호화 필수 설정됨 확인


암호화 필수 설정 시 User to DBSAFER 패킷


암호화 필수 설정 해제 시 User to DBSAFER 패킷

​

[원인분석]

1. 발생 원인 

- 사용자와 DB간 암호화 통신을 사용하여 패킷 내용 해석이 불가하여 해당 서비스에 대하여 정책 제어 및 로깅 불가

​

[조치사항]

1. Oracle 리스너에 설정된 

 > SQLNET.ENCRYPTION_SERVER=REQUIRED

 > SQLNET.ENCRYPTION_CLIENT=REQUIRED

 > SQLNET.CRYPTO_CHECKSUM_CLIENT=REQUIRED

 > SQLNET.CRYPTO_CHECKSUM_SERVER=REQUIRED

의 설정 값을 REJECTED로 변경한 후 접속 테스트 진행

- 정책 제어 및 로깅 확인

​

[추가 내용]

- 고객사에서 해당 DBMS서비스에 대하여 같은 증상이 발생하였을 때, Oracle 리스너 설정을 확인해 보는 것도 좋을 것 같습니다.

​

이상입니다.

감사합니다.","강정근
최근 pnp_ssl_proxy 대상으로 Oracle 의 암호화통신(SSL) 사용환경에 지원 기능을 추가하였습니다.

해당 환경 SSL암호화 통신을 사용하고 있다면, QA 대상으로 적용 테스트를 문의해봐주시기 바랍니다.

PS. 암호화된 패킷은 가급적 follow stream 이 아닌 전체 패킷 목록을 캡쳐하여 보여주시는게 좋습니다.

2023.11.10. 23:04
답글쓰기

프로필 사진
오석민
안녕하세요. 부장님
해당 고객사에서 pnp_ssl_proxy 모듈을 사용하고 있지 않아, 암호화 통신 기능 해제 후 해당 이슈 마무리하였습니다.
또한, 말씀 주신 내용대로 앞으로 암호화된 패킷은 전체 패킷 목록을 캡처하여 작성하겠습니다.
조언 주셔서 감사합니다.",https://cafe.naver.com/pnpsecure2/6078
6077,[공유] PC ASSIST 3.3.X.X 버전으로 업그레이드 후 트레이아이콘 통해 IM 접속 시 404에러 발생 현상,"안녕하세요

클라우드기술팀 손혁진입니다.

​

KCC 고객사에서 PC ASSIST 3.3.X.X 버전으로 업그레이드 후 404에러가 발생되는 현상이 있어 아래와 같이 조치 된 

내용 공유 드립니다.

고객사 환경

-OS : CentOS 6

-DBSAFER : V5.0

- 구성 : PC ASSIST 3.3.1.6

- IM PKG : V1.3.0.0 Build-2385

[요약]

 ※본 내용은 PC ASSIST 3.3.X.X 이상 및 IM 1.5.4.X 미만 버전 사용 시 발생되는 이슈기에 참고 바랍니다.

​

- KCC 고객사에서 PC ASSIST 3.2.36.1 -> 3.3.1.6 버전으로 버전 업 진행

- PC ASSIST v3.2.36.1 버전 트레이아이콘 통해 IM 접속 시 자동 로그인으로 접속

- PC ASSIST v3.3.1.6 버전 트레이아이콘 통해 IM 접속 시 404 에러 발생

- pnp_oms_dms.conf 내 IM_VERSION = 99 설정 후 404에러 발생 해결

  . IM_VERSION은 2이상 어떤 값을 넣어도 위 이슈 해결 가능(사유는 상세 내용 참고)

​

※ IM 1.5.4.X 미만 버전 사용 시 아래와 같이 동작

​

IM_VERSION = 0

IM_VERSION = 1

IM_VERSION = 2이상

PC ASSIST v3.2.X.X

404 에러

기본 브라우저통해 IM 페이지 호출

(ASSIST HOST 통해 IM 접속)

기본 브라우저통해 IM 페이지 호출

(ASSIST HOST 통해 IM 접속)

PC ASSIST v3.3.X.X

404 에러

404 에러

기본 브라우저통해 IM 페이지 호출

(ASSIST HOST 통해 IM 접속)

※ IM 1.5.4.X 이상 버전 사용 시 아래와 같이 동작

​

IM_VERSION = 0

IM_VERSION = 1

IM_VERSION = 2이상

PC ASSIST v3.2.X.X

404 에러

기본 브라우저통해 IM 페이지 호출

(ASSIST HOST 통해 IM 접속)

기본 브라우저통해 IM 페이지 호출

(ASSIST HOST 통해 IM 접속)

PC ASSIST v3.3.X.X

404 에러

Web Helper에 의해 IM 페이지 호출

(SSO 인증)

기본 브라우저통해 IM 페이지 호출

(ASSIST HOST 통해 IM 접속)

​

​

[이슈]

- PC ASSIST v3.3.1.6 버전 트레이아이콘 통해 IM 접속 시 404 에러 발생


​

[확인 내용]

 1. PC ASSIST 3.2.36.1을 정상 작동, 3.3.1.6은 비정상 작동 확인

    . pnp_oms_dms.conf > IM_VERSION은 동일하게 1로 테스트 완료


 2. PC ASSIST 로직 확인 결과 3.2.X.X 버전에서 pnp_oms_dms.conf 내 IM_VERSION 옵션 값은 0만 정의​​ 되어있음

   . PC ASSIST v3.2.X.X에서는 pnp_oms_dms.conf 내 IM_VERSION = 1에 대해 SSO 인증에 대한 정의 되지 않음

   . 정의되어있지 않는 0 초과의 값이 설정 되면 로직 상 DEFAULT로 빠져 SSO인증이 아닌 IM 로그인 페이지만 호출

   . 결국 페이지에서 ASSIST HOST를 받을 경우 ASSIST의 로그인정보가 ASSIST HOST로 전달

   . DBSAFER IM은 ASSIST HOST에서 로그인정보를 얻어 로그인이되어 자동 로그인 되는 구조

​

 3. PC ASSIST 로직 확인 결과 3.3.X.X 버전에서는 pnp_oms_dms.conf 내 IM_VERSION 옵션 값은 0,1에 대해 ​

    정의 되어있음

  . PC ASSIST v3.3.X.X 사용 시 pnp_oms_dms.conf 내 IM_VERSION = 1 통해 SSO 인증 수행은 

    DBSAFER IM v1.5.4 최신 버전에서만 호환 가능

    : 위 내용은 ASSIST HOST 통한 자동로그인과 전혀 다른 로직

​

[원인]

 - 고객사는 PC ASSIST 3.3.X.X 이상 및 IM 1.5.4.X 미만 버전 및  pnp_oms_dms.conf > IM_VERSION = 1로 세팅되어있는 상태에서 PC ASSIST 통해 IM 접속 시 호출 되는 SSO 인증 URL이 IM 1.5.4.X 미만 버전에는 반영 되어있지 않기에 404에러가 발생 됨

​

[조치 방법]

 - PC ASSIST 3.3.X.X 이상 및 IM 1.5.4.X 미만 버전에서 트레이아이콘 통해 기존과 같이 ASSIST HOST 통한 

    IM 접속 시 자동 로그인 사용이 필요하다면 pnp_oms_dms.conf 내 IM_VERSION 정의 되지 않은 2이상으로 

    설정 후 사용 필요 (IM_VERSION 옵션 설정 값은 99로 권장)

​

[별첨]

 - 위 내용을 PC ASSIST v3.3.X.X 및 DBSAFER IM v1.5.4.X 버전이상으로 테스트된 결과 공유드리겠습니다.

​

1. IM_VERSION = 0 일 경우 https://DBSAFER 로그 서버 IP:3443/dbsaferim/assist/assistsso.do URL을 호출

      : 404에러 발생

      : IM_VERSION = 0은 현재 지원하지 않는 URL 호출


2. IM_VERSION = 1 일 경우 https://DBSAFER 로그 서버 IP:3443/dbsaferim/sigininManager URL을 호출

      : Assist Web Sync Helper에서 실행


​

3. IM_VERSION = 2이상일 경우 DEFAULT로 빠져 기존 ASSIST-HOST로 자동로그인 수행

     : 기본 브라우저로 실행(ASSIST HOST가 자동 접속)


​

감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6077
6074,[TIP] decide3 로그 연동 시 pnp_connector 뷰테이블 생성 쿼리 공유,,"안녕하세요. 클라우드기술팀 김영은입니다.

​

고객사 decide3 로그 연동 시 작성한 pnp_connector 뷰테이블 생성 쿼리 공유드립니다.

아래에 뷰테이블 생성 전 테이블 데이터를 확인하고 분석하는 과정도 포함해두었으니,

decide3가 아닌 다른 커스텀 뷰테이블을 생성하실 때도 도움이 되셨으면 좋겠습니다:)

[고객사 요구사항 및 뷰테이블 사용 목적]

- SIEM 연동으로 결재 내역에 대한 감사로그 수집하기 위함

- 결재 처리가 되지 않은 문서에 대한 알림 설정을 위함

- 기안 문서번호(ex. BT-20231031-000015) 컬럼이 뷰테이블에 포함되기를 원함(데이터 식별 목적)

​

​

[고객사 환경]

- DBMS만 사용

- 사용하는 기안 문서: 접속 기안, 명령어 유형 기안, 비정형화 명령어 기안, 마스킹 해제, 중요 테이블 권한 신청

​

​

[decide3 테이블 데이터 확인]


- 테이블마다 기안 문서 1개당 추가되는 데이터 행 수가 다름

   . doc, doc_ attach_info 테이블: 기안 문서 1개당 데이터 행 1개 추가

   . doc_sign 테이블: 결재선에 포함된 인원(기안자 포함)만큼 데이터 행 추가

   . doc_attach_command 테이블: 비정형화 명령어 기안, 명령어 유형 기안 문서일 경우에만 데이터 행 추가

                                                               (* 비정형화 명령어 기안은 입력한 명령어 수만큼 데이터 행 추가)

   . doc_attach_service 테이블: 기안 문서에 포함된 DBMS 서비스 수량만큼 데이터 행 추가

                                                           (* 중요 테이블 기안 문서가 추가될 때는 데이터 행이 추가되지 않음)

​

​

[커스텀 뷰테이블 생성 요약]

1. 결재 내역 감사로그 수집을 위한 뷰테이블

   1) decide_doc: 기안 문서 정보(기안자, 기안일자, DBMS 서비스, 명령어 등)

총 5개의 테이블 사용

- decide_log_[[YYYY]]_[[MM]].doc_[[DD]]

- decide_log_[[YYYY]]_[[MM]].doc_attach_service_[[DD]]

- decide_log_[[YYYY]]_[[MM]].doc_attach_info_[[DD]]

- decide_log_[[YYYY]]_[[MM]].doc_attach_command_[[DD]]

- dbsafer3.cert_history 

   2) decide_doc_sign: 결재선 정보

총 3개의 테이블 사용

- decide_log_[[YYYY]]_[[MM]].doc_[[DD]]

- decide_log_[[YYYY]]_[[MM]].doc_sign_[[DD]]

- dbsafer3.cert_history

결재선에서 데이터 중 기안자는 제외(실제 결재자 데이터만 추출)

2. 결재 처리가 되지 않은 문서 정보 확인을 위한 뷰테이블

   1) remain_decide_doc: 결재 처리가 되지 않은 기안 문서 정보

총 1개의 테이블 사용

- decide.remain_doc

   2) decide_doc_sign:  결재 처리가 되지 않은 결재선 정보

총 2개의 테이블 사용

- decide.remain_doc_sign

- dbsafer3.cert_history

결재선에서 데이터 중 기안자는 제외(실제 결재자 데이터만 추출)

​

* remain_doc, remain_doc_sign 테이블을 따로 생성하는 이유

-  날짜가 포함된 테이블로 View 테이블을 생성하면, pnp_connector.conf에서 설정된 VIEW_LINKAGE_DAYS 값만큼만 데이터 조회 가능

        ex) 오늘이 2023년 11월 1일이고, VIEW_LINKAGE_DAYS이 3으로 설정되어있다면 날짜 정보로 생성된 View 테이블에서는 2023년 10월 30일부터 11월 1일까지의 결재 데이터만 조회 가능함

-  결재 처리가 되지 않은 모든 문서 정보 확인을 위해 날짜 정보가 포함되지 않은 테이블을 이용해 remain_doc, remain_doc_sign 테이블 생성

​

​

[작성 쿼리]


decide_doc.sql


decide_doc_sign.sql


remain_doc.sql


remain_doc_sign.sql

​

​

[테이블 명세서]


decide_doc 테이블 명세서


decide_doc_sign 테이블 명세서


remain_doc 테이블 명세서


remain_doc_sign 테이블 명세서

​

 
[클라우드기술팀] pnp_connector custom view 연동 사례_김영은.pdf
[클라우드기술팀] pnp_connector custom view 연동 사례_김영은.pdf Sign In

drive.google.com

첨부파일
decide 뷰테이블 생성 쿼리 및 테이블 명세서
.zip",https://cafe.naver.com/pnpsecure2/6074
6067,[KB헬스케어] 관리자 2차인증 적용 후 키 발급 실행 시 수행되는 내용 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의) 

기능로직문의/기타문의

​

[고객사/채널사] 

KB헬스케어

​

[이슈내용] 

1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0 

- 관리자 2차인증 적용 후 키 발급 수행 시 'OTP KEY 발급 요청 성공' 팝업은 출력되나 반응/변화 없음

​

2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항) 

[확인 내용]

1) 매니저 로그인 시 2차 인증 사용 + OTP ID 직접 입력 사용



- 키 발급 수행 시 서버에 출력되는 general log 내용


 

2) 매니저 로그인 시 2차 인증 사용 + 관리자 계정 2차 인증 사용

- 발급 수행 시 별도 페이지 나타남



3) 매니저 로그인 시 2차 인증 사용 + OTP ID 직접 입력 사용 + 관리자 계정 2차 인증 사용

- OTP ID 입력 팝업이 나타나지 않으며, 2안과 동일하게 나타남



3. 특이사항 (연동 모듈, 커스텀 개발 등) 

- 해당사항 없음

​

4. 사내 재현 정보 

192.168.111.32 root/dbsafer00

​

​

5. 요청사항 

- 고객사는 1차로 최고 관리자 계정으로 로그인 한 후 OTP ID 입력을 통해 일반 관리자 계정의 OTP 로  로그인을 요청합니다. 

- 키 발급 수행 시, 별도 페이지가 나오는 것을 예상하였으나 해당 로직이 아닌 것으로 판단되어 문의 드립니다.

  관리자 2차인증 적용 후 키 발급 실행 시 수행되는 내용 확인 부탁드립니다.

- 예상 내용처럼 로직 변경이 가능한 경우, 벅스 추가 등록하도록 하겠습니다. 

    

[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등) 

- saferuas.war.2.0.72.0_Build-2248_20230814.tgz

- Enterprise_Manager(x64)_Build-6927[5E]_Setup.exe","김태윤
관리자 계정에 대해서 OTP 설정 방법에 대한 부분 확인하여 올릴 수 있도록 하겠습니다.

2023.11.13. 17:19
답글쓰기

프로필 사진
박소현
연구소에서 연락 받은 내용에 따르면 로직 상 키 발급 수행 시 별도 페이지가 출력되어야 하나, 보안계정 연동 방식을 통해 생성된 관리자 계정에 대해서는 별도 페이지가 출력되지 않도록 설정되어 있는 상황입니다. (*현재 ""관리자 계정"" 2차인증 시에만 별도 페이지 설정되었을 때 동작하도록 되어있음)

해당 내용은 수정 가능하다고 하셔서 벅스로 기능 수정 요청드린 상황입니다. (https://bugs.pnpsecure.com/view.php?id=26453)",https://cafe.naver.com/pnpsecure2/6067
6064,[국방 DIDC 1센터] 단독-단독 구성 시 2대의 DB가 Split Brain 상태 시 확인 요청,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
국방 DIDC 1센터
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크
- 두대의 DBSAFER DB에서 Split brain이 발생하였음
- 서비스 객체 등록 진행 후 DBSAFER 시스템 점검 진행하였지만 로그가 쌓이지 않는 것을 확인 (객체 정상 등록 팝업 및 객체 추가된 것을 확인 / 객체 등록시에는 Split brain이 발생한지 몰랐던 상황)
- Split brain 및 Failover가 된 것을 확인하여 DB 재기동 후 Active 서버 정상화 진행 (grastate.dat / galera.cache 파일 경로 이동 후 재기동)
- 정상화 이전에 등록된 서비스 객체가 누락
- 정상화 이전 감사 로그도 쌓이지 않는 것을 확인 (대략 일주일)
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- Split Brain 발생 사유는 모듈 및 DB 로그 확인시 DB Connection time out 현상 발생으로 네트워크쪽 문제가 있었던 것으로 보여짐
- 해당 현상 발생 후 두대의 DB가 Split Brain 상태로 넘어가 Failover 된 것으로 보여짐
- 로그 조회가 안되어 정상화 후 DB 접속하여 확인 시 로그 테이블(10월 말) 및 DB(11월) 생성이 안되어 있는 것을 확인
- 서비스 모듈 및 로그 모듈에서 DB 접속이 안되는 로그 확인 및 쿼리 실행이 안된다는 로그 확인
- Failover 되고 사용자의 DBSAFER 서비스 이용에는 영향 없음
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 없음
4. 사내 재현 정보
- 없음
5. 요청사항
- 양쪽에서 Split brain이 발생 시 모듈에서 DB 접속이 불가하고 쿼리 실행이 안되어 감사로그 테이블 및 DB 생성이 안되어 로그가 쌓이지 않는 현상에 대하여 해결 방법 요청
- 단독/단독 구성에서 두대의 DBSAFER의 DB가 Split Brain 상태여도 Failover 이후 Manager 접속하여 서비스 객체 등록이 가능한 이유 확인 요청
- 누락된 데이터에 대한 복구 방법 확인 요청(서비스 객체)
- pnp_ha.ini conf 파일에서 [galera] 옵션중 db_connection_timout(default 10초) 설정을 변경하여 적용하면 네트워크의 문제로 DB가 끊기는 것 예방 가능한지 확인 요청
- 동일하게 네트워크 문제로 DB가 끊기고 Split brain이 발생 시 동일한 현상(데이터 유실 -> 서비스 객체, 로그)이 일어나지 않도록 설정 변경만으로 해결이 가능한지 확인 요청
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
사이트 특성상 반출 불가
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
PKG : PKG_DBSAFER7_RelV7-R22.11-RHEL8_x86_64_20230615.tar.gz
pnp_ha : PNP_HA v1.2.21 [Aug 22 2023]
pnp_galera : GALERA Release for RelV7-R23.05-RHEL8 (Rev 22)
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","문금주: Split Brain 이 발생하였다고 하여 DB에 쓰기 금지가 걸리거나 하지 않기 때문에 당연하게도 객체 추가 및 변경이 가능합니다.

GALERA Cluster 복구의 경우 무작정 Active 노드를 재 시작 하는것이 아닌, grastate.dat 파일의 safe_to_bootstrap 값(1)을 기준으로 복구 노드를 선정, 이후 다른 노드를 기동하셔야 정상적으로 복구가 가능합니다.
(만약 둘다 -1일 경우 다른 방법으로 데이터 확인 후 복구해야 합니다)

즉 정상적인 확인 절차 없이 DB를 기동하여 이전 데이터가 기록된 노드 기준으로 동기화가 반영되어 데이터가 유실된 것으로 보이며 복구는 불가능 할 것으로 판단됩니다.

품질보증팀에서 이와 같은 복구 절차 등에 대해 상세히 가이드 되는 것이 좋을 것 같습니다. | 여성구: 조금 불명확하게 쓰여진 부분이 있습니다. 내용을 볼 때 Active 과 Standby 중 1개 서버에서만 DB 오류(가동 정지)가 된 것 같습니다. 이 때 내부에서 가이드 한 것 처럼 Split brain 으로 표시 됩니다.

1. pnp_ha 의 상태가 Split brain 이지만 1대는 정상이였던 것 같습니다.
> 그러므로 매니저 접속 가능
2. 복구 시에 비정상인 DB 를 기준으로 초기화 된 것 같습니다.
> 로그 누락 발생

이전에 사내에서 설명 했지만 마지막까지 동작되는 DB 를 기준으로 가동이 되어야 합니다. 지금은 그렇지 못햇던 것 같습니다.",https://cafe.naver.com/pnpsecure2/6064
6055,[현대홈쇼핑] SAFERUAS OTP 인증 시 인증 실패 관련 문의 드립니다.,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
에러로그문의
[고객사/채널사]
현대홈쇼핑
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
- 기존 서버(AS-IS) DEFAULT GW
> DBSAFER 5.0 / CentOS7.8
> SAFERUAS 2.0.11.7
> COMMON_UTIL : v1.29.55
: 기존 서버 <> OTP 인증 / test(2차인증페이지) 시 정상적으로 패킷이 나가며, 정상적인 request를 받아옴
- 신규 서버(TO-BE) DEFAULT GW
> DBSAFER 5.0 / RHEL 8.4
> SAFERUAS 2.0.69.0 Build-2242 // 모든 otp 시도는 '테스트(debug)' 모드로 설정 후 진행하였습니다.
> COMMON UTIL : v2.32
: SECRETKEY 확인 완료 / OTP 엔지니어와 확인 시 OTP 서버 측에도 별다른 에러 로그 발생 X
: catalina.out 로그 내 아무런 로그 발생 X
: 신규 서버 <> otp 인증 / test(2차인증페이지) 시 패킷이 나가지 않음 > 패킷 나가지 않을 경우 OTP 에도 나가지 않는 것으로 확인됨
: 미래테크, 일반, griffin 설정 다 해보아도 증상 동일
: 2차 인증 페이지에서 TEST 시도 > F12 스크립트 확인 시 ERROR 발생 (사진첨부)
: catalina.out / saferuas.log 확인 시 ERROR 라고 볼 만한 내용들이 없어 분석 요청 드립니다.
: DBSAFER AGENT 로그에서는 '[ERROR] 수신데이터 구문분석에 실패하였습니다. (CLinkage::ConfirmSecondAuthentication,2300)' 에러 발생
Next image
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- 방화벽쪽으로는 설정이 다 되어 있는 것으로 보입니다.
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 기본 모듈
4. 사내 재현 정보
- N/A
5. 요청사항
- 로그 분석 요청을 통해 원인이 밝혀져 문제 해결에 도움 주시면 감사하겠습니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
saferuas/engineer/ 에서 test 시
: Error Message - ""Communication failed or take error Error : error Error Thrown"" 팝업 발생
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
PKG : PKG_DBSAFER5_R22.05CR1-RHEL8_X86_64_P9.11_2F
ASSIST : 3.2.36.18
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
- DBSAFER_ASSIST_231101.log : DBSAFER AGENT 로그
- saferuas_231101.log : saferuas 로그
첨부파일
saferuas_231101
.log
null
파일 다운로드
첨부파일
DBSAFER_ASSIST_231101
.log
null
파일 다운로드
###2023-11-02 이임재 대리 요청으로 추가 확인한 내역
- saferuas 엔지니어 페이지 설정 전달
> 이임재 대리 요청 : OMS_DMS IP에 서버 ip port 입력 후 OTP TEST 요청
> 확인 결과, 동일 현상 발생","이임재: 엔지니어 페이지 세부 정보 요청중 | 이창제: 세부 정보 전달 완료 및 요청 내역 결과 추가 등록하였습니다.

확인 해주시면 감사하겠습니다. | 김영회: Radius OTP 가 특정 사이트들에서 간헐적으로 안되는 현상이 발생하고 있으며
이에 따라 Radius OTP 라이브러리를 최신화 한 버전이 있습니다. (2.0.70.0 Build-2245)

관련 bugs > https://bugs.pnpsecure.com/view.php?id=25608
관련 버전 > https://bbs.pnpsecure.com/showthread.php?tid=12687

참고 부탁 드립니다. | 이창제: [추가 진행사항 (2023/11/07)]
- 11/08(수) 방문하여 가이드 주신 saferuas 2.0.70.0 Build-2245로 패치 예정 | 이창제: [추가 진행사항 (2023/11/08)]
- saferuas 2.0.70.0 Build-2245로 패치 후 정상 동작 확인

빠른 지원 해주셔서 모두들 감사드립니다.",https://cafe.naver.com/pnpsecure2/6055
6041,[대우건설] Server Agent가 설치된 윈도우 서버에 우회접속 시 존재하지 않는 정책이 로그에 찍히는 현상 발생 원인 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
에러로그문의
[고객사/채널사]
대우건설
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
SA가 설치된 윈도우 서버의 mssql 우회접속 시 매니저상에 존재하지 않는 정책명이 로그상에 표시됨
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- DB상에서 정책이 제대로 업데이트 안된 것으로 판단하여 policy_db_acl 테이블 확인하였으나, 문제의 정책 미존재
- Server Agent 업그레이드 및 server_manager 모듈 재시작 후에도 동일 증상 발생
- access_rule 파일 확인 결과 계속해서 문제의 정책 받아오는 것 확인
3. 특이사항 (연동 모듈, 커스텀 개발 등)
없음
4. 사내 재현 정보
없음
5. 요청사항
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
pnp_server_manager 로그
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
Server Agent 5.1.6.33
Server Manager Build (177)
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
첨부파일
access_172.20.2.179
.rule
null
파일 다운로드
첨부파일
access_172.20.2.179.rule
.bak
null
파일 다운로드
첨부파일
alias_172.20.2.179
.conf
null
파일 다운로드
첨부파일
alias_172.20.2.179.conf
.bak
null
파일 다운로드","신호철: 서버매니저가 해당 서버에 정책을 반복적으로 배포하는 동작을 보면, 대상 서버에 배포된 정책이 변경 되는 것으로 예상됩니다.
혹시 해당 서버에 정책을 배포할 수 있는 다른 DBSAFER 서버가 있나요? 두개의 DBSAFER 서버에서 동일한 대상서버를 등록했을 때 발생할 수 있는 증상으로 보여집니다.

정확한 확인을 위해서는 alias.conf/access.rule (bak 파일 포함) 을 수집 부탁드립니다. | 한성영: 현재 고객사에서는 하나의 DBSAFER 서버만 운용 중이며, 추가적으로 파일 업로드 드립니다. | 신호철: alias 파일을 보면, 172.20.4.132 IP로 설정된 단독 DBSAFER 서버에서 대상서버에 정책을 배포하고 있습니다.
위 IP 및 서버 확인 부탁드립니다.",https://cafe.naver.com/pnpsecure2/6041
6036,[TIP] pnp_connector를 통한 뷰테이블 생성 후 QueryBox 이외의 Tool로 데이터 조회 시 한글 깨짐 현상 조치 내용 공유,"[요약]
- 고객사에서 pnp_connector를 통해 감사로그 뷰테이블을 생성해 주었으나, 로그연동 회사에서 한글에 대한 데이터가 깨진다는 문의가 왔습니다.
- 보통 로그연동 회사에서 pnp_connector를 통해 생성된 뷰테이블의 한글에 대한 컬럼은 CONVERT 과정을 통해 데이터를 가져가는 것으로 알고 있는데, 해당 로그연동 엔지니어가 한달 가량 처리를 하지 못하여 지원하였던 내용입니다.
- 굳이 우리 엔지니어가 해당 문제에 대해 시간 쓸 필요 없이, 로그연동 솔루션 회사에 아래 방법과 같이 SELECT 쿼리를 수정해서 해보라고 하면 대부분의 문제가 해결될 것으로 보여져 내용 공유 드립니다.
[버전정보]
- dbeaver 23.1.1, Mysql Worckbench 8.0 CE 등등
[상세내역]
- 사내테스트 진행 내역
1) pnp_connector를 통해 생성한 뷰테이블 데이터 Select 진행
- QueryBox 정상적으로 잘 보임 (QueryBox 자체에서 CONVERT를 진행해 주는 것으로 확인됨)
- Dbeaver, WorkBench 깨져서 보임 (CONVERT 과정이 없어 어떤 캐릭터셋을 지정하든지 다 깨짐)
2) CONVERT 함수를 통해 바이너리 변환 이후 다시 원하는 캐릭터 셋으로 변환
- 공유 드리는 4개의 SELECT 쿼리 중 한 가지에는 걸려 한글이 정상적으로 보일것으로 확인됩니다.
CONVERT 함수 적용된 쿼리 공유
SELECT CONVERT(CONVERT(policy_name USING BINARY) USING latin1) AS latin1,
CONVERT(CONVERT(policy_name USING BINARY) USING utf8) AS utf8,
CONVERT(CONVERT(policy_name USING BINARY) USING euckr) AS euckr,
CONVERT(CONVERT(CONVERT(policy_name USING BINARY) using euckr) using utf8) AS two_conv
FROM connector.auth_log;
이상입니다.
감사합니다.
* 수정이 필요한 부분이나 개선사항이 있다면 댓글로 남겨주시면 감사하겠습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6036
6035,[TIP] pnp_oms_dms 모듈의 NAT_DOMAIN_CYCLE 옵션을 통해 RDS IP가 동기화 되지 않을 시 체크사항,"pnp_aws_service 모듈 사용 환경에서 RDS 서비스 객체들에 대해 pnp_oms_dms 모듈의 NAT_DOMAIN_CYCLE 옵션이 적용되지 않을 수 있는 case와 대응방안 공유드립니다.
1. 현상
- RDS failover에 의해 도메인 주소는 변함 없으나 DNS주소에 의해 반환되는 RDS의 IP주소 변동 시 NAT_DOMAIN_CYCLE = 60 (초 단위 동작) 옵션에 의해 1분 내로 변동된 IP주소 정보를 NAT list에 동기화 하여야 하나 동기화 하지 못하여 DBSAFER를 통한 해당 RDS 접속이 약 1시간 동안 불가
RDS 서버 IP 변동
약 1시간 동안 변동된 IP를 동기화 하지 못함
2. 원인
- pnp_aws_service 모듈의 service.iprange.usable 옵션을 true로 활성화하여 사용중일 경우 도메인 주소 형식으로 등록된 RDS 서버들의 IP 정보를 pnp_aws_service 모듈이 조회하여 dbsafer3.cloud_ip_range 테이블에 insert
- service.iprange.period = 60 (분 단위 동작) 디폴트 옵션에 의해 dbsafer3.cloud_ip_range 테이블에 등록된 서비스 객체의 경우 DBSAFER Agent의 동기화 동작에 의해서 NAT list에 서버 IP 정보를 동기화하지 않도록 제외되며 pnp_aws_service 모듈이 사용자 DBSAFER Agent의 Nat list에 RDS 서버의 IP를 직접 동기화 하도록 동작함
- NAT_DOMAIN_CYCLE은 기본 60초 주기 동작이나, pnp_aws_service iprange 동기화 옵션은 기본 60분 주기 동작이므로 RDS의 도메인주소에 매핑되는 IP가 변경될 시 최대 1시간동안 NAT리스트에 변동된 IP를 반영하지 못하여 RDS DB 접속이 불가할 수 있음
3. 대응 방안
- service.iprange.period = 60 (분 단위 동작) 디폴트 옵션 주기를 1시간보다 짧게 변경하여 RDS 도메인 주소에 매핑되는 IP가 변동되더라도 짧은 시간내에 해당 정보를 NAT list에 반영할 수 있도록 변경
(서비스 객체가 많은 환경에서 service.iprange.period = 60 주기를 너무 짧게 조정할 경우 문제가 될 수 있으므로 유의)",댓글 없음,https://cafe.naver.com/pnpsecure2/6035
6034,[한국투자증권] /dbsafer/.conf/gworder.conf 파일의 용도 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기능로직문의
[고객사/채널사]
한국투자증권
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
- 해당사항 없음
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- 해당사항 없음
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 해당사항 없음
4. 사내 재현 정보
- 해당사항 없음
5. 요청사항
- 한국투자증권에서 conf 파일 수정에 대한 감사진행 중 /dbsafer/.conf/gworder.conf 파일의 변경이력 확인
- 고객사 담당자가 소명을 하기 위해 /dbsafer/.conf/gworder.conf 파일의 용도 및
dbsafer의 프로세스가 gworder.conf를 변경하는 로직이 있는지 확인 요청
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","최재규: 해당 파일은 oms_dms에서 읽는 파일이며 몇번째 GW인지 판단하는 용도로 사용이 됩니다.
파일 생성은 pnp_slave에서 합니다.
pnp_agent 에서 pnp_slave로 연결할 때 플래그를 보내며 이 때 slave 에서 파일을 생성합니다.",https://cafe.naver.com/pnpsecure2/6034
6028,[롯데손해보험]db_query 테이블의 query_info 값 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
롯데손해보험
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
- 해당사항 없음
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- 해당사항 없음
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 해당사항 없음
4. 사내 재현 정보
- 해당사항 없음
5. 요청사항
-롯데손해보험에서 로그연동을 위해 db_query 테이블의 query_info 컬럼의 값에 대한 매핑 정보요청
- dbsafer3.querytypes의 정보를 전달했지만 querytypes테이블에 존재하지 않는 값이 존재해서 아래의 값에 대한 매핑 정보 요청드립니다.
- 7789, 6481, 17241, 12355, 461, 749, 17275, 14673
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","최재규: 쿼리타입 정보 전달드립니다.
EL_ 붙은값과 DML/DDL/DCL이 & 연산된 결과가 query type입니다
EX) 1 (EL_SELECT) & 4096(T_DML) = SELECT (4097)

다만 전달주신 값에 대해서는 존재하지 않는 값입니다.
pnp_log에서 값을 넣어줄 때 querytype을 확인해서 넣어주는데, 들어갈 수 있는 값의 범위는 DB에 있는 값 말고는 없는 상황입니다.

개인 라인을 통해서 connector로 연동을 진행하고 있으나 감사로그를 변조시키는 동작은 없다는 것을 확인해주셨는데, 이런 경우 서비스모듈과 log모듈 디버그로 실행한 후 문제가 발생하는 쿼리를 다시 실행해서 분석이 필요할 것 같습니다.
가능하면 패킷도 같이 수집 요청드리며 해당 이슈는 벅스에 등록 부탁드립니다.

| MASK_EL | 4095 |
| EL_SELECT | 1 |
| EL_INSERT | 2 |
| EL_UPDATE | 3 |
| EL_DELETE | 4 |
| EL_TRU",https://cafe.naver.com/pnpsecure2/6028
6027,[현대CCS2 북미] Terminal 세션 접속이 빨리 끊기는 현상,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기능로직문의
[고객사/채널사]
현대 CCS2 북미
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크
- DBSAFER v5.0을 통해서 Terminal 서비스 접속 시 세션이 빨리 끊기는 현상
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- 방화벽 및 네트워크 장비 등 에서 Session idle Time 제한을 두지 않음
- DBSAFERv5.0 서버에서 /etc/profile 에 TMOUT 설정이 되어 있음
예시
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- DBSAFER v5.0을 통해서 TERMINAL 서비스 접속 시 아무것도 입력하지 않으면 DBSAFER 서버에서 설정한 TMOUT 시간에 맞게 끊기는 현상
- DBSAFER v5.0을 통해서 TERMINAL 서비스 접속 시 명령어 1개 이상 입력하면 DBSAFER 서버에서 설정한 TMOUT 설정과 무관하게 끊기지 않는 현상
- ssh_proxy 모듈 사용 X
4. 사내 재현 정보
DBSAFER 정보 : 192.168.112.38 / 22 / 단독 구성
root / dbsafer00
대상 서버 : 192.168.112.43 /22 (root / dbsafer)
보안계정 정보 : dbsafer /dbsafer00))
5. 요청사항
사용자가 dbsafer를 통한 대상 서버 접속 시 서비스 모듈에서 DBSAFER 서버의 /etc/profile을 바라보는지 궁금합니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","진선태: * 답변:
pnp_sshd를 거쳐서 접속한 SSH 서비는 DBSAFER 내의 /etc/profile 값이 세션 접속 초기 적용되고, 명령어 입력등의 작업이 시작되면 세팅을 바꾸도록 되어 있습니다.

* 설명:
pnp_sshd 를 거쳐서 ssh 서버에 접속할 경우 DBSAFER 내의 /dev/pts(Pseudo Terminal) 디바이스를 가상으로 할당하기 때문에 DBSAFER 내의 /etc/profile을 타게 되어 있습니다. ssh접속한 후에 특정 패턴이 있거나 최초 명령어를 입력값이 있는 경우 TMOUT 제한을 없애도록 하는 코드가 있는데, 그 부분을 세션 초기 시작부터 적용하면 세션 연결에 영향을 주기 때문에 조금 늦게 반영됩니다. SSH 접속되는 반응속도와 초기 출력되는 내용에 따라서 조금씩 반응은 다르지만 아무튼 작업이 시작되면 문제 없도록 조치되어 있습니다.

* 추가 개선 방법
###############
# 아래의 스크립트코드를 GW 장비의 /etc/profile 의  | 진선태: 관련된 문제에 대하여 형상관리 서버에 등록된 내용도 함께 공유 드립니다.


r136 | zalhae | 2013-09-11 11:40:30 +0900 (2013-09-11, 수) | 25 개의 행
변경된 경로:
M /branches/protocol_3/channels.c
A /branches/protocol_3/etc_profilie.txt
M /branches/protocol_3/proxy_func.h
M /branches/protocol_3/serverloop.c
M /branches/protocol_3/sshlogin.c
M /branches/protocol_3/version.h

[dbsafer_sshd][v2.30.54][진선태][RV:양문섭][BT:4911]

[문제]
- GW장비에 TMOUT값을 설정할 경우 가끔씩 작업 대기중인 세션이 끊어짐 (특히 tail ?f 과 같은 경우)
- 확인: 테스트 기간 중 문제가 지속 발생되었던 GW장비에 TMOUT=0으로 설정하였더니 | 전준호: 안녕하세요. 진선태 부사장님.
프로젝트 1팀 전준호입니다.

문의사항에 대한 답변 및 조치 방안 전달해 주셔서 감사합니다.
전달해주신 내용 기반으로 사이트에 조치할 수 있도록 하겠습니다.

앞으로 이전에 개선되었던 내용들에 대해서 다시 돌아볼 수 있도록 하겠습니다.

다시 한번 감사드립니다.",https://cafe.naver.com/pnpsecure2/6027
6026,[공유][SK C&C] WEB Console 을 통한 Dynamo DB 접속 시 서비스를 로깅 할 수 있도록 설정하는 방법,"AWS Web Console 을 통해 DynamoDB를 접속할 때,
DBSAFER에서 서비스 로깅을 확인할 수 있도록 설정하는 방법을 공유드립니다.
현재 DynamoDB는 공식 지원 불가이나, 고객 측 요청 사항으로 지원하게 되었음을 덧붙여 전달드립니다.
[동작방식]
1) AWS Console에서 직접 AWS DynamoDB 서비스 접속
2) AWS CloudTrail에서 DynamoDB 서비스 접속 작업 캡쳐
3) AWS CloudTrail에서 작업 캡쳐 본을 AWS S3 bucket에 로깅
4) DBSAFER DynamoDB log_collector는 AWS Console 사용 로그를 AWS CloudTrail에게 수집
5) 수집된 데이터를 DBSAFER Log 데몬에게 전달해 로깅
WEB Console 접속 시 로그 동작 방식
[설정 방법]
1) DynamoDB 서비스 객체 등록
(1) 서버 주소/포트 내용은 dynamodb.ap-northeast-2.amazonaws.com : 443 으로 설정
서비스 객체 설정
2) dynamodb_log_collector 설정
(1) dynamodb_log_collector 모듈 경로 : https://bbs.pnpsecure.com/showthread.php?tid=7186 (v1.1.4는 모듈 빌드 요청)
(2) dynamodb_log_collector_1.1.4 모듈을 /dbsafer 경로에 압축 해제
(3) dynamodb_log_collector.properties 설정
- 블록 처리된 부분은 필수 입력 값
- CloudTrail에 접근 권한이 부여된 사용자의 access key 와 secret key를 고객에 요구
- collector_period 는 최소가 900 (15분) 이며, 낮게 설정할 경우 에러 발생됨
dynamodb_log_collector.properties 설정 내용
[로그 확인]
1) CloudTrail 이벤트 로그
(1) CloudTrail의 이벤트 기록에서 이벤트 소스를 'dynamodb.amazonaws.com' 으로 필터링 지정 후
userAgent 가 console.amazonaws.com, signin.amazonaws.com, AWS Internal, 앞부분이 Mozilla 로 시작할 경우 로깅
2) 매니저 로깅 화면
DBMS 세션 로그
DBMS 명령어 로그
[참고 사항]
1) userAgent 에 따른 미로깅 현상 (https://bugs.pnpsecure.com/view.php?id=26207)
(1) 기존에 콘솔로 처리하고있는 userAgent는 console.amazonaws.com, signin.amazonaws.com, AWS Internal
(2) v1.1.4 에서 앞부분이 Mozilla로 시작할 경우 로깅 가능하도록 수정
(3) 추후에 다른 방식의 userAgent가 나올 경우, 새로운 방식 추가 후 패치 필요 (bugs 등록 필요)
- userAgent 확인 방법 : CloudTrail → 이벤트 기록 → 이벤트 이름 → 이벤트 레코드 json 확인
userAgent 정보 확인
2) 로그서버와 연결 끊어지는 현상 (https://bugs.pnpsecure.com/view.php?id=25133)
(1) 일정 시간 후 'communication error with dbsafer logger' 에러 확인
(2) pnp_log 와 연결이 끊어져서 로그를 전달하지 못했을 때 발생하는 에러
(3) dynamodb_log_collector.sh 를 재기동 후 정상적으로 로그가 남으나 시간 경과 후 동일 증상 확인
dynamodb_log_collector 로그 내용
(4) pnp_log_bridge.conf 하단에 idle_service_session_expired_sec = 900 이상으로 추가
- pnp_log_bridge v158 이상은 config 에 해당 옵션이 설정되어 있지 않아도 600초로 기본 동작
- dynamodb_log_collector은 기본 900초로 동작하고, pnp_log_bridge는 600초만큼 감사로그가 발생하지 않은 세션이 정리되며
pnp_log 와 연결이 끊어진 상황
pnp_log_bridge.conf 내용
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6026
6020,[국방DIDC 1센터] pnp_log_sender 에서 생성되는 파일에서 지정된 데이터 이외의 데이터가 생성,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
국방 DIDC 1센터
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
- pnp_log_sender 파일 생성 시 전체 항목이 아닌 DBMS 접속 항목만 설정하여 생성하게끔 적용
- DBMS 접근 데이터 항목이 아닌 명령어 타입의 데이터가 생성되는 현상
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- N/A
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- N/A
4. 사내 재현 정보
192.168.112.154 / 7795
ID : root
PW : dbsafer
5. 요청사항
해당 명령어 타입의 로그가 떨어지는 원인이 무엇인지 확인부탁드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
./pnp_log_sender.conf
log_write_files/log_2023일자.txt
첨부파일
log_2023101713
.txt
null
파일 다운로드
첨부파일
pnp_log_sender
.conf
null
파일 다운로드
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
- LOG SENDER Release Version 1.4.9 (Rev 45)
- LOG Release Version 3.0 for RelV7-R22.11-RHEL8 SE(Rev777) [Mar 28 2023]
- LOG BRIDGE Release Version 3.1.3 for RelV7-R22.11-RHEL8 (Rev 153) [Mar 28 2023]
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","김태윤: FAQ 문의 작성 가이드를 통해서 확인 후 ""말머리 구분"" 할 수 있도록 설정 바랍니다. | 전준호: 죄송합니다.. 수정 완료 하였습니다. 감사합니다. | 김태윤: 해당 이슈 확인 결과 기본적으로 명령어에 대한 순번을 찍게 되어 있습니다. (제외 기능 현재 없음)
참고로 로그에서는 이것을 기반으로 세션에서 명령어 카운트를 하는 것으로 보여집니다.

해당 부분에 대해서 제외하고 싶다면 Bugs를 통해서 수정 요청 요청해 주시기 바랍니다.

감사합니다. | 전준호: Bugs 등록 후 수정 요청 드리겠습니다.
빠르게 확인해 주셔서 감사합니다.

감사합니다.",https://cafe.naver.com/pnpsecure2/6020
6018,[TIP] PC Assist 의 프로그램 언어 설정,"PC Assist 의 프로그램 언어 설정 방법을 가이드합니다.
실행 기준
PC Assist 는 Windows 의 Region - locale 설정을 기반으로 설정 되어야 합니다.
지원 언어
- Locale 한국 : 한국어
- Locale 일본 : 일본어
- Locale 이외 전체 : 영문
Locale 에 맞지 않을 경우 언어가 깨져서 표현이 됩니다.
PC Assist 에서 언어 설정 방법은 아래와 같습니다.
- 설정 파일: DBSaferAgt.lng
- 설정 내용
[LANG]
LANGUAGETYPE = 0
- 설정 옵션
* 0 : 영문
* 1 : 한글어
* 2 : 일본어",댓글 없음,https://cafe.naver.com/pnpsecure2/6018
6017,[TIP] 사용자 구간 암호화 적용 사이트에서 pnp_mysql 패치 후 몇몇 jdbc를 사용하는 tool 에서의 접속 불가 현상 조치 내역 공유,"[요약]
- 현상
> 09/13 pnp_mysql 모듈 패치 진행 (rev1897 > rev2490)
> 09/14 mysql 서버 대상으로 dbeaver, jdbc 를 통한 접속에 대해서 접속 불가
: 접속로그 허용, 명령어 로그 허용(5 ~ 6줄) 정도 뜨다가 툴에서 차단 팝업 발생
- 패킷 수집을 위해 구간 암호화 해제 후 접속 테스트 시 정상 접속 가능
- 원인
> 패치 이후 차단 팝업 발생하는 '사용자PC-DBSAFER' 구간 패킷 분석 결과, NATIDENTITY 패킷보다 MySQL 서버 패킷이 먼저 도착하는것이 확인됨
> NATIDENTITY 패킷을 MySQL 서버 패킷보다 느리게 처리하여 먼저 전달받은 MySQL 서버 패킷을 암호화하여 전송할 수 없어 평문으로 사용자 단으로 보냄
> PC ASSIST는 평문 패킷을 암호화 패킷으로 인식하여 복호화해 사용자 Tool로 보내면서 문제 발생
- 조치방법
> pnp_dbms_config.conf 설정 내 초기 접속 세션 패킷에 대해 usleep 하는 설정 활성화
> 분석된 패킷 내에서는 MySQL 서버의 패킷이 0.003초 빠르게 도착
해당 패킷을 0.05초 간 usleep 시켜 NATIDENTITY 패킷이 먼저 처리되게끔 설정 추가
> GW1,2 의 /dbsafer/.conf/pnp_dbms_config.conf 내 아래의 설정 추가
[USE SERVER CONNECTION DELAY] / 서버로의 접속 지연을 사용할 것인지 여부
Enable
[SERVER CONNECTION DELAY TIME] / 서버로의 접속 지연 시간
(micro 단위라 50000설정 시 0.05초)
참고 Bugs URL : https://bugs.pnpsecure.com/view.php?id=26015
- 추후개선내역
> MySQL은 서버 패킷이 먼저 오는 특수성을 갖고 있어서 NATIDENTITY가 제일 먼저 와야 서버 패킷을 암호화하여 전송할 수 있는 특징이 있음
> 위와 같은 특징을 생각 했을 때, 해당 조치 방법은 근본적인 이슈 해결 방법이 아니라고 판단되어 MySQL 서비스인 경우 사용자 접속 이후 사용자 식별기능을 쓰는 것이 확인되면 target 서버 접속 전 NATIDENTITY 패킷을 먼저 받도록 수정 예정이라고 합니다.
참고 Bugs URL : https://bugs.pnpsecure.com/view.php?id=26052
[버전정보]
- pnp_mysql : rev2490 (CI옵션 포함)
- PC ASSIST : 3.2.31.0T
- mysql ver : 5.1.56 / 5.7.X / 8.0.2X 등등
- 차단되는 Tool : dbeaver 21.3.2 등등
[상세내역]
1) 사용자 접속 시 5개의 허용 로그 출력 사진 및 Tool에서의 차단 팝업(Communications link failure) 발생 사진
Next image
2) 일반적인 패킷과 이슈 패킷의 차이점
- 암호화를 하기 위해서는 NATIDENTITY 패킷이 먼저 도착하여야 하나, MySQL 패킷이 먼저 도착하는 것 확인 가능
3) 이슈 패킷에서 MySQL 서버 패킷이 NATIDENTITY 패킷보다 0.003초 빠르게 도착 하는 것 확인 가능
[사내 재현내역]
1. 사용자 접속 시 6개의 허용 로그 발생 후 Tool 에서의 차단 팝업 발생
- 고객사와 동일한 팝업 발생 확인
2. GW 서버 내 pnp_dbms_config.conf 내 delay 패킷에 대한 설정 추가
- 실제로는 0.003초 빠르게 들어왔으나, 넉넉하게 0.05초 delay 설정
- 설정 이후 pnp_mysql 재시작 및 대상 서버 접속 테스트 시 정상 접속 확인
[결론]
- 구간 암호화 서비스 접속 시 로그에는 허용으로 찍히나, 툴에서 차단 팝업이 발생한다면 패킷을 수집하여 서버 패킷이 역전되어 있지 않은지 확인이 필요합니다.
- 서버 패킷이 먼저 들어오는 구조의 역전 패킷이 확인된다면 위와 같이 조치를 진행 할 수 있습니다.
* 수정이 필요한 부분이나 개선사항이 있다면 댓글로 남겨주시면 감사하겠습니다.","여성구: tag 로 delay 같은 것이 추가 되면 다른 사람들이 검색 할 때 더 편할 것 같네요. 좋은 글 감사합니다. | 이창제: 안녕하세요. 여성구 부장님.
이창제 대리 입니다.

글 Tag 추가하였습니다 ! !
의견 감사합니다.",https://cafe.naver.com/pnpsecure2/6017
6016,[TIP] dbeaver를 통한 CI(주석인식옵션) 옵션이 포함된 서비스 모듈 사내 테스트 방법 공유,"[요약]
- CI(주석인식옵션) 옵션이 포함된 서비스 모듈 빌드 후 사내 테스트 방법 공유
(* https://cafe.naver.com/pnpsecure2/3369 에서도 주석인식옵션 관련 내용 확인 가능)
- dbeaver Tool의 접속 전 먼저 던지는 쿼리 설정을 통해 사내 테스트가 가능
[버전정보]
- dbeaver 23.1.1
[상세내역]
- 사내테스트 진행 내역
1) dbeaver 접속 및 CI 옵션 테스트 하고자 하는 '서버 우 클릭' > 'Edit Connection' > 'Initialization' > 'Configure' > 'Add' > '주석 입력( /***<cert_user_info><ip:10.77.160.131><id:chang><app:tadpole>*/ select 1) ' > 'OK'
>> 최신 버전에서는 주석만 있는 경우 인식이 안되는 경우가 있어 select 1 과 같은 임의 쿼리 넣어주시면 될 것 같습니다.
2) 접속 및 로그 확인
- dbeaver를 통해 DB 접속 및 CI 옵션(주석인식)이 정상적으로 동작하는지 확인
- 로그 확인 결과 접속 시 던진 주석 /***<cert_user_info><ip:10.77.160.131><id:chang><app:tadpole>*/ 에서 설정한 내용 확인 가능
이상입니다.
감사합니다.
* 수정이 필요한 부분이나 개선사항이 있다면 댓글로 남겨주시면 감사하겠습니다.",여성구: 좋은 방법을 공유해 주셨네요. 감사합니다. | 진선태: 저에게도 도움이 되는 정보입니다. 감사합니다.,https://cafe.naver.com/pnpsecure2/6016
6015,[TIP] PC Assist 클라이언트 로컬 정책 지원 옵션 (Cltpolicy.cfg),"PC Assist 클라이언트 로컬 정책 지원 옵션
cltpolicy.cfg 는 공용적인 설정이 아닌 일부 PC 에만 PC Assist 정책을 다르게 할 경우 반영 시키기 위한 기능으로 PC Assist 설치 디렉토리에 파일을 만들어 주면 설졍에 따라서 동작을 하게 됩니다.
옵션
기본 값
설명
AUTH_CERT_AUTOLOGIN
YES
보안계정 자동 로그인
AUTH_SITE
9
사이트별 사용자 인증
AUTH_TYPE
4
사용자 인증 종류
AUTO_START
YES
윈도우 시작시 자동 시작
DECIDE_REASON_MIN_INPUT
10
결재시스템 실행사유 최소 글자수
DMS_LOGIN_START
YES
로그인 후 DMS 자동 실행 여부
DMS_USER_CONFIRM
1
DMS 실행시 사용자 추가인증 종류
IDLE_AUTO_LOGOUT_TIME
30
일정시간동안 컴퓨터를 사용하지 않으면 AGENT를 자동 종료할 시간(분)
IDLE_AUTO_LOGOUT_TYPE
1
일정시간동안 컴퓨터를 사용하지 않으면 AGENT를 자동 종료 종류
MSG_TUNNEL_ALWAYS
YES
메시지 수신용 TCP 세션 항상 연결 여부
NAT_MENU_TYPE
0
NAT 서비스 내역 메뉴 종류
NAT_SYNC_BEFORE_AUTH
YES
사용자 인증 전 NAT 서비스 적용 여부
REMEMBER_USERID
YES
로그인창에 사용자ID 저장 출력 여부
SPLASH_UNUSE
YES
스플래시 화면 사용 안 함
SSL_LISTEN_PORT
50015
2-factor 인증을 위한 SSL TCP 포트
SSL_USE
YES
UDP 사용 여부
TDI_IDENTITY_EXTEND_TYPE
7
사용자 식별 정보에 추가할 정보 종류
TDI_IDENTITY_JAVAW_EXCLUDE_TYPE
8
Java, Python 프로세스인 경우 사용자 식별 정보 처리 방법
TDI_NAT_DIRECT_CONN
YES
DBSAFER 서비스 포트로 직접 접속 시에도 암호화,사용자 식별 기능 사용 여부
TDI_NAT_RULE_TYPE
1
TDI NAT 정책 적용 방법
TDI_NAT_UISP_METHOD
1
사용자 식별 정보 제거 시 연결된 TDI 세션 처리방법
UDP_CRYPTO_PORT
50015
보안 UDP 포트
UDP_TEST
NO
UDP 테스트 사용 여부
UDP_USE
NO
UDP 사용 여부
USE_MSG_TUNNELING
YES
UDP 테스트 실패 시 메시지 수신용 TCP 세션연결 여부
USE_AM_RDPLOGGING
1
RDP 로깅 기존 처럼 Remote Con 내에서 로깅이 가능하도록 변경
EXIT_ON_LOGOUT
1
로그아웃시 프로그램 종료 사용
DECIDE_FULLSCREEN
1
결재시스템 브라우저 최대화 시작 사용
DECIDE_POPUP_HIDE
1
결재시스템 알림 숨기기 사용
PERMIT_SAMEIP_RELOGIN
1
동일 IP에서 재접속 시 팝업창 발생
TDI_KEEP_NAT_RULE
1
프로그램 종료 시 NAT 드라이버 유지
AUTO_CONNECT_TARGETADDR
1
자동접속 시 TARGET 주소에 직접 접속 옵션 추가
SHOW_FIRST_PASSWORD
1
최초 로그인 시 패스워드 공개
NAT_INITIALIZE_ALL
1
프로그램 시작 및 종료 시 NAT 전체 세션 초기화를 선택적 처리 가능
TDI_IDENTITY_JAVAW_EXCLUDE_TYPE 옵션 동작 설정 상세
- 0 : 없음
- 1 : 프로그램 이름+해시 제외
- 2 : 프로그램 해시 제외
- 3 : 고정 해시
- 4 : 부모 프로세스 정보 사용",댓글 없음,https://cafe.naver.com/pnpsecure2/6015
6014,[TIP] PC Assist 의 공용 데스크 사용 시의 보안계정 로깅 동작,"하나의 데스크탑에 여려명이 함께 사용을 할 경우 PC Assist 설정 방법을 가이드합니다.
사용 예)
Windows 서버 1개를 여려명이 서로 다른 계정으로 사용을 한다는 전제입니다. Windows 의 경우 세션마다 데스크탑이 생성이 됩니다.
아래의 표는 사용자 A, B, C 가 보안계정 CA, CB 를 사용 할 때 의미 입니다.
SYSTEM 세션
RDP A user
(보안계정 CA 로그인)
RDP B user
(보안계정 CB 로그인)
RDP C user
(보안계정 미 로그인)
NAT
보안계정
기록
NAT
보안계정
기록
NAT
보안계정
기록
NAT
보안계정
기록
Mode 1
O
CA
O
CA
O
CB
O
CA
Mode 2
O
CA
O
CA
O
CB
X
-
Mode 3
X
-
O
CA
X
-
X
-
사용자의 로그인 순서는 A 사용자가 보안계정 CA 로 먼저 로그인을 한 경우 입니다. 이후에 B 사용자가 CB 로 로그인을 한 것 입니다. 즉, 우선 로그인 한 사용자의 정보가 우선 처리 된다는 의미 입니다.
SYSTEM 세션은 Windows 에서 자체 처리 하는 것을 의미 합니다. 예를 들면 Service Host 같은 것이 됩니다.
프로그램을 설치 할 때 모든 유저가 사용하도록 설치 할 지 아니면 설치 유저만 사용할지 문의 하는 경우가 있습니다. 이때 일부 유저만 사용 할 경우에는 SYSTEM 세션이 없을 것 입니다.
하지만 SQL Server 의 매니저 프로그램의 경우 내부 세션에서 사용자 세션으로 프로세스를 실행하지만 SQL Server 를 모니터링 하기 위한 SYSTEM 자체적인 프로세스가 실행되기도 합니다.
설정 방법
PC Assist 설치 파일에 cltpolicy.cfg 에 아래의 설정 값을 입력
- TDI_NAT_RULE_TYPE : 0 / 1/ 2 (0 : mode 1, 1 : mode 2, 2 : mode 3)
기타사항
- mode 3의 경우 tools 동작에 문제를 발생 시킬 수 있다고 판단됩니다. 예를 들어서 tools 접속 시에 세션 2개가 접속하여서 하나 는 manager 역할을 할 경우 nat 동작이 서로 달라서 DBMS 에서 차단이 될 가능성이 있습니다.
- mode 2의 경우 세션이 2개 접속되는 tools 기반으로 서로 다른 PC Assist ID이 로깅 될 가능성이 있습니다. mode 1의 경우 - mode 2과 동일한 문제와 함께 미user 또한 CA 로 로깅이 되는 사항이 발생됩니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6014
6012,[크레버스] FTP 서비스 Filezilla Server 접속 시 TLS 에러 발생하며 접속 안되는 현상 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기능로직문의
[고객사/채널사]
크레버스
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
1.1 PC Assist 접속 후 FTP Filezilla Server 접속 시 TLS 에러 발생하며 접속 안되는 현상
1.2 DBSAFER 를 경유하지 않는 경우 정상 접속됨
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
2-1. Filezilla Server TLS v1.2 사용
2-2. Filezilla Server Passive mode 로 동작중
2-3. 방화벽
: Client -> DBSAFER (TCP Any Open)
: DBSAFER -> Filezilla Server (TCP 21 Open)
2-4. 보안프로그램 없음
3. 특이사항 (연동 모듈, 커스텀 개발 등)
없음
4. 사내 재현 정보
5. 요청사항
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
PKG : PKG_DBSAFER7_RelV7-R23.05-RockyLinux_x86_64_20230908
PC Assist : v3.3.1.6
FileZilla (Client) : Filezilla 3.6.1.0
FileZilla (Server) : FileZilla Server 0.9.57 beta
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
User : 172.27.61.3 / DBSAFER : 10.1.1.31 / Filezilla Server : 192.168.1.151
1) PC_Assist_Login.pcap (FTP 접속 불가)
첨부파일
PC_Assist_Login
.pcapng
null
파일 다운로드
2) PC_Assist_Logout.pcap (FTP 정상 접속)
첨부파일
PC_Assist_Logout
.pcapng
null
파일 다운로드","박상원: FTPS 접속이 SSL/TLS 인증서 핸드세이크 과정에서 실패하여 접속이 안되는 것으로 보입니다.

기존 DBMS 서비스의 경우 pnp_ssl_proxy 모듈을 사용하여 SSL/TLS 통신을 하였는데 FTP 서비스에 기능이 구현되어 있는지 확인이 필요할 거 같습니다.

FTPS는 SFTP와는 다른 프로토콜입니다. | 정현교: pnp_ftp 는 현재 FTPS 를 지원하지 않습니다.

해당 기능 추가 요청 시, 연구소 일정상 내년부터 진행할 수 있는 점 참고 부탁드립니다.",https://cafe.naver.com/pnpsecure2/6012
6010,[TIP] PC Assist 에서 접속 가능 서비스의 호스트명 표기,"DBSAFER v 7.0 에서 변경된 PC Assist UI 에서 접속 가능 리스트를 표시 하기 위해서는 호스트명이 필요합니다.
- DBMS : 기존과 같이 서비스명 표현됨
- FTP/Terminal : 호스트 객체 설정을하면 호스트 객체명이 표기됨
아래와 같이 터미널 리스트에 호스트 객체가 등록된 서비스의 경우 호스트 객체명이 표시가 됩니다.
호스트 객체 없이 서비스가 등록된 경우IP 만 표기가 되고 있습니다.
DBMS 의 경우에는 DBSAFER v 5.0 과 같이 설정에 따라서 표시가 되고 있습니다.
- 옵션 : pnp_oms_dms.conf 의 NAT_SHOW_COLUMN_INFO 로 설정 가능
* 단, DBMS 서비스만 서비스명 및 추가 정보가 표기됨 (사유 하단)
호스트 객체의 경우 매니저 시스템옵션에서 기능 활성화 후에 사용이 가능합니다.
시스템 서비스의 정보 표기 한계 사유
UI 설계 당시 자동 접속 기능이 있는 AM서비스를 DB서비스처럼 표로 표기했을때 사용자에게 과도한 정보가 표기됨으로써UI가 복잡해지는 문제사항이 있어서 수정되었습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6010
6005,[TIP] DBSAFER 서비스 별 pnp_sshd / pnp_ssh_proxy 를 선택하여 사용할 수 있는 기능,"pnp_telnet_gateway 설정으로 DBSAFER 서비스 별 pnp_sshd / pnp_ssh_proxy 를 선택하여 사용할 수 있는 기능 공유드립니다.
- 수정 내용 : https://bugs.pnpsecure.com/view.php?id=25795
DBSAFER 7.0
[케이스별 설정 방법]
1. pnp_sshd 를 기본으로 사용하려는 경우 (두 가지 방법 중 하나 적용)
- /dbsafer/pnp_ssh_proxy 데몬 제거
- /dbsafer/.conf/pnp_telnet_gateway.conf => use_ssh_proxy_service_list = 0 옵션 설정
2. pnp_ssh_proxy를 기본으로 사용하려는 경우
- /dbsafer/pnp_ssh_proxy 데몬 추가
3. 특정 서비스만 pnp_ssh_proxy로 실행하고 싶을 경우 (나머지는 pnp_sshd 로 실행)
- /dbsafer/.conf/pnp_telnet_gateway.conf => use_ssh_proxy_service_list = [서비스 번호] 옵션 사용
4. 특정 서비스만 pnp_sshd로 실행하고 싶을 경우 (나머지는 pnp_ssh_proxy 로 실행)
- /dbsafer/.conf/pnp_telnet_gateway.conf => use_pnp_sshd_service_list = [서비스 번호] 옵션 사용
설정 예시
* 참고 사항
- 설정 변경 후 pnp_telnet_gateway 데몬 재시작 필요.
- use_ssh_proxy_service_list, use_pnp_sshd_service_list 두 개 설정 모두 존재할 경우 우선순위
> use_ssh_proxy_service_list 로 동작함 (use_pnp_sshd_service_list 무시)
[패치 모듈 및 버전]
- pnp_telnet_gateway MAIN VERSION(Rev: v2471) 이상
[개선 예정 사항]
- pnp_sshd 으로 접근하는 서비스가 pnp_ssh_proxy 로 변경되었을 때 모듈 재시작 없이 지원하는 기능 보완 요청 (25926)
+ DBSAFER 5.0
DBSAFER 5.0 에서는 pnp_ssh_proxy.conf 설정으로 서비스 별 pnp_sshd / pnp_ssh_proxy 를 선택하여 사용 가능합니다.
- 참고 문서: ssh_proxy 문서
/dbsafer/.conf/pnp_ssh_proxy.conf => APPLY_CURRENT_SERVICE 옵션 사용
APPLY_CURRENT_SERVICE = IP:Port
또는
APPLY_CURRENT_SERVICE = 서비스 번호
* 참고 사항
- 다중 설정은 여러 줄로 설정 가능
- APPLY_CURRENT_SERVICE 에 지정된 서비스가 없을 경우, 모든 서비스는 ssh_proxy 구성으로 운영됨
- APPLY_CURRENT_SERVICE 에 지정된 서비스가 있을 경우, 해당 서비스 외의 서비스는 이전 구성(sshd + ssh_manager + ssh)으로 운영됨.
- 서비스 시작 시 적용 됨. (실시간 적용 안됨)","강현구: 해당 기능은 v7.0 기준으로 설명 해주신 거 같습니다. v5.0은 지원불가한지 확인 부탁드립니다. | 정현교: 해당 내용 추가하였습니다. | 강정근: v5.0 에서는 pnp_ssh_proxy.conf 에서 설정 기능을 지원하고 있습니다. | 하충현: DBSAFER 7.0 pnp_sshd를 기본으로 사용할 경우 해당 기능을 적용하기 위해서는
https://cafe.naver.com/pnpsecure2/5592 의 게시글과 동일한 작업이 선행이 되어야 하는게 맞나요?

추가로 pnp_telnet_gateway 모듈만 패치하고 pnp_telnet 모듈은 버전만 v3400이상이라면 패치 없이 사용해도 되는지 확인 부탁드립니다. | 정현교: 올려주신 게시글은 pnp_ssh_proxy 사용하실 때 필요한 내용입니다. pnp_sshd를 기본으로 사용하실 경우 따로 작업해주셔야 할 것은 없습니다.

pnp_telnet_gateway 모듈 같은 경우 모듈 간 버전에 영향을 크게 받지 않기 때문에 pnp_telnet v.3400 이상으로 사용하시면 문제 없을것으로 보입니다.

다만, 수정된 이슈들이 있기 때문에 최신 버전을 사용하는 것을 권장드립니다.",https://cafe.naver.com/pnpsecure2/6005
6002,[TIP] PC Assist 로그인 후 터미널 접속 불가 현상 (wta.conf),"안녕하세요, 프로젝트 1팀 김세린입니다.
사내 테스트 진행 시 발생한 PC Assist 로그인 후 터미널 접속 불가 현상 공유드립니다.
[요약]
wta.conf 파일 내 옵션 중 USE_WTA=0으로 되어있을 경우 터미널 접속이 불가합니다.
[현상]
PC Assit 로그인 후 터미널 접속 불가 (그림 1 참고)
- PC Assist 미로그인 시 접속 가능
- 서비스 접속 검사 성공
- tcpdump 확인 시 해당 서비스에서 fin 패킷을 날림 (그림 2 참고)
- 차단 정책 없음
[그림 1] 접속 시도 시 발생하는 창
[그림 2] tcpdump 확인
[해결 방안]
USE_WTA=1 로 변경 후 서비스 재시작
- 경로
/dbsafer/.conf/
- 파일명
wta.conf
- 옵션
USE_WTA
[그림3] wta.conf 파일 ""USE_WTA"" 옵션
이상입니다.
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6002
6000,[현대CCS2] 루니튜너블즈 취약점 영향도 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
현대CCS2
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
3. 특이사항 (연동 모듈, 커스텀 개발 등)
4. 사내 재현 정보
5. 요청사항
루니튜너블즈 취약점 관련 DBSAFER 영향도 확인 부탁드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","조재용: 해당 취약점은 privilege escalation 취약점입니다.
일반계정을 사용하는 경우 루트권한으로 동작하고 동적로더를 사용하는 애플리케이션에서 공격자가 의도한 라이브러리를 사용하므로써 발생합니다.
따라서 기본적으로 root 계정만 사용하여 관리되는 시스템에서는 크게 영향도가 없을 것으로 판단됩니다. | 한두영: webusr, dbsafer, mysql 계정을 기본적으로 사용하고, 요즘에는 root로 바로 접속은 안되고 일반 계정을 사용하는 사이트들이 대부분인데요.
영향도가 있는 걸로 이해하면 될까요?
영향도는 어떤 영향도가 있나요? 대응이 필요한 부분인건가요? | 조재용: 최선의 취약점 대응 방법은 취약점이 보완된 버전으로 패치하는 것입니다.
하지만 DBSAFER 운영 환경만 놓고 봤을 때 비교적 영향도가 낮다고 판단됩니다.
보통의 경우 쉘을 띄우는 일반계정이 없고(대부분 nologin) 일반계정이 사용된다고 해도
관리 목적으로 root 직접접속을 하지 않도록 하는 목적이 대부분이기때문입니다.
다시 말해서 일반계정이 존재해도 로그인이 되지 않아 의미가 떨어지고
관리용 일반계정인 경우에도 관리자 이외의 주체가 접근 할 수 있다고 보이지 않기 때문에 비교적 영향도가 낮다고 판단한 것입니다.
만약 일반계정이 관리자 이외 다른 주체가 접근하여 사용할 수 있다고 하면 문제가 될 수 있습니다. | 한두영: 공식적으로 취약점 대응 계획이 있는지 문의드립니다.
추가적으로 현재 고객사쪽에 답변해야 하는 상황입니다.
일반계정을 관리자만 사용한다면 취약점이 없다고 고객사쪽에 답변을 하면 되는건가요? | 조재용: 네 일반계정을 관리자만 사용하는 경우에는 문제가 없습니다. 그럼에도 불구하고 취약점 패치가 필요할 경우 벅스 등록해서 진행 바랍니다.",https://cafe.naver.com/pnpsecure2/6000
5999,[공유] [카카오페이증권] OraScope.net에서 날리는 정형 쿼리와 결과 값 저장으로 인해 발생하는 DBSAFER DB 과부하 및 aria_log 누적 생성 현상 관련 내용 공유해 드립니다.,"안녕하세요.
클라우드기술팀 민시원입니다.
카카오페이증권에서 발생한 aria_log 지속적으로 누적되어 생성되는 현상과 대응에 대해 공유해 드립니다.
[이슈 현상]
- DBSAFER 서버 /home/dbsafer/data/mysql 위치에 aria_log.0000XX 로그가 지속적으로 발생하여 누적 생성됨
- 해당 로그는 MariaDB 설정에 따라 삭제 및 보관 주기가 변경됨
- 카카오페이증권 MariaDB 설정은 aria_log.0000XX 파일이 하나만 유지되고 이전 파일은 즉시 삭제되도록 설정되어 있음
- 정상 작동 시, 해당 로그 파일이 약 1.1GB 정도 쌓이면 다음 로그 파일이 생기고 이전 파일은 자동 삭제됨
- 카카오페이증권에서 간헐적으로 해당 파일이 삭제되지 않고 지속적으로 생성되는 현상이 발생함
- 이로 인해, 해당 로그 파일이 약 280GB 정도 차지함
[aria_log 삭제 주기 확인]
- mysql 접속 후, 아래의 명령어로 조회 가능
> show global variables like 'aria_log_purge_type';
aria log 삭제 주기 확인
* 위 설정을 따르면, aria_log.0000XX 파일은 약 1.1GB가 쌓이고 다음 aria_log.0000XX 파일이 생성된 후 이전 파일이 '즉시' 지워져야 함
[원인 분석]
- aria_log가 최초로 삭제되지 않고 쌓인 시점 확인
. 7월 12일 20시 09분으로 확인
. 최초 발생 후 10~20분 간격으로 1.1GB의 파일을 지속적으로 생성
- 최초 발생 파일 내용 확인 결과, 특정 쿼리문에 대한 에러 로그가 반복해서 입력되어 있는 것을 확인
- aria_log 최초 발생 시점에 DBSAFER 주요 모듈 확인
. 해당 시점 pnp_log 모듈 로그에, aria_log에 입력된 쿼리문과 같은 쿼리가 지속적으로 반복해서 입력되어 있는 것을 확인
- DBSAFER Manager에서 aria_log 최초 발생 추정 일자, 특정 쿼리문 일부와 해당 쿼리문에 명시되어 있는 어플리케이션 객체 조건을 설정하여 로그 조회
. 조회된 로그 확인 결과, OraScope.Net 툴을 이용하여 실행된 명령어가 대량의 결과 값을 조회하고 (6만건 이상), 해당 명령어에 대한 소요 시간이 900~16000분인 것을 확인
- 최초 발생일로부터 소요 시간 만큼 계속해서 aria_log.0000XX 파일을 생성한 것으로 확인
- 카카오페이증권은 담당자 요청으로, 결과 값 저장 행수 제한을 100000건으로 사용 중이었음
- DBSAFER DB에 해당 결과 값을 저장하는 과정에서 DB에 부하가 걸려 aria_log 파일을 생성한 것으로 추정
카카오페이증권 운영망 Manager 로그 조회 결과, 문제가 된 로그 확인
[사내 재현 테스트]
- OraScope.Net은 유료 라이선스로, 해당 툴은 사용하지 못하고 QueryBox로 테스트 진행
- sysbench를 사용하여 특정 Database에 대량의 행수를 가진 더미 테이블 생성 (1만, 3만, 7만 테스트)
- Manager에서 결과 값 저장을 똑같이 10만 건으로 설정
- QueryBox 결과 값 조회 제한 해제하여 더미 테이블 조회
- Manager 로그 조회 소요 시간 및 aria_log.0000XX 파일 생성 확인
- 행수별로 다수의 테스트 진행 결과, 결과 값이 3만 건일 때 한 번 소요 시간이 약 39초였던 것 빼고 전부 정상 작동 확인 (소요 시간 약 5초 이내)
- aria_log.0000XX 파일 생성 안됨 -> 재현 안됨
결과 값 30000행일 때, 소요 시간 약 39초
[대응]
- OraScope.Net 툴 사용자 확인 -> 일부 DBA로 확인
- DBA에 확인 결과, 문제가 된 쿼리는 DBA가 작성한 쿼리가 아닌 툴에서 자체적으로 날리는 것으로 확인
- OraScope.Net 사용 금지 공지 (8월에 이미 라이선스 종료 상태로 확인)
- DBSAFER Manager에 OraScope.Net 어플리케이션 객체로 등록 후 해당 조건으로 차단 정책 생성
- 대응 후 모니터링 결과, 더 이상 aria_log를 쌓지 않는 것으로 확인
- 현재까지 쌓인 aria_log는 고객사와 작업 일정 협의 후 삭제 예정
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5999
5993,[코웨이] 신규 macOS 14(Sonoma) 배포관련 DBSAFER Agent 지원 여부 문의드립니다.,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
- 기타 문의
[고객사/채널사]
- 코웨이
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
- 없습니다.
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- 없습니다.
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 없습니다.
4. 사내 재현 정보
- 없습니다.
5. 요청사항
- 신규 macOS 14(Sonoma) 배포 관련 DBSAFER Agent에서 지원가능 여부 확인 요청드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
- 없습니다.
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
- 없습니다.
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
- 없습니다.","여성구: 제품 지원은 제품별 기능 지원 문서를 확인해주세요. 만약 거기에 버전이 없다면 메일로 요청을 해주세요.
FAQ 작성 가이드와 월간 보고의 부사장님 지시사항으로 제품지원은 품질 문의가 아니라고 하였습니다.

참고로 현재 14 버전은 테스트 안되 었습니다. | 황재필: 네 확인 감사드립니다. | 여성구: macOS 14(Sonoma) 버전의 기본 기능 체크가 완료되어서 지원으로 변경하였으니 참고 바랍니다.",https://cafe.naver.com/pnpsecure2/5993
5985,[용인세브란스] MSSQL 우회접속 시 Server Agent를 통한 접속계정/어플리케이션 로깅 기능 문의드립니다.,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
- 기능로직문의
[고객사/채널사]
- 용인세브란스
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
- '[참조]' 의 내용을 토대로 Server Agent 설정 후에도 동일하게 MSSQL 우회접속 시 Server Agent를 통한 접속계정/어플리케이션 로깅이 되지 않는 현상
- [참조]
[TIP] MSSQL 우회접속 시 Server Agent를 통한 접속계정/어플리케이션 통제 기능
https://cafe.naver.com/pnpsecure2/5430
접속계정 미로깅
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- pnp_server_manager 정책 배포 설정 확인
- alias.conf 설정 확인
- mssql_acc_id 값 확인
- server agent ID/Application Name 추출 설정 확인
- Server Agent 히든 옵션으로 인한 '접속 계정', '어플리케이션' 정책 배포
pnp_server_manager 정책 배포 설정 확인
alias.conf 설정 확인
mssql_acc_id 값 확인
server agent ID/Application Name 추출 설정 확인
Server Agent 히든 옵션으로 인한 '접속 계정', '어플리케이션' 정책 배포
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 없습니다.
4. 사내 재현 정보
- 없습니다.
5. 요청사항
- 해당 이슈에 대하여 처리 방안 가이드 부탁드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
- SERVER MANAGER : v5.1.8.18
- SERVER AGENT : v5.1.8.4
Server Manager 버전
Server Agent 버전
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
첨부파일
alias_10.111.10.31
.conf
null
파일 다운로드
첨부파일
access_10.111.10.31
.rule
null
파일 다운로드
첨부파일
nodesafer
.conf
null
파일 다운로드
첨부파일
Log
.zip
null
파일 다운로드","신호철: SA 로그 및 conf 파일(alias, access) 수집 부탁드립니다.

ID/App 관련 정보는 매니저의 [MSSQL 접속계정 관리]에 입력한 계정으로 접속 후 아래의 쿼리를 수행해서 확인하고 있습니다.
- SELECT P.loginame, P.program_name FROM sys.sysprocesses AS P INNER JOIN sys.dm_exec_connections AS C ON P.spid = C.session_id AND C.client_tcp_port=사용자 포트 AND C.client_net_address='사용자 주소'

해당 쿼리 결과값에 ID/App 정보가 있는지 확인이 필요하며, [MSSQL 접속계정 관리]에 입력한 계정으로 접속 후 쿼리 수행 결과 수집 부탁드립니다. | 신호철: [참고] 아래 케이스는 ID/APP 수집이 되지 않는 것이 정상입니다.
case 1. TCP 접속 후 끊어짐 (헬스 체크 등)
case 2. TLS Handshake 실패로 끊어짐 (SSL 인증서 문제 등)
case 3. MSSQL 인증을 실패한 커넥션 (ID/APP 오류 등) | 여성구: 본 건 피드백을 엔지니어가 확인 한 것 인가요? 본 답글에 회신해주세요 | 황재필: 고객사와 일정협의가 미뤄져 확인이 딜레이 되었습니다.
확인 후 답변드리겠습니다. | 황재필: Server Agent에 의한 로깅은 MSSQL 접속계정이 로깅되지 않습니다.
- SELECT P.loginame, P.program_name FROM sys.sysprocesses AS P INNER JOIN sys.dm_exec_connections AS C ON P.spid = C.session_id AND C.client_tcp_port=사용자 포트 AND C.client_net_address='사용자 주소'
> 추가로 쿼리 수행결과 첨부드립니다. | 신호철: 아래 사항들 확인 부탁드립니다.

1. 위 쿼리 수행 결과가 사용자 접속 후, 사용자 포트와 주소를 입력한게 맞나요? 전체 쿼리 및 수행 결과를 부탁드립니다.

2. 추가로 사용자 접속 후 아래 쿼리 결과도 부탁드립니다.
SELECT P.loginame, P.program_name, C.net_transport FROM sys.dm_exec_connections AS C LEFT JOIN sys.sysprocesses AS P ON C.session_id = P.spid

3. 앞서 요청드린 SA 로그 및 설정 파일(alias.conf, access.rule) 수집 부탁드립니다.

4. 최근 ID/APP 파싱 관련 개선사항이 있는데 가능하다면 패치 후 동작 확인 부탁드립니다. 패치 후에도 문제가 있다면 패치 버전으로 위에 요청한 정보를 수집 부탁드립니다.
- https://bbs.pnpsecure.com/showthread.php?tid=12892 | 신호철: 업로드 해주신 access.rule 파일을 보면 정책에 ID/APP 이 포함되지 않았습니다.
ID/APP 이 포함된 정책 배포 후 다시 확인 부탁드립니다.

추가로 SA 로그도 요청드렸는데 수집 부탁드리고, 쿼리 결과값은 전체가 보일 수 있게 전달 부탁드립니다. | 황재필: 4. 최근 ID/APP 파싱 관련 개선사항이 있는데 가능하다면 패치 후 동작 확인 부탁드립니다. 패치 후에도 문제가 있다면 패치 버전으로 위에 요청한 정보를 수집 부탁드립니다.
- https://bbs.pnpsecure.com/showthread.php?tid=12892

해당 파일로 패치 후 정책배포시 일부 서버 로깅은 정상 동작 합니다.

하지만, RIP(10.xxx.xxx.31)에 VIP(10.xxx.xxx.35) 설정 및 Teaming 설정이 되어있는 서버의 경우, 여전히 로깅이 되지않는 현상이 있습니다. | 황재필:  | 황재필: SELECT P.loginame, P.program_name FROM sys.sysprocesses AS P INNER JOIN sys.dm_exec_connections AS C ON P.spid = C.session_id AND C.client_net_address='10.110.10.106'; | 황재필: SELECT P.loginame, P.program_name, C.net_transport FROM sys.dm_exec_connections AS C LEFT JOIN sys.sysprocesses AS P ON C.session_id = P.spid; | 황재필: access.rules, alias.conf 파일은 수정 업로드했습니다. | 신호철: 요청드린 SA 로그는 SA 모듈 로그입니다. C:\ProgramData\NODESAFER\Log 폴더 수집 부탁드립니다. | 황재필: 본문에 파일 첨부드렸습니다. 감사합니다. | 신호철: SA 가 mssql 에 TCP 127.0.0.1 로 접속하지 못하는 상황으로 보여집니다.
윈도우 cmd 에서 아래 명령어 실행 후 결과값이 tcp 로 출력되는지 확인 부탁드립니다.

sqlcmd -S tcp:127.0.0.1 -E -Q ""SELECT TRIM(C.net_transport) FROM sys.dm_exec_connections AS C LEFT JOIN sys.sysprocesses AS P ON C.session_id = P.spid WHERE P.program_name='SQLCMD'""

만약 tcp 로 출력이 안된다면 sa 가 mssql 에 접속하지 못하는 상황입니다. 아래 벅스에서 개발자의 마지막 코멘트를 참고하셔서 설정 부탁드립니다.
- https://bugs.pnpsecure.com/view.php?id=26406

아래 카페글도 참고 부탁드립니다.
- https://cafe.naver.com/pnpsecure2/6138",https://cafe.naver.com/pnpsecure2/5985
5980,[카카오뱅크] dbsafer_stat_report 테이블 내 UNUSED~~~ 로우들을 추가적으로 생기지 않게 하는 방법이 있는지 궁금합니다.,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
카카오뱅크
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크)
- dbsafer3.dbsafer_stat_report 테이블 내 UNUSED~ 관련 데이터들이 계속 늘고 있는데, 해당 데이터를 더 이상 생기지 않게 할 수 있는지 궁금합니다.
> 카카오뱅크의 경우 미사용 자동연동정책, 미사용 사용자 IP 를 pnp_statistics 모듈에서 CREATE Query, Insert Query를 통해 생성중입니다.
> 해당 데이터의 양이 수십만 로우 정도 되는데, 이번에 새로운 테이블을 추가하여서 pnp_statistic에서 90일치의 배치쿼리를 돌려야 하는 상황입니다.
> 허나 사진과 같이 UNUSED~~ 이면서, enable = 1 인 값을 가진 로우가 dbsafer_stat_report에 1400여개나 있어 pnp_statistics 모듈에서 90일치를 돌릴 때 부하 발생이 걱정되어 해당 테이블을 더 이상 생성되지 않도록 요청이 있었습니다. (현재 불필요한 로우들은 제가 제거 하도록 하겠습니다.)
> 카카오뱅크의 경우 과거 담당자가 1달치의 배치쿼리를 돌렸다가 too many open files 에러가 발생한 적이 있어서 주의가 필요할 것 같습니다.
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- N/A
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- N/A
4. 사내 재현 정보
- N/A
5. 요청사항
- dbsafer3.dbsafer_stat_report 테이블 내 UNUSED~~ 관련 로우들을 더 생성되지 않도록 설정이 가능한지 궁금합니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
- N/A
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
- N/A
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
- N/A","여성구: 말머리 양식이 잘 못되어 확인하지 않습니다. | 이창제: 안녕하세요. 여성구 부장님.
기술본부 기술지원2팀 이창제 대리 입니다.

말머리 양식 수정 완료 하였습니다.

감사합니다. | 여성구: @최재규 대리님
매니저에서 미사용 정책 및 객체 관련된 통계 쿼리에 대해서 미사용 할 수 있는지 체크부탁드립니다. | 최재규: [문의사항]
- dbsafer3.dbsafer_stat_report 테이블 내 UNUSED~ 관련 데이터들이 계속 늘고 있는데, 해당 데이터를 더 이상 생기지 않게 할 수 있는지 궁금합니다.

[답변]
매니저에서는 dbsafer_stat_report 테이블 table_name 필드에

used_policy_log
used_object_log
used_policy_log_ex

3개 테이블 정보가 없을 경우에 배치 쿼리를 넣게 됩니다.
매니저에서 미사용 객체,정책 기능을 사용할 경우 생성되는 테이블인데 해당 테이블 유무를 확인해주시길 바랍니다. | 이창제: 확인 감사합니다 !!

고객사 방문 시 해당 테이블 유무 확인하여 조치하겠습니다 !",https://cafe.naver.com/pnpsecure2/5980
5979,[동국제약] 개발 웹 어플리케이션에서 DB 접속 시 NAT 불가 현상 추가 확인 필요 내용 요청 드립니다.,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
동국제약
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크)
- Apache2.2 httpd 프로그램 (웹 개발 프로그램) 에서 DB접속 시 NAT 되지 않아 SERVER AGENT 정책을 타는 현상
> 기존에는 SERVER AGENT에 사용자 PC를 허용으로 넣어 사용중이었으나, 이제는 직접 접속을 막아야 하는 상황이라 해결책 요청
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- N/A
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- N/A
4. 사내 재현 정보
- 사내에선 정상적으로 NAT 되어 감사 로그에 남고 있습니다.
> 고객사와 동일하게 Apache2.2 버전을 설치하여 php 형식으로 사이트 접근 시 DB 접속하게 세팅 하였습니다.
5. 요청사항
- 사내에서는 동일 PC ASSIST를 설치하여 테스트 시 정상 NAT가 되는 상황입니다.
- 고객사에서는 동일한 코드 실행 시 SA 정책을 타고 있으며, 이를 해결하기 위해 추가적으로 수집해야 할 부분들을 확인해주시면 감사하겠습니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
- DBSAFER PKG : PKG_DBSAFER5_RelR22.11-RockyLinux_x86_64_20230413.tar.gz
- DBSAFER AGENT : 3.2.36.1
> TDI driver : 2.1.11.0
- pnp_mysql : rev2366
- Apache2.2 httpd : Ver 2.2
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
1) user_pc_wireshark_20230919.pcapng
- 사용자 PC에서 Apache2.2 통해 DB 접속 시 NAT 되지 않고 직접 접속하는 패킷
> DBSAFER IP : 10.11.1.211
> 사용자 PC IP : 10.2.50.16
> 대상서버 IP : 192.168.1.122 3306
2) user_pc_정상접속_패킷_20230919.pcapng
- 사용자 PC에서 Toad.exe 통해 DB 접속 시 정상 NAT 되는 패킷 (tcp.stream eq 13)
> DBSAFER IP : 10.11.1.211 4004
> 사용자 PC IP : 10.2.50.16
> 대상서버 IP : 192.168.1.122
첨부파일
user_pc_wireshark_20230919
.pcapng
null
파일 다운로드
첨부파일
user_pc_정상접속_패킷_20230919
.pcapng
null
파일 다운로드","여성구: 말머리 양식이 잘 못되어 확인하지 않습니다. | 이창제: 안녕하세요. 여성구 부장님.
기술본부 기술지원2팀 이창제 대리 입니다.

말머리 양식 수정 완료 하였습니다.

감사합니다. | 김태윤: DBSAFER Agent를 먼저 실행 후 Apache 를 실행하여 NAT가 되는지 확인 바랍니다. | 이창제: 안녕하세요. 김태윤 실장님.
기술본부 기술지원2팀 이창제 대리 입니다.

사내 테스트 시에는
1) Apache 실행 > DBSAFER AGENT 실행
2) DBSAFER AGENT 실행 > Apache 실행

과 같은 순서에서도 정상 NAT 및 로깅을 확인 하였습니다.

고객사에는 가이드 주신 방법으로 동일하게 한 번 확인 요청을 하겠습니다.

감사합니다. | 여성구: 본 사항에 대해서 팀 리뷰가 되었나요? 정보가 부족한 것 같은데 팀장님과 확인하여 분석 지원을 먼저 받길 바랍니다. | 진선태: 패킷을 보면 목적지(192.168.1.122)이 타겟이 될 때에 MAC 주소가 ""12:01:00:00:01:00""으로 감지되고,
들어오는 패킷에서의 192.168.1.122 MAC주소는 ""44:5b:ed:98:c1:00)으로 잡힙니다.

들어오는 패킷은 문제가 없지만
나가는 패킷의 MAC주소는 일반적인 MAC주소가 아닙니다. (NIC 벤더사가 없는 가상 MAC 주소)

추정되는 부분은 해당 장비(10.2.5.16)의 네트워크 드라이브에 추가된 보안 프로그램이 먼저 드라이브를 선점하여 NAT를 타지 못하게 영향을 준 것으로 보입니다.

그리고
10.2.5.16(WAS)장비에서 192.168.1.122:3306으로 직접 붙을 때의
netstat -ano
를 실행하여
최종적으로 어떠한 프로세스를 타고 접속되었는지 PID를 체크하시기 바랍니다. | 여성구: 원격 지원으로 확인을 하였습니다.

우선 보안 프로그램은 관계 없는 것 같습니다. 하지만 PC 에 설치된 서비스가 영향을 주었습니다.
결론적으로 다른 서비스에서 접속을 하기 때문에 위에서 예측한 상황과 같습니다.

Apache 2.2 서비스를 이클립스에서 사용하고 있었습니다.
즉, Apache 2.2 서비스에서 DB 에 직접 접속이 되고 있는 것 이었습니다.

구성은 로컬 PC 에 Apache 2.22 설치 되어 있으며 이클립스로 개발을 하고 있습니다.
이클립스에서 웹 서버 설정을 설치 된 Apache 로 한 것 같습니다. 개발 언어는 PHP 입니다.

결과적으로는 NAT 우선 순위 문제이나 케이스 이력 관리가 필요하므로 bugs 등록을 해주세요.
웹플랫폼실에서 지원을 받으면 내부에서 재현을 할 수 있을 것 같습니다.

[대용 가이드]
1. 업무 지속을 위해서 고객 사용자에게 DB 접속 시 DBSAFER IP, Port 로 접속하는 것을 우선 가이드
2. pnp_oms_dms 설정 ",https://cafe.naver.com/pnpsecure2/5979
5978,[공유] pnp_ssl_proxy 모듈의 복호화 패킷 저장 기능 사용법,"안녕하세요. 정보보안기술연구소 선행기술팀 박승민입니다.
pnp_ssl_proxy 모듈에서 통신 중인 암호화 패킷을 복호화해 파일로 저장하는 기능이 추가되어 사용법을 공유드립니다.
[기능 추가 배경]
- SSL 암호화 통신을 수행하는 DBMS 서비스의 경우 사용자-DBSAFER 구간 또는 DBSAFER-대상서버 구간의 패킷을 취득하더라도 암호화된 통신 내용을 확인할 수 없어 DBMS 서비스 모듈에서 이슈 분석이 어려웠습니다.
- pnp_ssl_proxy 모듈 - DBMS 서비스 모듈 구간에서는 복호화된 평문 패킷으로 통신하지만, UDS(Unix Domain Socket) 통신을 하기 때문에 통신 내용을 취득하기 어려웠습니다.
- 기존의 pnp_ssl_proxy 모듈의 디버그 모드 수행은 큰 패킷의 경우 패킷 전체를 출력하지 않았습니다.
- DBMS 서비스 모듈은 평문 패킷의 Stream 값(TCP Follow)를 이용해 이슈 재현 및 테스트를 수행할 수 있기 때문에 해당 데이터가 있을때 이슈 분석을 보다 수월하게 진행할 수 있습니다.
[제공 버전]
- pnp_ssl_proxy Rev.158 이상
[설정 방법]
- 설정파일(.conf/pnp_ssl_proxy.conf)에 복호화 패킷 저장 기능 설정 후 저장시 바로 적용됩니다.
> 설정 포맷 #1 : SAVE_PACKET_FILE = [[서비스객체번호]]
> 설정 포맷 #2 : SAVE_PACKET_FILE = [[대상서버IP]]:[[Port]]
- 여러 세션을 설정하고 싶을 경우 설정 값을 여러번 작성해주시면 됩니다.
> 설정 예시 :
SAVE_PACKET_FILE = 10.10.10.10:1433
SAVE_PACKET_FILE = 11.11.11.11:3306
※ 설정 후 pnp_ssl_proxy 모듈 재시작 불필요
※ 설정 후 새로 접속되는 세션에 대해서 복호화 패킷을 저장하며, 기존 접속 중인 세션의 패킷은 저장하지 않음
※ 원하는 세션의 복호화 패킷을 취득 후에는 반드시 설정을 원복(비활성화)해야 더이상 패킷을 저장하지 않음
[복호화 패킷 저장 위치]
- var/ssl_proxy/packet/[서비스번호]_[사용자IP]_[사용자Port]_[user|target].txt
> 사용자-DBSAFER 구간의 파일 suffix : user.txt
> DBSAFER-대상서버 구간의 파일 suffix : target.txt
※ 하나의 세션에 대해 두 개의 파일(user.txt / target.txt)이 생기는 것이 정상
※ 사용자 툴에서는 1회 접속을 시도한 것이라도 실제 접속은 여러번 시도할 수도 있어, 실제 접속 수만큼 파일이 생성
[제약사항(기능 미제공)]
- DynamoDB 서비스 미제공
- MSSQL 서비스 일부 미제공
> BYPASS 설정(.conf/pnp_ssl_proxy.bypass)과 동시 설정시에는 복호화 패킷이 아닌 암호화 패킷이 저장됨
> BYPASS 미설정시 기능 제공(복호화 패킷 저장)
앞으로 pnp_ssl_proxy 모듈을 사용하는 환경에서 DBMS 서비스 모듈의 이슈가 있을 경우 기존의 패킷 취득뿐만 아니라 본 설정을 통해 복호화 패킷 내용도 함께 전달주시면 이슈 분석 및 재현에 도움이 될 수 있을 것 같습니다.
추가적인 궁금하신 사항은 문의주시면 답변드리도록 하겠습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5978
5976,7.0 매니저 로그인 시도 시 에러 발생도 하지 않고 무반응 상태 지속 현상,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
에러로그문의
[고객사/채널사]
현기차생산망
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
증상 : 매니저 로그인 시도 시 매니저 접속이 되지 않고, 에러도 발생하지 않고 무반응 상태 유지
증상 발생 전 작업 :
> 서비스객체 14000개 추가
> 아래 쿼리 수행
INSERT IGNORE INTO dbsafer3.unified_server_group(set_idx,svr_group_no,svr_group_name,svr_group_type,svr_group_reserve1) VALUES(1,1,'울산',0,0);
INSERT IGNORE INTO dbsafer3.unified_server_group(set_idx,svr_group_no,svr_group_name,svr_group_type,svr_group_reserve1) VALUES(1,2,'전주',0,0);
INSERT IGNORE INTO dbsafer3.unified_server_group(set_idx,svr_group_no,svr_group_name,svr_group_type,svr_group_reserve1) VALUES(1,3,'아산',0,0);
INSERT IGNORE INTO dbsafer3.unified_server_group(set_idx,svr_group_no,svr_group_name,svr_group_type,svr_group_reserve1) VALUES(1,4,'광주',0,0);
INSERT IGNORE INTO dbsafer3.unified_server_group(set_idx,svr_group_no,svr_group_name,svr_group_type,svr_group_reserve1) VALUES(1,5,'광명',0,0);
INSERT IGNORE INTO dbsafer3.unified_server_group(set_idx,svr_group_no,svr_group_name,svr_group_type,svr_group_reserve1) VALUES(1,6,'화성',0,0);
INSERT IGNORE INTO dbsafer3.unified_server_info(set_idx,svr_idx,svr_group_no,svr_name,svr_type,svr_reserve1) VALUES(1,1,1,'US_1',2,0);
INSERT IGNORE INTO dbsafer3.unified_server_info(set_idx,svr_idx,svr_group_no,svr_name,svr_type,svr_reserve1) VALUES(1,2,1,'US_2',2,0);
INSERT IGNORE INTO dbsafer3.unified_server_info(set_idx,svr_idx,svr_group_no,svr_name,svr_type,svr_reserve1) VALUES(1,3,2,'JJ_1',2,0);
INSERT IGNORE INTO dbsafer3.unified_server_info(set_idx,svr_idx,svr_group_no,svr_name,svr_type,svr_reserve1) VALUES(1,4,2,'JJ_2',2,0);
INSERT IGNORE INTO dbsafer3.unified_server_info(set_idx,svr_idx,svr_group_no,svr_name,svr_type,svr_reserve1) VALUES(1,5,3,'AS_1',2,0);
INSERT IGNORE INTO dbsafer3.unified_server_info(set_idx,svr_idx,svr_group_no,svr_name,svr_type,svr_reserve1) VALUES(1,6,3,'AS_2',2,0);
INSERT IGNORE INTO dbsafer3.unified_server_info(set_idx,svr_idx,svr_group_no,svr_name,svr_type,svr_reserve1) VALUES(1,7,4,'GJ_1',2,0);
INSERT IGNORE INTO dbsafer3.unified_server_info(set_idx,svr_idx,svr_group_no,svr_name,svr_type,svr_reserve1) VALUES(1,8,4,'GJ_2',2,0);
INSERT IGNORE INTO dbsafer3.unified_server_info(set_idx,svr_idx,svr_group_no,svr_name,svr_type,svr_reserve1) VALUES(1,9,5,'GM_1',2,0);
INSERT IGNORE INTO dbsafer3.unified_server_info(set_idx,svr_idx,svr_group_no,svr_name,svr_type,svr_reserve1) VALUES(1,10,5,'GM_2',2,0);
INSERT IGNORE INTO dbsafer3.unified_server_info(set_idx,svr_idx,svr_group_no,svr_name,svr_type,svr_reserve1) VALUES(1,11,6,'HS_1',2,0);
INSERT IGNORE INTO dbsafer3.unified_server_info(set_idx,svr_idx,svr_group_no,svr_name,svr_type,svr_reserve1) VALUES(1,12,6,'HS_2',2,0);
INSERT IGNORE INTO dbsafer3.unified_server_ip(svr_idx,svr_ip_idx,svr_ip_type,svr_ip,svr_ip_interlink,svr_ip_addr_type,svr_group_reserve1) VALUES(1,1,0,'10.59.179.201',0,0,0);
INSERT IGNORE INTO dbsafer3.unified_server_ip(svr_idx,svr_ip_idx,svr_ip_type,svr_ip,svr_ip_interlink,svr_ip_addr_type,svr_group_reserve1) VALUES(2,2,0,'10.59.179.202',0,0,0);
INSERT IGNORE INTO dbsafer3.unified_server_ip(svr_idx,svr_ip_idx,svr_ip_type,svr_ip,svr_ip_interlink,svr_ip_addr_type,svr_group_reserve1) VALUES(3,3,0,'10.69.21.51',0,0,0);
INSERT IGNORE INTO dbsafer3.unified_server_ip(svr_idx,svr_ip_idx,svr_ip_type,svr_ip,svr_ip_interlink,svr_ip_addr_type,svr_group_reserve1) VALUES(4,4,0,'10.69.21.52',0,0,0);
INSERT IGNORE INTO dbsafer3.unified_server_ip(svr_idx,svr_ip_idx,svr_ip_type,svr_ip,svr_ip_interlink,svr_ip_addr_type,svr_group_reserve1) VALUES(5,5,0,'10.73.18.41',0,0,0);
INSERT IGNORE INTO dbsafer3.unified_server_ip(svr_idx,svr_ip_idx,svr_ip_type,svr_ip,svr_ip_interlink,svr_ip_addr_type,svr_group_reserve1) VALUES(6,6,0,'10.73.18.42',0,0,0);
INSERT IGNORE INTO dbsafer3.unified_server_ip(svr_idx,svr_ip_idx,svr_ip_type,svr_ip,svr_ip_interlink,svr_ip_addr_type,svr_group_reserve1) VALUES(7,7,0,'10.155.125.20',0,0,0);
INSERT IGNORE INTO dbsafer3.unified_server_ip(svr_idx,svr_ip_idx,svr_ip_type,svr_ip,svr_ip_interlink,svr_ip_addr_type,svr_group_reserve1) VALUES(8,8,0,'10.155.125.21',0,0,0);
INSERT IGNORE INTO dbsafer3.unified_server_ip(svr_idx,svr_ip_idx,svr_ip_type,svr_ip,svr_ip_interlink,svr_ip_addr_type,svr_group_reserve1) VALUES(9,9,0,'10.170.248.111',0,0,0);
INSERT IGNORE INTO dbsafer3.unified_server_ip(svr_idx,svr_ip_idx,svr_ip_type,svr_ip,svr_ip_interlink,svr_ip_addr_type,svr_group_reserve1) VALUES(10,10,0,'10.170.248.112',0,0,0);
INSERT IGNORE INTO dbsafer3.unified_server_ip(svr_idx,svr_ip_idx,svr_ip_type,svr_ip,svr_ip_interlink,svr_ip_addr_type,svr_group_reserve1) VALUES(11,11,0,'10.165.139.51',0,0,0);
INSERT IGNORE INTO dbsafer3.unified_server_ip(svr_idx,svr_ip_idx,svr_ip_type,svr_ip,svr_ip_interlink,svr_ip_addr_type,svr_group_reserve1) VALUES(12,12,0,'10.165.139.52',0,0,0);
UPDATE dbsafer3.unified_dbsafer_set_info SET set_idx=1;
UPDATE dbsafer3.unified_dbsafer_set_info SET set_type=2;
INSERT IGNORE INTO dbsafer3.variables(name,value) VALUES('nat_lb_use',1);
INSERT IGNORE INTO dbsafer3.variables(name,value) VALUES('lb_least_login_user',200);
INSERT IGNORE INTO dbsafer3.variables(name,value) VALUES('lb_tolerance_login_user',50);
INSERT IGNORE INTO dbsafer3.variables(name,value) VALUES('nat_lb_tolerance_host_cpu',15);
INSERT IGNORE INTO dbsafer3.variables(name,value) VALUES('nat_lb_tolerance_session',50);
ALTER TABLE dbsafer3.services ADD set_idx int(11) DEFAULT 0;
ALTER TABLE dbsafer3.services ADD gw_svr_idx int(11) DEFAULT 0;
ALTER TABLE dbsafer3.services ADD gw_svr_grp_idx int(11) DEFAULT 0;
UPDATE dbsafer3.services SET set_idx=1;
UPDATE dbsafer3.services S SET S.gw_svr_grp_idx=(SELECT USG.svr_group_no FROM dbsafer3.unified_server_group USG WHERE S.comment=USG.svr_group_name) WHERE S.comment!='';
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
> wireshark 확인 시 3118로 보내는 패킷은 보이나, DB포트로 패킷을 보내고 있지 않고 있음
> pnp_agent 모듈에서 아래와 같은 로그가 발생되고 있음(이미지 참고)
3. 특이사항 (연동 모듈, 커스텀 개발 등)
> 7.0
> 대량 서비스
> unified 일부 기능 적용
> DB포트 3306 -> 13306으로 변경 후 사용 중
4. 사내 재현 정보
> 없음
5. 요청사항
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
> manager : Build-2425
> pnp_agent : Rev1172
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","최재규: --------------1차 분석 내용 정리합니다.-----------------------
에러로그는 agent모듈(3118포트)<>매니저, agent모듈<>GW서버 통신에서 timeout 으로 인한 에러 발생.

1. 약 30분 뒤 매니저 접속 성공함.
2. 매니저<>pnp_agent 모듈 통신에 딜레이 발생으로 예상됨.
3. 매니저<>pnp_agent 모듈 통신 간 요청하는 정보 내역
> gw 서버 개수, gw 서버 시간, db 접속 정보, LOG 서버 리스트, 계정 리스트 이렇게 순서대로 요청

1차 분석 결론
= 사내 서버에서 동일한 쿼리를 실행한 후 매니저 접속 시 특이사항은 없음.
= 쿼리작업 내용과 agent모듈 <> 매니저 세션과 관련이 없을 것으로 판단됨.
= 전체 모듈 재시작 했을 때 다시 정상 동작이 되는 것이 확인됨. | 여성구: @최재규 머릿글 확인 중으로 변경해주세요. | 최재규: agent모듈 재시작 이후 매니저 접속 시 지연 이슈는 발생하지 않고 있습니다. 매니저 서비스 가동/정지 이슈에 대해 확인 중이며 본 문의사항은 완료 처리하도록 하겠습니다.",https://cafe.naver.com/pnpsecure2/5976
5974,mssql_account_finder 어플리케이션 명이 남지 않는 현상,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
세스코
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크
- mssql_account_finder를 이용하여 어플리케이션 명을 기록하는데 특정 프로그램에서 어플리케이션 명이 남지 않음
- 관련 어플리케이션: OZ Report Designer
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- 원인1. 어플리케이션 접속 후 MSSQL DB의 sys.dm_exec_sessions.program_name에 관련 정보가 없음
- 원인2. 패킷해더의 값을 알 수 없음
3. 특이사항 (연동 모듈, 커스텀 개발 등)
N/A
4. 사내 재현 정보
N/A
5. 요청사항
- OZ Report의 경우 우리도 사용을하는 프로그램으로 포시에스와 어느정도 연계가 가능할 것 같습니다.
- 포시에스쪽에 요청을 하여 OZ Report Designer로 MSSQL 접속 시 어플리케이션 명을 남기도록 수정 요청이 가능한지
확인 부탁드립니다.
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
- mssql_account_finder 1.0.26
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)
#mssql_account_finder #어플리케이션명 #OZ Report Designer",여성구: FAQ 내용이 아닙니다. 임원분께 요청해주세요. QA 에서 타 업체와 직접 협의 하지 않습니다.,https://cafe.naver.com/pnpsecure2/5974
5973,[이랜드이노플] pnp_aws_service 모듈의 동작 방식 (로직) 문의,"[분류]
- 기능로직문의
[고객사/채널사]
- 이랜드이노플
[이슈내용]
- 고객사에서 pnp_aws_service 모듈이 대상서버 IP 정보를 조회하는 로직의 대한 상세 설명 요청
- scale in/out 시 IP 변동 되는 경우 조회하는 로직 설명 요청
[버전 정보]
- N/A
[첨부파일]
- Google Drive 내 pnp_aws_service 설명 문서
첨부파일
[기능참고자료]클라우드통합모듈(aws_service)
.pptx
null
파일 다운로드","최재규: aws_service 모듈은 매니저에 등록된 credential 정보를 사용해서 AWS 콘솔에 접속하며 정보를 가져오게 됩니다.
이 때 credential 에 해당하는 계정은 READ 권한(EC2, RDS, Autoscle, DynamoDB 등)이 반드시 필요합니다.

aws_service 모듈에서 하는 기능은 크게 3가지 입니다.
- ip_range 확인
- scale_inout 확인
- scale_updown 확인
모듈을 가동할 때 기본적으로 모든 기능이 동작하며, 이후 각 기능은 60분의 주기로 순서대로 동작을 합니다.
명령어를 통해 각 동작 실행도 가능하며 설정파일에서 주기 변경도 가능합니다.

현재 autoscle로 inout 되는 경우 ip_range 조회가 먼저 동작하면서 다음 주기까지 ip 조회가 되지 않는 현상이 있습니다.
*** BT:25344 수정 버전부터는 scale_inout 다음 ip_range 순서로 동작하게 됩니다.(변경 예정) | 김도형: 고객사에서 두 가지 추가 문의 사항이 있어 확인 요청 드립니다.

- DBSAFER에서 param1, param2 테이블이 확인해서 등록하는 정보는 대상 AWS의 어느 정보를 가져가는 것인가요?
- Spinnaker 배포 도구를 통한 연동 사례가 있는지, 혹은 개발 예정 사항이 있나요? | 최재규: AWS 콘솔에서 autoscale 그룹명 정보를 입력해주시면 됩니다. 첨부해주신 문서에서 2.2페이지 참고 하시면 됩니다.
Spinnaker 배포 도구를 통한 연동 사례는 없는 것으로 알고 있습니다. 별도 개발 예정 사항 없습니다.",https://cafe.naver.com/pnpsecure2/5973
5972,[공유][한섬] 테이블.컬럼명 데이터마스킹 적용 불가 제약사항 공유,"한섬 고객사에서 확인된 테이블.컬럼명 데이터마스킹 적용 불가한 제약사항에 대하여 공유드립니다.
1. 버전정보
- pnp_ssl_proxy v.114
- pnp_postgresql v.2289
- 대상 DB : Aurora postgresql v.13.8
2. 현상
- 테이블.컬럼명(et_mbr_dlvp_info.zip_addr) 객체를 등록하여 마스킹 처리 중
- 사용자는 PC에서 Orange 툴을 사용하여 1. select * from et_mbr_dlvp_info limit 10; 쿼리를 입력하여 DB 전송 시도
- Orange 툴 자체적으로 declare와 fetch 구문을 붙여서 전송(declare ~~ select ~~ fetch~~)
- et_mbr_dlvp_info 테이블의 zip_addr 컬럼 데이터를 결과값으로 표시하나 해당 결과값은 select가 아닌 2. fetch 구문
에서 발생시키며 select 문 내 테이블 정보는 declare의 하위 내용으로 처리되어 테이블 객체 정보로 파싱하지 못하여
et_mbr_dlvp_info.zip_addr 데이터마스킹 객체가 적용받지 못함
위 현상처럼 사용자 입장에선 select 구문만 툴에 입력하여 전송한 것처럼 보이나 실제 DB로는 declare~select~fetch
구문으로 전송될 수 있습니다. 이와 같은 경우에서 쿼리의 결과값은 2. fetch~~ 구문에서 결과값을 발생시키며 fetch
구문에서는 테이블 정보를 알 수 없어 테이블.컬럼명 마스킹은 불가하고 컬럼명 마스킹만 가능한 제약사항입니다.
관련 bugs : https://bugs.pnpsecure.com/view.php?id=25545#c95171",댓글 없음,https://cafe.naver.com/pnpsecure2/5972
5971,[공유][SC제일은행] DBSafer 서비스 포트 대상 보안취약점 대응문제,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기타문의
[고객사/채널사]
SC은행
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
- 사이트 취약점 진단 내용
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
N/A
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 취약점 port 에 대해서 해당 포트들은 Agent간 통신용으로 Agent별로 4000번대 이상포트를 순차적으로 부여되어 사용되는 것으로 필수포트로 설명하였고, 사이트에서도 인지하였습니다.
- 해당 서버는 GW 서버로 JDK 와 apache 가 동작하지 않는다고 설명하였습니다.
- 사이트에 사용자 <=> DBSAFER 구간 암호화를 사용중입니다.
4. 사내 재현 정보
N/A
5. 요청사항
- 사이트 취약점 체크중에 Weak SSL/TLS Key Exchange 취약점 조치 가능 여부 확인 요청드립니다.
- 해당 사이트 조치가이드의 해결방안으로 원천적인 조치방안을 적용가능한지 확인 바랍니다.
[첨부파일]
- 취약점 내용
Unique Reference ID
HOSTNAME
Asset Environment
Protocol
Port
CI Name
QID/REF ID
New CVE ID
Vulnerability Identified
VULM-2711664
krdgldbac21
DR
tcp
4144
DAM(RDB)-SCBK
38863
Weak SSL/TLS Key Exchange
VULM-2712989
krdgldbac21
DR
tcp
4080
DAM(RDB)-SCBK
38863
Weak SSL/TLS Key Exchange
VULM-3312243
krdgldbac21
DR
tcp
4092
DAM(RDB)-SCBK
38863
Weak SSL/TLS Key Exchange
VULM-41181
krdgldbac21
DR
tcp
4501
DAM(RDB)-SCBK
19672
CVE-2012-1675
Oracle Database TNS Listener Poison Attack Vulnerability
- 사이트 조치 내용 가이드
No.
취약점 명
취약점 설명
해결 방안
비고
264
Weak SSL/TLS Key Exchange
An attacker with access to sufficient computational power might be able to recover the session key and decrypt session content.
IVSU 취약점 리스트 Port 번호를 사용하는 process가 사용하는 Java의 Java.security 파일을 찾아 아래의 1번 2번 설정을 수행하셔야합니다.
(설정값 : RSA, DHE 의 경우 2048bit이상, 그 외 ECDSA등의 Key값은 224bit 이상으로 설정.)
1번
Java 1.8 이상
- RSA와 ECDSA 관련
jdk.tls.disabledAlgorithms=SSLv3, TLSv1.0, TLSv1.1, RC4, DES, MD5withRSA, DH keySize < 1024, DESede, EC keySize < 224, 3DES_EDE_CBC, anon, NULL
를 아래와 같이 설정.
jdk.tls.disabledAlgorithms=SSLv3, TLSv1.0, TLSv1.1, RC4, DES, MD5withRSA, DH keySize < 2048, DESede, EC keySize < 224, 3DES_EDE_CBC, anon, NULL
Java 1.8 이하
- Java.security 파일에 아래의 내용을 추가
jdk.tls.disabledAlgorithms=SSLv3, TLSv1.0, TLSv1.1, RC4, DES, MD5withRSA, DH keySize < 2048, DESede, EC keySize < 224, 3DES_EDE_CBC, anon, NULL
2번
사용하는 프로세스별 위치가 다르기 때문에 이점 참고하여 진행 바랍니다.
사용하는 프로세스의 JVM arguments에 아래 설정 추가
- 아래 설정인 DHE에 대한 취약점 설정입니다.
-Djdk.tls.ephemeralDHKeySize=2048
해당 취약점 조치 시 해당 포트와 통신하는 서버 또한 같은 Key 값으로 설정되어야 하며 따라서 업무에 영향도가 있을 수 있으며, 영향도로 인해 패치가 불가할 경우 Risk 등재 필요함.
[스캔 결과 예시]
PROTOCOL NAME GROUP KEY-SIZE FORWARD-SECRET CLASSICAL-STRENGTH QUANTUM-STRENGTH TLSv1.2 RSA 1024 no 80 low","여성구: 보안취약점으로 확인된 포트 4144, 4080, 4092, 4501은 서비스 포트입니다.
PC Assist 를 통해서 proxy 방식으로 보호대상서버에 접근을 하는 것 입니다.

즉, 해당 취약점은 DBSAFER 의 취약점이 아닌 보호대상서버의 취약점입니다.
Proxy 방식 자체는 추가적인 암호화 통신을 하지 않고 있습니다. (암호화 통신을 사용하지 않을 경우 의미)

상기 취약점 대응은 보호대상서버의 취약점 대응이 되어야 합니다.

담당엔지니어는 상기 서비스 보호대상서버의 DB 버전 혹은 서버 SSH 버전 등을 확인하여 취약점 대응을 고객 보안담당자에게 어필하여 주시기 바랍니다. | 여성구: 게시글 주제 변경해주세요. ""DBSafer 서비스 포트 대상 보안취약점 대응문제"" 로 해주세요.",https://cafe.naver.com/pnpsecure2/5971
5969,[DBSAFER WORKS] 결재 후 정책 반영 실패에 대해 문의드립니다.,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
에러로그문의
[고객사/채널사]
LS전선
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
- 사용자 2명(wkkang, jhlee_idc)의 자동접속 메뉴에 접속 가능한 서버 리스트가 표시되지 않음
- 사용자 2명(wkkang, jhlee_idc) OS계정 사용권한 신청내역이 정책에 반영되지 않음
- DB 테이블(psync.am_policy,os_account_to_user_mapper)에는 위 신청서 정책저장 확인
- ./pnp_imup_policy shm_print 1 | grep sno 확인 결과 정책이 조회되지 않음
- 결재완료 시점 pnp_imup_policy 에러 로그 확인 (결재 완료 시점에 발생)
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- pnp_imup_policy 정책 반영과정 중 발생된 에러로 보이며 에러 메세지 확인 필요
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 단독 이중화 구성
4. 사내 재현 정보
없음
5. 요청사항
위 에러로그의 정보에 대해 확인 부탁드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
IMUP_POLICY.v2 Release (Rev 35) Jun 29 2022 14:33:14s
( SHARED INTERFACE VERSION INFO: Rev.512 )
( COMMON-API(UTIL) INFO: Rev.162 )
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","여성구: pnp_imup_policy 모듈 버전은 v2 Rev44 버전 이상으로 패치 후 재확인 요청

관련 이슈 : https://bugs.pnpsecure.com/view.php?id=24735 | 여성구: 추가로 상기는 결함입니다. 결함을 FAQ 에 문의 하지 말고 bugs 에 등록해주세요.",https://cafe.naver.com/pnpsecure2/5969
5965,[롯데케미칼] ServerAgent 차단 정책 원복 이후에도 서비스 정상화 되지 않은 이슈,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
- 에러로그문의
[고객사/채널사]
- 롯데케미칼
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
08:05 SA - DBMS 정책 - 차단 정책에서 IP객체를 ANY로 변경하고 활성화
08:06 그룹웨어 관련 서버IP가 차단되어 서비스 장애 발생 (총 25739건)
08:55 SA - DBMS 정책 - 차단 정책 원복
08:55 이후 대부분의 서비스가 정상화 되었으나, 그룹웨어 서비스가 정상화가 되지않은 이슈
08:58 원복한 차단 정책 미사용
09:10 원복한 차단 정책 사용
09:26 원복한 차단 정책 미사용
10:07 2개의 서비스 객체 개별 허용 정책 생성
(해당 부분까지 엔지니어와 상의 없이 담당자가 진행하였습니다)
10:09 SA 서비스 정지 요청으로 BYPASS 진행
10:15 정상 동작 확인 완료
- 로그분석을 위해 장애 이후 정책 변경 작업의 모든 시간을 전달드립니다.
- 08:55부터 SA 서비스를 정지한 시점까지 장애가 일어난 사유를 요청하고있습니다.
- 장애 상황은 그룹웨어가 정상적으로 동작하지않고, 결재 시 행걸린 것처럼 동작했다고합니다. 관련해서 따로 이슈 사진이 없다고 하고 로그는 확인 요청해두었습니다.
- 2개의 서버로 이중화 동작 중인 그룹웨어의 결재 기능을 하는 서버라고 합니다.
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- pnp_server_maanger.shared_nic에 (RIP + VIP)로 등록되어야 할 설정이 반대로 되어있었음
- 하지만, service.log에서 확인 결과 정책은 정상적으로 배포된것으로 확인 됩니다. 아래 로그가 정책 배포 수신 로그가 맞는지, shared_nic 설정파일의 vip+rip 설정은 영향도가 없는지도 확인 부탁드립니다.
- SA 우회로그 확인 결과 : 2개의 서비스 모두 08:55 부터 SA 서비스를 정지한 시점까지 허용로그가 존재합니다. 차단로그는 없습니다.
- 방화벽, 보안 프로그램 모두 특이사항 없습니다.
- 금일 고객사 사정으로 윈도우 이벤트 로그를 수집하지 못하여, 명일(09/13) 오전 중으로 에러로그 확인하여 첨부하겠습니다.
- 대상서버에서 수집한 NODESAFER 로그는 하단에 첨부하였습니다.
- conf 폴더 내 파일은 추출하지 못하여 사진으로 전달드립니다.
- SA 정책 사진
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- N/A
4. 사내 재현 정보
- N/A
5. 요청사항
- 2번에 작성한 내용인 pnp_server_maanger.shared_nic 설정으로 인해 해당 영향을 줄 수 있는지 확인 부탁드립니다.
- 또한 ws 로그에 다음과 같이 Thread start/stop이 수십번 발생하는데 해당 로그가 무엇인지 확인 부탁드립니다.
- 추가로 첨부된 파일 내에서 에러로그를 확인하지 못하였는데, 장애 관련 에러 내용이 있는지 확인 부탁드립니다.
- 정책이 정상적으로 배포되었음에도, 특정 서비스가 비정상 동작하다가 BYPASS 된 후 정상동작하게 된 경우, 본문 사항 이 외에 확인할 수 있는 사항이 있는지도 확인 부탁드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
첨부파일
89서버 설정파일 및 nodesafer 로그
.zip
null
파일 다운로드
첨부파일
90서버 설정파일 및 nodesafer 로그
.zip
null
파일 다운로드
첨부파일
sm_20230912
.log
null
파일 다운로드
첨부파일
MOIN(그룹웨어) 로그
.zip
null
파일 다운로드
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
Server Manager : v5.1.6.50
대상 Server Agent : v5.0.6.71
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","신호철: 08:05 ~ 08:55 동안 우회접근 ANY 차단 정책이 적용된 시간대에서만 SA 차단이 발생한 것으로 확인됩니다.(서버 이벤트 로그 및 SA 로그로 판단)
- 상세 분석 내용 : https://docs.google.com/presentation/d/1v4b8J_WcURitctjxPv-PDsIHthpJUDwm/edit#slide=id.g27eb1b20bc7_1_96


ws 로그의 Thread start/stop 로그는 아래와 같은 경우 발생하는데, 실제 우회접속에 영향을 주는 모듈은 아니라서 이번 이슈와는 상관이 없습니다.
1. WTA >> WTS TCP 접속 ""start 로그""
2. 요청 및 응답 처리
3. 통신 종료
4. WTS 통신 스레드 종료 ""onDone 로그""

2번 요청 및 응답 처리 유형은
A. 사후 감사
B. wta_server_manager 설정 요청
C. wta_server_manager 설정 갱신
D. 접속 정보 요청
E. 접속 정보 갱신
F. 접속 정보 삭",https://cafe.naver.com/pnpsecure2/5965
5960,[공유] IMUP > SMS + DBSYNC 방식을 이용한 Slack 결재 알림 연동 사례 공유,"안녕하세요
클라우드기술팀 손혁진입니다.
트래블월렛 고객사에서 IMUP 통해 Slack 결재 알림 연동 요청이 있어 아래와 같이 진행 된 내용 공유 드립니다.
[요약]
- 고객사에서 IMUP 통해 Slack 결재 알림 연동 요청
- 알림 방식은 IMUP > SMS + DBSYNC 방식을 사용하여 결재 알림 데이터가 dbsafer3.sms 테이블로 SYNC
※ 단. IMUP > SMS + DBSYNC 방식은 1.0.5 버전에서만 사용 가능한 점 참고 필요
- pnp_sms 모듈이 dbsafer3.sms 테이블에 존재하는 데이터를 특정 Slack 채널로 전송
[구성도]
- IMUP > SMS +DBSYNC을 이용한 Slack 결재 연동 구성도(w pnp_sms)
[연동절차 설명]
1. IMUP 엔지니어 계정 접속
2. 시스템 관리 > 알림통지 관리 > 알림 통지 정책 클릭 후 알림방식(SMS) & 알림 정책 명(DBSAFER SMS 연동) 클릭
3. 알림 방식(SMS) + 구분(DBSYNC) 선택 및 알림 설정값에 DBSAFER DB 정보 기입 후 수정
4. 시스템 관리 > 알림 문구 관리 > 변경 할 알림 문구 템플릿 클릭
5. 고객사 요구사항에 맞는 알림 문구 내용으로 변경 후 저장
6. DBSAFER 서버 접속 후 아래와 같이 pnp_sms.properties 수정 후 저장
# SMS 연동 타입 (dbms(Default), url)
# dbms : DBMS에 쿼리를 INSERT하는 방식.
# url : 지정된 형식의 http get 요청으로 INSERT하는 방식.
# shell : 쉘스크립트를 실행하여 전송하는 방식. 명령어내 예약어 사용가능([[PHONE]], [[MESSAGE]])
# wibee : 위비톡(우리은행) 커스터마이징 전송 방식
#
Smstype = url
# HTTP 전송 방식 (0: GET, 1:POST)
# (default: 0)
UrlSendType = 1
# HTTP 전송 URL (필수)
# SMS데이터 입력 URL, 아래와 같이 각 내용을 예약어로 설정가능. (예약어: %%)
InsertUrl = https://hooks.slack.com/{구분자 URL}
# HTTP Header (선택)
# Field/Value 구분자(:), 다중입력 구분자(,)
# ex) {field1}:{value1}, {field2}:{value2} ...
InsertHeader = Accept:application/json, Content-Type:application/json; charset=utf-8
# HTTP Body (선택)
# 예약어로 설정가능. (예약어: %%)
InsertBody = {""username"":""DBSAFER"",""text"":""%%""}
# InsertBody 예약어에 대응되는 항목들을 ','로 구분하여 순서대로 입력 (InsertBody에서 예약어를 사용했다면 필수)
InsertBodyItem = msg
# 연동 대상의 입력방식(인코딩) 설정
TargetCharacterSet = UTF-8
# DBSAFER DB 운영 Character Set
# 0: latin1 (default)
# 1: utf8
#
DbsaferCharacterSet = ""설치 Character Set에 맞는 값 기입""
7. pnp_sms 모듈 실행
- pnp_sms 모듈 실행
# cd /dbsafer
# ./pnp_sms.sh start
8. Slack 결재 알림 테스트 완료
9. 시스템 관리 > 알림 통지 관리 > 알림 전송 현황 클릭 후 전송 상태 확인 완료
[기타]
- IMUP Email 알림 방식은 pnp_mailer 모듈이 아닌 웹에서 자체적으로 메일 연동을 하게 되어있습니다.
IMUP Email 알림 방식에 HTTP 프로토콜을 사용하여 알림을 전송 하는 방법이 있지만 해당 방식으로는
Slack과 연동이 불가능 합니다.
이에 SMS + DBSYNC 방식을 사용 시 pnp_sms 모듈 통해 Slack 연동이 가능 하여 해당 방법으로 적용 되었습니다.
[별첨]
- IMUP 알림 문구 키워드 리스트는 아래와 같습니다.
NO
키워드
파라미터
1
프로세스 명
##processName##
2
문서 번호
##requestDocNum##
3
신청서 제목
##requestName##
4
신청자 명
##requesterName##
5
신청자 부서명
##requester.deptName##
6
신청서 hexBin
##hexBin##
7
신청서내용
##requestDataHtml##
8
비밀번호
##password##
9
장비명
##deviceName##
10
계정명
##account##
11
기간시작일
##validBegin##
12
기간종료일
##validEnd##
13
진행 중인 신청서 카운트
##runningInstanceCount##
14
사용자시스템URL
##imupUrl##
15
사용자IP
##userIp##
16
명령어
##cmd##
17
사용시작일
##useStart##
18
사용종료일
##useEnd##
19
사용 만료예정 계정목록
##accountUseExpireTable##
20
장기 미사용 권한 기준일수
##acctLongTermUnusedNumberOfDays##
21
권한 만료 예정 계정 목록
##accountAuthExpireTable##",댓글 없음,https://cafe.naver.com/pnpsecure2/5960
5959,[dbsafer_accountsync] AD연동에서 expire 설정 방법,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기능로직문의
[고객사/채널사]
현대기이자동차
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0 )
- 협력사 직원 퇴사 시 AD에 그대로 남아 있으며, Expire 를 지정해서 사용을 함
- DBSAFER에서 인사연동은 Expire 데이터를 연동하지 않기 때문에 해당 부분에 대한 추가 연동 요청
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
- dbsafer_ldap_list의 expier 컬럼은 varchar(20)입니다.
- AD에 설정된 expire의 데이터는 KST filetime 구조체로 해당 값을 치환하여 넣지 않으면 오류가 발생할 것 같습니다.
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- AD에 설정되어 있는 expire 내용
- 계정 만료 화면에 표시된 날짜는 UTC이고, accountExpires 특성값에 설정된 날짜는 KST (FILETIME 구조체)
4. 사내 재현 정보
- N/A
5. 요청사항
- dbsafer_accountsync를 AD연동으로 사용할 경우 expire를 매칭하는 방법
- 특성값이 KST (FILETIME 구조체)인 경우 특성 accountExpires를 그대로 매칭시켜면 되는지?
- filetime to datetime 등과 같이 치환하는 추가 수정이 필요한지 확인 필요
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
- 1.124.1_hyunki
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","여성구: @조재용 팀장님 할당하여 문의처리해주세요. | 최재규: ldap 에서는 시간값에 대해서 1601년 1월 1일 기준으로 경과한 시간값을 숫자로 저장하고 있습니다.
인사연동 모듈에서는 편집기 상에서 보이는 값을 그대로 연동해오기만 하기 때문에 숫자 데이터로만 가져오게 됩니다.

현재 상태에서는 accountExpires 값을 불러온 뒤 인사연동 모듈 설정파일의 AddtionalUpdateQuery 옵션 사용해서 불러온 컬럼을 쿼리문으로 숫자 -> 날짜로 변환하는 작업이 필요할 것으로 판단됩니다.

사내 테스트 서버에서 정상동작 확인하고 아래 쿼리 가이드 드립니다.
AdditionalQueryUpdate = UPDATE `dbsafer3`.`dbsafer_ldap_list` SET `컬럼` = from_unixtime((`컬럼`/10000000) - 11644473600) WHERE `sno`=[[sno]];

LDAP 시간값을 10000000 으로 나눠서 초를 구하고 1601-01-01 시간만큼 빼서 날짜로 변환하는 방법입니다.",https://cafe.naver.com/pnpsecure2/5959
5956,[pnp_log] can not read buffer file. t_q_buf_size[102258580] is too big. 에러로그 확인 요청,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
에러로그문의
[고객사/채널사]
KB라이프
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
: can not read buffer file. t_q_buf_size[102258580] is too big. 에러로그 발생
: buffer/list 혹은 buffer/fail 경로에 버퍼 파일이 존재 하지 않음
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항)
: N/A
3. 특이사항 (연동 모듈, 커스텀 개발 등)
: N/A
4. 사내 재현 정보
: N/A
5. 요청사항
can not read buffer file. t_q_buf_size[102258580] is too big. 에러로그 발생원인
[모듈 로그(Debugging 로그 및 ERROR 로그]
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
pnp_log R714
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","조재용: Rev 770에서 해당 이슈가 해결되었습니다.
BT:0024471 참고 바랍니다. | 정우성: 해당 벅스를 보면 버퍼 파일이 생성이 안된다고 나와있는데 그럼 대량의 데이터가 발생할 경우 로그 누락이 발생한다는 의미인가요?? | 조재용: 네 그런것으로 보입니다. BT:21762이슈와 관련된 이슈입니다. 대량의 로그가 발생할 경우 간헐적으로 발생합니다.",https://cafe.naver.com/pnpsecure2/5956
5947,DB명령어 차단 방식에 대한 상세설명 요청 건,"[분류] (에러로그문의 / 기능로직문의 / 기타문의)
기능로직문
[고객사/채널사]
카카오
[이슈내용]
1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0
- DBSAFER에서 DB 명령어 차단시 동작 로직 문의
2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항) -
- 해당없음
3. 특이사항 (연동 모듈, 커스텀 개발 등)
- 해당없음
4. 사내 재현 정보
- 해당없음
5. 요청사항
- DB명령어 차단시 사용자<-> GW <->대상DB 사이 어떤 방식으로 차단을 하는지 고객사에서 상세설명요청이 있어 확인 요청드립니다.
. grant명령어로 해서 동작하는 것으로 알고 있어 확인 부탁드립니다.
[모듈 로그(Debugging 로그 및 ERROR 로그]
(파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함)
[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등)
[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)","여성구: 접속 및 권한에 단계에 따라서 차이가 있습니다.

1. 접속 차단
- IP, 보안계정 등으로 차단 할 경우
> SYN 이후에 RST 를 전달
- 접속계정, 어플리케이션 등으로 차단 할 경우
- > SYN, PUSH 까지 확인 후 RST 전달

2. 권한 차단
- Query 구분에서 권한 오버를 시키는 구문을 추가하여 차단 grant a, b 등
- 프로시져 등의 경우 옵션에 따라서 전체 구분을 받은 이후에 차단함
> 프로시져의 경우 구문 내에 grant a, b 가 있어도 잘 못된 프로시저로 생성 될 수 있기에 전체를 받아서 처리 옵션이 있음

* 권한 차단의 경우 시그널로 차단 하는 케이스도 있으며 상기는 oracle 기준으로 설명입니다.

3. 결과 값 차단
- 10 row 이상 차단의 경우 rst 전달
> 세션 끊어짐",https://cafe.naver.com/pnpsecure2/5947
5946,"[공지] 2023년 유지보수 점검양식 - DBSAFER, SA, IM, IMUP","안녕하세요 기술본부 여러분
기술지원실 현승환입니다.
23년 정기점검 양식 변경에 따른 공유 드립니다.
23년 9월 5일 이후에 변경된 양식으로 사용 부탁 드립니다.
감사합니다.
첨부파일
피앤피시큐어_정기점검_20230905(IM-IMUP추가)_ma_works추가
.doc
null
파일 다운로드","윤효정: OJT 교육과정에서도 해당 자료로 진행할 수 있도록 업데이트 완료하였습니다.
감사합니다.",https://cafe.naver.com/pnpsecure2/5946
5943,[TIP] ﻿MongoDB 서비스 등록 방법,"안녕하세요. 클라우드기술팀 김영은입니다.
MongoDB 서비스 등록 방법을 공유드립니다.
개요
- DBSAFER MongoDB 지원 기능 및 제약 사항
- MongoDB 서비스 등록 및 접속 방법 소개
요약
- DocumentDB(AWS)와 MongoDB Atlas 서비스를 등록하는 경우, pnp_ssl_proxy 사용 및 인증서 생성 작업이 필요합니다.
- 또한, 해당 MongoDB에 접속하기 위해서는 사용자 PC에 인증서 등록이 필요합니다.
MongoDB 서비스 등록 가이드
- 자세한 내용은 아래 드라이브 링크 또는 첨부 파일 참고 부탁드립니다.
https://drive.google.com/file/d/1EBopdjminrXjFt1Rt3wV3D-k54uAd9yv/view?usp=sharing
[클라우드기술팀] MongoDB 서비스 등록 가이드_김영은.pdf
[클라우드기술팀] MongoDB 서비스 등록 가이드_김영은.pdf Sign In
drive.google.com
첨부파일
[클라우드기술팀] MongoDB 서비스 등록 가이드_김영은
.pdf
null
파일 다운로드
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5943
5935,[공유] SELECT 권한 신청을 포함한 IMUP 마스킹 해제 신청 방법,"[요약]
- IMUP 결재시스템을 사용한 마스킹해제 권한 획득을 위해서 2번의 신청/승인 절차가 필요
. 개인정보테이블에 대한 ""select 권한 신청/승인"" + ""마스킹해제 권한 신청/승인""
- 명령어 유형 신청서 아이템 폼 튜닝을 통해 한번의 신청/승인으로 마스킹 해제 권한 획득 가능
[IMUP 신청서 구성]
[IMUP 마스킹 + 명령어 신청서 폼 생성]
1. 명령어+마스킹 기안서 구성 프로세스
- DBMS 마스킹 해제 기안 (메뉴) > DBMS-명령어+마스킹 유형 기안(신청프로세스) > AM-DBMS-명령어+마스킹 유형기안 (신청서)
- DBMS 명령어+마스킹 유형 기안 신청 프로세스의 hex 값 url 에 추가하여 마스킹 해제 기안 메뉴 활성화
※ 반드시 명령어 유형 기안 신청서 폼과 명령어 유형 기안 신청 프로세스의 사본으로 생성되어야 합니다.
명령어 유형 신청 프로세스 복사
명령어 유형 기안서 폼 복사
2. 명령어+마스킹 신청서 폼 내 아이템 항목 :
(1) 명령어 유형 신청서를 복사하여 마스킹 해제 권한 부여 추가
신청서의 아이템 항목
(2) 명령어 유형 아이템 파라미터 값 수정
- 제외 DBMS 명령어 유형에 SELECT 를 제외한 모든 명령어를 추가합니다.
RENAME,MERGE INTO,DELETE,INSERT,UPDATE,GRANT,REVOKE,COMMIT,ROLLBACK,DROP,ALTER,CREATE,TRUNCATE,BEGIN,LOCK,INDEX,EXECUTE,AUDIT,CONNECT,SYNONYM,DATABASE LINK,COMMENT
명령어 유형 아이템 설정 내용
(2) 마스킹 해제 권한 부여 아이템 파라미터 내용
마스킹 해제 권한 부여 아이템 설정 내용
3. 마스킹 해제 신청서 최종본
마스킹 해제 기안서 내용
[결과]
1. 자동연동정책(auth)
- SQL 허용 및 마스킹해제 정책이 함께 적용되었음을 확인 가능합니다.
자동연동정책 반영 결과
2. psync.auth_policy 값
- cmd_type 3은 SQL 유형, 4는 마스킹 해제를 의미합니다.
- create_date 확인 시 동시에 생성됨을 확인 가능합니다.
감사합니다.","강수빈: 많은 도움이 되었습니다. 정보 공유 감사합니다!
추가로 테스트 중 궁금한 사항이 있어 문의드립니다.

<문의사항>
폼 설정을 통한 테이블.컬럼 단위의 제어(마스킹 해제)도 가능한지 문의드립니다. | 강정근: 현재는 테이블 단위로만 제공하고 있습니다. | 공유민: 최최고. | 강정근: Works(기 IMUP) 의 정책은, GW서버 대상으로 콘솔 접속한 뒤, 아래의 명령어로도 확인 가능합니다.(DB에 접속하지 않고 확인 가능함)
#cd /dbsafer
#./pnp_imup_policy shm_print [정책 고유식별 번호]

”정책 고유식별 번호“는 아래의 명령어 통해 확인 가능합니다.
#./pnp_imup_policy shm_print",https://cafe.naver.com/pnpsecure2/5935
5934,[공유] 망분리 환경 시 saferuas 비밀번호 초기화/잠금해제 방법,"안녕하세요.
클라우드기술팀 박소현입니다.
망분리 환경 시 saferuas 비밀번호 초기화/잠금해제 방법 공유드립니다.
[고객사 환경]
- AWS SES 메일 서버를 통해 SAFERUAS 비밀번호 초기화, 잠금해제 기능을 사용하는 고객사
- 인프라 구성으로 인해 외부망에서 DBSAFER(폐쇄망)으로 접속이 불가능하여 url 클릭 시 임시 비밀번호 발급이 안 되는 상황
- url 인증 없이 임시 비밀번호 발급받을 수 있도록 엔지니어 페이지 설정 진행
고객사 망 구성
[상세내용]
1. 일반적인 SAFERUAS 비밀번호 초기화 방식
1) 잠금해제 및 비밀번호 초기화 수행 시 URL 전달
내부망 고객 PC 화면
2) URL 클릭 시 DBSAFER 로 비밀번호 초기화 명령 수행
외부망 메일 화면
3) URL 인증 후 임시 패스워드 발급
url 인증 후 임시비밀번호 메일 전송
2. 인증 과정 제외한 SAFERUAS 비밀번호 초기화 방식
1) 잠금해제 및 비밀번호 초기화 수행 시 별도 인증 없이 임시 비밀번호가 발급하도록 설정
2) 잠금해제의 경우 인증 없이 해제되는 것이 불가능하여 패스워드 초기화하는 방식으로 대체
(패스워드 초기화 시 잠금해제 되는 것 확인)
내부망 고객 PC 화면
외부망 메일 화면
[엔지니어페이지 설정]
- 인증 없이 잠금해제/비밀번호 초기화를 하기 위한 엔지니어 페이지 설정 내용입니다.
엔지니어 페이지 설정 내용
감사합니다.","서재영: PC Agent 기능이 조금 개선된다면 2차인증(2factor) 기능(미 로그인 상태에서 2차인증창 활성화)으로도 가능 할 것으로 보입니다.
(관련 bugs : https://bugs.pnpsecure.com/view.php?id=24882)",https://cafe.naver.com/pnpsecure2/5934
5930,InnoDB 실행 안될때 복구 방법,"[개요]
- InnoDB 엔진 사용 시 기존 Aria, MyISAM과 다르게 DB복구 방법이 존재
- 운영중인 DB접속 불가 현상때 사용하되, 데이터 유실 가능성이 있음을 참고
[설정 방법]
- # vi /etc/my.cnf
[mysqld]
innodb_force_recovery =0 ~ 6 까지의 값 중에서 하나를 설정 (0은 정상 상태인 경우이며 그 이상의 경우 강제 복구모드에 해당됨
저장 후 db 시작
[옵션 설명]
1 ( SRV_FORCE_IGNORE_CORRUPT )
데이터 파일의 손상된 페이지가 발견되어도 무시하고 MySQL을 기동시킨다. 일단 MySQL이 기동되면, SELECT * FROM tbl_name; 명령문을 실행하여 데이터를 덤프하여 다시 적재하거나 다른 데이터베이스로 이전하는 것이 좋다. 이 때, 손상된 인덱스 레코드와 페이지는 모두 건너뛰게 된다. (즉, 무시해 버리므로 데이터를 잃게 된다.)
에러 로그 파일에 ""Database page corruption on disk or a failed ""라고 출력되는 경우, 대부분 이 케이스인데 이는 테이블 스페이스의 페이지가 손상되어서 발생하는 문제이다. 이 경우에는 이 모드로 MySQL의 기동 후, mysqldump나 SELECT INTO OUTFILE...을 이용하여 덤프 및 재 적재가 가능하다.
2 ( SRV_FORCE_NO_BACKGROUND )
InnoDB의 여러 가지 Background thread들 중에서 Main thread를 시작하지 않고 MySQL을 기동시킨다. InnoDB의 경우 트랜잭션과 동시성 향상(MVCC)을 위해서 Undo 정보를 보존하게 되는데, 이 Undo 정보는 변경되기 전 데이터를 가지게 된다. 이러한 Undo 정보는 여러 가지 상황에 맞춰서 적절한 시점에 삭제가 되어야 하는데 이 작업을 Main thread가 처리한다 (이 작업을 Purge라고도 부른다.). 그런데 만약 MySQL 의 시작 과정에서 InnoDB가 이러한 Purge 작업 중 오류를 발생시킨다면, MySQL의 기동 시에 Main thread를 시작시키지 않기 때문에 Purge 작업 중의 오류를 피할 수 있게 되므로, 일단 MySQL을 시작시킬 수는 있게 된다. Undo 정보는 InnoDB의 시스템 테이블 스페이스에 관리되기 때문에, 이 경우에는 전체 데이터베이스를 덤프 받은 후 다시 MySQL 서버를 구성해야 한다.
3 ( SRV_FORCE_NO_TRX_UNDO )
MySQL을 종료하던 시점에 만약 진행 중인 트랜잭션이 있었다면, MySQL은 그냥 단순히 그 Connection을 강제로 끊어 버리게 된다. 그 이후 별도의 정리 작업은 진행하지 않게 된다. 즉 MySQL은 종료되었지만, 진행 중이던 트랜잭션의 정리 작업은 하지 않게 되는 것이다. MySQL이 다시 시작하게 되면, InnoDB 엔진은 트랜잭션 로그(Redo log라고도 함)를 읽어서 다시 처리 해주고(이 작업을 Roll forward라고 함), 최종적으로 어떤 트랜잭션이 완료되지 않고 Connection이 종료되었는지 판단 후, 그 트랜잭션들은 InnoDB 엔진이 Rollback을 시키게 되는데, 만약 Undo 영역이나 다른 관련된 데이터들이 손상된 경우에는 Rollback 처리를 해줄 수 없게 되는데, 이 경우에 사용하는 복구 모드이다. 이 경우에는 사실은 Rollback되어야 하지만, 실제 데이터 파일에는 그 데이터가 남아 있을 수 있다. (이 부분은 Binary log나 Application의 로그를 통해서 수동으로 보완해 주거나 무시하는 방법밖에 없다.)
4 ( SRV_FORCE_NO_IBUF_MERGE )
MySQL의 InnoDB는 INSERT, UPDATE, DELETE 등의 데이터 변경 작업으로 발생하는 인덱스 변경 작업들을 상황에 따라서 즉시 실행할 수도 또는 나중에 처리하도록 지연시킬 수 도 있다. 이렇게 나중에 처리하도록 지연시키기 위해서는 변경 내용을 어딘가에 기록해 두어야 하는데, 그 용도로 사용되는 버퍼가 ""Insert Buffer""이다. 이 Insert Buffer의 내용은 언제 데이터 파일에 병합(Merge)될지 알 수 없다. MySQL을 종료해도 병합되지 않을 수 있는데, 만약 MySQL이 재 시작 되면서 Insert Buffer의 손상을 감지하게 되면 Insert Buffer의 병합 작업이 실패하고 MySQL이 기동하지 못하게 된다. 이 경우 사용할 수 있는 강제 복구 모드이다. (이 경우에는 테이블 통계 정보 갱신을 유발하는 작업들을 해서는 안 된다. 주로 DDL이나 ANALYZE 명령 등). Insert Buffer는 실제 데이터와 관련된 부분이 아니라 인덱스에 관련된 부분이라 테이블을 덤프 후 다시 적재하면 처리될 수도 있고, 아니면 단순히 ""ALTER TABLE tbl_name ENGINE=InnoDB;"" 명령만으로 해결될 수도 있다.
5 ( SRV_FORCE_NO_UNDO_LOG_SCAN )
복구 모드 3 ( SRV_FORCE_NO_TRX_UNDO )의 처리와 비슷하며, 이 모드에서는 Undo 로그를 완전히 무시하고 완전히 종료되지 않은 트랜잭션(COMMIT/ROLLBACK되지 않은)을 모두 COMMIT된 것으로 처리해 버린다. 또한 이 모드에서는 Undo 로그를 전혀 참조하지 않는 형태로 강제 복구 시킨다.
6 ( SRV_FORCE_NO_LOG_REDO )
이것은 MySQL 서버가 재 시작되기 전 가장 뒤에 발생한 체크 포인트 이후의 모든 트랜잭션을 버리고 복구 시키는 모드이다. 당연히 Redo 로그를 참조하지 않으므로 Roll forward라는 작업도 하지 않고 강제 복구시키게 된다. Redo 로그가 손상된 경우 이 모드로 강제 복구가 가능하다.
[주의 사항]
[mysqld]
innodb_force_recovery =1 이상의 값을 설정 할 경우 Select 이외의 명령어가 실행되지 않으므로 복구 후에 다시 0으로 되돌린 후 DB 재시작 해야함
가능한 강제 복구 모드를 낮은 것(1 -> 2 -> 3 -> 4 -> 5 -> 6)부터 시도해 볼 것을 추천한다.
숫자가 증가 할 수록 데이터 유실 가능성이 있음
[요약]
1. /etc/my/.cnf 파일에
[mysqld]
innodb_force_recovery =1 ~6 값 설정
2. DB 시작 ( 복구 확인 )
3. /etc/my/.cnf 파일에
[mysqld]
innodb_force_recovery =0 으로 원복
참조 : http://intomysql.blogspot.com/2010/12/innodb_3017.html
InnoDB 테이블 손상(깨어진)시 강제 복구
MyISAM 과 달리 InnoDB 테이블들은 매우 안정적이며 , 왠만해서는 데이터 파일이 깨어지는 경우는 거의 경험하지 못했다 . 하지만 , 데이터 파일이 깨어진다면 어떻게 해야 할까 ?. DBMS 벤더를 불문하고 손상된 ( 깨어진 ) 데이...
intomysql.blogspot.com",댓글 없음,https://cafe.naver.com/pnpsecure2/5930
5904,[공유] 7.0 매니저 프로그램 삭제 불가 시 조치 방법 공유,"7.0 매니저 프로그램 삭제 불가 시 조치 방법 공유
[현상]
- 제어판 > Enterprisei Manager 7 삭제 > InstallSield에서 '삭제 완료'임에도 제어판에 남아있는 상태
- Regedit > HKEY_LOCAL_MACHINE\SOFTWARE\PNP SECURE\Enterprise Manager 7에서 기본값만 확인됨
- Version 값을 70000[버전값]으로 생성 후 버전값을 변경해보며 시도해도 동일
- 신규버전으로 설치 > InstallShield에서 '설치 완료', Regedit이 정상적으로 표시되어도 실제로 C:\Program Files\PNP SECURE\Enterprise Manager 7에 파일이 설치되지 않음
[조치방법]
1. C:\Program Files (x86)\InstallShield Installation Information 이동 //숨김폴더
2. {3CCD0E5D-7437-4170-8871-D13C4D5E5C3E} 제거 // Enterprise Manager 7.0 x64 고유 GUID값
- 키 값을 모를 경우 폴더 진입 > setup.exe 우클릭 > 자세히 > 제품 이름 확인 가능
3. 제어판 > Enterprise Manager 7 삭제
4. 설치 경로에 혹시 매니저 파일이 남아 있을 경우 수동 제거
5. 레지스트리 수동 제거",댓글 없음,https://cafe.naver.com/pnpsecure2/5904
5900,"[공유] [카카오페이증권] IMUP 명령어 기안 중 대량의 다중 명령어 추가 시, 웹 브라우저 Out of Memory 발생 관련 내용 공유해 드립니다.","안녕하세요.
클라우드기술팀 민시원입니다.
카카오페이증권에서 IMUP 명령어 기안 중 대량의 다중 명령어 추가 시, 웹 브라우저 Out of Memory가 발생하여 해당 내용 관련 증상, 원인, 대응 및 대응이 완료될 때까지 사용할 대안 공유해 드립니다.
[IMUP 명령어 기안 다중 명령어 설정 방법]
1. IMUP 페이지 secureadmin 계정으로 로그인
2. '시스템관리 - 결재관리 - 신청서 폼관리' 메뉴, '명령어' 아이템 칸에 '다중선택' 옵션 삭제
3. '시스템관리 - 결재관리 - 신청서 폼관리' 메뉴, '명령어' 아이템 칸에 '[명령어] 다중 명령어 다이얼로그 사용' 옵션 추가 후 Value 값 'true' 설정
'폼관리' 메뉴 중 아이템 옵션 변경 완료 화면
[Out of Memory 이슈 발생 증상]
1. 신청 - DBMS권한 - 비정형화 명령어 기안 (정형화 명령어 기안) 메뉴에서 명령어 추가 버튼 클릭
명령어 기안 화면
2. 명령어 추가 창에서 '다중 명령어' 선택 후 명령어 추가
* 테스트 진행 시, Value 값이 다른 대량의 Update 문을 이용함 (약 2800개)
* Value 값이 아예 같은 Update 문을 사용하면 대량의 다중 명령어를 추가해도 Out of Memory 증상 발생하지 않음
다중 명령어 추가
3. 명령어 추가 창에서 명령어 추가 후, '확인' 버튼 누르자마자 해당 PC에서 웹 브라우저 Memory 급 상승 후 Out of Memory 발생
명령어 추가 후 '확인' 버튼 누른 상황
Out of Memory 발생 순간 웹 브라우저 상태
[해당 현상 발생 원인]
IMUP 명령어 기안의 명령어 추가 기능은 추가되는 명령어에 대해 웹 브라우저에서 한 번에 받아 처리하는 작동 로직을 가지고 있습니다.
이에 따라, 대량의 다중 명령어를 추가하려고 하면 웹 브라우저 메모리에 과부하가 걸리게 되고 결국에는 Out of Memory 현상이 발생하게 됩니다.
[대응 방안]
IMUP DMS WEB에서는 명령어 기안 시 문제가 됐던 쿼리와 같은 내용, 같은 양의 쿼리도 문제 없이 추가 및 결재되는 것을 확인하였습니다.
이는 DMS WEB은 IMUP 명령어 기안의 명령어 추가 작동 로직과는 다르게, 추가 명령어를 DBSAFER 서버에 특정 테이블로 보내고 해당 테이블을 웹 브라우저에서 조회하여 처리하는 작동 로직을 가지고 있기 때문입니다.
IMUP 명령어 기안의 명령어 추가 작동 로직을 DMS WEB 명령어 추가 작동 로직과 같이 바꾸는 작업이 필요하여 현재 벅스 등록 후 기능 수정 중입니다. (BT:25466)
[대안]
해당 건은 개발이 불가피하여 시간이 필요하지만 카카오페이증권은 이미 오픈 후 사용 중이고 고객도 해당 사항에 불편함을 호소하여 개발까지 대량의 명령어 추가에 대한 대안이 필요하였습니다.
현재 고객사는 고객의 니즈에 따라 '비정형화 명령어 기안' 기능만 사용 중인데, 현 상황을 고려해 고객사에 IMUP 기능 수정 전까지 정형화 명령어 기안 사용을 대안으로 가이드하고 리드 중입니다.
여기에 더해 고객사는 감사 대응을 위해 사용할 모든 명령어를 결재받아야 하는 상황입니다.
이에 따라, 정형화 명령어 기안 사용으로 가이드 하되, 기안서 내의 명령어 추가 칸과는 별개로 신청 사유 칸에 사용할 모든 명령어를 입력하여 기안 상신할 수 있게 신청 사유 칸 글자 수 제한을 해제하였습니다.
[대안 - 신청 사유 글자 수 제한 해제]
1. IMUP 페이지 secureadmin 계정으로 로그인
2. 시스템관리 - 신청서 폼관리 - 'AM-DBMS-정형화 명령어 기안'에서 수정 버튼 클릭
AM-DBMS-정형화 명령어 기안 폼 수정 버튼
3. '신청 사유' 칸을 클릭 후 '아이템 유효성검사' 제거 버튼 클릭
'신청 사유' - '아이템 유효성검사' 제거
4. 저장 버튼 클릭
* 신청 사유를 포함한 신청 내용이 저장되는 컬럼의 데이터타입은 longtext로, 4GB까지 입력 가능
* 4GB가 초과하지 않도록 글자 수를 제한하는 것을 권장하지만, 카카오페이증권 담당자와 협의 결과, 사용자에게 글자 수 제한을 두는 것보다 해당 내용을 관리자가 인지하고 제한 없이 사용하는 방향으로 협의 완료 후 진행 (텍스트 형식만 입력할 예정으로, 현실적으로 4GB는 넘지 않을 것이라는 예상)
감사합니다.","강수빈: 안녕하세요, 민시원 대리님! 정보공유 감사합니다.
테스트 진행하신 IM/IMUP 버전정보를 알 수 있을지 문의드립니다. | 민시원: 안녕하세요!
IM: PKG_DBSAFER_IM_V1.5.5.71-a_DBSAFER5
IMUP: PKG_IMUP_V1.0.5.22-dms
위 버전으로 테스트 진행하였습니다.",https://cafe.naver.com/pnpsecure2/5900
5890,[공유] IM 및 IMUP에서 사용하던 1차 인증을 미사용으로 변경하는 법,"안녕하세요.
클라우드기술팀 민시원입니다.
1차 인증 기능 관련하여 테스트 중, IM 및 IMUP에서 사용하던 1차 인증을 미사용으로 변경하는 방법이 보통의 엔지니어 페이지 설정 변경과 달라서 해당 내용 공유드립니다.
[설정방법]
1. IMUP 페이지 secureadmin 계정 로그인
2. 시스템관리 - 환경설정 - 시스템 설정(엔지니어) 메뉴로 이동
3. 사용자 인증 설정 - 1차 인증 방식 설정 옵션에서 LDAP 인증 체크 해제
- 해당 옵션은 IMUP 페이지 로그인 화면에서 'LDAP 로그인' 버튼 생성 & 제거 관여
1. LDAP 인증 체크 해제 후 IMUP 로그인 화면
4. dbsaferim 엔지니어 페이지 secureadmin 계정 로그인
5. 시스템 활성화 탭 - SAFERUAS 옵션에 1차인증 연동 옵션 미사용으로 변경 및 적용
2. 1차인증 연동 미사용
----------------------------------------------------------------------------------------------------------------------------------
6. DBSAFER 서버에서 /usr/local/apache/work로 이동 (이중화 시 Log 서버)
# cd /usr/local/apache/work
7. pnpweb 중지
# service pnpweb stop
8. /usr/local/apache/work에서 Catalina 폴더 삭제
# rm -rf Catalina
9. pnpweb 실행
# service pnpweb start
[설명]
기존 엔지니어 페이지 설정 변경과 같이 브라우저에서 설정 변경 후 적용 버튼을 누르면 적용되는 것이 아니라(5번 까지의 과정), Tocmat Catalina 캐시 파일 삭제 및 재시작이 필요합니다.(6~9번 과정)
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5890
5889,[TIP] latin1 데이타를 utf8로 변환하는 스크립트 공유,"요약 :
LATIN1으로 되어 있는 데이타를 UTF8로 변환하는 스크립트
활용 예 :
DBSAFER 5.0 에 있는 latin1 테이블을
DBSAFER 7.0 의 UTF8 로 변환 시 사용할 수 있습니다.
DBSAFER 5.0과 7.0 테이블 구조의 다름을 감안하여
별도의 새로운 DB에 변환하여 import 한 뒤
7.0 테이블의 컬럼을 비교한 다음에 필요한 테이블에 insert 하는 것을 권장합니다.
스크립트 요약 :
new_database 라는 별도의 DB를 생성해서
latin1_old_database 로부터 mysqldump / iconv / sed 명령어 순으로 사용하여
new_database DB에 utf8로 import 하는 순서입니다.
스크립트 내용 :
## 샘플 연동 테이블 생성
CREATE DATABASE new_database DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;
## latin1에서 utf8로 컨버팅 스크립트
#!/bin/sh
echo """"
date +%Y-%m-%d_%T
echo "" ###### Start ###### ""
mysqldump -u safeusr -p???????? --default-character-set=latin1 latin1_old_database > /root/dump.sql
echo ""mysqldump done""
sleep 1
iconv -c -f cp949 -t utf8 dump.sql > dump_utf8.sql
echo ""laint1 to utf8 iconv done""
sleep 1
sed -i 's/latin1/utf8/g' dump_utf8.sql
echo ""create query character set change done""
sleep 1
mysqldump -u safeusr -p???????? --default-character-set=utf8 new_database < dump_utf8.sql
echo ""query import done""
echo "" ###### End ###### ""
## 크론 설정
*/10 * * * * /root/test_utf8.sh > /root/cron_result.log 2>&1",댓글 없음,https://cafe.naver.com/pnpsecure2/5889
5888,[공유] OpenSSL 1.1.1t 패치 후 key 로그인 실패 증상 조치 방안,"[요약]
- DBSAFER v5.0 OpenSSH & OpenSSL 패치 후 key 로그인 실패 증상 발생
- /etc/shadow 파일의 두번째 필드 값이 !!로 처리된 계정은 key 로그인 불가
(두 번째 필드가 ""!!""로 설정되어 있는 경우, 해당 사용자의 비밀번호가 비활성화되었음을 나타냄.
일반적으로 사용자의 로그인을 비밀번호 인증 대신 공개키 인증으로 제한하고자 할 때 설정)
- UsePam 설정 변경하거나 패스워드를 생성하거나 플래그를 ( !! → * ) 업데이트 시 key 로그인 성공
[버전 정보]
- OpenSSH 버전 : OpenSSH8.8p1
- OpenSSL 버전 : OpenSSL 1.1.1t
[OpenSSH & OpenSSL 패치 방법]
https://cafe.naver.com/pnpsecure2/5725
cafe.naver.com
cafe.naver.com
[이슈]
- OpenSSH & OpenSSL 버전 업데이트 후 key 로그인 실패 증상 발생
[확인 내용]
1. syslog 확인
1) key 로그인 시 syslog에 account is locked 확인
2) 로그 발생 이유
(1) 비밀번호 잠금: 일정 횟수 이상의 로그인 시도가 실패하여 사용자 계정의 비밀번호가 잠긴 경우
(2) shadow 파일 설정: 사용자 계정의 비밀번호 잠금 설정이 /etc/shadow 파일에서 설정된 경우
(잠긴 계정은 비밀번호 필드가 !!로 설정)
(3) PAM 설정: 시스템에는 PAM(Partitioned Account Model) 모듈이 존재하며, 설정에 계정 잠금과 관련된 정책 정의
2. shadow 파일 확인
1) /etc/shadow 파일의 두번째 필드 값이 !!로 된 상태 확인
3. 참조하는 설정파일 내용 비교
1) OpenSSH-mod 설치 후 ssh 참조파일 (/usr/local/etc/ssh/sshd_config)에서 UsePAM = No 설정
2) OpenSSH-mod 설치 전 ssh 참조파일 (/etc/ssh/sshd_config)에서 UsePAM = YES 설정
[조치 내용]
1안) PAM 인증 사용하는 경우, UsePAM = YES 로 설정
2안) PAM인증을 사용하지 않을 경우, 패스워드를 생성하거나 *로 업데이트
[shadow 필드값 치환 방법]
1) usermod -p '*' centos(계정명)
2) vi /etc/shadow 로 직접 편집
※ 잘못 수정할 경우 OS 로그인 자체가 불가능해질 수 있으므로 주의 요망
3) 스크립트 통한 shadow 필드 값 변경
(예시)
sed -i 's/!!/*/g' /etc/shadow
awk -F ':' '{gsub(""!!"", ""*"");
perl -i -F: -pe 's/!!/*/ if $. > 1' /etc/shadow
[/etc/shadow 파일 변환 스크립트]
1) 작업 자동화 및 휴먼에러 감소를 위해 스크립트 작성
2) 스크립트를 실행한 세션은 종료하지 않은 상태에서 로그인 테스트 수행
3) 스크립트 내용
(1) '!!' 잠금 계정이 1개 이상일 경우 잠금 계정 목록 출력
(2) shadow 파일 변경 여부(yes/no) 질의
(3) yes 입력 시
3-1) /etc/shadow 파일 백업 진행
3-2) 변경할 계정명 입력 후 !! 를 * 로 치환
3-3) 추가 계정 변경 여부 (yes/no) 질의
3-3) yes 입력 시 3-2 로 돌아감
(4) no 입력 시 스크립트 종료
첨부파일
shadow_convert
.sh
null
파일 다운로드
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5888
5887,[아모레퍼시픽] pnp_aws_service 통해 대상 ﻿(Autoscaling Group) 내 인스턴스(EC2) 데이터 취득 시 Read Timeout 발생하는 현상,"[요약]
- 고객사 DBSAFER 환경은 외부와 통신되지 않는 폐쇠망 환경
- 출발지 : 서울 리전(DBSAFER)에서 목적지 : 홍콩 리전(Autoscaling Group) 내 인스턴스(EC2) 데이터 취득 필요
- pnp_aws_service update-scale-in-out 실행 시 지속적으로 Read Timeout 발생
- 출발지 : DBSAFER에서 목적지 : Autoscaling Group 기준으로 아래 두 개의 엔드포인트 주소에 대해 443 포트 오픈
(목적지 리전에 따라 도메인 주소는 아래와 상이 할 수 있음)
. autoscaling.ap-east-1.amazonaws.com / (TCP) 443
. ec2.ap-eat-1.amazoneaws.com / (TCP) 443
- 포트 오픈 후 정상적으로 인스턴스 정보 취득 확인
[이슈 증상]
- pnp_aws_service update-scale-in-out 실행 시 Read Timeout 발생하여 대상 (Autoscaling Group)
내 인스턴스(EC2) 데이터 취득 실패
[고객사 환경 정보]
- 단독구성
- DBSAFER V5.0
- OS : Rocky 8.6
- 모듈 정보
. pnp_aws_service_v1.20T
[이슈 상세 내용]
- ./pnp_aws_service.sh update-scale-in-out 실행 시 아래의 에러 로그 발생
(credential key 및 기타 설정은 등록 되어있는 상태)
. 16:44:09 실행 하였으나 3분동안 응답이 없어 Read Timout 발생
- 패킷 상 TLS 통신 과정에서 핸드셰이크가 정상적으로 진행되지 않고 있는 것 확인
# Unable to execute HTTP request: Connect to autoscaling.ap-east-1.amazonaws.com:443
[autoscaling.ap-east-1.amazonaws.com/13.248.40.43] failed: Read timed out
pnp_aws_service_main.log
TCP Retransmission 지속 발생 확인
- autoscaling.ap-east-1.amazonaws.com : 443 포트 오픈 후 ./pnp_aws_autoscale.sh update-scale-in-out
재실행 시 지속적으로 Read Timeout 발생
- autoscaling.ap-east-1.amazonaws.com : 443 오픈 후 DescribeAutoScalingGroup Action은 정상 수행 되나
ec2.ap-east-1.amazonaws.com : 443에 대해 방화벽 미오픈 되어있어 Read Timeout 발생 확인
# Unable to execute HTTP request: Connect to ec2.ap-east-1.amazonaws.com:443
[ec2.ap-east-1.amazonaws.com/13.248.36.100] failed: Read timed out
pnp_aws_service_main.log
[추가 확인 사항]
- 현재까지 구축된 사이트에서는 pnp_aws_service 모듈 통해 대상(Autoscaling Group) 내 인스턴스 취득 과정에서
별도의 방화벽 오픈 요청이 없었으나 고객사는 해외 리전 Autoscaling Group 엔드포인트 주소로 접근이 불가한
환경이기에 방화벽 오픈이 필요한 상황으로 확인
통상적 케이스 / 특수 케이스의 차이점
통상적 케이스/기존 고객사
pnp_aws_service 모듈 사용 시 별도 아웃바운드 방화벽 오픈 X
특수 케이스/아모레퍼시픽
고객사 폐쇠망 환경에서 해외 리전의 Autoscaling Group 내 인스턴스 데이터 획득을 위해서는
아래 두가지 엔드포인트 주소 및 443 포트에 대해 아웃 바운드 오픈 필요(리전에 따라 엔드포인트 주소 상이)
엔드포인트 주소
프로토콜
포트
autoscaling.ap-east-1.amazonaws.com
TCP
443
ec2.ap-east-1.amazoneaws.com
TCP
443
- 어떠한 상황에서 autoscaling.ap-east-1.amazonaws.com : 443, ec2.ap-east-1.amazonaws.com : 443로 요청을
하게 되는지 pnp_aws_service 디버그 모듈로 확인한 결과 pnp_aws_service 디버그 모듈 통해 Autoscaling Group
내 인스턴스(EC2) 데이터를 취득 하는 과정에서 DescribeAutoScalingGroups, DescribeInstances Action 수행 확인
위 Action 수행을 위해 autoscaling.ap-east-1.amazonaws.com:443, ec2.ap-east-1.amazonaws.com:443 오픈 필요
아래는 DescribeAutoScalingGroups Action 수행에 대한 디버그 모듈 로그이며 DescribeInstances Action 또한
동일하게 수행
DescribeAutosaclingGroup Action에 대한 pnp_aws_service 디버그 로그
[이슈 원인]
- DescribeAutoScalingGroups, DescribeInstances Action을 수행하기 위해 대상 리전의 Autoscaling, EC2 엔드포인트
주소로 443 포트 오픈이 필요하나 해당 엔드포인트 주소 기준 443 포트가 미오픈 되어 Read Timeout 발생
[조치 방안]
- Autoscaling, EC2 엔드포인트 주소 기준 443 포트 오픈 후 대상 (Autoscaling Group) 내 인스턴스(EC2) 정상 취득
(목적지 리전에 따라 도메인 주소는 아래와 상이 할 수 있음)
. autoscaling.ap-east-1.amazonaws.com / (TCP) 443
. ec2.ap-eat-1.amazoneaws.com / (TCP) 443",댓글 없음,https://cafe.naver.com/pnpsecure2/5887
5885,[TIP] pnp_accountsync(인사 연동 모듈) AD 연동 시 Filterstring 옵션 관련 정보,"안녕하세요. 기술지원1팀 김도형입니다.
고객사 지원 중 AD연동 후 담당 개발자와 테스트 중 알게된 옵션 처리 방법에 대해 공유 드립니다.
[ 운영 현황(예시) ]
[ 고객사 이슈사항 ]
- 인사연동(AD연동) 설정 적용 시 BaseDN 옵션에 계정정보가 들어있는 모든 OU 정보를 작성하여 적용 중
ex) OU=개발팀,DC=pnpsecure,DC=com; OU=인사팀,DC=pnpsecure,DC=com; OU=기술팀,DC=pnpsecure,DC=com
- 위 적용 방식에서는 추가적인 OU가 등록 되거나 수정 될 때 마다 BaseDN 정보를 수정해 주어야 함
- 고객사에선 전체 OU (OU=PNP)를 적용 한 뒤 불필요한 OU만(퇴사자, PC계정) 제외하는 필터 기능을 요청
[ 처리 방안 ]
- 다음과 같은 Filter 조건으로 특정 OU 전체를 제외 시킴 (기존 Filterstring은 계정명 등 특정 컬럼 데이터의 대해 제외하는 기능만 공유되고 있었음)
- 단일 OU 필터링
FilterString = (!(msDs-parentdistname=OU=퇴사자, OU=PNP, DC=pnpsecure, DC=com))
- 다중 OU 필터링
FilterString = (!(|(msDs-parentdistname=OU=퇴사자, OU=PNP, DC=pnpsecure, DC=com)(msDs-parentdistname=OU=pc계정, OU=PNP, DC=pnpsecure,DC=com)))
[ 추가 정보 ]
- pnp_accountsync의 Filterstring에 사용 가능한 옵션 정보 ( Ldap Java Search Filter )
심볼
필터
예제
매치
~=
Approximate
sn~=Jensen
Jensen에 있는 어떤 변수도 허용.
=
Equality
sn=Jensen
Jensen이라는 성. 가장 일반적인 검색 포맷이다.
>
Greater Than
sn>Jensen
A알파벳 순서로, Jensen 다음의 성. (예, Pretzman)
>=
Greater Than or Equal
sn>=Jensen
알파벳 순서로, Jensen에 매치되거나 Jensen 다음에 나오는 성.
<
Less Than
sn<Jensen
Jensen 이전의 성. (예를 들어, Baker)
<=
Less Than or Equal
sn<=Jensen
Jensen 또는 그 앞에 나오는 성.
=*
Presence of Attribute
sn=*
sn 애트리뷰트를 포함하는 모든 엔트리.
*
Wildcard String Match
sn=Jen*n
Jensen과 매치되는 스트링, 서브스트링, 수퍼스트링.
&
And
(&(sn=Jensen) (initials=BJJ))
모든 조건과 매치되는 엔트리. 이 경우 BJJ 이니셜과 Jensen의 성.
|
Or
(|(sn=Jensen) (initials=BJJ))
두 조건 중 하나를 만족시키는 엔트리. Jensen의 성 또는 BJJ의 이니셜.
!
Not
(sn=Jensen)
괄호 안 조건의 반대. Jensen을 제외한 모든 성.
ex )
FilterString = ( ! ( | (SAMAccountName=dhkim)(SAMAccountName=test)))
=> SAMAccountNAME이 dhkim 이거나 test 사용자는 연동에서 제외
이상입니다. 감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5885
5876,백업모듈 스케줄 백업 파일(.be3)로 서비스 로그 일 별 복원 시 참고,"[문제]
01~10일 까지 일별로 백업한다는 가정하에 매니저 -> 백업 -> 복원 에서 .be3파일로 로그복원 시 실패
backup 모듈 로그
01일 복원 - 성공
02 ~ 10 복원 시 위와 같은 duplicate error 발생
[원인]
서비스 로그안의 날짜가 구분되지 않는 테이블에 기존 데이터가 있어 insert 하지 못하는 것으로 판단됨
[임시 해결 방안]
아래 테이블의 데이터를 삭제 후 복원 진행
ex) 02~10 복원 버튼 누르기 전
truncate connector; (커넥터 사용시에 해당)
truncate ldap_history;
truncate db_columns;
truncate db_qinfo;
truncate used_object_log;
truncate db_qinfo_split;
truncate used_policy_log;
복원 버튼 누르기전 미리 데이터를 삭제하는 이유:
backup3 모듈이 테이블의 데이터를 순차적으로 복원하다 특정 테이블에서 막힐 경우, db_user_02 , shell_user_02 등의 일별 테이블에 데이터가 insert가 됐기 때문에 다시 truncate 데이터가 들어간 테이블을 추가해야 함 ( 이럴 경우 전체 데이터를 삭제 후 다시 진행 추천)
다소 불편하지만 위의 테이블들을 삭제후 일 별 복원을 추천드립니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5876
5875,INNODB에서 Tar.gz 압축 로그로 복원하는 방법,"해당 사례는 한국산업은행에서 실제 로그 복원시 진행했던 방법으로 다른 효율적인 방법이 있을경우 공유 부탁드립니다.
[사례]
/home/dbsafer/data/mysql/ 경로의 dbsafer_log_202x.xx 로그가 삭제되거나, 데이터들이 모종의 이유로 깨지거나 변경됨.
유지보수 시 보통 .tar.gz 로 월별로그를 압축하여 보관하는데 innodb에서 테이블 스페이스가 깨진상태에서 압축된 로그로 바로 복원시 실패 함
[복원 방법]
0. tar.gz 압축 해제 (용량이 클 경우 시간이 오래걸리므로 충분한 공간이 확보된 파티션에서 수행)
1. 동일 패키지가 설치된 다른 로그 서버에서 해당 월의 감사로그 DB 테이블 dump
# mysqldump -d -usafeusr -p dbsafer_log_2023_06 > dbsafer_log_2023_06.sql ----- -d 옵션으로 테이블 구조만 복구
2. 문제가 발생한 DB로 이동 후 DB 삭제
> drop database dbsafer_log_2023_06
3. DB 수동 생성
> create database dbsafer_log_2023_06 -- DB 생성
4. 1에서 dump 한 .sql문으로 DB 생성
mysql -u safeusr -p dbsafer_log_2023_06 < dbsafer_log_2023_06.sql
혹은 쿼리박스로 .sql 문 전체 복사 후 실행해서 혹시 모를 오류를 확인하는게 좋음.
문제가 발생하는 테이블 생성쿼리는 제외 후 나머지 테이블 생성 단일쿼리로 실행 후 디버깅
5. 테이블 space discard
> alter table (테이블명) discard tablespace
(테이블이 약 2800개이상이므로 쿼리박스에서 정제 후 수행 추천)
6. 0 에서 압축해제한 폴더로 이동 후 파일 이동
cp 와 mv가 있지만 용량이 클 경우 시간이 오래걸리므로 mv 추천.
# mv -f * /home/dbsafer/data/mysql/dbsafer_log_2023_06 ( .frm 파일과 .ibd 파일 모두 옮겨야함 .ibd 데이터 파일만 옮길 경우 import 과정에서 에러가 발생할 확률이 높음
이동 후 소유자 변경 및 확인 root 혹은 다른 계정일 경우 import 과정에서 error 발생
# cd /home/dbsafer/data/mysql/dbsafer_log_2023_06
chown mysql:slaps *
7. import
> alter table (테이블명) import tablespace
마찬가지로 (테이블이 약 2800개이상이므로 쿼리박스에서 정제 후 수행 추천)
로그량이 많을경우 대부분 db_query 테이블의 데이터일 확률이 높음.
import 시 db_query_* 테이블은 제외 후 import 한 다음 쉘스크립트를 백그라운드에서 실행 하는것을 추천
8. 로그 조회 정상 확인","이민종: 오픈소스 소프트웨어 ""dbsake""로도 복구 하는 방법이 있습니다.
카페 정리 : https://cafe.naver.com/pnpsecure2/5394 (DC 기준)
구글 검색 : dbsake
검색 시 가장 상단 참고 URL : https://mollangpiu.tistory.com/345",https://cafe.naver.com/pnpsecure2/5875
5871,[TIP] pnp_oms_dms v2 -> v1 다운그레이드시 주의사항 (oms_access 테이블의 PK 손상 및 매니저-'보안계정'탭 조회 지연현상),"[요약]
상황에 따라 고객사에 oms_dms v1 -> oms_dms v2 로 패치 경우가 있습니다.
간혹 패치 작업에서 문제 발생 또는 테스트 목적으로 패치한 경우, v2 -> v1 모듈로 원복 작업(다운그레이드)을 진행하게 됩니다.
이때, 정형화된 원복절차(oms_dms v2 -> oms_dms v1)를 수행하지 않으면 발생할 수 있는 영향도와 조치방법에 대해 공유드립니다.
[증상]
- 신세계에서 oms_dms v2 -> oms_dms v1 원복 작업 후 매니저의 '보안계정'탭 클릭시 데이터 출력까지 약 8초 지연되는 현상 발생
* 신세계 그룹사는 작업 절차상 DR-GW에서 v1 -> v2 패치 후 원복절차(v2 -> v1)가 있었으나 작업간, 정형화된 원복 절차를 수행하지 않아 해당 이슈가 발생했습니다.
[원인]
- oms_access 테이블에 Primary Key 손상과 oms_dms 로그상 키중복 에러로그 발생
* 참고사항으로 v1 -> v2 패치시 oms_access 테이블의 PK가 변경됩니다.
> oms_dms v1 운영시 oms_access PK : ip, ipaddr_priv, unikey (총 3개)
> oms_dms v2 패치 후 oms_access PK : sno(new), ip, ipaddr_priv, unikey (총 4개)
oms_dms 로그 (v1->v2 패치 후 PK값의 '정상' 변경 이력)
oms_dms v2 -> v1 원복 후 oms_access의 PK 손상 결과 ('PK' 없음)
다음과 같이 oms_acces 테이블의 Primary Key 손상 시점에 oms_dms 데몬 로그에서 키중복 관련 에러로그를 확인할 수 있습니다.
oms_dms 로그 (v2->v1 원복 후 키중복 관련 에러로그 발생)
결과적으로 '보안계정'탭 클릭시 데이터 출력까지 약 8초 지연되는 현상이 발생했으며 oms_access 테이블의 row수가 많을 수록 더 지연될수 있습니다.
[결론]
1. oms_dms v2 -> v1 모듈 원복시 별도의 작업 절차 진행 필요
2. oms_access 테이블의 Primary Key 손상시 별도의 추가 작업 필요
[조치방법]
가. oms_dms v2 -> v1 모듈 원복시 작업절차
1. 모듈 종료 (개선된 모듈)
# ./pnp_oms_dms stop
2. 공유메모리 삭제
# ./pnp_oms_dms delete_shm
3. DB 정리 (접속지 정보 기준 중복 사항 제거)
- (MySQL/MariaDB 접속)
- use dbsafer3
- DELETE T1 FROM oms_access T1 JOIN (SELECT ip, ipaddr_priv, unikey, MAX(lastaccess) AS lastaccess FROM oms_access GROUP BY ip, ipaddr_priv, unikey) T2
ON T1.ip=T2.ip AND T1.ipaddr_priv=T2.ipaddr_priv AND T1.unikey=T2.unikey WHERE T1.lastaccess<T2.lastaccess;
4. 모듈 시작 (이전 버전 모듈)
# cp pnp_oms_dms /dbsafer
# cd /dbsafer
# ./pnp_oms_dms start
나. oms_access 테이블의 Primary Key 손상시 조치방법
* 손상된 oms_access 테이블 컬럼의 PRIMARY KEY 복원 작업 필요
1. pnp_omsdms 정지
# pnp_oms_dms stop
2. 기존 oms_access 테이블 데이터 백업
- CREATE TABLE oms_access_backup AS SELECT * FROM oms_access;
3. 기존 oms_access 테이블 데이터 클리어
- TRUNCATE oms_access;
4. 기존 oms_access 테이블의 PRIMARY KEY 재설정
- ALTER TABLE `dbsafer3`.`oms_access` ADD PRIMARY KEY(ip, ipaddr_priv, unikey);
5. oms_access 테이블 구성 정보 확인
- DESC oms_access
> oms_access PK : ip, ipaddr_priv, unikey (총 3개)
6. 기존 oms_access 테이블 데이터 중, 사용자 접속지 정보별 1건 입력 (PC-Assist 최신버전 기준)
- INSERT INTO oms_access
SELECT ip, lastaccess, mac_addr, env_ip, lan_count, MAX(nat_version),
computer_name, cpu_info, mem_info, sno, 0, gw_ip, login_access,
ipaddr_priv, unikey, login_type
FROM oms_access_backup
GROUP BY ip, ipaddr_priv, unikey;
7. pnp_oms_dms 가동
# pnp_oms_dms start
[참고글]
1. [TIP] pnp_oms_dms v2 버전 패치 시 주의 사항
https://cafe.naver.com/pnpsecure2/5352
cafe.naver.com
cafe.naver.com
2. [공유] pnp_oms_dms v2 & saferuas 사용 시, 비밀번호 변경/잠금해제가 되지 않는 현상 (+oms_dms v2에 대한 설명)
https://cafe.naver.com/pnpsecure2/5360
cafe.naver.com
cafe.naver.com
3. [공유] 멀티 로그인 테이블 값 변경 사항 (oms_dms v2)
https://cafe.naver.com/pnpsecure2/5453
cafe.naver.com
cafe.naver.com
4. [GS리테일] pnp_oms_dms 모듈 패치(R839 > ver.2/R973) 후 DBSAFER ASSIST 3.2.23.1 이하 사용자 로그인 불가 현상 발생
https://cafe.naver.com/pnpsecure2/5470
cafe.naver.com
cafe.naver.com","변태환: 해당 작업 간 주의사항 공유 합니다.

게시 된 아래의 쿼리를 수행 할 경우, 기준이 nat_version이 제일 큰 값으로 설정되어 있습니다.

해당 쿼리를 수행 할 경우 보안계정의 마지막 로그인 일시가 마지막 로그인(lastaccess)이 아닌 다른 값으로 Insert 되는 현상이 있어 아래와 같이 수정하여 사용하시면 됩니다.

6. 기존 oms_access 테이블 데이터 중, 사용자 로그인 최신 정보별 1건 입력 (lastaccess 최신버전 기준)

- INSERT INTO oms_access

SELECT ip, MAX(lastaccess), mac_addr, env_ip, lan_count, nat_version,

computer_name, cpu_info, mem_info, sno, 0, gw_ip, login_access,

ipaddr_priv, unikey, login_type

FROM oms_access_backup

GROUP BY ip, ipaddr_pri",https://cafe.naver.com/pnpsecure2/5871
5864,[공유] AWS SES SMTP 서버 pnp_mailer 연동 방법,"안녕하세요. 클라우드기술팀 박소현입니다.
AWS SES 서버와 pnp_mailer 연동 방법을 공유드립니다.
[AWS SES란]
AWS SES는 ""Amazon Simple Email Service""의 약자로, Amazon Web Services (AWS)의 클라우드 기반 이메일 발송 서비스를 의미
[필요 정보]
1. 메일 서버 정보 : email-smtp.ap-northeast-2.amazonaws.com
2. 통신 프로토콜 : 25, 587 또는 2587
3. 자격증명된 이메일 주소 (발송 메일 주소) : shpark916@pnpsecure.com
> Amazon SES를 통해 이메일을 전송할 때 사용하는 도메인, 하위 도메인 또는 이메일 주소
보안 인증 목록
4. SES 인터페이스와 통신하기 위한 IAM 계정
> SES SMTP 인터페이스에 액세스하려면 Amazon SES SMTP 보안 인증 정보가 필요
[pnp_mailer 설정]
인증 ID/PASSWORD : loginid/loginpw
메일 송신자(FROM) : mail
1. loginid/loginpw 설정에 해당 AWS SMTP NAME/PASSWORD 값을 암호화하여 설정
- loginid : ./pnp_mailer.sh account 사용하여 암호화
- loginpw : ./pnp_mailer.sh password 사용하여 암호화
2. mail 설정에 Amazon SES 자격 증명된 이메일 주소를 암호화하여 설정
- mail : ./pnp_mailer.sh account 사용하여 암호화
3. pnp_mailer.properties 설정
# Mail smtp server. (Required)
server = email-smtp.ap-northeast-2.amazonaws.com
# Email address of sender. (Required)
# Please enter the account(mail address) generated by executing given command(./{prefix}_mailer.sh account)
mail = 1iCzQwBSVfiY2+iKl/Lwkqqui7do0pLZ0ig3HwHvrNE=
# port (default:25)
port = 587
# Authentication type. ( default:0 )
#  0 - Do not authenticate.
#  1 - Default authentication.
#  2 - LOGIN
#  3 - PLAIN
#  4 - CRAM-MD5
login=2
# loginid option. (Default: Email address of sender)
# Please enter the user name generated by executing given command(./{prefix}_mailer.sh account)
loginid=pr7MODDSaAs7VTF3lbut5s2zzBFJbTOUDq7HYD6Vo3k=
# loginpw option. (Required if Authentication type is setting)
# Please enter the password generated by executing given command(./{prefix}_mailer.sh password)
loginpw=wqQFu0E6fSZXeRfJMPDxCf8p1Rx6209TndG/DQ0Ynumv6cI4OXXXXXXXXXX
# Secure connection protocol option. ( default:1 )
#   0 - Do not use secure connection.
#   1 - Default Secure mode
#   2 - SSL 3.0 Secure mode
#   3 - TLS 1.0 Secure mode
#   4 - TLS 1.1 Secure mode
#   5 - TLS 1.2 Secure mode (Required JDK 1.7 later)
secure=5
4. 모듈 테스트
- 입력 명령어 : # ./pnp_mailer.sh test
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5864
5861,pnp_log 모듈의 로그 관리 파일 정보,"""/buffer"" 하위에 생성되는 파일에 대해서 아래와 같이 정보 공유합니다.
파일 용도 파일 생성 시점 및 삭제 시점
- 파일용도
pnp_log 에서 아직 DB 또는 buffer 파일로 처리되지 않고 메모리에 있는 감사로그 내용을 파일에 기록할때 사용.
- 관련 파일 종류
urg.log, cur.log, next.log, ext.log
파일은 메모리에서 사용되는 Queue 종류별로 다른 파일명으로 기록됨
- 생성 시점
pnp_log 가 종료되었을때 메모리에 있는 내용을 생성하도록 되어 있음
- 삭제 시점
pnp_log 가 시작되면서 해당 파일을 읽어 메모리에 적재가 완료되면 삭제
파일이 삭제되었다 해서 DB 또는 buffer 파일에 기록된것이 아님
파일이 존재 할 경우 pnp_log 모듈이 영향
pnp_log 모듈에 영향은 없으며 pnp_log 모듈 가동 시점에 해당 파일을 로드하여 초기화 할 수 있도록 합니다.
* 관련 결함 정보
revsion 706 ~ 769 버전까지 buffer 파일 또는 메모리 내용 적재 파일을 읽을 때 잘못 작성된 예외 처리 코드로 인해 pnp_log 가 실행되지 않는 상황 발생
해당 예외 코드는 문제가 있어 revision 770 에서 삭제 된 상태 (branch 별로 revision 이 다를 수 있어 확인 필요)
파일이 존재 할 경우 대응 방안
pnp_log 모듈 재시작 시에 파일 로드 후 초기화 하기에 특별 대응은 불필요합니다.
단, 결함 버전의 경우 아래와 같이 대응 바랍니다.
1. 임시조치로 cur.log 이름을 바꾸거나 파일을 이동하여 pnp_log 시작
2. pnp_log 패치 이후에는 cur.log 를 원복하여 pnp_log 중지 후 재시작 (cur.log 파일만 원복하고 pnp_log 를 재시작하지 않으면 해당 파일을 읽지 않음)
파일이 존재 한다는 것의 의미
urg.log, cur.log, next.log, ext.log 이 파일들은 저장 실패와 관계없이 pnp_log 를 중지했을때에만 생성하는 파일",댓글 없음,https://cafe.naver.com/pnpsecure2/5861
5860,[공유] [트랜스코스모스코리아] ﻿pnp_log 데몬으로 비정상 패킷이 유입되어 매니저 경로로그에 '﻿서비스데몬에서 로그데몬으로 접속이 안됩니다.' 발생 이슈,"[요약]
- 서비스 모듈과 로그 모듈이 정상적으로 통신하는 상황에서도 log데몬에 비정상 패킷이 유입이 된다면, log데몬이 서비스 데몬과 통신이 안 된다고 판단하여 '서비스데몬에서 로그데몬으로 접속이 안됩니다' 경고 로그가 발생할 수 있습니다.
[고객환경]
1. 구성 : 구로망 GW, SNF, 남영망 SNF, 여의도망 SNF, 성남 GW
2. OS : CentOS 6.9
3. DBSAFER : 5.0
4. 버전 정보 :
- pnp_agent : Rev940
- pnp_log : Rev608
- pnp_log_bridge : Rev138
[이슈 내용]
1. 발생 일시 : 2023. 05. 30(화) 19:51 ~ 20:31
2. 장애 내용
- EnterpriseManager 경고로그 - 시스템 에러에 '서비스데몬에서 로그데몬으로 접속이 안됩니다.' 경고 로그 발생
- 서로 다른 네트워크망에 있는 단독 DBSAFER5서버에서 2023-05-30 19:51 ~ 20:31 간 동시 발생
- 구로 GW, 구로 SNF, 남영 SNF : 2023-05-30 19:51 발생
- 여의도 SNF : 2023-05-03 20:33 발생
- 성남 GW : 2023-05-30 19:51, 20:31 발생
사내 테스트 하여 재현한 에러 로그
[확인 사항]
1. 당일 고객사, IDC 에서 네트워크 작업은 없었음을 확인
2. 당일 해당 로그 발생 이후 매니저 감사 로그 정상 로깅 확인
3. 데몬 시작 날짜 확인 결과 해당 날짜에 로그 및 서비스 데몬이 내려가지 않았음을 확인
4. pnp_log_bridge모듈 확인 :
- 특이사항 없음.
5. 서비스 모듈 로그 확인 :
- 특이사항 없음.
6. pnp_agent 모듈 확인 :
- Protocol error. : Diffrence packet version local[106], remote[2151678208]
- Protocol error. : Protocol error because of different major packet version. Server:3.8, Client:5379.768
와 같은 로그가 지속적으로 발생한 후 해당 경고로그를 출력
7. pnp_log 모듈 로그 확인 :
- Wrong packet version. : [FParam - local:1, remote:3] 에러가 지속적으로 발생
pnp_agent 모듈 에러 로그
pnp_log 모듈 에러 로그
[원인 분석]
1. 발생 원인
- 고객사에서 취약점 점검 중 포트 스캐닝을 진행하여 pnp_log 데몬으로 비정상 패킷이 유입되어 해당 경고 로그 발생
2. 원인 분석 과정
2.1 에러 로그 분석
2.2 에러 로그 분석 결과 pnp_log 데몬에 비정상 패킷 유입 확인
2.3 고객사 환경과 동일한 테스트 서버 구축
2.4 다른 서버에서 telnet 명령어를 사용하여 테스트서버 3120포트(pnp_log 데몬 사용 포트)로 패킷 유입 시도
2.5 동일한 로그 발생 확인
2.6 고객사에 해당 시간에 포트 스캐닝과 같은 패킷이 유입될 수 있는 작업이 있었는지 확인
2.7 확인 결과 취약점 점검 간 포트 스캐닝 작업이 있었음을 확인
[조치 사항]
- 해당 로그가 발생한 후 감사로그는 정상적으로 쌓이는 것을 확인
- 서비스데몬, 로그데몬은 정상적으로 동작하는 것을 확인한 후 담당자에게 해당 내용을 전달함
[추가 내용]
- 고객사에서 해당 에러 로그 발생 후 감사로그가 정상적으로 남는다면 위와 같은 상황을 의심해 볼 필요가 있을 것 같습니다.
이상입니다.
감사합니다.","여성구: 오류 확인이 되어서 다행입니다. ""Diffrence packet version local"" 와 같은 정보는 확인 한 것 처럼 외부 요인 가능성이 높습니다. | 오석민: 원인 분석에 도움 주셔서 감사합니다! | 진선태: 훌륭합니다. 감사합니다.",https://cafe.naver.com/pnpsecure2/5860
5858,[TIP][DMS] DMS 자동 업데이트 시 현재 버전이 0.0.0.0으로 찍히고 무한 업데이트 되는 현상에 대한 대응,"[내용]
- DMS 자동업데이트 진행 시 현재 버전이 0.0.0.0으로 표시되며 업데이트가 무한반복되는 현상
- 아래 캡처 팝업이 계속 반복됨
DMS 버전이 0.0.0.0으로 표기되며 업데이트 무한반복
[상세내역]
- DMS가 포함된 PC Agent를 설치한 것이 아닌 별도로 DMS실행파일을 PC Agent 설치경로에 업로드 해서 문제 발생
: DMS 버전정보가 설치PC의 레지스트리에 등록이 되는데 위 내용과 같이 별도로 설치할 경우 버전 정보가 기록되지 않음
PC Agent와 함께 설치되었을 경우 DMS 정보 표시
DMS를 별도로 PC Agent설치 경로에 업로드 하였을 경우 DMS 정보 미표시
[해결]
1. DMS 자동업데이트 무한반복이 진행될 경우 기존 PC Agent를 지우고
DMS가 포함된 PC Agent 설치파일로 재설치 필요
2. 혹은 해당 레지스트리 경로에 ""DBSAFER DMS""키와 Version 값을 추가
이상입니다.
감사합니다.","진선태: 중대 결함 같은데, bugs 에서 조회하면 안 보이네요. bugs 번호가 어떻게 되나요? | 한성영: 안녕하세요. 진선태 부사장님
기술지원3팀 한성영입니다.

우선 답변이 늦어져서 죄송합니다.

본 이슈는 내부 테스트 중에 발생한 내용이고, AGENT 빌드할 때 DMS를 포함하지 않고 빌드 해서 발생한 문제입니다.
그렇기 때문에 DMS 포함해서 새로 빌드 후 해결이 되는 문제라 따로 벅스 등록은 하지 않았습니다.

감사합니다.",https://cafe.naver.com/pnpsecure2/5858
5851,[공유][제주관광공사] pnp_key_manager에서 N개의 key 파일이 아닌 하나의 key로만 인식되는 현상,"[요약]
- SSH 인증키 관리에 서비스 그룹 및 접속계정 ANY 대상으로 KEY 값이 정상 등록
- 대상 서버 접속 시 특정 계정만 접속 가능 현상
- pnp_key_manager가 서비스 그룹 및 접속계정 ANY 대상으로 등록되어있는 KEY를 전부 인식하지않고 한개만 인식
. SSH 인증키 관리에서 서비스 그룹 및 접속계정 ANY 대상으로 등록된 최상의 KEY만 참조하는 것 확인
- pnp_key_manager Rev. 21이상에서 동일 조건에 등록된 N개의 키를 개별적으로 인식할 수 있도록 수정 완료
[이슈증상]
- 매니저 > 서비스 > SSH 인증키 관리에서 서비스 그룹 대상으로 PEM 키를 N개 등록 되어있을 때 대상 서버
접속 시도 시 접속 불가
[고객사 환경 정보]
- 단독구성
- DBSAFER V5.0
- OS : Centos7.9
- 모듈 정보
[root@nh-log dbsafer]# ./pnp_key_manager
KEY_MANAGER Release (Rev 14) Mar 30 2023 15:00:36s
( SHARED INTERFACE VERSION INFO: Rev.548 )
( COMMON-API(UTIL) INFO: Rev.184 )
Usage : ./pnp_key_manager start
Usage : ./pnp_key_manager stop
[root@nh-log dbsafer]# ./pnp_telnet --version
Telnet Release version 3.3.404 128bit -SafetyCMD for RelR22.05C-CentOS7
Build (3404) Build-Update (Jun 29 2022 13:59:43) MAX-USER : 1000
MAIN VERSION 3.7 (20150812)(Rev: v2195)
ADDED OPTION STATUS: NONE
COMMON MAIN MODULE VERSION: 3.3.404 128bit -SafetyCMD
COMMON LIBRARY VERSION: 3568
COMMON POLICY MODULE VERSION: 1.2.19
COMMON CERTIFICATION MODULE VERSION: V3
COMMON 2FACTOR PROTOCOL : v2
SHARED INTERFACE VERSION: 512
COMMON-API(UTIL) VERSION: 162
[root@nh-log dbsafer]# ./pnp_ssh_proxy
SSH_PROXY Release (Rev 229) Nov 17 2022 14:36:03s
( SHARED INTERFACE VERSION INFO: Rev. )
( COMMON-API(UTIL) INFO: Rev. )
[이슈 상세 내용]
- jejuvisit 이라는 Terminal 서비스 그룹 안에 N개의 서버들 존재
jejuvisit 폴더 내 3개의 Terminal 서비스 존재
- jejuvisit 이라는 서비스 그룹에 속한 서버들 내부에 여러 계정 존재
서버 내 ec2-user, sonny 계정 존재
- 매니저 > 서비스 > SSH 인증키 등록 > 서비스 명 : jejuvisit / 접속 계정 : ANY / 각 계정의 PEM KEY 등록
. 순번 1번 PEM KEY : 서비스명(제주관광공사1_sonny) 서버의 sonny 계정 개인키
. 순번 2번 PEM KEY : 서비스명(제주관광공사2_ec2-user) 서버의 ec2-user 계정 개인키
. 순번 3번 PEM KEY : 서비스명(제주관광공사3_ec2-user) 서버의 ec2-user 계정 개인키
: 순번 2번과 3번은 계정명은 동일하나 키 값은 다름
SSH 인증키 관리에 계정 별 개인키 등록
- ec2-user, sonny 계정이 전부 접속이 되어야하지만 sonny만 접속 가능 하나 ec2-user는 접속 불가능
SSH 인증 키 등록 - 순번 1번의 sonny 개인키를 통해 접속 시도 시 sonny 계정 접속 성공
SSH 인증 키 등록 - 순번 2,3번의 ec2-user 개인키를 통해 접속 시도 시 ec2-user 계정 접속 실패
[이슈 원인]
- pnp_key_manager 디버그 확인 결과 한개의 PEM KEY만 인식
. SSH 인증키 등록에 설정 된 순번 1번의 sonny PEM KEY만 인식(정상적이라면 3개의 PEM KEY 인식 필요)
[root@nh-log dbsafer]# ./pnp_key_manager start -g
[2023-06-22 14:31:45] [42177] [MISC][INFO__000000000] Information message. : KEY_MANAGER START (Rev 14)
src/main.cpp[start]:124
[2023-06-22 14:33:42] [42177] [MISC][INFO__000000000] Information message. : Receive REQUEST-PRIVATEKEYS. (THREAD)140236151437056, (SERVICE)5, (ACCOUNT)ec2-user.
src/service/CHandleService.cpp[onGetRequestSshPrivateKeys]:278
[2023-06-22 14:33:42] [42177] [MISC][INFO__000000000] Information message. : Send RESPONSE-PRIVATEKEYS. (THREAD)140236151437056, (SERVICE)5, (ACCOUNT)ec2-user, (KEY-CNT)1.
src/service/CHandleService.cpp[onGetRequestSshPrivateKeys]:287
[2023-06-22 14:36:29] [42177] [MISC][INFO__000000000] Information message. : Receive REQUEST-PRIVATEKEYS. (THREAD)140236109473536, (SERVICE)5, (ACCOUNT)ec2-user.
src/service/CHandleService.cpp[onGetRequestSshPrivateKeys]:278
[2023-06-22 14:36:29] [42177] [MISC][INFO__000000000] Information message. : Send RESPONSE-PRIVATEKEYS. (THREAD)140236109473536, (SERVICE)5, (ACCOUNT)ec2-user, (KEY-CNT)1.
src/service/CHandleService.cpp[onGetRequestSshPrivateKeys]:287
[조치 방안]
- pnp_key_manager Rev.21이상으로 패치
. '서비스 그룹 + 계정명' 기준으로 여러 키가 등록되더라도 등록된 키를 모두 제공할 수 있도록 수정 완료
★ pnp_key_manager Rev.21이상 패치 후 정상 로그
[root@nh-log dbsafer]# ./pnp_key_manager start -g
[2023-06-22 14:45:59] [46486] [MISC][INFO__000000000] Information message. : KEY_MANAGER START (Rev 21)
src/main.cpp[start]:124
[2023-06-22 14:47:56] [46486] [MISC][INFO__000000000] Information message. : Receive REQUEST-PRIVATEKEYS. (THREAD)140415040685824, (SERVICE)5, (ACCOUNT)ec2-user.
src/service/CHandleService.cpp[onGetRequestSshPrivateKeys]:278
[2023-06-22 14:47:56] [46486] [MISC][INFO__000000000] Information message. : Send RESPONSE-PRIVATEKEYS. (THREAD)140415040685824, (SERVICE)5, (ACCOUNT)ec2-user, (KEY-CNT)3.
src/service/CHandleService.cpp[onGetRequestSshPrivateKeys]:287
[2023-06-22 14:47:56] [46486] [MISC][INFO__000000000] Information message. : Receive REQUEST-PRIVATEKEYS. (THREAD)140415040685824, (SERVICE)5, (ACCOUNT)ec2-user.
src/service/CHandleService.cpp[onGetRequestSshPrivateKeys]:278
[2023-06-22 14:47:56] [46486] [MISC][INFO__000000000] Information message. : Send RESPONSE-PRIVATEKEYS. (THREAD)140415040685824, (SERVICE)5, (ACCOUNT)ec2-user, (KEY-CNT)3.
src/service/CHandleService.cpp[onGetRequestSshPrivateKeys]:287",댓글 없음,https://cafe.naver.com/pnpsecure2/5851
5849,[TIP] OS와 DB의 EOS 또는 EOL로 인한 DBSAFER 업그레이드 사업 진행 절차,"제가 경험한 내용들을 토대로 OS와 DB의 EOS 또는 EOL 로 인한 DBSAFER 업그레이드 사업이 진행되는 절차에 대해 정리해보았습니다.
(DBSAFER5 PKG 기준으로 작성)
1. 필요성 도출 단계
OS와 DB에 대해 EOS, EOL 일정이 도래하거나 이미 지났을 경우 아래 두가지 상황으로 인해 버전 업그레이드를 진행하게 됩니다.
- EOS, EOL 일정이 도래함에 따라 고객사에서 선제적으로 버전 업그레이드 요청
- EOS, EOL 일정이 이미 지난 버전에 대해 엔지니어가 고객사에 업그레이드를 권고하고 고객사 승인 시 업그레이드 진행
고객사 요구사항과 현재 서버 버전에 따라 OS만 업그레이드를 하거나 DB만 업그레이드를 하게 될 수도 있습니다.
OS,DB 이외에도 서버 장비의 노후화 및 보증기간 종료에 따라 업그레이드가 진행될 수 있습니다.
DBSAFER Major 버전(3, 5 ,7) 변동 없이 OS 또는 DB만 업그레이드하는 경우 일반적으로 비용이 발생되지 않으나 진행 전 고객사 담당
영업분에게 업그레이드 진행 여부를 공유하고 비용 발생 여부를 필히 체크하여야 합니다.
* MariaDB, Mysql, Centos, Rocky Linux, Redhat 버전별 서비스 기한 정보
- Mariadb : https://endoflife.date/mariadb
- Mysql : https://endoflife.date/mysql
- Centos : https://endoflife.date/centos
- Rocky Linux : https://endoflife.date/rocky-linux
- Redhat : https://endoflife.date/rhel
* Dell 장비별 EOL 정보 관련
Dell 서버의 경우 판매 종료, 개발 및 지원과 같은 서로 다른 EOL 단계를 거치기 때문에 장비 모델별 수명 종료(EOL) 날짜를 Dell에서 공식적으로 제공하고 있지 않습니다. 일반적으로 보증이 적용되어 배송된 시점으로부터 5년을 기준으로 되어 있으나 자세한 EOL 프로세스에 대한 내용은 아래 링크를 참고하시기 바랍니다.
https://www.dell.com/support/kbdoc/ko-kr/000128563/dell-data-security%EC%9D%98-end-of-life-%EC%A7%80%EC%9B%90-%EC%A2%85%EB%A3%8C-%EC%A0%95%EC%B1%85
2. 고객 협의
업그레이드 진행이 확정될 경우 아래 사항들을 고객사 담당자, 담당 영업과 협의하여 사전에 결정하여야 합니다.
- 신규장비 도입인지, 기존 운영장비 재활용인지 여부
>> 신규장비 도입의 경우 기존 서버 구성을 변경하여 구축할 것인지 협의하여야 함(ex. default 1대 구성에서 이중화 구성으로 변경)
>> 신규장비 도입이 불가하여 기존 장비를 재활용할 경우 노후화 정도와 예상되는 서비스 down-time을 고려하여 진행되어야 함
- 장비 스펙 산정
>> DISK, Memory, CPU, NIC 등 장비 부품에 대한 스펙을 운영 규모와 고객사 요구사항에 맞게 산정(담당 영업 검토 필요)
>> 서버에 설정할 RAID 구성을 사전에 고객사 담당자와 협의한 뒤 DISK 스펙 산정
- 업그레이드 할 DB, OS, PKG 검토
>> DB만 업그레이드, DB와 OS 업그레이드, DB와 OS 및 PKG Major 버전 업그레이드 등 업그레이드 범위 결정 필요
>> 적용할 DB, OS, PKG 버전 검토 필요
- 로그 이관,조회 방법 협의
>> (과거,신규 로그 db 통합) OR (구 장비 로그조회용으로 전원 유지 및 신규장비 도입) OR ('서비스 로그 DB 추가 지정' 기능 사용)
('서비스 로그 DB 추가 지정' 기능 적용 방법: https://cafe.naver.com/pnpsecure2/4255 단, sa로그는 지원하지 않으나 향후 개발 예정)
- 고객사 추가 요구사항 확인
>> 기존에 사용하지 않던 신규 기능들에 대한 고객사 니즈 파악 및 적용 계획 수립
>> 기존에 사용하던 기능에 대해 고객사에서 수정하고자 하는 기능이 있는지 파악
- 사용중인 연동 모듈, 커스텀 모듈에 대한 컨버팅 검토
>> 연동 모듈이나 커스텀된 모듈의 경우 재구축 시 DB, OS, PKG 버전에 따라 컨버팅이 필요할 수 있음
>> 사용중인 연동 모듈과 커스텀 된 모듈의 신규 빌드 필요성을 모듈별 품질 담당자에게 문의하여 사전에 확인하여야 함
(모듈별 담당자 정보: https://docs.google.com/spreadsheets/d/1-vfu1TYKN4vZShgyr1toyPT_nDxFeWk2rUljOKD4smw/edit?usp=sharing)
- DBSAFER 서버에 할당할 IP 정보(서버 IP, GATEWAY IP, NTP IP, DNS IP)를 고객사 담당자를 통해 사전 확인
- WBS, 사업수행계획서, 구축계획서를 작성하여 전달
(WBS 예시: https://docs.google.com/spreadsheets/d/1mYqZNuQppi4NILsh7c4WJQmb7GVwI7bD/edit?usp=sharing&ouid=103256173032979663219&rtpof=true&sd=true)
(사업수행계획서 예시: https://docs.google.com/document/d/16yq7OAo00BLwYaQm9Y9ZQubZvde4efBW/edit?usp=sharing&ouid=103256173032979663219&rtpof=true&sd=true)
(구축계획서 예시:https://docs.google.com/document/d/1bDbAulqnOxICAwC5vm29mNF-kkn3mc6I/edit?usp=sharing&ouid=103256173032979663219&rtpof=true&sd=true)
3. 장비 납품 단계
- 신규 장비의 경우 고객사 담당 영업 승인 및 소속 팀장 검토를 거친 후 경영지원팀 장비 담당자를 통해 수령
- 고객사에 장비 납품 후 OS, PKG를 설치할 수도 있으나 CD불량, CD,USB 반입 불가 등 변수를 고려하여 가급적 사내에서 설치 후 납품
>> 기존 IP를 재활용하여 납품하는 경우 IP를 서버에 미리 설정 시 기존 서버와 IP 충돌이 있을 수 있으므로 유의
Rocky Linux 8 기준 Bonding 설정 예시
- 장비 납품 전 서버에서 사용되는 포트가 오픈되어 있을 수 있도록 포트 오픈 리스트를 고객사에 사전 전달
(포트 오픈 리스트 양식 예시: https://docs.google.com/spreadsheets/d/1DDseBbI8QDQw9WThfw8OSnjuhmcOos0A/edit?usp=sharing&ouid=103256173032979663219&rtpof=true&sd=true)
- 고객사 담당자 동행하에 장비 납품 진행
4. 정책, 로그 이관 및 업그레이드 진행
사전 협의된 내용에 맞게 서버 구축을 진행합니다.
- 구 장비 재활용 시 정책, 로그, 모듈 conf 를 타 저장소에 백업하여야 함
>> 한가지 방식으로 백업 시 파일에 문제가 있을 경우 복원이 불가할 수 있어 tar, mysqldump, backup3 등 다중 방식으로 백업
- 신규 장비 구축 시 구 장비와 통신이 가능할 경우 파일을 서버 to 서버 통신으로 이관
- 구 서버와 신규 서버 간의 DB 종류에 따라 작업 방식이 상이하므로 사전에 숙지 필요
(dbsafer3, mysql > dbsafer5, mariadb : https://docs.google.com/presentation/d/1Ksg7pDcaXboqYZIgVOSpeWs0wX-gVyyj/edit?usp=sharing&ouid=103256173032979663219&rtpof=true&sd=true)
(maria 10.2 > maria 10.6 db만 upgrade : https://sites.google.com/pnpsecure.com/engineer-manual/%EB%A7%A4%EB%89%B4%EC%96%BC/dbsafer-v7-0-%EB%A7%A4%EB%89%B4%EC%96%BC/mariadb-10-6-%EC%97%85%EA%B7%B8%EB%A0%88%EC%9D%B4%EB%93%9C)
(mysqldump를 이용한 DB 마이그레이션 방법 : https://cafe.naver.com/pnpsecure2/5227)
- 신규 서버 모듈 conf 설정 값을 기존 운영 값과 동일하게 설정
>> PKG 버전 업그레이드로 인해 신규 conf 파일에서 기존과 다르게 설정된 옵션이 있을 수 있으므로 체크 필요
* 정책 이관 시 유의사항
구 정책을 Manager csv로 반출하여 신규 서버에 등록하여 업그레이드 하는 방식은 아래와 같은 상황이 발생할 수 있음
>> 관리자 로그 이관이 되지 않으며 결국 따로 manager_log 테이블을 이관하는 수작업을 해야함
>> 서비스 객체 idx 값 변조로 로그조회 시 문제를 야기하는 등 DB 데이터 변조 우려가 있음
* 실제 고객사 업그레이드 사례
- Centos 6, DBSAFER 5, Mariadb10.0.38, Aria 엔진 > Rockylinux 8, DBSAFER 5, Mariadb10.6.8, Aria 엔진 (고객사명 : 지아이티)
>> 정책 로그 DB에 대해 tar cvfz 명령어 사용하여 압축 후 신규서버 /home/dbsafer/data/mysql/ 하위에 tar xvfz 압축 해제
>> 신규 서버 ./pnp setup 설정 후 DB 재기동 시 즉시 정책 및 로그 정상 확인
5. 기능테스트
서버 구축 완료 후 사용하는 기능별로 테스트를 진행하고 테스트 결과를 고객사 담당자에게 공유합니다.
(기능 테스트 예시 : https://docs.google.com/document/d/18pKMtWjaoQF-JTG0dypEzjElRwSx6qlz/edit?usp=sharing&ouid=103256173032979663219&rtpof=true&sd=true)
6. 서비스 오픈 및 완료보고서 전달
기능 테스트 완료 후 아래 내용을 검토하여 서비스 오픈 계획을 수립합니다.
- 사용자 프로그램 배포 방식 선정
>> 수동 배포할 것인지, pnp_update_server를 활용하여 프로그램을 자동배포할 것인지
(자동업데이트 파일 생성법 : https://drive.google.com/file/d/15ayr4DnFJDvIZhE5jIrmruf_gB6IRo49/view?usp=drive_link)
- 대상 서버 Server Agent 버전 최신화 여부 결정
(Manager를 통한 Server Agent 업그레이드 방법 : https://cafe.naver.com/pnpsecure2/4716)
- 사용자 전환 및 서비스 오픈 일정 수립
>> 서비스 오픈 후 사용자 접속/로깅 모니터링 필수
- 완료보고서 작성 및 고객사 전달
(완료보고서 예시 : https://docs.google.com/presentation/d/1ck20iv-qsw6_hZlK2xNzZSHPBJhSC2Mw/edit?usp=sharing&ouid=103256173032979663219&rtpof=true&sd=true)
작성 내용 중 누락되었거나 보완/수정이 필요하다 생각되시는 부분에 대해 댓글이나 개인 메시지로 전달주시면 검토하여 글 내용에 반영하도록 하겠습니다.","여성구: 정리가 잘 된 것 같습니다. 다른 엔지니어도 경험할 사항에 대해서 도움을 주는 글인 것 같습네요.
감사합니다. | 남신우: EOS/EOL 관련 추가 요청

1. 회사에서 납품한 Dell 장비의 EOS/EOL 기간에 대한 정보를 포함해 주셨으면 좋겠습니다.
> 장비 지원에 대한 정보가 있어야 고객 협의시 장비 재활용 요청에 대하여 대응 가능 할 것 같습니다.

2. 가장 많이 사용하는 사용 OS인 Redhat과 Mysql도 추가 부탁드립니다.

감사합니다. | 류현수: 해당 내용 추가하여 수정하였습니다.
감사합니다.",https://cafe.naver.com/pnpsecure2/5849
5847,[공유][현대오토에버] 보안사용자 식별정보 불일치에 따른 보안대상서버 접속차단 이슈,"[요약]
- 특정 사용자 A는 DBSAFER AM을 통해 보안대상서버 접속권한을 부여받은 상태
- 그러나 A가 보안대상서버에 접속할 때 차단되며, 차단 로그에는 다른 사용자가 접속을 시도한 것으로 출력됨
- pnp_ssh_proxy 모듈의 결함으로 pnp_telnet 모듈은 사용자 식별 정보를 획득하지 못하여 사용자 식별 정보 미스매치 발생
- pnp_ssh_proxy rev 241이상 버전으로 패치하여 조치 완료
[이슈증상]
- TERMINAL 접속제어 허용되어 있음에도 사용자 식별 정보 불일치에 따른 접속 차단 발생
- 보안계정 접속 로그 상 사용자 식별 정보는 정상
. 서비스 접속할 때마다 기록되는 사용자명이 랜덤하게 달라짐
. ex) 특정사용자 A가 보안대상서버 접속 시
: 보안계정 접속 로그에서의 사용자 정보 - A
: 서비스 로그에서의 사용자 정보 - B(랜덤)
- 결과적으로 의도한 통제(허용/차단)가 이루어지지 않는 상황 발생
[고객사 환경 정보]
- LOG+GW1+GW2
- DBSAFER V5.0
- NodeSafer Agent 3.2.36.1T(ssl-vpn 사용)
- pnp_telnet rev 2250(common library 3622)
- pnp_oms_dms rev 670
- pnp_ssh_proxy rev 229
[각 구간 별 사용자 식별 정보 확인]
- 해당 고객은 이미 NS Assist(Nodesafer Agent)를 수차례 재설치(& 리부팅) 진행하였음
- NodeSafer Agent 클린재설치 선행
. 완전 삭제 > 리부팅 > 재설치
1) NodeSafer Agent 로그에서 사용자 정보 확인
- C:\Users\Administrator\AppData\Roaming\NSASSIST\log\2023-06-15.log
. 보안서버 로그인 아이디 : 7302382 (CCommOMS::OMS_Login,5472) 확인
NSAssist 로그
2) NS TDI 드라이버 테스트에서 사용자 정보 확인
- 보안 계정 정보(7302382) 확인
사용자 식별
세션별 NAT 내역
3) NodeSafer Agent -> DBSAFER 구간 패킷에서 사용자 정보 확인
- NAT IDENTITY 뒤에 보안 계정 정보(7302382) 확인
NodeSafer Agent -> DBSAFER 구간 패킷 덤프
4) pnp_ssh_proxy & pnp_telnet 모듈 디버깅 시
- ssh_proxy의 사용자 식별 정보 : 7302382
- pnp_telnet의 사용자 식별 정보 : H2112696
- 사용자 식별 정보 불일치
- pnp_ssh_prxoy 디버깅 로그
[2023-06-15 14:00:38] [15948] [MISC][INFO__000000000] Information message. : [NAT-IDENTIFY](VER)1, (ENCRYPT)X, (RDP_LOGGING)0, (SERVICE_TYPE)4, (SERVICE_NO)26, (USER)172.100.100.120:52289, (TARGET)10.111.0.47:4022, (DBSAFER)10.129.145.11:4016, (CERT)7302382, (APP), (UNIKEY)0D17EB09C5F2A40CBAE767E3C0CABE5C4A015F5A22F5AE2FF5A40D6E65CA728B, (HASH), (ACCESS)0, (OS)1, (MSG-TUNNEL)0, (RESERVED)0/0
src/network/CHandle.cpp[check]:133
- pnp_telnet 디버깅 로그
[2023-06-15 14:00:40] [P:15966][T:140183169136384] (SESSION)10.129.145.14:52289 -> 10.129.145.14 -> 10.111.0.47:4022, (CERT)H2112696, (ACCOUNT)ubuntu
extension_func.cpp(send_proxyinfo_provider):841
[2023-06-15 14:00:40] [P:15966][T:140183169136384] [LOG:SESSION] (IDX)0, (TYPE)IN, (CERT)H2112696, (ACCOUNT)ubuntu, (CLIENT)10.129.145.14, (SERVER)10.111.0.47:4022, (ACTION)1 return data
dbsafer_net_demon.cpp(dbsafer_db_session_write_session):905
[2023-06-15 14:00:40] [P:15966][T:140183169136384] index=0 10.129.145.14:52289,0 ubuntu: Bye!
dbsafer_net_tcp_engine.cpp(dbsafer_net_tcp_main):3383
[2023-06-15 14:00:41] [P:15966][T:140183169136384] [LOG:SESSION] (IDX)0, (TYPE)OUT, (CERT)H2112696, (ACCOUNT)ubuntu, (CLIENT)10.129.145.14, (SERVER)10.111.0.47:4022, (ACTION)1 return data
dbsafer_net_demon.cpp(dbsafer_db_session_write_session):905
- (참고) 정상적인 상황에서 pnp_ssh_proxy & pnp_telnet 모듈 디버깅 시
. 보안서버 로그인 아이디 : E116487
. pnp_telnet
[2023-06-15 14:11:50] [P:15966][T:140183169136384] (SESSION)10.40.193.106:14398 -> 10.40.193.106 -> 10.111.0.47:4022, (CERT)E116487, (ACCOUNT)ubuntu
extension_func.cpp(send_proxyinfo_provider):841
[2023-06-15 14:11:50] [P:15966][T:140183169136384] [LOG:SESSION] (IDX)1, (TYPE)IN, (CERT)E116487, (ACCOUNT)ubuntu, (CLIENT)10.40.193.106, (SERVER)10.111.0.47:4022, (ACTION)3 return data
dbsafer_net_demon.cpp(dbsafer_db_session_write_session):905
[2023-06-15 14:11:50] [P:15966][T:140183169136384] [LOG:COMMAND] (IDX)1, (UINDEX)1686805910506536002, (CINDEX)1, (KIND)CMD, (TYPE)0x13, (CERT)E116487, (ACCOUNT)ubuntu, (CLIENT)10.40.193.106:14398, (SERVER)10.111.0.47:4022, (ACTION)3
---------------------------------------------------------------------
Login: ubuntu (Verified)
---------------------------------------------------------------------
dbsafer_net_demon.cpp(dbsafer_db_cmd_send_session):499
[2023-06-15 14:11:50] [P:15966][T:140183169136384] [LOG:COMMAND] (IDX)1, (UINDEX)1686805910506536002, (CINDEX)1, (KIND)RTN, (TYPE)0x14, (CERT)E116487, (ACCOUNT)ubuntu, (CLIENT)10.40.193.106:14398, (SERVER)10.111.0.47:4022, (ACTION)3
---------------------------------------------------------------------
[이슈 원인]
- pnp_ssh_proxy 모듈은 사용자 식별 정보를 수신한 뒤 파일로 저장하고, pnp_telnet 모듈은 해당 파일을 읽어서 사용자 식별 정보를 획득함
- pnp_ssh_proxy 모듈에서 사용자 식별 정보를 저장할 때, 데이터 길이가 유효하지 않은 값으로 입력되어 파일 읽는 중 오류 발생
. 데이터 길이가 들어갈 위치에 약속된 2바이트가 아닌 4바이트로 값을 덮어씀
. 이로 인해 pnp_telnet 모듈은 해당 파일의 포맷을 읽지 못함
- 로그
. [2023-06-15 14:11:50] [15966] [WARNING]The value in the length field exceeds the threshold. (Total Size: 000F, offset: 0030, field Size: 0007)
./common/dbms_parser/include/misc/_PTranslateID.cpp::getSessionInfoFromPacket::335
- pnp_telnet 모듈은 pnp_ssh_proxy 모듈로부터 사용자 식별 정보를 획득하지 못했기 때문에 pnp_oms_dms를 대상으로 보안 계정 정보를 요청
- pnp_oms_dms 은 망 분리 환경의 사용자 인 경우, 대표 NAT IP에 실제 사용자 IP를 매핑하여 저장됨
- 해당 사용자는 망 분리 환경의 사용자였고,pnp_oms_dms은 대표 NAT IP에 매핑됐던 가장 최근 사용자의 정보를 전달함
- 이로 인해 사용자 식별 정보 미스매치가 발생되어 비정상 차단 발생됨
[조치 방안]
- pnp_ssh_proxy rev 241 이상으로 패치","김하림: 1. 망 분리 환경에서
2. 서비스 데몬이 사용자 식별 정보를 획득하지 못한 경우

서비스 데몬은 pnp_oms_dms에 보안계정 정보를 질의합니다.
동일한 IP의 접속 이력이 남아있는 경우에는 pnp_oms_dms가 랜덤으로 보안계정을 전달하기에,
실제 접속과는 다른 정보가 남을 수 있는 것입니다.
(dbsafer3.oms_access에 기록되어있는 IP에 매핑된 보안계정들 중 하나를 랜덤으로 전달)


다른 분들의 참고를 위해 관련 글 하나 더 공유드립니다.
> https://cafe.naver.com/pnpsecure2/5713

사용자 식별 정보를 획득하지 못하는 경우에는 아래 패킷들을 확인하면 어떤 부분에서 문제가 있는지 확인할 수 있습니다.
> 클라이언트 - 서버 구간
> 서버 내 서비스 구간 | 김영은: 자세한 설명 감사드립니다:)",https://cafe.naver.com/pnpsecure2/5847
5842,[공유] pnp_connector 뷰테이블이 생성되지 않는 현상,"1. 고객사 : LS전선
2. 환경
- pnp_connector 사용 view 테이블 생성
- 로그 수집솔루션에서 view 테이블의 데이터를 수집
- 3가지 view 테이블 제공
> 세션로그, 명령어, ServerAgent 로그
각 테이블 생성 쿼리 (첨부문서 참조)
첨부파일
view_table
.zip
null
파일 다운로드
3. 현상
- 세션, 명령어 로그는 정상적으로 날짜별 데이터 표시 및 로그 수집됨
- ServerAgent 로그만 날짜별 데이터 갱신이 안되어 로그 수집이 안됨
- DB에서 확인 시 shell_acl_날짜 테이블이 생성되지 않은 일자 존재
ex) 주말, 공휴일, 단체 연차소진과 같이 업무가 없는 날
4. 원인
- view 테이블 생성 시 사용되는 shell_acl_날짜 테이블은 로그가 없을 시 생성되지 않음
- pnp_connector는 view 생성 시 예측되는 테이블 이름에 대해 left join 된 쿼리를 수행하는 형태이므로
테이블이 없는 경우 쿼리 실패가 발생됨
첨부파일
pnp_connector 로그
.txt
null
파일 다운로드
5. 조치예정 사항
- pnp_server_manager 기능 수정
옵션 설정에 따라 shell_acl_날짜 빈테이블을 생성하도록 개선
- 개선사항 빌드 및 패치 시 추가 내용 작성 예정",댓글 없음,https://cafe.naver.com/pnpsecure2/5842
5836,[DBSAFER AM][RDP 클립보드] DBSAFER를 통해 RDP 접속 시 클립보드 기능이 되지 않을 경우,"[문제현상]
- RDP 접속 후 클립보드 기능이 실행이 되지 않는 경우 발생
[일반적인 원인]
일반적으로 mstsc 실행 후 클립보드 기능이 되지 않으면 옵션이 빠져 있는 경우가 많습니다.
[클립보드 기능 활성화]
- 옵션표시 > 로컬 리소스 > 클립보드 체크
해당 옵션이 정상적으로 체크되어있지만 되지 않는 경우가 있습니다.
이 경우는 대상서버의 rdpclip.exe라는 프로세스에서 오류가 발생하여 정상적으로 동작하지 않는 문제입니다.
[해결 방안]
- 목적지 서버의 rdpclip.exe 의 재실행
1. 프로세스 종료: 작업관리자 > 세부정보 > rdpclip.exe 찾기 > 해당 프로세스 작업 끝내기
- rdpclip.exe는 경우에 따라 2개 이상 실행되어 있는 경우도 있습니다.(모두 작업 끝내기를 해줘야 함)
2. 프로세스 재실행
- 파일 > 새 작업 실행 > 관리자 권한으로 이 작업 실행 체크하기 > 열기란에 rdpclip.exe 입력 및 확인
프로세스 확인 후 정상적으로 실행이 되있으면 RDP Session을 접속하지 않아도 바로 적용이 됩니다.
rdpclip.exe를 재 실행하는 동작은 서버 및 서비스에 아무런 영향이 없습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5836
5830,[공유] AD 인사 연동을 진행한 후에 IMUP 인사 연동 진행하는 법,"안녕하세요.
클라우드기술팀 민시원입니다.
카카오페이증권에서 AD 연동이 완료된 후, WEB DMS가 들어오면서 IMUP을 사용하게 되어 진행했던 인사 연동 방법에 대해 공유 드립니다.
AD 인사 연동으로 dbsafer3.dbsafer_ldap_list에 계정 정보를 가져온 뒤, IMUP 인사 연동으로 dbsafer_ldap_list 테이블에서 계정 정보를 가져와서 연동하는 방식입니다.
연동 시, 특정 직위를 가진 사용자는 결재자 역할에 추가될 수 있도록 하는 작업도 포함되어 있습니다.
해당 방법은 부서 정보 & 결재자로 지정할 수 있는 기준 (직위 등)이 필요함으로 사전에 고객과 협의가 필요합니다.
[설정방법 (카카오페이증권 기준)]
1. 결재자는 보안 계정의 특정 직위로 정함 (고객과 협의)
2. IMUP 페이지 secureadmin 계정 로그인 후 역할 관리에서 결재자 역할 추가
- 역할명: 결재자 (임의의 역할명으로 변경 가능)
- 결재권한: 결재권한
2. 결재자 역할 추가
dbsafer_accountsync.properties
3. dbsafer_accountsync.properties (인사 연동 설정 파일)에서 컬럼 매칭 설정
- ColumnPosition = title ('title'은 고객사 AD 컬럼 정보에 따라 달라짐)
3. 인사 연동 컬럼 매칭
pnp_accountsync_imup.properties
4. pnp_accountsync_imup.properties (IMUP 인사 연동 설정 파일)에서 컬럼 매칭 설정
- ColumnUserInfo1 = tel (인사 연동 설정 파일에 부서 컬럼을 ColumnTel에 매칭 시켰기 때문에 tel 컬럼을 가져옴)
- ColumnUserInfo2 = reserved1 (예약 필드를 사용함)
4. IMUP 인사 연동 컬럼 매칭
5. IMUP 부서 정보에 매칭될 컬럼명 설정
- ColumnDeptName = tel
- ColumnDeptInfo1 = tel
5. 부서 정보 컬럼 매칭
6. imup.pnp_role 테이블에 2번 과정에서 생성한 역할의 idx 값 확인
6. imup.pnp_role 테이블 값 확인
7. IMUP 역할 설정
- RoleIdx6 = 확인한 idx 값
- RoleColumn6 = user_info2
- RoleTakes6 = approval (임의의 값으로 변경 가능)
* 6은 임의의 숫자로, 해당 역할 설정 부분에 기존에 설정되어 있는 값의 다음 값을 입력하면 됩니다.
7. IMUP 역할 설정
8. IMUP 인사 연동이 바라봐야 하는 LOG 서버의 dbsafer3 DB 설정
- ScrDriver = com.mysql.jdbc.Driver
- SrcUrl = jdbc:mysql://LOG 서버 IP/dbsafer3
- ScrUser = safeusr
- ScrPasswd =
- SrcEncoding은 DBSAFER를 UTF8 버전으로 설치 시, 기본 값으로 설정
8. DB 정보 설정
9. IMUP 인사 연동이 읽어올 쿼리 설정
- From= from (select sno, name, mail, position, tel, reserved1 from dbsafer3.dbsafer_ldap_list where islock = '0')T (잠겨있지 않은 보안 계정에 대해서만 정보를 가져옴)
- DeptFrom = from (select tel from dbsafer3.dbsafer_ldap_list group by tel)T (부서 정보 가져옴)
9. IMUP 인사 연동 쿼리 설정
SQL 쿼리 & 스크립트 작성 및 crontab 설정
10. sql 파일 생성
- UPDATE dbsafer3.dbsafer_ldap_list SET reserved1 = 'approval' WHERE position IN ('역할') AND reserved1 != 'approval'; (approval은 7번 과정에서 설정한 RoleTakes 값으로 변경)
11. sql 파일 설정
11. sh 파일 생성
-
cd /dbsafer
AegisPW='expect -c ""spawn ./pnp dbms_info
expect -re ""|>""
sleep 0.2
send ""dbsaferadmin""
send |r
sleep 0.2
interact "" | aws 'NR==8 {print $1 }'|tr -d '|015|012''
mysql -usaferusr -p${AegisPW} < /dbsafer/approval.sql
12. sh 파일 설정
12. crontab 설정
- crontab -e
-
SHELL=/bin/bash
PATH= 'echo $PATH' 값
LD_LIBRARY_PATH= 'echo $LD_LIBRARY_PATH' 값
15 5 * * * source /root/.bash_profile && cd /dbsafer && ./approval.sh (시간은 고객과 협의 필요, AD 연동과 IMUP 인사 연동 사이의 시간으로 설정)
13. crontab 설정
모듈 시작
13. IMUP 인사 연동 모듈 시작 및 동기화 (/dbsafer 위치에서)
- ./pnp_accountsync_imup.sh start
- ./pnp_accountsync_imup.sh test
- ./pnp_accountsync_imup.sh sync
감사합니다.","이상민: 보완 설명 드립니다.

1) DBSAFER DB를 대상으로 AD인사연동이 완료된 이후 IMUP이 도입되었습니다.

2) 보편적인 순서라면 IMUP -> DBSAFER DB 순서로 인사데이터가 동기화 되어야 합니다. 그러나 카카오페이증권은 불가피하게 반대 방향으로 인사연동이 진행되었습니다. 단, 고객과 아래와 같은 사항을 협의 후 진행하였습니다.
- IMUP에서 조직도 트리를 구성하지 않는다.
- 결재권자는 특정 직급자 이상으로 지정한다.

3) AD -> DBSAFER DB 인사연동 시 특정 직급자들을 대상으로 예약필드1에 approval 문자열을 update 했습니다.

4) DBSAFER DB -> IMUP 인사연동 시 dbsafer_ldap_list.reserved1의 값이 approval인 인원은 결재권자 Role을 할당하였습니다. | 민시원: 보완 설명 감사합니다!",https://cafe.naver.com/pnpsecure2/5830
5824,[공유] Rel22.11-CentOS7 OPENSSL 1.1.1 패키지에서 pnp_ssh_proxy 프로세스가 실행되지 않는 오류,"[요약]
- PKG_DBSAFER5_RelR22.11-CentOS7_x86_64_OpenSSL111_20230413.tar.gz 버전에서 정상적으로 라이브러리 참조가 되지 않아 pnp_ssh_proxy 프로세스가 실행되지 않는 오류 발생
- /usr/local/magiccrypto/lib64에 있는 libssh.so.4 를 /usr/local/magiccrypto/lib 로 복사하여 대응 완료
- 추후 품질혁신실 기반검증팀에서 릴리즈 패키지 리빌드 예정(ASAP)
[패키지 버전]
- PKG_DBSAFER5_RelR22.11-CentOS7_x86_64_OpenSSL111_20230413.tar.gz
[상세]
1. 이슈 내용
- pnp_ssh_proxy 프로세스가 실행되지 않는 오류 발생(pnp_telnet 프로세스만 실행)
- pnp_sshd 프로세스를 사용하는 경우 정상적으로 프로세스 실행됨
pnp_ssh_proxy 프로세스 실행되지 않음
pnp_sshd 프로세스 정상적으로 실행됨
2. ldd 확인
- ldd로 pnp_ssh_proxy 모듈 확인 결과, libssh.so.4 라이브러리 not found로 확인
- 조치 내용
. libssh.so.4 라이브러리가 /usr/local/magiccrypto/lib64 위치에 있음
. bash_profile에서 LD_LIBRARY_PATH 수정
# vi /root/.bash_profile
# 변경 전
﻿# export LD_LIBRARY_PATH = /usr/local/magiccrypto/lib:/usr/local/magiccrypto/lib/mariadb
# 변경 후
export LD_LIBRARY_PATH = /usr/local/magiccrypto/lib:/usr/local/magiccrypto/lib/mariadb:/usr/local/magiccrypto/lib64
. 변경 사항 적용
# source /root/.bash_profile
. 적용 결과
3. strace 확인
- 위의 조치사항 이후에도 서비스 가동 시 pnp_ssh_proxy 프로세스 실행되지 않음
- 수동으로 프로세스를 띄우면 정상적으로 프로세스 실행되며 접속/로깅 정상
. /usr/local/magiccrypto/lib64 경로를 참조하는 root 계정에서 직접 pnp_ssh_proxy를 실행하므로 프로세스가 실행됨
# ./pnp_ssh_proxy [G/W Port] [Target Port] [Target IP] [Service No]
수동으로 pnp_ssh_proxy 실행
- strace를 이용해 pnp_launcher에서 호출하는 시스템 콜 디버깅
# strace -o strace.out -f -p [pnp_launcher pid]
strace.out
=> pnp_ssh_proxy를 호출하는 과정에서 shared library error 발생
=> QA/연구소 문의 결과, pnp_launcher 모듈이 /usr/local/magiccrypto/lib64 경로를 바라보지 못해 해당 이슈가 발생한 것으로 확인
- 조치 내용
. /usr/local/magiccrypto/lib64/ 경로의 libssh.so.4 파일을 /usr/local/magiccrypto/lib에 복사 후 서비스 재기동
# cp ﻿/usr/local/magiccrypto/lib64/li﻿bssh.so.4 /usr/local/magiccrypto/lib
# cd /dbsafer
# ./pnp_agent service-stopall
# ./pnp_agent service-startall
- 조치 결과
이슈 추적을 위해 도움을 주신 이상민 팀장님, 최재규 사원님 감사합니다.","여성구: magiccrypto 라이브러리 설정 및 strace 추적까지 잘 작성을 해주신 것 같습니다.
잘 전파가 된 것 같아서 좋네요. 감사합니다.",https://cafe.naver.com/pnpsecure2/5824
5821,[공유] DBSAFER IM 사용 시 SU 계정을 통한 자동 접속 기능,"[개요]
DBSAFER IM을 통한 자동접속 기능 사용 시 사용자가 공용 계정으로 직접 접속하는 방법이 아닌, 개인 계정에 SU 계정 등록을 통해 자동 접속 시 개인 계정으로 최초 접속 후 공용 계정으로 자동 su 전환되는 기능 공유드립니다.
[고객 요구사항]
고객사는 ISMS 인증 심사 항목 중 정보시스템에 사용자 등록 시 '1인 1계정 발급을 원칙으로 하여 사용자에 대한 책임추적성 확보' 항목을 만족하기 위해 사용자들은 각 시스템에 개인 사번으로 된 OS 계정으로 접속 후 공용 계정으로 su 전환 하여 사용하는 환경이며, 해당 환경에서 DBSAFER IM을 사용 할 경우 DBSAFER에서 패스워드를 관리하게 되는데 su 전환 시 사용자가 직접 패스워드 입력이 불가능 할 것으로 예상되며 이에 대응 가능한 기능이 있는지 문의가 있었습니다.
- DBSAFER를 사용 할 경우 사용자 별 각각의 보안계정(사번으로 생성 가능)을 사용하기 때문에 시스템상의 공용계정을 사용 하더라도 보안계정을 통한 1인 1계정발급 및 사용자에 대한 책임 추적성 확보가 가능하며 이와 같이 사용하여 심사 대응하는 케이스가 있다고 가이드 했으나, 고객사에서는 시스템상에 개인 사번으로 된 계정을 통해 공용계정으로 su 전환하는 케이스에 대해 지원이 가능한지 확인이 필요하다는 요구사항이 있었습니다.
[적용 방법]
- DBSAFER IM에 장비 및 서버 계정 동기화 후 사용자의 개인 서버 계정에 다음과 같이 su 계정을 추가
이때 su 계정에 사용자를 먼저 추가 한 후, 해당 사용자에게 할당 될 su 계정을 지정 하는 방식으로
1. 해당 서버 계정의 사용자 목록에 추가되어 있는 사용자에 한하여 su 계정 부분에 추가 가능
2. 사용자 등록 후 SU 계정을 추가 할 때, 서버 계정 상태가 정상인 계정에 한하여 추가 가능
- su 계정이 등록 되었다면, 자동 접속 화면에 다음과 같이 표시되며 su 계정이 설정된 계정을 통해 접속을 시도 할 경우 자동으로 패스워드 입력이 되며 전환
이상입니다.
감사합니다.","강성우: 좋은 정보 공유 감사합니다!
참고로 DBSAFER 7.0의 경우 pnp_telnet, pnp_telnet_gateway 모듈의 특정 버전 이상부터 su change 기능을 지원합니다.
22.11 릴리즈에 포함되었는지 모르겠지만 7.0에서 su change 기능 필요 시 QA에 확인해주시기 바랍니다",https://cafe.naver.com/pnpsecure2/5821
5808,[공유] IMUP 페이지에서 Assist Host 자동 다운로드 설정,"안녕하세요.
클라우드기술팀 민시원입니다.
카카오페이증권에서 IMUP 사용 시, IMUP 페이지로 접속하면 AssistHost 파일을 자동으로 다운로드하지 않아서 진행한 설정 변경 사항 공유드립니다.
[설정방법]
1. /home/webproperties/imup/config.properties 파일 편집
2. DBSAFER IM API Info 탭에서 im.api.host 내용 수정 (DBSAFER IP로 변경)
3. Tomcat 재시작
[config.properties 설정]
/home/webproperties/imup/config.properties 설정 값
AssistHost 다운로드 시에 IM API를 통해서 다운로드하고 있기 떄문에 im.api.host 값을 변경하여 다운로드를 진행하는 원리입니다.
감사합니다.","윤진하: - IMUP 설치 후에 /home/webproperties/imup/config.properties 에서 변경해야 하는 IP는 아래와 같이 3군데 입니다.
> cors.allowed.origins
> im.api.host
> imup.host

- 나머지 부분도 정상적인 동작을 위해 수정해주는 것이 좋으니 확인해보세요~ | 서재영: config 파일 수정 사항 줄여 주세요 ㅠㅠ;",https://cafe.naver.com/pnpsecure2/5808
5804,"[TIP] ﻿DBSAFER v5.0 패키지에 pc_Assist v3.3 사용 및 터미널(putty,remotecon.exe)자동연결 기능사용","* DBSAFER V7.0에서 사용가능한 기능으로, DBSAFER V5.0에서 사용가능한 패키지 및 설정을 공유합니다
(pc_Assist 3.3버전은 DBSAFER V5.0에서 사용이 불가했음)
- 요청내용 : pc_agent 서비스대상 클릭시 putty로 자동 연결(자동로그인 X)
[사용 버전]
- 패키지 : PKG_DBSAFER5_RelR22.11-CentOS7_x86_64_P11_20230413.tar.gz
- pc_Assist버전 : v3.3.1.6
[conf 설정]
- cltpolicy.cfg 파일 필수 적용
: NAT_MENU_TYPE = 4
: USE_AM_RDPLOGGING=1
- pnp_oms_dms.conf 설정
NAT_MENU_TYPE = 4
[DBSAFER_MANAGER 시스템 설정]
- 서비스 설정 > TERMINAL 설정 > ""TERMINAL 하위 구분"" 활성화
[서비스 등록]
- 객체 > 서비스 > TERMINAL > ""기존과 다르게, RDP / SSH / TELNET 으로 구분됨
[적용테스트]
pc_assist 로그인 > 서비스 리스트 ""더블클릭"" > putty창 연결 확인",댓글 없음,https://cafe.naver.com/pnpsecure2/5804
5799,[TIP] 텔레그램(telegram) 알림 연동 방법,"안녕하세요. 클라우드기술팀 김영은입니다.
pnp_sms 모듈을 이용한 DBSAFER 텔레그램 알림 연동 방법을 공유드립니다.
개요
- 고객사 플레이놈은 기존에 OTP 키 발급을 위해 pnp_mailer 모듈을 사용 중이었으며, mailer 설정을 유지하고 추가로 텔레그램 연동이 필요한 상황이었기 때문에 pnp_sms 모듈을 이용하였습니다.(pnp_mailer는 C와 Java 방식이 있으며, C 방식에서는 텔레그램 연동을 지원하지 않음)
- 기존에 mailer 기능을 사용하지 않고 있는 고객사라면 같은 방법으로 pnp_mailer 모듈을 이용한 연동도 가능합니다.
pnp_mailer/pnp_sms 모듈 동작 방식
1. 경고 객체에서 메일 알람 등록
2. 이벤트가 발생하면 pnp_mailer/pnp_sms 모듈이 알람 텍스트를 mailer/sms 테이블에 추가
3. pnp_mailer/pnp_sms 모듈 설정이
1) smtp인 경우, 설정된 smtp로 알람 텍스트 전달
2) url인 경우, 설정된 webhook url로 알람 텍스트 전달
=> 텔레그램 단톡방에 webhook url을 생성/설정하여 url을 통해 해당 텔레그램 단톡방에 알람 텍스트를 전달
Webhook(웹훅)이란?
한 응용 프로그램에서 특정 이벤트가 발생했을 때 다른 응용 프로그램에 실시간 정보를 제공하기 위한 방법으로 Webhook URL(요청결과 수신용 웹페이지/Callback URL)을 설정하게 되면 각종 이벤트가 발생할 때마다 해당 URL에 HTTP POST 방식으로 데이터를 전송하게 됩니다.
텔레그램 환경 구성
1. 텔레그램 desktop 또는 app 다운로드
2. DBSAFER 알림을 전달해줄 봇 생성
1) @BotFather 검색하여 BotFather 채팅방 접속
2) 봇 생성
- /newbot 입력
- 봇 이름 입력
- 봇의 username 설정(*_bot 형식)
- 정상적으로 봇을 생성하였으면 HTTP API에 접속할 수 있는 token이 생성됨
① BotFather 채팅방 접속 / ② 봇 생성 / ③ HTTP API로 접속할 수 있는 token 발급 / ④ 생성한 봇 채팅방 접속
3. 생성한 봇 채팅방 접속
1) 테스트 메시지 전송
테스트 메시지 ""aa"" 전송
2) chatid 찾기
- 아래 URL에 접속하여 봇 채팅방의 id 값을 확인
. URL : https://api.telegram.org/bot[HTTP API token 주소]/getUpdates
. ex) https://api.telegram.org/bot6227061489:AAG7658qqjB_cuJQ-Yg4x-3J1G1nBdAyUPg/getUpdates
chatid 6083621148 확인
3) 텔레그램 봇 API URL 테스트
- msg 값에 임의의 값을 입력한 후 아래 URL에 접속하면, 봇 채팅방에 메시지가 전송되는 것을 확인할 수 있음
. URL : https://api.telegram.org/bot[HTTP API token 주소]/sendMessage?chat_id=[chatid]&text=[msg]
. ex ) https://api.telegram.org/bot6227061489:AAG7658qqjB_cuJQ-Yg4x-3J1G1nBdAyUPg/sendMessage?chat_id=6083621148&text=테스트 중입니다
URL의 [msg] 부분에 입력한대로 dbsafer_bot에서 메시지가 전송됨
pnp_sms 모듈 설정
1. pnp_sms 모듈 다운로드
- URL : https://bbs.pnpsecure.com/showthread.php?tid=4413&highlight=pnp_sms
- 사용한 모듈 버전 : pnp_sms_3.1.11.tar.gz
2. 모듈 설치 및 설정
- 분리 구성인 경우, LOG 서버에 설치
# tar zxvf pnp_sms_3.1.11.tar.gz -C /dbsafer
# cp /dbsafer/.conf/pnp_sms.properties.sample /dbsafer/.conf/pnp_sms.properties
=================================================================================================
- conf 파일 수정
# vi /dbsafer/.conf/pnp_sms.properties
# 연동 타입을 URL로 설정(필수)
Smstype = url
# HTTP 전송 방식을 POST 타입으로 설정(필수)
UrlSendType = 1
# 텔레그램 URL 정보 입력(필수)
InsertUrl = https://api.telegram.org/bot﻿[HTTP API token 주소]/sendMessage?chat_id=[chatid]&text=%%
InsertItem = msg
# URL 인코딩 설정(필수)
DoUrlEncoding = yes
# 서버에 입력할 문자의 캐릭터셋 설정(필수)
TargetCharacterSet =UTF-8
3. 모듈 테스트
- 설정된 내용이 정상 동작하는지 확인하기 위해 사용
- 임의의 데이터를 전송
- 입력 명령어 : # ./pnp_sms.sh test
4. 모듈 시작
- 입력 명령어 : # ./pnp_sms.sh start
DBSAFER 매니저 설정
1. 시스템 설정 > Mail 사용 체크
2. 경고 객체 생성
① 경고 그룹 생성 / ② 경고 객체 생성 / ③ 문자 전송 선택 / ④ 예약어 사용 체크 / ⑤ 예약어 선택으로 경고 내용 입력
3. 경고 객체를 추가한 정책 생성
적용 결과
1. 텔레그램 메시지 확인
- 생성한 경고 정책을 타면 텔레그램 알림 전송됨
2. DBSAFER DB 확인
1) dbsafer3.sms_alert : 전송될 메시지 확인(전송 후에는 데이터가 사라짐)
2) dbsafer3.sms_alert_history : 메시지 전송 이력 확인
감사합니다.
참고 자료
- slack / 텔레그램 연동 설정 방법
https://docs.google.com/document/d/1OH3BCE2EgvXjqIL6E4z2qO4NFg8NzzcJ_sPpNYIi4dM/edit?usp=share_link
Google Docs: Sign-in
Sign in to continue to Docs Email or phone Forgot email? Not your computer? Use a private browsing window to sign in. Learn more Next Create account Help Privacy Terms
docs.google.com
- 텔레그램 봇 만들기
https://jeongnue.tistory.com/677
텔레그램 봇 만들기 (1) - 텔레그램에서 봇 생성하기 (BotFather)
휴대폰 알람 이상의 기능이 필요한 일이 생겼다. 그래서 나를 쪼아줄... 누군가를 찾다가 그 누군가가 봇이 되면 어떨까 하는 생각을 하게 되었다. 텔레그램은 봇 기능을 활용하기에 적합한 메신저이다. 한국에서는 카카오톡의 점유율이 높기도 하고, N번방이라던지 하는 안좋은 이슈때문인지 사용하는 사람이 많지 않은데 공돌이들에게는 이만한 장난감이 없다. 텔레그램을 설치해서 BotFather 를 검색해보자 /start를 치면 봇에 대해서 잘 설명해준다. 뭐 이름을 바꾸거나... 여러가지 기능이 있지만 지금 우리가 할 것은 /newbot 뭐 ...
jeongnue.tistory.com
- webhook URL
https://frtt0608.tistory.com/143
웹훅[Webhook]이란 무엇일까?
✅ Webhook 웹훅은 웹페이지 or 웹앱에서 발생하는 특정 행동(이벤트)들을 커스텀 Callback으로 변환해주는 방법으로 이러한 행동 정보들을 실시간으로 제공하는데 사용됩니다. 보통 REST API로 구축된 웹 서비스는 하나의 요청에 따라 하나의 응답을 제공합니다. 이러한 구조로 인해 특정 이벤트가 발생했는지 조회하려면 서버로의 요청이 선행되어야 합니다. 즉, 일반적인 API(Polling)는 클라이언트가 서버를 호출하는 방식입니다. 하지만, 웹훅은 서버에서 특정 이벤트가 발생했을 때, 클라이언트를 호출하는 방식으로써 역방향 ...
frtt0608.tistory.com
https://developer.payple.kr/quick/webhook-url
Webhook URL
이 글의 목차
developer.payple.kr",댓글 없음,https://cafe.naver.com/pnpsecure2/5799
5793,[공유] NHN Cloud SMS API v2.4 연동(by pnp_sms),"안녕하세요
클라우드기술팀 손혁진입니다.
아이에스이커머스 고객사에서 NHN Cloud SMS API v2.4 연동 요청이 있어 아래와 같이 진행하여 내용 공유 드립니다.
[요약]
- 아이에스이커머스 고객사에서 NHN Cloud SMS API v2.4를 활용하여 결과값제어정책 경고 객체 알림 연동 요청
- PNP_SMS 모듈 통해 NHN Cloud SMS API v2.4 연동하기 위해서는 PNP_SMS 모듈 3.1.11 이상 버전 사용 필요
- NHN Cloud SMS API v2.4 연동 중 매니저 경고 객체 > 경고 내용에 개행(줄 바꿈) 사용 시 SMS 발송 불가
[구성도]
- NHN SMS API 연동 구성도(w pnp_sms)
[연동절차 설명]
1. 고객사에서 SMS 서비스 사용하기 위해 NHN Cloud > SMS에 반드시 발신번호 사전등록
2. pnp_sms 모듈에서 InsertURL 사용 시 appkey 사용이 필요하여 고객사 appkey 확인
3. pnp_sms 모듈 사용을 위해 pnp_sms.properties 설정 및 모듈 구동
4. 매니저 경고 객체(SMS 알림) 및 결과값제어정책에 해당 경고 객체 등록
5. 결과값제어정책 타게 되면 정상적으로 SMS 알림이 발송 되는지 테스트
[NHN SMS API 설명]
- NHN 클라우드에서 제공되는 SMS 서비스로 SMS, LMS, MMS 발송, 발송 예약 기능, 템플릿 관리, 발송 내역 조회 기능을 제공하는 문자 메시지 발송 시스템입니다. 또한 타솔루션과 연동을 위한 RESTful API를 제공합니다.
이때 RESTFUL API를 사용하기 위해서는 APPKEY가 반드시 필요합니다.
- APPKEY는 RESTFUL API를 사용하기위해 반드시 필요한 NHN Cloud 사용자 프로젝트와 상품간 1:1 매칭키이며 프로젝트당 하나의 App Service Key를 발급합니다.
[pnp_sms 모듈 설명]
- NHN SMS API 연동 전 고객사 요청할 사항은 아래와 같습니다.
. DBSAFER > NHN CLOUD TCP 443 포트 오픈
. 고객사 appkey
. SMS 수신 및 발신 번호
. 경고 객체에 사용할 경고 내용
- SMS발송을 위한 필수값은 아래와 같습니다.
. appkey, SMS 본문, SMS 수신번호, SMS 발신번호
. 상기 필수값 4개이외의 값이 추가될 경우 개발 필요할 수 있습니다.
- pnp_sms.properties 설정 및 적용 방법
# vi .conf/pnp_sms.properties
Smstype = url
TargetCharacterSet = UTF-8
UrlSendType = 1
InsertUrl = https://api-sms.cloud.toast.com/sms/v2.4/appKeys/{appKey}/sender/sms
(ex. https://api-sms.cloud.toast.com/sms/v2.4/appKeys/dbsafer/sender/sms,
※ 고객사 API 운영 서버 호스트 주소 입력)
InsertHeader = Content-Type:application/json; charset=utf-8
InsertBody = { ""body"": ""%%"", ""sendNo"": ""15446859"", ""recipientList"": [ { ""recipientNo"": ""%%"" } ] }
(※ sendNo 값은 고객사에서 사용하는 sms 발신 번호 입력)
InsertBodyItem = msg, phone
(※ InsertBody 설정의 body(메시지 내용), recipientNo(수신 번호) 와 대응되는 sms 혹은 sms_alert 테이블의 컬럼명을 입력)
※ sms 혹은 sms_alert 테이블 대상으로 테이블 인코딩(UTF-8) 변경 시, DbsaferCharacterSet = 1 설정 필요
[결과값제어정책 sms 알림설정 예시]
- SMS 경고객체 생성 예시
(개행(줄바꿈) 없이 한줄로 경고 내용 기입 필요, 개행(줄바꿈) 사용 시 SMS 알림 불가)
- 결과값제어정책 생성 예시(w SMS 경고)
- SMS 알림 문자 수신성공 예시
[P.S]
- NHN SMS API v3.0 연동하려면 개발 필요합니다.
. 사유 : v2.4 대비 secret key가 도입되었고, v3.0 API 호출 시 헤더에 시크릿 키를 추가해야 성공합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5793
5792,SSH 사용자 PEM KEY 로그인 시 DBSAFER 대응,"# 기존에 ssh_key를 파일로 등록하는 것 보다는 많이 편해졌습니다.
1. 준비사항
- Manager 옵션 활성화
- 서버 모듈 시작(아래의 모듈은 PKG R22.05버전 이상에 내장되어 있습니다.)
# cd /dbsafer
# ./pnp_key_manager start
- 정책 포트 추가
# vi /dbsafer/.conf/pnp_agent.conf
# pnp_agent stop/start
2. Manager를 통한 PEM KEY등록
3. 사용자 접속관련 부분은 아래 URL 참조
https://cafe.naver.com/pnpsecure2/4869
cafe.naver.com
cafe.naver.com",댓글 없음,https://cafe.naver.com/pnpsecure2/5792
5788,[TIP] pnp_connector 사용 가이드 및 뷰테이블 연동 사례,"[개요]
- pnp_connector를 이용한 뷰테이블 생성 가이드와 이를 활용한 뷰테이블 연동 사례에 대해 공유드립니다.
* 첨부된 PDF 파일에서 확인 가능합니다.
첨부파일
pnp_connector 사용 가이드 및 VIEW 테이블 연동 사례
.pdf
null
파일 다운로드
- 고객사 신세계에서 커스텀 뷰테이블 생성 후 SIEM 솔루션(Qradar)과 연동한 결과 '이상행위 탐지' 목적으로도 활용할 수 있었습니다.
(SIEM 솔루션에서 뷰테이블의 데이터를 조회해서 관제 부서에서 알람이 발생할 수 있도록 처리했습니다.)
- 커스텀 뷰테이블 생성 시, 다양한 조건을 적용해 연동에 활용할 수 있으며 SIEM에 자체에서 조건을 설정해 이상행위로 탐지 가능합니다.
* 첨부된 엑셀 파일에서 커스텀 뷰테이블 생성 예시를 확인하실 수 있습니다.
첨부파일
[TIP] pnp_connector 커스텀 뷰테이블 생성 예시
.xlsx
null
파일 다운로드
[참고]
- SIEM 연동 시, SIEM의 뷰테이블 조회주기 설정과 조회에 따른 DB부하 발생 여부를 체크하면 좋습니다.
* 다음은 이미지는 첨부된 PDF 파일의 내용의 일부입니다.
문의사항 있으시면 언제든 연락주세요!",댓글 없음,https://cafe.naver.com/pnpsecure2/5788
5787,[TIP][pnp_ha] DBSAFER 7.0 이중화 구성 시 HA 상태 체크 추가 점검 사항,"[개요]
DBSAFER7.0 이중화 구성 시 사용하는 pnp_ha 데몬의 설정파일(pnp_ha.ini) 에 표기되지 않는 이중화 상태 체크 로직
발견 건 공유
[테스트 환경]
log1 : 192.168.101.110(Active)
log2 : 192.168.101.168(Standby)
pnp_ha 버전
[발생 현상]
DBSAFER 운영 중 pnp_ha 모듈의 상태 체크 결과가 변경되면서 VIP가 Standby로 전환됨.
Datadisk 체크서비스 상태가 ERROR로 변경되며 Standby가 Active로 변경됨
[분석 내용]
.conf/pnp_ha.conf 내 Datadisk 체크 설정은 아래와 같음
pnp_ha.ini 설정 화면 (체크할 서비스 명 및 리스트 확인)
설정파일 내 설정 정보는 각각
VIP 가 Acitve서버에 설정되어있는지
MariaDB 데이터 디렉토리가 해당 경로에 위치해 있는지
pnp_agent, pnp_log가 해당 서버에서 동작중인지
로 인지하였으며 MariaDB의 데이터 디렉토리 정보는 정상적으로 설정되어 있는데 해당 상황이 발생함.
Datadisk 체크 프로세스의 시스템 콜 분석
Datadisk 체크 프로세스 pid 확인
strace 결과 화면
시스템 콜 정보 확인 결과 경로 확인 뿐만이 아닌
파일시스템의 블록사이즈 및 갯수, 가용량 등 디스크 사용률 관련 raw data를 수집하는 것을 확인함.
따라서 디스크 사용률의 특정 임계치 이상의 도달로 인한 Active 전환으로 예상되었음.
MariaDB 데이터가 존재하는 파일시스템의 사용률 93%
사용률을 90% 이하로 조정 후 확인
정상 상태로 변경됨
따라서 Datadisk는 경로 외에 파일시스템 사용률을 체크하는 것으로 확인하였습니다.
상태 판단 기준 임계치를 조정하기 위해선 아래와 같은 설정파일 변경이 필요합니다.
.conf/pnp_ha.ini
위처럼 Datadisk_param의 경로명 뒤에 threshold 임계값을 설정한 뒤 pnp_ha 모듈을 재기동하면 적용됩니다.
임계치를 85로 조정, 모듈 재기동 후 결과값은 아래와 같습니다.
임계치 조정 후 87퍼센트 사용률에 대해서 ERROR로 표현함.
[결론]
pnp_ha.ini에 Datadisk threshold 값을 설정하지 않은 고객사의 경우 MariaDB 데이터 디렉토리가 위치한 파일시스템의 사용률이 90%가 넘을 경우 Active 전환이 발생합니다.
매뉴얼에도 threshold 설정 방법은 안내되어 있으나 사용률 체크에 대한 기능 설명은 찾지 못해 저처럼 헤메실 분들을 위해 글을 작성합니다.
물론 상황 발생 전에 기본 임계치인 90%를 초과하지 않게 디스크 정리를 진행하실 테지만
DBSAFER7.0 최초 납품 시기와 앞으로 운영할 많은 고객사를 생각했을 때 향후 몇년 뒤 해당 사항에 대한 질의가 발생할 수 있을 것이라고 생각해 공유드립니다.
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5787
5761,[TIP][IM] 계정관리 기능 중 패스워드 보기 기능 설정 TIP,"[개요]
- 계정관리 내 접속계정 패스워드를 엑셀 export를 통해 취득하는 방법 외에 UI에서 접속계정별 패스워드를 확인할 수 있는 기능 소개
돋보기 버튼을 클릭하여 otp 인증 후 패스워드를 확인하는 기능
[설정방법]
- 기본적으로 2-factor 인증 후 패스워드를 확인하도록 구성하기 위해 아래의 설정 진행
1. pnp_oms_dms.conf
AUTH_SITE=9 SSL_LISTEN_FLAG = YES SSL_LISTEN_PORT = 50015 설정
2. IM Engineer 페이지 (http://[IP]:3443/dbsaferim/engineer)
im 엔지니어페이지 > 시스템 활성화 > saferuas 사용 설정
im 엔지니어페이지 > 계정 비밀번호 > 계정 비밀번호 보기 설정
3. saferuas 설정
보안계정 별 2차인증 / 사용자선택 선택 X (IM에서 사용자 선택 기능 미제공) / 2-factor 인증 설정
4. CS Manager > 시스템 설정
보안계정 2차인증 설정
OTP 키 발급기능 사용 설정
[사용 화면]
돋보기 버튼 클릭 시 otp 입력 팝업 발생
otp 입력 후 패스워드 확인 가능
[특이사항]
- 현대제철의 요구사항[BT:23105]으로 추가되어, IM 트렁크 버전 V1.5.5.39-a 부터 기능 사용 가능합니다.
- saferuas 버전에 따른 설정 차이 존재 (아래 첨부 사진 참조)
돋보기 버튼 클릭 시 2차인증 설정 오류 팝업 출력
saferuas 버전 확인
[처리 방법]
- 테스트 결과 saferuas 버전 2.0.57 이하 버전 사용 시 CS 매니저의 정책의 2-factor인증 연동 기능 사용설정을 설정 해야 기능이 사용 가능한 현상을 발견하였습니다.
2.0.57 이하 버전의 경우 정책의 2-factor 인증 연동 기능 사용 체크 필수
[결론]
- IM 트렁크 버전 V1.5.5.39-a, saferuas V2.0.58 이상 버전 사용 필요.
- saferuas 버전이 낮을 경우 CS 매니저 '정책의 2-factor인증 연동기능 사용' 체크 필요.
결론의 내용은 saferuas 버전에 따라서 '정책의 2-factor인증 연동기능 설정' 체크 시 변경되는 데이터인
dbsafer3.variables 테이블의 mgr_manual_auth의 값이 IM 패스워드 보기 기능에 영향을 미치는 버전이 있다는 내용입니다.
saferuas V2.0.58 버전에서 아래의 결함 처리 후 정상동작 하는 것으로 보아 함께 예외처리된 것으로 확인하였습니다.
[BT:22904]
[원인]
- 2-factor 인증 시 사용여부를 판단하기 위한 값이 variables 에 없어서 2-factor 인증이 정상 동작하지 않는 현상 발생
[수정사항]
- variables 에 mgr_policy_auth_use 값이 없더라도 ifnull 을 쿼리에 추가하여 select 해오도록 수정
각 버전별 테스트 결과 패스워드 보기 기능은 해당 결함 처리의 영향으로 mgr_manual_auth 값을 예외처리한 것으로 확인되었습니다.
확인에 도움을 주신 정근희 팀장님, 강성우 사원님 감사드립니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5761
5758,[공유] C/S매니저에서 보안계정 불러오기(Excel)를 통해 정보 수정 시 주의 사항(IMUP 구축되어 있을 경우),"[이슈]
- IMUP에 사용자 계정이 중복 생성
: 사용자 계정 정보가 같은 경우 생성이 불가 하지만, 같은 정보로 계정이 생성
- 사용자 계정이 중복 생성 되면서 IMUP접속 불가 이슈 발생
[이슈 원인]
- C/S매니저에서 보안계정 불러오기(Excel)를 통해 정보 수정하면서 발생
: 보안 계정 그룹이 클릭된 상태에서 불러오기할 경우 IMUP으로 계정 생성 신호를 보내면서 중복 생성
: 보안 계정 메뉴를 클릭한 상태에서 작업 시 증상 X
##보안계정 메뉴 클릭 후 불러오기 할 경우 상태 값이 중복 객체로 표시 확인##
##보안계정 그룹 메뉴 클릭 후 불러오기 할 경우 상태 값이 빈 값으로 확인##
[이슈 증상 확인 방법]
1. C/S매니저 로그인
2. 보안 계정 리스트 내보내기 클릭
3. 보안 계정 정보 수정
- 그룹 또는 IP 정보 등등
4. 보안 계정 그룹 클릭 불러오기 버튼 클릭
5. 정보 수정한 보안 계정 클릭 및 확인
6. IMUP 웹 로그 확인 시 계정 생성 요청 로그 확인
7. IMUP > 사용자 관리 확인 시 중복 생성 확인
[조치 방안]
- DB 접속하여 생성된 중복 사용자 계정 delete 명령어를 통해 삭제 필요
: IMUP에서 삭제할 경우 C/S매니저의 보안계정까지 삭제되어 DB로 작업 필수
: C/S매니저의 보안계정이 삭제될 경우 사용자 권한을 새로 부여해야 함으로 주의 필요
[참고 사항]
- C/S매니저 버전 : Build 6531 (6486 버전에서도 동일하게 발생)",댓글 없음,https://cafe.naver.com/pnpsecure2/5758
5742,[TIP] pnp_connector ip_range 기능 추가,"[개요]
기존 pnp_connector에서는 추가할 IP주소를 각각 등록해야 하여 고객사 상황에 따라 대역으로 등록이 필요하지만 IP 범위로 등록 기능이 제외 되어 있어 불편함 존재
IP 주소 범위로 등록이 가능하도록 기능 개선이 되어 IP주소 등록 작업 시간 단축됨
[사용방법]
1. 지원 버전
- Rev 2315(Trunk) 이상 / 릴리즈 버전은 확인 필요
2. 사용 방법
- ip_range 등록 시 아래 같은 형식으로 등록
ex1) 1.1.1.*
ex2) 1.1.*.*
ex3) 1.*.*.*
ex4) *.*.*.* (ANY) 모든 IP 허용",댓글 없음,https://cafe.naver.com/pnpsecure2/5742
5740,[공유][DBSAFER 7.0 Manager] 로그 검색 조건에 객체 1개 이상 선택 불가 시 조치,"[이슈 사항]
- 로그 검색 조건에 객체 1개 이상 선택 시 최대 등록 갯수 초과 알림이 띄워 짐
- 여러 객체 선택 후 개별 등록(>), 일괄 등록(>>) 증상 동일
- Manager 2064 버전에서 해당 증상 확인하였습니다.
[이슈 원인]
- 매니저 시스템 설정 옵션(검색 조건에 객체 등록 시 최대 허용 개수)이 1개로 설정되어 있어 이슈 발생
- 옵션 설명란에 기본값 500개로 안내되어 있으나 패키지 설치 후 확인해보면 1개로 설정되어 있음
[조치 방법]
- 시스템 설정 옵션(검색 조건에 객체 등록 시 최대 허용 개수) 조정
. 기본값 500으로 조정하거나 필요한 개수를 설정
- 해당 이슈는 Bugs에 등록 및 수정 요청하였습니다.
. Bugs : https://bugs.pnpsecure.com/view.php?id=24297",댓글 없음,https://cafe.naver.com/pnpsecure2/5740
5732,[이중화] galera cluster 구성 및 장애 대응,"galera 구성 및 장애 대응 관련해서 아래의 내용입니다.
우선 장애 상황별 장애 복구 방법에 대해서 우선 아래의 URL을 통해서 확인해 주시기 바랍니다.
https://sites.google.com/pnpsecure.com/engineer-manual/%EB%A7%A4%EB%89%B4%EC%96%BC/dbsafer-v7-0-%EB%A7%A4%EB%89%B4%EC%96%BC/ha-%EC%9D%B4%EC%A4%91%ED%99%94/%EC%9E%A5%EC%95%A0-%EB%B3%B5%EA%B5%AC-%EB%B0%A9%EB%B2%95
Sign in - Google Accounts
Sign in Use your Google Account Email or phone Forgot email? Not your computer? Use a private browsing window to sign in. Learn more Next Create account Help Privacy Terms
sites.google.com
아래의 galera 복구 방법은 서버 2대 모두 Split Brain 이 발생한 상황에서의 가이드입니다.
도움이 되셨으면 합니다. 관련 내용에 대해서는 지속적으로 업데이트 할 수 있도록 하겠습니다.
[galera 구성 방법]
pnp_ha 구성 및 galera cluster 구성 방법에 대해서는 아래의 내용에 대해서 참고하시면 됩니다.
URL : https://sites.google.com/pnpsecure.com/engineer-manual/%EB%A7%A4%EB%89%B4%EC%96%BC/dbsafer-v7-0-%EB%A7%A4%EB%89%B4%EC%96%BC/ha-%EC%9D%B4%EC%A4%91%ED%99%94
아래의 내용은 연구소 정대한대리가 공유해 준 문서입니다.
매뉴얼 : https://docs.google.com/presentation/d/1fGbSrhoaP0Pk8BWqwH5qbaNSDAjOF1HN9FEU6M1OnBc/edit#slide=id.p1
[특정 DB에 대한 동기화]
1. binlog_do_db 설정값 사용
- my.cnf에 다음과 같이 항목 지정
- 위와 같이 지정할 경우 dbsafer3, mysql database에 대해서만 동기화 되고, 이외의 DB들은 동기화 대상에서 제외된다.
- 이 설정값을 master, slave 두 서버에 모두 동일하게 설정되어야 한다.
- 설정이 완료되면 mariadb를 재시작하여 설정을 반영한다.
[장애 복구 방법]
1. splitbrain 상황 복구 방법
- splitbrain이란 ?
. 두 서버 간의 데이터 sequence가 맞지 않는 상황
. 이 경우 자신이 주 노드라고 간주하게 되어 동기화가 서로 이루어지지 않는다
. ./setup_galera dbms-status 명령어로 상태값 조회 시 wsrep_incoming_addresses의 IP 목록이 1개면 splitbrain이라고 판단
- 복구 방법은?
. 정상 서버의 mysql 에러로그 확인
cat /home/dbsafer/data/mysql/{hostname}.err
(error log를 설정한 경우 설정한 파일 확인)
. 상대 서버의 연결이 끊어진 경우 관련 로그가 기록되어 있으며, 이 중 다음 두 항목을 별도로 기록해두어야 한다.
act_id : 상대 서버의 연결이 끊어진 직후의 sequence 번호
group_UUID : 현재 구성된 cluster의 UUID
. 반드시 상대 서버의 연결이 끊어진 시점의 로그를 확인해야 함
members가 1/1인지 확인 (신규 접속 시에도 동일 로그가 남으며, 이때는 2/2로 표기됨)
시간대 확인
상대 서버의 연결이 끊어진 경우 해당 로그 상단에 ‘forgetting ~~~’ 이라는 로그가 기록되어 있다.
. 정상 서버의 sequence 번호 및 UUID를 확인했다면 문제가 생긴 서버로 넘어가 galera 상태파일을 확인한다.
/home/dbsafer/data/mysql/grastate.dat
. 에러가 발생한 경우 통상 다음 2가지 유형으로 출력된다
첫번째 : 기존 동작 중이던 상태 그대로인 경우
이 경우 seqno 만 로그에서 확인한 값으로 변경 후 저장 한다.
두번째 : uuid까지 초기화된 경우
이 경우 UUID까지 로그에서 확인한 UUID, seqno 정보를 변경 후 저장 한다.
seqno만 바꾼 경우 DB 실행이 되지 않는다. (-1로 시작하라는 로그 기록)
위 상태 그대로 실핼할 경우 동기화 대상 관계없이 모든 데이터가 동기화된다.
. uuid 및 seqno가 올바르게 변경되었으면 setup_galera 에서 join을 실행한다.
# ./setup_galera dbms-start join
. 정상 실행되었으면 복구된 서버의 DB에 접속하여 데이터 동기화가 정상적으로 이루어졌는지 확인한다.
splitbrain 상태 간 테이블 생성/삭제, 데이터 insert/update/delete 사항이 모두 동기화됨을 확인한다.
감사합니다.","진선태: 감사합니다. 카카오 프로젝트에서 본 부분이 정리 안되어 혼선이 있었는데, 위 절차와 팁 도움이 될 것 같습니다. | 전지웅: DBSAFER 7.0 교육자료 제작에 많은 도움이 될 것 같습니다. 공유 감사합니다.",https://cafe.naver.com/pnpsecure2/5732
5723,[TIP] 명령어 카운팅 기능 (감사 로그 용량 감소 효과),"[개요]
- 교보생명 사이트에서 1달 평균 감사 로그 용량 평균 300GB 적재되고 있는 것을 확인 후, 로그 용량을 줄이기 위해 명령어 카운팅 기능을 사용. (적용 후, 월평균 300GB -> 20GB 로 감소)
> 특정 서비스에서 명령어 로그 개수가 한달 기준 10,000,000 ~ 20,000,000건 적재 (배치 쿼리 확인)
> 정형 쿼리에 등록하여 명령어 로깅 제외하고 싶었지만, 담당자가 반대하여 방법을 찾던 중에 명령어 카운팅 기능을 테스트하여 적용
[권장]
- 불필요하고 반복되는 다량의 쿼리가 발생하나 명령어 로그 제외없이 남기고 싶을 때 사용 권장 (ex. 배치 쿼리)
[기능설명]
- 명령어 카운팅
> 일정 시간 동안 반복되는 명령어 로그를 1개로 저장하는 기능.
> 예시) select * from member; 쿼리가 10초 동안 144번 수행되면 명령어 로그 상 명령어 개수에 144개로 명시하고 실제 명령어 로그는 1개만 적재됨.
<사진1-1, 명령어 카운팅 O 명령어 로그 조회 화면>
<사진1-2, 명령어 카운팅 X 명령어 로그 조회 화면>
[주의사항]
※ log bridge 모듈 필수 사용
※ 명령어의 해쉬 값으로 체크하여 카운팅 (로그 유실 주의)
> insert into members values('김순재', 'M', '010-1234-1234', '901021') 와
insert into members values('변태환', 'M', '010-1321-1321', '111111') 은 동일한 쿼리로 판단.
<사진2-1, 명령어 샘플 (값만 다른 형태)>
<사진2-2, 명령어 카운팅 기능 O (동일한 쿼리로 판단)>
<사진2-3, 명령어 카운팅 기능 X>
[설정방법]
- pnp_log_bridge 필수 가동
> pnp_log_bridge 모듈이 동작 중이여야 기능 사용 가능.
- 명령어 카운팅 적용 시간 설정 (변경 후 모듈 재시작 필요)
> vi /dbsafer/.conf/pnp_log_bridge.conf
# The time of updating count. Default: 10 seconds.
#querycount_update_term=10
- 매니저 시스템 설정 기능 활성화
> Ctrl + Shift + F8 ""시스템 설정"" > ""로그 조회 설정"" > ""명령어 카운팅 사용"" 기능 사용 체크
<사진 3-1, 매니저 시스템 설정 변경>
- 권한제어정책 설정
> 보안정책설정 > DBMS > 권한제어정책 > 명령어 카운팅 체크 시, 적용 가능.
<사진 3-2, 권한제어정책 설정>
[버전]
- pnp_log : Rev 697
- pnp_log_bridge : Rev 149
※ 위 모듈 보다 하위 버전 사용 시, 명령어 길이 1.2KB 이상 쿼리를 수행 시에 명령어 카운팅 동작하지 않음.",윤진하: - 관련된 메뉴얼이나 자료가 부족하다 생각하고 있었는데 정리 고마워요~,https://cafe.naver.com/pnpsecure2/5723
5719,[공유][NHN] 특정 서비스가 실행되지 않고 starting 상태에서 정상 가동되지 않는 이슈 공유,"안녕하세요, 교육지원파트 윤효정입니다.
매니저에서 서비스를 실행하였으나 서비스가 '실행 ▶'되지 않고 'starting'상태에서 정상 동작하지 않는 이슈에 대해 공유드립니다.
[이슈증상]
- 특정 서비스가 가동되지 않으며 지속적으로 starting 상태로 유지 (*나머지 mysql 서비스 및 다른 서비스는 정상적으로 run 상태)
- 서비스 시작 및 삭제를 해도 동일하게 starting 상태로 지속됨
[그림1] 이슈증상: mysql 2개 서비스 상태가 starting으로 지속됨
[확인내용]
(1) 서비스 동작 순서에 따라 순차적으로 관련 모듈 로그 확인
* 서비스 동작 순서: pnp_agent → pnp_slave → pnp_launcher → 서비스 모듈
- pnp_agent 모듈 로그 확인: 특이사항 없음
- pnp_slave 모듈 로그 확인: 특이사항 없음
- pnp_launcher 모듈 로그 확인: 특이사항 없음
- pnp_mysql 모듈 로그 확인: ""failed bind port"" 에러 로그 존재 (하단 사진 참고)
[그림2] pnp_mysql 서비스 모듈 에러 로그 ""faild to bind""
(2) 서비스 모듈 에러로그에 따라 이미 점유된 포트가 있는지 확인(netstat)
- starting 서비스인 4983, 4984 포트에 대해서 이미 점유한 프로세스가 있는지 확인(netstat)
- 특이사항: 해당 프로세스는 pnp_mysql 이 아닌 pnp_cubrid 서비스 모듈이 Listen함
.Enterprise Manager 확인 시, 4983, 4984를 점유하고 있는 cubrid 서비스는 없으나
GW 서버의 프로세스 상에는 pnp_cubrid 서비스 모듈이 4983, 4984 포트로 LISTEN 하고 있는 상황
즉 매니저에서는 mysql:4983, 4984 포트로 서비스를 가동하려고 하나, 실제 서버에서는 cubrid 서비스가 이미 해당 포트를 점유하고 있어 포트 중복으로 서비스 가동이 안되는 상황 발생
[추가확인사항 및 이슈원인 추정]
- 고객사 환경은 정책연동 모듈(dbsafer_imlinkage)을 통해 서비스 객체 동기화 진행
* 만약 원장 DB에서 서비스를 삭제하면, 아래와 같은 절차로 서비스가 삭제가 진행됨
① 해당 서비스 중지 요청 (./pnp_agent service-shutdown ##)
② 서비스 객체를 삭제
[그림3] Enterprise Manager - 로그조회 - 시스템로그 확인(정책연동모듈)
- Enterprise Manager - 로그조회 - 시스템로그 확인 시, DBSAFER_IMLINKAGE 모듈이 서비스정보를 동기화 완료하였으며, 기존 서비스 2건에 대해 삭제 동작이 정상적으로 완료되었다는 로그 조회 가능
그러나 해당 이슈는 ① 서비스가 제대로 중지되지 않은 상태에서 그 다음 단계인 ② 서비스 객체를 삭제하여 발생된 것입니다.
결과적으로 해당 서비스 프로세스 제대로 ""종료""되었는지 확인하지 않아 서비스 생성시 포트가 중복되어 발생된 것으로 추정
[이슈원인]
- pnp_agent 대상 서비스 시작/중지 요청 시, 서비스 시작/중지 정상 처리 여부를 확인하지 않아 이슈 발생
- 서비스 중지 요청은 성공했으나, 서비스 중지가 정상적으로 처리되지 않은 상태에서 서비스 객체가 삭제됨
.원장DB에서 DBSAFER의 psync DB로 서비스 객체 동기화를 진행하지만 해당 프로세스에 대한 destoryed가 제대로 되지 않은 것으로 추정
[그림4] dbasfer3.service_history table 확인
- 2022년 12월 8일 11시 50분 01초에 삭제할 cubrid 서비스에 대해서 destroy 하였지만, 실제로 프로세스는 destroy 되지 않음
- 해당 시각에 pnp_cubrid 모듈 로그에는 에러로그가 없었으며, imlinkage 모듈 로그는 확인 불가한 상황
[조치내역]
- mysql 서비스를 대신하여 Listen 중인 cubrid 서비스(2건)에 대해서 프로세스 확인 후 (ps -ef) 프로세스 kill -9 pid(부모,자식)
- starting 상태인 mysql 서비스 정지 후 재가동 (정상 동작 확인)
[향후일정]
- 서비스가 삭제되었을 때, 정상적으로 프로세스까지 삭제할 수 있도록 정책연동모듈 수정 요청 (1/31)
- 정책연동모듈 수정 완료(2/1)
* BUGS url :https://bugs.pnpsecure.com/view.php?id=24122
- 담당자와 일정 협의 후 해당 모듈 패치 진행 예정
이상입니다.
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5719
5714,"[공유] DBSAFER Enterprise Manager (V5.0, V7.0) 관리자 로그 상세 내용 조회 시 로그 내용 편집 가능 한 이슈","DBSAFER Enterprise Manager 관리자 로그 조회 시 내용 편집 가능한 이슈 내용 및 수정 내용 공유 드립니다.
[결론]
매니저 최신 버전에서 수정 완료
V5.0 - Enterprise Manager 6526 이상
V7.0 - Enterprise Manager_7 2034 이상
[이슈 내용]
- DBSAFER Enterprise Manager 프로그램에서 로그 조회 - 관리자 로그 조회 후 로그 더블클릭을 통한 상세 로그 조회 화면에서 로그 내용 편집 가능한 이슈 (V 5.0 , V7.0 동일)
- 로그 내용 편집 및 Drag & Drop 가능하지만 내용이 저장되지는 않음
- 관리자 로그 조회 메뉴에서만 발생된 이슈였으며 내용 편집 및 Drag & Drop 불가능 하도록 이슈 수정 완료 됨
DBSAFER V5.0
DBSAFER V7.0",댓글 없음,https://cafe.naver.com/pnpsecure2/5714
5709,[TIP] SQL 유형 표기법 (16진수),"SQL 유형은 ""object_privilege"" 값을 16 진수로 처리하여 자리수별로 값에 대한 매칭 값으로 유형을 정의하고 있습니다.
DB 데이터 값을 볼 때 10진수로 표기되는 것을 16진수로 변경을 하여 구분 되는 SQL 유형을 지정 할 수 있습니다.
SQL 유형별 16진수를 아래와 같이 공유합니다.
[SQL 유형 16 진수]
구분
10진
16진
Select
2
0x2
Delete
4
0x4
Drop
8
0x8
Insert
16
0x10
Alter
32
0x20
Create
64
0x40
Grant
128
0x80
Revoke
256
0x100
Update
512
0x200
Audit
1024
0x400
Comment
2048
0x800
Execute
4096
0x1000
Index
8192
0x2000
Lock
16384
0x4000
Rename
32768
0x8000
Connect
65536
0x10000
Synonym
131072
0x20000
Database_Link
262144
0x40000
Begin
524288
0x80000
Truncate
1048576
0x100000
Commit
33554432
0x2000000
Rollback
67108864
0x4000000
Merge_Into
134217728
0x8000000",댓글 없음,https://cafe.naver.com/pnpsecure2/5709
5703,[공유] pnp_aws_service 모듈 사용 시 주의사항 (SSH 기본포트(22)를 사용하지 않는 경우),"고객사 PoC 진행 중 확인한 사항으로 내용 공유드립니다.
[결론]
- SSH 기본포트를 사용하지 않는 경우 pnp_aws_service 1.15 모듈을 사용해야 합니다.
. pnp_aws_service 1.14 버전에서 기본포트가 아닌 경우에도 서비스 동기화 및 ssh_server.lst 파일에 IP:Port 정보가 등록되나, 서비스 실행 이후 ssh_server.lst 파일에 내용이 반영되어 로그가 정상적으로 기록되지 않음
[이슈]
- pnp_aws_service 모듈을 사용하여 EC2 인스턴스 동기화 시 로그가 암호화된 내용으로 기록 됨
- 고객사에서 SSH 포트를 40022로 사용하고 있었으며, 인스턴스 동기화 후 서비스 실행 시 ssh_server.lst 파일에 IP:Port 정보가 등록되지 않음을 확인 함
- 최초 pnp_aws_service 1.13 모듈 사용하였으며, pnp_aws_service 1.14 버전으로 패치 진행 함
- pnp_aws_service 1.14 모듈에서는 ssh_server.lst 파일에 IP:Port 정보가 등록되나 서비스 실행 이후 반영되어 서비스 재실행이 필요 함
pnp_aws_service 1.14 이하 모듈 사용 시
[조치 사항]
- pnp_aws_service 1.15 버전으로 패치
- 기본 포트 미사용 서비스 관리 기능은 pnp_agent Rev 942 이상 버전에서 지원 (LOG/GW 분리 구성의 경우, pnp_slave Rev.125 이상 버전 필요)",댓글 없음,https://cafe.naver.com/pnpsecure2/5703
5690,[공유] passphrase 설정된 pem키 사용 시 SSH 서버 접속불가,"고객사 PoC 진행 중 확인한 사항으로 내용 공유드립니다.
[결론]
- 현재 passphrase 설정된 pem키는 DBSAFER에서 지원하지 않습니다.
. DBSAFER를 통해 접속이 필요한 경우 passphrase 미설정된 pem키를 사용해야 합니다.
- passphrase 사용 환경은 현재 개발 지원 계획이 없습니다.
. 기능은 필요하나 사이트에서 사용되는 빈도가 적은 편이며, 다수의 모듈 통합 테스트가 필요한 부분으로 기능 개발에 대해서는 보류 의견을 받았습니다.
[이슈]
- passphrase 설정된 pem키 사용 시 DBSAFER를 통한 SSH 접속이 불가 함
. passphrase 설정 시 pem키는 암호화 되며, 사용하기 위해 passphrase를 입력하여 복호화가 필요하나 DBSAFER에 해당 기능이 구현되어 있지 않습니다.
- passphrase 설정된 pem키 예시
. pem키 첫 문구를 통해 암호화 되어 있음을 확인할 수 있습니다.
-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: DES-EDE3-CBC,864B98DAA24CFAE5
kSDh5K+ZGWo/JuIh4iThxpOLfKgD32pNxCwGGCYcpuLWQwNzMO10CONm6AYQjuzT
+hqJXHzrXeoH0XltvE0UvFSyKasOqbW2r1BBpdhP17t3egh7dmOKUWDGiw9NZ4Wq
/O6WweaflbpkmUGeElEi/Xc+mfdYztIDg/PsQXeT+6bH+g7SVKz1X8qbOJVNRttg
D/0bYl9rYKVpqIiIY/XJ+XqLTGQm8gsLaEZSy+gVQdkFYn1WygINyoKlxEz6JpML
j7b1etnL7y8G7I0NryILrKF9aoNX1RX+c4vDkP9bZBZjbmvN1VZfP0vicOhMLAky
MiUTaX4Prb1uOs7fnW2+Xz8f0SeNbrlYD5/eINe6vcemk6A4aKRSfQFmFE8YKYPJ
Te4BOhFP8oBousQ0qD9dL9Fw0MP6jdMKEfz0WMYTtWMqUsadmpOVim05hvcVvPHX
YTWr9MGJiPSrWs4LRU+a5hSmMLTYiX4OiQq6KM/551lAYTMIi6E76dcl6R3jgYI8
EC8qDKweUWkA1DM3Iz7Pxbo/mH6RL3DyK7hNnWYm0m7xOTaEzRg/QidwWuJxVf8u
5DZ545wxk6++F2Bby6Ufs4xOLQwdVnP/1oq64U48svZbzPRwrkSEqImxEeekYSjl
RFZJmDfA+vZ8L4bTnBF1LOdZiyFiK+dag4Pe6PycMrLSQCtaX+BxLBCXN/wFKawi
ik2gmU4TOjp3GtLt0hIeyTOGzi9B58/HKqWHHIXdi6VEwtpX0exg6BT+TBwWpC6o
vojKKbwxcxVkFBVQrvozI5a8i3gBvo2UBkJp2sZ5Dtqk/gg3nFidrh7lAbFHixAK
cWLTQeUkBDQBXfKss4cOdUpF5wk7asHI+inrlCiVc9zjlj4N/hL5VmW7870Dfbju
wT5Rpln4kVb7wO3vd/FhYD59p549gSpk8IlZwDJygdVmEW4/nw5gzPAVU+Qlk10I
6UMAuHJe5iMMcgz2vDRPfGiYBhxJc/3mVjjnTyoCrmFuiguFpoRocIvWMIA0En7f
wLCfXdnKOemuL2gUBx39j7AiptgbY3/SrNi2fo86lbpN0uGmKwohT37CMndY5abQ
l7jrYFGdYbDN+dAs8gwBUDcU1uEsON4NokxFqJUuZTRZRQ8U7jA03c1sfh/VHtXJ
ahfV7fqxMasQWpRYyzJydR9lCtnKwIXLknEOwHzIOJU0lac5ajzoxHB5R4oNSadc
RKJkilZpjl67y8TtXdIe3d/zzDhDeA5abonofYexgvS3D4Pk15B3bes3gWNtVyZO
tA2iO4liHgCp77TiX0sGQbmgmSkkjw5djqcxYTYKxvTAOasRiCU9yUi/ZxaJeWBP
3dt6mhkzwf+f3Jy049XSNE0EdzdtwEU7CzdUZESNGGv3oYSjlWhWYcu4KSJbbiVS
Z035nIx1yV7JPTSOb0BoKdCy5k4eLJav9xZc/30Vr+B7JwfrrML3a4nAG8zcRMT6
BjYwOEABRSofa3luPYul558dqQ6bPWWlrDOTg+sGlrIEhjRmd6CahJ8OEBcRCpae
Vm71PmMm62cI/vGr1UyMY1gawjb0/YmWCU7+4YHx80SJ5LVg5SzPXQ==
-----END RSA PRIVATE KEY-----
[조치 방법]
- passphrase 미설정된 pem키 사용
. 고객사에 passphrase 설정되지 않은 pem키를 사용하도록 가이드가 필요합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5690
5688,[공유] 하나카드 DBSAFER 기존 MOTP 인증 방식에서 변경된 내용 공유,"1. 요약
: 기존 하나카드는 하나의 DBSAFER 서버에서 운영/개발 계정을 구분하여, 운영/개발을 같이 사용 중
: 이에 따라 MOTP 인증 서버(HIWARE OTP)를 운영/개발 계정 구분자에 따라 인증서버 구분을 함
: 이번 업그레이드 사업에서 운영, 개발 서버가 따로 나뉘어져 MOTP 인증 서버를 각각 설정하는 방식으로 변경
2. 상세
1) 기존 하나카드에 적용되어 있는 MOTP 설정 환경
version : 2.0.15.3H J11
* 하나카드의 계정 생성 규칙은 아래와 같습니다.
1-1. 97로 시작하는 사번은 운영/개발 계정 2개 생성
: 970000 으로 계정생성 요청 시, 970000 과 970000_sbc 계정을 생성함 ( _sbc 계정이 운영계정 )
1-2. 96으로 시작하는 사번은 개발 계정 1개 생성
: 960000 으로 계정생성 요청 시, 960000 계정을 생성함
1-3. 그 외 사번은 개발 계정 1개 생성
: 200000 으로 계정생성 요청 시, 200000 계정을 생성함
2) 옵션 설정
/home/webapps/saferuas/config/config.properties 파일의 ID.SEPERATION 옵션에 '_' 구분자를 넣어 운영/개발 계정별로 요청하는 HIWARE OTP 인증 서버 URL을 구분합니다.
보안계정에 '_' 구분자가 들어가있으면 운영 URL 1,2 로 요청을 하고 없을 경우에는 개발 URL로 요청을 합니다.
3) 업그레이드 사업으로 인해 변경된 점
3-1. 운영/개발망에 각각의 DBSAFER를 운영하는 방식으로 변경되어 보안계정을 구분할 필요가 없어짐
: 기존에 운영계정은 ""사번_sbc"" 규칙으로 사용하고 있었는데, 이번 사업에서 ""사번"" 계정으로 변경
3-2. 운영/개발이 구분됨에 따라 saferuas 에서 ID.SEPERATION 옵션을 사용하지 않아도 됨
: UI 상의 인증서버 경로 입력창도 3개에서 2개로 축소 ( 일반 URL 1,2 )
version : 2.0.15.4H J11
3. 잔여 이슈
saferuas_2.0.15.4H J11 패키지로 MOTP(HIWARE OTP) 인증은 정상적으로 진행되었으나, engineer 페이지에서 ""인증 테스트"" 시에 communication error 발생
: 연구소 문의 결과, 엔지니어 페이지의 ""인증 테스트 로직:과 실제 ""인증 로직""이 다를 수 있음
: 하지만 이번 패키지 수정에서는 실제 ""인증 로직""만 수정한 것으로 추후 패스워드 초기화 기능 개발 건에 수정될 예정",댓글 없음,https://cafe.naver.com/pnpsecure2/5688
5676,[공유] Amazon DocumentDB 접속 시 로그인 실패 세션이 기록되는 경우 조치 방법,"고객사 PoC 진행 중 확인한 사항으로 내용 공유드립니다.
[결론]
- 모듈 패치 필요
[이슈]
- Studio 3T 툴을 사용하여 DocumentDB 접속 시 정상 접속되나 일부 세션이 '로그인 실패'로 로깅 됨
. 서비스 모니터링에서는 정상 접속으로 확인되는데 로그 조회에서는 로그인 실패 로깅되어 있었음
. 클러스터 엔드포인트, 리드 엔드포인트 현상 동일
DBSAFER Manager 세션 로그
[상세정보]
- DBSAFER 구성
. AWS에 단독구성으로 설치
- Amazon DocumentDB 구성
. 엔진 버전 : 4.0.0
. 클러스터로 구성 (기본 인스턴스1개, 복제 인스턴스 1개)
[조치방법]
- 관련 Bugs : https://bugs.pnpsecure.com/view.php?id=23591
. 유사 이슈로 서비스 모듈이 수정된 이력이 있음으로 확인
. MongoDB 접속 시 ID/PW 인증이 아닌 인증 없음(None) 모드 사용하여 errmsg를 보고 로그인 실패 처리된 이슈
- pnp_mongodb 모듈 패치
. COMMON LIBRARY VERSION: 3639 이상 버전으로 패치하시면 됩니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5676
5670,"[TIP] API 제공을 통한 정책, 객체 연동 방법","[개요]
- 최근 고객사에서는 고도화 사업을 통해 자사 시스템과 연동을 원하는 고객사들이 많아지고 있습니다. 이를 대응하기 위해 DBSAFER v5.0 기준으로 RestfulAPI를 제공하여 부분 연동이 가능할 수 있도록 개발이 되었습니다.
[Restful API 제공범위]
- 현재는 사용자 관리, 서비스 관리, 정책 관리, 객체 관리 API 가지 정도의 API만 제공
.DBSAFERv7.0은 미지원
[Restful API 모듈 위치]
https://bbs.pnpsecure.com/showthread.php?tid=11473
PNPSECURE's BBS
PNPSECURE's BBS You are either not logged in or do not have permission to view this page. This could be because one of the following reasons: You are not logged in or registered. Please use the form at the bottom of this page to login. You do not have permission to access this page. Are you trying t...
bbs.pnpsecure.com
[연동정책검사 모듈]
https://bbs.pnpsecure.com/showthread.php?tid=11487
PNPSECURE's BBS
PNPSECURE's BBS You are either not logged in or do not have permission to view this page. This could be because one of the following reasons: You are not logged in or registered. Please use the form at the bottom of this page to login. You do not have permission to access this page. Are you trying t...
bbs.pnpsecure.com",댓글 없음,https://cafe.naver.com/pnpsecure2/5670
5668,[TIP] PCAGENT RDP로깅시 명령어 로깅 제외 방법,"1. 개요
- PCAGENT를 통해 RDP로깅 사용시 키보드+마우스 이벤트 발생시 모든 이벤트를 기록할 수 기능을 제공 하고 있습니다.
다만 사용자가 입력하는 ID, 비밀번호 등 중요한 값에 대해서 로깅이 되기 때문에 DBSAFER Manager를 통해 로그인하여 감사로그 조회가 가능한 관리자들은 사용자들마다 입력한 정보를 확인 할 수 있는 이슈가 발생이 됩니다.
2. 조치 방법
[지원버전]
- Manager : Enteprise Manager 5.0.9.4 ALPHA (Build - 6360 이상
.시스템설정 -> 로그 조회 설정 -> RDP 세션 재현 시 명령어 미출력 옵션 체크
- pnp_telnet 버전 :Trunk 버전에만 반영 Rev 2199
- pnp_telnet.conf 옵션
. ServerAgent에서도 PCAGENT RDP로깅 기능처럼 명령어 로깅제외하는 기능이 필요할 경우 추가 개발이 필요합니다.
- RDP 서비스 객체 대해서 권한제어정책에 명령어 로깅이 안 되도록 정책 추가
- RDP 로깅 테스트시 명령어 수행 갯수는 1건에 대해서만 표시되며 해당 세션에 대해 세션재현시 WTA 화면 상단에 명령어 로깅 실제 개수가 표시됨",댓글 없음,https://cafe.naver.com/pnpsecure2/5668
5667,[TIP] rockylinux8.x & Redha8.x BONDING 구성 시 설정 주의 사항,"1. NetworkManager 란?
RHEL 및 CentOS 8에서 네트워킹 서비스는 NetworkManager 데몬에 의해 관리되며 네트워크 장치를 동적으로 구성 및 제어하고 사용 가능할 때 연결을 유지하고 활성화하는 데 사용됩니다.
NetworkManager는 명령 줄 인터페이스와 그래픽 사용자 인터페이스 도구를 모두 사용하여 손쉬운 네트워크 설정 및 관리를 지원하고, D-Bus를 통해 API를 제공하여 네트워크 구성을 쿼리하고 제어하고 구성 유연성을 지원하는 등 다양한 이점을 제공합니다.
2. NetworkManager 는 필수로 실행이 되어야 합니다.
- 상태확인 : systemctl status NetworManager
- 실행 : systemctl start NetworkManager
- 중지 : systemctl stop NetworkManager
- 활성/비활성화 : systmctl enable NetworkManager / systmctl disable NetworkManager
[NetworkManager 상태]
3. ifcfg-bond0 설정시 아래 옵션 추가
- BONDING_OPTS=""mode=active-backup downdelay=0 miimon=100 updelay=0""
TYPE=Bond
BONDING_MASTER=yes
*위의 옵션을 추가 하지 않을 경우 bonding구성이 풀리거나 서버 재부팅시 인터페이스가 올라오지 않습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5667
5660,"saferuas에서 사용자 2차인증을 ""사용자 선택""으로 설정하면, 매니저에서 설정한 보안계정별 2차인증방식이 미적용되는 이슈","[고객사]
한국은행 / 정보계 DB접근제어 윈백
[배경]
고객사에서 사용자 2차인증 방식으로 Google OTP, SMS중 하나를 사용자가 선택해서 인증을 진행할 수 있으며, 2차인증 적용여부를 Enterprise Manager에서 설정 가능하도록 희망
[이슈]
1. saferuas 엔지니어 페이지에서 사용자 2차인증을 ""보안계정 별 2차인증""으로 설정하면, 매니자 보안계정 메뉴에서 2차인증 방식을 사용자 선택으로 설정한 계정으로 PC Assist 로그인 시도시 2차인증 미발생
2. saferuas 엔지니어 페이지에서 사용자 2차인증을 ""사용자 선택""으로 설정하면, 매니저 보안계정 메뉴에서 각 보안계정별로 2차인증 방식을 SMS, OTP, 사용자 선택 중 어떤 것으로 선택하더라도 무조건 사용자 선택으로 인증 발생
3. 1번 이슈에 대해서는 고객에서 수용했으나, 2번 이슈와 관련하여 2차인증 방식을 미사용으로 설정해도 사용자 선택으로 인증 발생하는 부분에 대해서 고객에서 수정 요청을 하여, 내부 확인 진행
[문의 및 테스트]
- 1차 QA 문의 : 과거 메리츠캐피탈에서 동일한 이슈에 대한 개발요청(BT:21531)이 있었던 것으로 확인되나, 한국은행에 적용한 최신버전(saferuas 2.0.65.0-Build 2173)에서 위와 같이 동작하여 QA에 확인 요청
- 1차 문의 이후 사내테스트 : BT:21531를 통해 개발된 버전인 saferuas 2.0.50.1-Build 2049 버전으로 테스트 진행
① 테스트 결과 해당 버전에서는 saferuas 엔지니어 페이지에서 사용자 2차인증을 ""보안계정 별 2차인증""과 ""사용자 선택""을 동시에 체크할 수 있음.
② 위와 같이 동시에 체크하면, dbsafer3.auth_env 테이블에서 사용자 2차인증과 관련된 행 값이 아래와 같이 설정됨
③ 이렇게 설정하면 매니저 보안계정별 2차인증방식을 OTP, SMS, 사용자 선택으로 설정한 내용들에 대해서 모두 설정한대로 정상적으로 인증이 발생하며, 미사용인 경우에도 정상적으로 인증 미발생.
④ 이후 다시 최신버전(saferuas 2.0.65.0-Build 2173)으로 교체 후, dbsafer3.auth_env 테이블 값 유지한 채로 테스트 및 정상 동작 확인
⑤ 하지만 최신버전에서는 엔지니어 페이지에서 사용자 2차인증을 ""보안계정 별 2차인증""과 ""사용자 선택""을 동시에 선택할 수 없음.
- 2차 QA 문의 : 사내에서 테스트한 동작이 정상동작인지 여부와, 정상동작이라면 사용자 2차인증 다중선택 기능이 최신버전에는 머지가 되지 않은 이유에 대해서 확인 요청(진행 중)
[조치]
1. 고객에 본 이슈와 관련하여 확인된 내용 및 DB 수동 작업 필요성 전달(12.9)하여 12.12(월) 방문 후 작업 및 테스트 예정
2. 2차 문의에 대한 내용이 확인되면 고객사에 위 기능 적용된 최신 버전으로 재적용 예정
이슈 확인에 도움주신 이임재 대리님, 김하림 사원님, 안형철 대리님께 감사드립니다.","김하림: 안녕하세요 기반검증팀 김하림입니다.
위 이슈 수정 확인 완료되었습니다. BBS에 수정 버전 업로드 되었으니 참고 바랍니다.

Bugs > https://bugs.pnpsecure.com/view.php?id=24025
Version > 2.0.66.1 Build-2177
BBS URL > https://bbs.pnpsecure.com/showthread.php?tid=12170",https://cafe.naver.com/pnpsecure2/5660
5652,DBSAFER 7.0에서 Windows서버 RDP 일반접속 / 로깅 동작 문의,"[이슈]
Windows 대상서버에 Server Agent 미설치 / PC ASSIST RDP로깅 둘 다 사용하지 않는 경우,
서비스 일반접속 시 세션로그 미로깅 및 접속 통제 불가 현상
[문의]
- 단순 세션 접속 로그 미로깅/미통제 동작이 7.0에서는 정상동작인지 문의
(5.0에서는 로깅/통제 정상)
[테스트 상세]
[답변]
- telnet_gateway 사용 환경에서는 RDP 서비스 통제를 위해 PC Assist 또는 Server Agent를 사용해야 함
- 기존 telnet 구성과는 달리 telnet_gateway에서는 정책을 telnet으로부터 전달받고 SA로부터 받은 세션 정보 또는 PC Assist 정보를 함께 수집하여 차단 동작을 수행함
- 따라서 PC Assist 또는 SA를 통해 정책 차단 근거를 수집할 수 있어야 함",댓글 없음,https://cafe.naver.com/pnpsecure2/5652
5650,MongoDB DEICDE 명령어 유형 선결재 정책을 타지 않는 현상,"[이슈]
- MongoDB DECIDE 명령어 유형 기안/결재 후에도 선결재 정책을 타지 않는 현상
[고객사 환경]
- 윙잇 (MongoDB Atlas 사용)
- DBSAFER 단독구성 (AWS)
- MongoDB Compass 툴 사용
- 버전정보 : PKG_DBSAFER5_R22.05R2-CentOS7_x86_64_P9.11_2F 릴리즈 패키지 내 서비스 모듈 사용 (pnp_mongodb Rev v2195)
- 비정형화 명령어 기안을 사용하고자 했으나, Cluster된 대상서버의 경우 기안 요청한 쿼리와 실행 쿼리의 clustertime이 달라 선결재 정책을 타지 않아 명령어 유형 기안으로 사용하고자 함
[문의사항]
- MongoDB DECIDE 명령어 유형 기안 / 결재 후에도 선결재 정책을 타지 않는 현상 확인 요청
- SQL 유형 : SELECT를 포함한 DML유형
- 테스트 명령어 : find, aggregate, insert등
[답변]
- pnp_mongodb 최신버전 패치 필요
[조치]
- 최신버전 Rev v2265 패치 후 정상 작동 확인
[개선버전]
- COMMON LIBRARY VERSION : 3584이상 (https://bugs.pnpsecure.com/view.php?id=22961 참고)",댓글 없음,https://cafe.naver.com/pnpsecure2/5650
5648,[TIP] 결재시스템 사용자 구분 기능 활성화 방법 공유,"[개요]
- 결재시스템 기안 신청 시, 특정 사용자들이 특정 DBMS에 대해 신청할 수 없도록(결재시스템 기안 신청 화면에 해당 서비스가 보이지 않도록) 설정 요청에 의해 해당 기능을 확인하였습니다.
- 요청 고객사 : 쿠팡
[활성화 방법 요약]
1. 결재시스템 엔지니어 페이지 > 기타설정 > 사용자구분 > 사용 v 활성화
2. 결재시스템 > 관리자 > 환경설정 > 서비스 > 서비스 검색방법 : 사용자구분별 사용 가능한 서비스 v 활성화
3. MANAGER > 시스템 설정 > 보안계정 사용자 구분 사용 v 활성화
4. MANAGER > 보안계정 > 사용자 구분 > 설정 추가
5. 결재시스템 > 관리자 > 서비스설정 탭에서 설정
6. 또한 MANAGER > 보안계정에서 각 사용자에 대한 사용자 구분도 설정
[활성화 방법 상세]
1. 결재시스템 엔지니어 페이지 > 기타설정 > 사용자구분 > 사용 체크 v
2. 결재시스템 > 관리자 > 환경설정 > 서비스 > 서비스 검색방법 : 사용자구분별 사용 가능한 서비스 체크 v
- 관리 권한을 가진 사용자로 로그인하여야 합니다.
3. MANAGER > 시스템 설정 > 보안계정 사용자 구분 사용 체크 v
4. MANAGER > 보안계정 > 사용자 구분 > 설정 추가
5. 결재시스템 > 관리자 > 서비스설정 탭에서 설정
6. 또한 MANAGER > 보안계정에서 각 사용자에 대한 사용자 구분도 설정해주셔야 합니다.
[적용결과]
- 해당 사용자의 권한이 없는 DBMS 중 사용자 구분에서 설정한 서비스만 기안 신청할 수 있도록 확인 가능합니다.
[관련 벅스]
- 사용자 구분 기능 사용 중 서비스 설정에서 그룹 이 외의 서비스 개별 선택 불가 현상 (수정 중)
- 벅스 : https://bugs.pnpsecure.com/view.php?id=23658",댓글 없음,https://cafe.naver.com/pnpsecure2/5648
5647,[TIP] [pnp_connector] 접﻿속 IP 수가 많은 경우 등록 방법,"안녕하세요. 클라우드기술팀 김영은입니다.
'pnp_connector 접속 IP 수가 많은 경우 등록 방법'에 대해 공유드립니다.
[요약]
- 현재 connector 모듈에서는 ip 대역으로 등록하는 기능이 지원되지 않음.
- 수동 입력이 많아 add_ip로 등록하는 것이 어려울 경우, ip리스트를 만들어 스크립트로 등록할 수 있음.
[스크립트 설명]
#! /bin/bash
# pnp_connector 관리자 모드 로그인
./pnp_connector hidden << EOF
dbsaferadmin
(발급받은 gencodekey 입력)
# 접속 IP 등록
add_ip
(접속 계정 입력)
(IP 리스트 입력)
end
# 접속 IP 목록 조회
show_ip
(접속 계정 입력)
exit
EOF
[예시]
도움을 주신 최재규 사원님 감사합니다!",댓글 없음,https://cafe.naver.com/pnpsecure2/5647
5635,[TIP] 웹 접근제어 (TP모듈) 적용 방법,"[고객사]
- 한국평가데이터
[요구사항]
- 웹 접근 시 접근제어를 통한 허용/차단 기능요구
[지원버전]
# ./pnp_agent
AGENT Release Version 3.0 for RelTBINC-CentOS7 (Rev1117) [Apr 25 2022] !!
MAIN VERSION 3.7 UPDATE 48 (20150812) - POLICY:105(4856), LOG:103, FORMAL_QUERY:1101
SHARED INTERFACE VERSION: 508
# ./pnp_extransparent
TRANSPARENT POLICY RELEASE VERSION 1.0.0 for RelTBINC-CentOS7
MAIN VERSION 3.7 (20150812)(Rev: v2155)
COMMON LIBRARY VERSION: 3545
COMMON POLICY MODULE VERSION: 1.2.19
COMMON FORMAL_QUERY MODULE VERSION: 1.1.0.1
SHARED INTERFACE VERSION: 508
Pol/Log Build: POLICY-(105) LOG-(107)
The latest update of the binary: Apr 25 2022
[적용방법]
1. pnp_agent 패치
2. pnp_extransparent 모듈 /dbsafer 디렉토리로 Move (모듈은 별도로 실행하지 않음)
( * 분리구성일 경우 GW 서버에 pnp_extransparent 모듈이 존재해야 함)
3. Enterprise Management 설정
1) 엔지니어 설정
2) 서비스 추가
서비스 가동 후 GW 서버에서
# ps -ef | grep pnp_extransparent 프로세스가 떠 있는지 확인
3) 접속제어 정책 추가 후 로깅화면
※ TP 모듈의 경우 SYN 패킷 기준으로 로깅을 하기 때문에 웹 접속 시 다수의 로그가 쌓임
(해당 부분은 제약사항으로 알고 있고, 테스트가 더 필요합니다.)
[차단화면]
- 브라우저 실행 -> https://IP:3443/... 웹 페이지 접근 시 차단 팝업 발생 후 웹 연결되지 않음
유선으로 조언 해주신 정우성 대리님 감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5635
5630,[TIP] Centos 7.x 싱글모드 가는법(정리요약),"작업내용 : 보안성 패치 작업하다가. profile을 잘못건드려, 로그인이 되지 않음;;;
다행이 작업전 백업해둔 파일이 있어서, 싱글 모드 돌입후 처리
CentOS 7.x 싱글모드 가는법 요약정리(폰으로 보세요)
1. 부팅 중 아래 화면에서 'e' 키를 눌러서 수정합니다.
2. 아래와 같이 나오는데 밑으로 좀 내리다보면 수정해야할 부분이 나옵니다.
방법 1.
아래와 같이 수정 후에 'Ctrl + x' 키를 입력하여 부팅합니다.
ro -> rw
rhgb quiet -> init=/bin/bash
[AS_IS]
TO_BE
이후 싱글모드로 부팅되면 원복 작업 진행, 굿럭",댓글 없음,https://cafe.naver.com/pnpsecure2/5630
5628,[TIP] DBSAFER VM으로 Centos 구성시 주의사항,"- 최근 VM으로 구축하는 고객사가 많이 나오고 있다
- VM요청시 체크리스트를 정리해 보았습니다
1. CentOS 7.9(minimal) 설치 요청
- 고객사에서는 보통 미니멀 버전을 가지고 있지 않다.
: 꼭 미니멀인지 확인하고, 없을시 회사의 ISO파일 전달 및 방문후 직접 설치하는것이 좋다
2. 파티션 지정시 되도록 NFS는 피할것
- 네트워크 파일시스템으로 마운트 공간을 지정 받아서, DBSAFER설치가 불가능한건 아니지만,
: 네트워크 부하나, 기존의 ext/xfs에 비해 느리다
: nfs로 지정하는게 가격이 저렴하기 때문에 고객담당자 / PM이 지정하려고 하지만 꼭 xfs로 하자
3. disk공간은 최소한으로 전달하는것이 좋다
: vm망 구성시 cpu/mem에 비해 저장공간이 비용이 상대적으로 많이 든다
: 때문에 최소한으로 전달하는것이 좋다(대형사이트 제외)
========================================================
* 기존 정부관리청사에 구축시 전달했던 VM스팩 전달합니다
- 대상서버 : OS : 20EA, DBMS : 2EA
- 사용자 : 20명 내외
[VM 생성시 요청 ""최소"" 스팩사항] 전달드립니다.
- OS : CentOS 7.9(Minimal) / 필수!!
- cpu : 4core 이상
- mem : 16G 이상
- 블록스토리지
[파티션 영역 Type 볼륨영역]
OS (sda) xfs /boot 1G
OS (sda) xfs /boot/efi 1G
OS (sda) xfs swap 32G
OS (sda) xfs / 100G
OS (sda) xfs /pnp_sys_log 30G << DBSAFSER 모듈 로그가 저장되는 장소
OS (sda) xfs /home ""300G"" << 실제로 사용자 로그가 저장되는 장소
(/home/dbsafer/data/mysql)",댓글 없음,https://cafe.naver.com/pnpsecure2/5628
5625,[tip] Db_qinfo 상관없이 dml쿼리내용 보고서 뷰 생성하는 방법(커스텀),"1. 이슈내용
db_qinfo에 update/insert/delete구문에 대한내용을 저장하고 이에 따라 webreport에 보고서로 저장함
하지만 해당 테이블에 dml구분의 쿼리가 없음(select)만 있음(원인 찾지 못함)
* 또는 db_qinfo에 저장된 쿼리와, 실제 로그에 저장된 update/insert/delete 구분의 쿼리 수량이 맞지 않음(담당자가 메니저 > 로그 조회)
** 때문에 로그 조회시 나오는 쿼리내요을 가지고 보고서 뷰테이블을 생성하고 적용
2. 적용 고객사 : 삼성서울병원
3. 작업내용(전체)
1) 백업
- 라이센스 백업
아래 두경로에 있는 파일 백업(백업경로는 따로 지정할 것)
# /home/reportsvr/license/ozlicense.xml
# /home/reportsvr/ozmng80/license/ozlicense.xml
2) 설치작업
1) 기존파일 삭제
- webreport 폴더에 ./uninstall.sh 실행
: 설치한 패키지 버전으로 uninstall.sh가 필요하다.
3) 설치 작업
./install.sh -S SAMSUNGHS -port 13306
4) [패치 후 필수 진행 사항]
- DBMS 툴에서 아래 쿼리를 수행하여 나오는 결과를 그대로 복사하여 실행
=> SELECT CONCAT('DROP table ', table_schema, '.', table_name, ';') FROM information_schema.tables where table_name IN ('SAMSUNGHS_db_query_dml_detail', 'SAMSUNGHS_db_query_dml_summary');
- DBMS 툴에서 '삼성서울병원 배치쿼리 임시 수정 쿼리.txt'의 내용을 복사하여 실행
- 배치테이블을 삭제한 기간만큼 배치모듈을 다시 실행
5) 서비스 모듈의 문제(db_qinfo에 select만 남기는 현상)가 해결되면 DBMS 툴에서 '삼성서울병원 배치쿼리 원복 쿼리.txt'의 내용을 복사하여 실행
> db_qinfo를 체크하는것이 아닌 쿼리의 like검색을 통한 보고서 작성
>> 파일경로 : https://bbs.pnpsecure.com/showthread.php?tid=11278
>> 적용방법 : 압축 파일을 풀어서 2개의 .odi 파일을
>> /home/reportsvr/repository_files/template/webreport에 덮어쓰기 (기존파일 백업 필수)",댓글 없음,https://cafe.naver.com/pnpsecure2/5625
5624,[TIP] DBSAFER_AM를 통해 SSH접속후 디버깅시 에러로그 안 나옴,"1. 이슈내용
1) 기존의 사용자는 SSH접속후 컴파일함
2) DBSAFER를통해 SSH접속후 컴파일시 에러 로그가 리턴되지 않음
2. 처리방법
1) 해당 서비스 번호 확인
: 메니저에서 등록된 서비스 번호 or ps -ef | grep [ip]로 등록된 서비스 번호 확인
2) 아래 명령어 실행
#cd /dbsafer/
#echo ""TRANSPARENT_EXECUTE=(91) ."" >> .conf/pnp_ssh_proxy.conf",댓글 없음,https://cafe.naver.com/pnpsecure2/5624
5610,[공유][pnp_connector] connector 모듈을 활용하여 n일 이상의 로그를 뷰테이블로 제공하는 방법,"[요약]
케이뱅크에서 개인정보접속기록 관리 솔루션을 신규 도입하면서 2020년 10월 ~ 2022년 10월 까지의 로그를 뷰테이블로 연동 요청.
- 요청 사항 : 기존 netcruz 와 연동하던 db_user / db_query 뷰테이블 외에 2년치 로그를 뷰테이블로 연동 요청
pnp_connector.conf 내에 뷰 테이블 생성할 날짜 옵션인 ""VIEW_LINKAGE_DAYS= ""는 최대 7일까지 설정 가능하며 Rev2206 에서부터는 제한을 해제하는 옵션이 추가됐었음. 하지만 제한을 해제하게 되면 뷰테이블의 크기 자체가 커지는 현상이 발생하므로 VIEW_LINKAGE_DAYS= 는 2~7일로 지정하는 것이 좋을 것 같습니다.
이외 제공이 필요한 일자에 대해서는 아래에서 설명하는 방법으로 뷰테이블 제공하는 것이 좋을 것 같습니다.
[기능 사용방법]
가. 커스텀 뷰 생성을 위한 SQL 문 작성
- /dbsafer/.conf 경로에서 쿼리문 (.sql) 작성
1. 매월 로그DB 에서 db_user_DD / db_query_DD 테이블 관련 SQL
- 명령어 로그의 량이 많은 사이트에서는 매월 db_query_DD 로그를 3등분 하여 작성하는 것도 좋습니다.
- db_query_DD 로그 10일 씩 합하여 뷰테이블 생성하는 방법
SELECT * from dbsafer_log_2020_10.db_query_01 union all SELECT * from dbsafer_log_2020_10.db_query_02 union all SELECT * from dbsafer_log_2020_10.db_query_03 union all SELECT * from dbsafer_log_2020_10.db_query_04 union all SELECT * from dbsafer_log_2020_10.db_query_05 union all SELECT * from dbsafer_log_2020_10.db_query_06 union all SELECT * from dbsafer_log_2020_10.db_query_07 union all SELECT * from dbsafer_log_2020_10.db_query_08 union all SELECT * from dbsafer_log_2020_10.db_query_09 union all SELECT * from dbsafer_log_2020_10.db_query_10
- db_user_DD 로그를 한달치 합하여 뷰테이블 생성하는 방법
SELECT * from dbsafer_log_2020_10.db_user_01 union all SELECT * from dbsafer_log_2020_10.db_user_02 union all SELECT * from dbsafer_log_2020_10.db_user_03 union all SELECT * from dbsafer_log_2020_10.db_user_04 union all SELECT * from dbsafer_log_2020_10.db_user_05 union all SELECT * from dbsafer_log_2020_10.db_user_06 union all SELECT * from dbsafer_log_2020_10.db_user_07 union all SELECT * from dbsafer_log_2020_10.db_user_08 union all SELECT * from dbsafer_log_2020_10.db_user_09 union all SELECT * from dbsafer_log_2020_10.db_user_10 union all SELECT * from dbsafer_log_2020_10.db_user_11 union all SELECT * from dbsafer_log_2020_10.db_user_12 union all SELECT * from dbsafer_log_2020_10.db_user_13 union all SELECT * from dbsafer_log_2020_10.db_user_14 union all SELECT * from dbsafer_log_2020_10.db_user_15 union all SELECT * from dbsafer_log_2020_10.db_user_16 union all SELECT * from dbsafer_log_2020_10.db_user_17 union all SELECT * from dbsafer_log_2020_10.db_user_18 union all SELECT * from dbsafer_log_2020_10.db_user_19 union all SELECT * from dbsafer_log_2020_10.db_user_20 union all SELECT * from dbsafer_log_2020_10.db_user_21 union all SELECT * from dbsafer_log_2020_10.db_user_22 union all SELECT * from dbsafer_log_2020_10.db_user_23 union all SELECT * from dbsafer_log_2020_10.db_user_24 union all SELECT * from dbsafer_log_2020_10.db_user_25 union all SELECT * from dbsafer_log_2020_10.db_user_26 union all SELECT * from dbsafer_log_2020_10.db_user_27 union all SELECT * from dbsafer_log_2020_10.db_user_28 union all SELECT * from dbsafer_log_2020_10.db_user_29 union all SELECT * from dbsafer_log_2020_10.db_user_30 union all SELECT * from dbsafer_log_2020_10.db_user_31
나. 커스텀 뷰 생성
- pnp_connecor 모듈에서 custom_view 테이블 생성
다. 생성 후 뷰테이블 확인
- 생성 후 DB접속, 뷰테이블 확인, 데이터 정상적으로 SELECT 되는지 확인",댓글 없음,https://cafe.naver.com/pnpsecure2/5610
5557,[공유] DBSAFER 서버 재부팅 전/후 체크리스트 공유,"DBSAFER 서버 재부팅 전/후 확인해야할 내용 공유드립니다.
[DBSAFER 서버 재부팅 전]
1. pnp, pnpweb 스크립트 확인(pnpweb은 웹 제품을 사용하고 있는 경우)
실행 명령어
# ll /etc/init.d/
결과 화면 예시
2. ADDITIONAL SERVICE SELECT 확인
실행 명령어
# cd /dbsafer
# ./pnp setup
ADDITIONAL SERVICE SELECT에서 프로세스 체크 여부 확인
=> (DEFAULT 기준) LOG_BRIDGE, WATCHER, UPDATE_SERVER, OMS_DMS, NTP_SYNC, BACKUP3, CHECK_INTEGRITY, MSG_TUNNEL
=> 그 외 구동 중인 서비스 확인하여 체크 필요(# ps -ef | grep pnp 명령어로 구동 중인 서비스 확인. 예로, pnp_log_sender가 구동 중일 경우 LOG_SENDER 항목 체크 필요)
결과 화면 예시
3. pnp_watcher.conf 확인
- DBSAFER 버전에 따라 사용 중인 모듈이 ADDITIONAL SERVICE SELECT에 없는 경우가 있음
- 이런 상황에서는 watcher process checklist에 등록하면 됨(watcher : 모듈의 가동 상태 확인 및 재시작하는 역할 수행)
실행 명령어
# vi /dbsafer/.conf/pnp_watcher.conf
CHECK PROCESS LIST 아래에 모듈명 추가
# cd /dbsafer
# ./pnp_watcher stop
# ./pnp_watcher start
결과 화면 예시
DBSAFER 19.05버전을 사용하는 고객사에서 ADDITIONAL SERVICE SELECT에 IMUP_POLICY가 포함되어 있지 않아 watcher에 pnp_imup_policy 등록
[DBSAFER 서버 재부팅 후]
1. 필수 프로세스 구동 확인
실행 명령어
# ps -ef | grep pnp | grep -v drop | grep -v sshd
아래 프로세스가 실행 중인지 확인(DEFAULT 기준)
pnp_launcher
pnp_agent
pnp_oms_dms
pnp_log
pnp_log_bridge
pnp_ntpsync
pnp_backup3
pnp_checkintegrity
pnp_update_server
pnp_sysmon
pnp_msg_tunnel
pnp_watcher
결과 화면 예시
2. 서비스 확인
2-1. 서비스 가동상태 확인
실행 명령어
# cd /dbsafer
# ./pnp_agent service-list
Status에 Error가 없는지 확인
결과 화면 예시
2-2. 서비스 프로세스 확인
실행 명령어
# ps -ef | grep pnp | grep drop
""./pnp_agent service-list | grep –v Stop""에서 확인된 Running 상태인 서비스들이 동작하는지 확인
결과 화면 예시
3. 프로그램 체크
3-1. 매니저 프로그램 동작 확인(Enterprise Manager)
1) 접속 가능 여부 확인(관리자 계정)
2) 로깅 상태 체크 : 로그 조회 > 서비스 로그 조회
3-2. 사용자 프로그램 동작 확인(DBSAFER Agent)
1) 접속 가능 여부 확인(보안 계정)
2) NAT 서비스 리스트 동기화 확인
작성된 내용이 다르거나 추가로 확인해야할 부분이 있는 경우 댓글 부탁드립니다!","전지웅: 좋은 정보 적어주셔서 감사합니다.!
추가 확인하는 건 아니지만, 저는 서버 재부팅 하기 전에 아래처럼 현재 가동 중인 프로세스 현황을 백업해두면 재부팅 후 비교할 수 있어서 좋더라고요.
# ps -ef | grep pnp >> processlist.txt && ps -ef | grep dbsafer >> processlist.txt",https://cafe.naver.com/pnpsecure2/5557
5549,[버그] ﻿pc_agent 사용시 SFTP(HP_UX) 접속불가,"- pc_agent 사용시 SFTP(HP_UX) 접속불가
: ssh 접속가능 / centos,rhel은 sftp가능
: pnp_telnet(hp_ux) 디버깅 확인내용
* 이슈내용 > ID/PW 로 인증 성공 > SSH 통신을 위한 채널 생성 후, 사용자(PC)가 터미널 환경정보(화면 사이즈)를 전달 함
마지막 ""터미널 환경정보/사이즈?"" 패킷을 전달해서 서버가 이상 판단으로 대상서버가 세션 끊은것으로 판단 됨
* 처리내용 > 기존의 pnp_sshd/ssh 모듈대신 > ssh_proxy모듈(최신개발)적용 예정(QA검토필요) 강정근부장/김태윤실장님 확인 중....
* 결론 pnp_ssh_proxy 모듈문제로 디버깅후 이슈 확인 > 패치 > 처리 완료",댓글 없음,https://cafe.naver.com/pnpsecure2/5549
5548,[TIP] pnp_ssh_proxy 디버깅 하는 방법,"SSH/SFTP 접속시 기존에 pnp_sshd/ssh 모듈을 사용하지만 앞으로 pnp_ssh_proxy사용예정입니다.
디버깅하는 방법을 공유드립니다.
1. 모듈 로그 확인시
(1) ps -ef | grep pnp_ssh_proxy | grep [[서버 IP]]
(2) cd /dbsafer/
(3) ./pnp_ssh_proxy stop [[서비스 번호]] ※서비스 번호 : (1)에서 확인된 서비스 번호
(4) ./pnp_ssh_proxy [[서비스 인자값]] -g5 ※서비스 인자값 : (1)에서 확인된 명령어 인자값
2. gdb 확인시
./pnp_ssh_proxy stop [[서비스 번호]]
gdb ./pnp_ssh_proxy
gdb> run (실행 인자값) -g5",댓글 없음,https://cafe.naver.com/pnpsecure2/5548
5529,[공유] DBSAFER 세션 격리 기능 설정 방법,"DBSAFER에서는 DB 접속 시도 시 패스워드 실패 등 으로 인해 특정 횟수 이상 로그인에 실패 할 경우 해당 사용자를 일시적으로 격리시켜 DB에 접속 시도를 할 수 없도록 하는 세션 격리 기능 설정이 가능합니다.
[사전 준비 사항]
- /dbsafer/.conf/login_try_audit.conf 파일 필요 (기본 파일 위치 /dbsafer/.conf/sample)
- session_manager 모듈 필요 (DBSAFER 패키지 설치 시 기본 포함)
- pnp_agent.conf 설정 파일 policy_listeners=(gw ip):3143 설정 필요
[제약 사항]
- 로그인 실패 기능 (login_try_audit)을 통해 로그인 실패 로깅이 가능 한 서비스 대상으로만 사용 가능
. 지원 가능 DB 종류
> Oracle, MSSQL, Sybase, UDB(DB2) - https://cafe.naver.com/pnpsecure2/2396
> 내부 테스트 결과 MySQL, MariaDB 정상 동작, PostgreSQL 미동작
> 추가적인 DBMS는 지원 확인 및 개발 필요 - Bugs : 0009084
[기능 적용 방법]
- /dbsafer/.conf/sample 경로에 존재하는 login_try_audit.conf 파일을 /dbsafer/.conf/ 경로로 복사
- pnp_agent.conf 설정에 policy_listeners = (gw ip):3143 추가
- session_manager 모듈 실행
. session_manager start 명령어 통해 모듈 실행 후 session_manager status 명령어 통해 상태를 확인 하면 disable 상태로 실행 됨 (R21.09 패키지 기준)
. 사용 할 기능에 대해 enable 작업 필요
> session_manager enable isolate 명령어 통해 세션 격리 기능 활성화
(참고 사항) 세션 격리 기능의 경우 session_manager 모듈이 가동 된 이후 시작된 서비스에 대해서 동작 가능
- 모듈이 가동 이후에 서비스 데몬이 시작이 되어야 함 (서비스 재 시작 필요)
> 실제로는 ‘var/session_manager.pid’ 파일이 존재한 이후 에 서비스가 가동 되어야 함
- 메니저 - 환경설정 - 접속계정 세션 자동 격리 메뉴 확인 후 세션 격리 설정 진행
- 사용자 로그인 실패 시 세션 격리
(참고 사항)
- DBSAFER에서 다음과 같이 로그인 실패를 확인 할 수 있는 서비스 대상으로만 세션 격리 기능 사용 가능
- 세션 격리 상태 확인 및 수동 격리 해제",댓글 없음,https://cafe.naver.com/pnpsecure2/5529
5526,[공유] Ubuntu 서버로 SSH 키 인증 접속이 안되는 경우 설정 방법,"* 테스트 했던 Ubuntu 서버를 기준으로 작성하였으나, 최신 버전의 OpenSSH를 사용하는 서버는 동일하게 조치 가능할 것으로 예상됩니다.
[이슈 사항]
- AWS Ubuntu 22.04 서버 SSH 서비스 접속 불가
. pem 키 인증 방식 사용 중이며, pnp_key_manager 모듈을 통해 pem 키 관리하고 있음
. PC Agent 미실행 시 정상 접속되며, PC Agent 실행 시 접속이 불가한 상태
. pnp_sshd, ssh / pnp_ssh_proxy 동일 증상을 보임
[이슈 상세]
- pnp_ssh_proxy 디버그 시 아래와 같이 로그 출력
[2022-09-08 14:52:57] [34007] [MISC][INFO__000000000] Information message. : Failed to certify the key(private). (NO)31, (SERVER)3.34.252.72:22, (USER)10.77.160.225:62233, (ACCOUNT)ubuntu, (FILE:COUNT)32576
- 대상서버의 sshd 디버그 시 아래와 같이 메시지 출력
userauth_pubkey: key type ssh-rsa not in PubkeyAcceptedAlgorithms
- Ubuntu 서버의 SSH 버전은 OpenSSH_8.9p1 Ubuntu-3, OpenSSL 3.0.2 15으로 해당 이슈는 최신 버전 OpenSSH 대상으로 발생하는 현상임을 확인
- ssh-rsa는 SHA-1을 쓰기 때문에 안전성에 문제가 있어 최신 OpenSSH에서는 기본 제공 알고리즘으로 사용하고 있지 않음
[조치 사항]
아래 두 가지 중에서 한 가지 방안 적용
1. SSH 서비스 대상으로 등록된 키의 알고리즘을 ssh-rsa가 아닌 다른 알고리즘(ex. ecdsa)을 사용
ex) ssh-keygen -t ecdsa
2. 대상서버(Ubuntu 서버) SSH 서비스의 sshd 설정(/etc/ssh/sshd_config)에 아래 두 옵션(2-1 ~ 2-2) 중 하나를 추가 후 sshd 재기동
(sudo service sshd restart)
2-1. PubkeyAcceptedKeyTypes=+ssh-rsa
2-2. PubkeyAcceptedAlgorithms=+ssh-rsa
[참고 사항]
- OpenSSH : https://www.openssh.com/txt/release-8.7
- Bugs : https://bugs.pnpsecure.com/view.php?id=22605",댓글 없음,https://cafe.naver.com/pnpsecure2/5526
5489,"[TIP] 특정 사용자가 특정 DB에 Toad, Orange 사용 시 접속 불가 현상 (ora-12537 에러)","[요약]
- 현상 : 특정 사용자 PC 에서 Toad, Orange DB TOOL로 특정 Oracle DB 접속 불가
: 접속 시도 시 'TNS-12537' 팝업 발생 및 종료로 동작
- DBSAFER AGENT 로그인 시 접속 불가, 종료 후 접속 시 정상 접속 가능 확인
: DBSAFER 통했을 시 문제가 발생하기에 'PC <> DBS <> DB 구간', '사용자 PC 구간' 패킷 덤프하여 반출 및 분석
- Toad, Orange 접속 실패 패킷과 접속 정상 패킷 차이점 분석
: Tool을 통해 접속 성공 시 최초 접속 패킷이 1개,
: Tool을 통해 접속 실패 시 최초 접속 패킷이 2개로 나뉘어져서 들어옴
- 조치내역 : 패킷 확인 시 프로그램 파일 설치 경로가 4줄 정도 있었고,
해당 설치 파일 및 관련 파일들을 경로 C:\ 로 이동하여 설치 경로를 줄여서 실행 시 정상 접속 가능
[버전정보]
- pnp_ora : R1863
- Orange4.0.1 Build27 / Toad for Oracle 12.10.0.30
[상세내역]
- 동일 IP 대역대 PC에서 동일 Tool 사용하여 DB에 작업 중이지만, 특정 사용자 PC에서 Toad, Orange 사용 시 접속 불가 현상 발생
- 초기 Client 환경 구성 문제일 가능성이 있어, OCI 버전 및 tnsnames.ora 파일을 정상 동작하는 사용자와 동일하게
일괄 수정 하였으나 해당 조치로 접속이 가능한 사용자가 있었고, 이후에도 접속 불가한 사용자 존재
> 추가로, 접속 불가한 패킷 수집하여 추가 분석 진행
- 고객사 네트워크 환경
'PC <> NAT <> DBSAFER <> NAT <> DB 구간'
- 사용자 PC 에서 'PC <> NAT' 구간 Wireshark 패킷 덤프
DBSAFER에서는 'NAT <> DBSAFER <> NAT' 구간의 패킷 덤프 완료 및 분석
[분석 결과]
- 접속 실패의 경우
: 최초 접속 패킷이 두개로 분리되어 전달됨
- 접속 성공의 경우
: 최초 접속 패킷이 하나로 전달됨
[조치내역]
- 정상/비정상 접속 패킷의 차이점을 기반으로 패킷을 한 개로 임의 조작 하였을 때 정상 접속 가능 여부 파악
- 최초 접속 패킷을 줄이기 위해 해당 설치 파일 및 관련 파일들을 경로 C:\ 로 이동하여 설치 경로를 줄여서 실행 시 정상 접속 가능
- 추후 C:\ 경로 이동 후 실행 한 정상/비정상 패킷 반출 해줄 시 패킷 확인하여 패킷길이 확인 예정
>> 확인결과, 패킷이 1개로 줄어들었을 때 정상 접속 가능 (아래사진참고)
>> 경로 줄이지 않았을 때 담당자에게 'DB <> NAT <> DB' 구간의 패킷 추가 확인 요청한 상황
이상입니다.
감사합니다.
첨부파일
특정서버_정상_비정상_접속패킷_220804
.zip
null
파일 다운로드
첨부파일
경로단축패킷_220812
.zip
null
파일 다운로드","류재혁: 오라클은 접속 TNS정보를 전달할때, 패킷 전체 길이에 따라, 위에 기재해주신 캡쳐형태되로 패킷이 2개 / 1개로 결정되어 전달됩니다.
과거에 확인해본바로는 특정 정해진 길이 이상일때 이렇게 동작을 하며, 주로 어플리케이션 경로 길이 혹은 도메인을 썼을때 길이가
유동적으로 변화하면서 나타나는 일반적인 루틴입니다. 예전에는 오라클 접속시 IP변조가 필요하여 저희가 임의적으로 길이를 넘었을때
1개의 패킷을 2개로 나누던가, 2개의 패킷을 하나로 합치는 루틴이 있었습니다만 최근에는 오라클에서 변조가 없어도 접속에 문제가
없어서 기능을 제거를 하여 배포를 하고 있습니다.

일단, 정확한 사실 관계를 확인하기 위해서는 클라이언트 PC에서 DBSAFER 로 가는 패킷 1개와 DBSAFER 서버에서 PC->GW ->DB 2구간의
패킷 각 1개를 캡쳐하여 전달 주시면 변조가 있었는지 검토를 먼저 해보겠습니다.",https://cafe.naver.com/pnpsecure2/5489
5481,[userauth] 2factor 인증 기능 미 동작 시 조치 사항,"[요약]
- COMMON_UTIL의 버전에 따라 ""pnp_userauth""의 기능 이상 발생
. pnp_userauth 모듈에서 tls v1.2를 사용하지 못해 발생한 문제 (bugs 22667)
. 임시 조치 방안으로 java.security 파일 수정을 통해 tls 1.0, 1.1 허용 조치
* userauth v1.0.71 이상부터 수정되었습니다.
[구성]
- DBSAFER V5 릴리즈 패키지 / COMMON_UTIL_V2.23_build-1_20211212 / pnp_userauth 1.0.68 / saferuas 2.0.57.1
. 2-factor 기본 설정
[이슈]
- 접속제어 정책에 ""2-factor 인증"" Flag 설정 적용 시 2차 인증 창이 출력되지 않고 바로 차단되는 현상
- catalina.out / saferuas.log 등에는 특별한 오류가 발견되지 않음
- pnp_userauth의 로그에서도 특이사항 발견되지 않음
> 상세 동작 확인을 위해 pnp_userauth.conf의 debug 옵션을 ""1"" 로 설정 후 모듈 재 기동
> 확인 결과 아래와 같은 오류가 발생함
* debug 모드를 활성화 했을 경우에만 에러 확인이 가능해 모듈의 log Level 설정에 문제가 있는 것으로 추정
--------------------------------------------------------------------------------------------------------------------------------
8¿ù 17, 2022 10:56:14 ¿ÀÀü com.pnpsecure.userauth.authgw.AuthGwHandler onJob
½É°¢: failed send result to service daemon
javax.net.ssl.SSLHandshakeException: No appropriate protocol (protocol is disabled or cipher suites are inappropriate)
at java.base/sun.security.ssl.HandshakeContext.<init>(HandshakeContext.java:170)
at java.base/sun.security.ssl.ClientHandshakeContext.<init>(ClientHandshakeContext.java:98)
at java.base/sun.security.ssl.TransportContext.kickstart(TransportContext.java:221)
at java.base/sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:443)
at java.base/sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:421)
at com.pnpsecure.userauth.Basic2FactorHandler.getSSLSocket(Basic2FactorHandler.java:391)
at com.pnpsecure.userauth.Basic2FactorHandler.getPcAssistSocket(Basic2FactorHandler.java:464)
at com.pnpsecure.userauth.authgw.AuthGwHandler.onJob(AuthGwHandler.java:71)
at com.pnpsecure.userauth.Basic2FactorHandler.execute(Basic2FactorHandler.java:176)
at com.pnpsecure.userauth.MainServer$1.run(MainServer.java:72)
at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
at java.base/java.lang.Thread.run(Thread.java:829)
--------------------------------------------------------------------------------------------------------------------------------
[조치 방법]
- /usr/java/jdk-(버전)/conf/securityjava.security 파일에서 아래 정보를 수정
. tlsv1, tlsv1.1 항목을 삭제 조치
. 이후 pnp_userauth 모듈 재 시작
[문제점]
- 21년에 배포된 log4j 취약점을 수정한 COMMON_UTIL에서도 발생하는 문제로 상당기간 이슈가 있었던 것으로 파악
. JDK 변경에 따른 모듈 별 사이드 이펙트 검증이 미흡한 것으로 보입니다.
- bugs에는 22년 6월 경 등록되었으나 22년 8월인 현재 아무 공지가 없는 상태
. 모듈 장애 가능성을 인지하였다면 빠른 공지 및 조치 방법에 대한 가이드 필요
. 모듈에 대한 수정 일정또한 존재하지 않는 상태이며 TLS level을 낮춰 대응하는 것이 정상적인 처리방법이라고 생각되지 않습니다.","전종현: https://cafe.naver.com/pnpsecure2/4886
https://cafe.naver.com/pnpsecure2/5271
위 글에도 이전에 TLS 관련 내용이 있습니다.

차장님 말씀대로 TLS level을 낮춰 대응하는게 보안상의 위험성은 없는지 궁금합니다. | 서재영: TLS 1.2 사용 권고 사항은 ""기술적 취약점 분석·평가 방법 상세가이드""(21년 3월) 의 Web(웹) 보안 27. 데이터 평문 전송에 TLS v1.2 이상 사용을 권장한다고 설명 하고 있습니다.

- 설명 내용 : 암호화 전송 시 프로토콜 설계의 결함이 있는 SSLv2, SSLv3, TLSv1.0, TLSv1.1은 비활성화 필수, TLSv1.2 이상 사용을 권장함 (p720)

- 관련 문서 : https://www.krcert.or.kr/data/guideView.do?bulletin_writing_sequence=35988&queryString=cGFnZT0xJnNvcnRfY29kZT0mc29ydF9jb2RlX25hbWU9JnNlYXJjaF9zb3J0PXRpdGxlX25hbWUmc2VhcmNoX3dvcmQ9JUVDJUI3JUE4JUVDJTk1JUJEJUVDJUEwJTkw

대부분 취약점 조치를 원하는 고객사에서는 기술적 취약점 조치 기준을 참고하여 TLS 1.2 이상 사용을 | 문금주: userauth v1.0.71 이상부터 수정되었습니다. | 윤진하: 여기 생각보다 좋은 내용 내용들이 많이 있군요!! ㅎㅎ
Download URL : https://bbs.pnpsecure.com/showthread.php?tid=4589&pid=13156#pid13156",https://cafe.naver.com/pnpsecure2/5481
5465,"[TIP] pnp_oms_dms 설정 시, [ NAT_IDENTITY_EXTEND_TYPE ] 사용 시 어플리케이션명 기록 변경 방법 공유","[요약]
-현상: 최근 고객사에서 PostgreSQL DB에 ""Dbeaver""를 통해 접속할 경우 어플리케이션명이 미로깅 되는 현상 발생
> 확인 결과 해당 이슈는 서비스 모듈 문제가 아닌, ""Dbeaver"" Tool 사용 문제로 확인
- 조치내역: 어플리케이션 미로깅 문제 해결을 위해 ""사용자 식별 시 어플리케이션명을 취득하는 옵션을 활성화' 하도록 가이드 함
* 참고URL: [TIP] DBSAFER 에서 접속 Tool 명을 인식하는 다양한 방법 ( https://cafe.naver.com/pnpsecure2/3369 )
- 추가로 고객사에서 자주 사용하는 DB Tool 에 대해 ""어플리케이션명 옵션(NAT_IDENTITY_EXTEND_TYPE)에 따라 로깅되는 어플리케이션명에 대한 사내 테스트를 진행 ( 아래 그림 참고)
[버전 정보]
- PostgreSQL : 9.6.23
- Dbeaver : 22.0.5
- pnp_postgresql : (Rev: v1897) COMMON LIBRARY VERSION: 3319
- pnp_oms_dms : (Rev 944)
[테스트 결과 공유]
- 7개 DBMS 접속 툴 테스트 진행 (옵션 변경 전/후 로깅되는 어플리케이션명)
(QueryBox, Dbeaver, pgAdmin 4, MySQLWorkbench, sqlplus, Toad, sqldeveloper)
NAT_IDENTITY_EXTEND_TYPE 옵션 변경 전/후 로깅되는 어플리케이션명
- NAT_IDENTITY_EXTEND_TYPE =1 로 설정한 후에는 기존 매니저에서 로깅되는 어플리케이션명과는 다르게
시스템 작업관리자의 프로세스명으로 감사로그 기록 (아래 사진 참고)
dbeaver DB TOOL의 '작업관리자 - 프로세스'명 확인 방법
※주의사항
- NAT_IDENTITY_EXTEND_TYPE 옵션 활성화 시,
기존에 등록되어 있는 '어플리케이션명과 관련된 접속/권한 제어' 정책에 대한 영향도 확인 필요
이상입니다.
감사합니다.","전지웅: 내용 공유 감사합니다.

NAT_IDENTITY_EXTEND_TYPE 옵션 설명도 있으면 좋을 것 같아 적어두겠습니다.

# 사용자 식별 정보에 추가할 정보 종류
# Example : 없음(0), DBMS 프로그램명(1), TERMINAL 프로그램명(2), FTP 프로그램명(4), DBMS 프로그램 해시(8), TERMINAL 프로그램 해시(16), FTP 프로그램 해시(32)
# Default : 0
NAT_IDENTITY_EXTEND_TYPE = 7

>10진수로 값을 넣는 것으로 보입니다. 예시) 7이면 DBMS,TERMINAL,FTP 프로그램명 추가",https://cafe.naver.com/pnpsecure2/5465
5461,[TIP] saferuas 보안계정 잠금 해제를 slack(슬랙) 연동으로 설정하는 방법 공유,"[개요]
saferuas 보안계정 잠금 해제 기능 사용 시 slack(슬랙) 연동으로 설정하는 방법에 대한 내용입니다.
기존 잠금 해제 기능 사용 시 mail을 통한 기능을 제공하고 있으며, slack 연동 또한 pnp_mailer 모듈의 URL 전송 기능을 통해 설정이 가능합니다.
> HTTP POST 방식으로 HTTP BODY 내에 메시지 정보(잠금 해제 URL)를 입력하여 전달하는 방식
위 기능을 사용하기 위해 webhook 방식으로 구현되며, slack webhook url 정보가 필요함
*Webhook(웹훅)이란, 특정 이벤트가 발생하였을 때 타 서비스나 응용프로그램으로 알림을 보내는 기능입니다. Webhook 프로바이더는 해당 이벤트가 발행하면 HTTP POST 요청을 생성하여 callback URL(endpoint)로 이벤트 정보을 보냅니다.
webhook 참고 url : https://leffept.tistory.com/329
[환경정보]
- Enterprise Manager 5.0.9.4A (Build-6387)
- SAFERUAS 2.0.57.0
- pnp_mailer 1.3.8
[설정 방법]
1. SAFERUAS 엔지니어 페이지 설정
- 버튼 텍스트 설정 : PC Assist 로그인 화면에 나오는 버튼 텍스트 내용
- 계정 잠금 종류 : 잠금 해제를 위한 잠금 종류 설정
- MAIL 알림/인증 상세 설정 진행
> 전송 방법 : mailer 모듈 이용
> 메일 내용 : #UNLOCK_URL# 파라메터 정보는 필수, 그 외 파라메터 정보는 엔지니어 페이지 우측 상단 HELP 참고
2. pnp_mailer.properties 설정
- 연동 타입을 URL로 설정
# mailType=com.pnpsecure.dbsafer.mailer.MailSenderUrl
- HTTP POST 방식으로 설정
# urlSendType=1
- slack webhook url 정보 입력
> 일반적으로 담당자에게 webhook url을 요청, 사내 테스트 환경 구성 시 webhook url 을 제작하여 테스트 진행
> slack webhook url 생성 방법 : https://zeddios.tistory.com/123
# insertUrl=[slack webhook url]
- HTTP Header 설정
> 특별한 이슈가 없다면 아래와 같이 입력
# insertUrlHeader=Accept:application/json, Content-Type:application/json; charset=utf-8
- HTTP Body 설정
> slack의 경우 Body 입력 시 JSON 형식으로 입력 필요
# insertUrlBody={ ""username"":""DBSAFER"",""text"":""[[COMMENT]]""}
[연동 결과]
- PC Assist에서 사용자 잠금 시 계정 잠금 해제 버튼을 통해 잠금 해제 진행
- slack으로 연동된 잠금 해제 URL을 클릭하여 보안 계정 잠금 해제 진행
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5461
5459,[TIP] 인사연동 환경에서 최초 연동 시 잠금 사유와 퇴사 시 잠금 사유를 구분하는 방법 공유,"[개요]
인사연동 환경에서 최초 연동 시 잠금 사유와 퇴사 시 잠금 사유를 구분하는 방법이 공유 및 전파되어 있지 않아 작성하였습니다.
> 최초 연동 시 잠금과 퇴사 시 잠금 사유가 잠김(인사연동)으로 동일한 상황
dbsafer_accountsync.properties 설정에서 최초 연동 시 잠금 처리 / 삭제된 계정에 대해 잠금 처리 시 dbsafer_ldap_list 테이블의 lock_reason 값이 3으로 설정되도록 하드코딩되어 있음
lock_reason 3 = 잠김(인사연동)
[환경정보]
- dbsafer_accountsync 1.130(r690)
- Enterprise Manager 5.0.9.4A (Build-6387)
[요구사항]
- 최초 인사연동 시 보안계정 잠금 처리(사유 : 인사연동 잠금)
- 사용자 퇴사 시 LDAP에서 사용자 삭제처리되며, 보안계정은 잠금처리(사유 : 퇴사 및 휴직)
[설정 방법]
1. 매니저 설정
> 시스템 설정 - 보안계정 연동 설정 - 보안계정 잠김 사유 관리
- 구분 코드 3과 101에 대한 잠김 사유를 서로 변경
> 변경 전 : 3(인사연동) 101(퇴사 및 휴직)
> 변경 후 : 101(인사연동) 3(퇴사 및 휴직)
2. dbsafer_accounysync.properties 설정
- AddedAccountSyncType = 1 설정을 통해 최초 연동 시 사용자에 대해 계정 잠금 처리 진행
- DeletedAccountSyncType = 3 설정을 통해 삭제된 계정(톼사)에 대해 계정 잠금 처리 진행 및 잠금 사유 갱신
- AdditionalQueryInsert 옵션을 통해 최초 연동 시 해당 사용자의 잠금 사유(lock_reason)을 101로 변경
- 여기서 101은 기존 퇴직 및 사유였지만 매니저 시스템 설정을 통해 인상연동 잠금으로 사유가 변경된 상태
- 해당 옵션을 통해 최초 연동 시 lock_reason = 101 퇴사 시 lock_reason = 3 으로 운영 가능
# AdditionalQueryInsert = UPDATE dbsafer3.dbsafer_ldap_list SET lock_reason = '101' WHERE sno = [[sno]];
> AdditionalQueryDelete 설정은 보안계정이 삭제가 될 때 수행이 가능하지만 요구사항에서는 잠금 처리이기 때문에 해당 쿼리 수행 불가
[연동 결과]
- 사용자 최초 연동 시 잠금처리되어 연동(사유 : 인사연동)
> islock=1, lock_reason=101
- 사용자 퇴사 시 잠금처리되어 연동(사유 : 퇴사 및 휴직)
> islock=1, lock_reason=101
감사합니다.","서영진: > 변경 전 : 3(인사연동) 101(퇴사 및 휴직)

> 변경 후 : 101(퇴사 및 휴직) 3(인사연동)

변경 후 내용이 수정되야 할 것 같습니다! | 윤효정: [수정 전] 변경 후 : 101(퇴사 및 휴직) 3(인사연동)
[수정 후] 변경 후 : 3(퇴사 및 휴직) 101(인사연동) | 윤효정: [연동결과]
- 사용자 퇴사 시 잠금처리되어 연동(사유 : 퇴사 및 휴직)
> islock=1, lock_reason=101

내용도 ""islock=1, lock_reason=3"" 으로 수정되어야 할 것 같습니다!

[수정 전] islock=1, lock_reason=101
[수정 후] islock=1, lock_reason=3",https://cafe.naver.com/pnpsecure2/5459
5452,[TIP] Maria DB 재시작 이후 pnp_oms_dms 모듈 비정상 상황으로 인해 재시작이 필요한 경우 공유,"[요약]
- 최근 pnp_oms_dms 에서 'DB-POOL' 에러 발생과 함께 PC ASSIST 를 통해 사용자 접속 불가 현상이 발생한 적이 있습니다.
- DBSAFER의 MySQL DB를 재시작 하고 나서 Side Effect로 인해 pnp_oms_dms(R670) 모듈 비정상 동작의 가능성 또한 있습니다.
- 혹여나 Maria DB를 재시작 하고 나서 아래와 같은 에러 메시지가 발생한다면 모듈을 재시작 하여 정상 상태로 돌려놓는 작업이 필요하기에 해당 내용 공유 드립니다.
[상세내역]
- 최근 고객사에서 'Too many open files' 에러가 발생하며 Maria DB를 재시작 해야하는 상황이 있었습니다.
- 해당 에러가 발생하면서 DB에 문제가 생겨 pnp_oms_dms(R670) 모듈에서도 또한 'DB-POOL' 에러를 발생시키고 있었고, MySQL DB 재시작 이후에도 계속해서 해당 에러가 발생하고 있었습니다.
- 재시작 이후에도 지속적인 에러 발생에 따라, 사용자 PC ASSIST 접속이 불가한 현상이 발생했습니다.
- 정상 상태 원복을 위해 pnp_oms_dms(R670) restart를 진행했으며, restart 이후에는 정상 동작 하는것을 확인했습니다.
- 추가로 확인결과 'Too many open files' 에러가 발생하면서 뿐만 아니라, Maria DB를 재시작 이후에도 위와 같은 Side Effect 가 발생 할 수 있다고 하며, 이를 방지하기 위해서는 pnp_oms_dms 모듈 뿐만 아니라, 각각의 중요 모듈들의 Status를 확인 및 재시작 작업을 해주는 것이 좋을 것 같다는 권장 사항을 확인 받았습니다.
( ※해당 에러는 Maria을 재시작 한다고 해서 무조건 발생하는 것은 아니며, 발생 할 수도 있는 에러 입니다.)
[ERROR][ERROR_0201099] Error related with DB initialization has occurred. : Not exist the remaining session in DB-Pool.
[pnp_oms_dms 모듈의 DB-POOL 세션 관리 방식 및 해당 에러 발생 원인]
- pnp_oms_dms 모듈은 DB-POOL 방식으로 PC ASSIST 접속에 대해 관리하고 있습니다.
- pnp_oms_dms 모듈의 세션 관리 방식인 DB-POOL 방식은 아래와 같습니다 .
> pnp_oms_dms는 LOG 서버와 DB Connection을 바로 CLOSE 하지 않고, 'DB-POOL'에 저장해 두었다가 동일 Connection 발생 시 효율적인 세션 관리를 통해 세션을 재사용함.
- 해당 에러 발생 원인
> pnp_oms_dms모듈은 'DB-POOL'에 대한 가용 수치가 존재하는데 해당 가용 수치를 넘긴 상황일 경우,
간헐적으로 DB에 SQL을 실행하기 위한 처리가 일부 대기하거나, 처리되지 않고 오래 걸리게 되면 해당 세션을
실패처리를 하게 되어 에러로그 출력 및 PC ASSIST를 통한 접속 불가 현상 발생
- pnp_oms_dms의 'DB-POOL' 가용수치 설정 (R646 이상부터 사용 가능)
> 'DB-POOL' 세션 최대수를 설정하는 기능이 추가되어 pnp_oms_dms.conf 에서 사용 할 수 있음
# vi /dbsafer/.conf/pnp_oms_dms.conf
# DB 연결 세션의 최대수를 설정 (최대: 100)
# Example : 10
# Default : 10
MAX_DB_SESSION = 10
* 틀린 부분 및 수정이 필요한 부분이 있다면 댓글로 남겨주시면 감사하겠습니다.","강현구: 최신버전에서는 DB-POOL 사용률에 대해서도 표시 하고 있습니다. 해당 로그도 같이 모니터링 하시는게 좋을 것 같습니다.
다만 MAX_DB_SESSION 해당 옵션 조정시 DB의 MAX_CONNECTION값 조정도 필요합니다. | 이창제: 안녕하세요. 강현구 차장님.
고객지원 2팀 이창제 입니다.

고객사에서 pnp_oms_dms 최신 버전으로 패치하게 된다면 해당 로그 또한 모니터링으로 추가 등록 권장하도록 하겠습니다.

또한, MAX_DB_CONNECTION 값 조정도 확인해보겠습니다.
추가적으로 놓칠 수 있는 부분 확인해주셔서 감사합니다 !! | 이창제: 추가로, 강현구 차장님이 말씀해주신 모듈 로그는 아래와 같이 확인하실 수 있어 다른 분들께 내용 공유 드립니다.

[경로]
: /dbsafer/log/pnp_oms_dms/YYYY/MM/DD

[메시지 내용]
[MISC][INFO__000000000] Information message.
: DBPOOL(use) : 6%(4/60) - [PID]14642(0%) / [PID]14645(10%) / [PID]14647(10%) / [PID]14650(0%) / [PID]14651(10%) / [PID]14652(10%)

이상입니다.
감사합니다. | 전지웅: 정확한 옵션명이 max_connections 입니다. 옵션명이 달라 적용이 잘 안됐던 적이 있어서 댓글 남겨드립니다.!
현재 릴리즈 기준 권장값은 10000 이니 참고하시면 좋을 것 같습니다.",https://cafe.naver.com/pnpsecure2/5452
5451,[TIP] 이중화 LOG2 서버에 SWADE 권한 없을 시 권한 부여 방법 및 주의 사항,"[요약]
- 최근 고객사에서 LOG2 서버 agent 모듈이 올라오지 않아 mysqlcheck 를 해보니 몇몇의 테이블이 깨져 있었고, 해당 원인 파악을 위해 /home/dbsafer/data/mysql/dbsafer~.err 파일을 확인하려 하였지만,
권한이 부여되지 않아 작업에 제한이 있던 적이 있어 수동으로 SWADE 권한 부여 하는 방법을 사용하였습니다. 해당 작업 방법 공유 드립니다.
- 이중화 구성이지만, LOG2서버 SWADE root 권한을 넣어주지 않았을 때, 수동으로 권한 부여하는 방법입니다.
- 해당 작업은 모듈의 재시작이 필요 없는 작업입니다.
[작업 전 확인 내역]
- LOG1 매니저 접속 > '관리자' > '암호화 로그파일 권한 설정' 확인
# LOG1 서버 접속 및 정책 현황 확인
> root 계정으로 ALL IP, ALL 명령어 허용 정책 활성화 되어있음
암호화 로그파일 권한 현황 확인
- 서버 SWADE 설정에서 LOG1, LOG2 정책 비교
# cd /var/pnpfs/conf
# cat file_alias.conf
> root 계정에 명령어 권한 ALL (= * )이 들어가 있는 LOG1과 차이점 확인
# cat file_auth.rules
> file_alias.conf 에서 설정한 'pol_6'에 대해 허용 설정 확인
LOG1, LOG2 정책 비교
[SWADE에서 수동으로 root 권한 허용 가이드]
- LOG2 서버 접속 및 아래의 디렉터리로 이동
# cd /var/pnpfs
- 정책 편집 (빨간색 텍스트 추가)
# ./bin/pnpfs_agent cy_edit conf/file_alias.conf
[target]
pol_0=$osid:obj_id_0 + $app:obj_cmd_0 + $cmd_type:*
pol_1=$osid:obj_id_1 + $app:obj_cmd_1 + $cmd_type:*
pol_2=$app:obj_cmd_2 + $cmd_type:*
pol_3=$app:obj_cmd_3 + $cmd_type:*
pol_4=$osid:obj_id_4 + $cmd_type:*
pol_5=$osid:obj_id_5 + $path:obj_path_5 + $cmd_type:*
pol_6=$osid:obj_id_6 + $cmd_type:*
[osid]
obj_id_0=""root""
obj_id_1=""root""
obj_id_4=""mysql""
obj_id_5=""root""
obj_id_6=""root""
[ip]
[app]
obj_cmd_0=""pnp_checkintegrity""
obj_cmd_1=""pnp_backup3""
obj_cmd_2=""mysqld""
obj_cmd_3=""mysqld_safe_helper""
[path]
obj_path_5=""/home/dbsafer/data/mysql/grastate.dat""
- 정책 편집 (빨간색 텍스트 추가)
# ./bin/pnpfs_agent cy_edit conf/file_auth.rules
action:pass + msg:""swade_0"" + sid:1000000 + $target:pol_0 + level:1
action:pass + msg:""swade_1"" + sid:1000001 + $target:pol_1 + level:1
action:pass + msg:""swade_2"" + sid:1000002 + $target:pol_2 + level:1
action:pass + msg:""swade_3"" + sid:1000003 + $target:pol_3 + level:1
action:pass + msg:""swade_4"" + sid:1000004 + $target:pol_4 + level:1
action:pass + msg:""swade_5"" + sid:1000005 + $target:pol_5 + level:1
action:accept + msg:""pol_6"" + sid:1 + $target:pol_6 + level:1
- 정책 컴파일
# ./bin/policy_compile
- 정책 로드
#./bin/policy_load /var/pnpfs/policy.img
- 수동 권한 부여 전/후 SWADE 영역에서의 동작 확인
LOG2 권한 부여 전 SWADE 영역 작업 권한 제한 메시지 발생
LOG2 권한 부여 후 SWADE 영역 작업 시 정상 동작 확인 가능
* 틀린 부분 및 수정이 필요한 부분이 있다면 댓글로 남겨주시면 감사하겠습니다.","서재영: 로그 이중화 구성이라면 log2 에도 자동으로 root 계정의 사용 권한 추가 되었어야 하지 않나 생각됩니다.
혹시 장애 상황으로 인해 log2 에 자동으로 root 계정의 사용 권한이 추가 되지 않았다면, 장애 상황도 같이 공유 해주시면 좋겠습니다.
만약, 장애 상황이 아닌데도 log2에 별도로 권한을 추가 해야 한다면 연구소에 개선 요청 해야 하는 부분으로 생각됩니다. | 이창제: 안녕하세요. 서재영 부장님.
고객지원팀 이창제 입니다.

답글이 늦어 죄송합니다.

문의 주시고 확인 결과 공유 드립니다.

1. 로그 이중화 구성 시 및 swade설치 후 자동으로 root 계정의 사용 권한이 LOG2에도 주어지지는 않는 것 같습니다.
(테스트 서버 구성 후 확인 결과 입니다. 이중화 구성 후 아래의 3.번처럼 테이블을 지정해 주어야 합니다.)

2. 해당 LOG2 서버에 dbsafer3 DB쪽 여러 테이블이 깨져 있었고, 아직 Fail-over 되지 않아 장애 상황은 아니었습니다.
하지만 말씀 주신 것 처럼 dbsafer3 테이블들이 깨져 있었고, 그 중 swade 권한 테이블이 깨져 있었다면 그로 인해 root 계정 사용 권한이 추가 안됐을 가능성도 보입니다.
(추가로 방문하게 되면 policysync 로그 내용 확인하여 업데이트 하겠습니다.)

3. SWADE 권한 부분 데이터를 저장하는 policy_logfile_auth 테이블과, 접속계정 테이블인 clie | 이창제: 확인 감사합니다 !",https://cafe.naver.com/pnpsecure2/5451
5431,[공유] 데이터 저장공간 부족으로 인한 PC ASSIST RDP 이미지 로깅 불가 현상,"[증상]
-구축 중 확인한 현상
-Server Agent를 사용하지 않고 PC ASSIST RDP 로깅 시 세션로깅 불가
-명령어 수행 갯수 1건(Login 로그만 남음)
-/dbsafer/filelog/에 img 안남음
[환경]
-VDI 환경
-로그가 C:\ProgramData\DSASSISTCRT\log 의 일반적인 경로가 아닌 VDI 디스크에 남음
-사용자별로 디스크가 숨겨져있는 경우가 있으며, 개인이 권한을 신청해야 디스크 확인 가능한 상태
[확인 사항]
1. C:\ProgramData\DSASSISTCRT\log\dsastcrts 로그 확인
> ""화면로깅 데이터를 저장할 공간이 부족하여 화면캡쳐를 하지 않습니다."" 로그 확인
> StoreHDDFreePercent = 5 //5%의 여유 공간 필요 (pnp_oms_dms.conf 옵션설정가능)
> StoreHddFreeSize = 10240 //10240MByte (대략 10GB)의 여유 사이즈 필요 (pnp_oms_dms.conf 옵션설정가능)
> StoreHDDUseMaxSize = 10737418240 //대략 10.7GB 사용 필요
> HDDAvailBytes = 10505785344 //대략 10.5GB 사용 가능
2. 사용자 VDI 디스크 용량 확인
>70.0GB 중 60.1 GB 사용중
[해결방법]
-사용자 VDI 디스크의 경우 개개인이 신청하여 용량을 증설해야 하므로 옵션값 수정
#vi pnp_oms_dms.conf
-수정 후 pnp_oms_dms restart, PC Agent 재시작에도 적용 안됨
-VDI 재부팅 후 적용 확인
[재발 방지]
-RDP 로깅시 디스크 여유 공간 부족 알림 기능 사용
#vi pnp_oms_dms.conf
# HDD 용량 부족시 알림 사이즈(MByte)를 설정
# Example : 최소값 : 1MByte, 최대값 : 10240MByte (10GB)
# 설정값이 0이면 사용 안 함
# Default : 0
ALERT_GATHER_FREE_SIZE = 2048
*아래 옵션은 테스트 시 적용이 안되어 개발자 확인중
# 알림 주기를 설정 (분)
# Example : 최소값 : 1분, 최대값 : 1440분 (1일)
# 설정값이 0이면 사용 안 함
# Default : 0
ALERT_GATHER_FREE_CYCLE = 30
# 운영정책 갱신 주기
# Example : 최소값 : 1분, 최대값 : 1440분 (1일)
# 설정값이 0이면 사용 안 함
# Default : 0
POLICY_UPDATE = 30
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5431
5427,[DBSAFER5] [TIP] [﻿pnp_connector] 커스텀 쿼리 작성시 참고 쿼리(예시) / 문서,"[이슈내용]
- pnp_connector 에서 제공하는 접속세션/접속명령어에 대한 뷰테이블은 아래 ""첨부파일""과 같다
첨부파일 : pnp_connector_로그테이블_정의서_20210105
위 내용에 대해 테이블에 대해 매핑에 대한 어려움이 있어, 커스텀으로 작성해 보았으며, 참고 바랍니다.
[담당자 뷰테이블 요청 정보]
대상서버, 보안계정, 접속IP, 어플레케이션, DB계정, 인스턴스, SQL명령어, 접속시작 ,종료시작
[작성쿼리]
SELECT
IFNULL(
(SELECT name FROM dbsafer3.services S WHERE no = U.service_no),
(SELECT name FROM dbsafer3.services_history S WHERE no = U.service_no ORDER BY revnum desc limit 1)
) AS svc_name, -- 서비스명
U.ldap_sno, -- 보안계정
U.clt_ip, -- 접속IP
U.application, -- 어플리케이션
U.id, -- DB계정
U.sid, -- 인스턴스
Q.query, -- 실행 쿼리
U.in_time, -- 접속시간
U.out_time -- 종료시간
FROM
dbsafer_log_2022_07.db_query_20 Q
LEFT JOIN
dbsafer_log_2022_07.db_user_20 U ON Q.u_index = U.index;
[첨부문서]
- pnp_connector_로그테이블_정의서_20210105
: pnp_connector에서 디폴트 DBMS 뷰테이블 생성시, 테이블 정의서
- DBSAFER 테이블 스키마.doc
: 커스텀 쿼리 작성시 참고할 문서
- [세미나]pnp_connector_custom_김주혁.pptx
: 커스텀 적용시 참고할 문서
첨부파일
DBSAFER 테이블 스키마
.doc
null
파일 다운로드
첨부파일
pnp_connector_로그테이블_정의서_20210105
.xlsx
null
파일 다운로드
첨부파일
[세미나]pnp_connector_custom_김주혁
.pptx
null
파일 다운로드",댓글 없음,https://cafe.naver.com/pnpsecure2/5427
5416,[TIP] 자동연동정책 - 미사용 정책 검색 기능 활성화 방법 공유,"[기능 설명]
- MANAGER > 관리자 > 자동연동정책 VIEW TABLE > 미사용 정책 검색 기능이 있습니다.
- 자동연동정책에 연동된 데이터의 미사용 정책에 대해 적용 시점 이후로 정책 + 최종 사용일, 미사용 일수를 검색 및 확인 할 수 있습니다.
- 이를 활성화하기 위해서는 수동으로 DB 값을 변경하며 진행해야 하기 때문에 활성화 방법 공유 드립니다.
(*포스코 custom policy 모듈로 사내 테스트를 진행하였습니다.)
[동작방식]
- 자동연동정책 테이블로 연동된 데이터를 사용하게 되면 dbsafer3 DB에 used_policy_log_ex 테이블에서 사용된 정책명, 정책번호, 사용 날짜를 확인할 수 있습니다.
- 이 테이블의 policy_name 컬럼의 데이터 중 맨 뒤에 있는 [1] 값이 정책번호 즉 column_idx 값으로 매칭되어 동작하게 됩니다.
- 이 테이블의 stat_date 컬럼의 데이터로 자동연동정책 - 미사용 정책의 최종 사용일, 미사용 일 수가 계산되어 집니다.
[기능 활성화 방법]
1. 컬럼 순서 확인
- psync DB의 posco_policy 테이블(연동 테이블)에서 컬럼 순서를 확인해야합니다.
ex) idx는 0 / sr_num는 1 / hostname은 2 / ... / account는 5 / ... / UPDATE_TIME은 13
2. DB 값 수정
- dbsafer3 DB의 custom_policy_info 테이블에 psync.posco_policy에서 확인한 컬럼 순서에 따라 데이터를 수동으로 insert 해주어야합니다.
ex) column_idx : 0 / column_server_ip : 3 / column_server_port : 4 ...
3. 필수 조건
- column_idx 에 데이터가 입력되어야 '미사용 정책 검색' 아이콘이 활성화 됩니다.
- 또한 column_idx 값은 UNIQUE 한 값이어야하고, custom_policy 모듈이 로깅하는 값이어야 합니다.
ex) 아래 사진에서 확인할 수 있는 정책명에서 대괄호 안의 [1] 값이 column_idx 값이 되어야 합니다.
* 데이터 생성 방법
- used_policy_log_ex 테이블에 사용 정책에 대한 데이터를 생성하고 싶다면 배치 모듈을 수동 실행 시키시면 됩니다.
# ./pnp_statistics date 0000-00-00 ~ 0000-00-00
[테스트 모듈 정보]
# ./dbsafer_policylinkage.sh -v
1.48
# ./pnp_custom_policy
CUSTOM POLICY Release (Rev 425, Site: posco) Jun 28 2022 16:28:45s
( POLICY-CHECK PROTOCOL VERSION INFO: v15 )
( STMP_PARSER VERSION INFO: v1.3.3479 )
( SHARED INTERFACE VERSION: 484 )
[참고 Bugs]
이와 관련된 벅스 하나 공유 드립니다.
- 벅스 : https://bugs.pnpsecure.com/view.php?id=22535
[이슈내역]
- 자동연동정책 - 미사용 정책 검색 기능 사용 중 '최종 사용일', '미사용 일 수'가 나오지 않는 현상
[원인]
- 정책명에 [] 대괄호가 있을 경우 used_policy_log_ex 테이블에서 policy_name 컬럼의 값의 정책 번호를 정상적으로 읽어오지 못하는 현상 발생
[요청사항]
- used_policy_log_ex 테이블에서 policy_name 컬럼의 값을 읽어올 때 맨 뒤에서 부터 읽어오도록 기능 수정 요청
[발생버전]
- Enteprise Manager 5.0.9.4 ALPHA (Build - 6350) 이하 모든 버전에서 발생 가능
[수정 이후 버전 다운로드]
- Enteprise Manager 5.0.9.4 ALPHA (Build - 6350) (pnpsecure.com)
해당 기능 설정에 도움을 주신 송재창 차장님, 안규상 차장님께 감사드립니다.
이상입니다. 감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5416
5408,[TIP][DBSAFER] DB 결과값 저장 시 행수만 저장 기능 (결과값 저장 제외),"[요약]
신세계 그룹사 DB접근제어 환경에서 인증심사 요건이 강화됨에 따라 다음과 같은 신규 기능 개발 요청을 받았습니다. (2021년 상반기)
- 요청 사항 : DB 명령어 로그에서 결과값 데이터는 저장하지 않고 '결과 값 행수'만 계산 후 로깅하도록 기능 추가
(결과값 데이터는 개인정보가 포함될 수 있기 때문에 저장하지 않음)
* 신규 기능 적용은 연구소, 품질혁신실분들과 기능 및 성능 테스트 등 안전성에 대해 충분히 검토 후 확대 적용했습니다. (2021년 하반기)
[지원 버전]
해당 기능은 특정 버전 이상의 1) DBMS 서비스 데몬, 2) 매니저 환경에서만 사용 가능하기 때문에 패치가 필요합니다.
1) DMS 서비스 데몬
- DBSAFER 서버 패키지 R21.09 버전 이상부터 지원되며 해당 패키지에 포함된 모든 DBMS 서비스 데몬에서 지원합니다.
* 지원하는 DBMS 서비스 데몬 종류는 다음과 같습니다. (신세계 환경에서 운영 중인 8개의 DBMS 서비스 종류 지원)
1. pnp_mysql, 2. pnp_ ora, 3. pnp_mssql, 4. pnp_postgresql, 5. pnp_teradata, 6. pnp_tibero, 7. np_hanadb, 8. pnp_udb
2) 매니저
- Build-6025 이상
[기능 사용방법]
가. 매니저 기능 활성화
- 시스템 설정의 '정책 동작 설정'탭에서 '결과값 저장 시 행수만 저장 기능 사용' 기능을 활성화합니다.
시스템 설정(정책 동작 설정) 기능 활성화
- 기능 활성화 시 다음과 같이 서비스 데몬 패치 필요 알림이 출력되며 확인을 클릭합니다.
알림 팝업(서비스 데몬 패치 필요)
나. 정책 설정
해당 기능을 사용하기 위해서 별도의 정책 설정이 필요하며 'DBMS 권한제어정책' 또는 'DBMS 결과값제어정책'에서 정책을 생성할 수 있습니다. (정책협의 및 선택사항)
1. DBMS 권한제어정책
- 정책 동작 부분의 로그 기록 설정 부분에 '행수만 저장' 기능을 체크 후 적용합니다.
2. DBMS 결과값제어정책
- 정책 동작 부분에서 '행수만 저장' 기능을 체크 후 적용합니다.
[테스트 내역 및 결과]
결과값제어정책에 별도의 '행수만 저장' 하는 정책을 생성 후 명령어 실행에 대한 로깅 결과를 확인합니다.
1. 결과값제어 정책 생성
결과값제어정책 추가
DBMS 결과값제어정책(상세) - '행수만 저장' 기능 활성화
2. 명령어 실행에 대한 로깅 결과
• 실행 쿼리 : SECLECT * FROM dbsafer3.dbsafer_ldap_list
• 실행 결과 : 1178명의 ROW 결과 응답 처리 (정상), '결과 값 상세' 내역의 데이터 없음
• 실행 쿼리 : SECLECT * FROM dbsafer3.services
• 실행 결과 : 1698개의 서비스 ROW 결과 응답 처리 (정상), '결과 값 상세' 내역의 데이터 없음
[참고 Bugs]
https://bugs.pnpsecure.com/view.php?id=20349
https://bugs.pnpsecure.com/view.php?id=20509",댓글 없음,https://cafe.naver.com/pnpsecure2/5408
5402,[TIP] SSH 공유키(public key) 접속하기(DBSAFER 설정 방법 포함),"SSH 공유키(public key) 접속하기(DBSAFER 설정 방법 포함)
[보안대상서버 설정]
1. 대상서버에서 설정 변경하기
[root@dbsafer82 .ssh]# vi /etc/ssh/sshd_config
PubkeyAuthentication yes
AuthorizedKeysFile .ssh/authorized_keys
[root@dbsafer82 .ssh]# service sshd restart
Stopping sshd: [ OK ]
Starting sshd: [ OK ]
2. 키생성하기
[root@dbsafer82 ~]# ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa):
/root/.ssh/id_rsa already exists.
Overwrite (y/n)?
[root@dbsafer82 ~]# cd /root/.ssh/
[root@dbsafer82 .ssh]# ls
authorized_keys id_rsa id_rsa.pub known_hosts
[root@dbsafer82 .ssh]#cat id_rsa.pub // 아래 내용을 authorized_keys 에 붙여 넣기
ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAwDYPF5bg/QTIUrlHRdurHaN+6bkw1NrunSli30N+J86h2cdoFgyRPw1/ngRnllAGoWN9gEfx2tZUiiiNEf+gX24 MA/k2LpspG8P5LNVyF08nNMUNOvHA9qe5CqXrR17iIl76waZK4xJPUMsrvU6271w6GrN9CLbTEtWx+85S2uQ0GCAU869ZbG/vCFGxhTGRNopBYBzrbp8suAE2ty BP2YfsV2ij7WuAZCx0hancjwq+FSa2dmGS8RH6WnLvgt9BZ52lZeySqMoIXjhaSwAd9HgzQg7jqvcYfkHQHvV3wKb+i8kzPDYWLkL3SZIfdiCSd7UcxtXpw7G3p UgWPs/Xbw== root@dbsafer82
[root@dbsafer82 .ssh]# vi authorized_keys
ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAs8HOAmSunhaU0Y/yxGNA8YgP+lF97/ltYY26ZbVZODYGfQ3pRaPZo2HaAXdidmxoBhBjnBdrc5cZR91cvGoOMg9 nlTF1nAgb1g5kEnx8Og4SF2cAbNjV+o/oS755ygC92Ts2Y90PHek272yqZz4/hPUQf3xr4E30V8ZVzMkc8pR1JGzRGyA6rT3UTgGpVScFBcLFyzLYrWaKC1TWmx 5T2yoOrllxu/GjR6/AGzwuM9sCNsma9HnH0304mlffyjwGRajolhjR3zHZvLX1PZGuYFqQrFijZ7UIkd7Xk7JtRTfyw2v+Xw3u5VGSA8AL3BYmBVD4EMz+10ECu QAE8ZFwkQ== root@dbsafer
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDTtM8clQ8/Q/O/0HF3ETMaMH+mvNCl5ab9gJNEiWR5L1Cdma1cN+IT0aixpVLx1eSZyYvw7rhQNt8JnrEzQNX wP/keOxWCPFS+mhn3UNpWCyiPjEr6XftxE2EKK3v7+oDHsKgRX0zRkOyjNncVwji2KQEr9D1Amwd3wVIaTSra77RaPkNEpD/ya1Q6l/TgqsYIS/6OLzVMT6TT9N 5omxv7vgSYnj4uHKwssdHzBexNe7WjZRT4kA/pXI9DodF5zisHsghRoZn4fiIjSx/dmXVZpmODUAKeuqmz2tjm032OK1rXhXk9Ni7lbyzy/m5meNeNzFXIxeNvo /wd8qLlE4eP root@dbsafer
ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAwDYPF5bg/QTIUrlHRdurHaN+6bkw1NrunSli30N+J86h2cdoFgyRPw1/ngRnllAGoWN9gEfx2tZUiiiNEf+gX24 MA/k2LpspG8P5LNVyF08nNMUNOvHA9qe5CqXrR17iIl76waZK4xJPUMsrvU6271w6GrN9CLbTEtWx+85S2uQ0GCAU869ZbG/vCFGxhTGRNopBYBzrbp8suAE2ty BP2YfsV2ij7WuAZCx0hancjwq+FSa2dmGS8RH6WnLvgt9BZ52lZeySqMoIXjhaSwAd9HgzQg7jqvcYfkHQHvV3wKb+i8kzPDYWLkL3SZIfdiCSd7UcxtXpw7G3p UgWPs/Xbw== root@dbsafer82
[DBSAFER 설정]
[root@dbsafer85 dbsafer]# ./ssh -v
ssh_p6 version SSH_DBSAFER_2.32.66
[root@dbsafer85 dbsafer]# ./pnp_sshd -v
sshd version SSH_DBSAFER_2.30.164
[root@dbsafer85 dbsafer]# ./pnp_telnet -v
Telnet Release version 3.3.359 128bit -SafetyCMD for RelTBINC-CentOS7
Build (3359) Build-Update (Sep 14 2020 10:26:33) MAX-USER : 1000
MAIN VERSION 3.7 (20150812)
ADDED OPTION STATUS: NONE
COMMON MAIN MODULE VERSION: 3.3.359 128bit -SafetyCMD
COMMON LIBRARY VERSION: 3287
COMMON POLICY MODULE VERSION: 1.2.19
COMMON CERTIFICATION MODULE VERSION: V3
COMMON 2FACTOR PROTOCOL : v2
SHARED INTERFACE VERSION: 429
COMMON-API(UTIL) VERSION: 87
[root@dbsafer85 .conf]# pwd
/dbsafer/.conf
[root@dbsafer85 .conf]#mkdir ssh_key
[root@dbsafer85 .conf]#cd ssh_key
보안대상서버의 프라이빗 키인 id_rsa 파일을 업로드 한다.
[root@dbsafer85 ssh_key]#mv id_rsa 4_root.key
[root@dbsafer85 ssh_key]#ls
4_root.key
4 : 서비스 객체 번호 (매니저 - 객체/그룹관리-서비스 - TERMINAL - 객체 번호)
root : 계정명
[주의] [pnp_sshd/ssh][v2.30.127, v2.32.26] IP가 아닌 서비스 번호로 지정하는 설정은 해당 버전 상위 버전 부터 사용가능
[SecureCRT 접속 설정]
아래와 같이 설정 하여 공유키 접속을 진행하면 패스워드 없이 서버에 로그인 가능
[참고사항] [기능 제약 사항] // 품질혁신실에서 제공해 주신 기능 제약 안내 사항
--> ssh-keygen에서 키에 대한 암호를 입력하는 경우 key인증 과정에서 ID/PW에 해당 하는 Password가 아닌 Key생성에 사용된 Password를 추가로 요구하는데, 이에 대
한 기능은 지원하지 않는다.
--> 보통의 경우 추가적인 암호 입력의 불편과 암호 노출의 위험을 없애고자 key인증 방식을 사용하기 때문에 Password 인증 방식은 잘 사용하지 않는다.
--> P6 패키지에서는 ssh 와 sftp 파일만 복사하여 사용하고, 나머지 파일은 P3의 최신 파일을 사용한다. 또는 모든 패키지 파일은 P3의 것만 사용한다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5402
5379,[TIP] Server Agent 관리대상 모니터링의 'Agent 정지' 기능 사용 후 ./start.sh 통한 재 시작 시 유의 사항,"Server Agent 관리대상 모니터링의 'Agent 정지' 기능 사용 후 Server Agent 재 시작을 서버에 접속하여 start.sh을 통해 수행하게 될 경우 유의해야할 사항에 대해 공유드립니다.
'Agent 정지' 버튼으로 Server Agent를 정지할 경우 서버의 Server Agent가 정지 됨과 동시에 LOG 서버의 nodesafer_except.conf 파일에 대상서버 IP를 기록하게 됩니다.
agent 정지
nodesafer_except.conf
nodesafer_except.conf에 기록된 IP를 가진 서버의 Server Agent는 Bypass로 상태를 표시하게 됩니다.
이 상태에서 대상서버 접속 후 ./start.sh을 통해 server agent를 가동하게 될 경우 resource_view와 server_agent 프로세스는 가동되지 않고 관리대상 모니터링에 'server agent 장애'로 표시하게 됩니다.
(+ alias.conf, access.rules 정보 받아오지 않음)
Server Agent를 정상 가동하기 위해서는 nodesafer_except.conf에 기록된 IP를 Clear 해야하며 이는 관리대상 모니터링에서 'Agent 시작'을 수행할 경우 처리됩니다. (또는 vi 편집기로 수동 삭제)
Agent 시작
IP clear
일반적으로 관리대상 모니터링에서 'Agent 정지' 후 'Agent 시작' 하게될 경우에는 발생하지 않지만 'Agent 정지' 후 서버에서 직접 ./start.sh 를 사용하였을 때 Server Agent가 정상적으로 가동되지 않는 경우 해당 내용 참고하시기 바랍니다.","진선태: 해당 기능은 오해가 없도록 수정 요청 해야 하는 것 아닌지요?
이유가 있어서 BYPASS IP에 등록한 것이지만, 해당 BYPASS IP는 차단과 모니터링을 하지 말라는 뜻이지, 해당 IP에서 오는 관리 신호까지 무시하라는 뜻이 아닐 것입니다.

동작이 정확히는 기억나지 않지만 의도된 동작이 아니라면 엔지니어 실수를 줄이기 위해서 개선이 필요할 것으로 보입니다. | 류현수: 해당 내용 개선 가능 여부 확인 진행하도록 하겠습니다.
감사합니다.",https://cafe.naver.com/pnpsecure2/5379
5377,[공유] DBSAFER 7.0 환경에 saferuas 사용 시 설정,"[이슈 사항]
- DBSAFER 7.0에 saferuas 사용 시 에러 발생
. Mail 상세 설정 중 제목, 내용에 한글 입력 후 OTP Key 발급 기능 사용 시 미동작 및 로그파일에 에러 출력
saferuas 메일 설정
saferuas 로그 내용
[이슈 확인]
. DB 테이블 인코딩 차이로 오류 발생 (saferuas 기본 인코딩 : ms949)
. DBSAFER 5.0 default 인코딩 설정 값은 latin1으로 saferuas 사용 시 문제되지 않음
. DBSAFER 7.0 default 인코딩 설정 값은 utf-8으로 saferuas 사용 시 에러 발생 및 미동작
[조치 사항]
- /home/webapps/saferuas/config에 있는 config.properties 설정변경
# DB Encoding type ex) UTF-8, MS949
DB.ENCODING = UTF-8
- /dbsafer/.conf/pnp_mailer.properties 설정변경
# set CharterSet
charterSet = UTF-8
# 자동 인코딩설정을 수행할지 여부를 설정함. (default:0)
# 0 - not use (latin 기준으로 메시지를 전달)
# 1 - use (메시지의 인코딩 확인 후 문자열을 인코딩 변환하여 전달)
set_charterset_command = 1",댓글 없음,https://cafe.naver.com/pnpsecure2/5377
5372,File Descriptor 초과 알람 2편(임시조치 2편),"[개요]
# File Descriptor 초과 알림 1편(임시조치)를 확인 하던중 추가 확인된 사항 입니다.
아직 정확하게 연구소에서 확인 된 사항은 없으나(확인요청해 놓음) 우선 임시로 아래와 같이 대응하시면 큰 문제는 없을것 같습니다.
[증상]
dbsafer의 각데몬(pnp_agent,pnp_log,pnp_.........)이 지정된 fd갯수(1024개)가 초과되는 경우 해당 데몬이 CPU100%를 지속적으로 유지합니다.(현재 pnp_log데몬에서만 발생하였으며, fd갯수가 초과 알람이 지속적을 발생함)
[증상 발생 예상 이유]
해당 증상은 SK케**에서 발생되어 확인하였으며, PM때 서버 재시작 후 pnp_log의 fd 갯수가 1024개로 자동 셋팅되었고 몇개월 사용 도중 fd사용 초과 증상이 발생 한것으로 예상. Gateway와 Log서버의 분리된 상태에서 Gateway와 Log서버의 통신 불안 상태로 인한 Log서버에서 열고 있는 소캣을 정리하지 못하여 1024개의 fd값을 초과하는 상황이 발생한것으로 예상됨.
[확인 방법]
- 해당 데몬 최대 fd limit : cat /proc/{pid}/limits
- 현재 열려 있는 소캣 : lsof | wc -l
- 현재 해당 데몬이 사용하고 있는 fd갯수 : ls /proc/{pid}/fd | wc -l
# 초기 서버가 부팅시에는 DBSAFER 데몬들의 fd limits는 1024개로 되어 있습니다.
cat /proc/{pid}/limits
# 서비스를 수동 재시작할 경우 65535개로 변경 됩니다.
cat /proc/{pid}/limits
[결론 및 해결방법]
서버가 재부팅되면 fd가 기본 1024개로 설정되고 데몬 재시작시 /etc/security/limits.conf를 읽어 65534개로 설정되는 것 같습니다.
※ 서버 재시작 후 필히 모든 데몬을 재시작하여 df갯수를 늘리시기 바랍니다.","김태윤: ""/etc/security/limits.conf"" 에 아래와 같이 설정되어 있으나, OS 구동 후 DBSAFER 모듈 구동 시 아래의 설정이 적용되어 있지 않은 상태에서 시작되어 기본 설정인 ""open files 1024"" 로 구동 되는 현상이 확인되었습니다.

대처 방안으로는 ""/etc/init.d/pnp"" 파일에 ""ulimit -n 65534"" 정보를 추가 설정하시면 됩니다.

PKG에 반영하는 부분에 대해서는 추후 논의하여 적용할 수 있도록 하겠습니다.

- /etc/security/limits.conf 파일의 open files 정보
# DBSAFER CONFIGURE
* hard nofile 65534
* soft nofile 65534

-/etc/init.d/pnp 설정 정보

#!/bin/bash

#PKG_DBSAFER5_RelR20.05C-CentOS7_x86_64_P9.11_20200915

PRODUCT_HOME=/dbsafer
export PRODUCT_HOM | 황원순: PKG에도 필히 반영이 되면 좋을것 같습니다. 감사합니다. | 황원순: 또 한가지 중요한 것은 ""Gateway와 Log서버의 분리된 상태에서 Gateway와 Log서버의 통신 불안 상태로 인한 Log서버에서 열고 있는 소캣을 정리하지 못하여 1024개의 fd값을 초과하는 상황이 발생한것으로 예상됨.""

서버의 ""net.ipv4.tcp_keepalive_time = 7200""로 되어 있음에도 불구하고 소캣이 클리어 되지 않은 이유도 확인이 되어야 할것 같습니다.",https://cafe.naver.com/pnpsecure2/5372
5360,"[공유] pnp_oms_dms v2 & saferuas 사용 시, 비밀번호 변경/잠금해제가 되지 않는 현상 (+oms_dms v2에 대한 설명)","안녕하세요. 기반검증팀 김하림입니다.
pnp_oms_dms v2 & saferuas 사용 시, 비밀번호 변경 / 잠금해제가 되지 않는 현상과 수정 내용에 대해 공유드립니다.
+ pnp_oms_dms v2 모듈에 대한 정보는 글 하단에 간단하게 기술했습니다.
[환경 버전 정보]
✅ pnp_oms_dms v2
✅ saferuas V2.0.40.0
[상황]
- PC Assist에서 비밀번호 변경 / 잠금해제를 했는데 변경이 되지 않음
→ 계정 잠금 해제를 했는데도 PC Assist로 로그인 시도를 하면 계정이 잠겨있다고 뜸
잠금 상태가 아닌 계정
잠금 해제가 되었으나, PC Assist 로그인 시에는 잠겨있다고 뜸
[내용]
- pnp_oms_dms v1 모듈은 DB에 접속하여 보안계정 정보 및 로그인 정보를 가져왔으나, pnp_oms_dms v2 모듈은 메모리에 있는 정보를 가져오기 때문입니다.
- 현재 saferuas를 통해 비밀번호 변경 / 잠금해제를 할 경우, DB에서는 값이 변경되지만 pnp_oms_dms v2 모듈의 캐시메모리에는 해당 값이 변경되었다는 시그널이 없어 PC Assist 접속이 되지 않습니다.
- pnp_oms_dms 공유메모리를 삭제하고 (./pnp_oms_dms delete_shm) pnp_agent를 통해 정책을 배포하면(./pnp_agent policy-broadcast) 접속 가능한 것을 확인 가능합니다.
∴ saferuas V2.0.48. 버전에서 pnp_oms_dms로 정책 변경 신호를 줄 수 있는 설정을 추가하였습니다.
> saferuas V2.0.50.1 이상 버전을 사용하시면 됩니다.
> https://bbs.pnpsecure.com/showthread.php?tid=11011
[수정 확인 내용]
- 기존 saferuas V2.0.40.0 버전의 엔지니어 페이지
- 수정된 saferuas V2.0.50.1 이상 버전의 엔지니어 페이지
[saferuas] oms_dms 포트로 정책 변경 신호 전달하는 설정 추가
- 로그인 결과
시그널 전송 설정을 하면 변경한 대로, PC Assist 접속이 가능합니다.
> pnp_oms_dms v2 모듈이란?
- pnp_oms_dms v2 모듈은 DB를 참조 / 제어하는 빈도수를 최소화하여 장애발생 확률을 줄이도록 개선한 모듈입니다.
- DB 장애 발생 시에도 서비스를 정상적으로 제공하기 위해 프로세스 내 인사정보를 캐싱하며, 해당 메모리를 대상으로 조회 / 제어 기능을 수행합니다.
- 정책정보(서비스 목록과 접근정책)를 캐시메모리에 관리하고 있어, 해당 정보는 정책변경 신호 수신 시 (UDP : 50011) 갱신을 수행하고 있습니다.
v1 / v2 모듈 비교
pnp_oms_dms v2 모듈 정보
이상입니다.
감사합니다.","서재영: 2대 이상의 gw 서버로 운영할 경우 saferuas 엔지니어 페이지에 있는 OMS_DMS IP 설정은 ' , '(쉼표) 혹은 ' '(공백)으로 구분하면 되나요? | 김하림: 안녕하세요! 답변이 살짝 늦어졌습니다.
해당 설정은 ',' (쉼표)로 구분 가능합니다.
감사합니다 ^^",https://cafe.naver.com/pnpsecure2/5360
5354,File Descriptor 초과 알람 조치 1편(임시 조치),"# 관련 모듈 : pnp_log,pnp_watcher
# 증상 : 현재 pnp_log데몬에서 80% 이상 fd사용하게되면 pnp_watcher에서 알람을하게 설정되어 있습니다.
# pnp_log데몬이 최대 열수 있는 File Descriptor : 1024개
# pnp_log데몬이 현재 열고있는 File Descriptor : 877개
# pnp_watcher에서 알람을 80%가 아닌 100%로 일때 알람하도록 설정하는 방법
pnp_watcher.conf ==> CRITERIA_OF_OPEN_FD=100 추가","윤효정: 안녕하세요, 이사님!
해당 이미지가 '존재하지 않는 이미지'로 보입니다. | 황원순: 수정하였습니다.",https://cafe.naver.com/pnpsecure2/5354
5352,[TIP] pnp_oms_dms v2 버전 패치 시 주의 사항,"1. pnp_oms_dms v1 -> v2 버전 패치시 주의 사항
[개선내용]
- 인사정보 테이블 과부하 방지
dbsafer_ldap_list 테이블의 접근도를 낮추어, 장애발생 확률을 감소하도록 하였습니다.
- 접속접속 유실 방지
oms_access 테이블의 PK 가 접속지 정보(ip / ipaddr_priv / unikey)에 한하여 구성된 관계로,
동일한 접속지에서 2개 이상의 보안계정을 번갈아 사용할 경우, 접속지 정보 기준으로 최종 접속한 보안계정 외의 기록은 유실(덮어쓰기)되며,
이에 대한 영향으로, DBSAFER Manager 에서 보안계정의 ""로그인 IP주소""가 일부 미표시 될 수 있습니다.
- 입력 처리 속도 개선
보안계정 로그인 상태 정보 입력/수정 시, 보안계정 + 접속지 정보 를 기준으로 수행하기에, 해당 필드를 PK로 할 경우 SQL 수행 속도가 개선됩니다.
- 기능 추가 건 사전 대응
보안계정 별 멀티 로그인 모드 기능을 개발하기에 앞서, 보안계정의 로그인 상태정보를 싱글/멀티 로그인 모드의 구분 없이 한 곳에서 관리함이 필요합니다.
2. 패치시 사전 확인 사항
- 인사연동 모듈 사용 여부
v1.123 이상 버전으로 패치 필요(보안계정 객체 정보 변경 시, 정책 변경 여부를 검사하지 않는 시그널 전송 기능 추가)
- 별도 고객사 요청으로 별도 개발 모듈이 DBSAFER DB에 직접 DB에 INSERT하는 모듈이 있는 경우 UDP 3121로 시그널 전송하는 기능 포함 여부 확인 필요
*pnp_oms_dms v2 모듈의 경우 공유메모리에 보안계정 정보를 메모리상에서 처리하기 때문에 v1버전 처럼 직접 DB에 실시간 질의하지 않기 때문에 pnp_oms_dms v2 사용시 연동모듈에서 UDP 3121로 정책 갱신 시그널 전송 하는 기능이 필수로 포함되어야 합니다. 시그널을 전송하지 않을 경우 신규로 추가된 보안계정은 DB에는 정보가 있으나 공유메모리에는 정보가 없기 때문에 로그인 시도시 실패가 됩니다.
3. 원복 방법
금번 개선된 모듈(oms_dms)로 패치 후, 기존 모듈(리팩토링 미반영 버전)로 다운그레이드 할 시, 아래의 절차에 준하여 진행 부탁드립니다.
1. 모듈 종료 (개선된 모듈)
# ./pnp_oms_dms stop
2. 공유메모리 삭제
# ./pnp_oms_dms delete_shm
3. DB 정리 (접속지 정보 기준 중복 사항 제거)
- (MySQL/MariaDB 접속)
- use dbsafer3
- DELETE T1 FROM oms_access T1 JOIN (SELECT ip, ipaddr_priv, unikey, MAX(lastaccess) AS lastaccess FROM oms_access GROUP BY ip, ipaddr_priv, unikey) T2
ON T1.ip=T2.ip AND T1.ipaddr_priv=T2.ipaddr_priv AND T1.unikey=T2.unikey WHERE T1.lastaccess<T2.lastaccess;
4. 모듈 시작 (이전 버전 모듈)
# cp pnp_oms_dms /dbsafer
# cd /dbsafer
# ./pnp_oms_dms start","김하림: pnp_oms_dms v2 패치 시 주의사항 내용 추가합니다.

> saferuas를 통한 2차 인증 사용 시, saferuas V2.0.50.1 이상 버전을 사용해야 합니다.
> 관련 내용은 아래 글에 정리해 두었으니 참고 바랍니다.
https://cafe.naver.com/pnpsecure2/5360

감사합니다. | 김하림: 멀티로그인 테이블 변경 관련 글 공유 (pnp_oms_dms v2 모듈)

https://cafe.naver.com/pnpsecure2/5453",https://cafe.naver.com/pnpsecure2/5352
5351,[TIP] pnp_duplex 특정 테이블 crash 발생시 failover 조건 추가 방법,"LOG서버 이중화 구성시 pnp_duplex모듈을 통해 LOG#1(Active)서버 장애시 LOG#2(Standby)서버로 전환을 시켜줍니다.
1. 개요
- pnp_duplex에서 failvoer 조건 중 DB체크하는 옵션은 select 1 쿼리 명령어로 통해 상태 체크를 하게 되어 있습니다.
쿼리로 상태체크를 하기 때문에 특정 테이블에서 crash 발생시 failover 전환를 하지 못 합니다.
이를 해결 하기위해서 별도로 중요한 테이블에 대해서 지정하여 해당 테이블이 crash 발생시 failover 전환할 수 있도록 옵션이 추가되었습니다.
[DB Check 옵션]
repository_check_term = 10
repository_connection_timeout = 3
repository_read_timeout = 2
ex) dbsafer_ldap_list, oms_access테이블에서 crash 발생시 Manager 로그인 불가, 사용자 인증 불가 등으로 인해 장애가 발생됩니다. 기존 DB Check옵션만 적용을 하였을 경우 select 1로 상태체크시 정상적으로 응답값이 오기 때문에 pnp_duplex모듈은 정상 동작하고 있다고 판단하기 때문에 Failover로 전환되지 않습니다.
target_table_to_check_crash 옵션을 추가로 지정하게 되면 위의 테이블에서 crash 발생시 체크하여 Failover로 전환하여 운영은 문제없이 전환할 수 있습니다.
2. 옵션 정보
[pnp_duplex_active.conf]
##################################################################
# Table crash check
#
# If table crashed founded, it will test every seconds.
#
# 'target_table_to_check_crash' field is empty default, and it indicates disabled.
# Separate table names with ','
#
# 'crash_check_term' is interval to check tables. unit is seconds,
# and default value is 10(seconds)
#
# connection timeout field is used for set timeout during connection.
#
# read timeout field is used for set timeout during query.
# actual time about read timeout is (read_timeout x 3)
#
#####################################################################
target_table_to_check_crash=dbsafer_ldap_list,oms_access
- 중요 테이블 지정하여 crash 발생시 failover조건 설정
crash_check_term=60
- 체크시간/횟수 지정
crash_check_conn_timeout=0
- 기본값
crash_check_read_timeout=0
- 기본값
3. 지원하는 버전 정보
- trunk버전도 지원은 하지만 R21.09R7 릴리즈 PKG에 포함된 pnp_duplex(Rev 128) 부터 지원",댓글 없음,https://cafe.naver.com/pnpsecure2/5351
5349,[TIP] pnp_policysync 주기적 동기화 옵션 추가 방법,"1. 개요
- pnp_policsync 모듈을 통해 정책/객체 정보를 동기화를 할 수 있는 모듈입니다.
2. 개선내용
- Rev100미만 버전에서는 pnp_policysync 모듈은 Manager에서 수정작업이 발생했을 경우 UDP 3126으로 LOG#2(Standby)서버로 동기화 시그널을 전송하게 되어 있습니다.
- Manager를 통해 정책/객체 추가/변경/삭제 등의 작업이 이루어 질 경우 Active/Standby서버의 동기화는 문제가 발생하지는 않습니다.
- 예외 사항으로 발생하는 케이스는 고객사 요청으로 인하여 DBSAFER DB에 직접 DB에 데이터를 INSERT하는 고객사에서는 Active/Standby서버간 데이터 무결성이 깨지게 됩니다.
- 직접 DB에 INSERT를 하기 때문에 별도로 UDP 3126으로 동기화 시그널을 보내지 않아 관리자가 며칠동안 Manager에서 작업한 이력이 없을 경우 Standby서버에서는 데이터가가 Manager에서 마지막으로 작업했던 데이터로 가지고 있게 됩니다.
.ex) 보안계정 신청 기능이 적용된 고객사에서 LOG#1(active)서버에 직접 DB에 INSERT를 하게 된다고 과정한다면 해당 정보는 LOG#1(active)서버 dbsafer_ldap_list에만 등록이 되어 있을 뿐 LOG#2(Standby) 동기화 시그널 전송하는 기능이 없기 때문에 LOG#1(active)/LOG#2(Standby) 보안계정 등록 개수 및 최신화가 되어 있지 않게 됩니다.
- 이를 개선하기 위해 pnp_policysync모듈에서 주기적으로 동기화 할 수 있도록 옵션이 추가 되었습니다.
3.옵션 정보
## Interval of sync policy(min)
## If value is 0, do not use sync interval
## Default : 0
sync_interval=180
- 분단위로 설정이 가능하며 pnp_policysync모듈 최종 동기화 시점부터 시간계산되어 동기화 진행
ex) 6시30분에 마지막 동기화를 하였다면 3시간 뒤인 9시 30분에 동기화 진행
4.지원하는 버전 정보
- pnp_policysync rev100 이상 부터 지원",댓글 없음,https://cafe.naver.com/pnpsecure2/5349
5284,[TIP]prefix가 'dbsafer'인 서버의 OpenSSL DOS 취약점 조치(CVE-2022-0778),"prefix가 'dbsafer'인 서버에서 OpenSSL DOS 취약점 조치 스크립트(patcher.py)를 실행할 경우 아래와 같은 에러 메시지를 확인할 수 있습니다.
patcher.py스크립트를 열어보면 78번째 라인에 set_ld_path라는 함수가 선언되어 있고 해당 함수에는 '/etc/rc.d/init.d/pnp' 경로를 체크하는 부분이 있는데 prefix가 'dbsafer'로 설치되어 있을 경우 서비스명이 'pnp'가 아닌 'dbsafer'로 등록되어 있어 해당 에러가 발생합니다.
따라서 79번째 라인의 '/etc/rc.d/init.d/pnp' 경로를 '/etc/rc.d/init.d/dbsafer'로 변경후 스크립트를 실행시키면 정상동작을 하게 됩니다.
이상입니다.
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5284
5272,[TIP] NAT 환경에 DBSAFER 구축 시 RDP 세션재현 기능 사용 방법,"NAT 환경에 DBSAFER가 구축된 경우 RDP 세션재현 기능을 사용할 수 있는 방법입니다.
RDP Replayer가 wta_player에 연결되지 않아 문제가 발생하는 상황으로 SSH, Telnet 서비스의 세션재현과는 관련이 없습니다.
[요약]
- 클라우드 등 NAT 환경에 DBSAFER를 구축한 경우 이슈를 겪을 수 있습니다.
- 세션재현이 되지 않는 경우 시스템 설정(세션재현 데이터를 로그서버에서 조회) 활성화하여 조치할 수 있습니다.
[환경 및 이슈사항]
- DBSAFER 서버는 공인 IP 주소(3.39.177.250), 사설 IP 주소(172.31.19.109)를 가지는 상태
- DBSAFER는 사설 IP 주소로 설정되어 있으며, 대상 서버와는 사설 IP 주소로 통신
- DBSAFER Manager는 공인 IP 주소를 입력하여 접속
- Manager에서 세션재현 시 사설 IP 주소로 접속을 시도하며, RDP Replayer가 wta_player에 연결되지 않아 세션재현에 실패
세션재현 실패
세션재현 시 DBSAFER의 사설 IP 주소로 접속 시도
[해결 방안]
- 세션재현을 위해 시스템 설정에서 아래 옵션 활성화
- 세션재현 데이터를 로그서버에서 조회 기능 활성화 시 사설 IP 주소가 아닌 공인 IP 주소로 wta_player에 연결을 시도하며, 정상적으로 세션재현되는 것을 볼 수 있습니다.
DBSAFER 시스템 설정
세션재현 정상 동작
세션재현 시 DBSAFER의 공인 IP 주소로 접속 시도
[참고 자료]
- https://bugs.pnpsecure.com/view.php?id=7041","박상원: 세션재현 옵션이 분산되어 있기도 하고, 관련 설정명을 통해 기능 예측이 어려운 부분이 있어 수정이 되었으면 합니다.",https://cafe.naver.com/pnpsecure2/5272
5266,"[TIP] 권한제어정책 SQL유형 ﻿""execute"" 사용 중 ""exec"" 명령어로 동작 시 정상 동작하지 않는 현상 (MSSQL)","[이슈내역]
- DB : MSSQL
- [권한제어정책] - [테이블/컬럼 및 명령어] - [SQL 유형] ""execute"" 사용 중 ""exec"" 명령어로 동작 시 ""execute"" 정책을 적용받지 않는 현상 발생
- 사용자가 ""exec"" 로 명령어 동작 시 아래 사진의 '[차단] execute' 정책을 적용받아 차단이 되어야하는데, 정책을 적용받지 않아 '[허용] ALL 허용' 정책을 적용 받는 현상
[확인내역]
- 서비스 데몬에서 쿼리를 전달받은 후, SQL 유형 정책이 존재함에 따라 쿼리를 파싱하여 각 키워드별로 SQL 유형에 해당하는지 확인하는 기능이 있습니다
- 이 기능에서 키워드가 SQL유형과 일치해야만 해당 유형으로 인식하게 됩니다
ex) 'SELECT' 키워드는 SQL 유형 'SELECT'와 일치하나 'SELE' 키워드는 일치하지 않음
- 해당 기능은 최초 개발 이후로 동작 방식이 변경된 적이 없습니다.
[버전정보]
- 22.04.08 기준 모든 버전에서 발생하는 사항입니다.
(* common 3545 이하 버전)
[조치방안]
두가지 방안이 있습니다. 두가지 방안 중 한가지 방안으로 적용해주시면 됩니다.
1. common 3545 이상 버전으로 빌드 후 패치
- common 3545 버전 부터 기능이 추가되었습니다.
or
2. 권한제어객체의 명령어 부분에 해당 명령어 객체 생성
[패치 후 테스트 결과]
- 테스트 결과 : exec 로 동작 시에도 execute로 인식되어 정책이 정상적으로 동작함을 확인
[벅스] : https://bugs.pnpsecure.com/view.php?id=22164",댓글 없음,https://cafe.naver.com/pnpsecure2/5266
5264,[SAFERUAS] 미래테크 OTP ? 그리핀 (Grippin Tower) OTP ?,"Grippin Tower OTP 도 미래테크 OTP 방식입니다.
다만, 내부 로직이 어떻게 변경되었는지는 모르겠으나 최근(2021년부터) Grippin Tower 라는 이름으로 연동 요청 사례가 왔고 호출 방식과 결과값 Parsing 방식이 약간 변경된 듯 하네요.
고객사에서는 보통 Grippin Tower 도 그냥 '미래테크' 라고 표현되는 경우가 있는 듯 합니다.
엔지니어분들께서는 사이트의 OTP 방식이 미래테크 방식일 경우
saferuas 의 OTP 방식을 미래테크 / Grippin Tower 로 순차적으로 테스트 해 보시고 정상 동작하는 방식으로 대응해 주시면 될것 같습니다.
추가적인 문의사항이 있으시면 언제든 연락 주세요.
관련하여 정확한 정보를 필드에서 얻게 될 경우 공유 부탁 드립니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5264
5252,[공유] Linux vi 모드 명령어 통제 여부 확인,"Linux vi 모드 명령어 통제 관련하여 확인한 내용을 공유드립니다.
DBSAFER는 vi 모드에 대해 기본적으로 로깅하도록 설계되어 있습니다. 다만 vi 모드에서는 명령어 실행이 가능하며 이는 상황에 따라 통제되지 않고 정책 우회가 가능하기 때문에 주의가 필요할 것으로 보입니다.
아래는 vi 모드에서 명령어 실행에 대한 통제가 가능한지 확인한 결과입니다.
[요약]
- 우회접속 시 vi 모드에서 실행되는 명령어 통제 가능
. pnp_shell을 통해 명령어 통제
. server_agent.conf 옵션 중 Operation Level=2, USE_SHELL_VI_MODE=OFF 적용
. server_agent.conf의 USE_SHELL_VI_MODE는 default OFF 설정 임
- 일반접속(PC Agent 사용) 시 vi 모드에서 실행되는 명령어 통제 불가
. vi 편집기의 라인모드를 통해 명령어 실행(ssh, rm 등)이 가능하며 해당 명령어는 통제되지 않아 정책 우회 가능
. DBSAFER 감사로그에서 실행한 명령어 식별이 어려우며, OS history에도 실행한 명령어 기록되지 않음
[상세]
- vi 통제 설정 및 동작
. 관련 설정 : pnp_telnet.conf의 PERMIT_VI_MODE, server_agent.conf의 USE_SEHLL_VI_MODE
. pnp_telnet.conf 옵션은 통제 동작에 영향이 없으며 실제 server_agent.conf 옵션에 영향을 받는 것으로 확인
접속방식
DBSAFER
(pnp_telnet.conf)
대상 서버
(server_agent.conf)
입력 모드
명령어 실행
라인 모드
명령어 실행
(:!command)
비고
일반
접속
PERMIT_VI_MODE=disable
-
명령어 통제 불가
명령어 통제 불가
감사로그에서 실행 명령어 식별 불가
(첫 문자만 기록,
Proxy 한계로 보임)
PERMIT_VI_MODE=enable
-
명령어 통제 불가
명령어 통제 불가
우회
접속
PERMIT_VI_MODE=disable
USE_SHELL_VI_MODE=ON
명령어 통제 불가
명령어 통제 불가
감사로그에서 실행 명령어 식별 가능
(pnp_shell 통해서 식별)
PERMIT_VI_MODE=enable
USE_SHELL_VI_MODE=ON
명령어 통제 불가
명령어 통제 불가
PERMIT_VI_MODE=disable
USE_SHELL_VI_MODE=OFF
명령어 통제 가능
명령어 통제 가능
PERMIT_VI_MODE=enable
USE_SHELL_VI_MODE=OFF
명령어 통제 가능
명령어 통제 가능
- 일반접속(PC Agent 사용) 시 감사로그
. 정책 적용되지 않고 명령어 실행되며 작업 행위 식별이 어려움
- 우회접속 감사로그
. 정책 적용되어 실행한 명령어 차단 됨
. 다만, 모든 명령어가 완벽하게 통제되지는 않음",댓글 없음,https://cafe.naver.com/pnpsecure2/5252
5232,[TIP] 대량의 Buffer 파일 생성 시 처리방안,"해당 게시물은 평소와 다르게 Buffer 파일이 과도하게 생성되어 시스템 장애상황이 우려되거나 혹은 장애 발생 후 조치 방법에 대해 작성해보았습니다.
Buffer 파일의 생성은 정상적인 동작이므로 시스템에 부하가되지 않는경우 그대로 두는것이 좋습니다.
Disk 용량이 부족하다고하여 Buffer 파일을 삭제하는것보다 다른 파일 삭제로 용량 확보 후 감사로그를 최대한 적재해야합니다.
부득이하게 Buffer 파일 백업이 불가능 하거나, 고객사 측의 요청이 있어 삭제를 해야 할 경우 Buffer 생성 원인 분석을 위한 최소한의 로그는 확보를 해야합니다.
[ 조치 방안 ]
Case 1. 기존 Buffer 생성되던 상황보다 트래픽이 줄어 자체적으로 Buffer 파일 해소가 가능 할 경우
- 로그데몬에 접속하여 ( telnet localhost 3120 혹은 3124 ) File 수량 감소 여부 체크
- Disk 부족이 예상될경우 백업되어있는 과거 Log파일들을 삭제하여 /home 파티션의 여유공간 확보
Case 2. 대량의 Buffer 파일로 인해 Disk Full 발생 시
- 운영중인 DBSAFER 가동 중지
- 백업되어있는 과거 Log파일들을 삭제하여 /home 파티션의 여유공간 확보
- /home/dbsafer/buffer/list 디렉토리를 list_backup 등으로 임시로 변경하고 list 디렉토리는 새로 생성
- DBSAFER 재 구동 후 Buffer 파일이 추가로 발생하는지 체크하면서 Buffer writer를 활용하여 복원
- Disk Full로 인해 0 Byte 파일이 생성되었을 경우 반드시 수동으로 삭제 진행 (해당 파일 정상 처리불가)
- Disk 용량을 수시로 모니터링 하면서 복원 진행
Case 3. Disk 용량 확보 하였으나 Disk 부족 현상 재발이 예상되어 Buffer writer 사용이 어려울 경우
- Buffer 파일을 다른 스토리지 혹은 서버로 백업 진행
- SFTP를 이용하거나 서버에 NFS를 mount 하여 버퍼파일을 옮겨주어야함
- 파일은 반드시 압축하여 전송
- Buffer 용량이 TB단위로 방대 할 경우 압축 생성파일로 인해 용량이 부족할 수 있으니 분할하여 압축진행
[ 추가 정보 ]
- Disk 용량 확보 시 타 장비가 아닌 / 파티션 등 다른 파티션을 사용 할 수 있습니다. 단, 용량이 작기 때문에 추가 장애에 영향가지 않는 선에서 사용하여야 합니다.
- 파일 분할 압축 시 Buffer 파일의 네이밍 규칙을 활용하여 대략적인 용량 계산 후 압축진행을 하면 좋습니다.
- Buffer 파일의 압축률은 500MB 압축 시 15MB정도로 압축이 되기 때문에 제약사항이 없다면 압축하여 전송하는 것을 권장합니다.
- Buffer 파일의 경우 명령어 로그만 복원이 가능합니다. 세션로그는 LOG데몬의 메모리에 있습니다.
- Buffer 파일 생성의 원인 분석을 위해 트래픽 분석 모듈을 활용 할 수 있습니다. ( https://cafe.naver.com/pnpsecure2/4693 - 강현구 과장님 )
- LOG 데몬 Rev 674 이상에서 Buffer 파일 과다 생성의 대한 모니터링 옵션을 사용 할 수 있습니다. ( https://cafe.naver.com/pnpsecure2/4408 - 강현구 과장님 )","하충현: 해당 내용은 로그 또는 버퍼 파일로 인해 디스크 100% Full이 되어 장애 상황이 발생했을 때 대응 방안 입니다.

주 목적은 로그를 빠르게 삭제해서 정상화 시키는 것이 아니라
로그를 복구할 수 있는 방안에 대한 충분한 사전 고지가 되어야 한다는 것 입니다.
( -> '무조건 삭제해야 한다'가 아닌 복구 방안이 있고 여기 대해 명확히 고지를 해주는 것이 목적)

내용에도 작성이 되어 있듯이 고객사 쪽에서 복구 방안에 대해 고지했음에도 불구하고 빠른 삭제 및 복구를 요구 할 경우
최소한의 분석할 수 있는 로그를 남기고 삭제 진행이 필요합니다. | 하충현: 추가로 모든 작업이 완가 되면 점검문서에 요청에 의해 삭제가 되었는지 이관을 하였는지 명확히 알 수 있도록 협의한 내용 및 작업한 내용을 작성해야 합니다.
ex) buffer file 삭제 요청으로 삭제, buffer 압축 후 타 서버로 이관 -> 향 후 복구 필요 | 남신우: 본문에 언급된 Buffer writer 바이너리의 위치 입니다.

https://bbs.pnpsecure.com/showthread.php?tid=5082",https://cafe.naver.com/pnpsecure2/5232
5227,[TIP] mysqldump를 이용한 DB 마이그레이션 방법,"mysqldump를 이용하여 DB 엔진 및 케릭터 셋 변경 방법에 대해 공유드립니다.
[Mysqldump 명령어]
# /usr/bin/mysqldump -usafeusr -p -Q -q --opt --single-transaction [압축할 Database명] > [압축 파일명].sql
-Q : 인용 부호를 사용해서 데이터베이스, 테이블, 컬럼 이름을 둘러 쌓이도록 함(디폴트는 활성화)
-q : 테이블에 대한 열을 서버에서 한번에 한열 씩, 추출하도록 하고 추출한 열을 쓰기 전에 메모리에 버퍼링하도록 함
--opt : 빠른 덤프 연산을 실행하여 Mysql서버로 빠르게 다시 읽혀지는 덤프 파일을 생성 (디폴트는 활성화)
--single-transaction : 덤프를 하나의 트랙잭션을 이용해서 실행하도록 함
[DB 엔진 변경]
가. MyISAM -> Aria 엔진 변경전 .MYI / .MYD DB 파일(MyISAM 엔진) 확인
# cd /home/dbsafer/data/mysql/dbsafer3 && ll | grep MY
나. 엔진을 변경할 Database mysqldump
# /usr/bin/mysqldump -usafeusr -p -Q -q --opt --single-transaction dbsafer3 > dbsafer3.sql
다. vi 에디터로 dbsafer3.sql 실행 및 엔진 변경
# :%s/MyISAM/Aria/g
# :%s/PAGE_CHECKSUM=1//g
라. 엔진 변경된 sql 파일을 DB에 IMPORT
# mysql -usafeusr -p dbsafer3 < dbsafer3.sql
마. DB 접속 후 Aria로 변경된 Engine 확인
# select table_name, engine from information_schema.tables where table_schema='dbsafer3';
[캐릭터 셋 변경]
가. chg_collate 데몬 실행시 syntax ERROR 로그 발생
# [ERROR] HOST [192.168.2.181], ERRNO [1064], ERR [You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near 'COLLATE latin1_general_ci' at line 1], QRY [ALTER TABLE dbsafer3.account_lock_condition CONVERT TO CHARACTER SET COLLATE latin1_general_ci]
- chg_collate : v1.2
- MariaDB : v10.2.29
나. 쿼리 'set latin1 collate latinc1_general_ci' 로 수정 후 수동 동작시 정상 확인
# ALTER TABLE dbsafer3.account_lock_condition CONVERT TO CHARACTER SET COLLATE latin1_general_ci;
# ALTER TABLE dbsafer3.account_lock_condition CONVERT TO CHARACTER SET latin1 COLLATE latin1_general_ci;
다. .conf/chg_collate.conf 파일에 등록되어있는 테이블 수동쿼리로 CharacterSet 변경 및 확인
# .conf/chg_collate.conf
# 수동 쿼리 입력
라. 변경된 캐릭터 셋 확인
# show full columns from dbsafer3.[테이블명];
* DB Engine 변경 및 캐릭터 셋 변경 후 DB 재시작 및 mysql_upgrade 모듈 실행이 필요합니다.
글 작성에 도움을 주신 남신우 부장님, 여성구 부장님께 감사의 인사를 드립니다.","진선태: 내용 정리 잘 해 주신 것 같습니다. 리마인드 개념으로 다시 보니 좋네요. 감사합니다.

아래 추가 내용도 참고하시면 좋을 듯 합니다.

* 추가로 버전이 다른 mysql/mariadb에서 데이터 마이그레이션이 진행되었을 경우 optimize 옵션을 통해서 테이블 최적화와 크래쉬 문제 등을 사전에 체크할 수 있습니다.

* 크래쉬 사전체크와 최적화 예: mysqlcheck -u safeusr -p --optimize --all-databases
- PM작업이나 업그레이드를 위한 서비스 중단 상황에서 작업하면 됩니다.

그리고 중간에 그림 안보이는 것 있네요. 체크 부탁 드려요. ^^ | 황재필: 장애 상황을 미연에 방지할 수 있는 좋은 팁 감사합니다!
해당 내용 본문에 업데이트 하겠습니다.

추가적으로 그림이 깨지는 현상은 수정하였습니다!

감사합니다! | 서재영: 엔진 정보 변경 시 mysql dump 파일을 vi 열어서 변경 하셔도 되지만, 로그파일의 용량이 큰 경우 vi 로 파일 open 하는데 오래 걸리거나 메모리 사용율이 높아 질 수 있습니다.

쉘 에서 아래 명령어를 통해 엔진 정보 변경을 하셔도 됩니다.

# perl -pi -e 's/MyISAM/Aria/g' /home/dbsafer/backup/[데이터베이스명].sql
# perl -pi -e 's/PAGE_CHECKSUM=1//g' /home/dbsafer/backup/[데이터베이스명].sql


채널지원팀에서 작성하였던 DBSAFER 5.0 업그레이드 매뉴얼도 참고로 링크 공유 드립니다.
- 링크 : https://docs.google.com/presentation/d/1Ksg7pDcaXboqYZIgVOSpeWs0wX-gVyyj/edit?usp=sharing&ouid=108361939758658821911&rtpof=true&sd=true | 황재필: 꿀팁 감사합니다!
해당 내용 사내 테스트하여 본문 업데이트 하도록 하겠습니다.

다시 한번 감사드립니다. | 진선태: ",https://cafe.naver.com/pnpsecure2/5227
5214,[공유] 고객사 사설인증서 적용 및 도메인 적용 사례 공유,"'S사' 사설 인증서 적용 및 도메인 적용 사례 공유드립니다.
[고객사 요청사항]
- 자사 사설인증서 적용으로 웹 접속 시 빨간색 경고가 뜨지 않도록 요청
- DBSAFER IP가 아닌 도메인 적용 요청
1) PC AGENT 2차인증 시 Google Otp key 창
2) DECIDE
3) webreport
[고객사 제공]
- DBSAFER서버 DNS 네이밍
- 사설인증서 파일
존재하지 않는 이미지입니다.
[인증서 적용]
1) 최초 시도 : 제공받은 pem, key, certificate.crt파일을 이용해 pfx파일 변환 시도
# openssl pkcs12 -export -out cert.pfx -inkey private.key -in key.pem -certfile certificate.crt
-> unable to load certificates 에러발생
2) 두번 째 시도 : 문제 발생하는 certfile 명령어 제외하고 변환 시도
# openssl pkcs12 -export -out cert.pfx -inkey private.key -in certificate.crt
# Enter Export Password: (dbsafer00)
# Verifying - Enter Export Password: (dbsafer00)
-> certificate information은 나오지만 여전히 빨간색 오류 창 확인
**
3) 해결 방법 : crt파일 두 개를 하나의 pem 파일로 변환 후 pfx 변환에 사용
[도메인 적용]
1) PC AGENT 2차인증 시 Google Otp key 창
- dasitelk.ini 파일 -> dns주소로 변경
- 매니저 > 보안계정 기본 설정
2) DECIDE
# vi pnp_oms_dms.conf
- 매니저 > 결재시스템 설정
3) WEBREPORT
# cd /home/webproperties/webreport/
# vi webreport.properties
- 매니저 > 메뉴 설정
[추가정보]
- pem 파일 : PEM (Privacy Enhanced Mail)은 Base64 인코딩된 ASCII 텍스트. 개인키, 서버인증서, 루트인증서, 체인인증서 및 SSL 발급 요청시 생성하는 CSR 등에 사용되는 포맷이며, 인증서 또는 키값을 저장하는데 많이 사용
- key 파일 : 주로 openssl 및 java 에서 개인키 파일임을 구분하기 위해서 사용되는 확장자
- pfx 파일 : PKCS#12 바이너리 포맷이며, Personal Information Exchange Format. 주로 Windows IIS 기반에서 인증서 적용/이동시 활용. Tomcat 등 요즘에는 pfx 설정을 지원하는 서버가 많아지고 있음
- crt 파일 : 거의 대부분 PEM 포맷이며, 주로 유닉스/리눅스 기반 시스템에서 인증서 파일임을 구분하기 위해서 사용되는 확장자
해결에 도움주신 유우성 과장님, 한정상 대리님 감사드립니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5214
5212,[공유] MySQL Workbench 툴 사용 시 쿼리문 로깅되지 않는 현상,"고객사 PoC 진행 중 확인한 이슈입니다.
아래 내용 확인하시어 모듈 패치 바랍니다.
[요약]
- MySQL에서 서버 버전을 읽을 때 기존과 다른 패턴으로 인하여 버전 인식이 되지 않아 명령어 파싱 이상 동작 발생
- pnp_mysql 모듈 패치하여 이슈 해결 (COMMON LIBRARY VERSION 3530 이상으로 패치 필요, 릴리즈 공지 확인)
[이슈 사항]
- MySQL Workbench 8.0.23~28 버전 툴 사용 시 접속 세션은 기록되나 수행되는 쿼리문이 로깅되지 않음
. SSL/TLS 옵션 미사용 중
. MySQL Workbench 8.0.22 버전까지는 쿼리문 정상 로깅 됨 확인
. SQLyog 툴 사용 시 쿼리문 정상 로깅 됨 확인
감사로그에 명령어 등 정보가 제대로 파싱되지 않음 확인
[이슈 발생 버전 정보]
1) 툴 정보
. MySQL Workbench 8.0.23~28
2) MySQL 버전
. 8.0.28-0ubuntu0.20.04.3
3) pnp_mysql 버전
. MYSQL Release version 3.0.3 for RelR21.09-CentOS7
. MAIN VERSION 3.7 (20150812)(Rev: v2098)
. ADDED OPTION STATUS: NONE
. COMMON MAIN MODULE VERSION: 1.2.29
. COMMON LIBRARY VERSION: 3499
. COMMON POLICY MODULE VERSION: 1.2.19
. COMMON AUDIT LOG MODULE VERSION: 1.1.02
. COMMON FORMAL_QUERY MODULE VERSION: 1.1.0.1
. COMMON CERTIFICATION MODULE VERSION: V3
. COMMON 2FACTOR PROTOCOL : v2
. SHARED INTERFACE VERSION: 488
. MySQL PARSER MODULE VERSION(DBParser:MySQL): 1.0.3(3441:3499)
. SQL SYNTAX PARSER MODULE VERSION: 1.3.3455
. Pol/Log/Decide Build: POLICY-(105) LOG-(107) DECIDE-(8)
. Service Session MAX: 13500 Session (Forks:30)(Sessions:450)
. LastUpdate(compiled): Dec 16 2021
. The latest update of the binary: Dec 16 2021
[이슈 분석 및 원인]
- 패킷 및 모듈 정보 수집하여 내부 분석 진행
- 원인
. MySQL 8.0.23 버전부터 query_attributes 기능이 추가되었으며 쿼리를 읽기 전에 프로토콜이 추가되어 기존 방식으로 쿼리가 읽히지 않음
. 해당 이슈는 BT 21409와 유사합니다. DBMS 로그인 단계에서 서버 버전정보가 추가 기록되어 문제 발생되었습니다.
[이슈 조치]
- 모듈 패치
. 서버 버전정보를 정확히 파싱할 수 있도록 모듈 수정
. pnp_mysql COMMON LIBRARY VERSION 3530 이상 모듈로 패치 필요
[참고 자료]
- MySQL 문서
. https://dev.mysql.com/doc/refman/8.0/en/query-attributes.html
- 관련 Bugs
. https://bugs.pnpsecure.com/view.php?id=21931
. https://bugs.pnpsecure.com/view.php?id=21409",댓글 없음,https://cafe.naver.com/pnpsecure2/5212
5195,[TIP] PC Agent와 DBSAFER IM(ASSIST HOST)의 NAT 정책 배포 방식의 차이,"DBSAFER IM(ASSIST HOST)의 NAT 정책 배포 방식에 대해서 확인한 내용 공유 드립니다.
Start!!
PC Agent의 경우 아래 예시그림과 같이 모든 NAT정책을 oms_dms로 부터 한꺼번에 전달 받아 적용합니다.
<PC Agent NAT 정책 예시>
DBSAFER IM(ASSIST HOST)의 경우 PC Agent처럼 한꺼번에 NAT 정책을 받아오는 것이 아닌 IM WEB 자동접속 페이지에서 서비스에 접속을 시도하였을때 해당 서비스에 대한 NAT 정책만 받아오게 됩니다.
아래 예시 그림처럼 최초 아무런 서비스에도 접속을 하지 않았을 경우 받아온 NAT 정책이 없음을 확인 할 수 있습니다.
<아무런 서비스에도 접속을 하지 않았을 경우 NAT 정책>
서비스에 접속을 시도하게 되면 그때 NAT 정책을 받아오게 되고 아래 예시 그림처럼 해당 서비스에 대한 NAT 정책만 받아오는 것을 확인 할 수 있습니다.
<서비스에 접속 이후 NAT 정책>
매번 접속할때 마다 NAT 정책을 갱신하는 것이 아닌 IM WEB에 로그아웃 할때 초기화 되는 것으로 확인 하였습니다.
또한 한번 받아온 서비스에 대한 NAT 정책은 로그아웃 전까지 유지되는 것으로 보여집니다.
<한개의 서비스를 접속 한 뒤의 NAT 정책>
<두개의 서비스를 접속 한 뒤의 NAT 정책>
특이사항으로 GW서버가 두대 이상일 경우 매번 부여받는 NAT 정책에 대한 GW서버가 달라질 수 있음
아래 예시 그림 참고.
ex) 어느 때에는 보안서버주소가 192.168.100.188이었었는데 어느 때에는 192.168.100.189인것을 확인해 볼 수 있음.
<매번 바뀌는 보안서버주소 1>
<매번 바뀌는 보안서버주소 2>
[매번 바뀌는 보안서버주소로 인한 주의사항]
> 예를 들어 1번 GW서버의 서비스 포트에 대해서만 방화벽 오픈이 되어 있고, 2번 GW서버에 대해서는 방화벽 오픈이 안되어 있다고 하였을때
> 1번 GW서버로 NAT 정책을 부여받았을때에는 정상적으로 서비스 접속이 가능하고, 2번 GW서버로 NAT 정책을 부여 받았을 경우에는 서비스 접속이 불가능한 상황을 볼 수 있습니다.
> 저의 경우 실제로 현대제철 프로젝트를 진행하면서 경험했던 사항입니다.
> 최초 위 상황을 맞이할 경우 달라진건 없어 보이는데 어쩔때는 정상동작하다가 어쩔때는 비정상동작하는 이상한 상황을 맞이하여 분석에 시간이 소요될 수 있습니다.
사진을 많이 첨부해서 그런지 생각보다 긴 글이 되었습니다.
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5195
5194,[TIP] mailer 모듈을 통해 전송된 메일의 한글 깨짐 현상 조치,"mailer 모듈을 통해 전송된 메일에서 한글이 깨질 시 확인할 사항에 대해 공유드립니다.
권한제어정책에 경고객체(메일전송)을 등록한 뒤 pnp_mailer 모듈을 통해 oracle DB에 사용한 쿼리문 메일 전송 시 쿼리문에 포함된 한글이 깨져서 식별 불가(oracle db에 사용된 쿼리문만 깨지며 mysql db에 사용된 한글은 정상 표시)
java 기반의 pnp_mailer.sh 모듈로 교체 후 확인 시 사용된 쿼리문 상의 한글은 정상 표시되나 다른 부분의 한글이 깨져서 표시됨
./pnp_mailer.sh start 시 Language : ENGLISH, Charset : utf-8 설정으로 동작되는 현상 확인
.conf/lang.conf 파일 내 lang=en 값을 lang=ko로 변경후 pnp_mailer.sh 가동 시 Language : KOREAN, Charset : euc-kr 설정으로 동작(pnp_mailer.sh 모듈이 lang.conf 파일의 설정 값을 참조하여 동작)
이후 전송된 메일의 모든 한글 정상 표시 확인
비슷한 현상에 대한 조치로 한두영 대리님이 작성하신 아래 내용도 참고하시기 바랍니다.
https://cafe.naver.com/pnpsecure2/4398
cafe.naver.com
cafe.naver.com",댓글 없음,https://cafe.naver.com/pnpsecure2/5194
5183,[TIP][DBSAFER] CENTOS7 영문(영어) 설치 메뉴얼,"참고사항 : 해외 고객사에서 VMWARE환경에 구축할 경우 간혹 OS설치 가이드를 요청하는 경우가 있습니다.
미니멀OS의 ISO 파일 다운로드 경로를 먼저 전달한 뒤 첨부 메뉴얼을 전달하는 게 좋습니다.
고객사가 준비한 서버의 디스크공간에 맞도록 파티션 부분만 수정하여 사용하시면 됩니다.
권장사항 : 엔지니어 개입없이 고객사가 진행하다보면 파티션 설정을 잘 못할 가능성이 높으니
가급적이면 VPN계정을 받거나 원격을 통해서 우리가 직접 OS를 설치하는 것이 좋습니다.
첨부파일
CentOS7 OS install guide_eng
.pptx
파일 다운로드",댓글 없음,https://cafe.naver.com/pnpsecure2/5183
5182,[TIP] metasync 의 활용,"1. 개요
- metasnyc 의 동작을 이해하고 다양하게 활용할 수 있습니다.
ex. 둘 이상의 인사 DB 연동, 객체 자동 연동, 애매한 개발 건을 직접 지원하는 등등
2. 기본 동작
- metasync 모듈은 여러 대상 DB 또는 정형화된 파일로 부터 데이터를 읽고 로컬 DB에 저장하는 역할을 합니다.
※ 즉, DB 나 FILE 연동 전부 결국에는 로컬 DB (mariadb) 에 저장됩니다.
ex. 대상 DB를 조회하여 결과값을 로컬 DB에 저장
3. 활용
가. 둘 이상의 DB 인사연동 방법
1) DB#1, DB#2 를 metasync 데몬으로 로컬 DB에 연동
각 DB를 로컬 DB로 연동한 이미지
2) 로컬 DB 를 accountsync 데몬으로 연동
- 테이블 간 KEY 를 통해 JOIN 수행
로컬DB 내 A 와 B 테이블을 연동
ex) 인사정보(A)와 조직정보(B)가 다른 테이블로 존재할 경우
A 는 인사, B 는 조직 테이블일 때
# vi /dbsafer/.conf/dbsafer_accountSync.properties
... (중략) ...
ColumnName = name
ColumnTel = dept
.... (중략) ...
From = from (select a.name as name, b.dept_name as dept from metadb.table_A a left join metadb.table_B b on a.dept_code = b.idx) tbl
... (생략)
※ from 절에 서브쿼리를 넣는 방식
나. 연동 주기를 다양하게 설정하는 방법
- metasync 의 기본 값은 고정 주기이므로 crontab 을 활용해야합니다.
ex) 매일 08 시, 13 시에 인사 동기화 시
# crontab -e
# Metasync for AccountSync
0 8,13 * * * /home/infosafer/batch/accountSync.sh
# vi /home/infosafer/batch/accountSync.sh
#!/bin/bash
cd /dbsafer;
./dbsafer_metasync.sh run
wait
./dbsafer_accountsync.sh sync
sleep 5
다. 연동 테이블 수정(가공) 방법
- INFOSAFER 경우, logtracer 에 연동하기 위한 필수 값이 없을 때 활용할 수 있습니다.
ex. 가져온 데이터(①,②)를 스크립트로 가공(③) 후 연동(④)
ex) Logtracer에 연동할 순차 증가하는 컬럼 키(auto increment)가 없는 경우 할당 방법
① 테이블 가공
- metasync 로 부터 metadb.table_A 를 생성 후 컬럼 가공
# mysql -usafeusr -p --default-character-set=utf8
> ....
mysql> create table metadb.table_A_edit like metadb.table_A; // 원본 table_A 의 스키마 구조를 복사하여 table_A_edit 생성
mysql> alter table metadb.table_A_edit drop primary key; // 가공할 테이블의 key 제거
mysql> alter table metadb.table_A_edit add column IDX int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY; // IDX 컬럼 추가
mysql> alter table metadb.table_A_edit drop column INSERT_TIME; // 불필요한 컬럼 제거
mysql> alter table metadb.table_A_edit drop column UPDATE_TIME;
② 가공 테이블에 데이터 입력
- 로컬 DB 에 기록된 metadb.table_A 의 데이터를 가공 테이블 metadb.table_A_edit 에 저장
# vi .../batch/edit_data.sh
#!/bin/bash
# 가공 테이블 데이터 초기화
dsql=""delete from metadb.table_A_edit; alter table metadb.table_A_edit auto_increment=1;""
# 가공 테이블 데이터 추가
isql=""insert into metadb.table_A_edit (name, dept, mobile) select a.name as name, a.dept as dept, a.mobile as mobile from metadb.table_A a;""
mysql -u${ID} -p${PW} -e ""${dsql}"";
wait
mysql -u${ID} -p${PW} -e ""${isql}"";
wait
③ LogTracer 연동
- 로컬 DB에 저장된 metadb.table_A_edit 의 데이터를 연동
4. 유의사항
- 고객환경 적용 전에 반드시 사내 VM 등에서 충분히 검증 후 적용
- 향후 관리 차원에서 무분별한 스크립트 사용이나 배치 등록은 지양 권장
- 불가피할 경우만 응용하여 활용하되, 인수인계 목적의 히스토리를 상세히 기록 후 가이드",댓글 없음,https://cafe.naver.com/pnpsecure2/5182
5158,"[TIP] pnpsecure.ssl 인증서 ""도메인""으로 등록하는 방법","[요청내용]
- pnpsecure.ssl 인증서 ""IP""가 아닌 ""도메인""으로 등록
[이슈내용]
im/decide/webreport 등 도메인으로 접속한다면, 도메인으로 등록된 인증서 등록이 필요함
[방법]
1) 인증서 설정/패스워드 확인
# vi /usr/local/apache/conf/server.xml
KeystoreFile=""./conf/pnpsecure.ssl
KeystorePass=""dbsafer00""
2) 기존 pnpsecure.ssl(ip) 삭제
/usr/local/apache/conf/pnpsecure.ssl 기존파일 삭제(백업)
3) DNS 사설인증서 생성
- 실행 위치: /usr/local/apache/conf
- 실행 명령어: keytool -genkey -alias ""PNPSECURE SSL CA"" -keyalg RSA -validity 10960 -dname ""CN=#도메인주소#,OU=PNPSECURE Inc.,O=PNPSECURE Inc.,L=Daewangpangyo-ro,S=Seongnam,C=KR"" -ext ""SAN=DNS:#도메인주소#"" -keystore pnpsecure.ssl
- 키 저장소 비밀번호 입력 : dbsafer00
- 새 비밀번호 다시 입력 : dbsafer00
<PNPSECURE SSL CA>에 대한 키 비밀번호를 입력하십시오.
(키 저장소 비밀번호와 동일한 경우 Enter키를 누름) : Enter
3) 인증서 생성 후 웹 서비스를 재시작
4) 익스플로어에 들어가서 인증서 등록",댓글 없음,https://cafe.naver.com/pnpsecure2/5158
5152,[TIP] pnp_connector 커스텀 뷰 생성 시 에러 유형 및 설정 공유,"안녕하세요. 기술본부 고객지원팀 이창제 사원 입니다.
pnp_connector 설치 작업을 하며 겪었던 에러 유형 및 해결 방법에 대해 공유하려고 합니다.
감사합니다.
내용은 아래와 같습니다.
[본문내용]
- 초기 pnp_connector를 이용해 custom view 생성 시 생기는 에러 유형 정리 및 해결 방법 공유
[에러유형]
- Error: Realtime options is not enabled.
- ERRNO [1064] - 'UNION ALL 에러
- ERRNO [1049] - Unknown database 'connector' 에러
- ERRNO [1060] - Duplicate column name 에러
- 커스텀뷰 설정시 한글 깨짐 현상
- Illegal mix of collations for operation 'UNION' Error code: 1271 오류
- QueryBox 를 통해 View 테이블 작업 Tip
: ""Access denied for user 'connector_select'"" 오류
: 'Prepared statement needs to be re-prepared' 에러
내용은 아래와 같습니다.
1. add_custom_table 수행 시 Error: Realtime options is not enabled. 에러 발생 및 설정 방법
1) 발생 조건
: pnp_connector.conf 내 'ENABLE_REALTIME_LOG_VIEW' 옵션 비활성화 시 해당 에러 발생
REALTIME OPTION 미 설정 시 발생 에러
2) 해결방법
: /dbsafer/.conf/pnp_connector 설정 변경
# vi /dbsafer/.conf/pnp_connector.conf
# pnp_connector.conf 아래에 다음 옵션 추가 'ENABLE_REALTIME_LOG_VIEW=1'
> pnp_connector hidden 재 진입 및 add_custom_table 수행 시 정상 동작
pnp_connector.conf 내 설정 추가 화면
2. add_custom_table 수행 시 'UNION ALL 에러 발생 및 설정 방법
1) 발생 조건 - ①
: 데이터를 가져올 테이블에 데이터가 들어있었던 기간보다 뷰테이블 생성 기간을 길게 설정했을 때 발생됨
: 테스트 서버 또는 서버 최초 설치 시 default로 2 가 들어 있어 해당 에러 발생 가능성 존재
발생 조건 - ②
: 뷰테이블 SQL 쿼리의 맨 끝의 "" ; "" 또는 ""order by 구문""이 있을 시 발생 가능성 존재
2) 해결 방법
: 발생 조건 -① 해결 방법
> pnp_connector.conf의 뷰테이블 생성할 날짜 옵션인 ""VIEW_LINKAGE_DAYS= ""의 값을 확인하여 1로 변경한다.
: 발생 조건 - ② 해결 방법
> 뷰테이블 생성 쿼리문(XXX.sql)의 맨 끝 확인하여 "" ; "" 또는 ""oreder by"" 구문이 있을 시 주석 처리 후 저장
pnp_connector.conf 내 설정 확인
3) '/dbsafer/log/pnp_connector/2022/01/10/pnp_connector_2022011011.log' 내 시스템 에러 로그 확인
[2022-01-10 11:11:32] [7566] [ERROR][ERROR_0203001] MySQL Query Execution Error. : HOST [192.168.102.212], ERRNO [1064], ERR [You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near 'UNION ALL
에러 로그 확인 시 Default로 VIEW_LINKAGE_DAYS = 2 로 들어가 있는 것 확인
# /dbsafer/.conf/pnp_connector.conf 아래에 다음 옵션 추가 'VIEW_LINKAGE_DAYS=1'
> pnp_connector hidden 재 진입 및 add_custom_table 수행 시 정상 동작
3. add_custom_table 수행 시 Unknown database 'connector' 에러
1) 발생 조건
: 테스트 서버 또는 서버 최초 설치 시 발생되며, pnp_connector 모듈을 한 번도 실행하지 않은 상태에서 custom view 테이블 생성 하려고 할때 발생
2) 해결 방법
: connector DB 존재 여부 파악 > 존재하지 않으면 pnp_connector 실행
: connector DB 생성 확인
: ./pnp_connector hidden 진입 및 add_custom_table 수행 시 정상 동작
3) '/dbsafer/log/pnp_connector/2022/01/10/pnp_connector_2022011011.log' 내 시스템 에러 로그 확인
[2022-01-10 11:16:42] [9525] [ERROR][ERROR_0203001] MySQL Query Execution Error. : HOST [192.168.102.212] ERRNO [1049], ERR [Unknown database 'connector'], QRY [CREATE OR REPLACE VIEW connector.view_decide AS
/home/dbsafer/data/mysql/ 내에 connector가 존재하지 않음
pnp_connector 모듈 실행
connector DB 생성 확인
4. add_custom_table 수행 시 Duplicate column name 에러
1) 발생 조건
: 커스텀 뷰 생성 쿼리에서 동일한 이름의 컬럼이 있을 경우 발생
2) 해결 방법
: 쿼리문에서 동일한 컬럼이 있는 지 확인하여 수정
3) '/dbsafer/log/pnp_connector/2022/01/10/pnp_connector_2022011011.log' 내 시스템 에러 로그 확인
[2022-01-10 13:36:42] [9750] [ERROR][ERROR_0203001] MySQL Query Execution Error. : HOST [192.168.102.212], ERRNO [1060], ERR [Duplicate column name '구분'], QRY [CREATE OR REPLACE VIEW connector.view_decide AS
5. 커스텀뷰 설정시 한글 깨짐 현상
1) 발생 조건
: DBSAFER5.0 MariaDB의 경우 기본 Character Set이 latin1으로 설정되어 있음
> Putty로 접속 초기 Character Set 확인 시 ko_KR.UTF-8로 되어 있음 (use font encoding 도 현상 동일)
> 쿼리 내에 한글이 있을 시 운영체제 내에서 vi를 통해 수정하면 한글이 깨지는 경우 발생
2) 해결 방법
: 해당 쿼리문을 복사 붙여넣기 수행 X -> PC에서 한글 수정 작업 진행 후 xxx.sql 파일 직접 서버에 업로드
(한글 깨짐 현상을 해결할 수 있는 또 다른 방법이 있다면 공유해주시면 감사하겠습니다.)
3) 예제 쿼리문 내에 한글 있을 시 한글 깨짐 현상
한글이 포함된 뷰테이블 쿼리 복사 붙여넣기 수행 시 깨지는 현상 (좌측 사진 참고)
뷰테이블 쿼리 파일 서버로 직접 전달 시 한글 정상 입력 가능 (우측 사진 참고)
6. 커스텀뷰 select시 collation 충돌로 인해 Illegal mix of collations for operation 'UNION'
Error code: 1271 오류
1) 발생 조건
: MariaDB 캐릭터셋 기본 설정이 latin1 으로 설정에 따라 collation 설정도 따라가게 되어 있음
: DBSAFER5.0 MariaDB 의 경우 latin1으로 설정되어 있음
: DBSAFER5.0 MariaDB 같은 경우 collation 초기 설정값은 아래와 같음
> collation_connection = latin1_swedish_ci;
collation_databases = latin1_general_ci;
collation_server = latin1_general_ci;
: collation 부분이 latin1_general_ci 로 일치하지 않아 발생하는 현상
2) 해결 방법
: collation_connection='latin1_swedish_ci' > collation_connection='latin_general_ci' 로 변경 후 조회 시 정상 동작
: 변경 쿼리
> SET collation_connection='latin1_general_ci';
(*주의 > 해당 쿼리는 접속 할 때마다 SET 해 주어야 함, 새로운 세션을 맺으면 다시 latin_swedish_ci로 변경되어 같은 에러 발생)
: 변경 확인 쿼리
> SHOW VARIABLES WHERE VARIABLE_NAME LIKE '%coll%' OR VARIABLE_NAME='init_connect';
3) 예제 캐릭터셋 충돌 현상 및 해결 방법
collation 설정 충돌로 인해 생성된 뷰테이블 select 하지 못하는 현상
collation 동일하게 맞춰 준 후 생성된 뷰테이블 정상 select 가능
7. QueryBox 를 통해 View 테이블 작업 Tip
1) QueryBox 를 통해 접속 시 ""Access denied for user 'connector_select'"" 오류 발생
: 호스트, 포트, 계정, 패스워드에는 문제가 없지만, 접속 대상 DB를 지정해주지 않아 생기는 에러
: '데이터베이스 : connector' 지정 후 QueryBox 접속 시 정상 동작
Next image
2) QueryBox 를 통해 해당 뷰 테이블 Select 시 'Prepared statement needs to be re-prepared' 에러 발생
: https://cafe.naver.com/pnpsecure2/5105
: https://cafe.naver.com/pnpsecure2/4643
: 해당 카페 내용 확인 시 해결 가능
: 추가 수정 방법으로, 아래 사진과 같이 /etc/my.cnf 내에 'table_definition_cache= '값을 키워주면 정상 동작 확인
( /etc/my.cnf 설정 수정 시 DB 재시작 후에 적용됨)
에러 유형 수집 및 문제 해결에 도움을 주신 김태윤 실장님, 남신우 부장님께 감사의 말씀을 드립니다 !
이상입니다.
감사합니다.","김태윤: 잘 정리한것 같습니다.
유사 상황 발생될 경우 활용 되었으면 합니다. | 이창제: 넵! 답글 감사합니다 !

추가적으로 에러 유형 확인 된다면 업데이트 하겠습니다! | 남신우: ""2. add_custom_table 수행 시 'UNION ALL 에러 발생 및 설정 방법"" 관련하여

해당 오류 사항 발생시

""pnp_connector.conf의 뷰 테이블 생성할 날짜 옵션인 ""VIEW_LINKAGE_DAYS= ""의 값을 확인하여 1로 변경"" 도

답이 될 수 있겠지만 뷰를 생성하는 생성 쿼리에 대해서도 확인이 필요 합니다.

SQL 맨 끝의 "" ; "" 또는 ""order by 구문""이 있다면 주석 처리 하고 실행 해 보시기 바랍니다.

이창제 사원님 정리하시느라 고생하였습니다.

감사합니다. | 이창제: 추가적인 의견 감사합니다 !

해당 내용 확인하고 추가 업데이트 하도록 하겠습니다 !

감사합니다. | 김가희: union all과 order by구문을 같이 사용할 때 여러 조건이 붙더라구요.
union all 을 쓰는 경우에는 order by 에서 컬럼명을 사용하지 못하고, union all이전에도 사용하지 못하는 등 여러 사유로 구문 ERROR가 발생하였습니다.
관련 링크 : https://www.techonthenet.com/mariadb/union_all.php

저는 order by구문을 반드시 사용해야 했기 때문에 select문으로 전체 쿼리를 한번 더 감싸서 해결하였습니다!",https://cafe.naver.com/pnpsecure2/5152
5151,[TIP] MariaDB 취약점 조치 방법 (기본 포트 변경),"1. 요약
고객사에서 DBSAFER의 MariaDB 취약점 조치 시 '기본 포트(3306)'를 변경 요청하는 경우에 대비해 영향도, 조치 방법, 주의사항에 설명드립니다.
2. 영향도
1) DBSAFER 서비스 재시작 필요 ( #./pnp stop & #./pnp start)
2) DB 서비스 재시작 필요
3) 웹 서비스 재시작 필요
* 운영중인 DBSAFER 환경 경우, 업무 시간 외 작업이 필요합니다.
3. 취약점 조치 방법
기존 작성된 '[TIP] MariaDB 포트변경' 글에서 추가로 확인된 조치 내용으로 작업 과정에 대해 설명드리겠습니다.
https://cafe.naver.com/pnpsecure2/3520
cafe.naver.com
cafe.naver.com
[작업 단계]
1) DBSAFER 서비스 정지
# cd /dbsafer/
# ./pnp stop
2) DB 서비스 정지
# service mysql stop
3) 웹서비스 정지
# service pnpweb stop
4) MariaDB 포트 변경
# vi /etc/my.cnf
[myqld] 하위에 변경될 포트 지정 필요 (ex : 13306)
port = 13306 추가
5) DB 서비스 시작 및 상태 확인
# service mysql start
# netstat -anp | grep mysqld
# ps -ef | grep mysql | grep 13306
포트 확인
프로세스 확인
6) DBSAFER DB 접속 관련 설정 (pnp_agent dbconfig)
# cd /dbsafer/
# ./pnp_agent dbconfig
>> 'Default: 3306' 포트에서 '13306'으로 변경 후 적용
pnp_agent dbconfig 후 설정 'OK'(정상) 확인
7) Tomcat DB 접속 포트 변경
# vi /usr/local/apache/conf/server.xml
- 기존 '3306'을 '13306'로 수정 및 저장
Tomcat DB 접속 포트 변경
8) webreport.properties 포트 변경(웹리포트)
- 기존에 웹리포트 설치 후 운영 경우, 다음과 같이 포트 변경
# vi /home/webproperties/webreport/webreport.properties
>> webreport.repositoryPort 포트를 '13306'으로 수정 및 저장
webreport.properties 포트
- 취약점 조치 후 신규 웹리포트 설치 경우
# cd [웹리포트 패키지]
# ./install.sh -PORT 13306
9) DBSAFER 서비스 가동
# cd /dbsafer/
# ./pnp start
10) 웹서비스 가동
# service pnpweb start
11) 서비스 점검
- 13306 포트로 DBSAFER DB 원격 접속 확인
- 포트 변경 확인(DB 접속 후 결과 확인)
- 매니저 정상 접속 체크
- 웹관련 서비스 접속 체크(decide, saferuas)
- DMS 접속 체크
4. 주의 사항
1) 방화벽 조치
취약점 조치 전 ' [관리자 및 클라이언트 대역] ----> [DBSAFER] ' 구간의 기존 '3306' 포트에서 변경된 포트 'EX) 13306' 로 오픈 필수!!
* 방화벽 오픈 미조치 시 매니저 접속, DMS 접속이 불가능합니다.
2) DMS 사용 환경
- PC Agent 재빌드 및 재배포 필요
PC Agent - DMS 설정 값 경로
decide.ini 의 기본 포트 변경
PC Agent 빌드 시 decide.ini 파일에서 'PORTZ=3306'에서 변경될 포트 '13306'으로 수정 후 빌드가 필요합니다.
* 수정이 필요한 부분에 대해 댓글로 남겨주시면 감사하겠습니다.",현승환: 작업 내역을 쉽게 잘 정리해주셔서 감사합니다. 작업 계획서 같이 공유해주시면 감사하겠습니다.,https://cafe.naver.com/pnpsecure2/5151
5149,현대차 계열 MPASS 연동 퀵 가이드,"현대차 계열 구축시 현대오토에버에서 서비스하는 MPASS 라는 모바일 어플로
OTP / FIDO (지문인증) 를 이용하여 2차인증을 연동하는 경우가 많은데
참고할 수 있도록 내용 첨부하였습니다.
추가로 필요한 내용이 있거나 의견에 대해서 편하게 라인 주시면 수정하여 버젼올리도록 하겠습니다.
첨부파일
Mpass 적용 가이드_ver2.0
.pptx
파일 다운로드",박재현: ver2.0 수정 사항 : 셀프서비스의 재발급 과정 추가,https://cafe.naver.com/pnpsecure2/5149
5138,[TIP][DBSAFER] Azure SQL 연결 아키텍처 및 DBSAFER 지원 현황,"Azure SQL 연결 아키텍처와 DBSAFER 지원 현황에 대해 소개드립니다.
DBSAFER의 경우 Azure 외부 환경에서 연결을 시도하는 경우 영향은 없으나 Azure 내부 환경에서 연결을 시도하는 경우 감사로그 기록이 되지 않는 등 기능에 영향을 받습니다. (기본 설정 시)
- Azure 내부 환경에 DBSAFER 서버 구성되어 있고 Azure SQL을 서비스로 등록하여 운영 중인 경우
- DB 접근 시 기본적으로 Redirect 방식으로 연결되기 때문으로 최초 세션이 맺어진 이후에는 동적포트(11000~11999)로 통신하여 감사로그 기록되지 않음
Azure 연결 정책에 영향을 받아 발생하는 문제로 연결 정책은 아래와 같이 구분됩니다.
[개요]
- Azure SQL Database 연결 정책은 세 가지 옵션으로 구분
1) Redirect
. 클라이언트는 1433 포트로 수신 대기하는 게이트웨이로 연결
. 연결 정책에 따라 11000~11999 범위의 포트로 트래픽을 리디렉션 함
2) Proxy
. 클라이언트는 1433 포트로 수신 대기하는 게이트웨이로 연결
. 연결 정책에 따라 1433 포트로 트래픽을 중계 함
3) Default
. 연결 정책을 Redirect 이나 Proxy 중 하나로 명시하지 않은 경우 서버 생성 후 기본적으로 적용되는 정책
. Azure 내부에서 시작되는 모든 클라이언트 연결의 경우 Redirect 방식으로 연결
. Azure 외부에서 시작되는 모든 클라이언트 연결의 경우 Proxy 방식으로 연결
[Azure 연결 아키텍처 상세]
- Azure 내부에서 연결하는 경우
. 기본적으로 Redirect 연결 정책 적용
. TCP 세션이 Azure SQL Database 게이트웨이에 설정된 후 클라이언트 세션이 올바른 클러스터로 리디렉션 됨
. 이후 모든 후속 패킷은 Azure SQL Database 게이트웨이를 우회하여 클러스터로 직접 연결 함
Azure SQL Redirect 연결
- Azure 외부에서 연결하는 경우
. 기본적으로 Proxy 연결 정책 적용
. TCP 세션이 Azure SQL Database 게이트웨이에 설정된 후 모든 후속 패킷이 게이트웨이를 통과하여 연결 됨
Azure SQL Proxy 연결
[DBSAFER 지원 현황]
- 현재 DBSAFER는 동적포트 사용 환경을 기본적으로 지원하지 않습니다.
. 단, 동적포트를 모두 서비스로 등록하면 감사로그를 기록할 수 있음 (수작업 필요)
- 동적포트 지원 기능은 22년 연구소 로드맵에 등록되어 있습니다. 참고하시어 사이트 지원 바랍니다.
[참고 문서]
- URL : https://docs.microsoft.com/ko-kr/azure/azure-sql/database/connectivity-architecture
Azure SQL Database 연결 아키텍처 - Azure SQL Database and Azure Synapse Analytics
이 문서에서는 Azure 내부 또는 Azure 외부에서의 데이터베이스 연결에 사용하는 Azure SQL Database 연결 아키텍처를 설명합니다.
docs.microsoft.com",댓글 없음,https://cafe.naver.com/pnpsecure2/5138
5115,[TIP] MySQL Workbench SSL disable 방법,"[증상]
text 전송 방식을 사용 하는 서비스에 MySQL Workbench로 접속 할 때 SSL connection error 발생 하면서 접속 실패 함.
[분석 정보]
MySQL Workbench 기본 접속을 SSL로 시도 함. (SSL 시도후 TEXT 전환)
MySQL Workbench +8.SSL 탭에 diasble 옵션이 없음.
[대응]
SSL disable은 Advanced 설정에서 Others에 useSSL=1 설정
설정 후 접속 테스트 성공 확인",댓글 없음,https://cafe.naver.com/pnpsecure2/5115
5105,[TIP] 감사로그 연동 시 pnp_connector 뷰테이블 생성 쿼리 공유,"안녕하세요, 프로젝트1팀 송민화입니다.
고객사 감사로그 연동 시 작성한 pnp_connector 뷰테이블 생성 쿼리 공유드립니다.
필요에 따라 가공해서 사용하시면 좋을 것 같습니다.
목적 : 고객사 감사로그 연동
조건 : 매니저 세션/명령어 로그 조회 화면과 똑같이 뷰테이블 생성 요청
[뷰테이블 정의서]
첨부파일
IBK연금보험_로그연동 뷰테이블 정의서
.xlsx
파일 다운로드
[적용 내용]
1. /dbsafer/.conf/tmp_user.sql (세션 로그)
select
`denied`,
`loglevel`,
`id`,
`clt_ip`,
`service_no`,
`server_ip`,
`server_port`,
`application`,
`sid`,
`ldap_sno`,
`ldap_name`,
`ldap_tel`,
`in_time`,
`out_time`,
`cmd_count`,
`policy_no`,
`policy_name`,
`gateway`,
`index`,
`operating_mode`,
`decide_type`,
`decide_time`,
`decide_mgr_id`,
`manual_auth_id`,
`manual_auth_name`,
`private_ip`
from
dbsafer_log_[[YYYY]]_[[MM]].`db_user_[[DD]]`
2. /dbsafer/.conf/tmp_query.sql (명령어 로그)
select
Q.`u_index`,
Q.`c_index`,
Q.`denied`,
Q.`loglevel`,
Q.`query`,
Q.`query_bind`,
Q.`isformal`,
Q.`qry_count`,
Q.`r_size`,
Q.`rtn`,
Q.`row_size`,
Q.`rtn_filesaved`,
Q.`result_scan_count`,
Q.`c_time`,
Q.`resp_time`,
Q.`resp_elapsed`,
Q.`r_time`,
Q.`elapsed`,
Q.`policy_no`,
Q.`policy_name`,
U.`id`,
U.`application`,
U.`sid`,
U.`ldap_sno`,
U.`ldap_name`,
U.`ldap_tel`,
U.`in_time`,
U.`out_time`,
U.`clt_ip`,
U.`server_ip`,
U.`service_no`,
U.`server_port`,
IFNULL(`tbl_names`, ''),
Q.`global_policy`,
U.`operating_mode`,
Q.`manual_auth_id`,
Q.`manual_auth_name`,
U.`private_ip`,
Q.`decide_type`,
Q.`decide_mgr_id`,
Q.`decide_time`
from
dbsafer_log_[[YYYY]]_[[MM]].db_query_[[DD]] Q USE index(idx_query_info, idx_c_time_c)
left join dbsafer_log_[[YYYY]]_[[MM]].db_qinfo T on (Q.query_info = T.idx)
join dbsafer_log_[[YYYY]]_[[MM]].db_user_[[DD]] U on (Q.u_index = U.`index`)
[적용 결과]
1. 세션 로그
2. 명령어 로그
[뷰테이블 확인]
고객사에서 뷰테이블 확인 시 쿼리박스를 사용했을 때,
위와같은 에러가 출력되었습니다. (참고 : https://cafe.naver.com/pnpsecure2/4643)
cafe.naver.com
cafe.naver.com
따라서 DBSAFER 서버(로컬)에서 확인하는 경우 접속방법 공유드립니다.
1) '127.0.0.1' 혹은 '접속한 DBSAFER IP' 추가
2) MYSQL 접속",댓글 없음,https://cafe.naver.com/pnpsecure2/5105
5100,[TIP]﻿[WTA] WINDOW RDP 로깅 기준,"안녕하세요. 고객지원1팀 정우성입니다.
최근 한국투자증권에서 문의가 들어온 WINDOW RDP 로깅(WTA로깅) 기준에 대해서 확인한 내용 공유 드립니다.
1. 시간 조건
: wta.conf에 WAIT_TIME_MIN과 WAIT_TIME_MAX설정을 확인
: WAIT_TIME_MIN 최소 시간 조건 (ex) 1초 내 여러번 클릭해도 1장만 기록됨)
: WAIT_TIME_MAX 최대 시간 조건 (ex) 300 초 동안 아무 이벤트가 없어도 기록됨)
2. 이벤트
: 마우스 클릭, 키보드 입력
3. 로그값
: 마우스 클릭, 키보드 입력은 명령어쪽에 저장
: 화면에 뿌려지는 텍스트 및 클래스명은 결과값에 저장",댓글 없음,https://cafe.naver.com/pnpsecure2/5100
5098,[TIP] 보안계정 삭제 불가 이슈 공유,"[이슈 사항]
- 보안계정 삭제 시 알림 띄워지며 삭제되지 않는 이슈 발생
. 계정관리시스템 설치 후 삭제한 상태
[작업 내용]
- DBSAFER IM 설치 후 보안계정(d_hl.kim)을 장비 관리자로 지정
- DBSAFER IM 삭제 (DB Uninstall)
- DBSAFER Manager에서 보안계정(d_hl.kim) 삭제 시 ""계정관리시스템에서 관리자로 사용중""이라는 알림 발생
보안계정 삭제 알림
[원인]
- DBSAFER Manager 성능 관련하여 Build-6064 버전부터 캐시 처리하는 기능이 추가 됨
. database_info_cache 테이블에 webem DB 관련 캐싱 데이터가 존재하여 발생한 문제로 확인
[조치 방안]
- dbsafer3.database_info_cache 테이블 truncate 수행 후 DBSAFER Manager 접속
. 보안계정 삭제 확인",댓글 없음,https://cafe.naver.com/pnpsecure2/5098
5094,[TIP] 미결문서가 남아있는 보안계정 삭제시 팝업창 동작 관련 내용 공유,"[요약]
- 결재시스템의 미결문서가 남아있는 보안계정의 경우,
매니저에서 보안계정 삭제시 '결재시스템에서 미결문서 결재자로 등록되어 있어 삭제할 수 없습니다.' 팝업창이 떠야하나, 뜨지 않고 삭제되는 현상
미결 문서가 남아있는 보안계정 삭제시 다음과 같은 팝업창이 떠야 함
*팝업창 없이 삭제되는 경우
- 기안자가 결재자를 한명으로 지정할 경우, 결재자는 미결문서가 남아있지만 팝업창 없이 삭제됨
- 기안자가 결재자, 감사자를 지정할 경우, 결재자는 미결문서가 남아있지만 팝업창 없이 삭제됨.(감사자의 경우 팝업창이 뜨고 삭제되지 않음)
[원인]
- 매니저에서 보안계정 삭제시, 결재시스템 관련 확인쿼리를 통해 해당 보안계정의 삭제여부를 확인하는데,
확인쿼리에서 sign_sort의 값(아래 그림에서 2번 부분)이 잘못되어 있음.
기존 확인 쿼리
*remain_doc_sign 테이블 관련 컬럼
sign_user : 결재자
sign_delegate : 대결자
sign_sort : 결재순서
sign_decidedate : 문서 결재 시간
- 해당 쿼리에서 크게 3가지 조건을 확인하여 모두 만족할 경우, 삭제하지 못하도록 팝업창('결재시스템에서 미결문서 결재자로 등록되어 있어 삭제할 수 없습니다.')이 뜨게 됨
- 2번 조건에서 sign_sort != 1 로 되어있는 부분에서 실제 기안자의 경우 sign_sort의 값은 0으로 되어있는 것 확인
=> 따라서 확인쿼리에서 and sign_sort != 0 으로 수정되어야 함
dbsafer3.dbsafer_ldap_list 에서 idx값 확인
decide.remain_doc_sign 에서 sign_user에 대한 sign_sort 값 확인
[결론]
- 벅스 등록하여 https://bugs.pnpsecure.com/view.php?id=21197 수정완료.
=> 매니저 6105버전에서 수정된 쿼리 반영
- 매니저 6105이하 버전의 고객사 중 결재시스템 사용 고객사인 경우, 보안계정 삭제시 주의 및 6105이상 버전으로 패치를 권장드립니다.
수정된 버전의 매니저에서 결재(sign_sort값이 1)보안계정 삭제시 정상적으로 팝업창 뜨는것 확인
*해당 이슈 확인 및 수정해주신 결재시스템팀 김정현 사원님, 매니저팀 이승민 과장님 감사합니다.",심을이: 양기원 대리님 감사합니다 ㅠㅠㅠ 딱 찾고 있었던 거에요 🙏🏻,https://cafe.naver.com/pnpsecure2/5094
5087,[TIP] ORACLE 접속 후 EXECUTE 명령어 실행 시 DBSAFER 로그 상에 BEGIN ~ END 구문으로 로그 기록,"DB SQL 툴을 통해서 ORACLE 접속 후 EXEC 또는 EXECUTE 명령어를 실행 시 DBSAFER에는 해당 구문으로 로그가 남지 않고 BEGIN ~ END 구문으로 로그가 기록 됩니다.
또한 DBMS 권한제어정책에 EXECUTE 명령어 차단 정책이 있더라도 적용받지 않으며, BEGIN 구문으로 인식 됩니다.
[재현]
1. DBMS 권한제어 정책에 적용 여부를 확인하기 위하여 정책 설정
2. DBSAFER Agent 접속 후 쿼리 툴을 통해 EXECUTE 명령어 실행
3. 명령어 및 적용 정책 확인
로그 내용과 같이 BEGIN ~ END 구문으로 로그 기록
DBMS 권한제어정책에 설정 된 EXECUTE 차단 정책 미 적용
[원인]
EXECUTE는 표준 PL/SQL 구문이 아니기 때문에 SQL * Plus 외 다른 툴을 사용 할 경우 EXEC가 실행되지 않을 수도 있습니다.
따라서 PL/SQL 실행 표준인 BEGIN ~ END 구문으로 변환되어 DB에 실행 됩니다.
이는 QueryBox 외 ORANGE, SQL Plus와 같은 다른 툴에서도 동일하게 변환되어 실행 됩니다.
They really are the same when using SQL*Plus, although exec is faster to type.
This is not standard PL/SQL, which means that if you use any other tool than SQL*Plus, there is a chance that exec will not be recognized. It also only works with single lines.
Whereas BEGIN END is standard and will work with any tool that interfaces with PL/SQL. Such blocks can also span more than one line.
출처 - https://stackoverflow.com/questions/18587774/difference-between-begin-end-and-exec
Difference between BEGIN/END and EXEC
what is the difference between Begin bc_any_package_pkg.anyProcedure; End; / and EXEC bc_any_package_pkg.anyProcedure; / I can't find if there is any difference... Thanks
stackoverflow.com
[결론]
현재 많은 사이트에서 EXECUTE 명령어 차단 정책을 시행하는 것으로 알고 있습니다.
해당 내용을 모르시는 엔지니어가 많은 것 같아 이 글을 보시게 된다면 담당하시는 사이트에도 확인이 필요 할 것 같습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5087
5085,[TIP] 로그저장공간을 /home이 아닌 다른공간으로 저장을 요청할때,"1. 공유내용 : DBSAFER 저장공간이 /home이 아닌 /BCCARD_DATA 같은 고객사의 네이밍 롤에 맞는 저장공간에 log 저장을 요청할때
2. 해결방안
1) 심볼릭 링크
- 장점
: 간단함
: dbsafer의 conf설정을 바꾸지 않아도 됨
: 인수인계시 편함(/home/dbsafer에 심볼릭 링크가 /BCCARD_DATA에 걸렸다고 이야기 하면됨)
: 실제로 /BCCARD_DATA에 저장공간이 늘어남
- 단점
: 딱히 없음
2) my.conf설정 등 실제로 /home/dbsafer/data/mysql의 저장되는 공간을 /BCCARD_DATA 로 변경
- 장점
: 심볼릭 링크가 아님(???!!?!?)
- 단점
: /home/dbsafer/data/mysql에 저장되는 모든 설정을 변경해야되고, 업그레이드, 패치시 계속 변경해야됨
: 인수인계시 히스토리가 많아짐
: 이슈발생 포인트 증가
ps 위의 리스트를 이야기 하면서, 그냥 심볼릭 링크로 가세요...
3. 처리방법(심볼릭 링크)
1) DBSAFER 서비스 정지
cd /dbsafer
./pnp stop
ps -ef | grep pnp | wc
2) mysql 서비스 정지
service mysqld stop
service mysqld status
3) ""/home/dbsafer/"" 영역 압축 및 기존의 /home/dbsafer 이름변경 > /home/dbsafer_orig
cd /home/dbsafer
tar cvfz ./dbsafer.tar.gz ./*
cd ..
mv dbsafer dbsafer_orig
4) 심볼릭 링크
cd /home
ln -s /bccard_data dbsafer
(당연하지만 /파란색은 고객사가 요청하는 경로로 변경하세요)
4-1) 심볼릭 링크 확인
ls -al
5) /home/dbafer/* 압축파일 해제
cd /home/dbsafer_orig/
cp -ip ./dbsafer.tar.gz /home/dbsafer/
tar xvfz ./dbsafer.tar.gz
6) myslq 시작
service mysqld stop
service mysqld status
7) dbsafer 시작
cd /dbsafer
./pnp start
8) DBSAFE 정상 서비스 확인",댓글 없음,https://cafe.naver.com/pnpsecure2/5085
5082,"[TIP][maria] ""service mysql start"" 명령어시 Job for mysql.service failed because the control process exited with error code 발생","[담당자 이슈사항]
- pc_agent 로그인 불가
- manager 접속불가
[증상]
dbsafer_log 의 특정 테이블이 ""marked as crashed and should be repaired"" 발생
예시) [ERROR] mysqld: Table 'shell_raw_29' is marked as crashed and should be repaired
이후 dbsafer3.dbsafer_ldap_list'
dbsafer3.dbsafer_ldap_list'
[ERROR] mysqld: Can't find record in 'variables'
[ERROR] mysqld: Can't find record in 'auth_users' ...
정리하면
- marked as crashed and should be repaired >> Can't find record >> DB행 >> DB정지 되는 순서
- dbsafer_log쪽에서 먼저 특이사항 이 발생후 dbsafer3(데이터베이스)까지 영향도가 미쳐서 사용자/관리자 접속이 안된다
: * dbsafe3 오토 리페어 안먹음
> 문제 되는 DB를 아리아 체크 하거나, 해당 DB가 mysql에 읽혀지면 안됨(백업해서 상위경로에 넣거나, 다른 폴더에 넣고 실행해 봐야함)
[복구 작업시 mariaDB 재시작 불가]
""service mysql start""명령어 사용시 [FAIL] 발생
Starting mysql (via systemctl): Job for mysql.service failed because the control process exited with error code. See
""systemctl status mysql.service"" and ""journalctl -xe"" for details.
[추가 확인내용]
#systemctl status mysql.service
>>>> 출력 내용확인(위 명령어 입력하고 확인해 보세요)
[systemctl status mysql.service 예시]
[root@npsiial1p mysql]# systemctl status mysql.service
â— mysql.service - LSB: start and stop MariaDB
Loaded: loaded (/etc/rc.d/init.d/mysql; bad; vendor preset: disabled)
Active: failed (Result: exit-code) since Tue 2021-11-30 11:02:47 KST; 31s ago
Docs: man:systemd-sysv-generator(8)
Process: 123530 ExecStop=/etc/rc.d/init.d/mysql stop (code=exited, status=0/SUCCESS)
Process: 123768 ExecStart=/etc/rc.d/init.d/mysql start (code=exited, status=1/FAILURE)
Nov 30 11:02:45 npsiial1p systemd[1]: Starting LSB: start and stop MariaDB... <<<<< 원인으로 확인됨
* 원인은 어떤 요인으로 innodb가 깨져서 mysql이 실행이 안되는 것 !!!!!!
> 해결방안은 2가지가 있습니다
> 처리 방안을 보려면 맨 마지막으로 ""이동""
* 사용량이 많아 pnp_log모듈이 DB에 많은 데이터를 쓰다가 꼬인(?) 것으로 짐작합니다
> 로그 데이터베이스를 사용하는건 pnp_log모듈 밖에 없고, 테이블이 깨진 고객사를 보면, 대부분 사용량이 많은 고객사입니다
Nov 30 11:02:45 npsiial1p mysql[123768]: Starting MariaDB.211130 11:02:45 mysqld_safe Logging to '/home/dbsafer/data/mysql/npsiial1p.err'.
Nov 30 11:02:45 npsiial1p mysql[123768]: 211130 11:02:45 mysqld_safe Starting mysqld daemon with databases from /home/dbsafer/data/mysql
Nov 30 11:02:47 npsiial1p mysql[123768]: ./etc/rc.d/init.d/mysql: line 264: kill: (123828) - No such process
Nov 30 11:02:47 npsiial1p mysql[123768]: ERROR!
Nov 30 11:02:47 npsiial1p systemd[1]: mysql.service: control process exited, code=exited status=1
Nov 30 11:02:47 npsiial1p systemd[1]: Failed to start LSB: start and stop MariaDB.
Nov 30 11:02:47 npsiial1p systemd[1]: Unit mysql.service entered failed state.
Nov 30 11:02:47 npsiial1p systemd[1]: mysql.service failed.
[root@npsiial1p mysql]#
#journalctl -xe
>>>> 출력 내용확인(위 명령어 입력하고 확인해 보세요)
[journalctl -xe 예시]
[root@npsiial1p mysql]# journalctl -xe
Nov 30 11:00:01 npsiial1p CROND[123244]: (root) CMD (/usr/openv/pdde/vpfs/bin/spws_monitor.sh > /dev/null 2>&1)
Nov 30 11:00:01 npsiial1p CROND[123245]: (root) CMD (/usr/openv/pdde/vpfs/bin/vpfs_monitor_s.sh > /dev/null 2>&1)
Nov 30 11:00:54 npsiial1p systemd-logind[7065]: Removed session 106680.
-- Subject: Session 106680 has been terminated
-- Defined-By: systemd
-- Support: http://lists.freedesktop.org/mailman/listinfo/systemd-devel
-- Documentation: http://www.freedesktop.org/wiki/Software/systemd/multiseat
--
-- A session with the ID 106680 has been terminated.
Nov 30 11:01:01 npsiial1p systemd[1]: Started Session 256586 of user root.
-- Subject: Unit session-256586.scope has finished start-up
-- Defined-By: systemd
-- Support: http://lists.freedesktop.org/mailman/listinfo/systemd-devel
--
-- Unit session-256586.scope has finished starting up.
--
-- The start-up result is done.
Nov 30 11:01:01 npsiial1p CROND[123382]: (root) CMD (run-parts /etc/cron.hourly)
Nov 30 11:01:01 npsiial1p run-parts(/etc/cron.hourly)[123385]: starting 0anacron
Nov 30 11:01:01 npsiial1p run-parts(/etc/cron.hourly)[123391]: finished 0anacron
Nov 30 11:01:32 npsiial1p polkitd[7063]: Registered Authentication Agent for unix-process:123524:2143092532 (system bus name :1.513569 [/usr/bin/pkttyagent --notify-fd 5 --fallback], object path /org/freede
Nov 30 11:01:32 npsiial1p systemd[1]: Stopping LSB: start and stop MariaDB...
-- Subject: Unit mysql.service has begun shutting down
-- Defined-By: systemd
-- Support: http://lists.freedesktop.org/mailman/listinfo/systemd-devel
--
-- Unit mysql.service has begun shutting down.
Nov 30 11:01:32 npsiial1p mysql[123530]: ERROR! MariaDB server PID file could not be found!
Nov 30 11:01:32 npsiial1p polkitd[7063]: Unregistered Authentication Agent for unix-process:123524:2143092532 (system bus name :1.513569, object path /org/freedesktop/PolicyKit1/AuthenticationAgent, locale
Nov 30 11:01:32 npsiial1p systemd[1]: Stopped LSB: start and stop MariaDB.
-- Subject: Unit mysql.service has finished shutting down
-- Defined-By: systemd
-- Support: http://lists.freedesktop.org/mailman/listinfo/systemd-devel
--
-- Unit mysql.service has finished shutting down.
Nov 30 11:02:45 npsiial1p polkitd[7063]: Registered Authentication Agent for unix-process:123762:2143099816 (system bus name :1.513570 [/usr/bin/pkttyagent --notify-fd 5 --fallback], object path /org/freede
Nov 30 11:02:45 npsiial1p systemd[1]: Starting LSB: start and stop MariaDB...
-- Subject: Unit mysql.service has begun start-up
-- Defined-By: systemd
-- Support: http://lists.freedesktop.org/mailman/listinfo/systemd-devel
--
-- Unit mysql.service has begun starting up.
Nov 30 11:02:45 npsiial1p mysql[123768]: Starting MariaDB.211130 11:02:45 mysqld_safe Logging to '/home/dbsafer/data/mysql/npsiial1p.err'.
Nov 30 11:02:45 npsiial1p mysql[123768]: 211130 11:02:45 mysqld_safe Starting mysqld daemon with databases from /home/dbsafer/data/mysql
Nov 30 11:02:47 npsiial1p mysql[123768]: ./etc/rc.d/init.d/mysql: line 264: kill: (123828) - No such process
Nov 30 11:02:47 npsiial1p mysql[123768]: ERROR!
Nov 30 11:02:47 npsiial1p systemd[1]: mysql.service: control process exited, code=exited status=1
Nov 30 11:02:47 npsiial1p polkitd[7063]: Unregistered Authentication Agent for unix-process:123762:2143099816 (system bus name :1.513570, object path /org/freedesktop/PolicyKit1/AuthenticationAgent, locale
Nov 30 11:02:47 npsiial1p systemd[1]: Failed to start LSB: start and stop MariaDB.
-- Subject: Unit mysql.service has failed
-- Defined-By: systemd
-- Support: http://lists.freedesktop.org/mailman/listinfo/systemd-devel
--
-- Unit mysql.service has failed.
--
-- The result is failed.
Nov 30 11:02:47 npsiial1p systemd[1]: Unit mysql.service entered failed state.
Nov 30 11:02:47 npsiial1p systemd[1]: mysql.service failed
=================================================================================
[처리방안#1] / 권장
/home/dbsafer/data/mysql/aria_log.[숫자] 로그
(""딴경로""이동or백업후 삭제)
* 주의, maria 로그확인시 dbsafer_log_yyyy_mm 데이터 베이스가 innodb가 깨지거나, ""아리아체크""가 필요하다면 해당 DB는 /home/dbsafer/data/mysql이 아닌, 다른 경로에 넣어서 mysql 을 start해야 합니다
[처리방안#2] / mysql에서 가능, maria에서 기능이 지원하는지 확인필요
/etc/my.conf에 옵션추가
innodb_force_recovery = 1
옵션 설명 : 원인은 어떤 요인으로 innodb가 깨져서 mysql이 실행이 안되는 것으로 강제로 복구옵션을 켜주면 일단 켜지는건 가능
* 혹시 모르니 백업 후 db를 다시 세팅하는 것을 권장한다.","공유민: - 두서없이 적었네요
: 잘이해가 안되거나, 급하시면 언제든 연락주세요
감사합니당",https://cafe.naver.com/pnpsecure2/5082
5048,[TIP] 관리자계정 패스워드 인증실패시 인증지연시간 변경 방법,"관리자계정 패스워드 인증실패시, 인증지연시간에 대해 변경 방법 공유드립니다.
매니저 환경설정에 설정되어있는 횟수에 따라,
관리자 계정 패스워드 연속 인증실패시 인증지연(잠김처리) 됩니다.
DEFAULT 60분(3600초)으로 설정되어있으며, 매니저 내에서 시간에 대해 변경 불가
Administrator 계정인 경우 ssh로 접속하여 UNLOCK LOCKED ADMIN ACCOUNT 를 통해 잠금해제 가능하지만,
일반 관리자 계정인 경우, 관리자가 수동으로 잠김해제를 해주거나, 인증 지연시간동안 기다려야 합니다.
따라서, 해당 인증지연시간을 수정하는 방법에 대해 고객사에서 요청하게 되었습니다.
[인증지연시간 설정(수정)방법]
/dbsafer/.conf/pnp_auth.conf 파일에 locktime 옵션추가 설정
locktime 옵션 값은 초(seconds)단위입니다.
해당 설정 후 pnp_agent 모듈 재시작해야 적용됩니다.
인증시간 설정 후 연속 인증실패시 팝업화면(설정 시간 확인)",댓글 없음,https://cafe.naver.com/pnpsecure2/5048
5047,[공유] MongoDB 서비스 사용 시 설정 공유,"고객사 PoC 준비하면서 확인한 내용으로 MongoDB 운영 시 도움이 될 것으로 보여 공유드립니다.
MongoDB만 운영하는 경우 사용할 수 있는 임시 조치방안이며 적용 가능여부 확인 하신 후 사용 바랍니다.
(ex. MongoDB와 RDBMS 서비스 같이 운영 시 로그 조건검색이 잘 안될 수 있음)
[로그조회 설정]
- MongoDB 명령어 로그 조회(SQL Type) 시 UPDATE, INSERT, DELETE는 정상 조회되지만 SELECT는 조회되지 않는 문제가 있습니다.
. NoSQL의 find(), scan() 등의 명령어가 기존 조회 조건과 맞지 않아 발생하는 문제로 아래 설정으로 조치 가능합니다.
. find(), scan() 등의 명령어를 SELECT와 같은 타입으로 분류하고 조회 가능하도록 설정하는 옵션입니다.
. 설정 후 로그 조회 시 SELECT, UPDATE, INSERT, DELETE, 각 조건에 맞게 로그 조회가 가능합니다.
DBSAFER 매니저 시스템 설정
[참고 사항]
- MongoDB 명령어별 SQL 매칭은 아래와 같습니다.
. ex) db.collection.updateOne() 명령어 조회가 필요한 경우 DBSAFER 매니저에서 UPDATE Type으로 조회하면 됩니다.
MongoDB
SQL Type
CREATE
db.collection.insertOne()
CREATE, INSERT
db.collection.insertMany()
READ
db.collection.find()
SELECT
UPDATE
db.collection.updateOne()
UPDATE
db.collection.updateMany()
db.collectionreplaceOne()
DELETE
db.collection.deleteOne()
DELETE
db.collection.deleteMany()",댓글 없음,https://cafe.naver.com/pnpsecure2/5047
5043,[공유] Auto Scaling 그룹에 있는 인스턴스를 서비스로 동기화하지 못하는 현상,"고객사 지원 중 클라우드 통합모듈 동작 관련하여 확인한 이슈를 공유드립니다. 모듈 사용 시 참고 바랍니다.
[이슈 사항]
- pnp_aws_service 모듈 실행 시 Auto Scaling 그룹에 있는 인스턴스를 DBSAFER 서비스로 동기화하지 못 함
[버전 정보]
- pnp_aws_service 1.6
[고객사 환경 확인사항]
- pnp_aws_service 모듈 로그에서 인스턴스 정보를 찾지 못해 서비스 등록 실패한 내용 확인
pnp_aws_service_main 로그 파일
- Auto Scaling 그룹에 있는 인스턴스는 InService, Standby 수명주기를 가지고 있었으며, Stnadby 인스턴스 조회 시 종료된 상태 임을 확인
[내부 환경 확인사항]
- Auto Scaling 운영 환경을 구성하여 인스턴스의 InService, Standby 수명주기 상태에 따른 실행/종료 여부 확인
1) InService -> Standby로 변경된 인스턴스는 자동으로 종료되지 않음
-> Standby로 설정된 경우에도 인스턴스는 실행 중. Auto Scaling 그룹의 트래픽만 처리 불가
2) Standby -> InService로 변경된 인스턴스는 기존 인스턴스가 Auto Scaling 그룹의 트래픽 처리
3) Standby(인스턴스 종료 상태) -> InService로 변경된 인스턴스는 기존 인스턴스 ID가 아닌 새로운 인스턴스 ID로 인스턴스 실행 됨
- EC2 인스턴스 목록에서 Auto Scaling 그룹에 속해있는 인스턴스(Standby 상태) 종료 수행
1) EC2 인스턴스 목록에서 정상 종료되어 없어지나, Auto Scaling 그룹에 인스턴스 목록에는 그대로 유지되어 있음 (고객사와 동일한 상태)
-> 위와 같은 상황일 시 모든 인스턴스가 서비스로 동기화 되지 않음
- EC2 인스턴스 목록에서 Auto Scaling 그룹에 속해있는 인스턴스(InService 상태) 종료 수행
1) EC2 인스턴스 목록에서 정상 종료되어 없어지며, Auto Scaling 그룹에서도 인스턴스 삭제 됨
[연구소 분석 결과 및 조치 방안]
- Auto Scaling 그룹에 속한 인스턴스를 Standby 상태로 변경하는 경우, 인스턴스에 대한 상태 체크를 하지 않음
- EC2 인스턴스가 삭제되어도 그룹 내에 포함된 상태로 존재 함에 따라 증상 발생
- 그룹 내 특정 인스턴스를 조회 못할 시, 제외하고 취득하여 서비스 동기화하도록 수정 예정 (~11/5)
[참고 자료]
- Auto Scaling 그룹의 인스턴스 수명 주기에 대한 설명
. https://docs.aws.amazon.com/ko_kr/autoscaling/ec2/userguide/as-enter-exit-standby.html
Auto Scaling 그룹에서 인스턴스를 일시적으로 제거하려면 - Amazon EC2 Auto Scaling
Auto Scaling 그룹에 EC2 인스턴스를 대기 상태에 배치하는 방법을 알아봅니다.
docs.aws.amazon.com",댓글 없음,https://cafe.naver.com/pnpsecure2/5043
5042,[TIP] Razorsql 툴을 통한 AWS Dynamodb 서비스 접근제어 시 필수 설정,"Razorsql 툴을 통해 AWS Dynamodb를 접속하는 세션 접근제어 시 Razorsql 툴에서 필수로 설정해야할 내용을 공유드립니다.
* client db tool 통한 Dynamodb 접속 시 접근제어 방식
Client Tool을 통해 AWS DynamoDB 서버 접속 시 HTTPS 프로토콜을 이용하여 암호화 된 패킷을 통신 할 수 있기 때문에 서비스에서 파싱 가능하도록 복호화 해주는 프록시 모듈이 필요합니다.
위와 같이 pnp_ssl_proxy 모듈이 패킷을 암복호화 하여 dynamodb와 서비스 모듈 사이에서 중계하게 되는데 이 암복호화 과정에서 pnpsecure.cloud.crt(공개키)와 pnpsecure.cloud.key(개인키) 인증서를 사용하게 됩니다.
> 인증서 관련 링크 : https://bugs.pnpsecure.com/view.php?id=16698
* PC Agent 로그인 후 Razorsql > Dynamodb 접속 시 필수 설정
위의 dynamodb 접근제어 방식 특성 상 Razorsql 툴에 pnpsecure.cloud.crt(공개키)를 아래와 Import 설정해주어야 DB에 정상 접속이 가능합니다.
> 미 설정 시 PC Agent 로그인 후 dynamodb 접속 불가 현상 발생
> 아래 Import SSL Certificate 설정은 RazorSQL 8.0.9버전부터 사용 가능
[설정 방법]
1) RazorSQL 실행 > help > Import SSl Certificate
2) Browse > PC에 다운로드 한 pnpsecure.cloud.crt 파일 불러오기 > OK
3) 화면에 표시되는 명령어를 복사한 후 Windows 명령 프롬프트(cmd)에서 실행.(cmd 관리자 권한 실행 필요)
> 명령어 실행 중, 인증서 신뢰 여부 확인 시, Y 입력 후 Enter
위 설정 이후 PC Agent 로그인 사용자의 Dynamodb 서비스 모듈 중계 접속 정상",댓글 없음,https://cafe.naver.com/pnpsecure2/5042
5034,"[TIP]telnet,ssh 금칙어(차단 명령어) 공유","일반적으로 명령어를 그대로 넣었을 경우 %ssh%로 동작합니다.
이에따라 의도치 않게 차단 되는 경우가 많습니다.
아래와 같이 정규식을 가지고 이를 해결할 수 있습니다.
[[:blank:]]alias *$
[[:blank:]]radmin *$
[[:blank:]]rcp *$
[[:blank:]]rexec *$
[[:blank:]]rlogin *$
[[:blank:]]rwall *$
\<ssh\>
\<su\>
^alias *$
^alias [0-9a-zA-Z]
^dd *$
^ftp *$
^ftp [0-9a-zA-Z]
^kill *$
^radmin *$
^rcp *$
^rexec *$
^rlogin *$
^rlogin [0-9a-zA-Z]
^rm(-rf) *$
^rmdir *$
^rwall *$
^sftp *$
^sftp [0-9a-zA-Z]
^ssh *$
^ssh [0-9a-zA-Z]
^telnet *$
^tn[[:blank:]]
^xargs *$
su - root
telnet [0-9a-zA-Z]",현승환: 좋은 정보 공유 감사드립니다.,https://cafe.naver.com/pnpsecure2/5034
5022,[TIP][매니저] 서비스 및 보안계정에 사용자 정의 객체 추가 기능(회사명 또는 계열사 추가 필드 설정),"1. 요약
대형 고객사들 중 한 개의 DBSAFER 환경에서 여러 계열사를 통합 관리하는 경우, 담당자는 등록된 서비스 객체, 보안계정에 대해 계열사마다 서로 다른 요청으로 운영/관리하는데 어려움이 있습니다. (데이터 추출 및 정책연동 등)
EX) 신세계 그룹사내 스타벅스, 면세점, 백화점, 이마트 서버들이 존재
이때, 매니저-시스템 설정-객체 동작 설정 탭의 '서비스 및 보안계정에 사용자 정의 객체 추가 기능 사용 (객체 추가)'을 통해 계열사별로 서비스와 보안계정을 관리할 수 있습니다.
2. 사용 방법
1) 매니저-시스템 설정-객체 동작 설정 탭의 '서비스 및 보안계정에 사용자 정의 객체 추가 기능 사용 체크 및 필드명 입력
EX) '회사명' 컬럼 추가
서비스 및 보안계정에 사용자 정의 객체 추가 기능 사용
2) 서비스-객체 추가 선택 후 추가된 필드에 객체 추가 및 선택
서비스 객체에서 추가 필드(회사명) 등록 및 선택
3) 보안계정-객체 추가 선택 후 추가된 필드에 객체 추가 및 선택
보안계정 객체에서 서비스 객체에서 추가 필드(회사명) 등록 및 선택","박상원: 기능 공유 감사합니다.
하나 문의사항이 있어 댓글을 남깁니다!

법규에 따르면 조직은 안전조치의무를 이행해야 합니다.

계열사로 구분되어 있다는 것은 서로 다른 조직으로 각각 목적을 갖고 사업을 한다고 볼 수 있을 거 같은데,

이 경우에 하나의 DBSAFER로 계열사들의 로그 및 정책을 관리하게되면 문제가 되지 않을까요? | 여성구: 본 기능을 사용할 시에 서비스 및 보안계정 리스트 로딩이 조금 늦어질 수 있으니 참고해주세요.

향후 서비스 및 보안계정의 필드는 정책 설정 시에 참고 할 수 있도록 연계를 시켯으며 매니저 관리자 권한에서도 활용하여 쉽게 권한을 할당할 수 있도록 논의 하고자 합니다.",https://cafe.naver.com/pnpsecure2/5022
5011,[공유] Windows SA 설치 후 우회접속 시 세션 종료되는 현상 공유,"[고객사 환경]
- 대상 서버 OS : Windows Server 2016
- 대상 서버 NIC : XenServer PV Network Device #0 (10.37.20.212), XenServer PV Network Device #1 (192.168.101.176)
[버전 정보]
- Server Agent 5.1.2.56
- pnp_telnet
. Telnet Release version 3.3.369 128bit -SafetyCMD for RelTBINC-CentOS7
. Build (3369) Build-Update (Apr 7 2021 09:18:53) MAX-USER : 1000
. MAIN VERSION 3.7 (20150812)
. ADDED OPTION STATUS: NONE
. COMMON MAIN MODULE VERSION: 3.3.369 128bit -SafetyCMD
. COMMON LIBRARY VERSION: 3386
. COMMON POLICY MODULE VERSION: 1.2.19
. COMMON CERTIFICATION MODULE VERSION: V3
. COMMON 2FACTOR PROTOCOL : v2
. SHARED INTERFACE VERSION: 466
. COMMON-API(UTIL) VERSION: 111
[이슈 사항]
- Windows SA 설치 후 우회접속 시 세션 종료되는 현상 발생
. DBSAFER의 Terminal, Server Agent 정책은 모두 허용으로 적용되어 있는 상태
- 우회접속이 아닌 DBSAFER를 경유하여 접속하는 경우에는 세션 종료 현상 발생하지 않음
. 사용자 PC에서 대상 서버(10.37.20.212)로 우회 접속 시 세션 종료 현상 발생
. 사용자 PC에서 다른 Windows를 경유하여 대상 서버(192.168.101.176)로 일반 접속(PC Assist 사용) 시 정상 동작 됨
-> 10대역 일반 접속 및 192대역 우회접속은 방화벽으로 통제되고 있어 테스트하지 못하였습니다.
[이슈 분석]
- pnp_telnet 모듈에서 RDP 접속 종료를 요청하여 WTA에서 RDP 접속을 종료 함
. nodesaferwa를 이용한 세션 제어를 위해 Operation Level을 2로 설정해 놓았으며, 차단 정책이 없음에도 세션 종료 시그널 수신
. 해당 증상은 Server Agent 버전과는 무관하게 발생하는 것으로 추정
(참고) WTA 로그
[예정 사항]
- 유사한 증상이 Bugs에 등록되어 있음
. https://bugs.pnpsecure.com/view.php?id=20559
- 이슈 해결을 위해 관련 모듈 수정이 필요하나 연구소 담당 개발자가 긴급 지원 업무로 빠른 대응이 어려운 상태
. 가능하면 10월 중 조치 예정이라고 합니다.
- 임시 조치 방안으로는 Operation Level을 1로 설정하여 운영하는 방법이 있을 것 같습니다.
. 해당 이슈에 영향이 없는 모듈 버전 확인되면 추가해 놓겠습니다.","진선태: 사내 재현이 되나요?

추가 체크 사항은 우회 접속 정책에는 정책이 없어도, 기본 터미널서비스 정책에 차단이 정책이 있다면 WTA에서는 차단이 발생될 수 있습니다.

특히 NAT를 탔을 경우는 차단이 안되고, NAT를 타지 않고 우회 접속에서 차단되는 경우는 접속/권한 정책에 보안계정별 허용 정책이 있고, 기타 접속은 차단하는 경우 발생될 수 있습니다. (종종 현장에서 착각하는 부분)

우선 사내 재현 환경에서 해당 증상을 보면서 분석하면 바로 조치 가능할 것으로 보입니다. | 박상원: 현재 고객사 환경에서 증상 재현되며, 1차로 개발자분께 분석 환경을 제공해드릴 수 있습니다.

고객사 환경에서의 분석은 리스크가 있기 때문에 사내 재현 환경을 구성하여 제공할 수 있도록 하겠습니다. | 진선태: 패킷을 보니 뒷쪽에 정상적으로 정책에 의한 Kill 시그널이 발생되었습니다. 이는 정책 없이는 발생되지 않는 동작인데, 뭔가 착가하고 있거나 모듈이 잘못 수정된 것으로 추정됩니다. 후속 대응 잘 부탁 드립니다. | 박상원: 넵, 정확히 확인하여 대응하도록 하겠습니다.
추가로 고객사 환경 등 확인한 사항을 본문에 기입하여 두었습니다. | 조재용: https://bugs.pnpsecure.com/view.php?id=20559 이슈에 기재된 환경에서 해당 이슈 재현 확인했습니다. | 진선태:  | 채널지원: pnp_telnet v3366(2021-01-30) ~ v3383(2021-09-05) 버전에서 해당 현상 발생

[발생원인]
pnp_telnet 에서 RDP 세션에 대한 처리를 수행할 시, 2Factor 인증에 과정에서 사용자/서버 간의 타임아웃 + 세션 종료 현상을 개선하기 위한 기능이 추가되었습니다.
그 과정에서 사용자/서버 의 세션이 끊어짐을 감지하면 세션을 종료하게 되어 있습니다.

우회 접속 시, WTA 에서 pnp_telnet 대상으로 접근한 세션은 한개(사용자로 가상 인식) 인 관계로, 서버와의 연결 세션이 존재하지 않은 것으로 판단되고 있기에,
세션을 종료하는 처리로 유도되고 있습니다.

[수정사항]
사용자 또는 서버 중 한개의 세션이라도 연결이 안되어 있을 경우에는, 세션을 종료하는 대상으로 간주하지 않도록 수정하였습니다.",https://cafe.naver.com/pnpsecure2/5011
4993,PC AGENT 설치파일에 디지털서명 (코드사이닝) 추가가 필요할 경우,"요약 : 고객사에서 PC AGENT 파일에 디지털 서명을 요청할 경우
1. 고객사에서 사용할 PC AGENT 파일을 우선 빌드하고
2. 해당 설치 파일을 PC AGENT 개발자(현재 담당자 : 한성현 대리) 에게
전달하여 코드사이닝을 요청하여 받습니다.
내용 : 1. 디지털 서명?
(일반적으로는 디지털 서명이라고 부르고 디지털 서명을 추가하는 작업을 코드사이닝을 한다고 합니다.)
코드 사이닝된 프로그램은 그 소프트웨어가 암호화를 통해 제조업체의 서명을 받은
합법적인 소프트웨어임을 보증하기 위해 쓰입니다.
제조업체로부터 최종 사용자에 전달되는 과정에서 변조되지 않았음을 보장하며,
특히 제조업체 자체 페이지가 아닌 다른 웹사이트에서 소프트웨어를 다운로드할 때 중요합니다.
예를 들면 이를 통해 소프트웨어를 다운로드할 때는 공격자가 악성코드를 주입한 실행 파일이 아니라
제조업체가 제공한 공식 소프트웨어 패키지가 맞는지를 확인할 수 있습니다.
참고로 디지털 서명이 없는 설치 파일을 윈도우에서 실행할 경우
아래처럼 알수없는 게시자에 대한 경고가 나오는 것을 많이 보셨을 겁니다.
코드사이닝 관련 참고 URL :
https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=ucert&logNo=221237790440
2. 고객사에서 PC AGENT파일에 디지털 서명이 필요했던 이유는?
고객사 ***연금보험에서는 PC AGENT 를 배포할 경우 PMS라는 패치관리솔루션을 통해서 배포를 하게 되는데
자동배포를 위해서 다음 두 가지를 요청하였습니다.
(1) silent 모드 ----> 엔지니어가 빌드할 때 적용 가능
(2) 디지털서명 ----> 개발자를 통해서 적용 가능
PMS (패치관리시스템) 솔루션에서 신뢰할 수 있는 설치파일을 배포하기 위한 방법으로 디지털서명을 체크하게되는데 이를 위해서 코드사이닝 처리가 된 설치파일을 고객사가 요청하게 되었습니다. 추가적으로 잘 아시는 slient 모드는 앤드유저가 PC AGENT 설치시 '다음' 버튼을 여러번 누르지 않고 PMS를 통한 배포 및 자연스러운 백그라운드 설치와 연계되기 위해 적용하게 되었습니다.
PMS에 솔루션에 관한 URL : https://www.koreascience.or.kr/article/CFKO201629368423843.pdf
3. 엔지니어가 직접 할 수 없는지?
코드사이닝을 위해서 인증USB가 필요한데 개발자만 보유하고 있기 때문에 엔지니어가 직접 작업할 수는 없고 개발자에게 빌드 완료된 설치파일을 전달하고 요청해야 합니다.
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/4993
4955,[TIP][NHN] DBSAFER 감사 로그 조회 시 한글 깨짐 현상 조치 방법,"[개요]
NHN 개발 서버 MySQL DB로 구축 후 매니저 감사로그 조회 시(정책명, 사용자명, 부서명 등) 한글이 깨지는 현상이 있었습니다.
한글 깨짐 발생 시 아래 캐릭터 셋 조치 내용 참고하시면 좋을 것 같습니다.
[구성 환경]
DBSAFER5(종류 : MYSQL / 버전 : 5.7.32 / 캐릭터 셋 : UTF-8)
[증상]
매니저 감사 로그 조회 시(정책명, 사용자명, 부서명 등) 한글이 깨져서 보이는 현상
[조치 내역]
1. Manager 프로그램 버전 확인
> MySQL DB인 경우 MySQL전용 Manager를 사용해야 합니다.
2. locale 설정 확인
# locale
> 정상적으로 UTF-8 설정이 되어 있는지 확인
> locale이란 : 사용자 인터페이스에서 사용되는 언어, 지역 설정, 출력 형식 등을 정의하는 문자열입니다.
3. lang.conf 설정 확인
# vi /dbsafer/.conf/lang.conf
> lang=ko 설정이 되어 있는지 확인
> DBSAFER 제품 language setting 값이 들어 있는 파일입니다.
4. my.cnf 캐릭터 셋 설정 확인
# vi /etc/my.cnf
# [mysqld]
# character-set-server=utf8
# collation-server=utf8_general_ci
# [client]
# default-character-set=utf8
> utf8 설정 확인
5. 파일 캐릭터 셋 설정 및 MySQL DB에서 캐릭터 셋 확인
# mysql -u root -p
# show variables like 'c%';
> server와 client의 캐릭터 셋을 확인
6. 감사 로그 조회 시 한글이 깨지는 보안계정 테이블(dbsafer_ldap_list) 값 확인
# select * from dbsafer3.dbsafer_ldap_list where sno = '한글이 깨지는 보안계정 아이디'
> 한글 정상적으로 저장 확인
7. 감사 로그 DB 확인
# select * from dbsafer_log_YYYY_MM.db_user_DD;
> 감사 로그에는 깨져서 저장되는걸 확인
> 여기까지 확인을 통해 Manager 및 dbsafer_ldap_list는 문제가 없다는 판단을 하였음
> 추가로 tcpdump 확인 시 대상 DB 세션을 연결하는 과정에서 pnp_oms_dms 모듈이 보안계정을 전달할 때 한글이 깨져서 전달되는 걸 확인
8. DBSAFER PKG의 캐릭터 셋을 UTF-8로 패치
> UTF-8 캐릭터 셋으로 DBSAFER PKG를 재빌드 받아서 패치하였지만 동일 증상
9. my.cnf 파일 skip-character-set-client-handshake 설정 추가
# vi /etc/my.cnf
# [mysqld]
# skip-character-set-client-handshake
# service mysqld restart
> client와 DB 서버가 connection을 맺을 때 handshake 과정에서 client가 사용하는 캐릭터 셋을 무시하는 옵션
10. skip-character-set-client-handshake 설정 추가 후 정상 로깅 확인
[결론]
MySQL 5.5, MariaDB 5.5 이후 버전에서는 my.cnf 파일 [client]부분 default-character-set 옵션이 제거되었다고 합니다.
즉, 해당 버전은 5.7 버전이므로 my.cnf에 default-character-set=utf8 설정이 적용이 안 되고 있었기 때문에 5.5 이후 버전에서는 [mysqld]부분skip-character-set-client-handshake 옵션을 설정하여 Client가 Server에 connection 시 Server 캐릭터 셋으로 연결되게끔 합니다.
Client와 Server 간 handshake 과정에서 Client는 자신이 사용할 캐릭터 셋을 전달하는데 Server에서는 이 정보를
character_set_client, character_set_connection, character_set_results으로 설정합니다.
(위 설정 값은 #show variables like '%c'; 명령어로 확인 가능)
실제 조치 내역(5번)에서도 위 설정들이 utf8로 되어 있기 때문에 확인이 어려웠습니다.
결론적으로 MySQL 5.5, MariaDB 5.5 이후 버전에서는 variables 설정에 utf8로 되어 있더라도 반드시 skip-character-set-client-handshake 추가해주시면 됩니다.
(적극적인 문제해결에 도움을 주신 김태윤 실장님, 안규상 팀장님께 감사드립니다.!)
[참고 사이트]
1. https://www.lesstif.com/dbms/mysql-rhel-centos-ubuntu-20775198.html
2. https://medium.com/oldbeedev/mysql-utf8mb4-character-set-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0-da7624958624",여성구: 타 사이트에서도 동일한 이슈가 있었는데 정리를 잘해주셨네요. 감사합니다.,https://cafe.naver.com/pnpsecure2/4955
4953,PCAssist에서 RDP로깅 2021.08.03,"PCAssist에서 RDP로깅 방법과 제약사항 관련 내용을 기술하였습니다.
1. 테스트 버전
- WTA PROXY SERVER Release Version 1.1.1 for RelTBINUC-CentOS7 (Rev 41) [Jun 8 2021] !!
- wta_player-1.0.2.1 Date:2021/06/08 15:28:41 v1
- WTA SERVER MANAGER Release Version 1.1.3 for RelTBINUC-CentOS7 (Rev 52) [Jun 8 2021] !!
2. 활성화 옵션
- dbsafer_oms_dms.conf
- Manager 옵션 활성화
3. 제약 사항
- ""접속계정명""이 mstsc.exe로 로그에 표기됨
- RDP 로깅화면 보이는 크기로 이미지 로깅됨
- ServerAgent의 경우 버튼 클릭 이벤트를 모두 남기거나 nodepad등 프로그램을 열 경우 모두 기록이 남았으나
PCAssist에서는 키스트로그 위주의 로그와 동영상 위주의 로그만 남음.(text 검색 불가)
- 동영상 리플레이 가능
※ pnp_telnet을 최신으로 패치 후 ""로그서버로 저장옵션활성화"" 시 img파일을 로그서버에도 저장이 가능",댓글 없음,https://cafe.naver.com/pnpsecure2/4953
4952,인사연동 잘 활용하기(dbsafer_accountsync.sh),"고객의 요청으로 인사연동시에 기본 옵션으로 아래와 같은 사항을 요청 할경우 인사연동 옵션으로만 처리 가능합니다.
# dbsafer_accountsync.sh의 쿼리 실행 옵션
################################################################################
# 보안계정 객체 입력/갱신 후, 추가 실행할 쿼리 입력합니다.
# dbsafer_ldap_list의 필드명 중, ColumnXXX에 설정한 항목에 사응하는 대상에 한하여 예약어 사용이 가능합니다.
# - ex) [[sno]] --> 보안계정으로 전환하여 쿼리 수행
# - ex) AdditionalQueryInsert = UPDATE `dbsafer3`.`dbsafer_ldap_list` SET `default_auth_use` = 1 WHERE `sno`=[[sno]];
# - ex) AdditionalQueryUpdate = UPDATE `dbsafer3`.`dbsafer_ldap_list` SET `default_auth_use` = 1 WHERE `sno`=[[sno]];
################################################################################
#AdditionalQueryInsert =
#AdditionalQueryUpdate =
AdditionalQueryInsert UPDATE dbsafer3.dbsafer_ldap_list SET default_auth_use = 2, user_auth_type = 4, decide_draft = 1 where sno = [[sno]]; <== 활성화
=================================
default_auth_use = 1 => 보안계정 인증
default_auth_use = 2 => LDAP 인증
user_auth_type = 0 ==> 미사용
user_auth_type = 4 ==> OTP사용
decide_draft = 0 ==> 결재 미사용
decide_draft = 1 ==> 결재 사용
=================================",댓글 없음,https://cafe.naver.com/pnpsecure2/4952
4944,[공유] nessus 등 취약점 진단 도구의 DBSAFER의 ssh 서비스 포트 스캔에 대한 취약점 점검 대응,"[이슈 요약]
nessus 등 취약점 진단 도구로 DBSAFER 취약점 점검 중
DBSAFER의 4000번대 ssh 서비스 포트 스캔시
취약점이 많은 OpenSSH_3.0 버젼이 표현되는 것에 대한 대응방안 공유합니다.
(실제 openssh 3.0을 쓰는 것이 아니고 하위 호환성을 위한 코딩)
(ssh바인딩 포트로 telnet 192.168.X.X 400X 결과 화면)
[조치 방법]
/dbsafer/.conf/pnp_telnet.conf
설정 파일 내 다음 항목 수정 후 DBSAFER의 서비스 모듈은 재시작.
[SSH_FAKE_LABEL]
OpenSSH_7.5
또는
[SSH_FAKE_LABEL]
bypass
(옵션 설명)
OpenSSH_7.5 입력 시 : SSH-2.0-OpenSSH_7.5 DBSAFER_2.30.164 처럼 바뀌어
불필요한 취약점 진단 결과에 나오지 않게 할 수 있음
bypass 입력 시 : 서버의 LABEL을 그대로 bypass해서 출력해 줌
SSH-2.0-OpenSSH_6.8 등으로 표현됨 (서버마다 다른 값으로 출력)
[주의 사항]
모든 사이트에 디폴트 값으로 하는 것은 문제가 있는데
버전을 강제적으로 조정하게 되면 일부 오래된 버젼의 클라이언트 툴에서 ssh 접속이 안되는 문제가 있을 수 있습니다.
[상세 내용]
관련 벅스 : 2016년 8월에 조치됨
https://bugs.pnpsecure.com/view.php?id=9337
배너그래빙(banner grabbing) 을 통해 오픈된 포트의 취약점을 발견하는 진단활동을 할 때
DBSAFER의 ssh 서비스 포트를 점검할 경우 OpenSSH 3.0으로 메시지가 나오는 것은 실제
버젼이 3.0이기 때문이 아니라 사용자의 툴 중 오래된 버젼과의 하위 호환성 때문에 고정된 값으로
이를 진단도구가 오탐하는 경우가 발생함.
* 고객사(알리엑스) 대응 순서 (1),(2) 설명 후 (3) 조치 , (4) 확인
(1) 모듈에서 클라이언트의 ssh 접속에 대한 연결을 위해 하위 호한성을 감안한
응답값을 주는데 해당 응답값에 포함된 'openssh_3.0' 의 값을 Nessus 에서 탐지한 상황으로
(2) DBSAFER의 sshd는 openssh 프로토콜을 파싱하고
중계하기 위해 사용하는 모듈로 실제적으로 openssh 자체와 다른 모듈임을 설명
('openssh_3.0' 의 값은 가상값이며 해당 모듈은 실제 openssh가 아님)
(3) [SSH_FAKE_LABEL] 수정 조치
(4) 진단도구의 결과값에서 DBSAFER 취약점 여부 체크","진선태: 중요 정보 공유해 줘고 고맙습니다. | 여성구: 정리까지 잘해주셔서 감사합니다. 하나만 덧 붙이자면 DBSAFER 의 SSH모듈은 중계 모듈로서 기본적으로 보안 감사 대상에서 예외 요청을 하는 것이 먼저 되면 좋을 것 입니다.
상위의 보안 점검은 ssh서버에 대한 보안점검 목적인데 실제 보안 취약점 대응은 pnp_ssh 모듈 배너가 된 것 입니다.",https://cafe.naver.com/pnpsecure2/4944
4927,"[공유][솔루스] DBSAFER 사용 시 editor툴(editplus, vscode)에서 SFTP 접속 불가 현상","[이슈 내용]
- DBSAFER 사용할 시 에러 발생
- putty 및 파일질라(FTP 프로그램)는 서버 접속 가능
- editplus, vscode(SFTP)를 이용한 작업에서는 서버 연결 불가능
- editplus 에러메세지
- vscode 에러메세지
[확인 내용]
- editplus 버전: 4.3
- vscode : 최신버전 사용중
- ssh 모듈 버전 : ssh_p6 version SSH_DBSAFER_2.32.66
- tcpdump 패킷 확인
[Client: Key Exchange Init]
- Client to server sting
aes128-cbc,3des-cbc,blowfish-cbc,cast128-cbc,arcfour,aes192-cbc,aes256-cbc,rijndael128-cbc,rijndael192-cbc,rijndael256-cbc,rijndael-cbc@lysator.liu.se,aes128-ctr,aes192-ctr,aes256-ctr
- server to client sting
aes128-cbc,3des-cbc,blowfish-cbc,cast128-cbc,arcfour,aes192-cbc,aes256-cbc,rijndael128-cbc,rijndael192-cbc,rijndael256-cbc,rijndael-cbc@lysator.liu.se,aes128-ctr,aes192-ctr,aes256-ctr
[Server: Key Exchange Init]
- Client to server sting
aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm,aes128-gcm@openssh.com,aes256-gcm,aes256-gcm@openssh.com
- server to client sting
aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm,aes128-gcm@openssh.com,aes256-gcm,aes256-gcm@openssh.com
+확인방법
=> Client 와 Server 암호화 키가 맞지 않음
[조치 내용]
키 인증 알고리즘 추가 조치
1) DBSAFER서버 /usr/local/etc/sshd_config 파일 수정
HostKey /usr/local/etc/ssh_host_rsa_key 주석 해제
HostKey /usr/local/etc/ssh_host_dsa_key 주석 해제
2) moduli 파일 /usr/local/etc에 복사
https://bbs.pnpsecure.com/showthread.php?tid=5751
PNPSECURE's BBS
PNPSECURE's BBS You are either not logged in or do not have permission to view this page. This could be because one of the following reasons: You are not logged in or registered. Please use the form at the bottom of this page to login. You do not have permission to access this page. Are you trying t...
bbs.pnpsecure.com
3) 서비스 재시작
- 조치 후 에러 발생 사라짐 및 접속 확인 완료","진선태: 2) DBSAFER서버 /etc/ssh/ssh_config 파일 수정 는
DBSAFER서버 아니고, 대상 서버 아닌가요?

DBSAFER 장비의 /etc/ssh/ssh_config는 ssh proxy 중계에서는 영향이 없습니다. | 송민화: 수정했습니다. 감사합니다! | 진선태: 수정된 내용 보니 이해가 되네요. 감사합니다 | 송민화: [벅스 내용 공유]
https://bugs.pnpsecure.com/view.php?id=20528",https://cafe.naver.com/pnpsecure2/4927
4926,[공유][포스코] DB를 ROOT 계정으로 설치 하지 않았을 경우 WEBREPORT 설치 방법 및 이슈 공유,"[이슈사항]
- MariaDB를 포스코 측에서 직접 관리하길 원하여 TSS팀에서 직접 설치
- OS에서 ROOT 계정으로 mysql 접근 불가하여 기존 install.sh 스크립트 및 기본 설정으로는 webreport 설치 불가
[버전 및 패키지 정보]
Java version : 11.0.1
Tomcat version : 9.0.36
CustomSet_for_RHEL7_20200831.tgz
PKG_DBSAFER5_RelR20.05C-RHEL7_x86_64_p9.11_20200917.tar.gz
COMMON_UTIL_V2.12_build-11_20200618.tgz
WEBREPORT_3.0.0.1_409_Build-4186_20200907.tgz
[조치방법]
1. install.sh 스크립트 수정
- 아래 사진과 같이 기존 'mysql'을 포함한 구문 모두
mysql 실행이 되는 경로 + 소켓지정 '/DBMS/PDBAC/mariadb/10418/bin/mysql -S /DBMS/PDBAC/mariadb/10418/mysql.sock' 으로 수정
- ID/PW 값은 dbms_info에서 값을 불러옴
기존 : mysql -u $InputID -p$InputPW -h $HostIP -P $HostPort < ./resource/dbscript/common/webreport_table.sql
수정 : /DBMS/PDBAC/mariadb/10418/bin/mysql -S /DBMS/PDBAC/mariadb/10418/mysql.sock -u $InputID -p$InputPW -h $HostIP -P $HostPort < ./resource/dbscript/common/webreport_table.sql
2. apache-tomcat check 부분 오류
- apache-tomcat 설치를 확인하는 부분에서 apache tomcat not install in server. 에러가 발생하여 스크립트 진행 불가
- apache-tomcat 설치 확인 : 9.0.36 버전 설치
- apache-tomcat check 주석처리 후 진행
3. IP/PORT 변경
- install.sh 파일에서 install option confirm 부분의 host ip/port 를 설정
- /usr/local/apache/conf/server.xml 파일에 현재 DB 연결하는 설정 맞게 설정
- /home/webproperties/webreport/webreport.properties >>> 웹리포트가 바라보는 파일
- /home/webapps/webreport/conf/webreport.properties >>> 웹리포트 설치시 환경설정
- 이를 설정하지 않으면 ""보고서를 로딩하면서 예외가 발생 했습니다."" ""서버에 연결할 수 없습니다."" 에러를 확인할 수 있음
4. sql 오류
install.sh 설치하는 과정에서 sql 오류 발생, 위 정상 설치를 위해 삭제하고 다시 설치하는 과정에서 ~/webreport 설치 파일/resource/dbscript 가 삭제되어 다시 생성한 뒤 설치
추가/수정할 사항이 있으시다면 댓글로 남겨주시면 감사하겠습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/4926
4925,[TIP][포스코] 정책DB 이관 후 매니저 메뉴에 자동연동정책이 보이지 않는 현상 및 자동연동정책 DB 구조 공유,"[이슈사항]
- 기존 DBSAFER 에서는 자동연동 정책을 사용하지 않음
- 업그레이드 프로젝트를 진행하며 신규 DBSAFER에서는 자동연동정책을 사용하게 됨
- 2021년 05월~ 서버 업그레이드를 완료하여 포스코 측 테스트 팀이 사용 중
- 많은 정책 추가/수정으로 2021년 07월 정책 DB를 재 이관
- 정책DB 이관 이후 자동연동정책이 매니저 메뉴에서 보이지 않는 현상 발생
[버전 및 패키지 정보]
- CustomSet_for_RHEL7_20200831.tgz
- PKG_DBSAFER5_RelR20.05C-RHEL7_x86_64_p9.11_20200917.tar.gz
- dbsafer_policylinkage_1.48.tar.gz
- pnp_custom_policy.posco.R367.RHEL7.x64.MariaDB.tar.gz
[원인]
- dbsafer3의 posco_policy_view table 을 참조하여 매니저 메뉴를 가져오게 됨
- dbsafer3 DB를 이관하며 posco_policy와 view table가 사라지게 되어 매니저 메뉴에서 보이지 않는 현상 확인
[자동연동정책 DB 구조]
- 자동연동정책 설치 시 psync 와 dbsafer3 두개의 DB에 table이 생성됨
- psync DB에 posco_policy table 생성
- dbsafer3 DB에 posco_policy, posco_policy_view table 생성
[조치]
- policylinkage를 다시 설치하여 dbsafer3 DB에 view table이 생성되도록 조치
# ./dbsafer_policylinkage.sh install_db
# ./dbsafer_policylinkage.sh start
# ./dbsafer_policylinkage.sh run
추가/수정할 사항이 있으시다면 댓글로 남겨주시면 감사하겠습니다.
문제해결에 도움을 주신 전지웅 대리님 감사드립니다 !",댓글 없음,https://cafe.naver.com/pnpsecure2/4925
4919,[공유] '매니져' - '보안계정 객체 수정' 팝업 창에서 긴 그룹명을 모두 표현 가능한 매니져 버젼 정보 공유,"[요약]
매니져 5974버젼을 사용하면
'보안계정 객체 수정' 팝업창에서 긴 그룹명을 표현 가능합니다. ( 하단 이미지 참고 )
https://bbs.pnpsecure.com/showthread.php?tid=9951
[상세]
왜 필요한가요?
보안계정 객체를 클릭하여 보안계정 그룹 여러개를 체크하는 방식으로 접근정책을 관리할 때
유사한 이름의 보안계정 그룹이 많거나 긴 그룹명을 사용할 경우
한번에 볼 수 없었으나 5974버젼에서 긴 그룹명 전체를 표현되도록 개선되었습니다.
( 기존 매니져는 긴 그룹명을 모두 표현하지 않고 마지막 부분을 ... 으로 표현하여
마우스커서를 해당 객체에 올리고 잠시 있으면 긴 그룹명을 보여주지만
기다려야하고 한번에 하나의 그룹명을 확인해야하는 불편함이 있었음)
[주의]
현재 고객사에서 사용하는 매니져 버젼과 많은 버젼 차이가 있는 최신 버젼을 사용할 때는
많은 변경사항이 있을 수 있으니 테스트 및 BBS게시물의 릴리즈 노트 확인이 필요합니다.
[이미지]",댓글 없음,https://cafe.naver.com/pnpsecure2/4919
4913,[TIP] DBSAFER 우회 접속 패킷 포워딩 기능 설정 방법,"[개요]
DB 사용자가 DBSAFER를 우회하여 대상 DB에 접속 후 작업 할 경우 Server Agent의 우회 접속 패킷 포워딩 기능 활성화를 통해 우회 접속 사용자가 작업한 이력에 대해서 로깅 및 모니터링 가능 합니다.
Windows / Linux 환경 별 우회 접속 패킷 포워딩 설정 방법 공유드립니다.
[요약]
- Windows 서버 인바운드 패킷 포워딩 기능 검증
- Linux 서버 인/아웃 바운드 패킷 포워딩 기능 검증
[테스트 환경]
- 사용자 192.168.169.1 / PC Agent 미사용
- MSSQL 192.168.169.30 / SA 설치 여부 O
- MySQL A 192.168.169.11 / SA 설치 여부 O
- MySQL B 192.168.169.40 / SA 설치 여부 X
[테스트 과정]
- 우회 접속 패킷 포워딩 기능 사용을 위해 스니핑 서비스 등록이 필요하므로 DBSAFER 서버의 sniff.conf 설정 필요
. vi /dbsafer/.conf/sniff.conf -> SNIFF INTERFACES 설정 필요
> sniff.conf 파일 없을 경우 스니프 모듈 -c 옵션을 통해 default 파일 생성 가능
- Windows 서버 인바운드 패킷 포워딩 기능 검증 (사용자 -> MSSQL)
. 대상 서버에 설치된 Server Agent 에서 우회 접속 패킷 포워딩 기능 활성화
. DBSAFER 매니저에서 스니핑 서비스 등록 필요
> 등록 시 서버 주소 : Windows 서버 주소 , 포트 : MSSQL 사용 포트
. 사용자 우회접속 시 스니핑 서비스를 통해 작업 이력 확인 가능
- Linux 서버 인바운드 패킷 포워딩 기능 검증 (사용자 -> MySQL A)
. 대상 서버에 설치된 Server Agent 에서 우회 접속 패킷 포워딩 기능 활성화
> Server Agent 폴더/conf/server_agent.conf 에 PACKET_FORWARD=ON
. DBSAFER 매니저에서 스니핑 서비스 등록 필요
> 등록 시 서버 주소 : Linux 서버 주소 , 포트 : MySQL 사용 포트
. 사용자 우회접속 시 스니핑 서비스를 통해 작업 이력 확인 가능
- Linux 서버 아웃바운드 패킷 포워딩 기능 검증 (MySQL A -> MySQL B)
. Server Agent가 설치되지 않은 target 서버에 대해 스니핑 서비스 등록
. MySQL A 서버 (SA 설치된 서버) -> MySQL B 서버 (SA 설치되지 않은 서버) 접속 시도
> mysql -h 192.168.169.40 -u root -p 통해 접속
. MySQL A 서버에 대한 아웃바운드 패킷 확인 가능
[결론]
- Linux 환경의 경우 인/아웃 바운드 패킷포워딩 기능 확인 가능
- Windows 환경의 경우 인바운드만 확인 가능","신현종: Windows 환경의 경우 인바운드만 ......WHY..... | 채널지원: 패킷포워딩을 이용한 로깅 시 sniff 모듈이 아래 옵션이 포함되어 빌드된 모듈이여야 패킷 포워딩으로 전달 받은 패킷을 로깅 할 수 있습니다. 릴리즈 버전에는 기본으로 포함되나, 신규로 빌드 요청 하실 때는 해당 옵션을 포함 해달라고 요청 하셔야 합니다.

[옵션 내용]
- ADDED OPTION STATUS: (TTP SUPPORTED)",https://cafe.naver.com/pnpsecure2/4913
4883,[TIP] API 테스트 프로그램 소개 (Postman),"Postman이란??
Postman은 API를 테스트 할 수 있는 API개발을 위한 협업 플랫폼입니다.
포스트맨 활용 방식은 매우 다양한 것으로 알고 있지만 저는 현기차 프로젝트를 진행하면서 사용했던 사례를 소개해드리도록 하겠습니다.
현기차에서는 별도로 사용하는 결재시스템이 존재하여, 해당 시스템에서 결재발생시 해당 정보를 자동연동정책 모듈을 통하여 데이터를 전달 받아 정책을 생성하고 관리하고 있습니다.
데이터를 전달 받을때 API통신을 통하여 데이터를 전달 받게 됩니다.
자동연동정책 모듈이 전달받은 데이터를 토대로 정상적으로 정책을 생성하는지 해당 정책이 올바르게 동작하는지 테스트가 필요한데요~
테스트 정책을 생성하기 위해서는 고객사 자체 결재시스템에서 결재를 발생시켜서 API통신을 통해 데이터를 전달 받도록 고객사 담당자에게 요청해야 하는 번거로운 상황이 생길 수 있습니다.
이러한 번거러운 과정을 없애주는 것이 바로 포스트맨입니다.
<포스트맨 사용방법 예시>
1. 방식 : POST 방식 선택
2. URL 입력
(아래 그림은 예시일 뿐 URL은 개발된 API마다 다릅니다.)
3. body 영역에 JSON(application/json) 선택 및 JSON data 입력
(아래 그림은 예시일 뿐 JSON data는 개발된 API마다 다릅니다.)
4. Send 버튼 클릭하여 API 호출
5. Body 하단 영역에서 API 호출 결과 확인
6. 데이터 전달 확인 및 정책 생성 정상 확인
감사합니다.","김재훈B: postman은 설치형과 크롬브라우저에서 확장프로그램으로도 사용하실수 있습니다.
api연동시 soureip 제한을 거는경우가 많으므로 커넥션 연결 실패시 postman이 설치된 test pc ip 등록여부 확인 후에 진행하시면 좋습니다.^^ | 한두영: ",https://cafe.naver.com/pnpsecure2/4883
4871,[TIP][포스코] MariaDB 별도 설치 후 DBSAFER 설치 시 주의사항 & DBSAFER Major 업그레이드 시 로그이관,"[고객사 요청사항]
- DBSAFER3 -> DBSAFER5 업그레이드 프로젝트 진행
- MariaDB를 포스코 측에서 직접 관리하길 원하여 TSS팀 직접 설치 이후 DBSAFER 설치를 요청
[SYSTEM 정보]
- OS : Redhat Enterprise v7.6
- DB : mariadb-10.4.18-linux-x86_64.tar.gz
- Custom Set : CustomSet_for_RHEL7_20200831.tgz
- 기존 DBSAFER : PKG_DBSAFER3_Rell.3r15.04-CentOS5_i686_20150922_M3.7.7.2_2F.tar.gz
- 신규 DBSAFER : PKG_DBSAFER5_RelR20.05C-RHEL7_x86_64_p9.11_20200917.tar.gz
[MariaDB 설정 정보 및 별도 설치 시 주의사항]
Character Set : Latin1
PORT : 3402/3401
1. my.cnf 요청사항 및 설정 정보
빨간 표시 부분 : 필수 설정 사항
외 나머지 설정 부분 : 변경가능
* max_allowd_packet = 16M 이지만, 로그 이관 시 패킷 크기가 16M 이상인 패킷이 존재하여 증설이 필요할 수 있음
([mysql] Error Code: 2006 - MySQL server has gone away > 최대 패킷 허용 용량 에러 발생)
2. safeusr 계정 생성 및 권한 부여, 추가 요청사항
host 추가 요청사항 : localhost, Active LOG Server, Standby LOG Server
(%는 기존에 설정 되어 있어 요청사항에서 제외)
DB 권한 수정 요청사항 : 추가된 host에 맞는 권한 부여 요청
3. SQL 전달
1. account.sql
2. acl_policy.sql
3. acl_policy_patch.sql
4. dbsafer.sql
5. omslogin.sql
* MariaDB 10.4에서는 user table에 직접 insert가 불가하여
account.sql 파일을 insert, update 형태가 아닌 grant, create 구문으로 전달
[MariaDB 별도 설치 후 DBSAFER 설치]
1. DBSAFER S/W 설치
- 고객사 정보에 맞는 패키지 PKG_DBSAFER5_RelR20.05C-RHEL7_x86_64_p9.11_20200917.tar.gz 설치
2. MariaDB 삭제
- DBSAFER 설치 이후 함께 설치된 MariaDB 삭제
# rpm -qa | grep MariaDB
# rpm -e MariaDB*
(해당 고객사의 MariaDB는 tar로 설치되었기 때문에 rpm -e 를 사용하여 제거)
* rpm -e 명령어가 입력되지 않을 시 --nodpes 를 사용하여 제거
3. 링크 설정
- 해당고객사에서는 /DBMS/PDBAC/DATA01/ 에 DB를 보관, 따라서 /home/dbsafer/data/mysql/ 과 링크를 설정
- 링크 설정 이후 해당 고객사 DB의 권한과 mysql 권한 확인 권고
# rm -rf /home/dbsafer/data/mysql/
# ln -s /DBMS/PDBAC/DATA01/ /home/dbsafer/data/mysql/
4. 로그 이관 & 환경변수 설정, 캐릭터셋, 엔진 변경
- 감사로그, 정책 DB 이관 + (추가 이관이 필요한 DB)
- 로그 이관 시기 : 2021년 5월
- DBSAFER3 -> DBSAFER5 업그레이드로 인해 DB 엔진이 MyISAM 에서 Aria로 변경
- 감사로그(4월까지 이관)
기존 SERVER # mysqldump -u safeusr -p[pw] dbsafer_log_YYYY_MM > /home/dbsafer/backup/dbsafer_log_YYYY_MM.sql
기존 SERVER # scp -P 22 /home/dbsafer/backup/dbsafer_log_YYYY_MM root@[신규 SERVER IP]:/home/dbsafer/backup/
신규 SERVER # perl -pi -e 's/MyISAM/Aria/g' /home/dbsafer/backup/dbsafer_log_YYYY_MM.sql
DB 엔진 변경 후 신규 SERVER DB에 접속하여 dbsafer_log_YYYY_MM DB를 생성
신규 SERVER # mysql -u safeusr -p[pw] dbsafer_log_YYYY_MM < /home/dbsafer/backup/dbsafer_log_YYYY_MM.sql
* 이관 이후 기존 SERVER와 신규 SERVER의 DB 용량 비교 권고
* 백업 용량이 크다면 sql.gz으로 백업(파티션 disk full 예방을 위해 mysqldump 전 용량 확인 권고)
- 정책 DB
기존 SERVER # mysqldump -u safeusr -p[pw] dbsafer3 > /home/dbsafer/backup/dbsafer_policy_YYYY_MM.sql
기존 SERVER # scp -P 22 /home/dbsafer/backup/dbsafer_policy_YYYY_MM.sql root@172.31.25.53(54):/home/dbsafer/backup/
신규 SERVER # perl -pi -e 's/MyISAM/Aria/g' /home/dbsafer/backup/dbsafer_policy_YYYY_MM.sql
DB 엔진 변경 후 신규 SERVER DB에 접속하여 dbsafer3 DB를 생성
신규 SERVER # mysql -u safeusr -p[pw] dbsafer3 < /home/dbsafer/baup/dbsafer_policy_YYYY_MM.sql
* 이관 이후 기존 SERVER와 신규 SERVER의 DB 용량 비교 권고
* 백업 용량이 크다면 sql.gz으로 백업(파티션 disk full 예방을 위해 mysqldump 전 용량 확인 권고)",댓글 없음,https://cafe.naver.com/pnpsecure2/4871
4868,[공유][포스코] Veritas Cluster Server(VCS)를 사용한 DBSAFER 이중화 적용,"[고객사 요청사항]
- 서버 장애 시 시스템 자체에서 fail open 및 fail over를 하지 않고 Veritas Cluster Server를 이용하여 HA 구성을 요청
[DBSAFER LOG 서버 구성]
- DBSAFER Active - Standby
- RIP가 설정되어 있음
[이중화 동작]
- Active 상태에서 모니터링 스크립트를 체크
(Active) 모니터링 : mariaDB, pnp 프로세스의 개수를 체크하여 판별
- 모니터링 스크립트 이상 작동 발견 시 장애로 인식
* pnp 프로세스 모니터링 스크립트는 장애 발생 조건을 만들기 위해 테스트 용으로 생성하였습니다.
- 이중화 동작 방식
1. (Active) DB 파티션 Unmount -> (Active) VIP 가상 NIC Down -> (Standby) DB 파티션 Mount -> (Standby) VIP 가상 NIC UP
- (Active -> Standby) DB 파티션 Mount 정보
- VIP 가상 NIC 정보
장애 발생 시 ens192:0 가 Stnadby 쪽에 UP
2. (Standby) 스크립트 동작
- 사전에 dbsafer_active, dbsafer_standby 폴더를 생성해야함
# mkdir /home/dbsafer/dbsafer_active/ /home/dbsafer/dbsafer_standby/
- 실제 장애 발생 시 동작되는 DBSAFER 스크립트
* cp 명령어를 사용하게 되면 링크가 삭제될 수 있으므로 주의
### Module & Config Dir Change(TLCACLDB1 to PLCACLDB1)###
mv -f /dbsafer/* /home/dbsafer/dbsafer_standby/
mv -f /dbsafer/.conf /home/dbsafer/dbsafer_standby/
mv -f /dbsafer/.??* /home/dbsafer/dbsafer_standby/
mv -f /home/dbsafer/dbsafer_active/* /dbsafer/
mv -f /home/dbsafer/dbsafer_active/.conf /dbsafer/
mv -f /home/dbsafer/dbsafer_active/.??* /dbsafer/
### DBSAFER Start ###
cd /dbsafer && ./pnp start
- DB 스크립트는 아래 사진에 기재 되어있는 서버에서 실행
3. (Active) 서버 정삭 동작 -> (Standby) DB 파티션 Unmount -> (Standby) VIP 가상 NIC Down -> (Active) DB 파티션 Mount -> (Active) VIP 가상 NIC UP
- (Active <- Standby) DB 파티션 Mount 정보
- VIP 가상 NIC 정보
위 1번 사진의 'Active 상태'로 원복됨
4. (Standby) 스크립트 동작
- 정상 동작 시 원복되는 DBSAFER 스크립트
* cp 명령어를 사용하게 되면 링크가 삭제될 수 있으므로 주의
### Module & Config Dir Change(PLCACLDB1 to TLCACLDB1)###
mv -f /dbsafer/* /home/dbsafer/dbsafer_activce/
mv -f /dbsafer/.conf /home/dbsafer/dbsafer_activce/
mv -f /dbsafer/.??* /home/dbsafer/dbsafer_activce/
mv -f /home/dbsafer/dbsafer_standby/* /dbsafer/
mv -f /home/dbsafer/dbsafer_standby/.conf /dbsafer/
mv -f /home/dbsafer/dbsafer_standby/.??* /dbsafer/
### DBSAFER Start ###
cd /dbsafer && ./pnp start
- DB 스크립트는 아래 사진에 기재 되어있는 서버에서 실행
5. (Active) 스크립트 동작
### DBSAFER Start ###
cd /dbsafer && ./pnp start
[HA 적용 및 테스트 결과]
- cd /dbsafer && ./pnp stop 시 많은 서비스 모듈이 동작되어 오랜시간이 소요됨
- 이 시간 동안 VCS 작업 세션이 끊겨 이중화가 이루어지지 않고 에러가 발생
- 따라서 pnp stop 을 행하지 않음
- 장애 발생 시 DBSAFER 스크립트 이후 VCS에 의해 Active의 DB가 Standby로 이관
- 위 작업은 2-3분 내에 동작 됨을 확인",댓글 없음,https://cafe.naver.com/pnpsecure2/4868
4867,[TIP] load balancing 용도로 ORACLE SCAN IP 사용시 동작 방식 및 정책 설정 방법,"[ 이슈 사항 ]
사용자가 exap_scanip(10.101.1.199 : 1521) 로 접속시도시 'scanip' 에 대한 접속제어 정책을 적용받지 않고 'vip' 에 대한 접속제어 정책을 적용 받음.
[ IP 정보 ]
사용자 PC | 192.1.1.239
DBSAFER | 10.101.1.113
exap_scanip | 10.101.1.199 : 1521 ( 10.101.1.113 : 4122[DBSAFER 서비스 Port] )
exap01_vip | 10.101.1.212 : 1521 ( 10.101.1.113 : 4078[DBSAFER 서비스 Port] )
exap02_vip | 10.101.1.213 : 1521 ( 10.101.1.113 : 4079[DBSAFER 서비스 Port] )
[ 패킷 분석 ]
1. 세션 연결(exap_scanip)
가. 사용자 PC → DBSAFER : 4122
2021-06-08 11:00:54.771605 | 192.1.1.239 : 25400 → 10.101.1.113 : 4122
나. DBSAFER → exap_scanip : 1521
2021-06-08 11:00:54.772055 | 10.101.1.113 : 42806 → 10.101.1.199 : 1521(exap_scanip)
2. 세션 종료(exap_scanip)
가. exap_scanip : 1521 → DBSAFER
2021-06-08 11:00:54.773592 | 10.101.1.199 : 1521(exap_scanip) → 10.101.1.113 : 42806
나. DBSAFER : 4122 → 사용자 PC
2021-06-08 11:00:54.773711 | 10.101.1.113 : 4122 → 192.1.1.239 : 25400
3. 세션 연결(exap02_vip)
가. 사용자 PC → DBSAFER : 4079
2021-06-08 11:00:54.774737 | 192.1.1.239 : 17271 → 10.101.1.113 : 4079
나. DBSAFER → exap02_vip : 1521
2021-06-08 11:00:54.775114 | 10.101.1.113 : 35658 → 10.101.1.213 : 1521(exap02_vip)
[ 패킷 분석 결과 ]
"" "" 시간의 증가로 패킷을 분석한 결과입니다.
1. 사용자 PC 에서 SCAN IP 로 DBMS 세션 연결
2. SCAN IP 에서 사용자 PC 로 접속할 노드 Redirect 후 세션 종료
* '1. 세션 연결(exap_scanip) - 나' 와 '2. 세션 종료(exap_scanip) - 가' 사이에 SCAN IP 에서 DBSAFER PC 쪽으로 VIP02 에 대한 Rediect 패킷을 전달
3. 사용자 PC 에서 Redirect 받은 노드 정보로 세션 연결
따라서 접속 정책 및 로그의 영향을 받는 정보는 Redirect 받은 노드 정보로 확인됩니다.
ex) exap01_vip / exap02_vip
[해결 방법]
scanip 및 vip 를 그룹핑하여 정책 적용 바랍니다.
1. 매니저 접속 - 'Ctrl + Shift + F8' 동시 입력 - 정책 동작 설정 - 하단 "" "" 설정 체크 후 재시작
2. 접속제어정책 - 서비스 명 그룹 선택 - 인스턴스 선택 후 정책 사용
* 고객사마다 환경은 다를 수 있음을 유의하세요.",댓글 없음,https://cafe.naver.com/pnpsecure2/4867
4846,[TIP] SBC 환경에서의 PC Assist 설정 방법,"[개요]
- SBC(Server Based Computing)는 데이터와 애플리케이션을 중앙 서버로 집중시키고 네트워크를 통해 개인이 가진 단말을 연결하여 업무를 보는 환경을 말함 (ex. Xen Desktop, Windows Multi-Session 등)
- SBC 환경에서는 PC Assist를 중복 실행하기 때문에 일반적인 PC Assist 설정으로 사용하는데 제약이 있음
. 차단, 결재 알림 등 사용자에게 전달되는 알림은 UDP로 전송되나 중복 실행된 PC Assist는 UDP 포트를 공유할 수 없기 때문에 알림이 정상적으로 수신되지 않음
* 사용자 환경이 하나의 호스트에서 데스크톱 세션으로 구분되는 경우에 아래 설정 적용
[설정 내용]
- SBC 환경에서 PC Assist를 사용하기 위해서는 메시지 터널링 기능을 사용하여야 함
. 메시지 터널링 기능 사용 시 데스크톱 세션별 실행된 PC Assist 구분이 가능하여 차단, 결재 알림 등이 정상 수신 됨
- DBSAFER 서버 내 pnp_oms_dms.conf 설정 변경 또는 PC Assist 설치 경로의 cltpolicy.cfg에 관련 내용 추가
- /dbsafer/.conf 경로에 pnp_msg_tunnel.conf 파일 생성 후 pnp_msg_tunnel 모듈 실행
(참고) 설정 항목
1. pnp_oms_dms.conf
. UDP_USE = YES
. UDP_TEST = YES
. UDP_CRYPTO_PORT = 50015
. NAT_IDENTITY = YES (공통)
2. cltpolicy.cfg
. UDP_USE = YES
. UDP_TEST = YES
. UDP_CRYPTO_ PORT = 50015
. UDP_MSG_TUNNELING = YES
. MSG_TUNNEL_ALWAYS = YES",댓글 없음,https://cafe.naver.com/pnpsecure2/4846
4840,[공유] DBSAFER Manager 최초 접속 알림창 변경 관련,"[개요]
- DBSAFER Manager 최초 접속 시 Administrator 계정의 패스워드 변경 알림이 띄워지나 특정 버전에서 패스워드 변경 알림이 아닌, 접속 허용 IP 주소 등록 알림이 띄워짐
[상세]
- DBSAFER Manager 5624 버전 (Administrator 계정 패스워드 변경)
- DBSAFER Manager 5986 버전 (접속 허용 IP 주소 등록)
- 변경 사항 확인
. DBSAFER 7.0 Manager 이슈 처리 중 DBSAFER 5.0 Manager 도 함께 수정 됨
. 수정 과정에서 초기값 설정에 `매니저 접속 제한 설정 옵션`이 활성화 되어 해당 항목이 출력 됨
. 의도된 변경은 아니며, 이후 버전에서는 기존과 동일하게 출력되도록 수정될 예정
[참고 사항]
- 알림 설정이 변경된 매니저를 사용하여 장비 초기 셋팅 시 고객사 또는 다른 장소에서는 IP 주소가 달라 접속이 불가할 수 있습니다. 아래 방법으로 초기화 및 설정 해제 가능합니다.
1. 최초 장비 셋팅 시 매니저 접속 제한 설정 해제
- DBSAFER Manager > 환경 설정 > 접속 제한 IP 주소 설정 > 관리자 접속 제한 활성화 체크 해제 후 등록 정보 삭제
2. DB 접속하여 데이터 변경
- dbsafer3.variables 테이블 내 데이터 값 변경
. update dbsafer3.variables set value = 0 where name = 'mgr_manager_ip_allow';
. update dbsafer3.variables set value = 'xxx.xxx.xxx.xxx' where name = 'mgr_manager_ip_allow_str_0';",댓글 없음,https://cafe.naver.com/pnpsecure2/4840
4839,[TIP] DBSAFER가 두개의 망을 쓸 경우 서비스 객체를 다른망으로 바인딩 하는 방법 공유,"[이슈 내용]
- 단독구성
- 내부망 / 관리망 분리 환경
내부망 DBSAFER IP : 61.~대역
관리망 DBSAFER IP : 10.~대역
- oms_dms.conf 에 설정한 서비스 IP(내부망 DBSAFER IP)로만 바인딩되어 관리망 DBSAFER IP로 바인딩 불가한 현상
[확인 내용]
- PC ASSIST NAT 리스트
> 관리망 서비스는 나오지 않음
- DBSAFER TDI 드라이버 테스트
> 관리망 서비스가 내부망 DBSAFER IP로 NAT 되는 것 확인
[처리 내용]
- pnp_oms_dms.conf에서 NAT_CONNECT_ONE_GATEWAY 를 YES로 설정
- 관리망 DBSAFER IP로 바인딩하도록 등록한 서비스 객체에 대해 바인딩 완료
- 관리망 서비스 NAT 리스트 정상 표시 확인","채널지원: [해당 기능 사용 시 주의 사항]
DBSAFER GW 서버가 이중화되어 있을 경우에도 등록된 DBSAFER GW IP 로만 NAT 될 것으로 생각 됩니다.
단독 구성인 경우 문제가 없겠지만, DBSAFER GW 서버가 이중화 되어 있을 경우 하나의 GW로만 쏠리는 현상이 발생합니다.
이로 인해 서비스로 등록한 GW 서버가 장애 발생 시 다른 GW 서버에서 해당 서비스에 대해서 서비스 제공이 불가 하게 됩니다.

=> 대안 : 이중화된 GW 서버간에 VIP를 설정(Active-Standby 동작), DBSAFER Manager 서비스 등록 시 VIP를 서비스로 등록
DBSAFER GW 서버의 VIP 설정 방법은 공유 드리는 구글 자료 참고 바랍니다.
( VIP 설정 자료 : https://drive.google.com/drive/folders/10mJgo70T7Rq-3g4J8OoqpMBVZ-80Q0wT ) | 송민화: 감사합니다!",https://cafe.naver.com/pnpsecure2/4839
4826,[공유] 다운로드 페이지,"안녕하세요. 프로젝트팀 3파트 이상민입니다.
EBS(NCP) 프로젝트 진행 간 고객 요구사항으로 만들게된 간단한 다운로드 페이지 공유하여 드립니다.
첨부파일
download_20210514
.tar
파일 다운로드
[다운로드 페이지 URL]
- https://IP:3443/download/
[파일 경로]
- /home/webapps/ROOT/download/files : 다운로드 파일 업로드 디렉토리
- /home/webapps/ROOT/download/images : 이미지 파일 디렉토리
- /home/webapps/ROOT/download/index.html : 다운로드 페이지
- /home/webapps/ROOT/download/js/multiFileDown.js : 멀티다운로드 자바스크립트
[사용 방법]
- 첨부된 download.tar 파일을 /home/webapps/ROOT 경로에 압축 해제
- 사용자 또는 관리자가 다운로드할 파일들을 /home/webapps/ROOT/download/files 로 업로드
- /home/webapps/ROOT/download/index.html 을 열고 다운로드 대상 파일명 수정
※ 아래 그림과 같이 빨간 박스 안의 파일명을 위에서 업로드한 파일명과 동일하게 설정
[참고사항]
- 크롬의 경우 PDF 파일 클릭 시 파일 열기가 기본설정입니다.
- 아래 그림의 경로에서 PDF 파일 클릭 시 다운로드할 수 있도록 설정 가능합니다.",강수빈: 많은 도움이 되었습니다. 감사합니다.,https://cafe.naver.com/pnpsecure2/4826
4812,[TIP] SAFERUAS 잠금 해제 / 비밀번호 초기화 메뉴얼,"※ SAFERUAS 잠금 해제 / 비밀번호 초기화 메뉴얼
- 최근 채널사 및 고객사에서 SAFERUAS 잠금 해제 / 비밀번호 초기화에 대한 문의로 인해 해당 기능에 대한
메뉴얼을 작성하였습니다.(4월 채널지원팀 세미나 발표)
[SAFERUAS 잠금 해제 / 비밀번호 초기화 목차]
1. SAFERUAS 잠금 해제 / 비밀번호 초기화란?
2. SAFERUAS 잠금 해제 / 비밀번호 초기화 이전 / 최신 버전 비교
3. SAFERUAS 잠금 해제 / 비밀번호 초기화 적용 방법
4. SAFERUAS 잠금 해제 / 비밀번호 초기화 최근 이슈
[메뉴얼]
- 아래 경로를 통해 메뉴얼 참고 바랍니다.
경로 : https://drive.google.com/file/d/10NaXpcnP35mLAMlTbZi4SQsqHWEe7La3/view?usp=sharing",댓글 없음,https://cafe.naver.com/pnpsecure2/4812
4792,[TIP] 선결재 객체 상태가 미사용으로 변경되는 조건,"[개요]
고객사에서 선결재 객체의 상태가 변동되는 조건에 대해 문의가 들어와 Test한 결과를 공유합니다.
[실행횟수 소진]
선결재 객체 기안 시 실행횟수를 지정하여 기안한 경우 실행 횟수가 모두 소진되면
객체의 상태가 미사용 상태로 변경됩니다.
실행횟수 소진 시 선결재 객체 상태 변화
[보안계정 삭제]
선결재 객체가 존재할 경우 보안계정이 삭제되지 않습니다.
다만, 인사연동이 적용된 고객사의 경우 선결재 객체가 존재하여도
인사연동 시 보안계정의 삭제가 가능합니다.
인사연동으로 인해 보안계정이 삭제된 경우 선결재 객체는 미사용 상태로 변경되며
보안계정 부분이 빈값으로 표시됩니다.
인사연동을 통해 보안계정이 삭제된 경우
[유효기간 만료]
유효기간이 만료된 선결재 객체의 경우 상태가 미사용으로 변경되진 않습니다.
대신 객체의 색이 보라색으로 표시됩니다.
유효기간 별 객체 색상
1 : 유효기간이 7일 이하로 남은 선결재 객체
2 : 유효기간이 8일 이상 남은 선결재 객체
3 : 실행횟수 소진으로 미사용 상태의 선결재 객체
4 : 유효기간이 없는 선결재 객체
5, 6 : 유효기간이 만료된 선결재 객체",댓글 없음,https://cafe.naver.com/pnpsecure2/4792
4790,"[공유][대한항공] 특정 명령어 표출 , 선결재 정책 타지 않는 현상, ﻿AWS redshift RDS에 대한 DB접근제어 기능 동작 불가 3가지 이슈 대응(완료)","1. 개요
가) [대한항공]에서 발생한 3가지 이슈에 대해 공유드리도록 하겠습니다.
1) 프로시저문 수행 시 grant a,b*/의 명령어가 DB 툴에 나타나는 현상
2) 결재시스템 결재를 올렸음에도 선결재 정책을 타지 않고 차단되는 현상
3) AWS redshift RDS에 대한 DB접근제어 기능 동작 불가
2. 이슈 내용 분석 및 해결 방법
가) 프로시저문 수행 시 grant a,b*/의 명령어가 DB TOOL에 나타나는 현상
[이슈 내역]
- 사용자가 선결재를 올렸으나 정상적으로 올려지지 않는 상태로 인해 권한이 없는는 상황에서 프로시저 문을 수행 시 사용자 DB 툴에서 컴파일 실행시 워크시트에 쿼리 일부분이 사라지고 마지막 줄에 grant a,b*/가 표출됨
[이슈 화면]
- 아래 사진과 같이 DB TOOL에서 grant a/b*/에 대한 명렁어 출력
확인 DB TOOL : ORANGE , SQL DEVELOPER
[원인 분석]
- 프로시저문 수행 시 패킷이 TNS Header보다 잘게 나뉘어져 오면서, CREATE문이 포함된 패킷이 차단되기전에 서버로 전달되어 생성된것으로 파악되었습니다.
- 프로시저 패킷이 나뉘어져 오기 때문에 프로시저 전체 검사할 당시에 패킷은 이미끝 분인지라 앞분은 실행이 되고 뒷부분에 grant가 남으면서 제대로 차단이 되지 않는 문제입니다.
[해결 방법]
- pnp_ora 최신 버전으로 패치
패치 전 버전 : Rev 1577
패치 후 버전 : Rev 1943
나) 선결재 정책을 타지 않고 차단되는 현상
[이슈 내역]
- 사용자가 선결재를 올려 선결재 객채가 생성 되었지만 차단되는 현상 발생
[원인 분석]
- 사용자가 실행한 쿼리 문에는 COMMIT 명령어가 포함되어 있었습니다 .
- 해당 사용자가 결재를 올린 명령어 유형은 delete,insert,update,create,begin,execute로 COMMIT이 존재하지 않습니다.
- 선결재 허용 정책은 전체매칭으로 동작합니다. 즉, 수행하는 쿼리 내의 모든 SQL 유형이 선결재 객체로 존재해야 선결재 허용 정책을 탑니다.
[해결 방법]
- 결재시스템 명령어 유형에 COMMIT SQL 유형을 오픈하고, 문제의 쿼리를 수행하기 위해서는 사용자가 COMMIT권한까지 같이 신청해야합니다.
- 혹은 지금처럼 정형쿼리로 등록하여 임시 허용해주는 방법이 있습니다.
다) AWS redshift RDS에 대한 DB접근제어 기능 동작 불가
[이슈내역]
- 접속계정의 정보가 IP로 표출되는 패킷도 발생하고 있으며, 어플리케이션, 인스턴스 정보도 미표기
- 차단이라고 동작 표기되어 있지만, 실제 사용자는 접속해서 정상적으로 사용 있는 현상 (차단 실패)
[원인 분석]
- (20210329 ~ 20210401) 비정상 로깅이 되는 사용자 패킷 추출 진행
-대한항공 특정 사용자에 대한 패킷 수집 후 분석 결과 microsoft access 툴로 db 접속을 할 때 SSL 암호화 통신을 하고 있었습니다 . (아래 패킷 참고)
SSL암호화 통신을 DISABLE로 변경 후 대한항공 사용자에 대한 접속 허용에 대한 임시정책을 생성하고 테스트를 진행하였을때 정상적으로 파싱 및 접속되는 것을 확인하였습니다.
1) 정책에 차단된 이유: SSL 암호화 통신으로 접속계정, 어플리케이션명 등이 정상적으로 파싱되지 않았고, 이에 대한 권한에 부합하지 않기때문에 ""차단"" 되었습니다.
2) 서비스(DBMS)로그에는 동작 차단으로 찍혀있으나 실제로는 동작이 허용되는 이유: DBSAFER에서는 암호화된 패킷에 대해서는 사용자의 가용성 보장을 위해 기본 Bypass가 되어 실질적인 동작은 허용되도록 동작합니다. (redshift 뿐 만 아니라 모든 암호화 통신에 대해 동일하게 동작합니다.)
PS. 아래 사진은 대한항공 사용자 DB TOOL(MICROSOFT ACCESS)에 설정된 SSL 화면 입니다.
[Veryfy_ca로 ssl 암호화 통신 하고 있는 패킷]
[ssl을 disable로 설정하고 테스트 한 패킷]
[해결 방법]
1). 사용자 DB 접속 툴에서 SSL 인증을 전부 DISABLE로 변경하여 접속합니다.
2). AWS REDSHIFT DB 자체에서 평문 통신을 할수 있도록 암호화 통신 기능을 OFF 합니다.
=> 사용자에게 가이드 하기 보다는 DB 서버에서 암호화 통신 OFF 하는 것을 권장 드립니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/4790
4771,[AM][TIP][요약]pnp_log_sender 가이드(DBSAFER 서버에 로그 쌓기),"메뉴얼을 참고해서 설치했으나, 조금 헷갈리는 부분이 있어
-간단하게 요약으로 정리했습니다
0. 적용 환경(버전)
1) OS : CentOS Linux release 7.7.1908 (Core)
2) DBSAFER 패키지 : PKG_DBSAFER5_RelR19.05CR2-CentOS7_x86_64_20200122
3) log_sender 버전(R36버전을 사용했지만, 데이터가 많은 고객가는 꼭 R40버전 이상사용!!)
logwriter_plugin_v1.8-logsender_P20150812.tar.gz
Module_V5_CentOS7x64_LogSender_R36_20201111.tar.gz
1. LOG_Sender 다운로드
* 해당 모듈사용시 QA의 확인 요청하면 좋습니다
- 최신모듈이나, 권장버전 등등
[모듈별 담당자]
https://docs.google.com/spreadsheets/d/1-vfu1TYKN4vZShgyr1toyPT_nDxFeWk2rUljOKD4smw/edit#gid=1525692417
Google Sheets - create and edit spreadsheets online, for free.
One account. All of Google. Sign in to continue to Sheets Find my account Create account One Google Account for everything Google
docs.google.com
첨부파일
logwriter_plugin_v1.8-logsender_P20150812.tar
.gz
파일 다운로드
- LogSender 모듈 빌드 요청할 것( ""OS에 맞춰서 요청"", R40이상 확인!!)
: 패키지 파일이 21.03.24 기준으로 BBS에 없네요
[빌드요청경로]
https://docs.google.com/spreadsheets/d/1TGwOGEABpF7FGILYrnpYnwOLiRw2MONOimtVpBNczvM/edit#gid=1721872174
Google Sheets - create and edit spreadsheets online, for free.
One account. All of Google. Sign in to continue to Sheets Find my account Create account One Google Account for everything Google
docs.google.com
2. 메뉴얼
첨부파일
로그연동모듈_설치및운용매뉴얼_v1.4 (1)
.doc
파일 다운로드
3. 설정(요약,정리)
- 파란색 : 명령어
- 빨간색 : conf 설정 or 주의사항
0) 파일 업로드
logwriter_plugin_v1.8-logsender_P20150812.tar.gz
- 위 파일 다운로드 하시고
Module_V5_CentOS7x64_LogSender_R36_20201111.tar.gz
- 드라이브나, BBS검색하셔도 쓰셔도 좋지만, 새로 빌드요청하시는게 좋습니다
: R40버전이상으로 해주세요
* /dbsafer경로에 넣을것
1) DBSAFER 홈 디렉토리(/dbsafer)에 압축파일 해제
#cd /dbsafer
#tar zxvf logwriter_plugin_v1.8-logsender_P20150812.tar.gz
#tar zxvf Module_V5_CentOS7x64_LogSender_R36_20201111.tar.gz
2) 프로토콜 버전확인(check)
# ls logwriter_plugin_*
logwriter_plugin_v1.0_P20140225_x64.tar.gz
# ./pnp_log
LOG Release Version 3.0 for Rel1.3-CentOS5 SE(Rev 540) [Jun 30 2015] !!
MAIN 3.7(20140225),AGENT:103,DBMS:107,FTP:106,TELNET:107,SQLPARSER:1.3.2293
3) 바이너리 비트 확인(check)
#file /dbsafer/logwriter_plugin.so
logwriter_plugin.so: ELF 64-bit LSB shared object, AMD x86-64, version 1 (SYSV), not stripped
#file /dbsafer/pnp_log
pnp_log: ELF 64-bit LSB executable, AMD x86-64, version 1 (SYSV), for GNU/Linux 2.6.9, dynamically linked (uses shared libs), not stripped
4) 라이브러리 확인(check)
# ldd logwriter_plugin.so
linux-vdso.so.1 => (0x00007fffbe5fd000)
libstdc++.so.6 => /usr/lib64/libstdc++.so.6 (0x00002b85bea60000)
libm.so.6 => /lib64/libm.so.6 (0x00002b85bed61000)
libgcc_s.so.1 => /lib64/libgcc_s.so.1 (0x00002b85befe4000)
libc.so.6 => /lib64/libc.so.6 (0x00002b85bf1f2000)
/lib64/ld-linux-x86-64.so.2 (0x0000003018e00000)
* not found 가 나오면 안됨
5) 라이브러리 경로 이동
#cd /dbsafer
#mv /dbsafer/logwriter_plugin_logsender.so /dbsafer/lib/
( -rwxr-xr-x 1 root root 186848 Oct 26 08:57 logwriter_plugin_logsender.so)
Module_V5_CentOS7x64_LogSender_R36_20201111.tar.gz
6) conf#1 설정(log.conf)
#cat /dbsafer/.conf/pnp_log.conf | grep log_integrate
log_integrate=yes
#cat /dbsafer/.conf/pnp_log.conf | grep log_packet_hook
log_packet_hook_module=/dbsafer/lib/logwriter_plugin_logsender.so
7) conf#2 설정(pnp_log_sender.conf)
- DBSAFER서버에 로그를 쌓는 설정(지워주는 crontab 설정필요, 추후 등록예정)
#cat /dbsafer/.conf/pnp_log_sender.conf | grep server_type
server_type = 0
#cat /dbsafer/.conf/pnp_log_sender.conf | grep file_out_enable
file_out_enable = 1
아래 두 옵션을 주석(#) 처리 해줍시다
#server_ip = 10.10.10.100
#server_port = 1468
* DBSAFER에 쌓지 않고 대상을 지정하고 싶다면, 상단의 메뉴얼 참고
8) 폴더 생성(해당경로에 로그가 쌓임)
cd /home/dbsafer
mkdir log_write_files
chmod 755 ./log_write_files
chown dbsafer:slaps ./log_write_files
ex) log_yyyymmddhh.txt
9) 모듈재시작
#cd /dbsafer
#./pnp_log stop
#./pnp_log start
(ps -ef | grep pnp_log 모듈을 확인할 것)
(사용자가 많이 접속 중이면, pnp_log모듈이 바로 안죽어요,바로 start하지 말고,
운영 중일때는 최소한 점심에)
#./pnp_log_sender stop
#./pnp_log_sender start
(ps -ef | grep pnp_log_sender 모듈을 확인할 것)
기타
- 모듈 패치시 chmod/chown 등 권한을 확인하세요
- 떨구고자 하는 로그 설정은 ""상단 메뉴얼""을 참고하세요
- 모듈 버전에 따라 메뉴얼의 파일명이 다릅니다, 잘모르겠으면, 사수님에게 전화 고고","공유민: 신규 임직원분들도 쉽게 설치할 수 있게, 요약해보았습니다 | 공유민: 모르면 연락주세여 | 진선태: 말씀하신대로 잘 정리되어 있네요. 감사합니다 | 강현구: 로그센더모듈은 rev40이상에서 사용하시는걸 권장드립니다. CPU 100%사용하는 부분 개선되었습니다. | 공유민: 다 패치 해야것네... | 진선태:  | 공유민: ",https://cafe.naver.com/pnpsecure2/4771
4762,"[mssql_account_finder] 접속계정, 어플리케이션 파싱하지 못할 때 확인사항","NHN 고객사의 MSSQL_ACCOUNT_FINDER 모듈이 접속 계정을 파싱하지 못할 때 확인 했던 사항들을 정리하여 공유하고자 합니다.
[모듈 동작원리]
MSSQL은 기본적으로 암호화 통신을 하기 때문에 접속계정이 IP로 남은 현상이 있습니다.
그렇기에 MSSQL_ACCOUNT_FINDER 모듈이 DBSAFER에 등록한 MSSQL 접속계정을 통해 MSSQL DB에서 세션조회 쿼리를 수행하여 해당 세 션의 접속계정과 어플리케이션을 조회하여 정상 로깅을 수행합니다.
[체크리스트]
1. DBSAFER에 등록한 MSSQL 접속계정이 정상적으로 MSSQL DB에 접속이 가능한지
> 확인 방법 : 매니저 - MSSQL 접속계정관리 - 세션검사
> 일반적으로 sa계정이 아닌 일반계정으로 등록하기 때문에 접속 가능 여부 확인 필요
2. DBSAFER에 등록한 MSSQL 접속계정이 MSSQL DB의 세션 조회 쿼리 수행 권한이 있는지
> 확인 방법 : 일반계정으로 MSSQL DB에 접속하여 아래의 세션 조회 쿼리문 수행
> sa계정이 아닌경우, ""VIEW SERVER STATE""권한이 필요, 해당 권한은 다음과 부여 가능
[세션 조회 권한 부여]
GRANT VIEW SERVER STATE TO [일반계정];
[세션 조회 쿼리]
SELECT sessions.login_name, sessions.program_name
FROM sys.dm_exec_connections connections, sys.dm_exec_sessions sessions
WHERE connections.session_id = sessions.session_id
and connections.client_net_address = [DBSAFER GW IP 정보]
and connections.client_tcp_port = [DBSAFER GW에서 MSSQL DB접속시 사용한 PORT];
3. MSSQL DB가 클라우드 환경인지
> 세션조회 시 DBSAFER GW IP를 기준으로 조회하기 때문에 서비스 데몬이 접속한 MSSQL session의 Client IP가 .conf/service_ip.conf와 다를 경우 mssql_account_finder.properties 설정 파일에 LocalIp 설정이 필요
[LocalIp 옵션을 사용해야 하는 경우]
1) Service -> NAT -> MSSQL 과 같이 MSSQL에 접속한 Client Ip가 변경되는 경우.
(주의, NAT 이후 Client Port가 변경되는 것은 탐지할 수 없음.)
2) PC-assist -> Service NIC와 Service -> MSSQL의 NIC가 다른 경우
3) Cloud 환경에서 사용자는 MSSQL의 PublicIP를 입력하지만 Service는 Private IP로 MSSQL연결하는 경우
[LocalIp 옵션 입력 방법]
- IP 형태로만 입력가능
- Comma(,)로 구분해서 여러 IP를 입력가능",댓글 없음,https://cafe.naver.com/pnpsecure2/4762
4758,[공유][NHN] /tmp 디렉토리 DISK FULL 대응(완료),"1. 개요
1) 현상 : /tmp 디렉토리 DISK FULL로 인한 FAIL OVER 발생
2) 원인 : 대량의 배치쿼리 수행 중 bulk insert mode로 전환
/tmp 디렉토리에 bulk*.dmp 파일이 생성되어 DISK FULL 발생
3) 조치 :
3-1) FAIL OVER로 인한 LOG서버 logsync 및 restore 진행
3-2) mysql DB의 tmpdir 경로를 용량이 큰 /home1 디렉토리로 변경
2. 원인 분석
1) /(root) 디렉토리 DISK FULL 확인
# df -h
2) /tmp 디렉토리 bulk*.bmp 파일 생성 확인(총 크기 : 5.9GB)
# ls
3) pnp_log 모듈 syslog 확인
> 02월 20일 17:59:40 /tmp/bulk*.bmp 파일 쿼리 실행 에러 로그 발생
# vi /dbsafer/log/pnp_log/2021/02./20/pnp_log_2021022017.log
3. 증상확인 및 조치사항
[02월 23일 월요일]
1) 최초 매니저 접속 시 FAIL OVER 상태 팝업 확인(08:35)
2) 필수 모듈 동작 확인 및 LOG Active 서버 정상화 알람 확인(08:40)
3) LOG Standby 서버 로깅 상태 확인(08:45)
> 매니저 로그 조회 시 세션 및 로깅 정상
4) LOG 서버 정상화 확인 및 restore 진행(09:30)
> LOG Active 서버 정책연동모듈 정상 동작 확인
>> 정책 동기화 옵션(run) 정상
# ./dbsafer_imlinkage.sh run
> LOG 서버 restore 진행
# ./pnp_duplex restore
5) LOG Active 정상 운영 확인(09:45)
> 서버 모니터링 확인(LOG1,LOG2,GW1,GW2)
> 서비스 모니터링 및 로깅 정상 확인
> 정책연동모듈 정책 동기화 동작 확인
[02월 27일 토요일]
1) 운영 서버 logsync 설정
> FAIL OVER기간 LOG2에 쌓인 로그 logsync 완료
# ./pnp_duplext logsync 20210221
# ./pnp_duplext logsync 20210222
2) /tmp 디렉토리에 있는 bulk*.dmp 파일 이동 후 수동 입력
> bulk*.dmp 파일들을 /home1 하위 폴더에 임시로 이동하여 /(root) 디렉토리 공간 확보
> bulk*.dmp 파일 수동 입력 진행
# LOAD DATA INFILE '{파일경로}' IGNORE INTO TABLE dbsafer_log_{YYYY}_{MM}.db_query_{DD}
3) mysql tmpdir 경로 변경(2차 재발 방지)
> 기존 /tmp에서 /home1/tmp로 변경
# mkdir /home1/tmp
# vi /etc/my.cnf
# tmpdir = /home1/tmp
# service mysqld restart
# show variables like '%tmp%'
4. 의견 및 참고
기존 /tmp 디렉토리를 링크 설정을 통해 작업하려고 했으나, tmp 디렉토리를 system데몬이나 java에서 사용을 하고 있어 mysql 자체적으로 tmpdir 경로를 변경하는 방향으로 진행하였음
- bulk insert 동작과정 설명 및 log 데몬 재시작 시 주의 사항
URL : https://cafe.naver.com/pnpsecure2/3214",댓글 없음,https://cafe.naver.com/pnpsecure2/4758
4739,[TIP] 인사연동(dbsafer_accountsync) 대량 사용자 발생시 기본 옵션 체크,"# 요건 : 사용자가 인사연동 모듈에 의해 대량으로 생성될때 초기 셋팅 필요시
# 인사연동으로 신규생성자가 생길때
1. 계정 잠김 풀기: 인사연동에서 연동될때 잠기지 않도록 설정
################################################################################
# 사이트 DBMS/AD LDAP에서 추가된 계정의 처리 방법을 입력합니다.
#
# 0 = Nothing. (insert) (계정 그대로 유지. - Default)
# 1 = Lock account. (계정 잠금.)
# 2 = No insert. (계정 연동하지 않음.)
################################################################################
#AddedAccountSyncType = 0
초기값 그대로 ""0""으로 설정함.
2. 결재기안 자동선택 : 결재의 기안을 할 수 있도록 기본 체크
3. LDAP OTP 사용 자동 선택 : OTP를 사용할 수 있도록 기본 체크
################################################################################
# 보안계정 객체 입력/갱신 후 , 추가 실행할 쿼리 입력합니다.
# dbsafer_ldap_list 의 필드명중, ColumnXXX 에 설정한 항목에 상응하는 대상에 한하여 예약어 사용이 가능합니다.
# - ex) [[sno]] --> 보안계정으로 전환하여 쿼리 수행
# - ex) AdditionalQueryInsert = UPDATE `dbsafer3`.`dbsafer_ldap_list` SET `default_auth_use` = 1 WHERE `sno`=[[sno]];
# - ex) AdditionalQueryUpdate = UPDATE `dbsafer3`.`dbsafer_ldap_list` SET `default_auth_use` = 1 WHERE `sno`=[[sno]];
################################################################################
#AdditionalQueryInsert =
AdditionalQueryInsert = UPDATE `dbsafer3`.`dbsafer_ldap_list` SET `decide_draft` = 1, `user_auth_type` = 4 WHERE `sno` =[[sno]];
# 주의사항 : `` 과 ''은 다른 부호이니 조심하세요.",댓글 없음,https://cafe.naver.com/pnpsecure2/4739
4733,[공유] pnp_ssl_proxy 엔지니어 매뉴얼,"pnp_ssl_proxy 엔지니어 매뉴얼
pnp_ssl_proxy 모듈 적용 시 지원 가능한 서비스 (2021.03.04기준)
지원 서비스
지원 현황
암호화 MSSQL, MySQL, PostgreSQL, MongoDB
지원 가능
Azure, AWS (DBMS 위와 동일)
지원 가능
DynamoDB
지원 가능
파일 첨부하였습니다.
Version history
- https://cafe.naver.com/pnpsecure2/4280
첨부파일
pnp_ssl_proxy 모듈 엔지니어 매뉴얼_1.0.5
.pdf
파일 다운로드","최재규: 암호화 통신 서비스 지원 DBMS 관련해서 일부 내용 추가하였습니다. (문서버전 : 1.0.4)

[수정내용]
- MySQL, PostgreSQL, MongoDB, DynamoDB 서비스 지원 가능 | 여성구: 문서는 PDF 로 공유해주면 더 좋을 것 같습니다. | 최재규: 문서 수정했습니다. 감사합니다. | 최재규: AzureSQL 제약사항 관련해서 일부 내용 추가하였습니다. (문서버전 : 1.0.5)

[추가내용]
- SSMS툴에서 AzureSQL 접속 시 세션 및 로깅 관련 이슈",https://cafe.naver.com/pnpsecure2/4733
4710,[SSH Tunneling] 참고사항 권한 오류로 터널링 실행이 되지 않을 경우,"클라우드 서비스를 사용하다 보면 흔하지는 않지만 DBSAFER에서 ssh Tunneling이 필요한 경우가
있으며, 이 때 발급 받은 pem key를 활용하여 ssh Tunneling을 해주고 있습니다
일반적으로 root로 작업을 실행하기 때문에 권한관련 부분은 생각하지 않고 작업 진행합니다
문제는 파일 복사, 전송, 생성 등 작업간 권한이 변경되는 경우가 발생할 수 있으며,
이런 경우 ssh Tunneling을 시도하게 되면 아래와 같은 권한 오류가 발생하면서 Tunneling이 되지 않는
경우가 발생합니다.
-----------------------------------------------------------------------------------------------------------------------
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@ WARNING: UNPROTECTED PRIVATE KEY FILE! @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
Permissions 0755 for '[key_name]' are too open.
It is required that your private key files are NOT accessible by others.
This private key will be ignored.
bad permissions: ignore key: [key_name]
-----------------------------------------------------------------------------------------------------------------------
-> Permissions 0755는 현재 파일에 설정되어 있는 권한의 값입니다
이 것은 key 의 권한 관련 에러메시지 이며 키 파일의 경우 소유자 외의 사용자가 접근이 불가능하며,
수정이 가능해서는 안되기 때문입니다.
간단히 해결 방법은 키의 권한 (Permission) 을 chmod 를 통해 400 으로 변경해 주시면 됩니다.",여성구: 정보 공유 감사합니다. 이 문제가 이전 터널링 되다가 안되는 원인은 아닌 것 같은데 같은 이슈의 정보 인가요? | 하충현: 해당 이슈는 아닙니다 갑자기 터널링이 안된다고 해서 추가 확인한 내용입니다,https://cafe.naver.com/pnpsecure2/4710
4666,[DBSAFER][TIP] BACKUP경로 변경(심볼릭 링크) for NAS | LOG#1 장애시 LOG#2에서 LOG1로그(장애 전) 조회,"[목적]
- /home/dbsafer/backup (기본)경로가 아닌 다른 경로에 백업로그를 저장한다
: NAS경로 / 다른 물리경로 등등
- (추가기능)LOG 이중화 구성일때, LOG#1장애 상황 발생 ""일때""
: LOG#2에서 LOG#1로그를 조회 하고 싶다 <<<(담당자요청 내용)
> NAS경로를 공유해서, LOG#2에 dbsafer_log 복원으로 해당 요청내용 해결
[방법]
1. 담당자 요청
- NAS 연결요청(LOG#1, LOG#2) / 2개 대상 모두 NAS의 ""동일경로"" > for LOG#1장애시 LOG#2에서 로그를 조회하기 위함
: mount 경로명은 임의로 지정
: dbsafer_log를 대략적으로 확인해서 여유공간을 지정해서 알려준다
> 예시) DBSAFER_로그(백업)를 대략 1/10이며, 5년 기준으로 쌓는다고 했을때, 100G 필요합니다
2. 엔지니어 확인내용
- NAS 경로 확인
: LOG#1, LOG#2에서 동일한 경로가 설정되어 있는지
명령어 : #df -h
> 나스 경로가 설정되어 있는지
> 예시) 172.16.2.21:/dbsafer 199G 2.9G 196G 2% /logbackup
명령어 : #cat /etc/fstab
> 나스 경로가 지정되어 잇는지 ,재부팅시 필요
> 예시) 172.16.2.21:/dbsafer /logbackup nfs defaults 0 0
3. 엔지니어 작업내용(심볼릭 링크를 걸자)
- 사전확인
1) 나스경로 확인
명령어 : #df -h
결과 : 172.16.2.21:/dbsafer 199G 2.9G 196G 2% /[나스경로]
2) /home/dbsafer/backup 경로 삭제
명령어 : # cd /home/dbsafer
명령어 : # rm -rf ./backup
* 삭제전에 파일있다면 이동
3) 심볼릭 링크
명령어 : #cd /dbsafer/home
명령어 : #ls -al | grep backup (암것도 없음, 맞음)
명령어 : #ln -s /[링크경로] /home/dbsafer/backup
명령어 : #ls -al | grep backup
결과 : backup -> /[링크 경로]
4) 권한 변경
#chown -h dbsafer:slaps /home/dbsafer/backup
5) 확인
- /home/dbsafer/backup 경로가 있는지
: 해당경로에 파일생성시, 링크 경로도 동일하게 생기는지
: CS_manger에서 백업(로그,정책) 했을 때, /home/dbsafer/backup에 데이터가 쌓인다면 정상 <<< *필수 체크
: 예시)
[root@dbsafer_rule_log1 dbsafer]# pwd
/home/dbsafer
[root@dbsafer_rule_log1 dbsafer]# ls -al | grep backup
lrwxrwxrwx 1 dbsafer slaps 10 1ì›” 14 10:45 backup -> /logbackup
* LOG#2에서 LOG#1조회 하는건 CS_MANAGER(LOG#2)에서 backup 복구 기능 활용하셔야합니다
작업하다가 문의사항 있으시면, 언제든지 연락주세요
권투를 빕니다, 화이팅",댓글 없음,https://cafe.naver.com/pnpsecure2/4666
4664,[TIP] PC Agent NAT 서비스 리스트에 SFTP서비스 표시되도록 개선된 사항 공유,"기존에는 SFTP서비스에 대한 접속권한이 있다고 하더라도 PC Agent NAT 서비스 리스트에 보이지 않았습니다.
하지만 SFTP분리 기능을 제공하고 나서부터 SSH와 SFTP를 따로 관리하는 고객사가 생기면서 NAT 서비스 리스트에 SFTP서비스도 보여줄 필요성이 생겼습니다.
SFTP분리 기능을 사용하는 고객사중 DA인포메이션의 사례를 들어서 좀더 이해하기 쉽도록 설명드리겠습니다.
DA인포메이션에서는 결재시스템을 사용하고 있습니다.
사용자는 NAT 서비스 리스트를 통해서 현재 자신이 접속할 수 있는 서비스가 어떠한 것들이 있는지 판단하였습니다.
하지만 SFTP서비스의 경우 NAT 서비스 리스트에 보이지 않기 때문에 사용자가 자신이 접속 가능한 서비스인지 판단하기 어려웠습니다.
실제 문의사항중에 결재를 올려서 승인까지 다 받았는데 왜 SFTP에 접속이 안되는지? 라는 문의사항이 있었는데요~
확인해보면 접속권한은 정상이였으며, 사용자가 패스워드를 잘못 입력하여 접속이 안됐던 것이었습니다.
사용자들은 다른 서비스는 NAT 서비스 리스트에 보이는데 SFTP만 NAT 서비스 리스트에 안보인다 먼가 잘못된거아닌지? 헷갈리고 혼동이 발생한다라는 의견이 있었습니다.
따라서 oms_dms모듈 Rev 721버전부터 아래 캡처처럼 SFTP서비스가 NAT 서비스 리스트에 보이도록 개선되었음을 알려드립니다.
현재 PC Agent에 서비스타입을 SFTP로 전달할 경우 DBMS로 인지하기 때문에 서비스타입을 SFTP가 아닌 FTP로 대신전달하도록 개발되어 서비스는 FTP로 보이게 됩니다.
(FTP로 보이는것이 정상이니 이거 왜 SFTP로 안보여? 버그아니야? 라고 오해하지 마시기 바랍니다.ㅎㅎ)
이상입니다.
감사합니다.
[참고]
SFTP서비스는 별도의 DBSAFER서비스 포트를 오픈하지 않습니다.
따라서 SFTP의 서비스 포트는 0번으로 설정됨.
서비스 포트가 0번임에도 불구하고 서비스를 제공할 수 있는 이유는 아래와 같습니다.
사용자 -> pnp_sshd -> pnp_telnet -> pnp_ftp -> pnp_telnet -> pnp_sshd -> FTP서버
pnp_ftp모듈이 pnp_telnet모듈과 통신을 통해 프록시 기능 제공.",댓글 없음,https://cafe.naver.com/pnpsecure2/4664
4657,[TIP] pnp_log_cleaner 모듈 설정방법 (모듈로그 자동 삭제),"정기적으로 pnp_sys_log의 로그를 삭제하는 pnp_log_cleaner 모듈 설정방법에 대해 공유드립니다.
[필요 상황]
DBSAFER LOG, GW 분리형 서버일 때 GW 서버는 서비스 로그를 적재하지 않아서 적은 DISK 용량으로 서버가 구성된 경우가 있습니다. 이때 사용자가 많은 고객사의 경우 oms_dms 등과 같은 모듈 로그가 많이 쌓여 서버 DISK 용량에 영향을 주므로 주기적인 모듈 로그의 삭제가 필요합니다.
[설정 방법]
1. pnp_log_cleaner.conf 설정
[주요 설정값]
excute_time = 02:00:00
>> 모듈로그 삭제 처리 시간 설정
remove_empty_directory = NO
>> 일별 모듈로그파일 삭제 후 해당 일자 Directory가 비어있을 경우 Directory 삭제여부 (YES 시 삭제)
retention_period = 365
>> 삭제일 기준으로 N일 전까지의 모듈로그를 보존
remove_deny_daemon = pnp, pnp_agent
>> 모듈로그 삭제 처리 시 제외할 모듈로그 지정
2. ./pnp_log_cleaner start
pnp_log_cleaner 가동 이후 excute_time이 되면 설정한 모듈로그 보존 기간 이전의 로그를 자동삭제합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/4657
4646,[TIP][AWS] DBSAFER Amazon S3 백업 방법 소개,"DBSAFER 데이터 파일을 Amazon S3로 백업하는 방법에 대해서 소개드립니다.
고객사에서 문의가 많은 내용이나, DBSAFER에서 공식적으로 지원하고 있지는 않습니다.
해당 기능은 추가 작업을 통해 사용할 수 있습니다.
[백업 방법]
- DBSAFER 데이터 파일(.be3)을 Amazon S3로 백업하는 방법은 다음과 같습니다.
1) AWS Console 이용
. 웹 콘솔에 접근하여 관리자에 의해 데이터 파일을 직접 백업하는 방식입니다.
2) AWS CLI 이용
. DBSAFER 서버 내 AWS CLI를 설치하여 AWS CLI 명령어를 통해 데이터 파일을 백업하는 방식입니다.
3) AWS Transfer for SFTP 서비스 이용
. AWS에서 제공하는 SFTP 서비스를 이용하여 데이터 파일을 백업하는 방식입니다.
4) 기타
. curl 명령어를 통해 데이터 파일 백업하는 방식 등이 있습니다.
- 각 방식별 특징은 다음과 같습니다.
. 구성 환경에 따라 다르지만, 비용 등을 고려할 때 AWS CLI를 사용하는 방안이 최적의 선택이 될 것으로 보입니다.
AWS Console
AWS CLI
Transfer for SFTP
사전 준비
• 필요사항 없음
• IAM 사용자 권한 부여
• DBSAFER 서버 내 AWS CLI 설치
• IAM 서비스 역할 부여
• SSH Public Key 등록
백업 방식
• AWS Console S3 서비스 접근
• 파일 직접 백업
• AWS CLI 명령어를 통해 파일 백업
• 스크립트 등록 시 자동화 가능
• SFTP 명령어를 통해 파일 백업
• 스크립트 등록 시 자동화 가능
정책 설정
• Amazon S3 사용 정책(권한) 부여
• AdministratorAccess
• 관리 정책(권한) 부여
• AdministratorAccess
• 서비스 역할 부여
• AmazonS3FullAccess
• AmazonTransferLoggingAccess
작업 위험
• 백업 파일 누락 가능성 존재
• 잘못된 서버 접근 가능성 존재
• Access Key 탈취 가능성 존재
(관리 권한 탈취)
• DBSAFER 서버 내 Private Key 보관 필요
• Private Key 노출 시 S3 저장 데이터 접근
가능
고려 사항
• 수작업으로 업무 효율 떨어짐
• AWS CLI 관리 권한 부여 협의 필요
• AWS 서비스 사용으로 비용 발생
• https://aws.amazon.com/ko/aws-transfer-family/pricing/
- 백업 수행 방법은 내용이 많아 파일로 첨부하였습니다. 순서대로 보시면 어려움 없이 이해 하실 수 있을 것 같습니다.
첨부파일
[AWS] AWS CLI 설치 가이드_20201222
.pptx
null
파일 다운로드
첨부파일
[AWS] DBSAFER S3 백업 가이드_20201223
.pptx
null
파일 다운로드
[고려 사항]
- DBSAFER 데이터 파일 S3 저장 시 파일 구분 방안
. S3 버킷에 백업(업로드) 및 복원(다운로드) 시에 파일 구분이 되어야 할 것 같습니다.
. 특정 기간의 데이터 복원이 필요한 경우(S3 -> DBSAFER)가 있을 수 있어 파일 구분이 필요합니다.
. be3 파일 생성 시 파일명으로만 일자를 구분하기 때문에 데이터 복원 시(S3 -> DBSAFER) 어려움이 있습니다.
. 테스트 시에는 일 별 구분을 위해 별도 디렉토리 생성하여 저장하는 스크립트를 사용하였습니다.
- EBS 볼륨에 저장된 데이터 파일, 로그 파일을 S3로 저장할 수 있는 방안
. EC2 인스턴스에 마운트되는 EBS 볼륨의 경우 S3보다 상대적으로 요금이 비싼 편입니다.
. DBSAFER 구성 시 오래된 시스템 로그 또는 DB 파일을 S3로 별도 저장할 수 있다면 EBS 볼륨 사용에 대한 의존을 줄일 수 있을 것으로 생각됩니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/4646
4639,[TIP] DBSAFER 모듈 이슈 발생 시 정보수집 방법,"가. 개요
1. 사조그룹 고객사에서 발생했던 pnp_ssl_proxy 모듈의 이슈사항을 예로써 작성함.
2. 고객사 MSSQL 서비스 사용중에 접속계정과 인스턴스 정보를 수집하기 위하여 ssl_proxy 모듈 추가 적용
3. 고객사 MSSQL 서비스 대상으로 ssl_proxy 모듈 설정 후 select 쿼리 속도 저하 발생
4. 기존 7000건의 쿼리 수행 (2초 -> 11초), 330만건 쿼리수행 (2분 -> 33분) 정도로 지연됨
- 사용 쿼리는 select * from table 로 단순한 전체 조회 쿼리
나. 발생버전
pnp_ssl_proxy
SSL_PROXY Release (Rev 60) Nov 25 2020 17:03:21s
( SHARED INTERFACE VERSION INFO: Rev.436 )
( COMMON-API(UTIL) INFO: Rev.97 )
다. 대응
1. 모듈패치 진행 후 쿼리 수행 및 로깅 테스트 중에 7000 rows를 조회하는 단순 쿼리에 대해 10초 이상이 소요되는 현상을 확인
2. 추가적인 테스트 진행을 위해 330만 rows의 Data를 select 하는 쿼리 수행 단계에서 명확한 지연 현상 확인
3. 사용자들의 가용성 확보를 위해 패치 롤백 후 mssql_account_finder 모듈로 접속계정과 인스턴스 정보 수집을 진행
라. 조치 후 미흡한 점
1. 모듈 패치 후 모듈의 이상징후 발견 시 최대한 추가정보 수집을 해야 2차, 3차 확인작업이 줄어듬
2. 해당 이슈 발견 후 쿼리 수행 테스트 대기 시간 동안에도 정보수집을 할 수 있는 상황이었으나 수집하지 않음
3. 쿼리 수행이 모듈 패치 이후 느려진 점은 있으나, 단순히 해당 모듈이 원인이라고 100% 단정을 할 순 없음
4. DBSAFER 서버의 CPU, Memory, Network I/O, Packet 등 추가정보 수집이 반드시 필요
마. 추가 정보 수집 방법
1. CPU 점유 정보
1.1 : sar, top, vmstat, cat /proc/cpuinfo 등
2. Disk I/O
2.1 : df, iostat, iotop 등
3. Memory
3.1 : free, top, vmstat, cat /proc/meminfo 등
4. Network I/O
4.1 : ifconfig, netstat, tcpdump 등
5. TCP dump 수집
5.1 : tcpdump -nni [Interface명] host [대상시스템] -s 0 -w [파일명.pcap]
5.2 : 명령어는 상황별로 (port, not host 등) 옵션을 변경하여 사용
5.3 : 사용자 <-> DBSAFER 구간, DBSAFER <-> 대상 DBMS 구간 등 통신구간을 확인하여 전체 패킷덤프 수집이 필요
6. DBSAFER Maria DB status
7. 위 내용은 기본적인 명령어를 기술하였으며, 상황별로 수집정보가 다를 수 있음
8. 상황 발생 이후, 위 기본 명령어 이외의 연구소에서 필요한 정보가 추가 수집되어야 함 (ex. 모듈 디버깅 로그, 코어 덤프 파일 등)
바. 참고정보
1. 모듈별 장애 발생 시 필요 수집정보
1.1 https://docs.google.com/spreadsheets/d/1ukLdgyzDr_PY0WuRTrhYx4TwoNVqzgT-N3yRli-9inY/edit#gid=800814057
2. 장애발생 후 정보 수집의 대한 체크리스트
2.1 https://cafe.naver.com/pnpsecure2/3754",댓글 없음,https://cafe.naver.com/pnpsecure2/4639
4638,[TIP] 서비스 모듈 임시 패치 후 테스트 방법 소개 (Bridge 서비스 활용방법),"DBSAFER Bridge 서비스를 이용한 서비스 모듈 테스트 방법에 대해 공유 드립니다.
[팁 활용 사례]
1. 기존 서비스 모듈이 데몬으로 구동되어 있는 상태로 신규 서비스 모듈만 테스트 하고 싶을때
2. 특정 사용자만 테스트 하고 싶은 서비스를 경유 하게 하고 싶을 때
* 주의 : 반드시 서비스 등록 시 Bridge를 체크 하여 사용자 PC Agent 에 NAT 정보가 전달되지 않도록 해야 합니다.
테스트 방법 설명은 패치할 신규 서비스 모듈 테스트 방법으로 설명 합니다.
[서비스 모듈 패치 테스트 방법 순서]
1. 패치 할 모듈을 DBSAFER 서버에 업로드
2. 기존 모듈의 이름을 변경.
3. 심볼릭링크로 패치할 모듈의 이름을 기존 모듈의 이름으로 변경
4. 서비스 추가 시 bridge 체크를 하여 서비스를 구동
5. 사용자 테스트 시 bridge 체크한 DBSAFER IP/Port로 접속
6. 테스트 완료 후 원복
[테스트 절차 상세] (pnp_ora 모듈을 예시로 진행 합니다.)
1. 패치 파일 업로드 및 테스트 준비
1-1) SFTP 를 통해 패치 파일 업로드
- 패치 파일을 /home/patch/ 하위로 업로드
1-2) 테스트 준비를 위해 패치을 /dbsafer 에 복사
* 테스트를 쉽게 하기 위해 /dbsafer에 복사 하였지만, 심볼릭 링크를 걸기 때문에 별도로 복사는 안해도됨.
# tar xzf Patch_pnp_ora.tar.gz
# mv pnp_ora /dbsafer/pnp_ora_patch_20201218
* 그림에서는 /dbsafer 로 복사 하지 않고 /home/patch 디렉토리에서 이름을 변경함
2. 기존 모듈명을 변경함 (명명규칙을 통해 원본 파일임을 표기 하는 것을 권장)
# cd /dbsafer
# mv pnp_ora pnp_ora_orig_20201218
3. 심볼릭 링크로 패치할 모듈을 기존 모듈의 이름으로 변경
# cd /dbsafer
# ln -s pnp_ora_patch_20201218 pnp_ora
* 그림에서는 /dbsafer 위치가 아닌 /home/patch 에 위치한 파일에 심볼릭 링크를 연결함
4. 테스트 할 서비스를 Manager에서 신규로 추가
(요약) 테스트 대상 서비스 정보를 동일하게 입력하고 Bridge만 추가로 체크 해주면 됨.
4-1) 서비스 추가 화면
4-2) DBSAFER 서비스 리스트 화면
* DBSAFER 서버에서 실행 중인 서비스 정보
5. 사용자 테스트 방법
5-1) 사용자가 대상 서버 접속 시 DBSAFER IP/Port(bridge 체크 서비스) 로 접속
5-2) 문제 사항에 대한 테스트 수행
* 테스트 수행 시 패킷 수집도 동시에 수행하면 문제 발생 시 확인이 용이함.
6. 테스트 완료 후 원복
6-1) Manager 서비스 종료
6-2) DBSAFER 서버에서 심볼릭 링크 삭제
6-3) 백업한 기존 모듈을 원복
주의사항)
1. 테스트 시점에 테스트할 서비스 이외 신규 서비스 추가 주의
2. core 파일 생성 될 경우를 대비하여 DBSAFER 서버 용량 확인
3. 테스트 후 반드시 원복작업 수행
- 원복을 하지 않을 경우 pnp_ora 서비스 구동이 되지 않고 Manager에서 starting 상태로 표기 될 수 있습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/4638
4608,Orange TOOL 사용시 COMMIT/ROLLBACK 미로깅 현상,"Orange TOOL 을 사용하여 commit/rollback 명령어를 수행할 경우
DBSAFER에서 로그조회가 안되는 현상이 있습니다.
이는 Orange Tool에서 해당 명령어를 처리하는 방식이 달라서 발생홥니다.
■ OCITransCommit / OCITransRollback 함수를 사용하여 commit / rollback 을 실행합니다.
update와 select 사이의 commit이 확인되지 않음
Orange 3.1 버전을 사용할 경우 메뉴 바의 commit 버튼을 이용할 경우와 commit 명령어를 직접 타이핑해서 수행할 경우 모두 동일하게 로깅이 되지 않지만 Orange 6 버전의 경우 수동으로 타이핑해서 수행할 경우 commit 명령어가 확인됩니다.
버전에 따라 수행방식이 조금 다르며 버튼을 사용할 경우에는 모두 남지 않습니다.
[버전별 commit 로깅 내역]
해당 내용은 웨어밸리 홈페이지에서 확인이 가능합니다.
orange board 답변내용",댓글 없음,https://cafe.naver.com/pnpsecure2/4608
4604,[DBSAFER][TIP] LOG이중화 구성일때 LOG#2(S)에서 LOG#1(A)조회 하는 방안(진행중...),"[작성 중/구상 중]
1. 요청내용 : LOG#1(A) 장애시, LOG#2(S)에서 장기화로 사용할수 있음, 이때, 이전로그를 조회 할수있게 해달라
2. 구성설명 :
3. 처리방안 :",댓글 없음,https://cafe.naver.com/pnpsecure2/4604
4603,[DBSAFER][이슈] SSH 알고리즘(Cipher)의 협상 실패로 원격 터미널 접속 오류,"1.이슈 내용 : 원격 툴별 터미널 전송 오류
(툴 : Windows Terminal 1.3)
2.이슈 스샷
3.이슈 원인 : SSH 알고리즘(Cipher)의 협상 실패로 로그인이 제한
(이슈패키지 : PKG_DBSAFER5_RelR19.05CR2-CentOS7_x86_64_20200122)
4.해결 방법 : ssh_protocol3 패치
1) 패치내용
: * 2.30.160 버전이상 요청할것
: 암호화알고리즘: AES(128,196,256)-CTR 추가
: 키교환알고리즘: Diffie-Hellman-Group14-SHA1 추가
* 위 알고리즘을 추가할 경우, 현시점 최신 openssh버전(8.1)까지는 기본 설정되어있는 알고리즘으로 통신이 가능함
* openssh버전별 지원 알고리즘(현황): https://drive.google.com/open?id=1qKsAyK4a3M0gJgTQjXExasurRlJZOoe2
2) 패치모듈
: pnp_telnet
: sftp
: wta_server_manager
: wta_player
: sftp-server
: ssh_manager
: ssh
: pnp_sshd
: wta_proxy_server
3) 패치파일(경로)
: https://drive.google.com/drive/folders/19L7l2UtUuovt-4WfCHsfRhgTXGsBqoi_
*** os/패키지 버전이 다르면, 벅스번호를 추가해서, 새로 빌드하세욤",댓글 없음,https://cafe.naver.com/pnpsecure2/4603
4602,[DBSAFER][이슈] 원격 툴별 터미널 전송 오류,"1. 이슈내용 : TERM 환경 변수 값이 dumb로 설정되어 명령 전송이 제한됨
2. 이슈스샷 : (툴:mobaxterm v20)
3. 이슈원인 : 부팅 직후 실행된 ssh_manager에 이상이 발생하여 ssh_manager에 의해 실행된 ssh가 환경 변수 부분을 제대로 처리하지 못하는 문제가 발생하는 것(벅스답변)
(문제는 재시작 하지 않아도 간헐적으로 발생, 발생원인을 연구소에서 확인하기 힘들다는 답변)
이슈버전 : ssh_manager DBSAFER_2.30.159(이하~)
4. 해결방안(임시#1) :
1) ssh_manager 재시작(재부팅 및 정확하게 알 수 없는 원인으로 다시 안될수 있음 < 연구소 답변)
#cd /dbsafer
#./ssh_manager start
2) ssh_manager.sh, 클론탭등록(매일 6시에 재시작)
[root@dbsafer_gw1 dbsafer]# crontab -l
0 6 * * * /dbsafer/ssh_manager.sh
[root@dbsafer_gw1 dbsafer]# cat /dbsafer/ssh_manager.sh
#! /bin/bash
source /root/.bash_profile
cd /dbsafer
./ssh_manager start
[root@dbsafer_gw1 dbsafer]# ls -al | grep ssh_manager.sh
-rwxr-xr-x 1 dbsafer slaps 74 12ì›” 3 14:03 ssh_manager.sh
5. 해결방안 : ssh_manager 패치 필요(21년 상반기 개발예정)
- 벅스 : https://bugs.pnpsecure.com/view.php?id=17990",댓글 없음,https://cafe.naver.com/pnpsecure2/4602
4580,[TIP] IMUP에서 IM 정보 불러오는 관리자 계정 변경 방법,"[이슈]
1. IM에서 관리자 계정이 ' dbsafer ' 가 아닐 경우 일반 계정으로 접속 이 불가능
[변경 방법]
1. IMUP 페이지에서 변경 방법
1) IMUP 페이지 접속
- secureadmin 계정 접속
2) 시스템 관리 > 시스템 옵션 관리 > DBSAFER_IM_API_INFO 글자 클릭
3) admin 부분 ' dbsafer ' > [변경 관리자 계정]으로 수정 > 수정 버튼 클릭
2. DB에서 변경 방법
1) DBSAFER DB 접속 > imup DB에서 ' pnp_system_option ' 조회
2) DBSAFER_IM_API_INFO > option_value 수정
- admin 부분 ' dbsafer ' > [변경 관리자 계정]으로 수정",댓글 없음,https://cafe.naver.com/pnpsecure2/4580
4577,[TIP] 접근제어정책이 있어도 차단되는 증상 공유(보안계정 인식안됨 증상),"[이슈 내용]
1. 장비 접속 시 차단
2. 로그 확인 시 로그가 정상적으로 남지 않음
1) 보안 계정 정보 미 표시
2) 사용자 IP 비 정상 표기
[확인 내용]
1. 이슈가 발생한 사용자 해당 장비에 대한 접속 권한 확인
정책 : 특정 사용자 > 대상 장비 접속 허용
2. 실제 접속 시도 요청 후 확인
- 차단 확인
3. 로그 확인
1) 로그 확인 시 사용자 정보 미 표기
2) 사용자 IP 비정상 표시
4. 해당 장비 등록 정보 확인
1) 서비스 등록 정보에서 해당 장비 정보 확인
2) 사용자 식별 기능 ‘ 미사용 ‘ 확인
[처리 내용]
1. 해당 장비에 대하여 사용자 식별 기능 활성화 후 정상 접속 및 로그 확인
1) 사용자 정보를 확인 하지 못하여 차단","여성구: 서비스명을 보니 VPN 을 통한 접속이거나 외부에서의 접속일 것 같습니다. 아마다 퍼블릭IP 로 되었기 때문에 유저의 IP가 다르게 로그인이 되었던 것 같습니다. 이런 경우에는 사용자식별을 사용하여야만 로깅을 할 수 있습니다. | 손범준: 장비는 보안 장비로 VPN 장비 입니다. 단순 TELNET 접속 입니다.
이미지 상의 로그에는 보이지 않지만 다른 OS 장비에서도 같은 증상이 있었습니다. | 여성구: 사용자 식별은 PC Assist 에서 사용자 식별을 사용을 할 때 접속 시에 접속 정보를 포함해서 service 데몬에게 전달됩니다.
사용을 하면 데이터 접근 패킷 앞에 정보가 포함되어 있습니다.



사용자 식별 사용 시에 어플리케이션 정보를 포함할지는 pnp_oms_dms.conf 의 ""NAT_IDENTITY_EXTEND_TYPE"" 을 설정하면 됩니다.
# 사용자 식별 정보에 추가할 정보 종류
# Example : 없음(0), DBMS 프로그램명(1), TERMINAL 프로그램명(2), FTP 프로그램명(4), DBMS 프로그램 해시(8), TERMINAL 프로그램 해시(16), FTP 프로그램 해시(32)
# Default : 0
#NAT_IDENTITY_EXTEND_TYPE = 0 | 손범준: 설명 감사합니다.",https://cafe.naver.com/pnpsecure2/4577
4569,[DBSAFER][TIP][이슈] LOG 이중화 구성 및 vip 설정시 failover 전환후 LOG#2(vip)로 ping이 나가지 않음,"[구성]
- GW#1(A), GW#2(A), LOG#1(A), LOG#2(S)
[버전]
OS 버전 : CentOS Linux release 7.7.1908 (Core)
Linux dbsafer_gw1 3.10.0-1062.9.1.el7.x86_64
패키지 버전 : PKG_DBSAFER5_RelR19.05CR2-CentOS7_x86_64_20200122
pnp_duplex(이슈 버전) : Rev 90 이하
pnp_duplex(수정 버전) : Rev 97
(수정내용 : failover되어 standby로 전환된 후 arp 브로드캐스트를 전송하여 arp 테이블 갱신)
(로그내용 : success broadcast arping [VIP interface:인터페이스명] [vip : IP주소])
[이슈내용]
- LOG 이중화 구성 및 vip 설정시 failover 전환후 vip로 ping이 나가지 않음
: LOG#1이 failover 후 vip가 log#2에 넘어가고 맥주소가 갱신되지 않아, ping이 나가지 않음
[요청내용]
- LOG서버가 failover후 vip가 log#2로 전환되고나서 맥주소를 갱신하는 작업이 필요함
: 현재는 맥주소를 갱신하는 코드는 없음
[HISTORY]
- 2차 failover 테스트 (전) 1차 failover테스트시 failover후 LOG#2서버에 vip 전환 및 특이사항은 없었음(지난주에는 잘됨)
: 1차 테스트를 10/29(목)에 진행했는데 11/02(화) 사이에 네트워크 작업이 있었음
: 때문에 맥정보가 갱신이 안될 수 있지만, S/W 설정의 영향도에 상관없이, vip전환후/맥정보를 갱신하는 내용이 필요할것 같습니다
> 결론, S/W의 설정에 따른 영향도가 있을수 있음!!!
(영향도 > vip 빠질수있고, 안빠질수있고)
[QA확인] 주의사항
/etc/hosts에 log1,2번 서버에 각각 동일한 hostname으로 vip로 설정시
Active → Standby로 전환된 뒤 동일 증상이 재현됨 > ""MAC주소갱신 안되는이슈""
* > /etc/hosts 에 hostname으로 vip로 설정하지 말것!","공유민: QA 설명대로 hosts 설정으로도 처리할 수 있을것 같은데, 이슈되는 고객사에서 테스트해보고 추가 수정하겠습니다. | 공유민: servier off 시켜서 테스트 해야되는데, failover 테스트시 DBSAFER 프로세스를 kill하는것으로
failover 테스트를 했습니다
모듈은 수정되고, QA에서 확인했으니 다른분들에게 도움이 되길....바랍니다.",https://cafe.naver.com/pnpsecure2/4569
4566,[DBSAFER][TIP] pnp_policysync 모든기능(DBSAFER AM) 동기화!! 이중화,"[HISTORY]
- pnp_policysync 메뉴얼이 오래되어 참고 하기 어렵네요
: 마지막 업데이트가 2003년인가?
- DBSAFER(CS_MANAGER의 모든기능에 대한 정책 동기화 입니다
: failover 테스트할때나, POC/BMT시 적당합니다
- 메니저 보면 ""왼쪽 트리 메뉴""있죠? 그룹같은?, 그거 작업시에는 동기화 안됩니다 <<테스트 해봄(Rev 90), 버그?
: 꼭!!! 객체 추가/정책변경 같은 작업을 마지막에 해주세요!!
: 관리자 계정같은 경우도 마찬가지 < 벅스 등록예정
-------------------------------------------------------------------
[적용버전]
OS 버전 : CentOS Linux release 7.7.1908 (Core)
Linux dbsafer_gw1 3.10.0-1062.9.1.el7.x86_64
패키지 버전 : PKG_DBSAFER5_RelR19.05CR2-CentOS7_x86_64_20200122
pnp_agent : Release Version 3.0 for RelR19.05C-CentOS7 (Rev972)
pnp_duplex : Rev 90
[pnp_policysync.conf] 테이블 지정시 주의점
- *_history 제외
: services_history는 필수!!! > 로그조회시 반드시 필요함
[첨부파일]
- 모든기능(DBSAFER 접근제어 기준)
: 데이터마스킹 제외
첨부파일
pnp_policysync
.conf
파일 다운로드","강현구: 1. Actvie/Standby용으로 conf파일을 나뉘어서 제공이 필요할 것 같습니다.
2. DB / AM / 결재시스템 / IM 등 구분을 해야 할 것 같습니다.
참고로 최신버전에서는 패스워드 부분에 대해 암호화 처리 할 수 있도록 기능 개선이 되었습니다.
Rev 95 이상에서 제공중이며, ./pnp_policysync passwd입력하면 암호화 처리가 가능합니다. | 공유민: 생큐
IM/IMUP은 DB_SYNC라고 따로 모듈이 있어요 | 강현구: 추가로 무결성검사 기능도 추가 하고 싶으면, table = dbsafer_ldap_list(*) or table = dbsafer_ldap_list(idx,sno,name)컬럼지정으로 가능합니다. | 송재창: pnp_policysync.conf 파일 안에 등록되어 잇는 테이블에 대해서, 각 테이블이 매니저에서 어떤 기능에 대한 테이블인 지에
대한 자료가 있을까요? | 공유민: 저도 원합니다ㅜ
해당 테이블에 대한 기준은
등록하면 안되는 테이블을 제외한 전부입니다
잘부탁드립니다 차장님 | 공유민: 확인하시면 공유점",https://cafe.naver.com/pnpsecure2/4566
4565,[DBSAFER][TIP] 권한제어(인스턴스) mssql 제약사항,"첨부파일
MSSQL_인스턴스_제어_이슈 (1)
.pptx
파일 다운로드
[서두]
- 세스코에서 발생했던 문제 입니다
- 꼭 한번은 읽어 보세욤
: 첨부파일은 ""대외비""입니다, 외부로 유출시 법적 책임....
[고객사 환경]
- 사용자가 접근 하는 DB서버의 데이터베이스(인스턴스)별로 권한이 다르다
예시)
: 사용자별(홍길동) > DB서버 A(인스턴스_1, 인스턴스_2가)
: 사용자별로 ""DB서버""에 ""다수의"",""인스턴스 그룹""이 있음 > 권한제어(인스턴스)로 밖에 제어 못함
- DBSAFER 구축후 대상 DBMS에서 권한관리를 하지 않을거라는 담당자 계획
: DBSAFER는 모든 DBMS에 기능을 100% 대체 하지 못합니다
: 사용자의 ""1)작업로깅""/ ""2)사용자에 대한 접근/권한 통제"" 및 다양한 기능이있지만
100% 모든 DBMS에 대해 제어 하지 못합니다 <<꼭 명심하세욤
------------------------------------------------------------------------------------------------------------
[이슈내용]
- ""인스턴스""는 권한제어(DBMS) 정책에서 100%통제 하지 못함
- proxy 구조적인 원인으로, 해결방안이 없음 > *절대 권한제어(DBMS), 인스턴스 객체를 넣지 않게 할것
[이슈원인]
1) 사용자가 쿼리 실행시 DBSAFER_GW(Proxy) 입장에서 인스턴스를 정확하게 Catch할 수 없음
- 명령어처럼 트랜잭션 단위로 처리되는게 아니라, 일종의 Context개념으로, 완전하게 처리하기 위해서는 DBSAFER_GW(Proxy)에서 사용자가 쿼리 작업시 직접 DB에게 명령어가 실행되기전 Context가 무엇인지 체크해야되는 내용이 없음
[가능한 범위], DBMS 권한제어 정책 적용시
1) SQL Server 에서 데이터베이스에 대한 정확한 구분 및 정책 적용 범위
(상황속에서 Context가 명확하게 설정가능하다는 전제)
- DB 접속 시에 지정된 데이터베이스로 접근 제어
- DB 접속 후 ""USE"" 문으로 데이터베이스 변경 제어
[제약사항], DBMS 권한제어 정책 적용시
1) 최초 접속시 인스턴스 미지정 (혹은) 개발된 프로그램 의해 패킷상에 인스턴스정보 없으면 로깅 불가
- DBMS내에서 Default인스턴스로 배정되서 사용이 가능하지만, Proxy입장에서는 알 수가 없음
2) 멀티 쿼리내에서 인스턴스 변경을 수행하여, Error가 발생을 하면 현재 Context를 확인하기 어려움
- 인슨턴스 변경 구문을 1가지 쓰는 경우
: USE DB1; SELECT * FROM MEMBER와 같이 2개의 쿼리가 하나의 패킷에 실행되는 경우, DBSAFER는 명령어 타임에 파싱 / 로깅 하기 때문에 DB1에 SELECT * FROM MEMBER를 수행하였다고 기록되지만, 실제 쿼리 수행후 USE DB1에서 오류가 발생이 된다면 오탐이 발생, 이후 모든 쿼리는 DB1으로 로깅 (결과값을 통해 DB1으로 변경되었는지 확인할 수 있지만, Multi Query는 그 결과가 정확히 어떤 쿼리가 문제가 되는지 확인되지 않는 모호함이 발생될 수도 있음)
- 인스턴스 변경 구문을 2가지 이상 쓰는 경우
: USE DB1; SELECT * FROM MEMBER; USE DB2; SELECT * FROM MEMBER과 같은 상황에서는 DB1은 성공하고 DB2는 실패할 경우 이후 DB1 혹은 DB2인지 오탐이 발생 가능 (2.1과 동일하게 결과값을 통해 명확하게 문제 파악 불가능)
3) Procedure나 Function 혹은 PL/SQL같은 명령어내에서 인스턴스 변경시 확인되지 않음
- DBSAFER는 표준 SQL에 대해서 파싱을 수행하기 때문에, Wrapping된 형태의 코드에서 수행되는 내용은 확인할 수 없음
4) 알려진 인스턴스 변경 이외에는 현재 추적이 안됨
- USE문등을 제외한 통신 프로토콜 상에서는 인스턴스를 Code를 통해 변경한다던지 기타 이외 방식으로 수행하면 확인이 안됨
(제약사항에 개념보다는 이후 추가적으로 분석 개발이 필요한 요소)","공유민: 내용이 정리가 안됨,
1차로 이슈 관리겸 올리고, 나중에 예시 및 문장 정리 예정 | 공유민: 내용이 어려워, 첨부파일 보시죠!!!(하지만 그것도 어려워)",https://cafe.naver.com/pnpsecure2/4565
4563,mssql_accountfinder 제약사항 20201124,"mssql_accountfinder의 경우 암호화된 mssql의 접속계정을 취득할 수 있는 수단으로 잘 사용하고 있으나 다음과 같은 몇가지 제약사항을 알고 적용하면 더 효율적으로 사용할 수 있을것 같습니다.
1. NAT환경에서의 사용불가
- 보안대상 서버가 포트포워딩 환경에 있을 경우 DBSAFER의 IP와 Port가 중간에 대표 IP로 희석되기 때문에 접속계정을 취득하기 힘듬
2. mssql DB에서 초기 접속계정 생성 후 접속 또는 패스워드 변경 후 접속 불가
- 초기 접속계정 생성후 또는 패스워드 변경 후 로그인시 패스워드 변경창과 동시에 접속이 차단됨.","공유민: 2. mssql DB에서 초기 접속계정 생성 후 접속 또는 패스워드 변경 후 접속 불가 +@
> 패스워드 만료 후 에도 동일한 증상이 발생합니다
> 접속제어정책에 ""접속계정""객체로 ""허용""등록되어 있다면 정상적으로 정책을 반영하지 못합니다

때문에 mssql/접속제어정책/접속계정(DB계정)에 대한 ""허용""정책이 반영되어 있다면
패스워드 주기 기준으로 ""차단""이 되는 불상사(?)가 일어날수 있습니다

관련해서 아래와 같이 조치 하시기 바랍니다.

[조치내용]
1) DBMS 접속제어정책 ""비활성화""
- 접속계정(비활성화)
#- 인스턴스(비활성화)

2) DBMS 접속(사용자)
- 패스워드 변경
- DBMS 접속 ""실행""
- 접속로깅확인(허용된 내용)

3) DBMS 접속제어정책 ""활성화""
- 접속계정(활성화)
#- 인스턴스(비활성화)

고생하세요~",https://cafe.naver.com/pnpsecure2/4563
4561,[TIP] Linux장비 접속 시 pem 인증 접속 설정 가이드,"[설정 이유]
LINUX 장비 접속 시 SSH 인증을 통해 접속하고 싶을 경우 설정
[GW 서버 등록 방법]
- SSH 인증을 통해 접속하기 위해서 GW서버가 대상 장비의 pem 파일을 가지고 있어야 한다.
* pem 확장자 파일로 요청
1. DBSAFER 설정 파일 디렉터리로 이동
- cd /dbsafer/.conf
2. Ssh key를 저장할 디렉터리 생성
- mkdir ssh_key
3. ssh_key 디렉터리에 대상 서버 .pem 파일 이동
- SFTP 프로그램을 이용하여 파일 업로드
4. .pem 파일 이름 변경
- mv 192.168.50.207_root.pem 192.168.50.207_root.key
* 파일명 변경 시 [장비IP]_[접속계정].key 형식을 무조건 지켜야 한다.
[putty 설정 방법]
1. putty 접속을 위한 pem > ppk 변환 방법
* Putty 프로그램에서 pem 확장자 파일을 사용할 수 없어 ppk로 변환 필요
1) puttygen 실행
2) Load 클릭 > pem 파일 선택
3) Save private key 클릭 > 확인
4) 파일명 입력 후 저장
2. Putty를 통해 pem 인증 접속
1) putty 실행
2) Connection > SSH > Auth 클릭 > Browse… 클릭
3) ppk 파일 선택
- 접속하려는 대상 서버의 ppk 파일 선택
4) Connection > Data > Auth-login username 에 접속 계정 정보 입력
- 입력하지 않을 경우 접속계정은 입력 후 접속해야 한다.
- 입력 시 자동 접속
5) Session > Host Name (or IP address)에 접속 장비 정보 입력
- 정보 입력 후 접속 전 Save 추천
6) 접속
[참고 사항]
1. ppk > pem 변환 방법
1) puttygen 실행
2) Load 클릭 > ppk 선택
3) Conversions > Export OpenSSH key 클릭 > [파일명].pem 입력 > 저장",댓글 없음,https://cafe.naver.com/pnpsecure2/4561
4558,정형화 버전별 기능 및 구분 방법,"1. 정형화 버전 별 기능 및 구분 방법
DBSAFER 에서 사용되는 정형화 방식이 구분됨에 따라서 기능 구분 및 내용에 대해서 혼란을 예방하고자 아래와 같이 기능과 버전 구분을 설명합니다. DBSAFER 운용 및 패치 시에 참고 바랍니다.
1.1 정형화
정형화는 원형 쿼리를 SQL 유형 및 변수 그리고 테이블, 컬럼을 일반적인 형식으로 구분하여 정형화하는 작업입니다. 정형화는 주로 WEB 에서 자유 사용되며, Bind 변수와 많이 사용됩니다. DBSAFER 에서는 정형화 작업을 정형화 객체 등록과 DECIDE V 3.0 에서는 명령어 결재에서 사용 됩니다.
1.2 정형화 방법
DBSAFER 에서 정형화 방법은 3번의 절차로 통해서 진행됩니다.
원형 쿼리 > 정형화 대상 쿼리 > 정형화 HASH 생성
1.3 프로토콜 별 정형화 비교 기능
DBSAFER 에서는 기존의 정형화 개발에서 HASH 값이 고려되지 않은 관계로 최초 도안시에는 정형화 대상 쿼리로 쿼리를 비교하여 정책을 적용하였습니다. 하지만 정형화 대상 쿼리 비교는 쿼리 크기로 인하여 문제가 발생되는 경우가 있어 HASH 값 비교로 방식이 변경되었습니다. 그런 관계로 프로토콜 버전마다 서로 다르게 비교를 합니다. 프로토콜 버전 마다 다른 방법은 아래를 참조 바랍니다.
Main Packet 3.7 (Time 20100118) 이하 : 정형화 대상 쿼리로 쿼리를 분석하여 비교함
Main Packet 3.P (Time 20100719) 이상 : 정형화 HASH 값으로 쿼리를 분석하여 비교함
즉, Main Packet 3.7 이하에서는 정형화 HASH 값이 DBSAFER 데이터베이스에 포함되어 있어도 실제 비교는 정형화 대상 쿼리로 된다는 것입니다.
2. 정형화 버전별 기능
정형화 방식 은 기능에 따라서 버전이 구분됩니다. 아래의 기능은 정형화 대상 쿼리르 만드는 방식이므로 정형화 방식에 따른 차이와 상관없이 모든 프로토콜에서 확인되야 합니다.
V 1.0.0.0
- 문자열 상수에 대해 상수 처리(‘s’로 변환) (참고로, 문자열 상수는 ‘(single quotation mark) 로 시작하는 문자열을 말함)
- ‘(‘, ‘)’ 안에 있는 문자에 대해 빈 공백(SPACE) 처리
V 1.0.0.1
- 문자열 상수 처리 시 “(double quotation mark)로 시작하는 문자열 상수 처리 추가(기존에는 single quotation mark로 시작하는 것에 대해 처리)
- SPACE, \t, \r, \n, ;(semicolon) 문자에 대해 무시(정형화 시 제외)
- ‘<’, ‘=’, ‘>’, ‘!’, ‘@’ 문자로 시작하는 문자열에 대해 상수 처리
- 숫자에 대해 상수 처리
- 한글 무시(바이트 값이EUC-KR, UTF8등의 한글 범위 안에 있으면 무시)
V 1.0.0.2
- ‘@’ 문자로 시작하는 문자열에 대해 변수 처리
V 1.0.0.3
- IN절 처리(IN () 구문에 있는 여러 종류의 상수는 동일한 것으로 처리)
V 1.1.0.0
- 입력된 쿼리를 토큰화 하여 정화화 생성 (라인주석 및 블록주석에 대한 정확한 인식가능)
- 성능향상 (개발PC기준 초당 78079쿼리 처리)
V1.1.0.1
- QueryFormalizer에서 n'...'와 nq'# ... #'를 문자열로 인식하지 못하는 문제 수정
3. 정형화 버전 확인 방법
- 매니저 확인 방법
- 매니저 > 시스템 설정 > 기본 동작 설정 > 정형화 모듈 버전
- 서비스 모듈 확인 방법
- ex ) ./pnp_ora --version
- 결재시스템 확인 방법
- 결재시스템 엔지니어 페이지 > 시스템 환경 설정 > SQL Formal version",윤별이: 참고로 같은 쿼리임에도 정형화 버전에 따라서 HASH값이 다를 수 있습니다.,https://cafe.naver.com/pnpsecure2/4558
4511,[TIP][DBSAFER] 사용자PC에서 서비스 도메인주소의 IP를 질의할 수 없는 경우,"안녕하세요. 프로젝트팀 3파트 이상민입니다.
최근 신규고객사 빅케어(NCP)에서 있었던 이슈와 관련하여
여성구차장님께서 가이드 주신 내용을 정리 및 공유하여 드립니다.
[요약]
- pnp_oms_dms의 CONVERT_SERVICE_USE 기능 활용 시 서비스 도메인주소에 임의의 고정IP를 맵핑시킬 수 있음
- 사용자 > 임의의 고정IP > DBSAFER > DB도메인주소 > CDB접속 형태의 convert flow 제공
[고객사 상황]
- 빅케어는 NCP VPC(Virtual Private Cloud) 기반에서 DB를 도메인주소로 운영
: NCP VPC 서비스는 약 한달 전 출시되었음 (https://www.ncloud.com/product/networking/vpc)
: 현재('20.10.26) NCP VPC는 Publick DNS 및 SSL VPL를 지원하지 않음
: 빅케어 사용자들은 베스천호스트(윈도우) 접속 후 Private DNS 통해 DB 도메인주소로 접속하고 있었음
: 빅케어 사용자PC는 DNS주소를 사용하지 않음
- PC Assist는 사용자PC에 DNS주소가 없으므로 DB 도메인주소에 대한 NAT 불가
[고객 요구사항]
- DBSAFER와 NCP VPC 환경간 호환성에 대한 문제 제기
- PC Assist에서 DNS 질의결과를 사용하지 않고 DBSAFER로부터 도메인과 IP주소를 받아서 활용할 수 있는 방안 요청
① 사용자 PC에 DNS 주소가 없어도 PC Assist는 DBSAFER로부터 도메인에 대한 IP주소를 받고있는 것은 아닌가?
② PC에서 DNS에 IP주소 질의할 수 없어도 사용자 프로그램은 DBSAFER로부터 받은 도메인과 IP정보를 토대로 NAT 시켜줄 수 없는 것인가?
[1차 답변]
- DBSAFER의 기능 수정 및 DNS 설치는 가급적 지양하고 고객에게 3가지 방안을 제안
- 1안 : 사용자PC hosts파일에 DB도메인주소와 IP 정의
(고객) IP 변경될 수 있음을 이유로 거절
- 2안 : DBSAFER 서비스 등록 시 도메인주소가 아닌 Private IP 사용하여 등록
(고객) IP 변경될 수 있음을 이유로 거절
- 3안 : VPN 사용(ipsec vpn)
(고객) 추가 비용 발생을 이유로 거절
[품질관리실에 해결방안 문의]
- 여성구 차장님 답변
- pnp_oms_dms의 CONVERT_SERVICE_USE 기능 활용 시 해결 가능
- 사용자는 결과적으로 임의의 고정IP를 이용하여 DB접속
[설정 방법]
1) DBSAFER 중지
2) pnp_oms_dms.conf에 CONVERT_SERVICE_USE = YES 파라미터 추가
3) dbsafer3.convert_services 테이블 수동 추가
USE dbsafer3;
CREATE TABLE IF NOT EXISTS `convert_services`
(
`no` INT(11) NOT NULL DEFAULT '0' ,
`destip` VARCHAR(255) NOT NULL DEFAULT '' ,
`destport` INT(11) NOT NULL DEFAULT '0' ,
PRIMARY KEY (`no`)
)
4) dbsafer3.service 테이블에서 서비스 객체 번호(no) 확인
SELECT * FROM `dbsafer3`.`services`;
-- 도메인주소로 등록된 서비스 객체 번호 확인
5) dbsafer3.service 테이블에서 확인한 서비스 객체 번호에 맵핑할 IP/Port INSERT
INSERT INTO `dbsafer3`.`convert_services` (no, destip, destport) VALUES (1, '10.10.10.10', 3306);
-- 만약 고객사에 도메인주소로 설정된 서비스가 5개라면
-- INSERT INTO `dbsafer3`.`convert_services` (no, destip, destport) VALUES (1, '10.10.10.10', 3306);
-- INSERT INTO `dbsafer3`.`convert_services` (no, destip, destport) VALUES (2, '20.20.20.20', 3306);
-- INSERT INTO `dbsafer3`.`convert_services` (no, destip, destport) VALUES (3, '30.30.30.30', 3306);
-- INSERT INTO `dbsafer3`.`convert_services` (no, destip, destport) VALUES (4, '40.40.40.40', 3306);
-- INSERT INTO `dbsafer3`.`convert_services` (no, destip, destport) VALUES (5, '50.50.50.50', 3306);
6) DBSAFER 구동
7) PC Assist NAT서비스 내역에서 임의의 고정 IP 확인
[PC Assist NAT서비스 내역]
- services 및 convert_services 테이블에 같은 객체번호가 있다면 convert_services 에 등록된 destip/destport 로 대체
- 사용자는 10.10.10.10 또는 20.20.20.20 등과 같은 임의의 IP로 DB 접속","여성구: 좋은 정보를 잘 정리해주셨네요. 감사합니다.
클라우드 구성 레퍼런스로 확인을 하는 것이 좋을 것 같습니다.",https://cafe.naver.com/pnpsecure2/4511
4475,[TIP][DBSAFER] 네트워크 방화벽 오픈정보 - DBSAFER_v5.0_사용포트(실시간 확인/검증),"1.사유
- DBSAFER 방화벽 해제 포트입니다
- 실시간으로 방화벽 허용 포트, 확인을 위해 카페에 올립니다
- 잘못된/오래된 방화벽 허용 포트가 있습니다
: pc_assist(agent) 3.2미만 버전의 방화벽 허용 문서가 있는데, 조심(?)하세요(은근히 과거 문서 보는사람 많음)
ex) SSL_LISTEN_FLAG = YES로 하고, 3361,3362포트 허용이 누락됨
- 기본적으로 외우실것을 권장드리며, 망각의 축복을 대비해.....참고하시기 바랍니다.
첨부파일
1. 네트워크 방화벽 오픈정보 - DBSAFER_v5.0_사용포트
.xls
파일 다운로드
2. 내용(폰으로 볼수 있게 스샷으로 올립니다) | 이미지 ""클릭""하면 크게 보입니다.
1) 사용자PC - DBSAFER | 사용자 구간
2) DBSAFER - 대상DB/OS(서비스대상) | DB/OS 구간
3) 관리자PC - DBSAFER | 관리자 접속/정책등록
[키워드]
@방화벽, @dbsafer, @허용포트, @포트,","공유민: - 나중에는 기억보단 메모를 믿어야 되더라고요....업데이트도 편하고...
: 정리하고 메모하는 습관을 가집시당... | 문금주: Manager Hidden 메뉴 -> 기본 동작 설정 -> 포트 유효성 검사를 통하여 해당 PC <-> DBSAFER 간 포트 Check도 가능합니다.

다만 유효성 검사의 Port LIst 등은 타 시스템 연동 부분이나 현재 쓰지 않는 기능도 포함되어 있어 걸러서 보셔야 합니다. | 공유민: - 오.....굿
: 포트 유효성 검사 ""불러오기"" 리스트 있으면, 같이 올려주세욤
: 예시?
: 왠지 이것도 한번 정리해서 올려야 되나 싶다.",https://cafe.naver.com/pnpsecure2/4475
4472,[TIP][DBSAFER] AWS 설치시 심볼릭 링크추가(/home),"1.이슈내용 : /home 부분의 공간이 적어 별도/추가 할당된 공간에 mount하는 가이드
(심볼릭 링크(ln)으로 설정하는 방법)
2. 초기 설정(스샷)
- ""/""(/home)공간이 부족 함
: 로그를 쌓기 위한 추가 공간을 요청했으며 ""vol2""를 할당받음
3. 작업내용(명령어)
1) maria DB 정지
[root@ip-172-31-48-40 dbsafer]# service mysql stop
Stopping mysql (via systemctl): [ OK ]
[root@ip-172-31-48-40 dbsafer]# cd /home/dbsafer/
[root@ip-172-31-48-40 dbsafer]# ll
total 4
drwxr-xr-x. 2 dbsafer slaps 6 Oct 5 06:50 backup
drwxr-xr-x. 2 dbsafer slaps 6 Oct 5 06:50 backup_tmp
drwxr-xr-x. 4 dbsafer slaps 30 Oct 5 06:50 buffer
drwxr-xr-x. 3 mysql mysql 19 Oct 5 06:51 data
drwxr-xr-x. 2 dbsafer slaps 45 Oct 5 06:52 dbsafer_log
drwxr-xr-x. 2 dbsafer slaps 6 Oct 5 06:50 filelog
-rw-------. 1 dbsafer slaps 437 Sep 28 08:07 id_rsa.pub
drwxr-xr-x. 2 dbsafer slaps 6 Oct 5 06:50 logfiles
drwxr-xr-x. 2 dbsafer slaps 6 Oct 5 06:50 update
2) /data폴더 > /vol2로 이동
[root@ip-172-31-48-40 dbsafer]# mv ./data /vol2/
[root@ip-172-31-48-40 dbsafer]# cd /vol2/
[root@ip-172-31-48-40 vol2]# ll
total 24
drwxr-xr-x. 3 mysql mysql 4096 Oct 5 06:51 data
drwxr-xr-x. 3 dbsafer slaps 4096 Oct 5 07:16 dbsafer_log
drwx------. 2 dbsafer slaps 16384 Sep 28 06:04 lost+found
[root@ip-172-31-48-40 vol2]#
[root@ip-172-31-48-40 vol2]# cd ..
[root@ip-172-31-48-40 /]#
[root@ip-172-31-48-40 /]#
[root@ip-172-31-48-40 /]#
3) 심볼릭 링크
[root@ip-172-31-48-40 /]# ln -s /vol2/data /home/dbsafer/data
[root@ip-172-31-48-40 /]# cd /home/dbsafer/
[root@ip-172-31-48-40 dbsafer]# ll
total 4
drwxr-xr-x. 2 dbsafer slaps 6 Oct 5 06:50 backup
drwxr-xr-x. 2 dbsafer slaps 6 Oct 5 06:50 backup_tmp
drwxr-xr-x. 4 dbsafer slaps 30 Oct 5 06:50 buffer
lrwxrwxrwx. 1 root root 10 Oct 5 07:19 data -> /vol2/data
drwxr-xr-x. 2 dbsafer slaps 45 Oct 5 06:52 dbsafer_log
drwxr-xr-x. 2 dbsafer slaps 6 Oct 5 06:50 filelog
-rw-------. 1 dbsafer slaps 437 Sep 28 08:07 id_rsa.pub
drwxr-xr-x. 2 dbsafer slaps 6 Oct 5 06:50 logfiles
drwxr-xr-x. 2 dbsafer slaps 6 Oct 5 06:50 update
4) maria db 시작
[root@ip-172-31-48-40 dbsafer]#
[root@ip-172-31-48-40 dbsafer]# service mysql start
Starting mysql (via systemctl): [ OK ]
[root@ip-172-31-48-40 dbsafer]#
[root@ip-172-31-48-40 dbsafer]# cd /dbsafer/
5) PNP 모듈 시작
[root@ip-172-31-48-40 dbsafer]# ./pnp start
[키워드]
@/home영역 추가, @심볼릭, @symbolic link, @디스크추가, @ln, @mount","공유민: - 심볼릭 링크/하드 링크 다들 잘 아실 거라 생각합니다
: 실제로 적용할 때, 참고 하시면 될 것 같습니다
: 한가지 예입니다, 다른 방식으로 얼마든지 응용할 수 있습니다
(저 같은 경우 담당자가 dbsafer계정을 생성해서, 하단의 /data 부터 링크를 걸었지만, 링크 위치를 변경해서 적용할 수 있습니다)

- 위 명령어를 그래도 적용 하셔도 좋지만, 꼭 VM에 테스트 해보시고, 이해하시고 적용해주세요
: 이해하지 못하면, 장애 발생시, 즉각적으로 대처하기 어렵습니다

고생하십니다
화이팅 | 공유민: 심볼릭 링크/하드링크 설명
https://jybaek.tistory.com/578

https://m.blog.naver.com/s2kiess/220142016926",https://cafe.naver.com/pnpsecure2/4472
4429,SFTP 서비스 사용시 Server Agent 로그에서 ssh로그가 DBMS로그에 남는 현상_20200911,"SFTP 서비스 사용시 Server Agent 로그에서 몇몇개의 ssh로그가 DBMS로그에 남는 현상이 있습니다.
현재 벅스에 등록하여 수정중에 있습니다.(20200911)
> 해당 증상 개선 완료(20201012)
https://bugs.pnpsecure.com/view.php?id=18170
위 사진은 ssh접속임에도 불구하고 DBMS로그에 로깅되고 있는 사진입니다.
[원인]
server_manager모듈이 DBSAFER DB(dbsafer3.services)를 조회해서 ip/port 기준으로 로깅할 서비스를 찾는데 type이 4일 경우 터미널로깅을 함.
server_manager모듈은 ip/port에 대해서 중복은 없는것을 전제로 하는데 ssh와 sftp서비스는 ip/port 중복이며, ssh 서비스의 type은 4이지만 sftp 서비스의 type은 22. server_manager 모듈이 DB에 질의할때 해당 ip/port로 조회해서 type이 22로 나올경우 모르는 type이기 때문에 DBMS 로그로 조회되도록 남김.
sftp 서비스를 사용하는 방법은 조이삭 과장님이 작성하신 글을 참고하여 주시기 바랍니다.
링크 : https://cafe.naver.com/pnpsecure2/4012
cafe.naver.com
cafe.naver.com
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/4429
4421,[Tip] 경고메일에서 예약어 사용할 수 있도록 설정하는 방법(mailer java 모듈 사용시),"해당 tip은 mailer java모듈 사용시에 해당됨을 알려드립니다.
Enterprise Manager에서 경고 메일 객체 생성시 아래 사진과 같이 예약어를 설정할 수 있습니다.
Eneterprise Manager에서 해당 예약어를 등록하였다고 하여서 바로 사용할 수 있는것이 아닙니다.
/dbsafer/.conf/lang_comment.txt 파일을 열어서 KO_MSG_MAIL_COMMENT= 빈칸으로 해야 사용가능
감사합니다.",채널지원: 퍼가요~♡ | 진선태: 좋은 기능이네요. | 한두영: 해당 Tip은 mailer java 모듈에만 해당됩니다.,https://cafe.naver.com/pnpsecure2/4421
4419,[TIP][현대케피코]서비스 터미널 로그에서 접속계정(Login Account)이 '*****'로 찍히는 이슈 조치 사항 공유,"1. 증상
A. DBSAFER 서버를 경유 해 보안대상서버에 RDP접속 시, 로그에 접속계정(Login Account)이 ‘******’ 보이는 현상 발생
B. Server Agent에서 모듈 로그 확인 시, Telnet 서버 및 wta_proxy_server 연결 실패 현상 발생
2. 원인
A. wta_proxy_server 모듈에서 pnp_telnet 연결 실패 현상이 발생하여 명령어 정보를 전달받지 못함
B. 연구소에서 IPV6 지원하면서 소켓을 bind하는 방식을 변경함
C. 기존에는 모든 IP주소를 허용한 형태로 소켓이 bind(0.0.0.0:{PORT})되었으나, 변경후에는 DBSAFER IP를 지정하여 bind({DBSAFER IP}:{PORT})하도록 변경됨
D. wta_proxy_server에서는 127.0.0.1 로 연결을 시도하기 때문에, 특정 IP를 지정하여 bind한 구조의 소켓으로 접속을 실패함
E. IPv6 지원이 적용된 v3346 이상의 버전부터 발생함
3. 조치
A. 연구소에서 wta_proxy_server에서 접속하는 소켓은 모든 IP 주소를 허용하도록 원상복구 시킴
4. 결과
A. pnp_telnet 패치 후, 접속 계정(Login Account) 정상적으로 찍히는 것 확인
관련 이슈 벅스 링크 :
https://bugs.pnpsecure.com/view.php?id=18086#c70376",댓글 없음,https://cafe.naver.com/pnpsecure2/4419
4412,[RDP][TELNET][한국투자저축은행] 특정서버에 window 원격접속이 안되는 현상,"1. 증상
1.1 IM을 사용해 Window서버 접속시 이 컴퓨터에 원격 컴퓨터에 연결할 수 없습니다. 메시지 발생
telnet 명령어를 통해 DBSAFER -> 대상서버 포트 체크시 정상
1.2 mstsc를 프로그램을 이용해 직접 접속시 '원격 컴퓨터의 ID를 확인할 수 없습니다' 메시지 발생
해당 메시지 발생후 즉시 '예'버튼 클릭시 이 컴퓨터에 원격 컴퓨터에 연결할 수 없습니다. 메시지 발생
해당 메시지 발생후 5~10초 대기후 '예'버튼 클릭시 정상접속
2. 원인
: RDP는 기본적으로 세션을 2개 맺는데 대상 서버에서 세션의 최대 개수를 1개로 설정되어 있어 RDP접속시 첫번째 세션이 정리될 때까지 대기해야 정상접속
3. 조치
: 실행 -> gpedit.msc -> 로컬 그룹 정책 편집기 실행
: 로컬 컴퓨터 정책 -> 컴퓨터 구성 -> 관리 템플릿 -> windows 구성 -> 터미널 서비스 -> 원격 데스크톱 세션 호스트 -> 연결 -> 연결 개수 제한
: 연결 개수 제한에서 TS 최대 허용 연결 개수를 최소 2개이상으로 설정",댓글 없음,https://cafe.naver.com/pnpsecure2/4412
4398,[TIP] mailer모듈에서 메일 전송 시 charset이 안 맞아서 한글 깨지는 현상,"mailer모듈에서 한글이 깨지는 경우 보통 설정 파일(pnp_mailer의 경우 pnp_mailer.conf, pnp_mailer.sh의 경우 pnp_mailer.properties)에서 charset을 설정하여 해결 할 수 있는데요~
이와 같은 방법으로 해결하지 못하는 경우도 있습니다.
예를 들면 html파일과 html안에 들어가는 파라미터값이 서로 charset이 다른 경우인데요.
간단하게 경고메일을 예로 들면
1. html의 charset에 맞춰서 mailer의 charset을 설정할 경우 아래와 같이 안에 들어가는 파라미터 값은 깨집니다.
2. 반대로 파라미터값의 charset에 맞출경우 아래그림과 같이 이번엔 html코드내의 한글이 깨집니다.
위와 같은 상황을 해결하려면 html의 charset과 파라미터값의 charset 동일하게 해주어야 됩니다.
파라미터값의 charset을 바꾸는것보단 html의 charset을 바꾸는 방법이 더 간단하여 안내해드리도록 하겠습니다.
(1) 해당 메일폼 파일(html, txt 기타 등등)을 vi로 열어줍니다.
(2) :set fileencoding=charset (ex) :set fileenconding=euc-kr) 을 입력후 enter
(3) :wq
위 세가지만 순서대로 따라하면 아래 그림과 같이 해결! 간단하죠?
감사합니다.",공유민: 굿! | 채널지원: 채널사 엔지니어 카페로 퍼가요~♡,https://cafe.naver.com/pnpsecure2/4398
4396,[TIP] PC내에 WAS나 모니터링 프로그램등 서비스를 가동하여 DB접근하는 경우 NAT가 안되는현상.,#NAME?,댓글 없음,https://cafe.naver.com/pnpsecure2/4396
4359,[TIP][AWS] Auto Scale 모듈 적용 방법 공유,"[요약]
- AWS의 Auto Scaling 관련 DBSAFER 모듈 설정 및 기능 점검 방법을 공유드립니다.
. 본문에서는 각 모듈의 설정 방법만을 가이드하며, 상세 수행 절차는 첨부 파일에서 확인하실 수 있습니다.
[적용 모듈]
- aws_scale
- dbsafer_metasync
[사전 준비사항]
- DBSAFER Server 내 Java 설치 (Java 7 & Java 11 버전 무관)
- AWS IAM 정보 필요
. Secret Key / Access Key 정보 필요 (Credential 파일)
- AWS IAM 권한 부여
. EC2 : AutoScalingReadOnlyAccess / AmazonEC2ReadOnlyAccess
. RDS(Aurora Cluster) : AmazonRDSReadOnlyAcesss
** Credential 파일 확인 및 권한 부여 방법은 첨부된 문서의 이미지 참고하시면 이해하기 쉬울 것 같습니다.
[제약사항]
- 현재 EC2 인스턴스와 RDS(Aurora Cluster)에 대해서만 Auto Scaling 된 서비스 동기화 지원
- DBSAFER 서버에서 설정된 Cloud Group에 대해서만 Auto Scaling 기능 동작
. Cloud Group에 등록되지 않고 쿠버네티스등에 의해 자동으로 인스턴스 증감되는 서비스는 동기화 불가
- IAM Credential 정보 및 Cloud Group 등록은 CLI에서만 수행 가능 (DBSAFER Manager에서 설정 불가)
- aws scale과 metasync 데몬을 통해 서비스 생성/수정/삭제된 내역은 DBSAFER Manager에 로그 기록되지 않음
[모듈 설정 방법]
- aws_scale
. aws_scale 모듈은 다음 경로에서 얻을 수 있습니다.
. https://bbs.pnpsecure.com/showthread.php?tid=7505
1. aws_scale 모듈 설치
# /dbsafer 경로에 압축 해제
2. aws_scale 모듈 설정 변경
# /dbsafer/.conf/samples/aws_scale.properties 파일을 .conf 경로로 복사하여 편집
# target_cloud_service (필수)
-> 인스턴스를 검사할 클라우드 서비스 지정
-> ec2_autoscaling 또는 aurora_cluster 입력
# maintain_user_service (선택)
-> 인스턴스 삭제 시 사용자 서비스 유지할 것인지 정지할 것인지 설정
-> True 또는 False 입력
# instance_check_interval (선택)
-> 인스턴스 검사 주기 설정
-> 기본 10분이며 주기롤 짧게 해두어도 AWS 환경에서 인스턴스 생성 초기화가 완료되어야 동기화 수행됨
- dbsafer_metasync
. dbsafer_metasync 모듈은 다음 경로에서 얻을 수 있습니다.
. https://bbs.pnpsecure.com/showthread.php?tid=6229
1. dbsafer_metasync 모듈 설치
# /dbsafer 경로에 압축 해제
2. dbsafer_metasync db 테이블 생성
# /dbsafer/dbsafer_metasync.sh install db
3. dbsafer_metasync_syncdb.properties 설정 변경
# /dbsafer/.conf/dbsafer_metasync_syncdb.properties 파일을 복사하여 편집
# 연동 테이블 : dbsafer3.prepare_list (AWS Auto Scaling 수행 시 해당 테이블에 정보 등록 수행됨)
4. dbsafer_metasync.properties 설정 변경
# /dbsafer/.conf/dbsafer_metasync.properties 파일을 복사하여 편집
# SERVICE_TARGET=META_TABLE_001
# SERVICE_NAME=[[service_name]]
# SERVICE_TYPE=[[service_type]]
# SERVICE_IP=[[service_dns]]
# SERVICE_PORT=[[service_port]]
# SERVICE_STATUS=[[status]]
# SERVICE_GROUP=[[service_group_list]]
** 설정 완료 후 각 모듈 실행, 기능 점검하여 동작 여부 확인하시면 됩니다.
** 기능 점검 방법은 첨부된 파일에서 확인하실 수 있습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/4359
4349,[AWS] 통신속도가 느린경우 SFTP 접속불가 현상 발생 (해외망) - 현대엠엔소프트,"고객사 : 현대엠엔소프트 (AWS)
벅스번호 : 17648
이슈 : SFTP 파일 전송 시 오류 발생 (접속 오류), 단 SSH 터미널은 정상작동
환경 특이 사항 : 대상 서버와 DBSAFER 가 모두 AWS 유럽리전에 위치 되어 있으며, 통신속도가 매우 느리다.
발생원인 :
- 사용자가 접속한 세션이 SFTP인지 여부를 판단하기 위해서 0.1초동안 기다림 (기존)
0.1초가 초과하면 해당 세션을 SSH로 오판단하여, SSH 응답메시지를 사용자 툴에 전달하여 해당 툴이 종료됨
발생모듈 및 버전정보
ssh_p6 version SSH_DBSAFER_2.32.54 (발생모듈)
개설모듈 및 버전정보
ssh_p6 version SSH_DBSAFER_2.32.66 (개선모듈)
telnet v3353 이상 에서 사용가능
개선내용
- SFTP 여부를 판단하는 시간을 설정할수 있도록 추가함
- /usr/local/etc/ssh_conifg 파일에 아래의 옵션을 추가하여 설정 가능 (단위 us)
sftpwaittime 500000
- 최소 0.1초(100000), 최대 1초(1000000), 기본값 0.1초(100000)
* 현대엠엔소프트의 경우 최대 1초의 대기시간으로 변경 후 정상 작동을 확인하였습니다.
추후 릴리즈에 반영 예정입니다.
R20.05 브랜치에 반영완료",댓글 없음,https://cafe.naver.com/pnpsecure2/4349
4336,[TIP][네트워크] DBSAFER 설치시 ip 충돌/사용 여부 확인,"0. 발단
- 담당자가 DBSAFER ip 라고 전달해줌
: 최초 등록시 GATEWAY로 핑 감(to DBSAFER 서버,콘솔)
: manager 접속됨 >>>>> manager 접속안됨??!?!(to pc)
: DBSAFER_ping 안됨(to pc)
: 이상발생후 에서 GATEWAT로 핑 안감??(to DBSAFER 서버,콘솔)
: ip충돌을 예상
1. 내용 :
ICMP 패킷을 차단한 호스트라도 단지 연결성만을 검사하고 싶은 경우라면, arping을 사용하면 유용하다
목표 : 담당자가 준 DBSAFER IP에 대해 충돌나지 않는지(타 서버가 사용중인지) 확인해 보자
(아래는 자신의 시스템으로 arping을 3번 보내서 확인하는 예제이다)
2. 명령어 :
# arping -q -D -I [interface] -c 3 [ip]; echo $? <<<<< **요거만 기억하세요!!!!
예시) arping -q -D -I bond0 -c 3 192.168.50.119; echo $?
(DBSAFER ip : 192.168.50.119, 인터페이스 : bond0)
[결과 예시]
3. 명령어 옵션 설명
arping [option] / ARP 요청을 이용한 네트워크 연결을 확인한다.
-c count : arping의 개수를 지정한다.
-w timeout : w 옵션 뒤 시간(초)를 지정하여 그 시간(초) 까지만 arping을 실행한다.
-I device : 이너넷 장치를 지정한다.
-s source : source IP를 지정한다.","공유민: 담당자가 ip 충돌난거 아니라고, 계속 우길때 보여주면 좋음 | 진선태: 유용한 정보인 것 같습니다. 감사합니다.

위와 같이 충돌된 상황에서 추가로 충돌시킨 장비를 찾는 방법을 함께 쓰시면 추적에 도움이 되기도 합니다.

패킷 스니핑(IP주소 충돌로 네트워크는 안되어도 패킷은 수집됨)으로 충돌된 장비에서 발생된 ARP 트래픽에서 IP주소와 MAC주소를 확인하여 추적하는 방법도 있으며, 만약 같은 구간으로 Gateway에 의한 MAC주소가 세탁되지 않는다면 장비의 대략적인 종류도 확인이 가능합니다.

[충돌되고 있는 IP주소 식별 예]
tcpdump -i eth0 -s0 host 192.168.222.222 -xX -vv -e
--> 해당 IP주소를 트래픽이 흘러 들어오는 것을 볼 수 있음, 특히 ARP 및 특정 UDP 패킷을 broadcast로 뿌려짐

[특정 MAC주소의 트래픽 추가 확인 예]
tcpdump -i eth0 -s0 ether host 00:E0:4C:5B:FD:F1 -xX -vv -e

[장비 추정]
https://hwaddress.co | 공유민: 좋은 팁에 감사합니다~~
추가로 테스트해보고 공유하겠습니당~",https://cafe.naver.com/pnpsecure2/4336
4280,[공유] pnp_ssl_proxy 엔지니어 매뉴얼,"pnp_ssl_proxy 엔지니어 매뉴얼
pnp_ssl_proxy 모듈 적용 시 지원 가능한 서비스 (2020.06.19기준)
지원 서비스 지원 현황
암호화 MSSQL 지원 가능
AzureSQL MI, Database 지원 가능
DynamoDB 지원 불가 (2020년 4분기 예정)
파일 첨부하였습니다.","조이삭: 인증서 관련 일부 내용 변경 되었습니다. 파일 첨부하였습니다. | 박상원: rev 39 버전이 아닌 rev 38 버전 ssl_proxy 모듈도 수정된 방법으로 적용하여야 복호화되는 것으로 확인하였습니다.
(/dbsafer/.conf 내 파일 변경)

현재 빌드 요청하여 전달받는 버전이 rev 38이기 때문에 혼란을 줄 수 있을 것으로 보입니다.

확인 부탁드리겠습니다. | 조이삭: 아래와 같이 확인 하였습니다. 현재 최신버전에서 빌드 시 영향받는 부분이 없어 따로 수정하지 않겠습니다.
(보통 QA에서 테스트 버전 기준으로 메뉴얼에 명시합니다.)

[확인사항]
- 개발자 수정버전 Rev 38
- QA 테스트 버전 Rev 39 (R.20.05 릴리즈 반영시 Rev 오토 카운팅, 변경된 사항 없음)

- 2020.07.08 (엔지니어가 패키지 전달받은 날짜) 기준 최신버전 Rev38
- 2020.07.14 기준 최신버전 Rev40

확인 감사합니다. | 조이삭: 인증서 관련해서 일부 내용 추가하였습니다. (문서버전 : 1.0.2)

[추가내용]
- 인증서 암호화 알고리즘 확인 관련 | 조이삭: 인증서 관련해서 일부 내용 수정 및 추가 하였습니다. (문서버전 : 1.0.3)

[수정내용]
- 인증서 위치 변경 설정 내용 추가 및 수정 | 최재규: 담당자 변경으로 관련 내용은 아래 링크에서 업데이트 및 관리하도록 하겠습니다.

https://cafe.naver.com/pnpsecure2/4733",https://cafe.naver.com/pnpsecure2/4280
4278,[공유] PC AGENT WEB DOWNLOAD 매뉴얼,PC AGENT WEB DOWNLOAD 매뉴얼입니다.,"채널지원: download.zip 파일은 아래 경로에서 취득 가능 합니다.

https://drive.google.com/drive/folders/1V88KfB_L1_gTT2EtKSPehkYZGXxaOTbp",https://cafe.naver.com/pnpsecure2/4278
4277,[공유] toplog 매뉴얼 및 설치파일,"toplog 매뉴얼 및 설치파일 입니다.
[사용이유]
일정시간마다 top 상태정보를 기록하여 메모리 cpu, 프로세스에 대한 사용량을 기록하여 시스템 상에 장애 발생시 문제를 보다 정확하게 파악하기 위함입니다.
[주의 사항]
1. 파일생성 경로
가. toplog.sh : /dbsafer/ 디렉토리 밑에 생성
나. toplog_monitor : /etc/cron.d 디렉토리 밑에 생성
2. toplog_monitor의 권한은 644 또는 600으로 주어져야 cron에서 정상적으로 작동합니다.
[결과값]
메모리 상태 및 프로세스, CPU, 포트개방상태 등을 나타내어 줍니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/4277
4190,[TIP] 매니져 삭제 시 애러 메세지가 나오면서 삭제되지 않을 경우 조치 방법,"고객사에서 최신 매니져를 적용하기 위해
프로그램 추가/제거를 통해 기존 매니져 삭제할 경우 간혹 발생합니다.
(담당자 PC의 레지스트리 정보가 삭제 및 변경된 경우)
다음과 같은 애러 화면이 보이며 삭제가 안되는 경우에 대한 이승민 대리의 가이드를 공유합니다.
조치 요약내용  : 정상적인 삭제를 위해서는 삭제하려는 매니져의 버전정보가 해당 경로의 레지스트리에 있어야함.
조치 상세 내용 :
1. 실행창에 regedit 실행
해당 경로의 레지스트리 경로 확인필요
- 32bit 매니저 : HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\PNP SECURE\Enterprise Manager
- 64bit 매니저 : HKEY_LOCAL_MACHINE\SOFTWARE\PNP SECURE\Enterprise Manager
설치한 매니저 버전에 따라 위 경로 폴더 클릭시 다음과 같은 화면이 출력됨
( 화면은 정상일 경우이며 비정상인 경우 version 정보가 없을 수 있음)
2. version 정보 확인
삭제가 되지 않는 현상으로 보아 현재 version 정보 혹은 레지스트리 경로(키) 자체가 삭제되어 있을것으로 예상 가능
- 키가 삭제된 경우조치
PNP SECURE -> Enterprise Manager 를 해당 경로에 생성.
Enterprise Manager 선택 후 우측화면에 우클릭하여 '새로 만들기' -> '문자열 값 생성'
이름 : Version / 데이터 : 400800xxxx 입력
(xxxx에는 설치한 매니저 빌드 버전 입력 - ex. 4008005441)
3. 매니저 삭제 하기
- 위 레지스트리 경로에 Version 정보 입력 후 삭제","송민화: 위 방법을 수행해도 삭제가 안될 경우
https://bbs.pnpsecure.com/showthread.php?tid=10436
사용해서 삭제 시도해보시기 바랍니다.",https://cafe.naver.com/pnpsecure2/4190
4142,[FAQ] [기술공유]WTA로그를 Log서버에 저장하는 방법,"채널사 TIP 문서에 작성되었으나, 내부 공유에는 관련 내용이 없어 업로드 합니다.
""Bugs, RDP 로깅시 filelog의 img 파일을 GW서버에만 저장하는 이슈"" 에서 기존의 문제점에 대해서 보완하여 패치된 이력 확인이 가능합니다.  (2020-01-03 일에 수정 완료)
가. WTA로그를 LOG서버에 저장 사용 방법(이중화 구성)
- 제품 버전 : DBSAFER 5.0
- 이슈 내역
* DBSAFER의 이중화 구성 시 WTA 로깅을 할 경우, 각 GW 서버에 wta로그가 따로따로 로깅되어
wta로그를 각 GW서버에서 따로따로 확인 할 수 밖에 없는 현상 발생.
* 각 GW서버에 wta 로그가 따로따로 로깅되다 보니, 백업에도 어려움이 있었음.
-  LOG 서버 WTA 로그 저장 기능 적용 방법
* pnp_telnet 모듈 v3345 버전 이상 사용
* LOG / GW서버에 wta_player 데몬 실행
* wta 로그 저장 위치
/dbsafer/filelog/wta
- 기능 관련 참고
[LOG 서버 이미지 복사 관련]
1. GW→LOG 서버로의 WTA 이미지 파일 복사는 pnp_telnet v3345 이상에서 지원됩니다.
2. GW→LOG 서버로의 이미지 복사는 세션 종료 후 처리됩니다. 세션이 연결된 상태에서는 GW에 우선 저장됩니다.
3. GW→LOG 서버로의 이미지 복사를  위해서는 LOG 서버에 wta_player가 실행되어 있어야 합니다. (telnet 모듈에서 세션 종료 후 wta_player의 포트로 송신)
4.  GW에는 wta_player가 실행되어 있지 않아도 이미지 파일이 정상 저장됩니다.
[세션 재현 관련]
1. LOG 서버에 이미지 파일 복사가 완료되었다면 세션 재현을 위한 wta_player는 LOG 서버에만 실행되어 있어도 가능합니다.
2. LOG로 이미지가 정상 복사되지 않은 경우 세션 재현이 되지 않습니다. 단, GW에 이미지가 저장되어 있다면 GW의 wta_player를 실행하여 세션 재현 가능합니다.
[기타사항]
1. GW→LOG 서버로 복사된 후 GW의 이미지가 자동으로 삭제되지는 않습니다. GW의 디스크 용량 확보를 위해서 이미지 파일은 수동삭제하셔야 됩니다.
2. WTA 이미지 복사를 위한 별도 설정은 없습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/4142
4126,매니저 서버 접속 검사 - 실패(서비스)/(서버)의 차이,"※매니저 서버 접속 검사 - 실패(서비스)/(서버)의 차이(추가 설명)
-검사 대상은 아래와 같으며 양 쪽 모두 접속 검사를 독립적으로 수행한다.
1. 서비스 - DBSAFER에서 listen하고 있는 서비스 포트
>>GW 분리 구성 및 여러대 인 경우 slave를 통해 모든 GW에 서비스를 검사하게 된다.
ex) telnet GW IP 4000번대~
2. 서버 - 실제 대상 서버
ex) telnet 등록된 DB IP DB Port
그리고 검사 결과를 매니저로 전송하며 전송 결과는 아래와 같이 총 4가지 방식이 있다.
결과값 종류 매니저 표현
정상 정상
서비스만 접속 오류 실패(서비스)
서버만 접속 오류 실패(서버)
서비스와 서버 접속 오류 실패(서버)",댓글 없음,https://cafe.naver.com/pnpsecure2/4126
4075,Syslog 전송시 DBMS 패킷 중 Denied 값 공유,"pnp_log_sender 모듈을 사용하여 로그저장장치와 Syslog 연동시 DBMS 쿼리 로그 중 denied 필드가 있는데 허용/차단에 대한 값 외에 2,3,4 값에 대한 설명이 부족한것 같아 공유 드립니다.
# 기존
# 추가 사항
필드값 3인 격리는 다음과 같은 경우에 발생합니다.
정책은 허용이지만 로그인 실패 했을 경우
(정책은 차단이며 로그인 실패 했을 경우 = 로그인 실패(4))
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/4075
4015,[TIP]DBSAFER를 경유하면 Oracle Keepalive 옵션이 적용되지 않는 이유(Oracle12c 이상에서 해당),"* DBSAFER를 경유하면 Oracle Keepalive 옵션이 적용되지 않는 이유에 대해 공유합니다. (Oracle12c 이상에서 해당)
[문의사항]
고객사 문의사항 :
Oracle11g와 12c 두대의 DB에 똑같이 KeepAliveTime 설정 하였는데 세션 맺고 30분이 지났을 때, 11g는 세션이 안끊기고 12c는 끊기는데 DBSAFER에서 중계를 못하는게 아닌가요??
(사용자-DBSAFER 구간의 방화벽 Idle time은 30분)
답변 :
Oracle 11g에서는 DB에서 client로 keepalive패킷을 보낼 때, 10byte의 payload data를 보냄
Oracle 12c이상에서 부터는 DB에서 client로 keepalive패킷을 보낼 때, data 없이 헤더만 보냄
DBSAFER의 서비스 데몬은 data가 있는 경우에만 Client로 전달함(헤더만 있는 경우에는 전달하지 않음).
따라서, oracle12c는 사용자-DBSAFER구간의 방화벽에 의해 패킷이 drop 되어 세션이 끊기고, 11g는 유지됨
[설명]
Oracle KeepAlive Time 이란? 맺어진 DB세션에 대해 정해진 시간에 한 번 씩 DB에서 Client로 패킷을 전송해줌으로써 세션을 유지하는 기능(Oracle서버 sqlnet.ora 파일내의 SQLNET.EXPIRE_TIME = 30 으로 설정)
[Oracle11g 패킷]
[Oracle12c 패킷]
[추후 방안]
작성중","진선태: DBSAFER 장비 자체에서도 본 문제를 해결할 수도 있고,
프로그램 소스 코드의 수정을 통해서도 해결이 가능합니다. (이미 ssh 등에서는 처리한 사례등이 있습니다.)

본 증상과 관련하여 Linux Kernel의 Keep Alive 설정은 아래와 같은데요.

net.ipv4.tcp_keepalive_time = 7200
net.ipv4.tcp_keepalive_intvl = 75
net.ipv4.tcp_keepalive_probes = 9

위 기본 설정의 의미는 KeepAlive 기준 시간은 2시간(7200초)이며,
즉 2시간동안 아무런 통신이 없는 경우 75초 간격으로 총 9회를 Keep Alive 신호(단순 Ack packet)를 커널에서 발생시키도록 되어 있습니다.

그런데 대부분의 방화벽은 2시간보다 더 짧게 Keep Alive가 설정되어 있어서 위와 같은 기본 설정만으로는 Keep Alive가 유지되지 않습니다. 따라서 위 설정에서 keepalive_time을 더욱 짧 | 김가희: 자세한 설명 감사합니다!",https://cafe.naver.com/pnpsecure2/4015
4012,SFTP_엔지니어 가이드 배포,"파일 첨부하였습니다.
추가적인 피드백 라인으로 주시면 관련 내용 확인하도록 하겠습니다.",조이삭: 지원 버전 관련 내용 수정하여 업로드하였습니다.,https://cafe.naver.com/pnpsecure2/4012
4005,DBSAFER DB 마이그레이션 시 주의사항,"아래와 같은 DB 마이그레이션 환경에서 특이사항을 보고 드립니다.
DBSAFER3(Mysql 5.0.77) > DBSAFER5(MariaDB 10.2.23) 마이그레이션 후 특이사항 보고
[요약]
아래의 테스트 결과로 보아 기본 엔진이 Aria이고 MyISAM 엔진을 사용하는 테이블이 존재 할 경우 Table Crash 에러로그가 발생하는 것을 확인함
위와 같은 마이그레이션 이관 전 엔진을 확인하고 사전에 MyISAM엔진을 Aria 엔진으로 변경 후 작업 할 것을 권고드립니다.
[테스트 내역]
DBSAFER DB 기본 엔진 종류
Mysql 5.0.77 MyISAM
MariaDB 10.2.23 Aria
Step 1. DB 이관 전 엔진을 MyISAM으로 유지 후 마이그레이션 진행
Step 2. 해당 서버 전원 OFF 후 ON 시 MariaDB Error Log 확인
DBSAFER5(MariaDB 10.2.23)의 DB 스토리지 엔진은(MyISAM + Aria) 혼용 되어있는 상태
다수의 MyISAM 엔진 기반 테이블이 Table Crash 관련 로그 발생
Step 3. MyISAM 엔진 테이블을 모두 Aria 엔진으로 변경 후 Step 2. 진행
Table Crash 관련 로그 발생 하지 않음
[참고]
관련 레퍼런스
https://mariadb.com/kb/en/aria-storage-engine/
https://subscription.packtpub.com/book/big_data_and_business_intelligence/9781783284399/2/ch02lvl1sec26/migrating-a-table-from-myisam-to-aria
버전 업데이트 시 아래 링크를 참조하여 마지막 단계에서 mysql_upgrade 을 실행하여 모든 데이터베이스 테이블과 해당 DB버전과의 비 호환성을 검사합니다
https://docs.google.com/document/d/1KV5uZco8uvIGc8jMgwPkSe84L4EC_doe1n32KuUtXzo/edit","채널지원: mysql_upgrade 명령어를 수행 하기 위해서는 MySQL root 계정을 사용해야 하는데 엔지니어는 root 계정의 패스워드를 모릅니다.

mysql의 root DB계정을 사용하기 위해서는 품질혁신실에서 추가 가이드 받으셔야 합니다.",https://cafe.naver.com/pnpsecure2/4005
3935,DBSAFER PKG V5.0 브랜치 & 머지 설명,"Branch & Merge 설명
DBSAFER PKG V5.0은 1년에 2번(5월, 11월)브랜치, 머지 작업을 합니다.(2020.01.31기준)
예를들어 설명 드리겠습니다. 아래 그림을 보시면 18년 05월 기준으로 브랜치 작업을 했습니다. 그 전에 브랜치 작업을 했던 17년 11월 브랜치 패키지는 A기간동안 발생한 이슈 및 버그에 대해서만 반영이 되어있는 상태입니다 즉 이 패키지는 머지 패키지가 됩니다.
<b></b>
대부분 브랜치 패키지는 프로젝트용으로 초기 설치 시 배포가 되고, 머지 패키지는 해당 프로젝트가 끝나고 해당 사이트의 유지보수용으로 배포가 됩니다.
그럼 18년 11월 기준으로 브랜치 작업을 했으면?
네, 18년 05년도에 브랜치 작업을 했던 패키지가 머지 패키지가 되는겁니다.
정리하자면
브랜치 패키지는 브랜치 작업을 한 시점에 신규 기능+이슈 및 버그 수정이 되어있는 패키지
머지 패키지는 해당 브랜치에 이슈 및 버그 수정만 들어있는 패키지 입니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/3935
3915,[TIP] 구축시 서버내에 2개의 Gateway를 사용 할 경우 route 설정 방법,"[상황]
1. 기존 한국은행 구축 시 통신 포트로 p1p1 p1p2 포트를 본딩 구성으로 설정 하여 서비스 포트로 사용.
2. 고객사 요청으로 em2, em4의 포트를 본딩으로 묶어 백업망 포트로 사용.
3. 서로 다른 망의 Gateway를 서버에 등록해야 함.
[설정 이유] ifcfg-[인터페이스]에 2개의 Gateway 등록시 centos에서 default gateway를 혼동 할 수 있음
[설정]
# vi /etc/modprobe.d/bonding.conf
alias bond0 bonding
alias bond1 bonding
# cd /etc/sysconfing/networks-scripts/
# vi ifcfg-bond0
ONBOOT=YES
BOOTPROTO=none
IPADDR=통신 IP
NETMASK=넷마스크
GATEWAY=게이트웨이
BONDING_OPTS=""mode=1 miimon=100""
vi ifcfg-bond1
ONBOOT=YES
BOOTPROTO=none
IPADDR=백업망 IP
NETMASK=넷마스크
BONDING_OPTS=""mode=1 miimon=100""
GATEWAY= 설정 하지않는다.
#vi ifcfg-em2 -em4
MASTER=bond1
SLAVE=yes
#vi ifcfg-p1p1 -p1p2
MASTER=bond0
SLAVE=yes
#vi route-bond1
ip+netmask via gateway주소 dev bond1
ex) ip 192.168.101.1 netmask 255.255.255.0 gateway 192.168.101.254
192.168.101.0 via 192.168.101.254 dev bond1
# service network restart
# /etc/sysconfing/networks-scripts/ 경로에서
# ip route ls
# route -n
route  경로확인",댓글 없음,https://cafe.naver.com/pnpsecure2/3915
3907,[TIP] DBSAFER 대용량 로그 조회 기능 사용 방법,"- 개요
대량의 로그를 조회할 경우 해당 기능을 사용하여 기존보다 향상된 속도로 조회 가능.
교보생명 사이트에서 하루 400만건 DBMS 명령어 조회 시, 매니저가 멈추는 현상이 발생하여 이를 개선하기 위해 Enterprise Manager의 대용량 로그 조회 기능 사용.
- 기능
대용량 로그를 조회 시, 결과 출력 속도 개선.
- 동작방식
기본 세션 및 명령어 로그 조회는 Enterprise Manager 를 사용하는 관리자 PC의 메모리를 할당 받아 로그 조회. 대용량 로그 조회 기능을 사용할 경우 관리자 PC의 HDD를 활용하여 로그 조회되어 기존 메모리 할당 방식보다 더 빠르게 로그 조회 가능.
- 권장사양
Enterprise Manager Build-3997 이상. 최신 버전 권고
HDD(C Drive) 여유 용량 필요
- 적용방법
Enterprise Manager 최고 관리자 계정으로 접속하여 시스템 설정 (Ctrl + Shift + F8) 창 활성화.
""로그 조회 설정 > 대용량 서비스 로그 조회 사용"" 체크 후, 확인 버튼 클릭.
Enterprise Manager 재 실행
로그 조회 시, ""조회 버튼 > 화면에 출력(대용량)"" 버튼으로 대용량 로그 조회 기능 사용 가능
- 상세
대용량 로그 조회 시, 관리자 PC의 HDD에 로그 조회 결과가 저장됨.
경로 : C:\Users\(사용자)\AppData\Roaming\PNP SECURE\Enterprise Manager(x64)\Temp
파일 :  .mlu 확장자를 가진 임시 파일로 저장. 저장된 파일은 로그 조회 결과를 초기화 하거나, 매니저를 닫을 경우 삭제 (생성된 파일은 매니저 로그 용으로만 사용 가능, Excel 등 다른 프로그램으로 확인 불가능)
- 제약사항
Enterprise Manager 설치된 PC의 HDD 용량이 부족할 경우, 로그 조회가 제대로 이뤄지지 않음. (약 1,000건 명령어 조회 시, 1,000KB 사용)",댓글 없음,https://cafe.naver.com/pnpsecure2/3907
3890,[TIP] Bypass 카드 초기 설치 시 인터페이스가 동작하지 않는 경우 조치 방법,"Bypass 카드 초기 설치 시 인터페이스가 동작하지 않는 경우 조치 방법
[ 전제 조건 ]
- Bypass 드라이버(bp_ctl-x.x.x.xx.tar.gz )가 미리 설치되어 있어야 함
-> /proc/net/bypass 디렉토리가 보이는 상태여야 함
[ 조치 방법 ]
1.  /proc/net/bypass/bypass_[사용하고자 하는 장치명] 디렉토리 진입
2. cat bypass 실행 -> on으로 출력됨
# Bypass 카드의 디폴트 설정이 on으로 설정되어 정상적으로 동작하지 않음
3. echo 'off' > bypass 실행",댓글 없음,https://cafe.naver.com/pnpsecure2/3890
3863,[pnp_log][에러로그] CRC Error - Ignore this packet.,"- 에러 로그
[2020-01-06 13:47:23] [60529] [ERROR][ERROR_0499002] CRC Error - Ignore this packet. : [recv:0, calc:-1829807115, datasize:169]
src/service/DataSendUtil.cpp[recv]:223
[2020-01-06 13:47:23] [60529] [ERROR][ERROR_0604001] Data Receive Error. : [-1] ** Success(0)
src/service/fparam_service_thread.cpp[fparam_service_thread]:104
[2020-01-06 13:51:26] [60529] [MISC][INFO__000000000] Information message. : Connected db fparam service.
- 내용
로그 데몬에서 사용되는 패킷은 보낸데이터가 받은 데이터와 동일한지 검출하기 위한 CRC가 있는데
보낸 데이터에서 CRC계산 안하고 0으로 보내고, 받은쪽에서도 CRC검사 후 데이터가 맞지 않아 무시한 로그 내용.
일반적인 경우 제품 로직상에 문제는 없음.
- 추정 발생
외부에서 무언가가 3120포트로 데이터를 보냈을 가능성이 있음.
예) 헬스 체크하는 프로그램 등이 임의의 데이터를 더해서 보내는 경우
- 처리 내용
일시적이라면 크게 의미 없어 보이지만, 주기적으로 해당 메시지가 발생된다면 보내는쪽을 찾아서 조치가 필요함.
순환 중복 검사(巡環重復檢査), CRC(cyclic redundancy check)는
네트워크 등을 통하여 데이터를 전송할 때 전송된 데이터에 오류가 있는지를 확인하기 위한 체크값을 결정하는 방식",댓글 없음,https://cafe.naver.com/pnpsecure2/3863
3836,[TIP] sshd 서비스 가동시 해당PID로 sshd.pid 값이 바뀌는 현상,"취약점 조치 혹은 sshd_config설정 후 'service sshd restart' 명령어를 실행할 경우 sshd 는 재시작 되지않고
pnp_sshd (서비스 모듈)이 kill되는 경우가 발생 할 수 있습니다. 도움이 되셨으면 하여 작성하였으니, 참고하시기 바랍니다.
[증상]
- SSH 서비스 모듈 가동시 /var/run/sshd.pid값이 해당 서비스모듈의 PID값으로 바뀜
(여러개의 서비스를 가동할 경우 마지막 pnp_sshd의 PID값으로 입력됨)
- 이로인해 service sshd restart 시 서비스모듈이 kill됨
- 부가적으로 함께 떠있는 apache-tomcat 프로세스가 kill됨
[재현과정]
1. sshd 프로세스 pid확인
2. pnp_sshd 서비스 가동
3. sshd_pid 값 바뀐것 확인
4. service sshd 재시작 할경우
5. pnp_sshd 및 apache-tomcat프로세스 kill확인
[임시조치방법] : /var/run/sshd.pid 에 입력되어있는 PID 값을 /usr/local/sbin/sshd의 PID값으로 입력해줘야 함
(service sshd restart전 cat /var/run/sshd.pid 를 통해 /usr/local/sbin/sshd의 PID값이 제대로 입력되어있는지 확인해야하며, pnp_sshd의 PID값이 입력되어있는 경우 /usr/local/sbin/sshd의 PID값으로 수정해야 합니다.)
[벅스등록] : https://bugs.pnpsecure.com/view.php?id=16031
[장애원인]
- pnp_sshd 모듈 가동 시, sshd의 pid를 저장해주는 파일 (/var/run/sshd.pid)에 자신의 pid를 덮어쒸우기함
- sshd 종료 명령어 (service sshd stop) 시, 해당 파일에 입력되어있는 pid를 기준으로 kill을 날려서, 가장 최근에 실행된 pnp_sshd 서비스가 종료됨
- pnp_sshd가 openssh 코드를 기반으로 개발되었기 때문에 해당 파일에 pid를 입력하는 코드가 존재하고 있었음
[수정내용]
- pnp_sshd에서 sshd의 pid를 저장해주는 파일 (/var/run/sshd.pid)에 자신의 pid를 입력하는 코드를 제거
[조치]
기능 개선 완료하였으며, Rev376(v2.30.161) 이상에서 적용됩니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/3836
3796,[TIP]MariaDB 취약점 조치방법 공유,"* MariaDB 취약점 조치 방법을 공유합니다.
(수정이 필요한 부분은 댓글 부탁드립니다.)
순번
상세내용
보호대책
조치가능여부
조치 불가능 사유
조치방법
1
ㅇ root 계정명이 존재하므로 미흡함
[현황]
+---------------------+---------+
| host                | user    |
+---------------------+---------+
| %                   | root    |
| %                   | safeusr |
| 127.0.0.1           | root    |
| ::1                 | root    |
| DBSAFER.localdomain | safeusr |
| dbsafer.localdomain |         |
| dbsafer.localdomain | root    |
| localhost           |         |
| localhost           | root    |
| localhost           | safeusr |
+---------------------+---------+
ㅇ root 계정명 변경
조치불가
서비스 영향으로 조치 불가
2
ㅇ 익명 사용자가 존재함
[현황]
+---------------------+------+
| host                | user |
+---------------------+------+
| dbsafer.localdomain |      |
| localhost           |      |
+---------------------+------+
ㅇ 익명 계정(mysql.user 테이블의 user컬럼의 데이터가 공란인 계정) 제거
조치 가능
익명계정 삭제로 조치완료
delete from  mysql.user where Select_priv='N';
3
ㅇ mysql.user에 select 권한이 root 계정 외 계정에 부여되어 있으나, 접근이 필요한 계정으로 설정되어 있음
[현황]
+---------------------+---------+-------------+
| Host                | User    | Select_priv |
+---------------------+---------+-------------+
| localhost           | root    | Y           |
| dbsafer.localdomain | root    | Y           |
| 127.0.0.1           | root    | Y           |
| ::1                 | root    | Y           |
| localhost           |         | N           |
| dbsafer.localdomain |         | N           |
| %                   | safeusr | Y           |
| localhost           | safeusr | Y           |
| DBSAFER.localdomain | safeusr | Y           |
| %                   | root    | Y           |
+---------------------+---------+-------------+
조치불가
솔루션에서 safeusr계정을 사용함
4
ㅇ FILE, SUPER, GRANT, PROCESS 권한이 root 계정 외 계정에 부여되어 있으므로 미흡함
[현황]
[ 1. file_priv, Grant_priv ]
+---------------------+---------+
| host                | user    |
+---------------------+---------+
| %                   | safeusr |
| localhost           | safeusr |
| DBSAFER.localdomain | safeusr |
+---------------------+---------+
ㅇ root 외의 계정에 부여된 SUPER_PRIV, FILE_PRIV, GRANT_PRIV 권한 제거
조치불가
솔루션에서 safeusr계정을 사용함
5
ㅇ SELECT, INSERT, UPDATE, DELETE 권한 root 계정 외 계정에 부여되어 있으므로 미흡함
[현황]
[ 1. Select_priv, Insert_priv, Update_priv, Delete_priv ]
+---------------------+---------+
| Host                | User    |
+---------------------+---------+
| %                   | safeusr |
| localhost           | safeusr |
| DBSAFER.localdomain | safeusr |
+---------------------+---------+
ㅇ 일반계정에 불필요하게 부여된 SELECT/UPDATE/INSERT/DELETE 권한 제거
조치불가
솔루션에서 safeusr계정을 사용함
6
ㅇ root, safeuser 계정에 접속 제한 적용되지 않아 미흡함
[현황]
+-----------+-----------+
| host      | user      |
+-----------+-----------+
| %          | root    |
| %          | safeusr |
+-----------+------------+
ㅇ 허용된 IP 및 포트에 대한 접근 통제 적용
조치 가능
DBSAFER Gateway IP, 관리자IP만 등록
*조치 가능 DBSAFER GW IP, 관리자IP(Manager 접속)만 외부접속 허용하도록 수정
1.safeusr변경
--기존의 safeusr계정 수정(DBSAFER GW IP)
update mysql.user set host ='GW IP' where user='safeusr' and host ='%';
--safeusr 계정 추가(관리자IP)
INSERT INTO `user` (`Host`,`User`,`Password`,`Select_priv`,`Insert_priv`,`Update_priv`,`Delete_priv`,`Create_priv`,`Drop_priv`,`Reload_priv`,`Shutdown_priv`,`Process_priv`,`File_priv`,`Grant_priv`,`References_priv`,`Index_priv`,`Alter_priv`,`Show_db_priv`,`Super_priv`,`Create_tmp_table_priv`,`Lock_tables_priv`,`Execute_priv`,`Repl_slave_priv`,`Repl_client_priv`,`ssl_type`,`ssl_cipher`,`x509_issuer`,`x509_subject`,`max_questions`,`max_updates`,`max_connections`) VALUES (""10.77.160.60"",""safeusr"",password(""safeusr""),""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""N"",""N"",""Y"",""N"",""Y"",""Y"","""","""","""","""",""0"",""0"",""0"");
GRANT CREATE TEMPORARY TABLES, EXECUTE, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE ON *.* TO 'safeusr'@'관리자IP';
UPDATE user SET Password=password('현재 DB비번') WHERE User=""safeusr"" AND host ='관리자IP';
2. root변경
--기존의 root 계정 수정(DBSAFER GW IP)
update mysql.user set host ='GW IP' where user='root' and host ='%';
--root 계정 추가(관리자IP)
INSERT INTO `user` (`Host`,`User`,`Password`,`Select_priv`,`Insert_priv`,`Update_priv`,`Delete_priv`,`Create_priv`,`Drop_priv`,`Reload_priv`,`Shutdown_priv`,`Process_priv`,`File_priv`,`Grant_priv`,`References_priv`,`Index_priv`,`Alter_priv`,`Show_db_priv`,`Super_priv`,`Create_tmp_table_priv`,`Lock_tables_priv`,`Execute_priv`,`Repl_slave_priv`,`Repl_client_priv`,`ssl_type`,`ssl_cipher`,`x509_issuer`,`x509_subject`,`max_questions`,`max_updates`,`max_connections`) VALUES (""10.77.160.66"",""root"",password(""dbsafer00""),""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""Y"",""Y"","""","""","""","""",""0"",""0"",""0"");
UPDATE user SET Password=""*1EB4344148ABAC2F938B07AA6D393441FB03E6BC"" WHERE User=""root"";
GRANT CREATE TEMPORARY TABLES, EXECUTE, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE ON *.* TO 'root'@'관리자IP'
FLUSH PRIVILEGES;
7
ㅇ 데이터 디렉터리 소유자는 mysql로 적절하나, 접근 권한 700 초과로 설정 미흡함
[현황]
/data/mysql/
drwxr-xr-x 6 mysql mysql      12288  7월 23 14:05 .
ㅇ 데이터 디렉터리의 소유자 ""Mariadb 서버 실행 계정"", 접근권한 700 이하로 변경
조치 가능
권한 700변경으로 조치 완료
chmod 700 data/
8
ㅇ 설정파일(/etc/my.cnf) 소유자는 root이나, 접근권한은 775로 설정이 미흡함
[현황]
-rwxrwxr-x   1 root mysql    968 2017-01-24 11:22 my.cnf
ㅇ /etc/my.cnf 파일 소유자 root, 접근권한 644 이하로 변경
조치 가능
권한 644변경으로 조치 완료
chmod 644 my.cnF
9
ㅇ 디폴트 포트(3306) 를 변경하지 않고 사용하고 있음
ㅇ SAC 접근통제가 적용되어 있지 않음
[현황]
tcp   0  0 0.0.0.0:3306    0.0.0.0:*     LISTEN  1437/mysqld
ㅇ SAC 통제를 받는 경우, default Port(3306)으로 변경
ㅇ SAC 통제를 받지 않는 경우, default Port(3306)를 사내의 기준에 맞춰 임의의 번호의 포트로 변경
조치 가능
임의 포트로 조치 가능하나, 서비스 재시작 필요
1.DBSAFER stop
2. vi /etc/my.cnf내의 port추가
[mysqld]
datadir=/home/dbsafer/data/mysql
socket=/var/lib/mysql/mysql.sock
port=3306
3. DB재시작
4. ./pnp_agent dbconfig 수정
5.DBSAFER start
10
ㅇ /etc/my.cnf 파일 내 모든 로그 설정이 미흡함
[현황]
[ 1. 에러 로그 설정 ]
#log-error = /home/dbsafer/data/mysql/db_error.log
[ 2. 쿼리 로그 설정 ]
[ 3. 바이너리 로그 설정 ]
#log-bin=/home/dbsafer/data/mysql/db_bin.log
#log-bin-trust-function-creators = 1
[ 4. 슬로우 쿼리 로그 설정 ]
#long_query_time = 10
ㅇ 로그를 기록하도록 설정하고 주기적으로 관리
# 에러 로그 설정
log-error=/usr/local/Maria_DB/err.log
# 쿼리 로그 설정
general-log=1
general-log-file=/usr/local/Maria_DB/data/query.log
# 바이너리 로그 설정
log-bin=mysql-bin
# 슬로우 쿼리(slow query) 로그 설정
slow-query-log=1
slow-query-log-file=/usr/local/Maria_DB/data/maria-slow.log
long_query_time=5
조치불가
서비스 운영에 필요한 로그 설정만 해놓은 상황으로, 불필요한 로그 설정 시, Disk부하의 위험이 있음
11
ㅇ Test Database 가 존재함
[현황]
+---------------------+
| Database            |
+---------------------+
| dbsafer3            |
| dbsafer_log_2019_04 |
| dbsafer_log_2019_05 |
| dbsafer_log_2019_06 |
| dbsafer_log_2019_07 |
| dbsafer_log_2019_08 |
| information_schema  |
| mysql               |
| performance_schema  |
| test                |
+---------------------+
ㅇ Test Database 제거
조치 가능
test DB삭제로 조치완료
drop database test;
12
ㅇ 최근 6개월 이내 패치 적용되지 않으며 기술 지원이 종료된 버전을 사용함
현재 버전: 10.0.27 (Release date 2016-09-25)
최신 버전: 10.0.38 (EOS 2019-03-31)
[현황]
+-----------------+
| version()       |
+-----------------+
| 10.0.27-MariaDB |
+-----------------+
ㅇ 데이터베이스에 대한 최신 패치 적용
※ 현재 최신 버전(2019.07 기준)
- MariaDB 10.4 : 10.4.7 (2019.07.31)
- MariaDB 10.3 : 10.3.17 (2019.07.31 )
- MariaDB 10.2 : 10.2.26 (2019.07.31)
- MariaDB 10.1 : 10.1.41 (2019.07.31)
- MariaDB 10.0 : 10.0.38 (2019.01.31)
- MariaDB 5.5 : 5.5.65 (2019.07.31)
조치예정
10.2.23 버전으로 패치 가능하나, 다운타임 필요","이정근: 좋은 내용 감사합니다.
조금더 보기 좋게 정리 해주시면 좋을거 같습니다. | 홍태영: DB 허용 접속 허용 된 IP 설정 조치시 접속 가능 IP에 '127.0.0.1' 과 'localhost' 추가도 필요합니다.
해당 추가가 없는 경우 내부 모듈 통신 문제가 생깁니다 ( 데몬 및 WEB 서비스)
참고 바랍니다~",https://cafe.naver.com/pnpsecure2/3796
3791,"[TIP]oms_dms데몬로그에서 1초마다 failed to accept assist. SVR_SOCK [6], CLT_SOCK [-1] ** Resource temporarily unavailable(11) ERROR로그가 발생한다면?","1.현상
pnp_oms_dms 데몬 로그에서 1초마다 아래와 같은 ERROR로그가 발생함
2. 관련 데몬 로그
[2019-10-02 16:45:47] [55023] [ERROR][ERROR_9901001] Function Error in execution. : failed to accept assist. SVR_SOCK [6], CLT_SOCK [-1] ** Resource temporarily unavailable(11)
[2019-10-02 16:45:48] [55031] [ERROR][ERROR_9901001] Function Error in execution. : failed to accept assist. SVR_SOCK [6], CLT_SOCK [-1] ** Resource temporarily unavailable(11)
[2019-10-02 16:45:49] [55025] [ERROR][ERROR_9901001] Function Error in execution. : failed to accept assist. SVR_SOCK [6], CLT_SOCK [-1] ** Resource temporarily unavailable(11)
[2019-10-02 16:45:50] [55031] [ERROR][ERROR_9901001] Function Error in execution. : failed to accept assist. SVR_SOCK [6], CLT_SOCK [-1] ** Resource temporarily unavailable(11)
[2019-10-02 16:45:51] [55023] [ERROR][ERROR_9901001] Function Error in execution. : failed to accept assist. SVR_SOCK [6], CLT_SOCK [-1] ** Resource temporarily unavailable(11)
3. 발생하는 데몬 버전
pnp_oms_dms Rev 593
4. 원인
-PC Assist 와 통신하는 포트를 대상으로 Accept 에 대한 처리가 실패하는 경우 중, errno 가 EAGAIN(11) 인 것은 정상적인 상황에서 발생할 수 있는 것으로 확인됨
-서버내에서 시그널이 오가는 경우가 있으며, 그 때 관련모듈에 간섭을 받게되는 경우 위와 같은 메시지 가 발생할 수 있음.
-문제가 없는 로그이므로, 최신버전(Rev 594 이상)에는 관련 메시지가 기록되지 않도록 수정함
5. 관련 Bug
https://bugs.pnpsecure.com/view.php?id=13171",댓글 없음,https://cafe.naver.com/pnpsecure2/3791
3779,[TIP] Watcher 데몬 JAVA 모듈 체크 기능 설정,"1. 필요 상황 및 적용 대상
- watcher 모듈로 java 로 구동 되는 모듈에 대해서 체크 기능 설정
ex) dbsafer_meta,dbsafer_accoutsync, dbsafer_policylinkage , pnp_mailler 등
2. 적용 방법 (dbsafer_policylinkage 모듈 예제)
- 프로세스 확인 (다른 java 프로세스와 구분 할수 있는 명칭 부분 확인)
- .conf/pnp_watcher.conf 정보 등록
> 등록 진행 시 [실행 모듈] | [프로세스 검색 정보] 로 입력
ex) [dbsafer_policylinkage.sh] | [com.pnpsecure.policylinkage.common.Main]",댓글 없음,https://cafe.naver.com/pnpsecure2/3779
3776,DBSAFER telnet/ssh에서의 패스워드 자동 입력 기능을 켜고 끄는 방법은?,"최근 삼성SDI에서 본 상황에 대한 질의/응답이 있었습니다. 관련 내용 상세하게 공유 드립니다.
계정관리의 패스워드 자동 입력 기능을 쓰지 않는 사이트라 하더라도 아래의 사항을 인지하고 계셔야 할 것 같습니다.
[상황]
최근 삼성SDI에서 TCP 31115 포트 (계정관리 패스워드 자동 입력 기능을 위한 포트)로의 통신이 막혀서 터미널 접속의 hang 형상이 발생하였습니다.
이에 현장 엔지니어는 해당 사이트에서는 계정관리를 사용하지 않고 패스워드 자동 입력 기능도 사용하고 있지 않으니 옵션을 끄는 방법을 문의가 있었습니다.
일단 현장에서는 옵션을 끄는 방법을 몰라서 여러 곳에 문의하다고 품질보증을 거쳐 연구소 윤진하 책임의 답변을 듣고 이유를 알게 되었고, 응급 조치로 방화벽 정책을 풀어서 정상 동작하게 했는데요.
아직 제대로 전파되지 않은 기능이므로 해당 기능에 대한 설명을 드리겠습니다.
[옵션 조정 방법]
없습니다.  본 기능은 자동으로 동작하게 되어 있습니다.
[옵션이 없는데 어떻게 동작하는지?]
사용자가 ssh나 telnet으로 타겟 서버에 붙을 경우,
PC[putty -> PC_Assist] --N/W--> DBSAFER[pnp_ssh -> pnp_telnet -> ssh(가상) ] --N/W--> Server[sshd -> pts -> terminal] 과 같은 경로를 통해서 최종 목적지에 붙게 됩니다.
이때에 pnp_telnet에서는 많은 작업을 수행하는데요.
만약 여러분들의 사이트에 계정관리 패스워드 자동 입격 기능이나 자동 su change 기능을 사용하고 있다면
pnp_telnet 데몬은 사용자의 매번의 접속에 대하여 pnp_account_manager의 TCP 31115 포트로 특정 계정의 패스워드를 질의하여 패스워드를 가져오고, 가져온 패스워드를 사용자 대신 Target_Server에서 입력하여 자동으로 로그인을 성공시키게 개발되어 있습니다.
그런데 만약 해당 사이트에서는 본 기능을 사용하지 않으면 불필요하게 매번 TCP 31115 포트의 통신이 발생되고, 응답이 없으니 매우 느리게 되는 것 아닌가? 라는 의문을 품을 수도 있겠네요.
이에 pnp_telnet 장비는 최초 접속 세션에서는 바로 31115포트로 통신을 시도하지만 해당 통신이 실패한 후 1분이내에는 다시 질의를 하지 않도록 하여 영향을 최소화 했습니다.
이와 같이 개발된 이유는 DBSAFER에 추가적인 기능(SA, IM, 각종 연동, 이중화 등)이 생기면서 현장 엔지니어들이 옵션을 통해서 사이트마다 다른 환경을 설정하기 어려운 불편과 실수를 최소화 하기 위해 심사숙고 끝에...
가급적이면 옵션을 추가하지 않고 자동으로 그러나 과부하는 주지 않는 상태에서 사이트 환경에 따라 유연한 동작을 지원하고자함에 있습니다.  1분 이후에 다시 추가하는 동작은 일시적인 장애에 의하여 본 기능이 영원히 꺼지는 것도 추가적인 장애이기 때문에 디자인 된 것이구요. 아무튼 원래는 신경쓰지 않아도 되게끔 설계된 것인데, 특수 상황에서는 본 기능의 동작 스텝을 모르면 고생할 수도 있을 것 같습니다.  이번 삼성SDI의 경우가 우려되는 상황이였구요.
[주의 사항]
> 위와 같은 특징이 있으니 앞으로 동작에 대한 혼선이 없었으면 하고,
> pnp_account_manager를 통한 TCP 31115 포트 통신을 사용하지 않더라도 방화벽에서 차단하지 않도록 조치가 필요합니다.
> 만약 TCP 31115포트 통신이 막히게 되면 pnp_telnet에서 체킇크한하는 TCP 31115 포트로의 통신이 hang이 걸리면서 30~60초 동안의 추가 hang 증상이 최대 1분에 1회씩 발생되게 됩니다.  (혹시 오래된 DBSAFERv3을 패치한 후에 이러한 증상이 새로 추가되었다면 pnp_telnet의 패스워드 자동 접속 기능 관련 동작이 방화벽에서 차단된 것일 수 있습니다. 해당 증상은 발생 직후 1분 동안은 재현이 안되고, 다시 1분이 지난 후에 증상이 나오니 혼선이 있을 수 있습니다.)
[관련 코드 - 참고]
위 코드를 알아 보실 수 있을까요? 위와 같이 pnp_telnet 서버는 ""// 2. 서버 접속"" 의 동작에서 TCP 31115 포트로의 접속을 시도하고 해당 접속이 실패할 경우, 접속을 다시 시도하더라도 1분 동안은 장애가 있었던 포트로의 접속은 다시 시도하지 않고 있다가, 최종 접속 시도를 한 시간을 계산하여 해당 시간의 1분 이후에 다시 TCP 31115포트에 접속을 시도합니다.  해당 기능은 사이트에 따라 중간에 패치되어 쓸 수도 있고, 일시적인 네트워크 장애에 대하여 한번 실패했다고 계속 해당 기능을 끄고 있으면 이도 추가 장애 요인이 될 수 있기 때문에 1분 마다 상태를 체크하게 되었습니다.
[추가 조치 사항]
> to 연구소: 만약 위와 같은 상황의 실수가 빈번하다면 해당 기능을 .conf/pnp_telnet.conf에서 끌 수 있는 옵션을 넣어 주세요. 기본은 활성화이고, 1분마다 자동 체크하는 트래픽과 방화벽등의 간섭 조차도 싫다고 하면 아예 해당 트래픽이 계속 나오지 않게 할 수 있을 것 같습니다.  (그냥 두셔도 되는데 검토해 보세요)
> to 기술본부: 위에 기술된 내용들을 숙독하시고 혹시 본인이 관리하는 사이트나 신규 구축 사이트에서 유사 증상이 있는지 확인하여 문제가 있다면 방화벽 정책에 DBSAFER_GW --> DBSAFER_LOG_TCP_31115 통신 허용을 넣어 주셔야 깔끔하게 동작을 하게 됩니다.
> 참고: 본 기능 2015년에 추가된 기능입니다.
*****************************************************","진선태: 혹시 **** 사이트에서 30초 느린 접속도 이와 관련된 것 아닌지?
DBSAFER/NODESAFER 에서 GW --> LOG 로의 TCP 31115 포트 통신 방화벽에 차단되지 않는지 확인 바랍니다. | 김태윤: 현재는 pnp_account_sync 가 아닌 pnp_account_manager 에서 관리하고 있습니다.
pnp_account_manager는 계정관리 관련 모듈로 서버에 계정에 대한 생성, 추가, 삭제 및 계정에 대한 비밀번호를 관리하는 모듈입니다. 참고하시기 바랍니다. | 진선태: 감사합니다. pnp_account_manager 맞습니다. | 박재현: 벅스를 보니 옵션으로 처리가 되어 관련 링크를 공유합니다.
https://bugs.pnpsecure.com/view.php?id=22881",https://cafe.naver.com/pnpsecure2/3776
3743,데이터마스킹 객체 수와 서비스 메모리 관계,"사내에서 정책에 적용된 데이터마스킹 객체별 서비스 메모리 관계성 테스트 결과입니다.
""본 테스트는 worst case 테스트로 패턴 마스킹의 각 패턴이 모두 다르다는 전제입니다.""
[중요 포인트]
데이터마스킹 객체는 정규식 객체일 경우에만 메모리 소모가 많습니다.
정규식을 컴파일해서 메모리에 적재하기 때문입니다.
""member.jumin"" 같은 테이블/컬럼 데이터마스킹 객체는 수가 많이 적용 되어도 메모리 소모가 크지 않습니다.
하지만 ""[0-9]{7}"" 같은 정규식 데이터마스킹 객체는 컴파일 하여 메모리에 적재하므로 메모리 소모가 발생합니다.
메모리를 고려할 필요성이 있다면 아래의 방안으로 정책 설정을 하면 일부분 서비스 메모리가 감소될 것 입니다.
[효율적인 메모리 할당을 위한 정책 설정 방법]
""패턴"" 보다는 ""테이블/컬럼""으로 등록한다.
""테이블/컬럼:패턴"" 형식으로 객체 등록 시에 패턴은 최대한 동일한 패컨을 등록한다.
""테이블.컬럼:패턴"" 형식 보다는 컬럼:패턴으로 정책 적용하여 중복을 최대한 줄인다.
[테스트 결과]
데이터 마스킹 객체 - 컬럼::패턴(모두 다른 컬럼 + 20개의 패턴 반복 조합으로 생성)
쿼리 - select * from member where rownum < 10;
StressTester2 로 10세션 설정 후 부하 시, 결과
메모리(부하 시) 그래프
초당 쿼리 수
CPU 사용률
이상입니다.","진선태: 개선 후와 전의 차이가 크지 않은데요? 더 개선해야 하는 건가요? | 여성구: 실제로 개선 전/후가 매우 미미합니다. 현재 구조적 제약으로 볼 수 있습니다. 연구소에 장기적이라도 개선점을 요구하겠습니다.
또한 조금 더 줄여서 사용을 할 수 있도록 설정 가능한 정책 설정적인 방안을 생각해보겠습니다.
Ex.) 동일한 패턴 마스킹에 대한 처리 같은 것에 대한 방안 | 채널지원: 켭쳐화면이 보이지 않습니다. .확인 부탁드립니다.",https://cafe.naver.com/pnpsecure2/3743
3735,"[TIP] 연동모듈 로그 이중화 구성 시, DBL02 영향도","1. 구성
- DBL01 - DBL02 -DBG 01 - DBG 02
2. 현상
- DBL02의 dbsafer_policylinkage.sh run 동작 시, 운영 GW1, GW2 에 DBL02 정책을 SYNC 함
ㄴ 결과적으로 standby 서버가 운영 GW에 영향도 발생
ㄴ 단, dbsafer_policyslinkage 프로세스에서 연동되는 로직에선 duplex 상태를 체크
2. 주의사항
- 동일한 정책 포탈 DB를 싱크 할 경우 문제는 없을 수 있지만 DBL02 서버의 정책과 DBL01 운영 서버의 정책이 동일하지 않을 경우 정책운영에 영향이 생김
ㄴ ex. 사용자 차단 등
3. 개선필요사항
- dbsafer_policylinkage.sh run 기능 시 duplex 상태 체크 필요라고 판단",댓글 없음,https://cafe.naver.com/pnpsecure2/3735
3734,[TIP] 로그 이관 백그라운드에서 진행 방법,"[상황] 서버교체 후 대용량 로그 이관 시
[명령어]
1. nohup scp -P 7795 -r root@ip주소:/이관 파일 경로 > nohup.out 2>&1
2. 암호입력
3.ctrl+z
4.bg
* -r 옵션은 하위 폴더 까지 이동
* 로그 이관 후 폴더,파일 소유자 권한 확인 바랍니다.
* 한번에 전체 로그 이관시 cpu사용을 과 점유 할 수 있으니 주의 요망",댓글 없음,https://cafe.naver.com/pnpsecure2/3734
3733,[TIP] duplex 의 failover -> normal / normal -> failover 시의 사용자의 접속 상태 정보,"duplex 에서 failover -> normal 로 상태 변경 되거나 반대로  normal -> failover 가 되는 경우 사용자의 접속 상태에 대한 정보를 공유합니다.
PC Assist 의 로그인 상태
- 접속 상태 유지
사용자의 서비스 로그인 상태
- 접속 상태 유지
"" failover -> normal / normal -> failover"" 의 변경은 DB 접속 정보가 active -> standby 로 전가 된다는 것을 의미 합니다.
유저의 세션을 유지하는 채널과는 다른 부분이기 때문에 연결 정보의 변경이 유저 서비스 관리와는 별개로 동작됩니다.
단, 상기 조건은 pnp_policysync 를 통해서 dbsafer_ldap_list가 동기화 되었다는 전제 조건입니다.
만약 dbsafer_ldap_list 의 동기화 없이 restore 가 될 경우 PC Assist 가 로그아웃이 되고 따라서 서비스도 접속 종료가 됩니다.
[원인 - dbsafer_ldap_list 동기화 안할 경우]
dbsafer_ldap_list의 login 필드 정보가 ok 가 아니기 때문에 pnp_oms_dms 에서 잘 못된 로그인 상태로 파악하고 로그아웃 시그널을 전달하게 됩니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/3733
3688,Centos7.6에서 too many files open 에러발생 현상,"[환경] Centos7.6 , mariadb 10.2.23
[증상]
[ERROR] Error in accept: Too many open files"" 에러가 출력되면서 Pc Agent 접속이 안되거나 DBSAFER DB 접속이 안됨.
[원인]
DB에서 Open File limit 수 를 초과하여 파일을 열었을 경우 발생
[조치]
1. OS 계정별로 열수있는 파일 개수 확인 및 수정 - vi /etc/security/limits.conf
적용방법은
<domain> <type> <item> <value>로 추가 입력해주면 됩니다.
상세설명
domain : 제한할 대상작성 (*, user명, 그룹명을 줄 수 있다.(그룹에 적용할 경우 @가 붙는다))
type : 강하게 제한할 것인지, 어느정도 여유를 줄 것인지를 결정
soft : soft로 설정한 용량을 넘어가면 '경고' 메시지를 남김
hard : 어떠한 일이 있어도 hard를 넘을 수 없다는 의미
item : 제한할 항목으로 core, data seg, file size등 여러가지가 존재.
nproc : 최대 프로세스의 갯수(KB)
stack : 최대 스택 사이즈(KB)
nofile : 한번에 열 수 있는 최대 파일 수
core : core파일의 사이즈(KB)
value : 제한 하고자 하는 설정값
2. 설정값 확인
ulimit -a
-aH 또는 -aS 옵션 사용시 Hard 설정값과 Soft 설정값에 대한 확인가능
현재 DBSAFER rpm 설치 시 65534로 설정 된게 확인됨.
3. mariadb 접속 후 open file limits 개수 확인
# ps -ef | grep mysql  --> PID 체크후 lsof -p | wc -l 로 현재 mysql이 열고있는 파일 개수 체크
4332 > 2192 이므로 오류 발생하지않음 하지만 과다 조회시 DB가 교착상태에 빠질 위험이 있으므로 file open limit 값을 최대로 수정
# 현재 4332 의 값을 vi /etc/my.cnf
max connetion 옵션 아래에 다음 구문 추가
open-files-limit=64000
# service mysql restart
# ps -ef | grep mysql 프로세스 시간 체크
# DB 접속 후 show variables like 'file_open_limit'; 64000 변경 된값 확인.","진선태: [ERROR] Error in accept: Too many open files 나올 정도이면, MariaDB의 문제가 아니라 특정 프로세스의 오동작으로 인한 파일 열기 또는 통신 대기 상태가 있었을 것입니다. 제한 값을 조정하는 것에 국한하지 말고 원초적인 문제의 원인을 찾아야 될 것 같습니다. 흔한 예로는 통신을 하고 제대로 닫지 않고 둥 떠 있는 경우도 FD 1개를 점유하게 되는데, 예전에도 이런 유사 버그가 있었고, Too many open files라는 메시지가 나온적이 있습니다.
가능하다면 ""lsof"" 와 ""netstat -anp"" 값을 공유해 주시기 바랍니다. 해당 자료에서 과반을 차지하는 FD(통신 또는 파일 입출력 ID)를 쉽게 확인할 수 있을 것 입니다. | 진선태: 확인후 답변 주시면 고맙겠습니다. ^^ | 김주혁: 확인후 답변드리겠습니다. | 공유민: 좋은정보 감사합니다
- 64000은 좀 많아서 32000정도로 설정하고 모니터링 해볼게요
: 프로세스 오동작 되는 모듈을 확인하고, 증가 되면 공유드리겠습니다

- 위 예시로 명령어를 치면 아래 와 같습니다 <<<< 명령어 잘 모르는 분들 참고용
(pid:17589는 본인의 고객사에서 mysql PID검색(ps -ef | grep mysql)하시고 넣으세욤

명령어 예시 : ""lsof -p 17589 | wc -l""

[기타]
* lsof 는 list open files 의 약자로 시스템에서 열린 파일 목록을 알려주고 사용하는 프로세스
* wc 옵션은(word count) 사용자가 지정한 파일의 행, 단어, 문자수를 세는 프로그램

즉 프로세스가 열린 목록의 파일 총수량을 알려주는것입니다(TMI...)",https://cafe.naver.com/pnpsecure2/3688
3673,"GW 서비스에서 축약로깅 사용 시, 제약사항","GW 서비스에서 축약로깅을 사용할 경우, 제약사항에 대해 공유합니다.
1. 기능제약사항 (저장 부분 제외)
현재, 특별히 축약로그를 사용하였다고 하여, 동작에 제약되는 사항을 없습니다.
다만, 로깅이 안되어서 일부 기능을 사용하지 못하는 경우가 있을 것으로 보입니다.
2. 로깅 제약사항
위의 내용에 따라 다음의 값들이 저장되지 않고 있습니다.
세션
사설IP (private_ip)
2차 인증 정보 (manual_auth_id, manual_auth_name)
결제정보 (decide_type, decide_time, decide_mgr_id)
WAS서비스 여부 (필요 없는 것으로 보임, svc_type)
쿼리 갯수 (cmd_count)
운영모드 (operating_mode)
쿼리
rtn 길이 제약 (최대 5M로 제약됨, 커서처리 시, 동작되지 않을 수 있음.)
소요시간 (resp_time/resp_elapsed)
정책명 (policy_name)
2차인정정보 (manual_auth_id, manual_auth_name)
결제정보 (decide_type, decide_time, decide_mgr_id)
마스킹 예외정책 (decide_datamask_policy)
누적제어 정책 (accumulation_policy)
경고객체명 (alert)
전역권한정책명이 1개만 기록됨 (global_policy)
결과값스캔건수 (result_scan_count)
컬럼 상세 정보 (cinfo/columns테이블, pnp_log데몬의 parser_column설정시)
3. 컬럼비교
컬럼 비교 시 다음의 필드가 저장되지 않고 있습니다.
User 저장 시
private_ip varchar(16) COLLATE latin1_general_ci NOT NULL DEFAULT '',
manual_auth_id varchar(50) COLLATE latin1_general_ci NOT NULL DEFAULT '',
manual_auth_name varchar(50) COLLATE latin1_general_ci NOT NULL DEFAULT '',
operating_mode int(1) NOT NULL DEFAULT '0',
decide_type int(1) NOT NULL DEFAULT '0',
decide_time datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
decide_mgr_id varchar(32) COLLATE latin1_general_ci NOT NULL DEFAULT '',
svc_type int(11) NOT NULL DEFAULT '0',
cmd_count int(11) NOT NULL DEFAULT '0',
Query 저장 시
query_bind varchar(254) COLLATE latin1_general_ci NOT NULL DEFAULT '',
rtn mediumtext COLLATE latin1_general_ci NOT NULL,
rtn_filesaved int(1) NOT NULL DEFAULT '0',
resp_time datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
resp_elapsed int(11) NOT NULL DEFAULT '0',
policy_name varchar(64) COLLATE latin1_general_ci NOT NULL DEFAULT '',
manual_auth_id varchar(50) COLLATE latin1_general_ci NOT NULL DEFAULT '',
manual_auth_name varchar(50) COLLATE latin1_general_ci NOT NULL DEFAULT '',
decide_datamask_policy varchar(256) COLLATE latin1_general_ci NOT NULL DEFAULT '',
accumulation_policy varchar(256) COLLATE latin1_general_ci NOT NULL DEFAULT '',
alert varchar(64) COLLATE latin1_general_ci NOT NULL DEFAULT '',
decide_type int(1) NOT NULL DEFAULT '0',
decide_time datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
decide_mgr_id varchar(32) COLLATE latin1_general_ci NOT NULL DEFAULT '',
global_policy varchar(1000) COLLATE latin1_general_ci NOT NULL DEFAULT '',
result_scan_count int(11) NOT NULL DEFAULT '0',
cinfo/columns 테이블에 대한 값들 지원안함
이상입니다.
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/3673
3671,[SAFERUAS]GOOGLE OTP 키 발급 페이지 공유,"[SAFERUAS]GOOGLE OTP 키 발급 페이지 공유
google OTP 키 발급 방법 2가지 : 메일 전송 / 별도 페이지
고객사 환경이 Mail서버 사용이 불가한 경우 ""별도 페이지""로 키를 발급 받는다.
SAFERUAS 버전 2.0.12.11 이상부터 지원
URL : https://[WAS_IP:PORT]/saferuas/google/key",댓글 없음,https://cafe.naver.com/pnpsecure2/3671
3658,로그 데몬 오류가 있다는 시스템 경고가 있습니다. 로그 유실은 없는건가요?,"[문의 사항]
아래와 같은 경고와 에러 관련 로그가 있는데 감사로그가 정상적으로 기록되고 있는 것인지?
[상황]
매니저 알람으로 로그 데몬의 오류가 발생되었다는 내용이 확인.
pnp_agent 파일 로그에서 아래와같은 내용 확인.
[2019-10-10 14:39:04] [2109] [MISC][INFO__000000000] Information message. : Recv Alert Data : [ERROR REPORT (1)]
EVENT TIME: 2019-10-10 13:39:03 ~ 2019-10-10 14:39:03
CODE: LOG_PROCESS_001
ERRMSG: 로그 데몬에서 에러가 발생하였습니다. 로그 데이터를 처리 할 수 없습니다. - 2019-10-10 14:39:04
src/alert/alert.cpp[alert_thread]:115
[답변]
로그데몬이 감사로그를 수신했지만 1분동안 감사로그가 DB에 입력되거나 파일에 기록되지 않는 경우 해당 경고가 발생될 수 있음.
상황에 따라 1분동안 로그가 메모리에만 적재되고 실제로 기록되지 않을 수 있음.
로그 데몬은 로그 유입이 많아지면 Busy mode로 전환되어 파일에 기록하기 시작.
파일로 전환되기 위해서는 아래 두 가지 조건 중 하나가 만족해야함
감사로그 5만건
합계 50MB의 로그 내용
즉, 1분동안 메모리에 누적되었는데, 해당 조건을 충족하지 못하면 파일 생성으로 넘어가지 않아 오류가 발생된것처럼 경고가 발생
[대응 방법]
pnp_agent 파일로그에 기록된 시간을 기준 전후 1분의 시간동안 감사로그가 있는지 확인",댓글 없음,https://cafe.naver.com/pnpsecure2/3658
3657,"[TIP] MySQL 사용자 구간 암호화 사용시, 데이터가 많은 테이블을 연속해서 조회했을 때 행걸리는 현상","MySQL 사용자 구간 암호화 사용시, 데이터가 많은 테이블을 연속해서 조회했을 때 행걸리는 현상
[환경]
- AWS MySQL RDS
- pnp_mysql
MYSQL Release version 3.0.3 for RelR19.05C-CentOS7
MAIN VERSION 3.7 (20150812)(Rev: v1667)
DBSAFER_COMMON VERSION: 378
ADDED OPTION STATUS: NONE
COMMON MAIN MODULE VERSION: 1.2.29
COMMON LIBRARY VERSION: 3075
COMMON POLICY MODULE VERSION: 1.2.19
COMMON AUDIT LOG MODULE VERSION: 1.1.02
COMMON FORMAL_QUERY MODULE VERSION: 1.1.0.1
COMMON CERTIFICATION MODULE VERSION: V3
COMMON 2FACTOR PROTOCOL : v2
MySQL PARSER MODULE VERSION(DBParser:MySQL): 1.0.3(3063:3063)
SQL SYNTAX PARSER MODULE VERSION: 1.3.3072
Pol/Log/Decide Build: POLICY-(105) LOG-(107) DECIDE-(8)
Service Session MAX: 13500 Session (Forks:30)(Sessions:450)
LastUpdate(compiled): May 23 2019
The latest update of the binary: May 23 2019
- 툴
HeidiSQL 10 버전에서 자주 재현되었습니다.
[현상]
데이터가 많은 테이블을 연속해서 조회했을 때, 툴에 행 발생.
패킷에서는 zer window를 Client 쪽에서 발생 시키고 있음.
[해결방법]
TDI 드라이버
ASSIST TDI 드라이버 V2.1.7.2 (2019.09.25) 이상 사용
[이유]
복호화할 데이터 부족으로 클라이언트에 데이터를 적게 전달했을 때 이후 수신된 데이터가 크게 오면서 발생
[참조]
벅스번호 : 0015617",댓글 없음,https://cafe.naver.com/pnpsecure2/3657
3593,[TIP] INLINE 구성 관련 교육 자료 입니다.,"INLINE 구성 관련 교육 자료 입니다.
[첨부 파일]
- 01.DBSAFER Test 문제.ppt : 동작방식 이해를 위한 Test 문제
- 02.INLINE 구성.pptx         : INLINE 구성 설정 방법
- 03.Bypass카드설치.pptx    : INLINE 구성 시 추가 장착되는 Bypass 카드에 대한 설치 방법
[업데이트 예정 사항]
- DBSAFER 동작 방식 설명 자료
- INLINE 설치 시 주의 사항 설명 자료",댓글 없음,https://cafe.naver.com/pnpsecure2/3593
3466,[DBSAFER]In-line 구성 시 광바이패스카드(10G) 드라이버 패치,"채널사 이슈 발생건을 정리하여 공유 드립니다.
카드 모델명 : PE2G2BPI35A-SD
증상 : Silicom 10G 광 바이패스 설치 후 FOD Control 기능은 정상
케이블 연결 후 반복적인 인터페이스 Up/Down 현상 발생 (Flapping)
조치사항 : 카드 공급사에서 제공한 별도 Intel 드라이버 설치 후 정상작동을 확인하였습니다.
드라이버 패키지 파일명  : ixgbe-5.6.1ms7.1.tar
설치 전 준비 사항 : kernel -devel 패키지가 설치되어 있어야 한다. (Customset 패키지 rpms 파일 사용)
설치명령어
rpm -qa | grep devel
tar xzvf ixgbe-5.6.1ms7.1.tar.gz
cd ixgbe-5.6.1ms7.1
cd src
make install
reboot
설치 전 / 후  버전 정보 확인 결과
[root@dbsafer src]# ethtool -i eth0driver: ixgbeversion: 4.2.1-kfirmware-version: 0x2b2c0001bus-info: 0000:04:00.0supports-statistics: yessupports-test: yessupports-eeprom-access: yessupports-register-dump: yessupports-priv-flags: no[root@dbsafer src]#
<pre class=""aLF-aPX-K0-aPE"" style=""user-select: text; font-family: 'Courier New', Courier, monospace, arial, sans-serif; margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; overflow-wrap: break-word;"">[root@dbsafer ~]# ethtool -i eth0driver: ixgbeversion: 5.6.1ms7.1firmware-version: 0x2b2c0001bus-info: 0000:04:00.0supports-statistics: yessupports-test: yessupports-eeprom-access: yessupports-register-dump: yessupports-priv-flags: yes[root@dbsafer ~]#</pre>
* 추후 패키지에는 해당 드라이버를 포함하여 배포 예정입니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/3466
3438,[TIP] 대량 서비스 등록시 설정사항(pnp_log_bridge),"[개요]
서비스 등록 시 pnp_ora와 같은 서비스 데몬은 pnp_log 데몬과 세션 연결을 통해 로그전달 루트를 확보한다.
그러나 pnp_log 데몬은 세션 연결을 맺을 수 있는 개수는 고정되어 있다.
현재 CentOS 에서 프로세스 1개당 연결을 맺을 수 있는 세션은 1024개 약 1000여개 이다.
그렇다면 산술적으로 서비스를 약 1000여개를 사용한다면 pnp_log 데몬으로 모든 연결을 받아 줄 수 없으므로
로그 유실이 발생 할 수 있는 가능성이 있다.
연구소에서는 해당 문제를 해결 하기 위해서 pnp_log_bridge 데몬을 개발하였다.
pnp_log_bridge 데몬은 서비스 데몬과 pnp_log 데몬의 연결 다리와 같다.
pnp_ora 와 pnp_log 데몬 사이에서 pnp_log_bridge가 pnp_log 데몬 대신 연결을 받아 준다.
기본설정은 이미 알고 있으므로 대량서비스 설정 시 고려사항을 소개한다.
[조치]
vi를 /dbsafer/.conf/pnp_log_bridege.conf을 열면 아래와 같은 설정을 볼 수 있다.
우리가 주목해야 하는 설정은 fork 와 ratio이다.
fork의 경우 pnp_log_bridge 데몬을 몇 개를 실행 할 것이냐는 의미이며
ratio의 경우 pnp_log_bridge 데몬이 pnp_log 데몬과 연결을 맺을 때 서비스 몇 개당 연결 1개를 사용 할 것이냐의 의미이다.
#vi /dbsafer/.conf/pnp_log_bridge.conf
# Process fork number.(No fork if 0 or 1)
# (default 4)
#fork = 4
# Ratio of client socket vs log socket.(default 5)
#ratio = 5
예를 들어 서비스가 7000개 일 때, 아래와 같이 fork와 ratio의 값을 조정해 줍니다.
fork = 4 => 12
ratio => 16
""수정이 필요한 부분이 있을 경우 댓글 부탁드립니다.""",댓글 없음,https://cafe.naver.com/pnpsecure2/3438
3433,[TIP] WORM 파티션 FULL 발생 시 대응,"1. 개요
- 암호화 처리된 WORM 영역이 100% 사용중일 경우 대응 방법 소개
* worm 디스크 교체를 권장하나, 상황에 따라 포맷 후 재사용도 가능
2. 방법
1) worm 디스크 교체 권유
- worm 디스크를 unmount 하고, 하드디스크를 별도 봉인 보관 처리
* 디스크 교체 비용은 고객 및 영업부서와 협의
2) 교체 불가 시, 별도 공간에 백업
- 복호화권한 설정 후, 백업 수행
[Enterprise Manager 접속] > [관리자] > [암호화 로그파일 권한 설정] > [추가] > 접속IP, 계정, 명령어 설정
* 비워둘 경우 any 정책으로 허용됨
* 정책 적용여부 확인
=> cp 를 통해 /home/dbsafer/worm/[백업파일] [백업경로] 시, 파일 크기가 동일한지 확인.
3) worm 디스크 마운트포인트 확인
- 명령어를 통해 확인하거나, 설치 당시 설정값을 통해 확인
# lsblk
=> /dev/sdc1 에 /home/dbsafer/worm 이 위치함
- encrypt worm 설치 시 설정 정보를 자동 기록하므로, 패키지 경로에서 확인 가능
# cat .../[encrypt_worm]/config.mk
-
=> 설치 당시 정보가 기록되며, 위 자료 기준으로 worm 파티션은 '/dev/sdc1' 에 해당
4) worm 디스크 unmount
- 설치된 SWADE 패키지의 setup.sh 스크립트 실행
* 패키지가 없을 경우, 커널 버전 확인 후 동일 버전으로 활용 (커널 버전 확인 : #uname -a)
[Advanced...] > [Manage DATA & WORM] > [Unmount WORM] > [YES] 선택
=> 메시지 및 언마운트 여부 확인 (#df -h)
5) worm 포맷 및 마운트
- '3)' 에서 확인한 마운트 포인트로 포맷 및 마운트
* config.mk 파일 기준으로 자동 완성됨
* config.mk 파일은 최초 설치시 생성됨
[Advanced...] > [Manage DATA & WORM] > [Format&Mount WORM] > [YES] > [마운트위치 지정] > [암호키 입력] > 완료
6) 확인
# df -h
3. 백업 데이터 수동 생성
- 원하는 기간의 데이터를 worm 영역으로 수동 백업 가능
# cd /dbsafer;
# ./pnp_checkintegrity updatehash [YYYY-MM-DD] [YYYY-MM-DD]
ex) ./pnp_checkintegrity updatehash 2019-07-01 2019-07-31
=> 2019.05.01 부터 2019.07.31 까지의 hash 백업",정우성: ./setup 파일의 버전이 Rev 34 이하일 경우 에러 메시지가 발생할 수 있습니다. 해당 작업을 할 때 Rev 35 버전을 사용하는 것이 좋습니다.,https://cafe.naver.com/pnpsecure2/3433
3397,UTF8 환경에서 DB 명령어 선결재 시 정책 동작 오류,"UTF8 환경에서 선결재 명령어 정책이 수행되지 않는 버그에 대한 현상 및 확인사항에 대한 공유 입니다.
마지막에는 정형쿼리 및 DB 명령어 선결재 객체의 정책 비교 방식에 대해서 아주 간략하게 설명하였습니다.
[문제 환경]
DBMS 및 Decide Web을 UTF8 버전으로 설치
[문제 현상]
사용자 기안요청으로 UTF8 문자가 포함된 쿼리를 기안요청.
기안 승인되어 선결재 객체에 UTF8 문자가 포함된 쿼리가 DB 명령어 선결재 객체에 등록됨.
DB 명령어 권한 정책에 선결재 정책이 있지만 동작하지 않음.
매니저 DB 명령어 선결재 객체에서 한줄보기는 글짜 깨짐없이 잘 보임
DB 명령어 선결재 객체를 더블클릭하여 상세보기 시, 정형화 쿼리 부분에 UTF8 문자가 ??? 로 변경되어 글자 깨짐현상 확인
[확인 사항]
매니저에서 보이는 DB 명령어 선결재 객체에서 어느부분은 정상, 어느 부분은 글짜깨짐 현상이 보임.
기안 요청할때 명령어가 정상적으로 보였는지 확인.
정상
decide3 데몬이 decide web 에서 기안요청 처리시 확인할 임시 문서 정보에 명령어 기록 시, 글자 깨짐현상 확인
decide_log_YYYY_MM.tmp_doc_DD 테이블에서 확인 가능
정상
decide3 데몬은 명령어에 대해서 문자열이 아닌 Byte값으로 그대로 입력하기 때문에 글자 깨짐여부와 관계없음
기안 요청이 완료되어 decide web에서 정형화된 쿼리 및 해시값 입력이 잘 되었는지 확인
dbsafer3.decide_db_auth
decide web에서 정형화 쿼리 입력 시 글자깨짐현상 확인
평문 쿼리
update TH01C_DEPT  set DEPT_NM='品质经营', DEPT_NM_KOR='품질경영' WHERE dept='C21401' and corp='KCC(China)'
정형화 쿼리
updateth01c_deptsetdept_nm='品???',dept_nm_kor='품질경영'wheredept='c21401'andcorp='kcc(china)'
[조치 사항]
decide web에서 DB 명령어 기안요청 처리 시, 쿼리 정형화 입력 시, Latin1으로 처리되는지 확인 요청
[정형쿼리 및 DB 명령어 선결재 객체의 명령어 구문 비교 방식의 이해]
객체 (정형쿼리 또는 DB 명령어 선결재) 의 정형화 명령어 및 해시값 기록
평문 쿼리 정형화
정형화된 쿼리에서 해시값 추출
서비스 데몬에서 쿼리 수신 시, 쿼리를 정형화 후 해시값 추출하여 해시값을 기존 객체의 해시값과 비교
이러한 이유로 정형화 버전을 sync가 중요. (서비스 데몬, 매니저, decide web)","김가희: 결재시스템: 수정 필요
DECIDE 언어 설정이 KO 일 경우 기본 인코딩이 EUC-KR 로 고정이 되어있어서, 명령어 정형화 처리 시 데이터 깨짐
버전: 3.3.15.0 Build-706 이하 버전에서 발생 (처리 예정)

Manager: 권한 선결재 객체 깨짐 현상 수정 필요",https://cafe.naver.com/pnpsecure2/3397
3396,2TB가 넘는 파티션에서 Centos7 설치 할때 발생하는 문제,"환경
1.BIOS 모드로 부팅
2.1.2TB*4장의 디스크 장착된 서버(DELL R740)
3.Centos7 설치
문제 발생 : Centos 7 설치 중 파티션 잡을때 biosboot 유형의 파티션을 생성하라는 메세지 발생
원인 : Centos 설치시 할당된 파티션(sda)이 2TB이상일때 GPT 유형의 디스크 레이블이 필요. 2TB 미만일 경우 영향 X
문제 해결
- 파티션 생성시 biosboot 영역을 제일 처음에 생성후 /boot 파티션 할당.
ex) /sda1 biosboot /sda2 /boot
순서가 변경될시 위와같은 메세지가 나타날수있습니다. 자세한 정황 및 BIOS, UEFI 모드에 대한 설명은 추가하여 올리도록하겠습니다.","공유민: 어서 올려주세요
기다리고 있습니다 :)",https://cafe.naver.com/pnpsecure2/3396
3392,[DBSAFER][FAQ]pnp_log모듈에서 로그를 txt파일을 쌓을때 축약버젼과 일반버젼의 txt 폼에 차이가 있을까??,"안녕하세요
공유민입니다
고객사에서 여러 솔류션의 로그에 대해서 통합(로그)연동을 하는경우 dbsafer로그를 수집해서 가져가는데요
보통 1) DB연동, 2) pnp_log모듈이 txt로 떨군 파일을 수집하는 방식이 있습니다
1) DB연동은 우리쪽에서 뷰테이블을 만들어서 전달하면됩니다
하지만
2) pnp_log모듈에서 txt로 수집하는경우
로그축약버전과 일반로그버전에 대해 로그가 저장시킨 TXT폼이 다른가? 하는 의문에 대한 답변입니다
""결론적으로는 차이가 없습니다""
(왜? 차이가 없는지에 대해서는 추후 확인해서 덧글로 작성해 놓겠습니다)
감사합니다
질의내용 :
로그 축약 버젼 사용시 로그를 txt파일로 떨구도록 pnp_log.conf 에서 설정이 가능한걸로 알고있는데
축약버젼과 일반버젼의 txt 폼에 차이가 있을까???
답변 : 차이 없음",댓글 없음,https://cafe.naver.com/pnpsecure2/3392
3369,[TIP] DBSAFER 에서 접속 Tool 명을 인식하는 다양한 방법,"DBSAFER 에서 지원을 하는 접속 Tool 명을 인식하는 방법에 대해서 가이드를 합니다.
Fakeapp Finder
PC Assist 에서 실행 파일에 대한 hash 값을 생성 후에 hash 값을 접속 packet 내에 삽입하여 service 데몬과 통신을 하게 되면 service 데몬에서 pnp_fakeapp_finder 모듈과 통신해서 어플리케이션명을 인식합니다.
어플리케이션에 대한 hash 값이 매니저에 등록이 되어 있어야한다.
서버에서 pnp_fakeapp_finder 가 가동이 되어 있어야 한다.
제약사항
pnp_fakeapp_finder 사용 시에 hash 등록되지 않은 접속에 대한 어플리케이션이 제어 되지 않음
수정 요청 진행 중
java 실행 파일의 경우 실제 파일에 대해서 찾아서 직접 등록을 해야함
주석 인식 (카카오뱅크 사용)
접속 tools 에서 접속 시에 인식이 가능한 정보를 주석으로 입력을 하게되면 service 데몬에서 해당 값을 인식해서 접속 정보를 인식을 할 수 있다.
식별 쿼리 : /***<cert_user_info><ip:103.24<wbr />3.200.238><id:techusr@pnpsecur<wbr />e.com><app:tadpole>*/  select * from dual
제약사항
최초 접속 이후에 사용자 정보가 포함된 query 가 올 때까지는 사용자 정보를 이식 할 수가 없음
접속 tool 개발자의 역량에 따른 차이가 발생됨
사용자 식별
PC Assist 에서 사용자 식별을 사용을 할 때 접속 시에 접속 정보를 포함해서 service 데몬에게 전달이 된다.
사용자 식별 사용 시에 어플리케이션 정보를 포함할지는  pnp_oms_dms.conf 의 ""NAT_IDENTITY_EXTEND_TYPE"" 을 설정하여야 한다.
# 사용자 식별 정보에 추가할 정보 종류<br /># Example : 없음(0), DBMS 프로그램명(1), TERMINAL 프로그램명(2), FTP 프로그램명(4), DBMS 프로그램 해시(8), TERMINAL 프로그램 해시(16), FTP 프로그램 해시(32)<br /># Default : 0<br />#NAT_IDENTITY_EXTEND_TYPE = 0
어플리케이션 패턴 매칭
접속 Tool 마다 DB 접속 시에 전송하는 query 가 다르게 된다. Tool 의 초반 약 3초 이내에 입력이 되는 접속 Query  를 매칭하여서 접속 Tool 을 확인하는 방법이다.
""dbms_pattern_config.conf"" 에서 설정을 한다.
parent 을 지정을 하고 self 로 input 되는 query의 순서를 지정하는 방식으로 사용한다.
[MSSQL]<br />parent=1<br />self=11<br />pattern=select @@spid<br />appname=SQL 쿼리 분석기<br />[MSSQL]<br />parent=1<br />self=21<br />pattern=SELECT ISNULL(SUSER_SNAME(), SUSER_NAME())<br />appname=SQL 쿼리 분석기
제약사항
접속 Query 가 input 되기 이전에 tool 제어가 되지 않는다.
packet 내의 정보 확인
접속 packet 내의 포함된 접속 tool 정보를 확인한다.
제약사항
모든 DB 의 접속 Tool  에서 접속 Tool 정보를 가지고 있는 것이 아님
DBSAFER 에서는 접속 Tool 정보를 인식하는 방법이 많이 있습니다. 하지만 그 중에 일부만을 사용하기 때문에 기존의 사용하던 방법을 잊는 것 같습니다.
지원하는 방법을 알면 조금 더 편한 방법으로 고객사 대응이 가능할 것 같습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/3369
3362,userauth 에서 사용자 PC Assist로 접속을 하지 못합니다.,"userauth에서 PC Assist로 접속하지 못했을 때 발견할 수 있는 현상과 원인 그리고 대처 방법에 대해서 기술합니다.
[현상]
2factor OTP 인증창이 나타나지 않고, 수 초 후에 차단됨.
발생 로그 내용
userauth 모듈 버전마다 기록되는 로그 내용이 다를 수 있지만, Exception stack 내용을 동일합니다.
위 두 사진은 최근 사이트에서 전달받은 에러 내용입니다.
봐야할 부분은 ConnectionException 이라는 항목입니다.
말 그대로 접속에 문제가 발생했다는 것을 알 수 있습니다.
Connection Timeout이 발생할 수 도 있고 Connection Refused (연결 거부) 가 발생되는 것이 일반 적입니다.
[원인 및 대응 방법]
원인은 다양하게 존재할 수 있지만 일반적으로 TCP 네트워크의 SYN이 이루어지지 않는 상황들입니다.
PC Assist가 실행되고 있지않음.
이럴 가능 성은 거의 없지만 실행 여부 확인부터 시작입니다.
PC Assist가 실행되었지만 50015 TCP 포트 LISTEN하고 있지 않음.
콘솔에서 다음 명령어 수행
netstat -an | findstr 50015
oms_dms의 SSL TCP Port 수신 기능 설정 비활성화
옵션 내용
.conf/pnp_oms_dms.conf 에서 아래 옵션이 설정되어 있는지 확인
# 2-factor 인증을 위한 OpenSSL 통신 포트를 설정
# Example : 0(사용 안 함), OpenSSL 통신 포트
# Default : 0
#SSL_LISTEN_PORT = 50015
대응 방법
옵션이 비활성화 되어 있는 경우, 옵션 설정 후 oms_dms 재시작 및 PC Assist 재시작
SSL_LISTEN_PORT 활성화는 되어있지만, 모듈이 oms_dms 모듈이 재시작되지 않음.
파일 수정 시간과 모듈 실행 시간 비교
파일 수정 시간 확인
ll .conf/pnp_oms_dms.conf
oms_dms 모듈 실행 시간 확인
oms_dms 모듈 PID 확인
ll /proc/{PID}/exe
파일의 실행 시간 확인
대응 방법
파일 수정 시간이 모듈 실행 시간보다 이후일 경우, oms_dms 재시작 및 PC Assist 재시작
사용자 PC에서 PC Assist 가 50015 TCP 포트 바인드 실패
50015 TCP 포트는 Client Socket에서 사용할 수 있는 대역으로, Bind 실패가 일어날 수 있음.
PC Assist 로그에서 오류 내용 확인 (담당자에게 문의)
대응 방법
PC Assist 재시작
포트 Listen은 하고 있지만 접속 안됨
PC 방화벽 차단 확인
사이트 방화벽 정책을 별도로 사용하는 경우 해당 담당자에가 확인 요청","여성구: 내용 추가합니다.

[발생 케이스]
1. msg tunnel 을 사용할 경우 2차 인증 통신이 전달되지 않을 수 있습니다.
- 개선 필요항목
2. DBSAFERIM 사용 시. AssistHost 에서 2차 인증 통신 전달 불가

[디버깅 방법]
tcpdump 로 통신 패킷을 확인하여 체크 하는 것이 정확합니다. | 정대한: 내용 추가합니다

[발생 케이스]
common 3139 이하의 서비스 데몬이 NAT 환경에서 실행 중일 경우 2차 인증이 동작하지 않습니다
(connection timeout 로그가 기록됨)
이슈가 발생한 환경이 NAT 환경인지 확인해주셔야 합니다.

[해결방법]
common 3139 이상의 서비스 데몬 사용
pnp_userauth v1.0.66 이상 사용
pnp_msg_tunnel rev25 이상 사용",https://cafe.naver.com/pnpsecure2/3362
3323,권한 제어 정책이 일부는 동작하는데 대부분 적용되지 않습니다.,"본 이슈는 신한은행에서 발생되었던 이슈로, 현재 (2019-06-13) 기준까지도 발생될 수 있는 이슈여서 공유합니다.
해당 문제는 매니저에서 객체명이 공백문자로 입력될 때 권한정책 및 결과값제어정책이 비정상 동작하는 이슈입니다.
매니저에서 객체명이 공백문자로 추가/수정 될 수 있고 이렇게 저장될 경우 문제가 발생합니다.
PROTOCOL_TIME과 무관하게 발생될 수 있어 주의가 필요합니다.
[이슈 내용]
접속 정책은 정상적으로 동작하지만, 권한제어 정책의 대부분이 제대로 동작하지 않음. 어떤 정책은 동작함.
[엔지니어 조치사항]
사이트 모든 정책 및 매니저 로그를 사내 테스트 서버 구축 및 분석 환경 제공
[분석 진행]
서버 패키지가 오래된 버전 (PROTOCOL_TIME=20111227) 으로 정책 배포에 있어서 문제가 의심되는 상황.
agent 데몬이 서비스 데몬으로 동기화하는 정책에서 특이사항 검사.
-> 권한 제어 정책에 설정하지 않은 정형쿼리 객체 설정이 포함되어 전달 됨.
-> 권한 제어 정책 테이블 (policy_db_auth) 에 정형쿼리 부분은 기록되지 않음.
-> agent데몬에서 권한 정책 테이블에서 정책을 조회할 때, 정형쿼리를 포함시켜서 조회.
-> 정책에 포함된 정형쿼리 확인결과 정형쿼리 객체명이 존재하지 않음.-> 매니저 객체 수정이력에 해당 정형쿼리 객체명이 제거되어 수정된 이력 확인
-> 매니저에서 정형쿼리 객체 수정 시, 객체명에 ""공백문자"" 만 포함되어 저장됨.
-> MySQL에서는 빈문자열과 공백으로만 입력된 문자열 비교 시 같은것으로 인식함.
-> 이로인해 권한제어 정책, 결과값제어 정책에 정형쿼리 정책을 포함하지 않았지만, 정형쿼리 객체가 조건으로 모두 입력된것으로 인식됨.
[조치 사항]
사이트 정책 및 정형쿼리 객체 수정 요청
정형쿼리 객체 수정
공백문자로만 수정된 정형쿼리 객체명을 값을 입력하도록 수정
권한제어/결과값제어 정책에서 정형쿼리 관련된 부분 재설정
공백 정형쿼리 객체명을 수정할 경우, 정형쿼리를 설정하지 않은 모든 정책에 수정한 정형쿼리명이 입력됨.
이러한 정책을 각각 정형쿼리 미포함으로 저장 -> 원래 설정된 정형쿼리 설정 후 저장 하는 방식으로 모두 값 재설정
매니저 객체명 입력 시 공백 문자만 입력하는 경우 입력되지 않도록 기능 추가 요청
관련 벅스: 15182
[그 외 사이트 주의 사항]
매니저에서 객체명이 공백 문자만으로 입력될 수 있으며, 이럴 경우 정상적으로 저장까지 할 수 있음.
공백문자로만 이루어진 객체명이 있는 경우, 정책 검사 등에서 이상동작을 할 수 있어 주의 필요.",댓글 없음,https://cafe.naver.com/pnpsecure2/3323
3311,서비스에 도메인 주소를 입력하려하는데 매니저에서 IP입력만 가능합니다. 무슨 패치가 필요한가요?,"기존 IP v4 서비스만 제공하는 환경에서 도메인 지원으로 변경하고자 할 때 고려해야할 사항 정리.
세부 사항 및 QA에 확인하여, 패치 진행.
[문의 사항]
사이트에서 AWS 서비스를 DBSAFER를 통해서 접속하고 싶어함.
서비스에 도멘인을 입력해야하는데, IPv4 만 입력 가능한 상황.
어떤 부분에 대한 패치가 필요한지 문의.
[매니저의 도메인 입력 여부 확인 방법]
services 테이블의 destip 컬럼의 속성이 Varchar(255) 로 변경되어 있어야 도메인 입력이 가능한 형태로 변경됨.
(기존에는 해당 컬럼의 속성은Varchar(16))
[destip 컬럼 속성 변경은 누가하는가?]
agent 데몬이 해당 컬럼의 속성을 Varchar(255)로 변경함.
단, PROTOCOL_TIME이 20150812 이상에서만 해당 동작을 지원함.
[그 외 패치 사항]
서비스 데몬 전체
oms_dms
PC Assist
sshd
transparent
[관련 벅스]
https://bugs.pnpsecure.com/view.php?id=7445",댓글 없음,https://cafe.naver.com/pnpsecure2/3311
3294,쿼리 하나에 동일한 바인드 변수가 여러개 기록되어 있는데 정상인가요?,"[개요]
바인드 변수를 사용하는 변수 처리에 대한 Database에서 패킷 처리 전반적인 과정과 어떠한 방식으로 바인드 변수가 감사로그에 기록되는지를 이해한다.
[문의 사항]
질문 1:
insert member values (:1, :2); 쿼리는 한번만 실행되었는데, 매니저에서 해당 쿼리의 바인드값을 확인하면 다음과 같이 기록되어 있다.
:1 = 1
:1 = 2
:1 = 3
:1 = 4
:1 = 5
:2 = 'aaa'
:2 = 'bbb'
:2 = 'ccc'
:2 = 'ddd'
:2 = 'eee'
질문 2:
사용자는 해당 해당 쿼리를 배치 작업으로 한 번 실행했고, 데이터값만 바꿔서 입력했는데, ""insert member values (:1, :2) 쿼리가 하나가 아니라 여러개가 남아 있다. 해당 상황이 정상인지 알고 싶다.
[바인드 변수의 처리 과정]
DBMS 종류마다 세부적인 과정에는 차이가 있지만, 크게 보면 아래 2단계로 나눌 수 있다.
동작 1. 바인드 쿼리 원형을 서버로 전달하여, 해당 쿼리를 향후 통신과정에서 Client와 Server가 인식할 수 있는 Key를 만들어서 공유
동작 2. Key값을 이용해서 Client는 해당되는 쿼리에서 입력한 바인드 변수 :1, :2의  바인드값을 서버로 전달하여 쿼리 동작을 수행하게 한다.
[답변]
질문 1번은 insert member values (:1, :2) 쿼리를 Client 와 Server가 100번이라는 Key값으로 인식하도록 설정한다. 이후 Client, Server 통신에서 Key값 100번 쿼리를 사용하겠다하면 서로 이 쿼리가 ""insert member values (:1, :2)"" 임을 알 수 있다. 이렇기 때문에 동일한 쿼리에 바인드값만 바뀌는 경우 패킷상 실제 쿼리가 전달되지 않고, 이 Key 번호만으로 Client와 Server간 통신하게 된다.  이때 동작 2번이 반복적으로 수행되게 되기 때문에 DBSAFER입장에서는 신규 쿼리가 패킷상에 전달되지 않고 Key값 100번으로 바인드 쿼리가 실행되는것을 알기 때문에 해당 쿼리에 실행한 바인드정보를 매칭시켜서 입력하게 된다.
이러한 이유로 하나의 쿼리에 여러개의 바인드 변수가 입력되 보이게 된다.
질문 2번은 동작 Client나 Server쪽에서 Key값을 저장하고도 다른 쿼리들도 Key값을 만들어서 저장하게 된다. 따라서 Client나 Server에서는 Key값 정보를 무한정으로 늘려서 저장할 수 없게 된다. 이러한 이유에서 기존 100번 Key 값의 Cache 정보가 삭제되는 상황이 발생된다. 이렇게되면 Client는 다시 Server에 바인드 쿼리를 전송하여 새로운 Key값을 설정한다. 예를들어 ""insert member values (:1, :2)"" 쿼리를 다시 전송하고 Key값을 101로 새로 만드는 것이다.
이 과정이 진행되면 DBSAFER에서는 실제 쿼리를 확인할 수 있고 Key값이 바뀌었기 때문에 새로운 쿼리로 인식하여 명령어를 감사로그에 기록하게 된다. 이후 수행되는 바인드 값 기록에 대해서는 Key값 101번 쿼리로 기록되게 되는것이다.
이러한 이유로, 사용자 입장에서는 하나의 바인드 쿼리에 바인드 변수값만 바꿔서 배치를 작업했지만, 동일한 쿼리가 여러개 남을 수 도 있고, 하나의 바인드 쿼리에 같은 바인드 변수에 여러개의 바인드 값이 기록될 수 있다.
[바인드 변수 기록 테이블]
dbsafer_log_YYYY_MM.db_qbind_DD 테이블에 기록",댓글 없음,https://cafe.naver.com/pnpsecure2/3294
3273,/home/dbsafer/buffer/list 에 파일이 너무 많이 쌓입니다. 어떻게 조치해야하나요?,"[개요]
buffer/list 디렉토리에 생성되는 파일에 대해 이해하고, 과도하게 파일이 생성 될 경우 대응 방법에 대한 소개입니다. 기본적인 소개는 많이 쌓인 파일을 어떻게 처리할지에 대한 내용을 담고 있습니다. 하지만, 근본적으로 불필요하게 쌓이는 다량의 로그를 줄이기위한 고민이 선행되어야 합니다. 이보다 더 앞서서는 고객의 원하는 방향과 사이트 로그 사용을 분석해서 로그 기록을 줄일 수 있는 방향에 대해서도 고려가 되었으면 합니다.
[파일명의 이해]
파일명 구조
저장시간_순번.log[.standby][.was]
저장시간:
파일이 저장되는 시점의 시간으로 16진수 문자열로 변환되어 기록
순번:
여러 파일이 동시에 생성 시, 파일 이름 중복을 막기 위해 사용되는 순번.
저장 시간이 동일할때, 순번은 0부터 1씩 증가되어 기록되며 저장시간이 변경되면 0으로 초기화 되어 기록됨.
log:
실제 DB에 기록하는 pnp_log 데몬이 존재하는 서버 (단일서버, GW/LOG 분리환경에서 LOG서버) 에 생성되는 기본 확장자.
standby:
standby Log 서버에서 기록되었는지 여부
was:
WAS 저장 방식
[저장 내용]
감사로그 내용 중 결과값, 바인드 변수값과 같은 내용들이 기록.
[조치 사항]
사이트에서 문의해온 내용 질답형식으로 조치 사항에 대해서 기술하였습니다.
.log 파일을 옮긴 후, 이를 감사로그로 입력할 수 있는가?
입력 될 수 있다.
log 데몬에서 자동으로 처리될 수 있는 경우
buffer/list 디렉토리에 내가 옮긴 파일보다 이전에 생성된 파일들이 존재하는 경우
이 경우, 아직 내가 옮긴 파일이 처리 목록에 존재하여 자동 처리 가능
bufferwriter 이용
buffer/list에 파일이 없거나, 존재하는 파일이 내가 옮겼던 파일보다 나중에 생성된 파일만 존재하는 경우
이 경우, log 데몬은 해당 .log 파일에 대해서 이미처리를 시도하여 실패했기때문에 작업 목록에서 삭제함
이 경우. log 데몬의 파일로그에 오류 사항이 기록됨.
이 경우, bufferwriter를 이용해 감사로그로 입력해야함.
.log 파일은 어떤 대상을 이동해야하는가?
디렉토리 내 모든 파일을 한 번에 이동하면 안됨.
log 데몬에서 해당 파일을 기록하기 위해 처리 작업중일 수 있음.
최대 log 파일을 20개까지 한 번에 처리될 수 있기때문에 가장 오래된 40개 정도의 파일은 이동 금지
쓰기 기록이 완료된 파일에 대해서 최근 파일부터 이동.
파일 용량이 지속적으로 증가되는지 확인
파일 용량에 변화가 없는 최근 파일부터 이동
[LOG 파일의 처리 과정]
buffer 파일 처리 과장 참조
https://cafe.naver.com/pnpsecure2/3214",댓글 없음,https://cafe.naver.com/pnpsecure2/3273
3271,[TIP] DBSAFER 2.0 LOG DEMON CONSOLE 기능공유,"1. 내용
가. log 데몬에서 제공하는 제공하는 기능을 통해 현재 로그 데몬의 동작상태 확인
2. 방법
가. telnet localhost 3120 또는 3124
나. XX 입력 > 기능ON
다. 목적에 맞게 커맨드 입력
3. 로그트리
가. health를 입력하는 경우 생성되는 필드값 정의
[SESSION]
Db:0   => DBMS 세션 카운트
Ftp:0  => FTP 세션 카운트
Shell:1  => 터미널 세션 카운트
[NEW]
Db:0/0  => 최근 1초 동안 새로 생성된 DBMS 세션 수 / 최근 1초동안 실행된 쿼리 수
Ftp:0/0  => 최근 1초 동안 새로 생성된  FTP 세션 수  / 최근 1초동안 실행된 명령어 수
Shell:0/0  => 최근 1초 동안 새로 생성된 터미널 세션 수 / 최근 1초 동안 실행된 명령어 수
[LOG]
Busy:F  =>  로그 저장 모드 값 (T일 경우 Log 데몬이 바쁜 상태이므로 메모리 버퍼를 파일로 내림)
Urgency:0 => 세션과 같은 긴급 로그 데이터 수 (긴급 로그 큐 수) - 파일로 내려가지 않고 최우선적으로 처리되는 로그수
Cur:0  => 일반 모드에서 처리될 로그 데이터 수 (일반 로그 큐)
Next:0 => 다음 처리를 기다리고 있는 로그 데이터 수 (대기 큐)
Ext:0 => Busy모드가 T일 경우 신규 추가되는 로그 데이터수 (확장 데이터 큐)
Last:0 => 파일로 저장달 로그 데이터 수 (마지막 큐)
Files:0  => 로그가 저장된 파일 수
추가설명 : 로그 큐는 IO를 최대한 줄이고 병목을 줄이기 위한 다양한 큐로 설계되어 있음
단, 항상 DB에 Insert 되는 큐는 Urgency와 Cur 큐 (다른 큐는 파일 및 버퍼 역할)
[WLOG] => WAS 저장방식에서의 Queue 상태 (상위 일반 로그와 동일 )
Busy:F
Urgency:0
Cur:0
Next:0
Ext:0
Last:0
Files:0
[JOB]
TotalJob:0  => 현재 처리가 필요한 전체 로그 수
Added:0  => 최근 1초 동안 신규 추가 된 로그 수
Deleted:0  => 최근 1초 동안 처리된 로그 수
[DBPOOL]
USE:0  => 현재 사용하고 있는 MySQL 세션 수
Q:0 => POOL의 사이즈",댓글 없음,https://cafe.naver.com/pnpsecure2/3271
3241,[TIP][암호화] 사용자 - DBSAFER서버 서비스 구간 암호화 설정 방법,"[Enterprise Manager 설정]
1. 시스템 설정 - 추가 기능 설정 - 서비스 암호화 통신 사용 & 사용자 식별 전송 기능 사용 체크
2. 서비스 목록에서 암호화 통신을 사용하고자 하는 서비스 선택 및 암호화 통신 & 사용자 식별 사용 설정 (서비스 재시작 필요)
3. Terminal 접속하여 해당 서비스 프로세스를 확인, 끝에 'crypt'라는 문구로 암호화 통신 적용 확인
[oms_dms 모듈 설정]
1. pnp(dbsafer)_oms_dms.conf를 vi 편집기로 수정
> CRYPTO_USE = 1, NAT_IDENTITY_USE = 1 설정
2. pnp(dbsafer)_oms_dms 모듈 재시작
> 3.1.x.x 버전 이상의 PC Assist에서 사용자-DBSAFER 서비스 구간 암호화 지원 가능
> 3.2.x.x 버전에서는 PC Assist 로그인, 서비스 리스트 송신 시 SSL 통신 암호화 기능이 추가 포함
(https://cafe.naver.com/pnpsecure2/2641 의 답글 내용 참고)
[서비스 암호화 전]
- 아래와 같이 서비스 패킷이 암호화되지 않고 Query가 평문으로 전송
[서비스 암호화 후]
- 아래와 같이 서비스 패킷이 암호화되어 Query 확인 불가
* 사용자 - DBSAFER - 대상 서버 간 암호화도 가능하나 대상 서버에 Server Agent 설치 필수
(SA 라이선스와 별도로 암호화 라이선스 구매 여부도 확인 필요)","채널지원: 작성 내용 중 정정하실 부분이 있습니다.

2. pnp(dbsafer)_oms_dms 모듈 재시작 (DBSAFER Assist 3.2.X.X 이상의 버전 필요)
=> 3.1.x.x 버전에서도 사용자-DBSAFER 서비스 구간 암호화 지원 가능 합니다.
=> 3.2.x.x 버전에서는 PC Agent 로그인, 서비스 리스트 송신 시 SSL 통신 암호화 기능이 추가 포함되어 있습니다.

(https://cafe.naver.com/pnpsecure2/2641 의 답글 내용 참고) | 정창원: 상세한 의견 감사드립니다. 본문에 반영 하였습니다.",https://cafe.naver.com/pnpsecure2/3241
3233,mssql_account_finder가 계정을 찾지 못합니다.,"본 글은, mssql_account_finder의 동작 방식을 설명하고, 해당 동작이 하지 않을 때 확인해야할 사항을 기술하였습니다.
[동작방식]
mssql 서비스 데몬이 mssql_account_finder 모듈로 접속계정, 어플리케이션명 수집을 요청
서비스데몬은 MSSQL로 접속한 client IP, PORT 정보 등을 mssql_account_finder로 전달
mssql_account_finder는 mssql 데몬이 접속한 서버에 접속하여 세션저보를 확인
세션정보에서 mssql 데몬의 CLIENT IP, PORT가 일치한 세션 정보가 있으면, 이 세션의 접속계정 어플리케이션명을 획득
획득된 정보를 mssql 서비스 데몬으로 전송
[오류 상황 점검]
mssql_account_finder 모듈 실행 확인
매니저에서 MSSQL 접속계정 테스트가 정상적으로 동작하는 확인
접속 오류 발생 시, mssql_account_finder 데몬 로그에 오류 사항 있는지 확인
agent 데몬이 mssql_account_finder 모듈로 접속 테스트 요청이 잘 전달 되는지 확인
mssql_account_finder port: TCP 3142
ID/Password 재설정 하여, 저장 후 테스트 (주의 요망)
테스트에서 정상 확인하고 저장하지 않고 운영하여 문제가 발생하는 경우가 많음.
LOG/GW 분리 구성이면서 GW가 2대 이상인 경우 agent 버전 확인
agent 데몬 Rev 903 미만에서는 GW 한대에만 갱신 신호를 전달하는 버그 있음.
agent 데몬이 Rev 903 미만인 경우 그 이상 버전으로 패치 필요.
mssql 서비스 데몬이 mssql_account_finder로 접속 확인 요청 패킷을 전송하는지 확인
mssql_account_finder port: TCP 3142
mssql_account_finder 데몬 로그 오류 또는 경고 로그 확인
DBSAFER NIC에 2개 이상의 IP 설정이 되어 있는지 확인
MSSQL에서 조회하는 Client IP의 기본값은 .conf/service_ip.conf 의 IP값을 사용
DBSAFER 서버의 IP가 2개 이상일 때, MSSQL 서버로 접속하는 Client IP가 설정값과 다를 수 있음.
DBSAFER 서버에서 MSSQL로 접속하는 IP가 어떤것을 쓰는지 확인
.conf/service_ip.conf 설정값과 다른 IP를 사용하여 mssql 데몬이 MSSQL 서버로 접속할 경우
.conf/mssql_account_finder.properties 설정파일의 LocalIp 설정값에 접속 가능한 모든 IP기록
예) LocalIp=192.168.3.100,10.1.1.99
권고사항
MSSQL 접속 하는 IP에 추가로 항상 .conf/service_ip.conf IP값은 같이 기록
위와같이 설정하면, MSSQL 접속하여 세션 정보를 찾을 때, 해당 IP에 대해서는 모두 조회 함.
MSSQL 서버와 DBSAFER 서버가 망분리가 되어, DBSAFER 서버의 IP를 인식하지 못하는지
망분리 환경에서는 MSSQL 서버가 DBSAFER를 Public IP로만 인식하여, 정확히 DBSAFER의 IP를 인식하지 못함
.conf/mssql_account_finder.properties 설정파일의 LocalIp 설정값에 public IP를 포함하여, 접속할 수 있는 모든 IP를 기록
주의사항
위와같이 해도, Client IP가 변경되는 경우에는 접속 세션을 찾을 수 없음.
확인 방법
DBSAFER를 통해 MSSQL로 접속한 클라이언트 IP, PORT 확인
mssql_account_finder 데몬 로그에서 확인 가능
해당 PORT 정보로 접속된 이력이 MSSQL 서버에 기록된 세션 정보가 있는지 확인
조회 쿼리
SELECT
sessions.login_name, sessions.program_name,
connections.client_net_address, connections.client_tcp_port
FROM
sys.dm_exec_connections connections,
sys.dm_exec_sessions sessions
WHERE
connections.session_id = sessions.session_id;
client_tcp_port 의 값이 일치하는 세션이 존재하는지, 존재하면, 해당 세션이 실제 DBSAFER에서 접속한 세션인지 확인
만약, 이렇게 조회했을 때 동일한 Port값이 없다면, mssql_account_finder는 세션 정보를 찾을 수 없음.",댓글 없음,https://cafe.naver.com/pnpsecure2/3233
3232,"감사로그에서 정형쿼리 등록 시, 이미 등록되어있다고 하는데, 정형쿼리 정책이 동작안합니다.","본 글은, 정형쿼리 정책이 적용되지 않았을 때 확인해야할 사항에 대해 정리한 글입니다. 그 동안 오류 사항이 많이 모두 기록되지는 않았지만, 정형쿼리가 어떻게 등록되며, 정책 검사시 어떠한 방식으로 비교되는지를 이해하여 동일한 문제 발생 시 어떠한 부분을 점검해봐야하는지를 아는 것에 목적이 있습니다.
[정형쿼리 등록 및 비교 과정의 이해]
정형쿼리의 등록
정형쿼리는 매니저에서 등록
수동으로 쿼리를 입력
감사로그에 기록된 로그를 정형쿼리로 등록
정형쿼리 객체 등록 시, 정형화를 통해 쿼리를 축약
축약하는 방식에 따라, 정형쿼리 버전이 달라짐.
따라서, 반드시 매니저와 서비스 데몬간의 정형쿼리 버전을 일치시켜야함.
축약된 정형쿼리를 매니저에서 Hash값을 계산하여 Database에 입력
정형쿼리 정책 비교
서비스 데몬은 사용자 쿼리를 쿼리축약하여, Hash값을 생성
매니저에서 입력된 정형쿼리 중 동일한 Hash값이 있는지를 검사
[정형쿼리 버전 확인]
반드시 매니저와 서비스 데몬의 정형쿼리 모듈 버전이 일치해야함.
매니저
시스템 설정 > 기본 동작 설정 > 정형화 모듈 버전
서비스 데몬
# ./pnp_ora --version
...
COMMON FORMAL_QUERY MODULE VERSION: 1.1.0.1
[문제 원인 접근 방법]
적용되길 기대되는 정책에서 정형쿼리 외 다른 조건들이 부합하는지 비교
보안계정, 서비스 등등
너무 당연하지만, 실제 감사로그에 기록된 내용과 정책이 맞지 않는 경우도 많음.
정형쿼리에 유효기간이 설정되어 경과했는지 확인
운영 시 거의 설정하지 않는 기능이지만, 일부 이를 사용하는 경우가 있음.
또한 매니저 상에서는 보이지 않지만, 실제 정형쿼리 테이블에서 만료된 경우도 있음.
정책에 객체로 설정한 경우
dbsafer3.formal_query 테이블에 activate, expire 컬럼이 유효한지 확인
정책에 그룹으로 설정한 경우
dbsafer3.formal_query_group 테이블에 activate, expire 컬럼이 유효한지 확인
또한 정형쿼리 객체의 유효시가도 추가로 확인
정형쿼리로 동작할 것으로 예상되는 쿼리를 감사로그에서 정형쿼리 등록
이때 그룹 지정에 주의할 것.
감사로그에서 정형쿼리 등록 시, 그룹 선택 후, ""선택된 객체에 그룹 추가"" 버튼을 눌러 객체가 어떤 그룹에 속할것이지 지정해줘야함.
이렇게 등록했을 때, 중복이 발생하지 않았는지 확인
중복된 정형쿼리가 있는 경우, Hash값이 일치하는지 확인
매니저 버그로 시스템 설정의 정황화 모듈 버전이 1.1.0.1로 보이지만, 실제로는 1.0.0.3 으로 동작하는 버그가 있었음.
4500 이하의 버전이라면 해당 사항에 대해서 버전체크 문의
만약 매니저쪽 버그가 있는 경우라면 매니저 패치 후, 모든 정형쿼리에 대한 Hash값을 갱신할 것
정형쿼리 객체에 정형쿼리 전체값 갱신 버튼이 있음.
정형쿼리 그룹으로 정책을 적용해 놓은 경우
agent 버전 Rev. 925 이하이면서 서비스 데몬이 PROTOCOL_TIME 20121201이상이면서 COMMON LIBRARY VERSION: 2664 이상을 사용할 경우 문제가 발생될 수 있음.
증상
어떤 정형쿼리는 잘 동작하지만, 어떤 정형쿼리는 동작하지 않음.
원인
정형쿼리 그룹 조회 시, 순서가 정렬되지 않아, 조회 시, 다른 그룹이 조회 될 경우 이전 조회 그룹 내용이 초기화 됨.
해결방법
agent Rev 926 이상으로 패치
실제 쿼리와 정형쿼리에 등록된 쿼리가 동일한지 확인
매니저 버그로 감사로그에서 직접 정형쿼리 등록 시, 장문의 쿼리의 경우, 쿼리가 누락되어 기록되는 버그 있었음.
해당 내용에 대해서는 매니저팀에 문의
사용자가 동일한 쿼리를 수행하지만, 쿼리내용이 달라지는지 확인
postgresql 서비스의 PDA라는 DBMS에서 해당 오류사항 발생
해결방법
postgresql 서비스 데몬 패치
COMMON LIBRARY VERSION: 3003 이상으로 패치",댓글 없음,https://cafe.naver.com/pnpsecure2/3232
3216,"매니저에서 서비스 실행을 했는데, starting 상태로 되고 실행이 되지 않습니다.","본 글은 서비스 실행 시 동작 방식에 대해 이해하고 서비스 실행이 정상적으로 되지 않았을 때 확인 해야 할 사항에 대해서 정리한 글입니다.
[서비스 실행 동작 방식]
매니저 서비스 실행 시, agent 서비스 실행 요청
agent는 실행 서비스 명령어를 조합
lucher에게 명령어 전달하여 수행
단독 구성일 경우, agent가 직접 launcher 에 실행 명령어 전달하여 실행.
LOG, GW 분리 구성일 경우, agent->slave-> launcher 순으로 전달하여 실행
[서비스 실행 오류 시 확인 사항]
서비스 데몬, agent, slave 데몬의 PROTOCOL_TIME 이 동일한지 확인
agent 데몬 로그에 오류 내용 확인
The service will be restarted. 오류 내용 시, 실행 시도까지는 잘 됐지만, 어떠한 문제로 오류 발생되어 실패 됨.
분리 구성이라면, slave 전달이 잘 되었는지, launcher까지 전달이 되었는지, 서비스 자체 실행에 문제가 없는지 확인 필요.
LOG, GW 분리 구성 시, slave 데몬 로그 확인
Execute service ... {서비스 실행 명령어} 와 같은 로그가 정상적으로 기록되어 있는지 확인
ex) ./pnp_postgresql --sync--drop-default-thread mr 3 .........
서비스 실행 명령어가 기록되어 있다면, 서비스 실행 자체의 문제가 있다는 의미
lancher에서 오류 사항 확인, 서비스 데몬 오류 사항 확인
서비스 데몬 오류 사항 확인
Failed to bind a socket.
이미 서버에 동일한 포트가 사용 중에 있어서 발생하고 있는 문제
netstat 를 통한 사용 중인 포트 확인하여, 왜 해당 포트가 사용중인가 원인 분석 필요.
원인 분석이 완료되면, 포트를 선점하는 포로세스를 종료하여, 서비스가 정상 동작할 수 있도록 조치
서비스 데몬 파일이 존재하는지 확인
실제로 파일이 없는 경우도 있음.
데몬 로그상의 실행 명령어의 파일이 존재하는지 확인
오래된 패키지는 mssql_2000이 필요하지만 mssql 데몬으로 패치하는것과 같은 경우 발생될 수 있음.",댓글 없음,https://cafe.naver.com/pnpsecure2/3216
3214,bulk insert 동작과정 설명 및 log 데몬 재시작 시 주의 사항,"log 데몬을 수동 재시작하였지만 .dmp 파일이 남아 있고 이 파일은 별도의 입력이 되지 않는 다는 문의 사항을 접수하였습니다. 이에 bulk insert 동작 방식을 설명하고 왜 log 데몬 재시작 시 어떤 점을 주의 해야하는지를 설명하는 글입니다.
[log 데몬 종료 시 주의 사항]
bulk 파일이 존재하지 않을 때 확인
파일 확인 경로
./logfiles/
/tmp/
log 데몬 설정파일의 bulk_file_path 옵션에 따라 달라질 수 있음.
[bulk 파일 저장 및 입력 시 과정]
로그양이 많아 Database에 직접 입력 부하가 발생되는 경우 bulk insert mode로 전환됨
logfiles 경로의 파일에 입력할 테이블 데이터 내용이 기록 됨.
logfiles에 데이터 정보가 담긴 파일이 있으면 bulk insert를 할 수 있는 .dmp 파일로 변환.
dmp 파일 생성 경로는 기본 값은 /tmp이 {prefix}_log.conf 설정파일의 bulk_file_path 설정값에 따라 위치 변경 가능
.dmp 파일을 bulk insert 쿼리를 이용하여 데이터 입력
[.dmp 파일의 특징]
Database에서 인식할 수 있는 타입으로 기록됨.
해당 파일에는 DBSAFER에서 인식할 수 있는 별도의 Header 정보가 존재하지 않음.
따라서, 다음과 같은 이유로 log데몬이 bulk insert 중에는 log데몬을 수동 정지하면 안됨.
며칠에 기록된 로그인지를 정확히 알 수 없어 log 데몬을 재시작하여도 입력하는 기능을 제공할 수 없음.
해당 dmp 파일이 어떠한 테이블에 입력해야하는지 알 수 없음.
[.dmp 파일의 종류]
파일명으로 저장할 테이블 종류를 구분
bind_bulk*.dmp
DBMS 바인드 데이터
대상 테이블: db_qbind_{DD}
bulk*.dmp
DBMS 쿼리 관련 데이터
대상 테이블: db_query_{DD}
wbulk*.dmp
WAS 저장 방식의 DBMS 쿼리 관련 데이터
대상 테이블: was_query_{DD}_{HH}
bind_wbulk*.dmp
WAS 저장 방식의 바인드 Hash값 데이터
대상 테이블: was_hash_bind_{DD}
[.dmp 파일의 수동 입력 방법]
주의 사항:
쿼리 관련 bulk 파일을 우선 복원한 후 bind 관련 파일을 복원
정확한 날짜를 아는 경우만 복원 대상 테이블에 직접 복원
정확한 날짜를 알 수 없다면, 복원 대상과 동일한 사본 테이블을 만들어서 복원 후, 데이터를 확인하여 원본 테이블에 입력
PROTOCOL_TIME에 따른 쿼리 추가 여부 확인
컬럼 순서 반드시 준수 할 것.
{ } 의 경우 값이 상황에 따라 변경될 수 있음을 의미하며, 사용 시, { }를 제거하여 상황에 맞는 내용으로 치환
bulk*.dmp 수동 입력 쿼리
LOAD DATA INFILE '{파일경로}' IGNORE INTO TABLE dbsafer_log_{YYYY}_{MM}.db_query_{DD}
(
u_index,c_index,c_time,r_time
20111116 <= PROTOCOL_TIME
,resp_time
,isformal,policy_no,policy_name,denied,alert,loglevel
20090929 <= PROTOCOL_TIME
,formal_hash,is_contraction
20111226 <= PROTOCOL_TIME
,manual_auth_id,manual_auth_name
20150812 <= PROTOCOL_TIME
,decide_datamask_policy,accumulation_policy
,elapsed
20111116 <= PROTOCOL_TIME
,resp_elapsed
,r_size,row_size
20100719 <= PROTOCOL_TIME
,result_scan_count
,query,rtn
,qry_count
,query_bind
,decide_type,decide_time,decide_mgr_id
,query_info
20100615 <= PROTOCOL_TIME
,global_policy
)
예)
PROTOCOL_TIME=20150812 인 경우
- 모든 컬럼 추가
예)
PROTOCOL_TIME=20111116 인 경우
- 아래 컬럼만 추가
,resp_time
,formal_hash,is_contraction
,resp_elapsed
,result_scan_count
,global_policy
bind_bulk*.dmp 수동 입력 쿼리
LOAD DATA INFILE '{파일경로}'
IGNORE INTO TABLE dbsafer_log_{YYYY}_{MM}.db_qbind_{DD}
(u_index,c_index,redundancy_order,b_idx,b_type,value)
wbulk*.dmp 수동 입력 쿼리
LOAD DATA INFILE '{파일경로}'
IGNORE INTO TABLE dbsafer_log_{YYYY}_{MM}.was_query_{DD}_{HH}
(
u_index,c_index,c_time,isformal,policy_no,denied,loglevel
20090929 <= PROTOCOL_TIME
,formal_hash,is_contraction
,elapsed,r_size,row_size
20100719 <= PROTOCOL_TIME
,result_scan_count
,hash_query,hash_fbind,hash_return
,qry_count,hash_bind
20100615 <= PROTOCOL_TIME
,global_policy
)
bind_wbulk*.dmp 수동 입력 쿼리
LOAD DATA INFILE '{파일경로}'
IGNORE INTO TABLE dbsafer_log_{YYYY}_{MM}.was_hash_bind_{DD}
(no,hash,bind)",김주성: 좋은 정보 감사합니다.,https://cafe.naver.com/pnpsecure2/3214
3196,사용자가 서비스 데몬을 사용하면 접속이 되지 않습니다.,"[개요]
본 글은, DBMS 기준으로 서비스 데몬을 이용한 NAT를 하였을 때, 접속 오류가 발생되는 상황에서 어떤 대처가 필요한지를 기술합니다. 본 내용은 이러한 상황을 모두 대응하는 메뉴얼은 아니지만, 적어도 어떤 부분에 대해서 사전 확인을 하면 문제를 빠르게 해결할 수 있는 방법에 대해 공유하고자 작성되었습니다.
[상황 예]
고객이 사이트 사용자들이 DBSAFER를 이용해 접속을 하는데, 접속이 되지 않는다. 무엇인 문제인지 문의한 상황.
[점검 사항]
점검 사항은 단계별로 확인을 하면는 소거법 방식입니다.
정책에 의한 차단인가?
감사로그에서 해당 사용자가 접근을 시도한 시점에 감사로그에 차단여부 확인
확인 사항
정책 차단일 경우, 해당 사용자의 정책이 맞게 설정되었는지 확인.
정책이 남지 않는다. DBSAFER의 해당 서비스 포트로 패킷이 들어오는가?
DBSAFER로 패킷이 들어오지 않고, 사용자가 직접 DB로 붙어서 문제가 발생한것은 아닌지 확인
PC Assist NAT 여부 및 정책 확인
고객이 DBSAFER를 거치지 않고, 직접 대성 서버로 접속해도 접속에 문제가 있는지 확인.
이 확인 방법은 고객사의 상황에 따라서, 확인이 불가능할 수 있음.
예) 사용자 대역에서 서버팜이 방화벽으로 막혀서 직접 접근 자체가 불가능
이 방법으로 확인하면, 가장 확실하게 DBSAFER의 문제인지 사용자 프로그램의 문제인지 확인 가능
일반적으로 사용자 프로그램에 문제가 없지만, 고객사에 직접 제작한 프로그램에서는 사용자 프로그램의 문제인 경우도 종종 발생되어 확인 필요.
대상 서비스의 데몬로그에서 오류 사항이 발생되었는지 확인
오류가 발생되어 서비스 데몬이 연결을 끊을 수 있음.
수집 정보
서비스 데몬 버전
반드시 --version에 나오는 전부 다 제공
사이트명
접속 시 문제가 발생 패킷
사이트 반출이 가능한지 확인
DBSAFER 기준 사용자 구간과 서버 구간 필요.
양쪽 구간 패킷 캡쳐 시, 반드시 동시간에 양쪽 구간 캡쳐할 것
서비스 데몬 설정 정보
사용자 식별 설정 여부
구간 암호화 설정 여부
어느 구간이 암호화 되어 있는것인지도 확인
사용자 식별 사용 시, DBSAFER <-> 서버 구간에서 NATIDENTITY 패킷이 있는지 확인
PC Assist에서 전송하는 사용자 식별 패킷은 서비스 데몬에서 제거되어 서버로 전송되서는 안됨.
만약, 이 패킷이 전송될 경우, 대상 서버는 알수 없는 패킷이기 때문에 연결을 끊을 수 있음.
수집정보
서비스 데몬 버전
사이트명
사용자 식별 패킷
패킷 캡쳐가 가장 좋지만 여건이 안될 경우, tcpdump로 hex값이 보이는 화면을 사진찍어서 전달해도 괜찮음.
사용자 식별 패킷이 서버로 전달이 안되었지만, 이후 client 패킷이 서버로 전달되지 않거나, Client구간의 평문패킷이 서버로 전달될 때 암호화 되는지 확인
DBSAFER<->서버 구간 암호화가 켜져 있는지 확인
이 경우는 정상적인 상황
사용자 <-> DBSAFER 구간 암호화가 켜져있는데, 사용자 식별 이후 client 패킷이 평문으로 전달되는지 확인
이 경우 서비스 데몬이 복호화를 시도하는데, 복호화 실패되어 패킷을 서버로 전달하지 않을 수 있음.
사용자 식별 패킷 이후 client 패킷이 평문으로 전달되는데, 패킷이 변조되어 서버로 전달
DBSAFER<->서버 구간 암호화 설정이 되지 않는 이상, 정상적인 상황이 아니다.
수집 정보
해당 서비스의 구간 암호화 설정
PC Assist 버전
PC Assist가 실행되는 OS 정보
해당 서비스 데몬의 버전",댓글 없음,https://cafe.naver.com/pnpsecure2/3196
3191,"모듈 실행 시, gateway_ip 설정이 없다며 실행이 되지 않습니다.","본 글은, 사이트에서 custom_policy 실행 시, gateway_ip 설정이 없다며 모듈 실행이 되지 않는 이유와 대응 방법 그리고 관련 모듈 및 문제 발생 기간에 대한 안내입니다.
[패치 모듈 실행 오류 발생]
duplex설정파일에 gateway_ip를 설정하지 않을 경우, 아래 패치한 파일 실행 시 문제가 발생할 수 있음.
항상 발생되지 않으며, 위 조건에 해당될 때에만 모듈 실행이 되지 않음.
[사이트 대응]
사이트 대응 방법
문제 모듈 재빌드 및 패치
패치 버전 정보
2019-02-13 이후 빌드 버전으로 패치
해당 모듈이 dbsafer_common Rev376 이상으로 빌드되어야함.
해당 버전 확인은 모듈에서 버전 정보 시 출력 (일부 모듈은 해당 기능 개발 되지 않아 요청상태)
빌드 시, QA 확인 필요.
[설정에 따른 실행 오류 발생 모듈 및 기간]
기간
2018-12-04 ~ 2019-02-13
문제 발생 가능성이 있는 모듈
해당 기간에 빌드된 duplex_config 파일을 참조된 모듈 목록입니다.
[코어엔진팀]
./dbsafer_sysmon/
./dbsafer_agent/
./dbsafer_log/
./dbsafer_slaver/
./dbsafer_duplex/
./dbsafer_decide_v3.0/
./dbsafer_service_v3.0/
(azure, 암호화 활성화된 mssql 서비스에만 해당됨)
[선행기술팀]
./dbsafer_ips_skylab/
./dbsafer_custom_policy/
./dbsafer_oms_dms/
./dbsafer_policysync/
[계정관리팀]
./webem/monitoring_manager_v1.<wbr />0/
./dbsafer_shell_tracer_v2.0/
[해당 기간에 문제 가능성이 있는 모듈이 제공된 사이트]
해당 사항에 대해서는 QA를 통에 기술지원 팀장으로 알림 메일이 전달되었습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/3191
3166,[backup3] 백업된 파일 내용 확인 기능 및 WORM 백업 테이블 내역,"[개요]
- 백업된 파일에 대해서, 실제 복원을 수행하지 않고, 해당 파일 정보를 출력하는 기능을 제공.
[기능 지원 버전 정보]
- backup3 모듈 Rev.196 이상에서 해당 기능 정상동작
[파일 다운로드]
- https://bbs.pnpsecure.com/showthread.php?tid=7578&pid=10900#pid10900
- 개발자 빌드 버전으로 사이트 정식 패치 시 반드시 QA 빌드 요청을 통해 해야합니다.
[WORM 영역의 백업 파일 확인 방법]
- backup3 모듈의 경로와 파일명이 정확히 일치해야함
DBSAFER3: /dbsafer3/dbsafer_backup3
DBSAFER5: /dbsafer/pnp_backup3
- 위와 같은 상황에서도 파일 내용 출력이 되지 않는 경우
매니저에서 backup3 파일명을 SWADE 권한에 등록하면 정상적으로 기능 동작
[WORM 백업 테이블 정보]
- Rev.166이상: dbsaferlog 데이터베이스 날짜에 해당되는 모든 테이블, 날짜명 표기가 아닌 테이블도 모두 포함
- Rev.165이하: dbsafer_log 데이터베이스의 하드코딩된 테이블만 백업
백업 대상 테이블 목록
db_user_{DD}
db_query_{DD}
db_qbind_{DD}
db_cinfo_{DD}
ftp_user_{DD}
ftp_cmd_{DD}
shell_user_{DD}
shell_cmd_{DD}
system_log_{DD}
was_user_{DD}
was_query_{DD}_{HH}
was_qrystat_{DD}_{HH}
was_rddc_bind_{DD}
was_hash_user_{DD}
was_hash_query_{DD}
was_hash_bind_{DD}
was_hash_return_{DD}
[실행 방법]
syntax: 모듈명 file {백업파일}
예) ./pnp_backup3 file backup/dbsafer_policy_dump.2019-03-04_17-29-39.be3
[화면 출력 예시]
[root@localhost dbsafer]# ./pnp_backup3 file backup/dbsafer_policy_dump.2019-03-04_17-29-39.be3
Check header...
Header infomatino...
File Version String  : DBSAFER BACKUP FILE v3.2
File Version Value   : 2
CheckSum             : c5d56cb0f96fc5e1375ee2439350375eeccd7270
Recorded Time        : 2019-03-04 17:29:39
Total Row            : 6857
Type String          : Policy
Type Value           : 5
Orginal Data Size    : 6875136
Target               : Policy
Using Encryption     : No
Extra Data Size      : 0
Calculate checksum...
[Database:dbsafer3][CharacterSet:latin1] Table List =======================
dbsafer3.aaaa                                               : 0
dbsafer3.accumulation_policy                                : 1
dbsafer3.accumulation_policy_history                        : 3
dbsafer3.accumulation_table                                 : 2
dbsafer3.accumulation_table_history                         : 5
dbsafer3.accumulation_usage                                 : 2
dbsafer3.additional_logdb                                   : 0
dbsafer3.agent_sync_level                                   : 0
dbsafer3.agent_sync_level_history                           : 0
dbsafer3.alert_group                                        : 2
dbsafer3.alert_group_history                                : 2
dbsafer3.alert_history                                      : 0
dbsafer3.alertgroup                                         : 4
dbsafer3.alertgroup_history                                 : 0
dbsafer3.auth_sequence                                      : 0
dbsafer3.auth_servergroup                                   : 0
dbsafer3.auth_servers                                       : 1
dbsafer3.auth_user_auth                                     : 4
dbsafer3.auth_users                                         : 4
dbsafer3.cert_group                                         : 1
dbsafer3.cert_group_history                                 : 1
dbsafer3.cert_history                                       : 26
dbsafer3.cert_link_mgr_id                                   : 0
dbsafer3.cert_note                                          : 0
dbsafer3.cert_notice                                        : 0
dbsafer3.cert_reason_foward                                 : 0
dbsafer3.check_integrity                                    : 0
dbsafer3.client_app                                         : 1
dbsafer3.client_app_group                                   : 0
dbsafer3.client_app_group_history                           : 1
dbsafer3.client_app_history                                 : 2
dbsafer3.client_cmd                                         : 2
dbsafer3.client_cmd_group                                   : 0
dbsafer3.client_cmd_group_history                           : 0
dbsafer3.client_cmd_history                                 : 2
dbsafer3.client_event                                       : 0
dbsafer3.client_event_group                                 : 0
dbsafer3.client_event_group_history                         : 0
dbsafer3.client_event_history                               : 0
dbsafer3.client_id                                          : 0
dbsafer3.client_id_group                                    : 0
dbsafer3.client_id_group_history                            : 0
dbsafer3.client_id_history                                  : 0
dbsafer3.client_ip                                          : 0
dbsafer3.client_ip_group                                    : 0
dbsafer3.client_ip_group_history                            : 0
dbsafer3.client_ip_history                                  : 0
dbsafer3.client_riskgrade                                   : 0
dbsafer3.client_riskgrade_group                             : 3
dbsafer3.client_riskgrade_group_history                     : 0
dbsafer3.client_riskgrade_history                           : 0
dbsafer3.clientgroup_app                                    : 0
dbsafer3.clientgroup_app_history                            : 0
dbsafer3.clientgroup_cert                                   : 1
dbsafer3.clientgroup_cert_history                           : 3
dbsafer3.clientgroup_cmd                                    : 0
dbsafer3.clientgroup_cmd_history                            : 0
dbsafer3.clientgroup_comname                                : 0
dbsafer3.clientgroup_comname_history                        : 0
dbsafer3.clientgroup_datamask                               : 7
dbsafer3.clientgroup_datamask_history                       : 0
dbsafer3.clientgroup_event                                  : 0
dbsafer3.clientgroup_event_history                          : 0
dbsafer3.clientgroup_formal_query                           : 4
dbsafer3.clientgroup_formal_query_history                   : 0
dbsafer3.clientgroup_id                                     : 0
dbsafer3.clientgroup_id_history                             : 0
dbsafer3.clientgroup_ip                                     : 0
dbsafer3.clientgroup_ip_acl                                 : 0
dbsafer3.clientgroup_ip_acl_history                         : 0
dbsafer3.clientgroup_ip_history                             : 0
dbsafer3.clientgroup_name                                   : 0
dbsafer3.clientgroup_name_history                           : 0
dbsafer3.clientgroup_riskgrade                              : 3
dbsafer3.clientgroup_riskgrade_history                      : 0
dbsafer3.clientgroup_sid                                    : 0
dbsafer3.clientgroup_table                                  : 30
dbsafer3.clientgroup_table_history                          : 0
dbsafer3.clientgroup_time                                   : 0
dbsafer3.clientgroup_time_history                           : 0
dbsafer3.conf_cert_kind                                     : 2
dbsafer3.conf_psr_work_code                                 : 4
dbsafer3.config_id_session_isolation                        : 1
dbsafer3.configuration                                      : 1
dbsafer3.connector_accounts                                 : 1
dbsafer3.connector_fake_accounts                            : 1
dbsafer3.datamask                                           : 7
dbsafer3.datamask_group                                     : 2
dbsafer3.datamask_group_history                             : 2
dbsafer3.datamask_history                                   : 9
dbsafer3.datamask_sample                                    : 13
dbsafer3.dbsafer_ldap_list                                  : 3
dbsafer3.dbsafer_ldap_list_history                          : 0
dbsafer3.dbsafer_ldap_list_ip_mac                           : 0
dbsafer3.decide_db_access                                   : 0
dbsafer3.decide_db_auth                                     : 0
dbsafer3.decide_db_datamask                                 : 0
dbsafer3.decide_group                                       : 0
dbsafer3.decide_group_history                               : 0
dbsafer3.decide_sh_access                                   : 0
dbsafer3.decide_sh_auth                                     : 2
dbsafer3.decide_sign                                        : 1
dbsafer3.decide_sign_list                                   : 2
dbsafer3.decidegroup                                        : 0
dbsafer3.decidegroup_history                                : 0
dbsafer3.formal_query                                       : 3
dbsafer3.formal_query_group                                 : 1
dbsafer3.formal_query_group_history                         : 1
dbsafer3.formal_query_history                               : 4
dbsafer3.integrated_mgmt                                    : 0
dbsafer3.log_index                                          : 0
dbsafer3.log_integrity                                      : 1759
dbsafer3.logout_times                                       : 0
dbsafer3.mail                                               : 0
dbsafer3.mail_alert                                         : 0
dbsafer3.mail_alert_err                                     : 0
dbsafer3.mail_alert_history                                 : 0
dbsafer3.mail_err                                           : 0
dbsafer3.mail_history                                       : 0
dbsafer3.manager_auth                                       : 32
dbsafer3.manager_cert_lock_reason                           : 7
dbsafer3.manager_ip_allow                                   : 1
dbsafer3.manager_log                                        : 3540
dbsafer3.manager_log_condition                              : 0
dbsafer3.manager_pw_period                                  : 4
dbsafer3.oms_access                                         : 19
dbsafer3.password_history                                   : 0
dbsafer3.policy_db_access                                   : 4
dbsafer3.policy_db_access_history                           : 18
dbsafer3.policy_db_acl                                      : 0
dbsafer3.policy_db_acl_history                              : 0
dbsafer3.policy_db_auth                                     : 14
dbsafer3.policy_db_auth_history                             : 191
dbsafer3.policy_db_global                                   : 1
dbsafer3.policy_db_global_history                           : 4
dbsafer3.policy_ftp_access                                  : 0
dbsafer3.policy_ftp_access_history                          : 0
dbsafer3.policy_ftp_acl                                     : 0
dbsafer3.policy_ftp_acl_history                             : 0
dbsafer3.policy_ftp_auth                                    : 1
dbsafer3.policy_ftp_auth_history                            : 1
dbsafer3.policy_server_event                                : 0
dbsafer3.policy_shell_access                                : 0
dbsafer3.policy_shell_access_history                        : 0
dbsafer3.policy_shell_acl                                   : 0
dbsafer3.policy_shell_acl_history                           : 0
dbsafer3.policy_shell_auth                                  : 1
dbsafer3.policy_shell_auth_history                          : 1
dbsafer3.policy_wevt_filter                                 : 0
dbsafer3.policy_wevt_filter_history                         : 0
dbsafer3.querytypes                                         : 40
dbsafer3.ref_application_hash                               : 0
dbsafer3.ref_application_template                           : 0
dbsafer3.ref_wevt_event                                     : 0
dbsafer3.ref_wevt_task                                      : 0
dbsafer3.reserved_service_port                              : 1
dbsafer3.secondary_auth                                     : 0
dbsafer3.server_conf_contents                               : 6
dbsafer3.server_overheat_alert_config                       : 0
dbsafer3.server_run_cmd                                     : 2
dbsafer3.service_account_info                               : 4
dbsafer3.service_dbms_alias_mgmt                            : 7
dbsafer3.service_schedule                                   : 0
dbsafer3.servicegroup                                       : 0
dbsafer3.servicegroup_items                                 : 0
dbsafer3.servicegroup_link                                  : 4
dbsafer3.servicegroup_link_history                          : 0
dbsafer3.servicegroup_was_link                              : 0
dbsafer3.servicegroup_was_link_history                      : 0
dbsafer3.servicegroups                                      : 3
dbsafer3.servicegroups_history                              : 3
dbsafer3.services                                           : 32
dbsafer3.services_acl                                       : 0
dbsafer3.services_acl_history                               : 0
dbsafer3.services_history                                   : 104
dbsafer3.services_status                                    : 0
dbsafer3.services_was                                       : 0
dbsafer3.services_was_group                                 : 0
dbsafer3.session_isolate                                    : 0
dbsafer3.sid                                                : 0
dbsafer3.sid_group                                          : 0
dbsafer3.sid_group_history                                  : 1
dbsafer3.sid_history                                        : 1
dbsafer3.sms_alert                                          : 0
dbsafer3.sms_alert_err                                      : 0
dbsafer3.sms_alert_history                                  : 0
dbsafer3.sql_free_pass                                      : 0
dbsafer3.svcmon_filter_config                               : 0
dbsafer3.svcmon_risk_config                                 : 0
dbsafer3.svcmon_risk_level                                  : 3
dbsafer3.sysinfo_log                                        : 0
dbsafer3.system_log                                         : 475
dbsafer3.table                                              : 26
dbsafer3.table_group                                        : 2
dbsafer3.table_group_history                                : 4
dbsafer3.table_history                                      : 56
dbsafer3.time                                               : 0
dbsafer3.time_group                                         : 0
dbsafer3.time_group_history                                 : 0
dbsafer3.time_history                                       : 0
dbsafer3.tool_default_sql                                   : 0
dbsafer3.tool_default_sql_list                              : 0
dbsafer3.variables                                          : 307
dbsafer3.variables2                                         : 1
[Database:dbsafer3][TableCount:204][RowCount:6857]
=================================================================
Total Database Count: 1
Total Table    Count: 204
Total Row      Count: 6857
TEST RESULT - OK
[root@localhost dbsafer]#","남신우: [고객지원팀 확인 결과]
난독화된 데이터를 잘못 백업하는 사례확인: 없음
DBSAFER의 경우 SWADE 적용시 백업모듈을 사용하여 백업이 진행되기때문에 난독화 이슈는 발생하지 않음
INFOSAFER의 경우 백업모듈이 DBSAFER 테이블이 아닌 INOFOSAFER 테이블을 백업해 주지 않기때문에 스크립트를 사용한 백업시 SWAED 정책설정에 주의필요

[적용고객사-list] : 고객지원팀 관리고객사
1. DBSAFERv5(12곳)
2. INFOSAFER(3곳)

[확인사항]
1. Backup3 데몬 버전 확인
- Rev.165 이하
: DBsafer dbms, ftp, telnet, sniff 감사로그 백업 지원
- Rev.166 이상
: DBsafer dbms, ftp, telnet, sniff 감사로그 백업지원 外
SA, decide, dms 로그 백업 지원
2. /home/dbsafer/worm 디렉토리 백업 파일 확인
- dbsafer_worm_dump.2019-03-27.",https://cafe.naver.com/pnpsecure2/3166
3162,[TIP][Ora] 특정 사용자 Oracle 서비스 로그 남지 않는 건의 사례 공유,"특정 사용자 Oracle 서비스 로그 남지 않는 건의 사례 공유드립니다.
- 증상 : 특정 사용자만 Oracle 서비스 로그 남지 않음
- 원인 : 해당 사용자 Oracle Client 암호화 사용으로 인한 로그 미로깅
- Query Tool 버전 : Orange 6.0 for ORACLE v6.0.1 Build 18
[암호화]
: 아래의 패킷은 Oracle Client 암호화를 사용하는 User의 패킷을 수집한 것 입니다.
스크린샷에서 확인할 수 있듯이 초기 접속 negotiation이후 바로 암호화 통신을 하는 것을 확인할 수 있습니다.
[비암호화]
: 아래의 패킷은 Oracle Client 암호화를 사용하지 않는 User의 패킷을 수집한 것 입니다.
스크린샷에서 확인할 수 있듯이 초기 접속 negotiation이후 통신에도 Query 등을 정상적으로 확인 가능합니다.
* Comment : Oracle Client 암호화를 사용하는 User는 접속 negotiation 이후 바로 암호화 통신을 하는 것으로 보입니다.
DBSAFER는 일반 평문 통신하는 구간에서 사용이 가능하므로 대응이 불가능합니다.
암호화 통신을 disable한 이후 DBSAFER 구간암호화 사용을 하는 방향으로 진행이 필요합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/3162
3126,"매니저에서 mssql 접속 계정 검사 시, protocol 오류 라고 나옵니다.","[동작 방식 이해]
매나저 -> agent데몬 (로그) -> mssql_account_finder (GW)
위와같은 순서로 동작 진행.
프로토콜 오류라고 나오는 경우 실제로 프로토콜 동작에 오류가 있거나 접속하자마자 mssql_account_finder가 접속을 종료하는 경우인지를 확인해봐야합니다.
[오류 확인 과정]
1. mssql_account_finder 모듈이 정상 동작하는지?
2. mssql_account_finder 모듈이 3142 TCP 포트를 외부로 나갈 수 있는 NIC에서 Listen 하고 있는지?
3. agent 데몬과 mssql_account_finder 데몬 구간에서 패킷은 정상적으로 오는지?
4. 패킷이 온다면, SYN 패킷 이후 mssql_account_finder 쪽에서 바로 FIN을 보내지는 않는지?
1~3번은 환경적인 문제로 확인을 해봐야합니다.
4번의 경우라면, mssql_account_finder 모듈이 허용하지 않은 IP로 접속되어 접속을 모듈에서 차단하는 경우입니다.
이런 상황이라면 mssql_account_finder이 접속 허용 IP가 잘 설정되었는지 확인이 필요합니다.
[mssql_account_finder의 접속 허용 IP 인식 방법]
1. loopback
2. .conf/{prefix}_agent_ip.conf 에 기록된 ip
3. duplex 설정파일(.conf/{prefix}_duplex.conf) 이 있는 경우, 해당 설정파일의 active, standby ip
4. .conf/mssql_account_finder.properties 파일의 AllowIp (대소문자 주의)에 설정된 ip
이렇게 모두 설정이 정상적으로 되어 있어도 인식이되지 않는다면, mssql_account_finder 모듈이 DBSAFER3 버전인지 DBSAFER5 버전인 AEGISWALL 버전인지 확인이 필요합니다.
mssql_account_finder 모듈은 빌드된 정보에 따라서 옵션을 읽을 때 {prefix}값이 설정되게 됩니다.
따라서, DBSAFER3 패키시지 설치된 환경에서 DBSAFER5 용 mssql_account_finder를 사용하게 될 경우, {prefix}_agent_ip.conf {prefix}_duplex.conf 의 설정파일 정보를 읽을 수 없게됩니다.
이렇게 설정정보를 제대로 읽지 못한다면, 허용 IP 목록을 제대로 알 수 없어, mssql_accout_finder는 알 수 없는 IP에서 접근한 Client를 차단하게 됩니다.
[대응 방법]
만약 사이트에서 패키지와 맞지 않는 mssql_account_finder의 빌드 모듈을 가져간 상황
1. mssql_account_finder.properties의 AllowIp 설정에 agent가 있는 LOG 서버의 IP를 추가
2. mssql_account_finder 모듈을 재시작
주의: 이중화 구성 시, active, standby IP를 읽을 수 없어 운영상 장애가 발생될 수 있어, 반드시 추가 패치가 필요.
이상입니다.","이정근: GW+LOG 구성일때
pnp_agent_ip.conf에
ip=127.0.0.1로 설정되어 있으므로

mssql_account_finder.properties
AllowIp=
필수 입력.

접속 허용 IP 설정 (AllowIp) 안할시 서버접속 검사 실패/접속계정, 어플리케이션 업데이트 실패

실패시 데몬 로그
May 03, 2019 11:06:37 AM com.pnpsecure.mssql_account_finder.Service isAllowedHost
WARNING: Socket connected from disallowed host : /192.168.101.234
May 03, 2019 11:06:38 AM com.pnpsecure.mssql_account_finder.Service isAllowedHost
WARNING: Socket connected from disallowed host : /192.168.101.234",https://cafe.naver.com/pnpsecure2/3126
3051,[TIP][메타연동]메타 데이터 연동관련 가이드입니다.,"1. 동작방식
- 메타연동모듈은 두 테이블 간의 데이터 동기화를지원합니다.
- 동기화된 데이터를 기반으로 DBSAFER 객체 동기화가 가능합니다.
*지원되는객체(데이터마스킹, 접속계정, 대결자)
*서비스 및 IP주소에 대해서는 추후 지원 예정에 있습니다.
- 동작 방식은 아래와 같습니다.
① 연동데이터 취득
② 연동데이터 동기화
③ 동기화데이터 취득
④ 객체동기화(생성/갱신/삭제)
2. 설정가이드
- 아래가이드는 데이터마스킹 객체 동기화를 기준으로 작성하였습니다.
- 연동 객체를 설정하지 않을 경우, 테이블 동기화만 진행됩니다.
- 기타필요하신 사항에 대해서는 설정파일 내 설명(주석) 참고 및추가 문의 주시기 바랍니다.
2.1. 연동테이블 설정(dbsafer_metasync_syncdb.properties)
[META_TABLE_001]       #META_TABLE_[%3d]로 연동 테이블 구분(식별 값) (ex)META_TABLE_001,META_TABLE_002 등
SOURCE_DRIVER      = [JDBC 드라이버 명]
SOURCE_URL            = [JDBC DB접속 URL]
SOURCE_USER          = [SOURCE DB 접속 계정]
SOURCE_PASSWD     = [SOURCE DB 접속 계정 패스워드 (암호화된 패스워드)]
SOURCE_ENCODING = [SOURCEENCODING]
SOURCE_DATABASE  = [SOURCEDB 명]
SOURCE_TABLE        =  [SOURCE TABLE 명]
SOURCE_WHERE    =  [SOURCE 데이터 조회시 조건 설정]
DBSAFER_DATABASE = [동기화 대상 DB 명]
DBSAFER_TABLE        = [동기화 대상 TABLE 명]
#아래 동기화 컬럼에 대해 설정, COLUMN_[%3d] 형식.(ex)  COLUMN_001
#NAME: 테이블 명, TYPE: 컬럼 타입, PK: 기본키여부, COMMENT: 컬럼 COMMENT
#NAME의 경우, SOURCE에 존재하는 컬럼이어야 함
#TYPE: 컬럼 타입,PK: 기본키 여부, COMMENT: 컬럼 COMMENT
COLUMN_001             = NAME:sno,            TYPE:VARCHAR(255),             PK:1,   COMMENT :test
2.2. 기본설정 및 객체 연동 설정(dbsafer_metasync.properties)
※기본 설정
SYNC_PERIOD               = [[동작주기 설정 (단위: 분)]]
※객체 연동 설정
※컬럼 설정 시, 예약어([[컬럼명]])를 사용하여 설정
DATAMASK_TARGET      = [[연동대상테이블 식별 값]] ※dbsafeR_metasyncc_syncdb.properties 내 존재하는 값을 설정 (ex)META_TABLE_001
DATAMASK_NAME          = [[컬럼명(마스킹 객체명)]]   ※필수 입력 값
DATAMASK_TYPE           =  [[컬럼명(마스킹 종류)]]      ※필수 입력 값. 0:정규식,1:컬럼명
DATAMASK_VALUE         = [[컬럼명(마스킹 값)]]      ※필수 입력 값. 0:정규식,1:컬럼명
DATAMASK_COMMENT  = [[컬럼명(마스킹 설명)]]
DATAMASK_ACTIVATE   = [[컬럼명(유효기간 시작)]]
DATAMASK_EXPIRE      = [[컬럼명(유효기간 종료)]]
DATAMASK_GROUP      = [[컬럼명(마스킹 그룹)]]
DATAMASK_EVENT       = [[컬럼명(이벤트 처리 사항)]]
DATAMASK_CUSTOM_[[COL]]_XXX =  특정 필드의 값을 변화하여 적용하고자 할때 설정
(ex) COL 필드의 값이 A1 일때 aaa 변환하고자 할 경우, DATAMASK_CUSTOM_COL_001=A1:aaa 로 입력함
3. 모듈 사용 방법
(1) cd /dbsafer
(2) ./dbsafer_metasync.shinstall_db    ※ 연동 테이블 설정을 참고하여 동기화 테이블이 생성 됨.
(3) ./dbsafer_metasync.sh start
4. 설정 파일 예시
4.1. 연동 테이블 설정(dbsafer_metasync_syncdb.properties)예시
SOURCE_DRIVER      =org.gjt.mm.mysql.Driver
SOURCE_URL            = jdbc:mysql://127.0.0.1:3306?useUnicode=true
SOURCE_USER         = safeusr
SOURCE_PASSWD     =feSiu2FiyMaOn2DiPNnojefb6VECq2F3TpBxCckYxEekxlA==
SOURCE_ENCODING = UTF-8
SOURCE_DATABASE = testdb
SOURCE_TABLE       = SAMPLE_USERS
SOURCE_WHERE     =  part='dev'
DBSAFER_DATABASE = psync
DBSAFER_TABLE       = test_meta
COLUMN_001             = NAME:name,      TYPE:VARCHAR(255),         PK:1,    COMMENT : 마스킹 객체명
COLUMN_002             = NAME:type,        TYPE:INT(11),                                    COMMENT: 사용자 명
COLUMN_003             = NAME:value,        TYPE:INT(11),                                  COMMENT : 마스킹 값
4.2.  기본 설정 및 객체 연동 설정(dbsafer_metasync.properties) 예시
SYNC_PERIOD                = 30
DATAMASK_TARGET       = META_TABLE_001
DATAMASK_NAME          = [[name]]
DATAMASK_TYPE           = [[type]]
DATAMASK_VALUE         = [[value]]
#DATAMASK_COMMENT =
#DATAMASK_ACTIVATE   =
#DATAMASK_EXPIRE      =
#DATAMASK_GROUP      =
DATAMASK_EVENT         = 7
#DATAMASK_CUSTOM_[[COL]]_XXX = A1:aaa",현승환: 좋은자료 감사합니다.,https://cafe.naver.com/pnpsecure2/3051
3050,[TIP] [duplex] 설정 파일 내 gateway_ip 추가 관련,"현재 최신 duplex 모듈(Rev.72 이후)에서는 설정값을 읽을 때 gateway_ip라는 항목을 읽습니다.
pnp_duplex에서 네트워크 에러 발생 시 정확히 네트워크 에러가 발생한 서버를 알기 위해
ping test를 진행할 IP를 지정하는 항목입니다.
Active/Standby가 아닌 다른 IP를 입력하면 되나,
구축 환경의 영향을 제일 적게 받도록 Gateway 서버의 IP를 지정하는 것이 일반적입니다.
최초에는 이 항목이 필수 입력 항목으로 지정되어 있었으나, 우리은행에서 duplex 모듈을 사용하는 타 모듈이 패치 도중 gateway_ip 항목이 지정되지 않아 duplex 모듈이 실행되지 않는 문제가 발생하여 다음과 같이 수정하였습니다.
(사진 첨부가 되지 않는 관계로 수정된 매뉴얼의 링크를 대신 올리겠습니다)
https://bbs.pnpsecure.com/showthread.php?tid=7174
1. gateway_ip 항목은 선택 옵션으로 변경되었습니다.
2. gateway_ip가 지정되지 않았을 경우,
자신의 IP(active면 active 서버의 IP, standby면 standby 서버의 IP)로 ping test를 하게 됩니다.
(다만, 이 경우 ping test가 올바르게 진행되지 않을 가능성이 있으므로 가급적이면 해당 항목은 직접 지정을 부탁드립니다)
duplex 모듈, 또는 이와 관련된 모듈의 패치 시 참고하시길 바랍니다.
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/3050
2988,[TIP] 정책 및 감사로그 백업 데이터 GW 서버에도 저장하는 방법,"기본적으로 dbsafer(pnp)_backup3 데몬은 DBSAFER LOG 서버에서만 가동하여 Manager 관리자 프로그램에서 백업 스케쥴로 일, 주, 월 주기로 정책과 로그를 백업하고 있습니다.
단독 구성으로 DBSAFER가 설치된 경우는 제외하고 LOG+GW / GW , LOG / GW 분리 구조에서 GW 서버에도 동일한 백업 데이터를 저장할 수 있어서 TIP 공유합니다.
LOG 서버에만 백업데이터를 저장하지 않고 GW 서버에도 동일한 백업데이터를 저장함으로 LOG 서버의 DISK 장애 발생 시, GW 서버에 저장된 백업데이터로 정책 및 감사로그를 복구할 수 있다는 장점을 가지고 있습니다.
[대상]
- LOG, GW서버 분리구성 (서버 2대 이상 구축된 사이트
(1) LOG+GW, GW 구성
(2) LOG , GW 분리 구성
- DBSAFER Manager의 백업 기능을 통해 정책 및 감사로그를 백업하고 있는 사이트
[환경구성]
- DBSAFER Manager > 백업 > 스케줄 > 스케줄 등록(일,주,월 주기 백업)
<사진, DBSAFER Manager 백업 스케쥴 등록>
[적용방법]
- LOG, GW서버에서 dbsafer(pnp)_backup3 데몬 구동
(1) DBSAFER V3.0
#cd /dbsafer3
#./dbsafer_backup start
(2) DBSAFER V5.0
#cd /dbsafer
#./pnp_backup start
[저장위치]
- LOG 서버 백업 데이터 저장 위치와 동일 ( /home/dbsafer/backup/ )
[유의사항]
- GW 서버에서 가동된 백업 데몬은 가동 시점과 매일 00:00 시간에 백업 스케쥴 정책을 수신 받음. (매니저에서 정책을 추가, 변경 등 수정사항에 대해서 GW 서버의 백업 데몬은 00:00 시에 적용 됨 OR 데몬 재시작 시,적용)
[복원방법 - GW 백업 데이터]
(1) GW 서버의 백업 데이터를 LOG서버 /home/dbsafer/backup 위치로 이동
(2) DBSAFER Manager > 백업 > 복원 > (이동시킨 백업 데이터 선택) 복원 버튼 클릭
[참고]
<사진, 백업 스케줄을 통해 LOG, GW 서버에 백업 데이터 생성 확인>
사이트에서 백업 데이터를 다른 스토리지에 저장하는 경우도 많지만, LOG 서버에서만 로컬 백업을 진행하고 있는 경우도 많습니다.
위의 TIP을 통해 LOG 서버의 DISK 장애 발생이나, 불의의 사고를 예방할 수 있다고 생각합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/2988
2946,[TIP] AWS 구축 시 ova import 방법,"[AWS OVA Import방식]
OVA 파일을 AWS 상의 AMI로 변환시키기 위해선 VM Import 라는 서비스를 이용해야 합니다.
VM Import라는 서비스는 S3에 있는 ova 파일을 이용해 해당 계정의 인스턴스나 AMI를 생성하는 서비스로, OVA 파일이 S3에 존재해야 합니다.
VM Import는 AWS Console 웹페이지에서 작동하는 서비스가 아닙니다.
AWS CLI라고 하는 Command line 툴을 통해 진행되어야 하기 때문에, 사전에 CLI 환경이 구성되어 있어야 합니다.
( CLI 환경은 작업을 진행 할 로컬 PC 환경에 설정합니다 )
해당 공식문서를 함께 전달드립니다 : https://docs.aws.<wbr />amazon.com/ko_kr/vm-import/<wbr />latest/userguide/vmimport-<wbr />image-import.html
총 수행해야 하는 단계는 아래와 같습니다.
(단계별 내용은 공식문서에 명시되어 있습니다)
(CLI 환경 구성과 관련해서는 별도의 공식문서를 전달드립니다 : https://docs.aws.<wbr />amazon.com/ko_kr/cli/latest/<wbr />userguide/installing.html , ht<wbr />tps://docs.aws.amazon.com/ko_<wbr />kr/cli/latest/userguide/cli-<wbr />chap-getting-started.html )
(CLI는 여러 OS들을 지원하고 있으며 각 OS별 설치방법은 위 공식문서의 왼쪽 탭들을 확인해주세요)
1.     AWS CLI 환경 구성 ( AWS CLI 설치 및 IAM 사용자 등록 )
2.     VM Import 서비스 역할 생성
3.     OVA 파일 S3에 업로드
4.     VM Import 를 위한 json 파일 생성
5.     VM Import 명령어 실행
VM Import는 “import-image” 라는 CLI 명령어를 통해 실행됩니다. (Import-image : https://docs.aws.amazon.com/<wbr />cli/latest/reference/ec2/<wbr />import-image.html )
6.     (AMI 생성완료)
7.     생성된 AMI로 인스턴스(EC2) 생성
- 고객사 에이프릴컴즈에서 김재훈대리가 작성한 내용입니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/2946
2945,[TIP] AWS 구축 시 ova export 방법 (VMware Vsphere),"AWS에 OVA파일을 사용하는경우가 있어서 VMware Vsphere 에서 OVA파일 내보내는 방법 공유합니다.
1. OVA파일로 내보낼 서버를 선택합니다. ( 정지된 서버만 가능 )
2. 파일 > 내보내기 > OVF 템플릿 내보내기
3. 디렉토리 지정 > 형식 설정 > 확인",댓글 없음,https://cafe.naver.com/pnpsecure2/2945
2936,[DBSAFER] 정책 및 객체 History 최소 삭제 쿼리,"장기 운영된 사이트의 경우 History 테이블에 대량의 로그가 쌓여 있는 경우가 있어
DB의 데이터 용량을 과도하게 사용하는 경우가 있어
운영 관련 데이터를 최소화하도록 History를 삭제하는 쿼리를 첨부 드립니다.
다만 해당 쿼리를 삭제하면 다음과 같은 동작에 문제가 있을 수 있으므로
사이트에서 해당 내용에 대한 이해를 구한 후 진행해야 할 것으로 보입니다.
히스토리 테이블 삭제시 발생할 수 있는 문제점
과거 로그 조회에서 '정책 정보 조회`시 당시 정책 정보가 아닌 가장 마지막 상태의 정책 정보가 조회됨
정책 이력 보고서의 중간 이력 조회 안됨
이상입니다.
감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/2936
2886,[TIP] SSH 서비스 접속 불가 시 확인사항 및 조치방법,"DBSAFER SSH 서비스 구동 및 접속 시도 시 종종 SSH 서비스 접속이 불가할 때가 발생합니다.
해당 상황 시 몇 가지 확인사항 및 조치방법들을 공유 드립니다.
[Case 1]
- 상황 : 정상적으로 서비스가 구동되었으나 Terminal 접속(putty, SecureCRT 등) 시 아래와 같이 비밀번호를 올바르게 입력하였음에도 불구하고 세션 접속이 되지 않는 경우
- 확인사항1 : telnet 및 ssh 모듈 버전 수집
> ssh 모듈이 p6 버전일 경우 2.32.xx 로 표시됨
- 확인사항2 : ssh 모듈 수동 가동하여 서비스 접속여부 확인
1. DBSAFER서버 접속 및 binary 디렉토리로 이동(cd /dbsafer or /dbsafer3)
2. ./ssh -p Port ID@IP (예시 : ./ssh -p 7795 root@192.168.102.165) 명령을 이용해 접속 테스트
이 때, ""./"" 반드시 기입 (서버 OS의 ssh 모듈이 아닌 DBSAFER ssh 서비스 모듈을 이용하기 위함)
3. 위 방법으로 접속 시 접속 여부 및 메시지 확인 (대상 서버 SSH 버전 포함)
> 정상적이지 않을 경우 위와 같이 접속하지 못하고 바로 프롬프트가 떨어짐
* 정상적일 경우 아래와 같이 대상 서버에 접속이 가능함
- 확인사항3 : telnet 모듈 디버그 모드 사용하여 메세지 확인 필요
1. 아래와 같이 해당 Terminal 서비스에 대한 서비스 데몬 확인
> 데몬 구동이 정상적이라면 위와같이 해당 서비스에 대한 telnet, sshd 데몬이 구동되어 있음
2. 위 데몬 중 telnet 데몬의 process명 및 뒤의 인자들을 그대로 복사
ex) ./pnp_telnet --sync--drop-default-thread mr 1 192.168.102.202 7795 0.0.0.0 4009 10
3. 해당 telnet 데몬을 kill
ex) kill -KILL 3193(해당 프로세스 번호 - pid)
4. 아래와 같이 telnet 데몬이 종료된 것을 확인 후 복사해 둔 telnet 데몬의 process명 및 뒤의 인자들 뒤로 -g 옵션을 붙여 해당 서비스에 대한 telnet 디버그 모듈 가동
> 정상적으로 수행하였다면 아래와 같이 telnet 데몬의 프롬프트가 떨어지지 않고 연결되어 있는 것을 확인할 수 있음
> 위의 창을 그대로 열어두고 대상 서비스에 접속을 시도하여 보면 아래와 같이 디버깅 메세지를 확인할 수 있음
> 아래의 경우는 서비스가 정상적이지 않아 어떤 메세지도 확인되지 않음
* 정상적일 경우 아래와 같이 대상 서버 ssh 모듈과 통신하는 내용을 확인할 수 있음 (키보드 입력, return 값 등)
* debug 모듈을 이용하여 메세지 수집 후 반드시 해당 서비스를 재시작하여 일반 telnet 서비스 모듈로 재시작 해 주어야 함
- 조치방법 : 위 상황은 해당 ssh 모듈이 ssh_p3모듈이므로 대상 서버와의 ssh 버전 호환성 문제로 인해 접속이 되지않는 경우이다. ssh_p6모듈로 패치하여 ssh 모듈을 수동 가동해보거나 서비스 접속여부 확인을 수행하면 정상적으로 서비스가 가동되는 것을 확인할 수 있다.
* TIP : 오직 ssh_p3와 ssh_p6 모듈의 지원차이 이슈라면 대부분은 ssh 파일만 패치하면 된다.
(서비스 재시작이나 다른 파일의 패치 불필요)
그 외의 경우 ssh 모듈 패치 시 관련모듈(pnp_telnet, pnp_sshd, ssh_manager 등)을 다 같이 패치해야 한다.
- 상세설명
> ./ssh -v 의 기존 버전이 2.30.xxx 이고 p6 버전이 2.32.yyy 버전일 경우 xxx와 yyy 버전 차이가 크기 않다면
pnp_telnet과 pnp_sshd는 패치하지 않아도 된다.
> ssh_manager만 재구동 하고, 서비스는 재시작 하지 않아도 되며, ssh도 사용자가 접속할 때마다 새로 구동되
는 것이기 때문에 별도의 서비스 재시작은 불필요하다.
> 우선 서비스 재시작 없이 ssh_p6 모듈로 /dbsafer/ssh 파일을 덮어 쓴 다음 접속 테스트를 하였을 때 정상 접속
된다면 그것만으로 작업을 종료하면 된다. pnp_telnet 과 pnp_sshd, ssh는 대부분 하위호환을 지원하도록 수정
되었으나, 일부 중간 버전에서 기능이 대폭적으로 바뀐 경우가 있어 ssh 덮어 쓰기 만으로 동작이 안될 수 있다.
이 경우에는 pnp_telnet, pnp_sshd, sftp, ssh, ssh_manager를 모두 패치해야 한다.
[Case 2]
- 상황 : ssh 모듈 수동 가동하여 서비스 접속여부 확인을 수행하였을 때 아래와 같이 Ciphers 관련 에러 메세지 발생
- 확인사항 : 대상 서버의 sshd_config 설정 확인
1. 대상 서버에 접속하여 sshd_config를 확인
> 위와 같이 sshd_config 내에서 Ciphers 옵션을 확인하면 해당 서버에서 지원하는 Ciphers 종류를 확인 및 설정 가능
(Ciphers 항목이 없거나 주석처리 되어 있다면 Default 설정임, Default Ciphers는 버전마다 상이하므로
""man sshd_config"" 명령어 사용하여 메뉴얼 내 Ciphers 항목 참고)
- 조치방법 : 위 상황은 Client(이 경우에서는 DBSAFER의 ssh 모듈)의 ssh 모듈이 지원하는 Ciphers와 Server의 sshd 모듈이 지원하는 Ciphers의 종류가 달라 발생하는 Error이다. 대상 서버 sshd 모듈의 지원 Ciphers 설정을 변경 후 해당 모듈을 재시작 하거나 DBSAFER 서버의 ssh 모듈을 패치하여 각각 지원하는 Ciphers의 종류를 맞추어 주면 해결 가능하다.
* sshd_config의 Ciphers 설정 및 적용법은 ""man sshd_config"" 명령어 사용하여 메뉴얼 내 Ciphers 항목 참고
[Case 3]
- 상황 : ssh 모듈 수동 가동하여 서비스 접속여부 확인을 수행하였을 때 아래와 같이 ssh_exchange_identification 관련 에러 메세지 발생
- 확인사항 : 대상 서버의 Server Agent 또는 서버보안 제품 가동여부 확인
1. 대상 서버에 접속하여 ""ps -ef | grep node"" 명령어 이용하여 Server Agent 가동여부 확인
2. 서버보안 제품 설치여부 확인
- 조치방법 : 위 상황은 대상 서버에 Server Agent 혹은 서버보안 제품이 설치 되어있을 경우 발생가능한 상황이다. 확인사항 참고하여 확인 후 해당 설정 변경 또는 예외처리를 진행하도록 한다.
[Case 4]
- 상황 : 간헐적으로 ssh 서비스가 접속되지 않거나 허용정책이 적용되었음에도 불구하고 사용자별로 서비스 접속가능 여부가 다름
- 확인사항 : DBSAFER 서버의 ssh_manager 가동 여부 확인
1. DBSAFER 서버에 접속하여 ""ps -ef | grep ssh_"" 명령어 이용 및 ssh_manager 모듈 가동여부 확인
> 위와 같이 1개의 ssh_manager 모듈만 실행되어 있어야 함
> 과거의 ssh_manager 모듈의 경우 인자값을 이상하게 주면(오타 혹은 test와 같은 인자값) 중복되어 프로세스가 올라가는 경우가 있었음 (현재 해당 버그 수정 완료)
- 조치방법 : 위 상황은 DBSAFER 서버에 ssh_manager 모듈이 가동되지 않았거나 중복되어 가동되어 있을 경우 발생가능한 상황이다. 확인사항 참고하여 확인 후 해당 프로세스 kill 혹은 start를 해주어 해결하도록 한다.
[Case 5]
- 상황 : tool(putty, filezilla, SecureCRT 등)별로 세션의 반응 여부(입/출력 속도, 통신속도 등)이 다르며 간헐적으로 끊김
- 확인사항 : DBSAFER 서버의 ssh 관련 모듈 버전 확인
1. DBSAFER 서버에 접속하여 ssh 관련 모듈 버전 확인
> 위와 같이 ssh 관련 모듈이 비슷한 시기에 빌드 되거나 혹은 비슷한 버전이어야 함
(ssh 모듈 패치 시 관련모듈 - pnp_telnet, pnp_sshd, ssh_manager 등 - 을 다 같이 패치해야 함)
- 조치방법 : 위 상황은 DBSAFER 서버에 ssh 관련 모듈들의 버전이 너무 크게 차이나거나 일부 모듈만 패치했을 경우 발생가능한 상황이다. 확인사항 참고하여 확인 후 해당 모듈들을 패치한다.","진선태: 매우 자세하고 도움이 되는 리포팅 같습니다. 훌륭합니다.

한가지 정정할 내용이 있습니다.
요약: ssh_p3와 ssh_p6의 지원 문제라고 하면 대부분은 ssh 파일만 덮어쓰고, 서비스 재시작이나 다른 파일의 패치는 필요 없습니다.

상세 설명
./ssh -v 의 버전이
기존 버전과 2.30.xxx 이고 p6 버전이 2.32.yyy 버전일 경우
만약 xxx와 yyy 버전 차이가 크기 않다면 pnp_telnet과 pnp_sshd는 패치하지 않아도 됩니다.
./ssh_manager 만 재구동 하고, 서비스는 재시작 하지 않아도 되며, ssh도 사용자가 접속할 때마다 새로 구동되는 것이기 때문에 별도의 서비스 재시작은 불필요합니다.

우선 서비스 재시작 없이 ssh_p6 용으로 /dbsafer/ssh 파일을 덮어 쓴 다음 접속 테스트를 해 보셨을 때에 정상 접속한다면 그것만으로 작업을 끝내시면 됩니다. pnp_telnet 과 pnp_sshd, ssh는 대부분 하위 호환성을 지원하도록 수 | 정창원: 본문내용에 반영 하였습니다. 심도있는 의견 감사드립니다.",https://cafe.naver.com/pnpsecure2/2886
2884,[TIP]TERMINAL 서비스 특정 어플리케이션 사용시 BYPASS 시키는 법,"1. 기능
- telnet.conf 파일에 어플리케이션을 등록할 경우 해당 어플리케이션으로 TERMINAL 서비스 이용시 bypass 시키는 기능입니다.
- 특정 SSH툴 혹은 SFTP툴을 사용시 서비스가 정상동작 하지 않을 경우 pnp_telnet.conf의 BYPASS_APP 옵션을 통해 byapss 가능합니다.
2. 적용법
2.1. 패킷에 들어가 있는 툴 종류 및 버전 확인
2.1.1 3way-handshake 과정을 패킷 캡쳐(사용자 IP : xxx.xxx.xxx.79 / DBSAFER gw IP : xxx.xxx.xxx.106)
2.1.2 TCP Stream을 사용해 툴 종류 및 버전 확인 (해당 세션에서 마우스 우클릭 후 Follow -> TCP Stream)
2.2. pnp_telnet.conf 수정
2.2.1 pnp_telnet.conf에서 [BYPASS_APP] 옵션 추가
2.2.2 [BYPASS_APP] 옵션 아래 wireshark에서 확인한 값 입력
2.3 서비스 재시작
※ 툴 종류별 값
winscp
SSH-2.0-WinSCP_release_[version]
ex) SSH-2.0-WinSCP_release_5.13.3
ultraEdit
SSH-2.0-WeOnlyDo
putty
SSH-2.0-PuTTY_Release_[version]
ex) SSH-2.0-PuTTY_Release_0.60
SecureCRT
SSH-2.0-SecureCRT_[version] (x64 build [build 번호]) SecureCRT
ex) SSH-2.0-SecureCRT_6.7.5 (x64 build 411) SecureCRT
FileZilla
SSH-2.0-PuTTY_Local:_[빌드일자]
ex)  SSH-2.0-PuTTY_Local:_Nov_21_2010_15:53:55
※고객사에서 반출한 패킷이므로 IP정보는 모자이크 처리 했습니다.","진선태: 추가 첨언 드립니다.

하위 모든 버전을 각각 기술하지 않고 바이패스할 수도 있습니다.
예를 들어

SSH-2.0-PuTTY_Release_0.54
SSH-2.0-PuTTY_Release_0.55
~
SSH-2.0-PuTTY_Release_0.61

이렇게 PuTTY를 바이패스하고자 할 경우
SSH-2.0-PuTTY_
이렇게만 입력하시면 됩니다.",https://cafe.naver.com/pnpsecure2/2884
2839,보안계정 정보 로깅되지 않을 경우?,"(DBSAFER 5 패키지 기준 작성)
1. /dbsafer/.conf 디렉토리 내 natcertid.conf 파일 확인
- natcertid.conf 파일이 없을 경우 touch natcertid.conf 로 파일 생성
2. oms_dms 모듈 및 서비스 모듈 재시작
3. 로깅 후 보안계정 정보 확인","강정근: oms_dms 에서 natcertid.conf 파일에 대한 처리내용을 전달 드립니다.

natcertid.conf 파일은 ""로깅"" 및 ""보안계정 정보 확인"" 과 상관이 없으며,
해당 파일이 없으면 데몬이 기동하지 못하는 필수 환경설정 파일입니다.

추가로, 해당 파일 내 설정항목 내용은 아래와 같습니다.
- WAIT_TIME: 서비스 데몬으로 부터 보안계정 정보 요청 수신 부터 응답 전달에 소요되는 시간이 일정시간(설정값)을 초과할 경우 경고로그를 기록함",https://cafe.naver.com/pnpsecure2/2839
2739,[TIP][장애처리] 서버모듈 CPU 100% 이상 사용시 정보 수집방법,"CPU 과점유 발생시, 원인분석을 위해 수집해야 하는 사항을 재정리 해 놓았습니다.
1. CPU 과점유 대상 찾기 (쓰레드)
- 명령어(top -H) 수행 후, CPU점유율 순으로 정렬함
- 가장 좌측의 ""PID"" 필드의 값 확인
==> PID 필드의 값은 프로세스 내 (※1)쓰레드번호 임
2. CPU 과점유 대상 찾기 (프로세스)
- 명령어(ps -AT -o ppid,pid,spid,c | grep [(※1)쓰레드번호] 수행한다.
==> 출력된 값은 좌측부터 (1)부모프로세스번호, (2)프로세스번호, (3)쓰레드번호, (4)CPU점유율
- 출력된 값 중 (※2)프로세스번호 를 확인한다.
3. 쓰레드 동작내용(backtrace) 확인
- #gdb ./[모듈명] [(※2)프로세스번호]
- (gdb) thread apply all bt
- 위 두 개의 명령을 순차적으로 입력한 뒤, 화면에 표시된 내용(쓰레드 상세내용) 중, 확인된 (※1)쓰레드번호 에 해당하는 내용을 발췌하여 담당개발자에게 전달함
## 발췌내용 샘플 ##
--> 아래의 빨간색 부분이 (※1)쓰레드번호입니다.
Thread 57 (Thread 0x7f9c5dcfc700 (LWP 21750)):
#0  0x00007f9c5e3fdc4d in nanosleep () from /lib64/libc.so.6
#1  0x00007f9c5e3fdac0 in sleep () from /lib64/libc.so.6
#2  0x000000000049dd21 in DBPooling::Manager() ()
#3  0x000000000049d844 in DBPooling::ThreadFunctionManager(void*) ()
#4  0x00007f9c5f094aa1 in start_thread () from /lib64/libpthread.so.0
#5  0x00007f9c5e439bcd in clone () from /lib64/libc.so.6",댓글 없음,https://cafe.naver.com/pnpsecure2/2739
2738,[TIP] 스니핑 서비스 불필요 패킷 줄이기 (넷필터 적용법),"1. 대상
- 스니핑 서비스 사용 중인 환경
- 부하가 많거나 불필요한 패킷 인입이 많을 경우
2. 조건
1) kernel 버전 2.6 이상
# uname -r
2.6.32-696.6.3.el6.x86_64
2) bridge-util 설치 필요
- 일반적으로 기본 custom setrpm 포함되어있음
# rpm -qa |grep bridge
bridge-utils-1.2-10.el6.x86_64
3) ebtables 설치 필요
- yum 또는 rpm 설치
# rpm -ivh ./ebtables-2.0.9-6.el6.x86_64.rpm
* 첨부파일은 cent 6.9 / 2.6.32-696.6.3.el6.x86_64 커널 기준 RPM 파일
3. bridge interface
1) 인터페이스 생성
# brctl addbr br0 (브릿지 인터페이스 br0 생성)
# brctl stp br0 off (브릿지 stp 옵션 OFF)
# brctl addif br0 p6p1 (스니핑 인터페이스 p6p1 bridge 연결)
2) 인터페이스 활성화
# ifconfig p6p1 down (스니핑 인터페이스 p6p1)
# ifconfig p6p1 0.0.0.0 promisc up (스니핑 인터페이스 p6p1 up / promisc는 무차별 모드로, 패킷을 무조건 수용하는 옵션)
# ifconfig br0 0.0.0.0 promisc up (브릿지 인터페이스 br0 up)
3) 확인
# brctl show (브릿지 설정 및 인터페이스 확인)
# tcpdump -nni br0 (브릿지 인터페이스에서 스니핑 패킷이 보이는지 확인)
4. ebtables
1) 체인 규칙 정의
# ebtables -P FORWARD DROP (FORWARD 체인을 모두 DROP함)
# ebtables -P OUTPUT DROP (OUTPUT 체인을 모두 DROP함)
# ebtables -P INPUT ACCEPT (INPUT 체인을 모두 수용함)
2-A) MAC Address 로 적용하기
- MAC Address 등록 또는 IP 등록 방법이 있다.
# ebtables -I INPUT --log-level info --log-ip --log-prefix [별칭]
=> 별칭은 알아보기 쉬운 용어 입력, ex. PNP / 로그 레벨은 info 권장
=> 위 설정 시, 로그가 /var/logs/messages 파일에 append 된다.
- 로그 확인
# vi /var/logs/messages
ex)
Nov 22 15:46:24 localhost kernel: PNP IN=p6p1 OUT= MAC source = 50:9a:4c:8d:f7:bd MAC dest = 00:10:f3:48:4d:e0 proto = 0x0800 IP SRC=172.16.3.141 IP DST=192.168.17.33, IP tos=0x00, IP proto=6 SPT=20501 DPT=56445
풀이)
IN : Input interface 명 / OUT : Output interface 명
MAC Source 원천지 맥 주소 / MAC dest : 목적지 맥주소
proto : 이더넷 타입 (0x0800 = Ipv4, 0x0806 = ARP 등등)
IP SRC : 원천지 IP 주소 / IP DST : 목적지 IP 주소
IP tos : 서비스 타입
IP Proto : 프로토콜 (6 = tcp, 1 = icmp, 4 = ip, 17 = udp 등등)
SPT : 원천지 포트 / DPT : 목적지 포트
=> 위 로그를 통해 원하는 MAC Address 를 찾는다.
- 정책 등록
# ebtables -I INPUT -s 00:10:f3:48:4d:e0 -d 50:9a:4c:8d:f7:bd -j ACCEPT
# ebtables -A INPUT -j DROP (모든 패킷 DROP 정책을 INPUT 체인 가장 마지막에 추가함)
2-B) IP Address 로 적용하기
- MAC Address 가 속도면에서 더 성능이 좋으나, 상황에 따라 IP로도 적용할 수 있다.
- 정책 등록
# ebtables -I INPUT -p IPv4 --ip-src 192.168.100.100 --ip-dst 10.10.10.10 --ip-dport 3306 --ip-proto tcp -j ACCEPT
# ebtables -A INPUT -j DROP (모든 패킷 DROP 정책을 INPUT 체인 가장 마지막에 추가함)
옵션 참고)
-p : proto 입력 (IPv4, ARP, 등등)
--ip-src : 원천지 IP 주소 / --ip-dst : 목적지 IP 주소
--ip-sport : 원천지 포트 / --ip-dport : 목적지 포트
--ip-proto : 프로토콜 입력 (tcp, udp, icmp 등등)
-j : 처리방식 입력 (ACCEPT, DROP 등등)
3) 서비스 활성화
# service ebtables start
4) 확인
# tcpdump -nni br0
=> 설정한 패킷이 잘 나타나는지 확인
5) 기타 활용 명령어
# ebtables-save (정책 저장)
# ebtables -D [chain] [num] (num 번째 chain 정책 삭제)
5. 데몬 설정
1) sniff 데몬
- sniff 데몬이 바라보는 NIC 변경
# vi /dbsafer/.conf/sniff.conf
=> INTERFACE 에 'br0' 등록, 기존 스니핑 NIC 제외(bridge 연결된 인터페이스)
2) pnp_ips_skylab 데몬 (3-tier 식별 / INFOSAFER 해당)
- pnp_ips_skylab 데몬이 바라보는 NIC 변경
# vi /dbsafer/.conf/pnp_ips_skylab.conf
=> INTERFACE 에 'br0' 등록, 기존 스니핑 NIC 제외(bridge 연결된 인터페이스)
3) 서비스 재실행
- 스니핑 서비스 재실행
- pnp_ips_skylab 데몬 재실행(3-tier 식별 / INFOSAFER 해당)
6. 측정
1) sar
# sar -n DEV
IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s
Average:         p6p1    163.74      0.00     78.35      0.00      0.00      0.00      2.19
Average:          br0     141.24      0.00     75.12      0.00      0.00      0.00      0.00
*참고
: IFACE(NIC명), rxpck/s(초당 수신패킷 수), txpck/s(초당 송신패킷 수), rxkB/s(초당 수신 패킷 크기), txcmp/s(초당 송신 패킷 크기), rxmcst/s(초당 다중 수신 패킷)
# sar -f /var/log/sa/sa[DD] -n DEV
- 특정 일자 평균 데이터 확인
7. 참고
1) 넷필터 참고 이미지 (출처 : https://en.wikipedia.org/wiki/Netfilter)
2) DBSAFER 내 패킷 흐름
- Mirror > NIC > ebtables INPUT > br0 > ebtables OUTPUT > Target NIC
=> 데몬은 필터된 br0 인터페이스를 처리하므로 부하 감소
3) 적용 고객사 사례
- 서울시청
> 백오피스 성능 측정 (CPU 점유율)
주요 프로세스 적용 전 적용 후
java  281%  41%
mysqld 126% 73%
pnp_ora_sniff  110% 42%
pnp_ips_skylab  107% 15%
pnp_log  104% 20%
> 프론트오피스 성능 측정 (CPU 점유율)
주요 프로세스 적용 전 적용 후
pnp_ips_skylab  63%  8%
mysqld  27% 15%
java  13%  9%
pnp_log  9% 8%
pnp_ora_sniff  8% 8%
※ 오전 이른시간 측정으로 평소보다 사용량이 적은 상태
4) 관련 자료
- 한정상 연구원 작성자료
> https://docs.google.com/document/d/1WkVnGRrnz6GOjbfPCsJvWjoe8CgHEhRoIHlU7R9aK_8/edit",이수빈: 한정상 연구원이 기술 리서치 및 적용에 수고해주셨습니다. 감사합니다.,https://cafe.naver.com/pnpsecure2/2738
2722,"[TIP]보안계정 비밀번호, 유효기간 만료 시 알람기능(메일) 설정","[JOB_CONTAINER] 알람 전송 모듈
- 해당 모듈은 보안계정의 유효기간 및 비밀번호 만료 전에 각 사용자에게 알람 메일을 전송하는 기능입니다.
또한 정책에 유효기간을 설정할 경우, 유효기간 만료 전 관리자에게 알람 메일을 전송하도록 설정가능합니다.
## 해당 기능을 사용하기 위해선 기본적으로 메일 연동기능(pnp_mailer)이 적용되어 있어야 합니다.
## 만료일이 지난 정책 및 보안계정의 경우 알람 메일이 전송되지 않습니다.
[설치 파일]
구글 드라이브 : https://drive.google.com/drive/folders/1BHOF8Apvmlnt_TrUtHQSEirS0DTmwBDW?usp=sharing
설정방법은 아래와 같습니다.
[설치절차]
(1) cp dbsafer_job_container.tar.gz /dbsafer
(2) tar xvfz dbsafer_job_container.tar.gz
(3) cp .conf/dbsafer_job_sendAlert.properties.sample .conf/dbsafer_job_sendAlert.properties
(4) vi .conf/dbsafer_job_sendAlert.properties
- 알람 전송 기능 설정
(5) ./dbsafer_job_container.sh start
[dbsafer_job_sendAlert.properties 설정]
################################################
# 만료 알림 전송 대상 설정 (대상에 부합하는 플래그 값의 총합을 입력함)
# 보안계정 만료(1), 비밀번호 만료(2), DBMS정책 만료(4)
# Default: 7
################################################
ALRAM_FLAGS=7
################################################
# 알람 메일 전송 시간 설정
# Default: 00:00:10 를 기준으로 주기마다 동작을 수행합니다.
################################################
SEND_TIME=11:49:00
>> 설정된 시간에 유효기간 및 비밀번호 만료를 check하여 메일로 전달합니다.
################################################
# 알람을 보내는 기간 설정 (만료되기 전 설정한 날짜 이전부터 알람메일을 전송함)
# Default: 10
################################################
ALERT_DATE=10
################################################
# 알람 메일 양식 파일 설정
# Default:mail_form_dbsafer.txt
################################################
#MAIL_FORM=.conf/mail_form_dbsafer.txt
MAIL_FORM=.conf/mail_form_alert.txt
>> 패키지에 포함된 alert 메일로 변경 혹은 원하는 메일 폼으로 변경
################################################
# 관리자 메일주소 설정 (DBMS정책 만료 알람 전송 대상)
# Default:
################################################
MAIL_ADDRESS=jcsong@pnpsecure.com
>> 정책 유효기간 만료 알람을 받은 관리자 메일 주소 등록
[테스트 결과 화면]",황재필: dbsafer_job_container.sh 사용시에 mail_form_alert.txt 의 내용 중 COMMENT로 되어 있는데 CONTEXT로 변경해서 사용하셔야 만료내용이 출력됩니다.,https://cafe.naver.com/pnpsecure2/2722
2709,"[TIP] duplex 의 상태 변경 시, 사유를 포함한 알람 기능 추가","duplex 모듈 rev.69 버전 이상부터 상태 변경 시, 사유를 포함한 알람 기능이 추가됐습니다.(모듈 패치만 하면 사용 가능)
아래와 같이 시스템 로그에 기록 및 매니저 경고 알람에 사유가 추가됩니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/2709
2680,[TIP]PNP_Connector 사용 시 주의 사항,"<pnp_connector  사용 시 주의 사항>
pnp_connector를 통해 조회를 할 경우 /tmp 폴더에 조회한 결과를 저장하기 전 임시 테이블 스페이스가 쌓이게 됩니다.
해당 현상은 설정에 따라 n일치의 테이블이 union으로 구성되어 하나의 view로 제공됨에 따라 temp 테이블 스페이스가 생성되는것은 불가피한 현상입니다.
=> 이는 mysql의 동작 방식
-> 조회한 기간에 따라 /tmp 폴더에 임시 파일이 생성되고, 조회 기간이 길 수록 임시 데이터 파일의 크기가 증가됩니다.
* 상황에 따라 /tmp 폴더의 용량 과다로 인하여 / 파티션의 용량이 FULL 찰수도 있습니다.
[대처 방안]
1안) 쉽게 개선하는 방법은 당일치 혹은 전일 날짜와 같이 하루 치 로그만 검색 하게 할 경우 개선이 가능합니다.
* connector 설정에 따라 당일치에 대한 view만 생성할시 /tmp에 테이블 스페이스가 생성되지 않음
> 하지만 전일치 로그가 필요할 경우, 임시파일이 생성됨.
2안) 만약 여러 날짜를 동시에 보려면 임시로 /tmp 경로 변경 후 향후 별도 /tmp 파티션 신규 생성 요청
* /파티션 안의 tmp폴더가 용량을 점유하는 있으니, /tmp파티션을 별도로 만들어서 서비스 운영에는 영향이 없도록 처리하는 방안입니다.
3안) /tmp 경로 변경 안
- 임시 테이블 스페이스 위치를 변경하여, 여유있는 파티션으로 설정변경
=>  my.cnf에 아래와 같이 적용 가능
ex)
[mysqld]
tmpdir = /home/dbsafer/tmp
- 임시로 /home 디렉토리 하단에 임시 디렉토리로 설정 후  몇 일 간 max 사용률 을 확인 하여 /tmp 신규 파티션 용량 산정 후 잡는게 좋을거 같습니다.
- 별도 파티션 없이 /home 하단에 tmp 디렉토리 운영을 해도 좋을 수 있으나 만약 tmp 용량 증가로 인해 /home 파티션이 full 발생 시
감사로그를 저장 하지 못하기 때문에   모니터링 후 분리 하는게 좋을거 같습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/2680
2650,[TIP][DBSAFER v3.0] 보안계정 생성 및 삭제 내역 엑셀 출력 쿼리,"DBSAFER Local DB에서 아래의 쿼리를 입력하면 보안계정 생성 및 삭제 내역을 엑셀파일로 출력할 수 있다.
*제약사항
1. DBSAFER v3.0에서만 해당 쿼리의 데이터 정확성을 보장
2. 관리자가 보안계정 사용자의 입/퇴사 시 계정을 생성/삭제하지 않고
기존 퇴사자의 계정을 신규 입사자의 계정으로 수정하여 사용하는 경우, 데이터의 정확성을 보장하지 않음
(실사용 예 - 2015년 1월 1일 00시 이후부터 전체, /tmp/cert_history_from_2015.csv 경로의 파일로 출력)
SELECT idx, revnum, sno, name, tel, createtime, destroytime FROM dbsafer3.cert_history
WHERE createtime >= ""2015-01-01 00:00:00"" AND revnum = '0' OR destroytime >= ""2015-01-01 00:00:00""
ORDER BY idx, revnum
INTO OUTFILE '/tmp/cert_history_from_2015.csv' FIELDS TERMINATED BY ',' ENCLOSED BY '""' LINES TERMINATED BY '\n';
(데이터 예시)
[각각 항목의 의미]
- idx : 해당 객체 고유번호
- revnum : 수정된 횟수(revnum = 0이면 해당 객체 신규 생성)
- sno : 보안계정 ID
- name : 이름
- tel : 부서명
- createtime : 해당 객체가 생성된 시각 또는 수정된 시각
- destroytime : 해당 객체가 삭제된 시각",댓글 없음,https://cafe.naver.com/pnpsecure2/2650
2644,[TIP][장애처리] 서버모듈 CPU 100% 이상 사용시 정보 수집방법,"서버모듈 CPU 100% 이상 사용시 정보 수집방법을 작성합니다.
(강정근 팀장님 도움주심)
서버모듈은 쓰레드처리가 되어있어 어떤 쓰레드에서 문제가 있는지 확인 하려면
쓰레드별 CPU 사용량을 꼭 확인해야합니다.(이 부분이 알려지지 않아 해당글을 작성합니다)
이하 정보수집방법 입니다.
1. 쓰레드별 CPU 사용량 확인 후 스크린샷
#top -H
> top의 -H 옵션을 사용하면 쓰레드별 CPU 량 확인이 가능합니다. 이 정보를 스크린샷합니다.
(위 이미지는 샘플입니다)
Shift+O // 정렬기준선택 화면
Shift+K // CPU 사용량 별 정렬(기본 선택되어있으며, K가 대문자 인지 확인)
엔터
2. 프로세스별 CPU 사용량 확인 후 스크린샷
#top
> 프로세스별 CPU 사용량에 대한 정보를 수집합니다. 해당 정보로 gcore를 생성 하기 위함입니다.
Shift+O // 정렬기준선택 화면
Shift+ K // CPU 사용량 별 정렬(기본 선택되어있으며, K가 대문자 인지 확인)
엔터
3. gcore 생성
#gcore [PID]
> gcore 생성시 로컬디스크 용량 확인 후 진행합니다.(파일용량이 큼)
4. core 파일 내용확인
> core 반출 후 회사내부에서 BT를 확인하기가 어렵다고 합니다.
아래 작업을 꼭 현장에서 진행하여 정보를 취합합니다.
#gdb [모듈명] core.[PID]
(gdb) thread apply all bt full 5
> 모든 쓰레드별 BT 정보를 5줄 까지 출력
5. 추가정보: 모듈버전(ex) dbsafer_ora --version), 데몬로그 수집필요(/dbsafer_sys_log/모듈명/년도/월/일별로그","황원순: 위의 명령어 중 Shift+O는 CentOS5에서 적용되는 명령어 입니다. CentOS에서는 작동 안되니 유의 바랍니다. | 남신우: CentOS7의 top의 경우

‘M’ to sort by memory usage
‘P’ to sort by CPU usage
‘N’ to sort by process ID
‘T’ to sort by the running time
‘R’ to sort by 오름차순과 내림차순을 토글 변경합니다.

자세한 내용은 아래 링크를 참고해 주시기 바랍니다.

https://sabarada.tistory.com/146",https://cafe.naver.com/pnpsecure2/2644
2641,[TIP] DBSAFER V5 암호화 통신 프로토콜 확인 방법,"사이트에서
DBSAFER - Entreprise Manager 간의 암호화 통신 프로토콜
또는
DBSAFER - PC Agent 간의 암호화 통신에 사용하는 프로토콜에 대해 확인이나 증적자료를 요청하는 경우가 간혹 있어서 확인 방법을 공유하고자 합니다.
1. DBSAFER - Enterprise Manager 암호화 통신 프로토콜
- MariaDB 의 설정에 따라 달라지게 되어있으나 현재 우리회사가 사용하는 MariaDB 10 버전 이상에서는
OpenSSL을 사용하며 TLSv1.2를 기본으로 사용하도록 되어있습니다.
- 실제 DB에 접속하여 옵션을 확인할 수 있으며, 명령어는 아래와 같습니다.
hava_openssl 은 Openssl 사용 여부를 가리키며, have_ssl은 TLSv1.2를 사용 여부를 알 수 있습니다.
자세한 내용은 아래의 사이트에 방문하시여 확인하실 수 있습니다.
참고 - https://mariadb.com/kb/en/library/ssltls-system-variables/
https://mariadb.org/state-ssl-mariadb/
2. DBSAFER - PC Agent 암호화 통신 프로토콜
- DBSAFER와 PC Agent 는 Openssl 을 사용하며, 사용자의 PC 환경에 따라 TLS v1.0 ~ v1.2를 사용하도록
PC Agent가 설계되어 있으며, 정확한 TLS 버전 확인을 위해서는 사용자 PC 에서 패킷 분석 툴(ex. Wireshark)
등을 통해서 확인할 수 있습니다.","김가희: * PC Agent - DBSAFER 암호화 통신 프로토콜

1. PC Assist 3.2.X 사용시에만 암호화 통신을 사용함
2. SSL_LISTEN_FLAG = YES 설정이 되어 있거나, oms_dms에 대한 버전 확인이 필요함.
3. oms_dms rev573, dms rev 77 이상 버전에서 SSLv2, SSLv3, TLSv1.0, TLSv1.1 등을 지원하며, 암호화 통신 버전 변경이 가능 함
-oms_dms rev573, dms rev 77 이하 버전에서는 암호화 통신 버전을 랜덤으로 사용함 | 채널지원: 1. 사용자 - DBSAFER 서비스 구간 암호화
- 3.1.12.x 버전 이상에서도 지원됩니다.
- Manager : 서비스 > 사용자식별+암호화
oms_dms.conf : NAT_IDENTITY_USE = 1, CRYPTO_USE = 1

2. 김가희 대리님이 말씀하신 사항은 PC Agent와 pnp_oms_dms, pnp_dms 간의 암호화 설정 방법입니다.
- PC Agent 의 id/pw 인증, 서비스 리스트 수신 시 암호화 시 설정",https://cafe.naver.com/pnpsecure2/2641
2639,[TIP][DBSAFER] 비밀번호 암호화 함수 추가 방법,"고객사 요청으로 SHA1 이 아닌 SHA2, SHA512 등의 암호화 방식 변경을 할 경우
최신 패키지가 아닌 패키지 사용하는 사이트에서는 모듈 패치 뿐만 아니라
우선적으로 DBSAFER DB에 암호화 호출 함수가 있는지 확인이 필요합니다.
만약 함수가 없다면 추가를 해주야 하는데 아래의 절차에 따라 진행해주시면 됩니다.
1. DBSAFER DB 접속후 함수 확인
-> # show function status;
-> pnp_passwd 함수의 유무 확인
2-1. 함수가 존재한다면 모듈 패치로만으로도 암호화 방식 변경 가능
2-2. 함수가 없다면 함수 추가 진행
-> DBSAFER DB 접속후
-> # use dbsafer3;
-> # show global variables like 'log_bin_trust_function_creators';
->  log_bin_trust_function_creators = ON 확인 (ON일때만 function을 생성할 수 있음)
-> 만약 OFF 이면 SET GLOBAL log_bin_trust_function_creators = ON; 실행
-> # CREATE FUNCTION pnp_passwd (s TEXT CHARACTER SET BINARY) RETURNS TEXT CHARACTER SET BINARY RETURN SHA2(s, 256);
-> 함수 생성 확인
3. 위 사항이 모두 완료 되었으면 모듈 패치 및 암호화 방식 변경 가능합니다.
참고 - https://mariadb.com/kb/en/library/create-function/
- http://www.mysqlkorea.com/gnuboard4/bbs/board.php?bo_table=community_03&wr_id=1965",댓글 없음,https://cafe.naver.com/pnpsecure2/2639
2632,[TIP][OMS_DMS]보안 계정 장기 미사용자 잠금 설정 추가 옵션,"현재 DBSAFER에서 보안 계정의 장기 미사용 잠금 기간 설정은 모든 보안 계정 대상으로 적용이 되어 있어
특정 보안계정 대상에 대해서 기간을 별도로 설정 할 수 없습니다.
OMS_DMS 신규 기능추가로 설정이 가능 하도록 되었습니다
1. 버전 정보
- OMS DMS Release Rel1.3-CentOS6 (Rev 602)
-    ( CERTIFICATION MODULE VERSION INFO: v4.0 )
-    ( COMMON LIBRARY VERSION INFO: Rev.366 )
-  2. 보안계정 잠금 기능 다수 조건 추가
2. 개선 사항
- 장기 미사용 보안 계정 잠금 기능에 추가적으로 특정 보안계정에 대해서 잠금 기간을 추가적으로 설정 할 수 있도록 기능 개선을 진행함.
Ex) [10]AAA* : 보안계정 명이 AAA 로 시작하는 모든 계정에 대해서 10일 미 사용 시 잠금 실행
[11]BBBB : BBBB 보안계정에 대해서 11일 동안 미 접속 시 잠금 실행
3. pnp_oms_dms 추가 설정
# 콤마(,)기준으로 입력된 우선순위에 따라, 부합되는 보안계정명칭에 대해 미사용 잠금 설정 날짜를 별도 지정함
# (ACCOUNT_LOCK_DAY 이 0이 아닌 값으로 설정되어 있어야 함)
# (해당 설정값 에 부합되지 않는 보안계정에 대해서는 ACCOUNT_LOCK_DAY 으로 적용됨)
# Format : [잠금 설정 날짜] 계정명
# Format : [잠금 설정 날짜] 계정명 프리픽스*
# Example : [10]AAA*, [11]BBBB, [12]BBB*
#ACCOUNT_LOCK_DAY_EXT =
# 일정 기간 미사용 계정 잠금 처리 시간을 설정
# Example : 05:00:00
# Default : 05:00:00
#ACCOUNT_LOCK_TIME = 05:00:00
# 일정 기간 미사용 계정 잠금 설정시, 계정 생성 후 접속이력이 없는 사용자를 포함할지 설정 (ACCOUNT_LOCK_DAY 이 0이 아닌 값으로 설정되어 있어야 함)
# NO로 설정을 하면, 계정 생성 후 접속이력이 없는 사용자를 잠금대상에서 포함하지 않음
# Example : YES (사용), NO (미 사용)
# Default : NO
#ACCOUNT_LOCK_NO_ACCESS_USER = YES
# 일정 기간 미사용 계정 잠금에 대한 상세조건을 설정함.
# 아래의 항목 중 설정하고자 하는 조건에 부합하는 값(HEX)의 합을 입력.
# 1 - 최종 접속 시간 : 점검시간을 기준으로 최종 접속 시간이 잠금기간(ACCOUNT_LOCK_DAY)을 초과한 경우
# 2 - 계정 생성 시간 : 점검시간을 기준으로 계정 생성 시간이 잠금기간(ACCOUNT_LOCK_DAY)을 초과한 경우 (접속이력이 없는 대상)
# 4 - 계정 유효 기간 : 점검시간을 기준으로 계정 유효 기간(시작)이 잠금기간(ACCOUNT_LOCK_DAY)을 초과한 경우 (접속이력이 없는 대상)
# Default : 3(최종 접속 시간 + 계정 생성 시간)
#ACCOUNT_LOCK_CONDITION = 3
4. 주의 사항
- ""ACCOUNT_LOCK_DAY_EXT "" 옵션 설정 시 조건에 대한 설정이 255글자를 초과 시 적용이 안됨
- ""ACCOUNT_LOCK_DAY_EXT "" 옵션 설정을 다음과 같이 했을 경우
[5]BBBB, [12]BBB*
보안 계정 ""BBBB"" 은 5일 미사용 잠금으로 적용이됨
※ 해당 기능은 특정 사이트의 요구 사항으로 개발이 되었으며 추후 기능은 메니저에서 설정 하도록 변경이 될 수 있습니다. 정식 릴리즈 이전에는 개발자 문의 후 적용 바랍니다. ※",댓글 없음,https://cafe.naver.com/pnpsecure2/2632
2547,[TIP][Duplex] Duplex 모듈 설명 및 DBSAFER 서버 이중화 시 VIP 설정 방법,"* DBSAFER 서버 이중화
- DBSAFER 서버를 DBSAFER ACTIVE 서버와 DBSAFER STANDBY 서버로 구성
- ACTIVE 서버에 장애가 발생하면 FAILOVER 상태로 전환되어 STANDBY 서버가 운영 되도록 함
(VIP 이중화를 설정하면, FAILOVER 상황에서 ACTIVE 서버에서 사용하던 VIP를 STANDBY 서버에 설정할 수 있음)
* dbsafer_duplex (VIP 이중화 설정은 duplex Rev 43 이상에서 지원)
- ACTIVE 서버 상태를 Check 하며 FAILOVER 발생시에는 STAND BY 서버가 세션 및 정책을 관리 할 수 있도록 함
- VIP 이중화를 설정할 경우, ACTIVE 서버 FAILOVER 발생시 ACTIVE 서버에서 사용하던 VIP가 STANDBY 서버에 설정됨
- dbsafer_duplex 모듈은 Active 서버 및 Standby 서버 모두에 공통적으로 설치됨
# 참고 : FAILOVER 상태 발생은 아래의 상황에서 발생
- dbsafer_agent 모듈 장애(정지)
- dbsafer_log 모듈 장애(정지)
- dbsafer_duplex 모듈 장애(정지)
- MySQL 장애(접속 장애 및 정지)
- DISK 장애(DISK 저장 용량 부족 등)
- 물리적 단절(전원 차단 및 네트워크 단선 등)
* VIP 이중화 설정 방법 (Active, Standby 서버 설정방법 동일)
1. network script 작성 - /etc/sysconfig/network-scripts/ifcfg-<vip_device_name> 파일을 작성
<network script 파일 예>
[root@dbsafer-active network-scripts]# ls
ifcfg-eth0    ifdown-eth   ifdown-ppp     ifup-aliases  ifup-isdn   ifup-routes       net.hotplug
ifcfg-eth0:0  ifdown-ippp  ifdown-routes  ifup-bnep     ifup-plip   ifup-sit          network-functions
ifcfg-lo      ifdown-ipv6  ifdown-sit     ifup-eth      ifup-plusb  ifup-tunnel       network-functions-ipv6
ifdown        ifdown-isdn  ifdown-tunnel  ifup-ippp     ifup-post   ifup-wireless
ifdown-bnep   ifdown-post  ifup           ifup-ipv6     ifup-ppp    init.ipv6-global
[root@dbsafer-active network-scripts]# cat ifcfg-eth0:0
DEVICE=eth0:0
ONBOOT=no
BOOTPROTO=static
IPADDR=192.168.102.163
NETMASK=255.255.255.0
GATEWAY=192.168.102.1
2. duplex 옵션 설정 - dbsafer_duplex.conf 파일에 vip_device_name 옵션을 설정. 예) eth0:0 또는 bond0:0 등
3. duplex module 시작
* dbsafer_duplex.conf (ACTIVE 서버와 STAND BY 서버에 설정)
[root@dbsafer .conf]# cat dbsafer_duplex.conf
########################################################
# Active server ip.
active = 192.168.2.xx                  [Active 서버 IP]
########################################################
# standby server ip.
standby = 192.168.2.xx                [Standby 서버 IP]
########################################################
# Active signal check timeout.
check_timeout = 10                     [FAILOVER Check Time]
########################################################
# VIP option.
# If you use the option, it is set a VIP ona server.
# NOTICE: If this option is enabled, theremust be a file with
# a option name in""/etc/sysconfig/network-scripts"" directory.
vip_device_name = eth0:0               [VIP 이중화 시 네트워크 인터페이스]
- Check Timeout 시간을 설정하여 FAILOVER 상태 체크 주기를 설정
- 네트워크 인터페이스를 설정하면 VIP 이중화 가능
* dbsafer_duplex_active.conf (ACTIVE 서버만 설정)
[root@dbsafer .conf]# catdbsafer_duplex_active.conf
########################################################
# Deamon check option. Default is '1'.
check_agent= 1                      [dbsafer_agent 모듈 Check 기능 활성화 설정]
check_log= 1                         [dbsafer_log 모듈 Check 기능 활성화 설정]
########################################################
# Disk usage check
# Default is '/home' for [path], 95 for[limit].
# Empty [path] means disable feature.
disk_check_path= /home            [DISK 용량 확인 Path 설정]
disk_usage_limit= 40                 [DISK 임계치 설정]
########################################################
# MySQL check term. Default is '0' todisable feature.
# If failed, it will test every seconds.
mysql_check_term= 10                [MySQL Check 시간 설정]
########################################################
# Standby log sync time. (default 05:00:00)
# If you want disable daily sync, Leave itas a blank like this ""synctime = ""
########################################################
synctime= 06:00:00                   [log 자동 Sync 시간 설정]
- FAILOVER 를 Check 할 환경 설정 파일임
- 각 모듈 및 DISK 임계치를 설정하며 Synctime을 설정함
* Standby 서버 설정 방법
Standby 서버는 기본적인 duplex 동작 설정을 위한 dbsafer_duplex.conf(필수)와 failover 발생시 알람 설정을 위한 dbsafer_duplex_standby.conf(선택)가 필요하다. 또한 실시간 정책 동기화를 위하여 policysync 모듈을 설정해야 한다.
(dbsafer_duplex.conf 설정 방법은 Active 서버의 dbsafer_duplex.conf 와 동일)
ACTIVE LOG
STANDBY LOG
Gateway
dbsafer_duplex
가동
가동
가동
dbsafer_duplex.conf
설정 필수
설정 필수
설정 필수
dbsafer_duplex_active.conf
설정 필수
-
-
dbsafer_policysync
필수(비가동 상태)
필수 (가동 상태)
-
dbsafer_policysync.conf
설정 필수
설정 필수
-
* DUPLEX 옵션
> START
> STOP
> LOGSYNC yyyymmdd
> RESTORE
- START/STOP 옵션의 경우 모든 상황에서 확인이 가능하며 모듈의 가동 및 정지 기능
- logsync 옵션은 Active 서버에서만 확인이 가능한 옵션으로 Standby 서버에 적재된 감사 로그를 Active 서버로 적재하는 기능
- RESTORE 옵션의 경우 복구 옵션으로 Standby 서버에서 FAILOVER 상태일 경우에만 옵션 확인 및 실행이 가능
구분
활성화 조건
기능
START
항상
Duplex 모듈 가동
STOP
항상
Duplex 모듈 정지
LOGSYNC
Active 서버만
Standby 서버에 적재된 감사 로그 로딩 [./dbsafer_duplex logsync yyyymmdd]
Logsync 는 Active 서버의 Status 가 Normal 일 경우에만 자동 동기화로 동작함
RESTORE
Standby 서버만
FAILOVER 모드 NORMAL 모드로 복구
* VIP 이중화 사용 시 Active 서버에서 dbsafer_duplex 모듈 정지
dbsafer_duplex로 VIP 이중화를 설정한 경우, Active 서버에서 dbsafer_duplex 모듈을 정지(설정 변경 등의 이유로)시키면 failover가 발생 되면서 Active 서버의 VIP는 그대로 남아있고 Standby 서버에 같은 VIP가 올라가게 된다(CentOS 5.x 버전).
따라서 같은 VIP를 두 대의 서버에서 사용하는 현상이 발생한다. 이를 방지하기 위해 Active 서버에서 dbsafer_duplex 모듈을 정지시킬 때, 사용하고 있는 VIP(pnp_duplex.conf에 설정한 VIP)를 계속 사용할지, 내릴지를 선택하는 과정이 있다.
############################################################
[root@dbsafer]#./dbsafer_duplex stop
DUPLEXRelease Version 1.0 for Rel1.3-CentOS6 (Rev 43) [Dec 15 2016] !!
Do youwant to disable VIP(eth0:0)? [yes/no]
############################################################","신호철: Rev 45 이상 버전부터 Web Server의 상태를 점검하여 이중화 동작하는 기능이 추가되었습니다.
(HTTP 응답값에 ""200 OK"" 일 경우에만 정상으로 처리)

[설정 방법]
- dbsafer_duplex_active.conf 설정 파일에 아래의 옵션 추가

check_web_server = 1 [Web Server Check 기능 활성화 설정]
web_server_port = 3443 [Web Server port 설정]
web_server_check_interval_sec = 10 [Web Server Check 주기 설정]
web_server_timeout_sec = 5 [Web Server 검사 TimeOut 설정]",https://cafe.naver.com/pnpsecure2/2547
2510,결재관리시스템(DMS) 최초 설치 시 dbsaferdms 계정생성이 안될 때,"안녕하세요 서재휘입니다.
사내 테스트 목적 또는 고객사 제품 납품시에 최초 결재관리시스템(DMS)를 구축하고자 할 때
dbsaferdms 계정이 생성되지 않거나 생성되었다 하더라도 권한이 전부 N인 상태가 될 수 있습니다.
기본적으로 dbsaferdms계정은 dms_dcl.sql 파일로 insert 쿼리를 통하여 계정을 생성하는데
이때 쿼리 ERROR가 발생됩니다.
원인은 mysql 데이타베이스에 user테이블의 변화에 의한 것으로
Default 가 없는 Not Null 컬럼들이 존재하기 때문입니다.
눈치빠른분들은 이해하셨겠지만 SQL문만 간략하게 수정하시면 정상적으로 사용이 가능합니다.
다들 바쁘실테고 게시내용에 DB테이블정보를 기록하기에는 여러가지 정보들이 있어서
링크파일을 통하여 간략하게 공유드립니다.
(이파일로 계정생성하시면 잘 됩니다. 2018년 10월 16일 시점 정상동작함.)
https://drive.google.com/drive/u/0/folders/1xer9VX8wG1Nz_rTYjB96fFLa0msX0Hcz?ogsrc=32
# 환경정보 #
OS : CentOS 6.9
Maria DB 버전 : 10.0.36-1",댓글 없음,https://cafe.naver.com/pnpsecure2/2510
2505,[dbsafer_duplex][매뉴얼] duplex 모듈 매뉴얼,https://bbs.pnpsecure.com/showthread.php?tid=7174,댓글 없음,https://cafe.naver.com/pnpsecure2/2505
2491,DBSAFER 로그에 SQL유형 정보가 기록중입니다.,"안녕하세요 서재휘입니다.
최근 농협은행 요구사항 확인하던중에 제가 모르고 있던 내용이 확인되어 같이 공유하고자 합니다.
DBSAFER 로그에 SQL유형별로 로그를 기록하고 있다는 사실 알고 계신가요?
저는 보고서상에서는 있다고 알고 있었지만 DBSAFER 로그에 관련 정보가 있는지는 모르고 있었습니다.
db_query_XX 테이블에 query_info 라는 컬럼이 있고 이 해당 index가 db_qinfo 로 연결됩니다.(db_qinfo 테이블에 idx 값을 의미합니다.)
db_qinfo 테이블에 qry_type 라는 컬럼이 있는데 바로 qry_type 이 SQL유형입니다.
[ qry_type 값의 유형은 다음과 같습니다.]
SELECT 4097
INSERT 4098
UPDATE 4099
DELETE 4100
TRUNCATE 4101
CREATE_TABLE   8202
DROP_TABLE 8203
ALTER_TABLE 8204
RENAME_TABLE       8205
PROCEDURE 20
FUNCTION       21
GRANT 12319
REVOKE 12320
LOCK 12321
COMMIT 12322
ROLLBACK 12323
#  4000번대는 DML / 8000번대는 DDL / 12000번대는 / DCL로 해석할 수 있다고 합니다.
위 정보를 활용하면 SQL로 로그 조회시 SQL 앞에 SQL유형을 따로 뽑을수도 있을 것 같습니다.
이상입니다. 다들 수고하세요 ( _ _ )",이진욱: 해당 값들은 dbsafer5 버전부터 dbsafer3.querytypes 테이블을 조회를 통하여 확인할 수 있으며 해당 테이블과 JOIN쿼리를 사용할 수도 있으니 참고하세요,https://cafe.naver.com/pnpsecure2/2491
2485,"[Cubrid] Auto Commit 사용 시, 서비스 세션 타임아웃 기능 동작 오류","[증상]
큐브리드 서비스에 세션타임아웃을 설정했지만 동작하지 않을때가 있음.
[발생 조건]
큐브리드 매니저에서 접속 시, Auto Commit 기능을 활성화 한 상태에서 접속.
쿼리를 수행하면 다음에 Commit; 쿼리가 자동으로 수행되면 세션타임아웃이 동작하지 않음.
[이유]
타임아웃 체크 동작을 하려면 서버에서 32바이트 이상의 패킷을 수신해야함.
하지만 Commit의 응답패킷처럼 크기가 작은 패킷이 올 경우, 응답값 처리가 완료되지 않은것으로 판단하여 세션 타임아웃 검사를 수행하지 않게 됨.
[수정 사항]
Oracle과 같이, Cubrid에서도 commit, rollback 쿼리 이 후 오는 서버 응답패킷은 크기가 작아도 세션 타임아웃을 동작할 수 있도록 수정
[패치 정보]
pnp_cubrid Revision 1623에서 수정됨",댓글 없음,https://cafe.naver.com/pnpsecure2/2485
2484,"[Cubrid] Port Redirect 서버에서 사용자 식별 사용 시, 접속 오류","[증상]
접속 오류 팝업이 큐브리드 매니저에서 발생되며, ""NAT Identity"" Database에 접속할 수 없다라는 오류 발생.
[발생 조건]
접속 시 Port Redirect가 일어나는 큐브리드에 사용자 식별 사용 시 접속 오류 발생
(큐브리드 10.1 버전에서는 기본 설치 시 포트 redirect가 발생 됨.)
[이유]
Port Redirect가 일어나게 되면, PC Assist에서 해당 서비스의 ""CUBRID FORWARD""라는 포트로 재접속을 시도함.
이 때 PC Assist에서 NAT Identity 패킷을 재전송하게 되는데, 이 패킷을 pnp_cubrid에서 필터하지 않고 그대로 서버 전달하여 패킷 오류로 서버에서 접근 거부를 하게됨.
[수정 사항]
Port Redirect로 PC Assist에서 NAT Identity 패킷을 재전송 할 경우, 이를 서버로 전송하지 않고, 처음 NAT Identity를 받은것처럼 처리하도록 수정
[패치 정보]
pnp_cubrid Revision 1620에서 수정됨.",댓글 없음,https://cafe.naver.com/pnpsecure2/2484
2476,로그 축약 기능 사용 확인 방법,"""로그 축약""은 WAS 로그 형태로 저장하는 방식을 의미하는 것으로 Log 데몬의
빌드 형태에 따라 사용하는 방식이 달라집니다.
1. 로그 축약만 지원되는 Log 데몬 확인
- 로그 데몬에서 버전 확인시 TABLE_OPTIMIZED라고 표시가 됨
- Proxy / Sniff 구분없이 Log 데몬에서 로그를 축약하여 저장
2. 선별적 로그 축약 사용법
- 로그 데몬에서 버전 확인시 SUPPORT_OPTIMIZED_LOG라고 표시됨
- Sniff 서비스에 한해서만, 로그 축약을 사용하지 일반 로깅을 사용할지 설정
- 설정방법
. 위 로그 데몬을 사용하면 manager에 아래 UI가 나타나게 되며, Sniffing일때만 Log Contraction이 체크 가능
. Log Contraction을 체크할 경우에 해당 서비스는 로그 축약으로 저장
3. 로그 축약을 지원하지 않는 버젼
- OPTIMIZED 태그가 없을 경우 로그 축약 사용 불가","류재혁: 2016년 10월 형상관리에 따라 로그 축약은 WAS저장방식을 의미하며, 명령어 카운팅은 log_bridge를 통해 동일 명령어에 대해 단순 카운팅만 올리는 기능으로 용어정리가 된바 있습니다. 참고 부탁드립니다. | 현승환: 감사합니다. 팀장님 굿 ~~!!! | 신호철: 로그 축약 기능 관련하여 ""패키지/모듈 빌드 요청"" 문서에 빌드 요청 시, '로깅방식' 항목 작성 방법에 대해 안내합니다.
1. 로그 축약만 지원되는 데몬 : 로그축약 선택
2. 선택적 로그 축약 사용 데몬 : 통합로그 선택
3. 로그 축약을 지원하지 않는 데몬 : 일반로그 선택 | 신호철: 로그 모듈 뿐만 아니라 서비스 모듈 빌드 시에도 로그 축약 관련 옵션이 필요합니다. 따라서 서비스 모듈 빌드 요청 시 위와 같이 로깅방식을 선택해 주시기 바랍니다.",https://cafe.naver.com/pnpsecure2/2476
2475,현재 DBSAFER에서 마스킹 지정시 지원되는 옵션목록,"종종 문의가 오는 내용중에 하나로, 현재 마스킹 컬럼 지정시 사용가능한 옵션 목록입니다.
사용법 : ex > jumin::<jumin>::[0-9]{7}$
jumin 번호 checksum계산 일치시 마스킹 수행
<jumin> - 주민번호에 대해 checksum 바이트를 검사
<biz> - 사업자 번호에 대해 checksum 바이트를 검사
<unicode> - 문자열을 unicode로 처리
<trim> - 앞, 뒤로 공백 문자를 제거
<mloc> - 특정 범위를 마스킹을 수행하는 옵션
=> 구체적 사용법 : https://cafe.naver.com/pnpsecure2/216
<euckr> - 문자열을 euc-kr로 인식해서 처리
<utf8> - 문자열을 utf8로 인식해서 처리
<utf16> - 문자열을 utf16로 인식해서 처리
<ebcdic> - 문자열을 ebcdic으로 인식해서 처리
<mignore> - 마스킹 패턴에 부합하지 않을 경우 마스킹 처리를 하지 않는 옵션",댓글 없음,https://cafe.naver.com/pnpsecure2/2475
2471,명령어 대소문자 구분 기능 관련,"명령어 객체에서 대소문자 구분 옵션 기능
해당 기능은 DBMS에 지원하지 않고 있습니다.
DMBS의 경우, 정책 명령어를 그대로 정규식으로 검사하고 있어 대소문자를 항상 구분하고 있습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/2471
2396,[TIP]로그인 실패 로깅 기능(login_try_audit) 지원 DBMS종류,"로그인 실패 로깅 기능(login_try_audit)이란?
사용자가 DBMS/Telnet/SSH 접속 시도 시에 패스워드 실패 등 으로 인한 접속 실패 시 로그를 기록하는 기능입니다.
해당 기능이 유용하다고 생각되는 이유는 악의적인 목적으로 계속 접속을 시도하는 행위를 판단할 수 있기 때문이라고 생각됩니다.
현재(2018년 8월 30일) DBSAFER에서는 총4개 DBMS만 해당 기능을 지원하는 것으로 확인되었습니다.
(연구소 류재혁 팀장님에게 확인한 내용입니다.)
- MS-SQL
- Oracle
- Sybase
- UDB(DB2)
추가적으로 연구소에서는 해당기능을 ""세션 격리 기능"" 이라고 부른다고 합니다.
이유는 로그인 실패 로깅 기능은 세션격리 기능에서 사용할려고 구현된 것이라 연구소 내부적으로는 해당 기능을 ""세션 격리""라고 부른다고 합니다.
** 세션 격리 기능 : 특정횟수 이상 로그인을 실패하였을 경우 접속 시도가 악의적인 접근이라 판단하여 대상 사용자의 접속 시도를 막기 위해 격리 시키는 기능으로 격리된 사용자는 접속 시도할 경우 차단됩니다.",류재혁: 로그인 실패 기록을 위해서는 .conf/login_try_audit.conf파일을 생성할 경우 사용할 수 있습니다.,https://cafe.naver.com/pnpsecure2/2396
2393,SecureCRT 8.X 사용시 keyboard-interactive Authentication Failed 오류 팝업,"안녕하세요. 최근에 SecureCRT 8.5를 사용하는 고객사에서
keyboard-interactive Authentication Failed 오류 팝업 현상이 발생하였으며,
조치 방법은 아래와 같습니다.
1. Client에서의 조치 방법
SecureCRT 접속시 ""keyboard interactive"" 의 체크를 제거 후 접속하시기 바랍니다.
2. DBSAFER Server에서의 조치 방법
/usr/local/etc/sshd_config 파일의 아래의 부분 수정 후 ssh 서비스를 재시작합니다.
#ChallengeResponseAuthentication yes   => ChallengeResponseAuthentication no
- 접속시 오류 화면
- SecureCRT에서 조치 방법",댓글 없음,https://cafe.naver.com/pnpsecure2/2393
2283,[TIP] 결과 값 파일 저장,"[결과 값 파일 저장 관련 확인 방법]
아래와 같이 로그 데몬 설정에 따라 결과 값이 파일로 저장됩니다.
- 설정 파일명: /dbsafer/.conf/pnp_log.conf
- 설정 항목: max_rtn_dblog_size
(예시) 결과 값 크기가 64K 이상일 경우 결과 값 파일 저장
##############################################################################
# Max size of query return data to save into DBMS(in byte).
# (default. 64k, max 2G)
##############################################################################
#max_rtn_dblog_size=65536
'매니저 서비스 로그 조회 > 명령어 탭 > 결과 값 파일' 에서 결과 값에 대한 파일 저장 여부를 확인할 수 있습니다.
파일이 저장될 때, 매니저에서는 결과 값 파일이 O로 변경되고 아래 서버 경로에 파일로 저장됩니다.
- 결과 값 파일 경로: /home/dbsafer/filelog/",댓글 없음,https://cafe.naver.com/pnpsecure2/2283
2191,[TIP][oms_dms] 다중접근통제시스템 가이드,"oms_dms 모듈 설정에서 설정할 수 있는 다중접근통제시스템 설정법을 공유 드립니다.
다중접근통제시스템이란 하나의 PC Agent로 서로 다른 DBSAFER 서버 2개를 모두 사용할 수 있는 설정 방법입니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/2191
2185,"[TIP] 세션 재현(Terminal, Windows) 관련 가이드","세션 재현 기능(Terminal, Windows) 사용을 위한 기본적인 설정법 및 테스트 방법을 공유 드립니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/2185
2143,[WTA] DBSAFER 서버에 NAT IP가 설정되어 있을 경우 SA WTA RDP 설정,"DBSAFER 서버에 NAT IP가 설정되어 있을 경우,
WTA로깅에 필요한 Server Agent 옵션 설정에 대하여 설명합니다.
아래의 그림과 같이 NAT IP 가 설정된 후에 REAL IP로의 통신이 방화벽에서 막혀있을 경우
Server Agent 가 설치된 Windows 서버의 설치 디렉토리(ex. C:\Program Files\PNPSECURE\NODESAFER\conf)에
wtaconfig.ini 에 DBSAFER 서버의 NAT IP 가 아닌 REAL IP 정보만 전달되어 RDP 세션 로그가 정상적으로 생성되지 않습니다.
따라서 DBSAFER Manager -> Server Agent 관리 설정 -> 추가설정란에
NAT_DBSAFER_IP=         -> DBSAFER Log+GW, GW 서버 NAT IP 입력
NAT_LOGSERVER_IP=      -> DBSAFER Default, Log, Log+GW 서버 NAT IP 입력
위의 설정을 추가로 입력하면 정상적으로 로깅 되는 것을 확인할 수 있습니다.
여러개의 IP를 입력해야할 시 '+' 로 연결하여 입력합니다.
정상 적용된 상태는 아래와 같습니다.
이상입니다.","남신우: 적용버전이 없어서 아쉽네요 | 안형철: 해당 옵션 적용 버전은 1.2.6.19 이상입니다.
https://bugs.pnpsecure.com/view.php?id=8280",https://cafe.naver.com/pnpsecure2/2143
2014,DBSAFER INLINE 설치 및 구성,DBSAFER를 INLINE 방식으로 구성할 때 설치 방법 및 주의사항 등에 대해 작성한 문서를 공유합니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/2014
1943,"""bash:fork resource tempoorarily unavailable"" 오류 발생합니다.",OS 자체에서 운영이 가능한 thread 수를 넘어서 발생된 것으로 예상을 하고 sysctl 에서 수치 조정을 하시기 바랍니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/1943
1940,"sniff 모듈 패치 이후에 ID, APP 에 대한 로깅이 되지 않아서 정책으로 차단이 됩니다.","패치 이후에 SYN 이 없기에 중간 부터 로깅을 하므로 ID, APP 정보 로깅을 하지 못해서 발생한 사항입니다.
패킷이 적은 경우 session idle time 설정 시간으로 인해 session logout 처리 된 이후에 접속할 경우 해당 사항이 발생할 수 있으며, session idle time 설정을 상황에 맞게 늘려 주시기 바랍니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/1940
1939,GW 서버 재구성 후 가동을 시킨 이후 Log 서버의 log 데몬과 통신이 되지 않습니다. (deny 13 오류 발생),"고객사 서버 보안 솔루션에서 차단될 수 있습니다.
네트워크를 확인하시기 바랍니다.
[기타사항]
deny 13 이슈는 selinux 등의 방화벽 관련된 이슈가 있을 때 주로 발생합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/1939
1938,3-tier 구간의 암호화 지원 가능한가요?,3-tier 구간의 암호화 지원하지 않습니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/1938
1937,보안계정의 패스워드가 복호와가 가능한 암호화 방식인가요?,"보안계정 암호화 방식은 sha1, sha256, sha512 등을 지원하며, 단반향 암호화 방식입니다.
암호화 방식 및 설정 관련해서는 아래의 정보를 확인하세요.
https://docs.google.com/presentation/d/1L4vYNXCsrEAnDCXQfAoKMnYWXM4vCCaaKlRmIFPoWWA/edit#slide=id.p4",댓글 없음,https://cafe.naver.com/pnpsecure2/1937
1935,"마스킹 정책 설정 시, 정책에 포함된 컬럼이 존재 하지 않아도 malformed packet error 발생;toad의 경우 에러 발생하면서 데이터 조회 가능, workbench의 경우 조회가 안됩니다.","마스킹 객체가 컬럼명으로 되어있으면 툴이 보내는 패킷도 마스킹 될 수 있으니 객체를 테이블.컬럼명으로 변경 하도록 안내
특히 name 컬럼을 마스킹 할 경우 발생 빈도가 높습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/1935
1934,agent 모듈 패치 이후에 mssql 서비스 가동이 되지 않습니다.,"모듈 명칭을 mssql_2000 에서 mssql 변경하여 모듈을 찾지 못하여 발생한 상황이며,
수정된 mssql 파일로 서버에 패치하면 정상동작됩니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/1934
1929,"policysync 사용 시에 ""manager_auth_management"" 옵션이 궁금합니다.",auth_server 의 매니저 계정과 서버의 IP 를 매칭 시켜 주는 옵션 사항으로 policysync 시에 active log 서버의 ip 로 standby log 서버의 테이블 정보가 입력 되면서 서로 언매칭 되기에 이를 수정하기 위한 옵션입니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/1929
1928,"""pnp_sshd"" 모듈이 ""동적 모듈이 아닙니다."" 라는 오류와 함께 동작하지 않습니다.","openssl.i686 모듈은 설치가 되어있으나 해당 모듈의 의존성이 있는 다른 모듈이 없어서 라이브러리 문제로 이슈 발생됨
관련 라이브러리 재설치하시기 바랍니다. (yum install 을 통해서 설치시 의존 파일도 같이 설치됩니다.)",댓글 없음,https://cafe.naver.com/pnpsecure2/1928
1927,mariabdb 의 cpu 사용률이 100% 로 지속 사용 문제가 발생되고 있음,"11일간 mariadb 의 특정 쿼리가 sendding data 로 처리가 되지 않고 있어서 lock 이 발생된 상황이 유지가 되었으며 해당 사유로 cpu 사용률이 높아졋음
- mariadb 의 가장 오래된 process 를 kill 처리함",댓글 없음,https://cafe.naver.com/pnpsecure2/1927
1926,DBSAFER MariaDB 버전은 어떻게 되나요?,DBSAFER V5.0은 MariaDB 10.X 버전을 사용합니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/1926
1925,Active LOG 서버에 duplex 가 failover 가 되었는데 GW 서버에서는 계속 Active LOG 서버로 접근하고 있음,"duplex 설정 후 관련 log 및 oms dms 등 모듈 재시작을 하지 않아서 duplex 상태를 확인하기 않기 때문에 발생하였습니다.
모듈 재시작 하시기 바랍니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/1925
1923,Cubrid 서비스 가동 시에 추가로 서비스가 구동되나요?,Cubrid 의 경우 http 통신으로 manager 세션이 접속 후에 port 를 지정하여서 실세 서비스 세션이 접속을 하는 구조로 서비스 port 를 지정하여서 가동 될 수 있도록 forward 서비스가 하나더 가동이됩니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/1923
1922,CentOS 5.9 에서 서버 패키지가 설치 후 삭제 그리고 재설치 시에 오류가 발생합니다. (오류 로그 : no such file or dicrectory),파일 권한 혹은 disk 오류로 예상되고 있는 사항으로 설치가 안되는 것이 아닌 설치 시에 오류 로그를 기록하지 못하는 오류임,댓글 없음,https://cafe.naver.com/pnpsecure2/1922
1920,fakeapp finder 기능이 TDI 2.1.6.1 이후 기존과 다른게 동작이 되고 있음,"""NAT_IDENTITY_EXTEND_TYPE"" 옵션을 oms dms 옵션에 추가를 하여 옵션에 따라서 DBMS, FTP, Terminal 의 tool 정보도 같이 수신 할 수 있도록 개선을 하였음
windows 의 blue screen 문제 발생 가능성이 있으므로 default 값을 0 으로 하여서 옵션 설정 시에 동작이 되지 않도록 변경함. 옵션을 변경 이후에 정상적으로 동작을 하고 있음",댓글 없음,https://cafe.naver.com/pnpsecure2/1920
1919,등록 된 서비스 중에 특정한 서비스(RDP)만 NAT 를 하지 않도록 변경이 가능한지?,"요청한 기능은 RDP 접속을 사용자가 NAT 로(DBSAFER 경유하여) 접속은 안하였으면 하지만 RDP 에서 wta 서비스가 전달하는 화면 데이터는 받아야 한다.
문의 기능은 현재 지원을 하지 않으며, 만약 서비스 설정을 변경 할 경우 RDP 의 화면을 받을 서비스가 사라지기 때문에 불가능함",댓글 없음,https://cafe.naver.com/pnpsecure2/1919
1918,AWS SES서버에 메일을 전송하기 위한 기능 추가 관련 해당 모듈 테스트 오류,mailer 설정 시 login 으로 설정하고 id / pw 입력,댓글 없음,https://cafe.naver.com/pnpsecure2/1918
1917,마스킹 해제 기안 시 정상 동작하지 않는 현상,마스킹 해제 기안의 경우 정규식 마스킹 정책 지원 불가,댓글 없음,https://cafe.naver.com/pnpsecure2/1917
414,서비스 모듈의 실시간 감사로그 저장 기능 매뉴얼,"안녕하세요
기술지원부 신현종입니다. D 사 장애건으로 인해 장애 보완할 수 있는 기능이 개발되었습니다.
서비스데몬이 감사로그파일을 추가로 생성하여 장애시에도 감사로그를 만들 수 있게 하는 기능입니다.
| 첨부파일:  서비스 모듈의 실시간 감사로그 저장 기능 매뉴얼.pdf",댓글 없음,https://cafe.naver.com/pnpsecure2/414
316,[장애대응]DBSAFER 서버 데몬 장애시 수집사항,"1. 수집 사항
데몬에 문제가 생겼을 경우, 기본 적으로 수집할 수 있는 정보는 아래와 같습니다. 물론 모두 필요한 것은 아니지만, 가능한 한 많은 정보가 제공될 때 분석이 용이합니다.
● 문제의 데몬 버전
● 데몬 로그 수집
● coredump
● lsof -Pp
● netstat -anp | grep PID
● show full process list
● dmesg
● ifconfig
2.데몬 버전 및 로그
기본적으로 문제가 되는 데몬의 버전 정보와 데몬 로그는 필수적으로 수집해야 합니다.
데몬의 버전은, 해당 모듈의 상세 버전 정보를 수집합니다.
ex) pnp_ora --version
데몬 로그는, 해당 문제가 발생한 시기의 전/후의 데이터가 필요하며 해당 데몬과 관련이 있을만한 데몬로그도 추가하여 같이 수집합니다.
3. COREDUMP
데몬이 죽는 증상이나, Hang걸리는 증상이 있는 경우, coredump를 통하며 문제를 분석할 수 있습니다.
[데몬이 Hang]
gcore명령어를 이용하여 coredump를 생성합니다.
gcore [-o 파일명] PID번호
[데몬이 죽는 경우]
coredump가 남도록 ulimit을 설정하여 corefile을 생성합니다.
이때, ulimit의 설정값은 상속되므로 다음과 같은 방법으로 처리한다.
1. 일반 데몬 문제 시
ulimit -c unlimited -> 해당 데몬 재 시작 -> coredump 수집
2. 서비스 데몬 문제 시
ulimit -c unlimited -> pnp_launcher 재시작 -> 해당 서비스 재시작 -> coredump 수집
그리고, coredump전달 시, 실행 바이너리를 같이 전달합니다.
[Coredump를 줄 수 없는 환경]
Core파일의 backtrace값을 전달해 주셔야 하며, 개발자와 통화하여 필요시 추가정보 전달이 필요합니다.
> gdb pnp_ora core.2345
(gdb) thread apply all bt
4. lsof, netstat
데몬에 문제는 소켓이나, 파일 디스크립터 등에 따라서 문제가 될 수 있으므로, 해당 정보를 수집하도록 합니다.
Open된 File(또는 소켓)정보를 볼 수 있도록 다음의 명령어를 사용합니다.
lsof -Pp PID번호
Network에 접속된 정보를 확인하기 위하여 다음의 명령어를 사용합니다.
netstat -anp | grep PID번호
5. MariaDB Process
데몬의 동작이 멈추는 경우, MariaDB의 특정 쿼리에 의하여 Hang이 발생되는 경우가 다수 발생되었습니다.
해당 상황에서는 다음과 MariaDB의 Process정보를 수집할 수 있습니다.
1.“pnp dbms_info” 명령을 사용하여 MariaDB 접속 패스워드 확인
2. MariaDB접속 후, “show full processlist;”실행
6. dmesg, ifconfig
또한 데몬에 문제가 커널동작이나 네트워크 동작에 문제가 있지는 확인하기 위하여 “dmesg”와 ifconfig정보가 추가적으로 필요합니다.
“dmesg”, “ifconfig” 실행한 화면을 수집합니다.","강정근: 3.coredump 에 대한 추가의견 남깁니다.

.코어덤프 파일은 데몬상태의 상세정보를 확인하기 위한 자료입니다. (비정상종료 시 포함)
.코어덤프 파일 제공 시, 해당 모듈의 바이너리 파일도 같이 전달 해주시기 바랍니다.
.코어덤프 파일을 gdb 로 실행하여 확인된 backtrace 정보를 같이 전달 해주시기 바랍니다. (필드와 완변하게 동일한 환경이 없으면, 코어덤프 파일의 확인이 불가능함)
==> #gdb ./[모듈 바이너리 파일명] [코어덤프 파일명]
==> #(gdb) bt
==> #(gdb) thread apply all bt | 진선태: 코멘트 감사합니다. | 진선태: 중요한 정보 잘 정리해 주셔서 고맙습니다. 수고 많으셨구요. 위 기술한 내용 이외에도 추가로 보완되어 다른 인원들에게 도움 될 수 있는 정보는 지속 업데이트 부탁드립니다. 감사합니다.",https://cafe.naver.com/pnpsecure2/316
286,[TIP] DBSAFER MYSQL 포트 변경 시 웹 제품 동작 방법 안내,"안녕하세요. 품질보증팀 최진주입니다.
DBSAFER MYSQL 포트 변경 시 웹 제품 동작을 위한 방법 안내하여 드립니다.
[문제 사항]
DBSAFER MYSQL 포트 변경한 후 기존 웹 제품 동작 에러
[해결 방법]
JNDI 관련하여 데이터베이스 포트 변경 (단, 웹플랫폼 패키지 설치된 상태)
파일 경로: /usr/local/apache-tomcat-7.0.73/conf/server.xml
변경 부분:
<!-- Global JNDI resources
Documentation at /docs/jndi-resources-howto.html
-->
<GlobalNamingResources>
<!-- Editable user database that can also be used by
UserDatabaseRealm to authenticate users
-->
<Resource name=""UserDatabase"" auth=""Container""
type=""org.apache.catalina.UserDatabase""
description=""User database that can be updated and saved""
factory=""org.apache.catalina.users.MemoryUserDatabaseFactory""
pathname=""conf/tomcat-users.xml"" />
<Resource name=""jdbc/pnpJNDI""
factory=""com.pnpsecure.global.datasource.PnpDataSource""
auth=""Container""
type=""javax.sql.DataSource""
maxActive=""100""
maxIdle=""30""
maxWait=""10000""
testWhileIdle=""true""
validationQuery=""SELECT 1""
validationInterval=""30000""
timeBetweenEvictionRunsMillis=""60000""
username=""""
password=""""
driverClassName=""com.mysql.jdbc.Driver""
url=""jdbc:mysql://127.0.0.1:3306/dbsafer3?useUnicode=true&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull""/>
</GlobalNamingResources>
이상입니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/286
238,[wta]wta.conf 설정,"WTA conf 설정에 대해서 설명 합니다.
[CONF 설정]
USE_WTA=0
사용 여부 설정 (Default : 0 )
IMAGE_BITS=4  (Default : 4 )
이미지 비트수 설정
IMAGE_TYPE=0
이미지 칼러 설정  (Default : 0 )
WAIT_TIME_MIN=1
이미지 캡쳐 설정  (Default : 1 )
이벤트 발생 시에 1초 간격으로 캡쳐
WAIT_TIME_MAX=300
이미지 최대 대기 캡쳐 설정 (Default : 300 )
이벤트 발생이 없어도 최대 300초에 한번은 캡쳐
DELTAIMAGE_MAX=32
전송 이미지 전/후 차이만 전송하여 이미지 캡쳐 및 전송수신 조정 ( Default : 32 )
설정 값은 상기와 같습니다.
설정의 예)
컬러 16 Bits, 이벤트를 최소 0.5초 주기로 기록, 특정 이벤트가 없어도 10초에 한번식 화면 저장
USE_WTA=1
IMAGE_BITS=16
IMAGE_TYPE=1
WAIT_TIME_MIN=0.5
WAIT_TIME_MAX=10
DELTAIMAGE_MAX=64",댓글 없음,https://cafe.naver.com/pnpsecure2/238
237,보안계정 자동 로그인 정보 초기화 방법,"PC Agent 자동로그인 시에 정보 초기화 방법에 대해서 전달합니다.
자동로그인을 할 경우 regedit 에 USER ID 와 PW 가 저장이됩니다.
""로그아웃"" 기능을 사용하지 않을 경우 해당 정보는 초기화가 되지 않습니다.
일부 고객사의 경우 자동 로그인을 사용하지만 ""로그아웃"" 기능은 비활성화하는 곳이 있는 것 같은데 이런 고객사에서 계정 변경을 원할 경우 가장 빠른 방법은 regedit 에서 정보를 초기화 하는것 입니다.
[초기화 방법]
·  USER ID 및 PW 삭제
o HKEY_CURRENT_USER\Software\PNP SECURE\DBSAFER Agent/UserID
o HKEY_CURRENT_USER\Software\PNP SECURE\DBSAFER Agent/UserPW
·  USER ID 및 PW 삭제 (상기 위치에 값이 없을 경우)
o HKEY_USERS\.DEFAULT\Software\PNP SECURE\DBSAFER Agent/UserID
o HKEY_USERS\.DEFAULT\Software\PNP SECURE\DBSAFER Agent/UserPW
상기 정보를 삭제 후 재시작하면 ID/PW 입력창이 열립니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/237
236,웹보고서 설치 후 서버 hostname 변경 시 처리 사항,"고객사에 서버 OS 를 설치 한 이후에 고객사 요청으로 서버 HOSTNAME 을 변경하는 경우가 발생되고 있습니다.
이 때 문제가 웹리포트 부분에서 문제가 될 수 있는 부분이 있어서 알려드립니다.
[발생경우]
서버 OS 를 원격 설치 시
OS 설치 후 hostname 변경 시
[문제 발생 사항]
기존에 생성한 웹리포트 라이선스의 경우 변경 이전의 HOSTNAME 이 등록되어 있기 때문에 웹리포트에서 서버를 호출 할 때 라이선스 오류가 발생됨
hosts 내용에 변경된 서버의 hostname 이 정의 되지 않아서 라이선스 생성 및 읽어 올 때 문제가 발생됨
[대처 방법]
·  국내 일반 고객사
o ""ozlicense.xml_cert.key"" 파일을 삭제 후 라이선스 파일을 재생성한다.
·  고객사 전용 라이선스 고객사 및 해외 고객사
o 라이선스 재발급 요청
[기타사항]
HOSTNAME 을 변경하고 Reboot을 하기 이전에 라이선스를 삭제 및 변경해 주시기 바랍니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/236
235,[FTP] Passive 통신 시에 방화벽의 open port 제한 설정 방법,"FTP 모드의 경우 두개의 통신 방식이 존재합니다.
기존의 경우 Passive 통신에 대해서 지원을 하지 못하였는데 현재는 지원이 됩니다.
단, 고객사에서 Passive 방식 사용시에 방화벽을 open 해야하는데 이때 무조건 적인 전체 open은 문제가 될 수 있습니다.
그런 경우 아래와 같이 설정하여 open포트를 제한할 수 있습니다.
echo ""PASSIVE_PORT=61000-62000"" > .conf/ftp_ip.conf
상기와 같이 설정할 경우 passive 통신 시에 open 포트를 61000 ~ 62000 사이 안에서 랜덤하게 할당합니다.
이미 사용하고 있는 포트일 경우 재시도하여서 다시 구합니다.
재시도는 최소 255 ~ 10000 회 시도합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/235
234,[SSH] 포트가 22가 아닌 서비스 등록 방법,"ssh_server.lst 에 port 정보 입력하는 방법 수정합니다. (단, 잘 못 입력하여도 정상 동작이 된 경우는 telnet 데몬에서 ssh 사용 여부를 검사하면서 자체 업데이트를 했기 때문임)
SSH 서비스가 22가 아닌 서비스의 경우 등록 시에 SSH 포트를 정의해 줄 필요가 있습니다.
정의가 되어 있지 않을 경우 ssh 를 sniff 한 것과 같이 계정 정보 등이 암호화 된 값으로만 보입니다.
[SSH 판단방법]
입력된 IP 주소와 PORT 기반으로 통신을 하여 응답된 결과를 기준으로 SSH 여부를 판단함
ssh_server.lst 에 기 입력되어 있을 경우 입력된 PORT 로의 접속을 SSH 로 판단함
[문제발생]
만일 SSH 포트가 다른 경우(ex. 2222) 의 경우 최초는 telnet 으로 접속을 하게되면서 통신을 하는데 이때 SSH 통신 여부 확인이 안되었을 경우 2222 서비스는 telnet 으로 판단하여서 암호화된 통신을 구별하지 못함
[정의방법]
touch .conf/ssh_server.lst
echo 192.168.10.10:2222 >> .conf/ssh_server.lst
[기타사항]
상위에서 언급한 문제가 발생하였을 경우 ssh_server.lst 작성 후 서비스 재시작이 필요함",댓글 없음,https://cafe.naver.com/pnpsecure2/234
233,다중 접근 동작 및 설정 방법 전달,"다중 접근 통제에 대해서 동작 및 설정 방법을 간략하게 전달합니다.
다중 접근 통제
하나의 PC Agent 로 서로 다른 DBSAFER v 3.0 서버 2 개를 모두 사용 하는 방법
사용 예
본사와 분사에 DBSAFER v 3.0 각기 도입되어 있으며 서로 다른 서비스를 보안 하는 구조에서 특정 사용자가 본수와 분사의 서비스를 모두 사용해야할 경우
동작설정
다중 접근 통제는 PC Agent 의 로그인 및 서비스 리스트를 전달하는 dbsafer_oms_dms 과의 통신 시에 모든 GW 서버와 통신을 하는 것이다.
Server 1 과 Server 2 가 있을 때 사용자는 Server 1 에만 접속을 하는데 Server 1 에서의 동작은 local 에서 login을 허용 후 Server 2 로 사용자 정보를 전달하여서 Server 2 에서도 사용자가 login 될 수 있도록 동작함 (사용자 login 통신 시에 Serve 1 과 Server 2 를 모두 대기 하게 되므로 처리 시간이 지연 발생됨)
장점 및 단점
각기 다른 DBSAFER v 3.0 서버를 동시에 사용 할 수 있다. (이중 로그인 및 선택 로그인 불필요)
최초 로그인 및 동기화 시간의 지연이 발생 (네트워크 단의 지연율^GW 서버 수)
설정방법
dbsafer_oms_dms.conf 수정
ACCESS_CONTROL_SERVER_USE = YES
사용 여부 설정
ACCESS_CONTROL_SERVER_BALANCE = 192.168.6.68
상대 DBSAFER v 3.0 서버의 GW IP 정보 입력
Server 1 에서 설정 시에는 Server 2의 IP 를 입력
ACCESS_CONTROL_SERVER_LIST = 192.168.6.191+192.168.6.68
DBSAFER v 3.0 서버 전체 GW IP 입력
Server 1 과 Server 2 의 전체 IP 를 입력
입력 예시)
IP 192.168.6.191 서버와 IP 192.168.6.68 서버 간에 다중 접근을 설정한 경우로 설정은 192.168.6.191 서버에서 설정한 설정 값
##############################################
## 다중 접근 통제 시스템
##############################################
# 다중 접근통제시스템 사용 유무
# Example : YES (사용), NO (미 사용)
# Default : NO
ACCESS_CONTROL_SERVER_USE = YES
# 서버 리스트 : Server 에서 참조 (다중 접근통제 시스템 사용시에만 설정)
# 접근통제시스템#1의 GW에서는 접근통제시스템#2의 GW IP를 작성
# 작성하는 순서에 따라서 우선순위 결정
# Example : 192.168.100.102+192.168.100.103
# Default : NULL
ACCESS_CONTROL_SERVER_BALANCE = 192.168.6.68
# 서버 리스트 : Client 에게 전송 (다중 접근통제 시스템 사용시에만 설정)
# 접근통제시스템#1,#2의 모든 GW IP 작성
# Example : 192.168.100.100+192.168.100.101+192.168.100.102+192.168.100.103
# Default : NULL
ACCESS_CONTROL_SERVER_LIST = 192.168.6.191+192.168.6.68",댓글 없음,https://cafe.naver.com/pnpsecure2/233
232,DNS 설정 시의 MySQL 통신 지연 문제 및 처리 방법,"DNS 서버 설정 시에 MySQL 통신 지연 문제 발생 원인 및 처리 방법에 대해서 전달합니다.
[문제사항]
DBSAFER 서버에서 DNS 서버를 설정 하였을 때 MySQL 접속 지연 혹은 too many connection 으로 접속이 되지 않음
증상확인으로 mysql process 에서 ""unauthenticatied user"" 가 확인됨
[발생원인]
DNS 서버의 질의로 인하여 응답대기로 지연 발생 및 DNS 확인하면서(단독 시) 시에 login step 에서 DNS 대기를 하면서 발생
[처리방법]
MySQL 에서 DNS 를 사용하지 않도록 설정
my.cnf 설정 후 mysqld 재시작
설정명 : skip-name-resolve
[mysqld]
skip-external-locking
skip-host-cache
skip-locking
skip-name-resolve
hosts 에 hostname 으로 IP 등록
hostname 명으로 log 서버, gw 서버 모두 등록
[지식정보]
mysql 에서 DNS 를 참고하는 이유
MySQL 접속 시에 domain name 을 사용하지 않고 ip address 를 사용하고 있는데 DNS 에 질의를 하는 이유는 MySQL 에서 reverse dns query(lookup) 을 사용하기 때문입니다. reverse dns query 란 일반 네트워크에서의 DNS 참고의 반대로 ip address 를 domain 으로 변경하기 위해서 사용합니다.
MySQL 에서는 ip address 를 hostname 으로 변경하여 접속을 시도합니다. reverse dns query 의 장점은 log 의 상세화가 있습니다.
Reverse DNS Query (역방향 DNS)의 문제점
Reverse DNS Query 의 경우 DNS 에 잦은 질의를 하기 때문에 네트워크 전반적인 부하 혹은 DNS 서버의 부하를 촉구합니다. 그런 관계롤 DNS 에서 Reverse DNS Query 를 차단할 수 있습니다. 이 경우에는 ping 이나 traceroute 등의 명령어에도 문제가 발생 할 수 있습니다.
권장 설정은 hosts 파일 설정으로 하겟습니다.
DNS 서버를 참고하는 모든 부분(ex, time.bora.net 등)에 수동으로 hosts 파일에 입력 처리하면 Reverse DNS Query 로 인한 지연 문제는 없을 것 입니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/232
231,Caswell 장비 Bypass,"- Bypass 관련 모듈 명
network-bypass.ko
- dbsafer_fodcontrol 모듈 정보
DBSAFER FODCONTROL (DS-1000-CASWELL) 1.1
- dbsafer_fodcontrol 모듈 설치 방법
1. dbsafer_fodcontrol 모듈은 PKG 또는 별도 압축파일로 제공된다.
(PKG : PKG명/etc/fod/ds_1000_caswell)
2. install.sh를 통해서 설치한다.
dbsafer_fodcontrol 파일을 /dbsafer3 에 복사
network-bypass.ko 파일을 /dbsafer3/modules 에 복사
3. dbsafer_fodcontrol.conf.sample 파일을 /dbsafer3/.conf/ 에 복사한다.
4. Bypass pair 를 /dbsafer3/.conf/dbsafer_fodcontrol.conf 파일에 설정한다.
use_bypass_pair = 1 ( 1 eth0-eth1, 2 eth2-eth3 )
COMMON OPTION 부분은 다른 FOD 모듈과 동일하다.
5. dbsafer_fodcontrol start 를 통해 실행한다.
6. 옵션 사항
start  : dbsafer_fodcontrol을 구동하며, 전원 ON, 전원 OFF, WATCH DOC을 구동한다.
또한 COMMON OPTION 부분의 내용을 적용한다.
stop   : 현 상태에서 dbsafer_fodcontrol 만 종료한다.
inline : 강제 Inline mode로 전환한다.
bypass : 강제 bypass mode로 전환한다.
status : 현재 상태를 보여 준다.
live time : 강제 Inline mode에서 WATCH DOC을 구동시켜 준다. (start 상태로 되며, 설정한 time에 따라 동작한다.)
reset  : inline 상태 정보를 Proxy 서버로 사용할 수 있도록 nomal 모드로 전환한다.
(dbsafer_fodcontrol stop 상태에서 사용 가능)
- 모듈 동작 방식
network-bypass.ko 파일이 Caswell 장비의 Bypass를 구동하기 위한 모듈이다.
먼저 insmod 로 Kernel 모듈로 로드한다.
# insmod network-bypass.ko
# lsmod | grep network_bypass  (커널 모듈 확인)
network_bypass         80256  0
i2c_core               57537  3 network_bypass,i2c_ec,i2c_i801
Bypass를 위한 설정 파일은 ""/sys/bus/i2c/devices"" 에 ""0-0022"", ""0-0026"" 이 존재한다.
""0-0022""는 ""eth2-eth3"" 이며, ""0-0026""는 ""eth0-eth1"" 대한 설정 관련 디렉토리이다.
""eth0-eth1""에 대한 bypass 설정 확인은 ""0-0026""에서 확인이 가능하다.
bpe0       : 0 인 경우는 nomal 모드로 동작하며, 1 인 경우 전원 OFF시 Bypass
nextboot0  : 0 인 경우는 nomal 모드로 동작하며, 1 인 경우 전원 ON 시 Bypass
bypass0    : 0 인 경우 Nomal, 1인 경우 Network down, 2인 경우 Bypass",댓글 없음,https://cafe.naver.com/pnpsecure2/231
230,[KMS] 서버 접속 검사 동작 설명,"DBSAFER v 3.0 의 서버 접속 검사 동작
DBSAFER v 3.0 의 서버 접속 검사 기능의 최초 목적은 불완전한 DBSAFER 서비스로 인한 DBMS 접속 장애를 판별하기 위함이었습니다.
그런데 현재는 접속 장애 확인 보다는 보호 대성 DBMS 의 가동 및 접속 가능 여부를 판단하기 위해서 사용됩니다.
기존의 서버 접속 검사는 등록된 서비스 접속 확인과 보호 대상 DBMS 서버 접속을 확인하였습니다.
이 때 둘중에 하나만 이라도 실패를 할 경우 매니저에서는 검사 실패로 표시됩니다.
보호 대상 서버 장애 인지 DBSAFER 서비스 장애인지 확인이 관리자 입장으로서는 어렵습니다.
그런 사유로 아래와 같이 서버 접속 검사 방법이 변경되었습니다.
서비스 가동 상태에 따라서 서버 접속 검사 방법 구분
DBSAFER 서비스 장애 인지 보안 대상 DBMS 서버 장애인지 구분하여 표시
동작은 아래와 같습니다.
가동 중인 서비스에 대한 서버 접속 검사
Step 1) 매니저 서버 접속 검사 실행 요청
Step 2) dbsafer_agent 에서 DBSAFER 서비스 모듈과의 통신 확인
Step 3) dbsafer_agent 에서 보호 대상 DBMS 서버와의 통신 확인
Step 4) Step 2 와 Step 3 의 결과를 매니저에 전달
정지 중인 서비스에 대한 서버 접속 검사
Step 1) 매니저 서버 접속 검사 실행 요청
Step 2) dbsafer_agent 에서 보호 대상 DBMS 서버와의 통신 확인
Step 3) Step 2 의 결과를 매니저에 전달
< 매니저에서의 표시 사항 >
가동 중인 서비스에 대한 서버 접속 검사
성공
실패 : 서비스 접속과 보호 대상 DBMS 접속 둘다 실패
실패(서비스) : 서비스 접속만 실패
정지 중인 서비스에 대한 서버 접속 검사
성공
실패","남신우: [테스트]-매니저 버전(Build 5186)
매니저: 객체/그룹관리 - 서비스 - 서비스 선택 후 우클릭 - 객체 복사 후 적용 버튼을 누르지 않고 - 서버 접속 검사: 위 결과와 같음
(실패의 경우: 실패(서버)로 표기됨)

[NBP 문의사항]-매니저 버전(Build 5186)
실패(서버), 실패(서비스)가 어떤 상황에서 발생하는지 문의
1. excel 불러오기를 통하여 서비스 추가, 적용 버튼을 누르지 않고 - 서버 접속 검사 할 경우(서비스는 정지상태임)
- 실패(서버) : 대상서버 접속 불가, - 실패(서비스): 대상서버 접속은 가능하나 서비스가 구동상태가 아님

2. 서비스 적용을 완료 후 미구동 상태일 경우 아래와 같이 표기됨
- 정상: 대상서버 접속 가능, 실패(서버): 대상서버 접속 불가 | 김가희: 서비스/서버 차이에 대한 자세한 설명은 아래의 게시글 참고
https://cafe.naver.com/pnpsecure2/4126",https://cafe.naver.com/pnpsecure2/230
229,[KMS] 정형화 버전별 기능 및 구분 방법,"정형화 버전별 기능 및 구분 방법
DBSAFER 에서 사용되는 정형화 방식이 구분됨에 따라서 기능 구분 및 내용에 대해서 혼란을 예방하고자 아래와 같이 기능과 버전 구분을 설명합니다. DBSAFER 운용 및 패치 시에 참고 바랍니다.
정형화
정형화는 원형 쿼리를 SQL 유형 및 변수 그리고 테이블, 컬럼을 일반적인 형식으로 구분하여 정형화하는 작업입니다. 정형화는 주로 WEB 에서 자유 사용되며, Bind 변수와 많이 사용됩니다. DBSAFER 에서는 정형화 작업을 정형화 객체 등록과 DECIDE V 3.0 에서는 명령어 결재에서 사용 됩니다.
정형화 방법
DBSAFER 에서 정형화 방법은 3번의 절차로 통해서 진행됩니다.
원형 쿼리 > 정형화 대상 쿼리 > 정형화 HASH 생성
프로토콜 별 정형화 정형화 비교 기능
DBSAFER 에서는 기존의 정형화 개발에서 HASH 값이 고려되지 않은 관계로 최초 도안시에는 정형화 대상 쿼리로 쿼리를 비교하여 정책을 적용하였습니다. 하지만 정형화 대상 쿼리 비교는 쿼리 크기로 인하여 문제가 발생되는 경우가 있어 HASH 값 비교로 방식이 변경되었습니다. 그런 관계로 프로토콜 버전마다 서로 다르게 비교를 합니다. 프로토콜 버전 마다 다른 방법은 아래를 참조 바랍니다.
Main Packet 3.7 (Time 20100118) 이하 : 정형화 대상 쿼리로 쿼리를 분석하여 비교함
Main Packet 3.P (Time 20100719) 이상 : 정형화 HASH 값으로 쿼리를 분석하여 비교함
즉, Main Packet 3.7 이하에서는 정형화 HASH 값이 DBSAFER  데이터베이스에 포함되어 있어도 실제 비교는 정형화 대상 쿼리로 된다는 것입니다.
정형화 버전별 기능
정형화 방식은 기능에 따라서 버전이 구분됩니다. 아래의 기능은 정형화 대상 쿼리르 만드는 방식이므로 정형화 방식에 따른 차이와 상관없이 모든 프로토콜에서 확인되야 합니다.
V 1.0.0.0 : String 에 대해서 'S' 치환, int 에 대해서 '0' 치환, 주석 제거
V 1.0.0.1 : V 1.0.0.0 에서 기능 추가로 공백제거 및 정형화에서 한글 제거, '@' 제거
V 1.0.0.2 : V 1.0.0.1 에서 기능 추가로 따옴표로 입려된 컬럼 및 테이블의 변수 인지 수정
프로토콜 별 정형화 버전
정형화 버전은 프로토콜에 따라서 기본적으로 Build 되는 버전은 아래와 같습니다.
Main Packet 3.7 (Time 20100118) 이하 : V 1.0.0.0
Main Packet 3.P (Time 20100719) 이상 : V 1.0.0.2
정형화 버전 확인 방법
정형화 버전이 구분된 이후 빌드되는 매니저와 서비스 모듈의 버전에는 아래와 같이 표시가 되고 있습니다. 또한 DECIDE V 3.0 의 경우 BBS 에 표시되고 있습니다.
매니저 : 시스템설정의 매니저 동작에서 확인 가능
서비스 : 상세 버전 정보의 FORMAL_QUERY MODULE VERSION: 1.0.0.X
정형화 패치 시 주의사항
정형화를 패치 할 경우에는 매니저와 서비스 모듈 그리고 DECIDE V 3.0 의 정형화 버전을 모두 통일시켜야합니다. 하나라도 다를 경우 정형화에 차이가 발생되므로 문제가 발생됩니다.
제약사항
@로 시작하는 변수는 무시됨
예) SelctProcedure(@T1,@T2,T3) = SelctProcedure(@T1,@T2,T3,T4) 동일한 쿼리로 인식함
한글로 구성된 컬럼 및 테이블명은 무시됨
예) Select `이름` from `명단` = Select `사번` from `회원` 동일한 쿼리로 인식함
상기 제약사항은 다른 DBMS 보다는 MSSQL 에서 많이 발생될 수 있습니다.
MSSQL 의 경우 @ 와 함께 바인드 변수 및 일반 변수 그리고 함수까지 사용을 합니다.
현재 정형화에서는 함수와 변수를 구분할 수 없는 관계로 현재 제약사항이 있습니다.
또한 한글의 경우 정형화를 하면서 한글 부분이 깨지는 현상이 발생하면서 문제소지가 있습니다.
현재는 한글을 전체 무시하고 있으므로 주석 및 변수로 입력된 한글을 무시하여 전체 정형화에 문제는 없습니다.
하지만 한글이 주가 되는 쿼리의 경우 문제의 소지가 있습니다.","윤별이: 드라이브에 있는 원본 문서 공유합니다.

https://drive.google.com/file/d/0Bx8flMbOQJIkMHhCZDNTTlF2UnM/view?usp=sharing",https://cafe.naver.com/pnpsecure2/229
228,[KMS] Package Protocol Time 구별 방법,"Package 및 모듈의 상세 버전을 확인하면 MAIN Version 이 표시됩니다.
DBSAFER AGNET 모듈
MAIN VERSION 3.7 (20100118)
DBSAFER Service 모듈
DBSAFER MAIN VERSION 3.7 (20100118)
Main Version 이란 매니저와의 통신을 위해서 정해진 프로토콜 사이즈를 기준으로 구분한 Packet 기준입니다.
현재는 매니저의 접속 가능 프로토콜 기준을 통합하면서 매니저와의 프로토콜 확인으로 사용되지는 않으나 신규 기능 추가로
인한 패키지 및 모듈의 버전을 확인 시에 프로토콜의 확인이 필요합니다.
여기서 언급하는 프로토콜이란 Manager 혹은 모듈(Ex. dbsafer_agent 와 dbsafer_ora) 의 통신 규칙을 지칭합니다.
새로운 프로토콜이 생성되는 시점은 신규 기능 추가로 인하여 새로운 정보를 패킷상에 추가를 해야할 경우 기존의 패킷 보다
길이가 길어지면서 새로운 프로토콜이 생성됩니다.
현재 DBSAFER v 3.0 과 WASSAFER v 4.0 의 프로토콜은 4개가 운영되고 있으며, 메인 버전과의 상세 버전은 아래와 같습니다.
MAIN 3..3 - Protocol 20090928
MAIN 3..6 - Protocol 20091117
MAIN 3..7 - Protocol 20100118
MAIN 3..P - Protocol 20100719
MAIN 3..P_EX - Protocol 20101116
실제 구분은 상위의 MAIN 버전과 같이 5개로 구분되지만 실제 모듈에서 MAIN 3.3 과 MAIN 3.6, MAIN 3.7 로만 구분이 됩니다.
이는 그 외의 버전이 실제 고객사에서 운영되지 않거나 배포(일부 제외)되지 않았기 때문입니다.
버전별 기능은 아래와 같습니다.
MAIN 3.3 : 기본 DBSAFER v 3.0 기능
MAIN 3.6 - 기본 WASSAFER v 4.0 기능
MAIN 3.7 - 기본 DBSAFER v 3.0 기능 외 시간 동기화 기능, 로그 축약 정책 설정, 로그 무결성 포함
MAIN 3.P - MAIN 3.7 기능 포함, DECIDE v 3.0 기능 포함
MAIN 3.P EX - MAIN 3.P 기능 이외 추가되는 새로운 기능
상위 사항은 현재 구성된 Main 버전별 기능입니다. 고객사의 정보 확인시에 상위 사항을 확인하면 패치 및 운영에 도움이 될
것이라고 생각합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/228
227,[KMS] DBSAFER MYSQL UPDATE 모듈 사용 및 활용 방법,"DBSAFER MYSQL UPDATE 모듈의 사용 방법 및 활용 방법에 대해서 설명함
DBSAFER MYSQL UPDATE 모듈은 DBSAFER 의 기본 데이터베이스와 DBSAFER_LOG 모듈이 생성한 로그 데이터베이스에 포함된 테이블/컬럼에 새롭게 추가된 테이블 및 컬럼을 추가하는 모듈임
모듈 구성
모         듈 : dbsafer_mysql_updater
참조 파일 : 확장지 duf 파일
모듈 사용 방법
/dbsafer3 디렉토리 하단의 .conf 하단에 dufs 디렉토리 생성 후 dufs 디렉토리 하단에 duf 파일을 복사한다. 복사 후 dbsafer_mysql_updater 모듈을 시작하면 dbsafer_mysql_updater 모듈은 dufs 파일 정보를 읽어와서 mysql 테이블에 적용한다.
모듈 재배치 소요시간
모듈 실행 시간은 장비 및 로그량에 따라서 다르므로 소요시간을 산정하기는 어렵움
모듈 활용 방법
DBSAFER v 2.0 로그를 DBSAFER v 3.0 로그로 전환할 경우 사용 가능하다. 기존 DBSAFER v 2.0 로그에서 DBSAFER v 3.0 로그로 전환되면서 전체 테이블 틀이 바뀐 것이 아니므로 dbsafer_mysql_update 모듈로 로그 전환이 가능하다.
DBSAFER v 2.0 MySQL 파일 복사 - MySQL v 4 의 파일을 MySQL v 5 과 호환 가능하므로 파일을 복사한다.
DBSAFER v 3.0 에서 dbsafer_mysql_update 모듈 실행
모듈 사용 옵션
-y : All yes.
-n : Do not update log datas.
-d : Display debug message
-t DATABASE : Only update inputed DATABASE. ex) dbsafer_log_2007_04 or dbsafer
-f FILE : Test update file read.
dbsafer_mysql_update -n 옵션
기본 데이터베이스와 금일과 내일 일자의 로그 데이터 테이블만 업그레이드 실행
dbsafer_mysql_update -h 옵션
기본적인 사용 옵션과 방법 설명
dbsafer_mysql_update -y 옵션
dbsafer_mysql_update 에서 중간에 [yes] 입력 부분을 제외하여 연속적으로 입력하는 방법
dbsafer_mysql_update -t dbsafer
기본 데이터베이스에 대해서만 업그레이드를 실행
기타 참고 사항
2008년 12월 이전 dbsafer_mysql_update 모듈은 소스 자체에 변경되는 테이블 정보를 하드 코딩되어 있엇기 때문에 dufs 파일과 별도로 운용이 되었으나 2009년 이후(실제 DBSAFER v 3.0 와 같이 변경되) 에는 dufs 파일을 참조하도록 하였음",댓글 없음,https://cafe.naver.com/pnpsecure2/227
226,[KMS] DBSAFER TTP 설치 및 설정,"DBSAFER TTP 모듈의 설치 및 설정 방법에 대해서 아래와 같이 공지합니다.
DBSAFER TTP
dbsafer_virtual_nat 로 동작되는 Inline TTP 의 속도 저하 및 일부 세션에서의 불완전한 처리로 인하여 실 사이트 적용이 제한된 문제를 해결함
기술 개요
TTP 의 핵심 모듈의 dbsafer_ttp 는 DBSAFER AGENT 에 의해 NAT 처리된 패킷의 TTP 처리와 Inline 상태에서의 TTP 처리를 동시 지원함
기존의 Sniff 모듈을 Inline 처리 및 마스킹 처리도 가능하도록 개선함
TTP 를 DBSAFER 서비스 운영 중 시작/정지 및 패치를 하여도 서비스의 재시작 없이 로그 기록됨
TTP 설치
dbsafer_ttp 모듈을 ""/dbsafer3"" 나 ""/wassafer4"" 이하 디렉토리에 복사
dbsafer_xxxx_sniff 데몬 패치
DBSAFER MAIN VERSION 3.7 (20100118)
DBSAFER ADDED OPTION STATUS: (TTP SUPPORT)
DBSAFER COMMON MAIN MODULE VERSION: 1.1.33
DBSAFER COMMON POLICY MODULE VERSION: 1.0.10
DBSAFER COMMON AUDIT LOG MODULE VERSION: 1.0.7
DBSAFER ORACLE PARSER MODULE VERSION: 1.0.9
DBSAFER SQL SYNTAX PARSER  MODULE VERSION: 1.3.894
DBSAFER POLICY/LOG PACKET VERSION: POLICY-(104) LOG-(103)
The latest update of the binary: Oct 20 2010
DBSAFER 서버 환결 설정
dbsafer_agnet.conf
policy_listeners=127.0.0.1:21118
dbsafer_oms_dms.conf (RV 68 이상 지원)
TTP_OPTION=YES (Proxy TTP 일 경우)
사용자 PC DBSAFER AGENT 환경 설정 (AGENT v 3.0.5.0 이상 지원)
DBSaferAGt.CFG : ALIVE2ICMP=5 (시간은 환경에 따라서 변경 적용 바람)
ALIVE2ICMP 는 ICMP echo 를 통해서 DBSAFER 가 살아 있는지 검사하는 기능으로서 DBSAFER 장비가 죽었을 경우 NAT 처리하지 않고 곧바로 DB 서버에 접속하도록 한다.
TTP 장점
Inline 와 Proxy 동시 지원
Inline 상에서 dbsafer_ora_sniff 만으로도 dbsafer_ora 와 동일한 감사/통제 기능 제공
속도 저하 최소화 (패킷 레벨에서 수신/검사/전달 절차 수행)
TTP 단점
Proxy TTP 일 경우 DB 서버의 응답 값에 대한 제어가 제한됨 (데이터마스킹 기능 지원 불가 / 명령 차단은 세션 차단 밖에 지원 못함)
Proxy TTP 일 경우 DB 서버와 DBSAFER 가 같은 네트워크 구산에 있고, Client PC 와 DB 서버 사이에 Stateful-inspection 방화벽이 동작할 경우 TTP 동작 불가
VLAN 구간에서 TTP 기능 제한
자세한 사항은 첨부된 PPT 문서를 확인 바람
| 첨부파일:  [DBSAFER]_TTP기능_매뉴얼.ppt",댓글 없음,https://cafe.naver.com/pnpsecure2/226
225,[KMS] DBSAFER POLICYSYNC 모듈 설정 방법,"DBSAFER POLICYSYNC 모듈의 설정 방법 및 주의사항에 대해서 설명함
DBSAFER POLICYSYNC 모듈은 Active LOG 서버의 기본 데이터베이스를 Standby LOG 서버의 데이터베이스와 동기화를 할 경우 사용합니다. 이 모듈은 LOG 서버의 이중화 구성 등에서는 필수적으로 사용되는 모듈입니다.
모듈 구성
모         듈 : dbsafer_policysync
참조 파일 : dbsafer_policysync.conf
모듈 동작 방법
Active 와 동기화를 하면 Active 데이터를 우선 Standby 서버의 ""dbsafer_xxxx_xxx_sync_temp"" 테이블에 저장을 한다. 모든 Active 데이터를 sync_temp 에 저장을 완료하면 기존 Standby 서버의 데이터를 ""dbsafer_xxxx_xxx_sync_old"" 테이블에 저장을 하고 sync_temp 의 데이터를 Standby 서버의 데이터로 입력한다.
모듈 동기화 시간
정책 동기화는 Active 서버에서 정책 및 객체 정보가 변경이 될 경우 ""dbsafer_agent"" 모듈이 Standby 서버로 시그널을 전송하면 Standby 서버에서 동기화가 진행이 된다.
모듈 옵션
-t            : Only get policy to temporary tables.
get         : Get policy data from remote server.
start       : Start policy sync server.
stop       : Stop server.
dbsafer_policysync -d
모듈 동작에 대해서 debug 메세지를 화면에 출력하는 옵션
dbsafer_policysync -t
모듈을 적용하기 이전에 설정 및 동작에 대해서 테스트를 할 수 있도록 sync_temp 테이블에 데이터 입력 단계까지만 진행되는 옵션
dbsafer_policysync -get
모듈을 가동되지 않은 상태에서 수동으로 동기화를 진행하는 옵션
모듈 활용 방법
dbsafer_policysync -d -t get
모듈을 동작에서의 오류 발생을 화면에서 바로 확인 가능하다. 테이블 동기화 및 conf 설정 등을 확인할 때 용이하게 사용 할 수 있다.
모듈 설정 방법
delay = xx (단위 sec)
잦은 정책 동기화가 발생되는 것을 막기위한 설정으로 동기화 실행 후 다음 동기화까지의 동기화 제한 시간을 입력한다
remotedb_ip = 192.168.2.xxx
remotedb_user = safeusr
remotedb_passwd = safeusr
원격지 서버(Active LOG 서버) 의 IP 및 MySQL 접속 정보를 입력함
localdb_ip = 192.168.2.xxx
localdb_user = safeusr
localdb_passwd = safeusr
로컬 서버(Standby LOG 서버)의 IP 및 MySQL 접속 정보를 입력함
service_startup_management
등록된 서비스 가동/정지에 대한 동기화 여부를 설정함
manager_auth_management
Manager 관리자 권한 관리를 동기활 할지 설정함
manager_auth_oldip (Default = Remote Server IP)
관리자 권한 정보를 가져올 서버의 IP 를 입력한다.
manager_auth_newip (Default = Local Server IP)
관리자 권한 정보가 입력될 서버의 IP 를 입력한다.
table = dbsafer_xxx_xxx
table = dbsafer_xxx_xxx
table = dbsafer_xxx_xxx
동기화를 진행할 테이블을 입력한다. 동기화 대상이 되는 테이블은 고객사마다 다를 수 있으므로 테이블 리스트 입려시에 확인이 필요하다.
동기화 설정시 제외 테이블
auth_servers
기타 주의 사항
auth_server 를 동기화 할 경우 Standby 서버의 IP 가 Activer IP 로 변경되기 때문에 DBSAFER 운용에 문제가 발생함
auth_user_auth 를 기능 설정없이 동기화 할 경우 auth_user_auth 의 IP 컬럼 데이터가 active 로 변경되기 때문에 DBSAFER 운용에 문제가 발생할 수 있다. 이를 해결하기 위해서는 configuration File 설정이 필요하다.
매니저 관리자 권한을 설정할 경우 auth_user_auth 와 auth_users 테이블 설정이 꼭 필요하다.
향후 기능 개선 사항
정책 동기화시에 시스템 로그 기록 여부 옵션화로 추가
동기화 실행시에 오류 처리 개선
원격 서버에 테이블이 없을 경우 한번에 확인 가능하도록 개선
로컬 서버에 테이블이 없을 경우 원격지 서버의 테이블로 생성되도록 개선",댓글 없음,https://cafe.naver.com/pnpsecure2/225
224,[KMS] [SYSMON] 임계치 계산법 및 메일 전송 폼,"SYSMON 의 임계치 확인 방법 설명
SYSMON 은 명령어와 /proc 의 파일 정보를 파싱하여 정보를 확인하고 있습니다. 최대 수치 및 계산 방법은 아래를   참고 바랍니다.
CPU 임계치 확인
최대 확인 가능 CPU : 8 개 (8개 이상일 경우 8개로 까지만 확인함)
계산 방법 : ""/proc/stat"" 파일에서 현재값에서 이전 값의 차이로 CPU 소모 수치를 확인한다.
메모리 임계치 확인
계산방법 : 리눅스 FREE 명령어로 확인된 수치를 파싱하여 메모리 정보를 확인한다.
디스크 임계치 확인
최대 확인 가능 DISK : 10 개 (10개 초과인 경우 10개 까지만 계산하여 표시함)
계산 방법 : 리눅스 명령어 df -Pm 확인된 수치를 파싱하여 디스크 정보를 확인한다.
네트워크 임계치 확인
최대 확인 가능 NIC : 16 개 (16개 초과인 경우 16개 까지만 계산하여 표시함)
계산 방법 : ""/proc/net/dev"" 파일에서 현재값에서 이전 값의 차이로 NETWORK 소모 수치를 확인한다.
그 외의 사항으로 아래의 사항을 참조 바랍니다. 아래의 사항은 dbsafer_sysmon 에서 발생한 CPU 임계차 100% 소모 결함 수정 내역 입니다.
RV 40 : MySQL 재시작시에 CPU 99% 발생 버그 수정
RV 43 : MySQL 접속 및 쿼리 실패시
RV 56 : CPU 및 NETWORK 에서 읽어온 데이터 값이 4.294.967.295 보다 클 경우 계산 오류로 100% 소모 수정
기능 추가 사항
임계치 오버 발생시 E-mail 전송 기능 추가
TOP 로그 상위 5개에서 10개로 증가
TOP 로그 적재 시간 조절 기능 추가
sysmon conf 분리 구성
관리자 E-Main 전송 폼",댓글 없음,https://cafe.naver.com/pnpsecure2/224
223,[KMS] 데몬 로그 파티션 Full 상태 에러 확인 방법,"데몬 로그 파티션 Full 상태 에러
데몬 로그를 기존과는 다르게 파티션 구분하여서 등록을 하게되면서 기존과는 다르게 ERROR 가 발생됩니다.
기존의 경우 /home 파티션에 함께 있었기 때문에 /home 파티션이 Full 되었다는 것 이므로 서버 장애가 발생됩니다.
하지만 파티션을 구분 했을 경우에는 데몬 로그가 적재되는 것에만 문제가 발생됩니다.
ERROR 로그는 아래와 같습니다.
MakeDirectory[123] szPath = ./log/dbsafer_sysmon/2011/04/12/(No space left on device)
MakeDirectory[123] szPath = ./log/dbsafer_sysmon/2011/04/12/(No space left on device)
MakeDirectory[123] szPath = ./log/dbsafer_sysmon/2011/04/12/(No space left on device)
MakeDirectory[123] szPath = ./log/dbsafer_sysmon/2011/04/12/(No space left on device)
상기 에러 메세지는 dbsafer_sysmon 에서 로그 적재에 실패하면서 발생되는 메세지입니다.
데몬 로그 파티션이 Full 될 경우에는 상기와 같은 현상이 발생합니다. 발생될 경우 disk 상태를 확인 후
불필요 로그를 삭제 해 주면 됩니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/223
222,[KMS] wasafer 등록된 IP 이외 로깅 기능,"1. 설정 방법
가. WASSAFER에서 비WAS 세션에 대해서도 제어 정책이 동작할 수 있도록 기능 설정 방법
- 파일을 생성: "".conf/wassafer_all_policy.conf""
- 위의 파일을 생성하게 되면 WAS정책에서 설정한 정책이 비WAS 세션에 대해서도 적용하도록 되어있습니다.
나."".conf/wassafer_all_policy.conf"" 파일의 인식 주기
- 10분 마다 파일의 존재 여부를 검사합니다.(사유: 너무 빈번한 검사는 DISK I/O를 유발)
- 서비스를 내리지 않고 적용 가능합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/222
221,[KMS] PASS SNIFF 설정 방법,"Pass Sniff 설정 방법
Pass Sniff 는 DBMS 및 FTP, Telnet 서비스의 통신을 Transparent 서비스로 등록하여 DBSAFER 을 거쳐서 통신하게 하는 상태에서 Sniff 데몬으로 세션 및 명령어를 로깅한는 서비스입니다.
설정은 sniff.conf 에서 옵션을 설정해야 합니다.
[단독구성]
[SNIFFING PORT]
DBSafer
[분리구성]
[SNIFF DEFAUKT IP]
192.168.xxx.xxx (GW IP)
[SNIFFING PORT]
DBSafer",댓글 없음,https://cafe.naver.com/pnpsecure2/221
220,오라클 서비스 데몬에서의 프로시져(패키지) 처리 방식,"오라클 서비스 데몬에서의 프로시져(패키지) 처리 방식
2011년 05월 20일을 기점으로 오라클 서비스 데몬에서의 프로시져 및 패키지 처리 방식이 변경되었습니다.
[기존 처리 방식]
※오라클 프로시져(패키지) 생성의 특징
오라클의 경우 프로시져를 생성하는 쿼리문에 오류가 있을 경우라도 프로시져나 패키지가 생성됩니다.
물론 컴파일상에 문제가 발생되지만 잘 못된 구분으로 프로시져(패키지) 객체가 생성되므로 문제의 소지가있습니다.
기존의 경우 'CREATE OR REPLACE' 구문이 올 경우 유입되는 패킷을 parser 에서 바로 쿼리를 추출하고 정책 검사 후
DBMS 로 전송함
[개선 처리 방식]
'CREATE OR REPLACE' 이 들어 올 경우 모든 패킷을 수신 할 때 까지 버퍼에서 보관을 하고 있다가 모든 패킷을 수신 후
parser 에서 쿼리를 추출 후 정책 검사를 실시함",댓글 없음,https://cafe.naver.com/pnpsecure2/220
219,서버 패키지 및 매니저 정형 모듈 확인 및 설정 방법,"정형화 버전 확인 및 매니저 정형화 모듈 설정 방법
[배포된 정형 모듈 버전 정보]
V 1.0.0.0 : 기본 정형화로 변수만 정형화
V 1.0.0.1 : V 1.0.0.0 에서 공백 정형화 추가됨
V 1.0.0.2 : V 1.0.0.1 에서 "" 정형화 추가됨
[서버 패키집려 정형 모듈 배포]
Main Packet 3.3 : V 1.0.0.0
Main Packet 3.7 : V 1.0.0.0
Main Packet 3.P : V 1.0.0.0 / V 1.0.0.2
Main Packet 3.PEx : V 1.0.0.2
상위와 같이 배포된 서버 패키지로 인하여 매니저의 정형버전을 확인하여 패치를 진행해야합니다.
패치 시에는 아래의 사항을 확인 후 패치 진행 바랍니다.
서버 패키지의 정형 버전 확인
매니저의 정형버전 확인 및 설정
기존 등록된 정형객체 및 권한 선결재 객체 정형값 변경
[정형 모듈 버전 확인 방법]
서버 패키지 정형 모듈
DBSAFER MAIN VERSION 3.X (2010xxxx)
DBSAFER ADDED OPTION STATUS: (TTP SUPPORTED)(CLIENT_SIDE_MAX_CAPACITY)
DBSAFER COMMON MAIN MODULE VERSION: 1.0.11
DBSAFER COMMON POLICY MODULE VERSION: 1.0.18
DBSAFER COMMON AUDIT LOG MODULE VERSION: 1.0.8
DBSAFER COMMON FORMAL_QUERY MODULE VERSION: 1.0.0.2
DBSAFER ORACLE PARSER MODULE VERSION(bind): 1.0.15(1139)
DBSAFER SQL SYNTAX PARSER  MODULE VERSION: 1.3.11xx
DBSAFER Pol/Log/Decide Build: POLICY-(10x) LOG-(10x) DECIDE-(x)
DBSAFER LastUpdate(compiled): xxx xx 201x
The latest update of the binary: xxx xx 201x
매니저 정형 버전 확인
<br />
매니저 정형 버전 설정
정형화 모듈 버전 설정은 매니저 V 3.0.7.x (Build 1469) 이상 부터 설정 가능합니다.
[객체 정형값 일괄 변경]
정형값은 정형객체 및 결재시스템 권한 선결재서 사용 가능합니다.
최고관리자만 설정 가능합니다.
상기 사항은 간단하지만 모듈 버전이 일치하지 않을 경우 명령어 제어에 문제가 발생됩니다.
경우 따라서 문제가 커질 수 있으니 꼭 확인 바랍니다",댓글 없음,https://cafe.naver.com/pnpsecure2/219
218,[KMS] 서비스 데몬의 Nat CertID 캐쉬메모리 설정,"다수의 사용자가 접속이 빈번하게 발생할 경우 간혹 부하로 인한 NAT Cert ID 가 빠지는 현상이 발생합니다.
발생 원인은 dbsafer_oms_dms 모듈의 과부하로 인하여 NAT CertID 전달 시간이 지연되면서 발생이 됩니다.
실제로 서비스 데몬의 dbsafer_oms_dms 에게 request 를 전달하고 대기를 하는데 이 때 시간이 지연되면 CertID 가 빠지게 됩니다.
아래의 설정은 서비스 데몬에서 Nat Cert ID 를 캐쉬 메모리로 사용하여 부하를 줄일 수 있는 방법입니다.
[문제사항]
DB 부하 및 dbsafer_oms_dms 부하로 서비스 데몬에서 보안계정을 얻지 못할 경우 로그에 보안계정이 기록되지 않는 문제
[개선사항]
서비스 데몬 자체의 캐쉬메모리를 사용하여 dbsafer_oms_dms 의존도를 낮춤
[설정파일]
.conf/natcertid.conf
[설정방법]
USE_CACHE=YES
WAIT_TIME=10
CACHE_TIME=600
[설정설명]
USE_CACHE=YES
캐쉬 메모리 사용 여부
WAIT_TIME=(second time)
dbsafer_oms_dms 에 request 를 전달하고 response 를 받을 때까지의 최대 대기 시간
CASHE_TIME=(second time)
dbsafer_oms_dms 에 질의하기 전 최근 N 초 이내 접속했던 보안계정 정보를 캐쉬 메모리에 저함
[효과]
각 서비스 데몬에서 dbsafer_oms_dms 에 가상계정을 질의하는 횟수가 1/3 ~ 1/100로 줄어듬
[주의사항]
사용을 할 경우 CACHE 를 먼저 확인 하므로 만약 같은 IP 에서 서로 다른 보안계정으로 로그인하여 서버에 접속 할 경우 실제 보안계정과 다르게 표시 될 수 있음(CACHE_TIME 설정 시간 내에 발생 가능함)
상기 내용을 사용 할 곳은 보안계정을 IP 인증으로 사용 하는 곳에서만 사용 바랍니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/218
217,[KMS] 단일서버에서 Log Bridge사용하기,"1. 개요
DBSAFER에 서비스가 많은 경우(200개 이상), Log데몬이 너무 많은 접속을 받을 수 없어 접속을 분산하여 접속하기 위해 사용됨
2. 각 설정 파일
.conf/dbsafer_agent.conf(Agent설정 파일)
#dbsafer_log접속 포트(틀렸을 경우 현재 세션정보가 안나옴)
logger_port = 3124
.conf/dbsafer_auth.conf(Auth설정 파일)
#dbsafer_log접속 포트
logger_port = 3124
.conf/dbsafer_log.conf
listenport=3124
.conf/dbsafer_log_brdge.conf
listenport=3120
loggerport=3124",댓글 없음,https://cafe.naver.com/pnpsecure2/217
216,"[KMS] trim,mloc 마스킹","1.12자리부터 끝까지
2. 13자리 7부터 끝까지
3. 10자리 4~5 *처리
상기 3가지 경우의 패턴은
ACNO::<trim>::<mloc><=,13,6,$>::<trim>::<mloc><=,10,3,2>::<mloc><>,12,11,$>
주의사항은 영문,숫자는 1바이트, 한글 및 아시아권역은 2바이트, UTF캐릭터면 3바이트 등에 대하여 확인 하여야 하구요,
및의 자리 표기 방식은 0-base 입니다. 시작이 0부터 라는 말입니다.. 아시죠? ㅎㅎ
이상입니다.
1. 기능: 문자열 길이에 따른 마스킹 범위 지정 기능
2. 표기법
<mloc><비교식, 길이, 마스킹 시작 위치, 마스킹 길이>
가. <mloc>: 마스킹 범위 지정 식에 따른 마스킹 처리 tag
나. 비교식([ | = | < | <=, >, >=]): 마스킹 대상의 문자열 길이가 길이 필드 값과의 비교 식
- """"(empty): 길이 필드값과 동일한지 여부(""=""와 동일 의미)
- ""=""(equal): 길이 필드값과 동일한지 여부
- ""<""(less): 길이 필드 값보다 작은 지 여부
- ""<=""(less or equal): 길이 필드 값보다 작거나 같은 지 여부
- "">""(greater): 길이 필드 값보다 큰지 여부
- "">=""(greater or equal): 길이 필드 값보다 크거나 같은 지 여부
다. 길이
- 앞의 비교식과 마스킹 대상의 문자열 길이와 비교할 값
- 참이면 마스킹 시작 위치, 마스킹 길이 값에 따라 마스킹 처리
- 거짓이면 마스킹 대상의 문자열 전체를 마스킹
라. 마스킹 시작 위치
- 마스킹 대상의 문자열에서 마스킹 시작 위치(0-based)
- 마스킹 시작 위치의 값이 잘못 지정되었을 경우(문자열 길이보다 클 경우)에는 맨 앞으로 자동 설정
마. 마스킹 길이
- 마스킹 시작 위치에서 마스킹 할 문자열 길이
- ""$""의 값을 넣을 경우 마스킹 대상 문자열의 마지막까지 마스킹 처리(맨 끝의 의미)
- 마스킹 길이 값이 잘못 지정되었을 경우(마스킹 시작 위치 + 마스킹 길이값이 문자열 길이 초과할 경우)에는 맨 뒤로 자동 설정
※ 해당 기능은 컬럼 지정, 정규식 지정을 통해 혼용하여 사용하여야 합니다.
3. 사용예
나. 5자리부터 끝까지, 12자리부터 끝까지
- 사용 예: member.jumin::[0-9]{6}-[0-9]{7}::<mloc>< , ,5,$> <- 5자리부터 끝까지
member.jumin::[0-9]{6}-[0-9]{7}::<mloc>< , ,12,$> <- 12자리부터 끝까지
※ 참고
1. <trim> tag문법: 문자열 끝의 공백 제거 명령어 tag(""abcd "" => ""abcd""로 변환 처리 후 정규식 및 마스킹 범위 지정 문법 적용)
2. 사용 예
- 공백제거 전체길이 13자리일 경우 7번째부터 ""*""처리, 공백제거전체길이 10자리 일 경우 4~5번째 ""*""처리
- 공백 제거 tag: <trim> 사용
- 사용 예:
member.jumin::<trim>::<mloc><=,13,7,$> <- 공백제거 전체길이 13자리일 경우 7번째부터 ""*""처리
member.jumin::<trim>::<mloc><=,10,4,1> <- 공백제거전체길이 10자리 일 경우 4번째 ""*""처리",댓글 없음,https://cafe.naver.com/pnpsecure2/216
214,MySQL Port 변경 및 DBSAFER 설정,"1. DBSAFER 설정 방법
# cd /dbsafer3
# ./dbsafer_agent dbconfig
# ./dbsafer_agent dbconfig
AGENT Release Version 3.0 for Rel1.3-CentOS5 (Rev801M/Lib240) [Feb 22 2013] !!
MAIN VERSION 3.7 UPDATE 21 (20111227) - POLICY:105(4856), LOG:103
Db configuration...
HOST : 192.168.6.67
USER : safeusr
PASS : ********
PORT : 3306
DB   : dbsafer3
UNIX_SOCKET : /tmp/mysql.sock
TESTING CONFIGURATION ...
[OK]
Do you want to setup database. [yes/no] : yes
HOST : 192.168.6.67
USER : safeusr
PASS :
PORT (Default: 3306) : 33066                                        ß 변경된 MySQL 포트로 설정
DB (Default: dbsafer3) :
UNIX_SOCKET (Default: /var/lib/mysql/mysql.sock) :
TESTING CONFIGURATION ...
[OK]
Done.
# ./dbsafer stop
# ./dbsafer start
2. WebReport 설정 방법
# cd /dbsafer3/.conf/
# vi webreport.conf
webreport.repositoryPort=33066                                  ß 설정 추가
# cd /home/webapps/engineer/conf/
# vi engineer.properties
engineer.repositoryPort=33066                                    ß 설정 추가
3. 기타 (MySQL port 변경)
# cd /etc/rc.d/init.d
# ./mysqld stop
# cd /etc
# vi ./my.cnf
[mysqld]
datadir=/home/dbsafer/data/mysql
socket=/var/lib/mysql/mysql.sock
port=33066                                                     ß 설정 추가
# Default to using old password format for compatibility with mysql 3.x
# clients (those using the mysqlclient10 compatibility package).
old_passwords=1
ssl-ca=/dbsafer3/.conf/arbit.dsc
ssl-cert=/dbsafer3/.conf/arbit.dsc
ssl-key=/dbsafer3/.conf/arbit.dsk
max_allowed_packet = 16M
ft_min_word_len = 3
[mysql.server]
user=mysql
basedir=/var/lib
[mysqld_safe]
err-log=/var/log/mysqld.log
pid-file=/var/run/mysqld/mysqld.pid
max_allowed_packet = 16M
# cd /etc/rc.d/init.d
# ./mysqld start",댓글 없음,https://cafe.naver.com/pnpsecure2/214
213,매니저 보안계정 패스워드 방식 변경 (SHA1 -> SHA2),"매니저 및 보안계정의 비밀번호는 기본적으로 SHA-1 을 사용하였으나 근래의 보안 관련 이슈 강화로 SHA-2 방식으로 업그레이드 가능합니다.
[매니저 및 보안계정 비밀번호 암호화 이력]
MySQL password() 함수 사용 - 초기 사용
SHA-1 사용 - 2013년 06월 이전 패키지
SHA-2 사용 - 2013년 06월 이후 패키지
SHA-2 사용은 매니저 및 보안계정의 패스워드에 적용이 가능합니다.
[적용 매니저 및 서버 패키지 정보]
Server Package : 2013년 06월 이후 빌드 패키지
Manager : Build 2814 이상
PC Assist : V 3.1.6.0 이상
dbsafer_oms_dms : RV 338 이상
현재 SHA-2 를 사용 여부는 아래의 쿼리를 실행하여서 확인이 가능합니다. 만약 'cert_enforced_encrypt_use' 내용이 없거나 값이 '0'일 경우 SHA-1 을 사용 중인 상태입니다.
[SHA-2 사용 여부 확인 쿼리]
SELECT name, value FROM dbsafer3.variables WHERE name = 'cert_enforced_encrypt_use'
만약 SHA-1 을 사용 중인 고객사에서 SHA-2 방식을 적용하기 위해서는 아래의 방법으로 진행하면 됩니다. 단, 초기 비밀번호에 대해서는 고객사에 일괄 초기화 된다는 점을 알려줘야 합니다.
[SHA-2 적용방법]
Variables 테이블에 항목 추가
INSERT INTO dbsafer3.variables values(""cert_enforced_encrypt_use"",""1"")
모듈 재시작 및 계정 패스워드 초기화
dbsafer setup 메뉴에서 admin 계정 비밀번호 초기화
dbsafer_agent 모듈 재시작
dbsafer_oms_dms 모듈 재시작
매니저 시스템 설정 - 보안계정 설정에서 ""SHA256 으로 비밀번호 초기화""
패스워드 암호화 방식 업데이트 이후에 설정되는 기본 패스워드는 매니저 계정 ""admin / admin007"" 이 되며 보안계정의 패스워드는 초기값으로 됩니다.
| 첨부파일:  Enforce_sha1_to_sha256_B20140813.tgz",댓글 없음,https://cafe.naver.com/pnpsecure2/213
212,로그인 실패 로깅 기능 설명 및 설정 방법,"로그인 실패 로깅 기능에 대해서 설명합니다.
로그인 실패는 DBMS 접속 시도 시에 패스워드 실패 등 으로 인한 접속 실패를 기록 하는 것 입니다. 아직 모든 서비스에 적용 가능 것은 아니며 일부 서비스에 대해서 설정을 기본으로 사용 가능합니다.
[접속 시도 실패 로깅 기능]
[가능 서버스]
oracle
mssql
udb
sybase ase
Telnet
ftp
[설정방법]
conf 파일 생성
.conf/login_try_audit.conf
.conf/login_try_audit_sniff.conf
[관련데몬]
dbsafer_agent
dbsafer_log
dbsafer_log_bridge
dbsafer_oracle
dbsafer_mssql_2000
dbsafer_udb
dbsafer_telnet
dbsafer_ftp
[지원 매니저]
build-2187
[기능 가능 여부 확인 방법]
모듈의 상세 버전 정보에 로그인 실패 로깅 기능을 지원 여부를 확인할 수 있습니다.
Example)
DBSAFER MSSQL Release version 3.0.8 for Rel1.3-CentOS5
DBSAFER MAIN VERSION 3.7 (20111227)(Rev: v856)
DBSAFER ADDED OPTION STATUS: (TTP SUPPORTED)(DMS ACTION)
DBSAFER COMMON MAIN MODULE VERSION: 1.2.03
DBSAFER COMMON POLICY MODULE VERSION: 1.2.05
DBSAFER COMMON AUDIT LOG MODULE VERSION: 1.1.00
DBSAFER COMMON FORMAL_QUERY MODULE VERSION: 1.0.0.2
DBSAFER COMMON CERTIFICATION MODULE VERSION: V2
DBSAFER MSSQL PARSER MODULE VERSION(DBParser:tds): 1.0.2(1627:1627)
DBSAFER SQL SYNTAX PARSER  MODULE VERSION: 1.3.1627
DBSAFER Pol/Log/Decide Build: POLICY-(105) LOG-(106) DECIDE-(8)
DBSAFER Service Session MAX  : 13500 Session (Forks:30)(Sessions:450)
DBSAFER LastUpdate(compiled) : Nov 20 2012
The latest update of the binary: Nov 20 2012
[제약사항]
Sniff 데몬의 경우 동작은 되나 sniff 의 특징 상에 손실이 많이 발생됩니다.","정근희: [설정추가] -2017.3.24 QA공지
.conf/dbsafer(pnp)_telnet.conf 파일의
[SaveIncorrectSession] enable 로 설정되어야함 | 전종현: 이후 telnet 서비스 재시작 하면 적용됩니다 | 신호철: [기능추가] Oracle 에서 로그인 실패 사유를 기록하는 기능 추가
(Service Revision 1614 이상, Common library 2990 이상)
- .conf/login_try_audit_verbose.conf 파일이 있을 경우 상세 기록 기능 동작(Oracle 한정)
- 세션이 새로 생성될 때, 파일체크. 정책명에 로그인 실패 사유를 기록함.
- ORA-28000 / ORA-01004 / ORA-01005 / ORA-01017 / ORA-01045 / ORA-01987 / ORA-09272 해당 오류코드를 로그인 실패로 간주.
- 위 코드중 ORA-01017(invalid username/password)에 한해서 세션 격리 동작.
- 해당 기능 실행 시, 아래와 같이 로그(정책명)에 기록 됨.

Login failed (invalid username/password)
Login failed (null password given)
Login failed (the a",https://cafe.naver.com/pnpsecure2/212
210,DBSAFER 업그레이드 (V2.0 -> V3.0) 테이블 collation ERROR,"1. 이슈사항
DBSAFER 업그레이드 이후 이전로그를 WEBREPORT를 이용하여 Reporting 하고자 할때 ERROR 발생
2. 원인
DBSAFER v2.0 시에 생성된 테이블 대부분은 collation 이 latin1_swedish_ci 인데 DBSAFER v3.0 이 사용하는 테이블 collation 은 latin1_general_ci 으로 WEBREPORT 는 모든 테이블 collation이 latin1_general_ci 일때 정상 동작한다고 함.
3. 대처방법
관련내용은 Bugs에 등록하여 dbsafer_mysql_update 에 포함하려 하였으나 기존 Bugs 이슈를 통하여 신규개발된 모듈인 chg_collate 에 기능이 추가된 사항으로 처리
DBSAFER v2.0을 업그레이드하여 WEBREPORT를 통하여 Reporting을 하고자 할때는 필히 dbsafer_mysql_update 이후 chg_collate 또한 수행
| 첨부파일:  chg_collate.tgz",댓글 없음,https://cafe.naver.com/pnpsecure2/210
209,보안계정별 접속 가능 서비스 리스트 확인 쿼리,"고객사에서 요청한 사항 중에 보안계정별 접속 가능 서비스 리스트 확인 쿼리 입니다.
참고 바랍니다.
쿼리는 정책 구조에 따라서 두개의 종류로 구분됩니다.
보안계정별 접속 차단 정책이 상위에 있고 최하위에 접속 허용이 있을 경우 - CertAccessListBaseOnDeny
보안계정별 접속 허용 정책이 상위에 있고 최하위에 접속 차단이 있을 경우- CertAccessListBaseOnPermit
서비스는 가동 중인 서비스를 대상으로만 조회를 할 수 있습니다.
또한 쿼리 기반의 경우 정책 우선순위를 고려할 수 없습니다.
| 첨부파일:  CertAccessListBaseOnDeny.sql  CertAccessListBaseOnPermit.sql","강정근: oms_dms 모듈에서 확인 기능이 있습니다.

#./pnp_oms_dms get-service-list [보안계정] [사용자IP]

## sample ##
./pnp_oms_dms get-service-list jgkang 192.168.3.10
(생략...) NUM [4 ], NAME [TEST_ORACLE ], TYPE [9 ], DB IP [192.168.1.111 ], DB PORT [3306 ], SER IP [192.168.3.112 ], SER PORT [4000 ], DENY [1], AUDIT_GATHER [0], RDP_USE [0], CRYPTO_USE [0], NAT IDENTITY [0]

==> 표시되는 내용 중, Deny 가 1이라고 표시되어 있는 것이 접근허용 을 의미함",https://cafe.naver.com/pnpsecure2/209
208,[sysmon]서버 자원 임계치 계산법,"SYSMON 은 명령어와 /proc 의 파일 정보를 파싱하여 정보를 확인하고 있습니다. 최대 수치 및 계산 방법은 아래를 참고 바랍니다.
CPU 임계치 확인
최대 확인 가능 CPU : 8 개
8개 이상일 경우 8개로 까지만 확인함
계산 방법
""/proc/stat"" 파일에서 현재값에서 이전 값의 차이로 CPU 소모 수치를 확인한다.
메모리 임계치 확인
계산방법
리눅스 FREE 명령어로 확인된 수치를 파싱하여 메모리 정보를 확인한다.
디스크 임계치 확인
최대 확인 가능 DISK : 10 개
10개 초과인 경우 10개 까지만 계산하여 표시함
계산 방법
리눅스 명령어 df -Pm 확인된 수치를 파싱하여 디스크 정보를 확인한다.
네트워크 임계치 확인
최대 확인 가능 NIC : 16 개
16개 초과인 경우 16개 까지만 계산하여 표시함
계산 방법
""/proc/net/dev"" 파일에서 현재값에서 이전 값의 차이로 NETWORK 소모 수치를 확인한다.",댓글 없음,https://cafe.naver.com/pnpsecure2/208
207,함수 사용 시에 마스킹 제외 방법,"함수 중에 len() 등의 경우 데이터의 값은 확인하지 않고 길이만을 확인하기 때문에 실제 값에 대해서 전달해 줄 필요성은 있습니다. len() 의 경우 WAS 등의 설정 등에서 값의 존재 여부를 판단할 때 사용하기도 하기 때문입니다. 하지만 그 외의 경우에도 고객사의 의도에 따라서 마스킹을 제외할 경우가 필요합니다. 예를 들어서 sunstr() 을 사용하여서 출생년월을 확인할 경우 등이 이에 해당 합니다. 이럴 경우 사용 가능한 설정 방법을 전달합니다.
[함수 사용 시의 데이터마스킹]
함수를 사용할 경우 기본 적으로 전체 마스킹이 됩니다. 함수를 사용한 이후에는 조회된 값의 자리 수 등을 알 수 없기 때문에 전체 마스킹만 됩니다.
[함수 사용 시의 데이터마스킹 예외 방법]
touch .conf/mask_ignore_funcs.conf
제외할 함수를 입력하여 사용
입력예시
substr
rtrim
ltrim
concat
서비스 재시작 필요없이 가능한 설정이지만 설정 후에 재시작을 권장합니다.
상기와 같이 처리할 경우 함수 사용 시에 데이터마스킹이 예외가 됩니다.
예외란 부분 마스킹을 의미하는 것이 아니라 전체 내용이 표시된다는 의미입니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/207
206,"OpenSSL, Magiccrypto 패치 방법 안내.","[패치방법]
OpenSSL 패치
openssl-0.9.8e-27.el5_10.3
Magiccrypto 패치
서버 재시작
** openssl 패치시 32bit 설치 필수, 64비트는 선택 적으로 설치하시기 바랍니다.
자세한 내용은 문서를 참고하시기 바랍니다.
| 첨부파일:  Openssl 및 Magiccrypto 패치 안내.docx  magiccrypto.tgz  openssl-0.9.8e-27.el5_10.3.i686.rpm  openssl-0.9.8e-27.el5_10.3.x86_64.rpm  openssl-devel-0.9.8e-27.el5_10.3.i386.rpm  openssl-devel-0.9.8e-27.el5_10.3.x86_64.rpm",댓글 없음,https://cafe.naver.com/pnpsecure2/206
205,[backup3]dbsafer_backup3 과 무결성 검사.,"매니저를 이용하여 정책, 감사로그 데이터에 대한 백업이 가능합니다.
백업 파일에 대한 무결성 검사 및 암호화 기능을 사용할 수 있습니다.
[무결성검사]
백업한 파일에 대하여 무결성 을 확인할 수 있음.
Hash 값 생성
백업파일 생성시 Hash, checksum 값을 백업 파일 해더에 저장.
무결성검사
checksum 이용하여 헤더파일의 Hash 값 유효한지 검사.
해더에 있는 Hash 값 과 파일에서 생성한 Hash 값이 일치하는지 비교.
기타정보저장
파일명, 크기 와 같은 정보 backup_file_list 테이블에서 확인가능.
[문제해결]
""스케줄 변경 내용을 서버에 알리는데 실패하였습니다.""
./dbsafer_backup3 모듈이 정지되어 있는 경우 매니저에서 백업 시도해도 아래와 같이 메시지가 출력됩니다.
LOG_SERVER 접속 후 ./dbsafer_backup3 start",댓글 없음,https://cafe.naver.com/pnpsecure2/205
204,OpenSSL (0.9.8 zb) 취약점 보안업데이트 권고,"OpenSSL 최근 취약점에 관련된 정보입니다.
DBSAFER 서버에 패치 시 Magicrypto 와 같이 패치하셔야 합니다.
[공지]OpenSSL, Magiccrypto 패치 방법 안내.
OpenSSL 취약점 보안업데이트 권고2014.08.08
개요
OpenSSL에서 발생한 메모리 정보 노출 취약점, 서비스 거부 취약점, 버퍼 오버런 취약점 등 9개의 취약점을 보완한 보안업데이트를 발표함[1]
설명
OpenSSL 출력 함수에서 발생하는 메모리 정보 노출 취약점 (CVE-2014-3508)
TLS-SRP 암호화 모듈 메모리 충돌 취약점 (CVE-2014-5139)
SSL 서버 헬로우 메시지 Race condition 취약점 (CVE-2014-3509)
DTLS 메시지에서 발생하는 Double Free 취약점 (CVE-2014-3505)
DTLS 핸드쉐이크 메시지를 처리하는 중 발생하는 메모리 고갈 취약점 (CVE-2014-3506)
DTLS 메시지를 처리하는 중 발생하는 서비스 거부 취약점 (CVE-2014-3507)
DTLS Anonymous EC(DH) 암호화 모듈에서 발생하는 서비스 거부 취약점 (CVE-2014-3510)
TLS 프로토콜 버전 다운그레이드 취약점 (CVE-2014-3511)
SRP 버퍼 오버런 취약점 (CVE-2014-3512)
해당 시스템
영향 받는 제품 및 버전
OpenSSL 0.9.8 대 버전
OpenSSL 1.0.0 대 버전
OpenSSL 1.0.1 대 버전
해결 방안
해당 취약점에 영향 받는 버전의 사용자는 아래 버전으로 업데이트[2]
OpenSSL 0.9.8 사용자 : 0.9.8zb로 업데이트
OpenSSL 1.0.0 사용자 : 1.0.0n로 업데이트
OpenSSL 1.0.1 사용자 : 1.0.1i로 업데이트
용어 설명
SRP(Secure Remote Password) : 안전한 통신을 위한 패스워드 기반 인증 방식
Race condition 취약점 : 여러개의 프로세스가 한정된 자원을 차지하기 위해 경쟁 현상을 이용하는 취약점
DTLS : 데이터 그램 전송 계층을 보호하기 위한 UDP 기반 TLS 프로토콜
Double Free 취약점 : 특정 힙 영역을 두 번 해제시켜 메모리 포인터를 조작할 수 있는 취약점
ECDH : 타원 곡선 암호화 알고리즘
기타 문의사항
한국인터넷진흥원 인터넷침해대응센터: 국번없이 118
[참고사이트]
[1] https://www.openssl.org/news/secadv_20140806.txt
[2] http://www.openssl.org
| 첨부파일:  magiccrypto_For_DBSAFER3_CentOS5.tgz  magiccrypto_For_DBSAFER5_CentOS5_i686.tgz  magiccrypto_For_DBSAFER5_CentOS5_x64.tgz  rpm_openssl_098zb.tgz",댓글 없음,https://cafe.naver.com/pnpsecure2/204
203,[mssql_account_finder] 설정,"안녕하세요
mssql_account_finder 모듈에 대한 문서를 공유합니다.
업무에 참고하시기 바랍니다.
추가적으로 최민영 사원이 알려준 설정이 있습니다.
원본 링크를 적어 놓겠습니다. 해당 내용도 정리 되는데로  문서에 업데이트 하도록 하겠습니다.
[원문]
추가적으로 암호화 통신 즉, SSL 통신이 가능한 Version이 따로있는것으로 알고 있으며 (일부 mssql_account_finder을 미사용해도 정상동작)
http://support.microsoft.com/kb/316898/ko 다음과 같은 정보가 추가적으로 포함 됐으면 좋겠습니다.
이상입니다.
| 첨부파일:  mssql_account_finder 설정방법.docx",댓글 없음,https://cafe.naver.com/pnpsecure2/203
202,[MSSQL_ACCOUNT_FINDER] 사용방법 안내,"안녕하세요
신현종입니다.
mssql_account_finder 설정 안내입니다.
1.0.4 기반으로 작성되었습니다.
추가/수정 내용 있으면 댓글로 알려주시기 바랍니다.
| 첨부파일:  mssql_account_finder 설정방법(1.0.4).docx",댓글 없음,https://cafe.naver.com/pnpsecure2/202
201,[OMS_DMS]장기간 미사용자 잠금 기능 오류,"oms_dms 모듈에서 지원하는 “장기간 미사용자 잠금” 기능과 관련하여,
아래와 같이 서버환경에 따라 기능이 지원되지 않는 사항이 있어 정보를 공유합니다.
[이슈내용]
보안계정을 생성한 이후 일정기간 동안 로그인 이력이 없으면 잠금처리하는 기능(oms_dms.conf 내 ACCOUNT_LOCK_NO_ACCESS_USER = YES)을유효화 하였으나,
DBSAFER의 DBMS 가 MariaDB 인 환경에서는 기능이 정상적으로 동작하지 않음.
[이슈원인]
날짜를 연산하기 위해 사용하는 DB함수(UNIX_TIMESTAMP)의 결과값이 아래와 같이 DBMS에 따라 상이하여,
해당 기능이 정상적으로 동작하지 않음.
(1) MySQL: UNIX_TIMESTAMP(‘’) = 0
(2) MariaDB: UNIX_TIMESTAMP(‘’) = null
[이슈대응]
DBMS의 종류에 상관없이 해당 기능이 동작하도록 처리내용을 수정하였으며,
해당 처리는 oms_dms Rev.556 이상에서 지원합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/201
199,RHEL6.4 모듈실행시 라이브러리가 없어 실행불가시 방법 안내,"안녕하세요
기술지원부 신현종입니다.
CentOS 가 아닌 타 OS 를 사용하여 서비스를 제공할때,
미처 rpm 을 설치하지 못하여 라이브리러가 업성 모듈이 실행되지 않는 다면 아래 내용을 참조해주시기 바랍니다.
[방법1]
사내에 설치되어 정상적으로 실행되고 되고 있는 라이브러리 복사.
1. 실행되지 않는 서버에서 라이브러리 확인
# ldd [모듈명]
not found 로 나오는 라이브러리 확인.
2. 정상 실행되는 서버에서 해당 파일 복사하여 위치
[방법2]
라이브러리 명을 가지고 설치해야 할 rpm 설치.
1. 관련 rpm 찾기
http://rpmfind.net/linux/rpm2html/
사이트 접속하여 라이브러리 검색
2. 해당 rpm 다운로드
http://rpm.pbone.net/
사이트 접속하여 rpm 명 검색 하여 다운로드.
3. dbsafer 서버에 올려 설치.
이상입니다.
| 첨부파일:  rpm_RHEL6.4.zip",댓글 없음,https://cafe.naver.com/pnpsecure2/199
188,쿼리 질의 이후에 툴 자체에서 응답 값을 나누어서 받을 경우 쿼리 통합 기능,"[기능내용]
쿼리 제외 후 제외 쿼리의 응답 값 통합 기능
[사용조건]
Toad 등과 같은 어플리케이션에서 대량의 데이터를 조회할 경우 100 row 혹은 1000 row 조회를 하고 스크롤이 내려 가야지만 이후의 쿼리를 로딩하는 경우 대부분의 경우 중간 쿼리를 호출을 한다.
즉,  쿼라 Q의 질의에 응답 R을 주는데 Q 의 질의를 나누어서 질의를 하기 때문에 R1 + R2 + R3 와 같이 응답 값이 나뉘어서 회신이 온다.
이 때 Q1 + R1 / Q2 + R2 / Q3 + R3 로 매칭되이서 DBSAFER 로그에 기록이 되는데 이럴 경우 Q 의 응답 값을 식별하기 어려우며 Q2 와  Q3  의 경우 질의문의 달라지므로 최초 질의인 Q 와 다른 정책을 타는 경우가 발생이 된다 이런 문제를 해결하기 위해서 Q2 와 Q3 의 질의를 무시하고 그 응답 값을 Q1 의 응답 값으로 넘겨주는 기능이다.
[제약사항]
Oracle 및 Sybase ASE 에서만 가능
[설정 방법]
오라클 서비스
"".conf/oracle_sql_exclusion.conf""을 생성하여 제외하고자 하는 쿼리를 추가합니다.
Sybase ASE 서비스
"".conf/ase_sql_exclusion.conf""을 생성하여 제외하고자 하는 쿼리를 추가합니다.
[주의사항]
ENTER or TAB을 입력 시에는 ""\n"" or ""\t"" 문자열을 입력합니다.
서비스 구동 시에만 환경 설정 파일을 인식합니다.
설정 후 서비스 재시작 필요
[Example]
질의 1을 전달을 한다.
SELECT * FROM member;
응답 값이 최초 100 행만 출력이 된다.
스크롤을 내린다.
이어 진 응답 값이 400행 더 출력이 된다.
상기와 같은 경우 순서 3 에서 ""select 1 from dual"" 과 같은 쿼리가 전달이 된 후에 결과 값 400 행이 출력이 된다. 이 때 ""select 1 from dual"" 질의를 상기와 같이 처리할 경우 정상적으로 ""SELECT * FROM member;"" 에 모든 응답 값이 저장이 된다.",댓글 없음,https://cafe.naver.com/pnpsecure2/188
184,모듈 실행시 오류 발생할때 해결 방법 - Character set '0000048' is not a compiled character set ...,"[문제사항]
dbsafer_agent , dbsafer_log, server_manager 등 일부 모듈 실행시 에러로그 발생
File '/usr/local/magiccrypto/share/mysql/charsets/?.conf' not found (Errcode: 2)
Character set '0000048' is not a compiled character set and is not specified in the '/usr/local/magiccrypto/share/mysql/charsets/Index' file
[원인]
데이터베이스의 테이블 collate 이 다름
- 문제 테이블은 collate 이 지정되지 않아서 default 값으로 지정됨
대상 테이블
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`time_group_history`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`time_group`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`table_group_history`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`table_group`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`sid_group_history`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`sid_group`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`servicegroup_was_link_history`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`servicegroup_link_history`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`formal_query_group_history`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`formal_query_group`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`decide_group_history`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`decide_group`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`datamask_group_history`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`datamask_group`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`client_riskgrade_group_history`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`client_riskgrade_group`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`client_ip_group_history`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`client_ip_group`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`client_id_group_history`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`client_id_group`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`client_app_group_history`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`client_app_group`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`cert_group_history`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`cert_group`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`alert_group_history`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`alert_group`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`system_log_[%d]`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`sysmon_network`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`sysmon_main`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`sysmon_disk`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`sysmon_cpu`
<font face=""Verdana, Arial, Helvetica, sans-serif""></font>
`sysmon`
[해결방법]
방법 1 - 언어셋 변경 패치
파일(chg_collate.tgz) 다운로드
파일 업로드 (/dbsafer3/)
압축 해제
# tar xvfz chg_collate.tgz
chg_collate
실행.
# ./chg_collate
Checking table collations...
dbsafer_log_2014_05.system_log_14 --> OK
... 생략 ...
Checking collation configuration in my.cnf...
[BT]
6860, 5380, 5106
| 첨부파일:  chg_collate.tgz",댓글 없음,https://cafe.naver.com/pnpsecure2/184
183,run complete 와 return complete 차이점,"run compete
INSERT/DELETE 등의 SELETE 문이 아닌 다른 명령어 타입을 실행하여 정상 수행 된 경우 Run Complete 로 표시
return complete
Selete 쿼리를 실행한 이후에 정상적으로 실행 종료된 경우에 대해서 Return Complete 로 표시
Oracle 의 경우 정상 종료가 된 경우 ""ORA-01403"" 메세지가 표시되는 데 이런 경우가 해당됨
연구소에서 받은 결과 값 표시의 차이점 공유합니다.","류재혁: 최신 릴리즈 기준으로 Run Complete로 모두 통합되었습니다.

응답값이 없는 경우 / 혹은 정책에 결과값 저장을 하지 않아 명령어가 있는 경우 모두 Run Complete가 기록됩니다.",https://cafe.naver.com/pnpsecure2/183
182,어플리케이션과 보안계정이 없는 사용자에 대한 정책 적용 방법,"사용자 중에 어플리케이션이나 보안계정이 없는 사용자를 차단하지 위해서 아래와 같은 방법으로 사용자를 정의 할 수 있습니다.
아래의 명칭으로 어플리케이션과 보안계정 객체를 생성 후에 정책에서 사용하면 됩니다.
<unknown-app>
어플리케이션 값이 없는 사용자를 의미
어플리케이션 객체로 등록 후 정책에 사용할 경우 어플리케이션 값이 로깅되지 않은 사용자를 제어 할 수 있음
<unknown-cert>
보안계정값이 없는 사용자를 의미
보안계정객체로 등록 후 정책에 사용할 경우 어플리케이션 값이 로깅되지 않은 사용자를 제어 할 수 있음
2014년 04월 이전 모듈의 경우 ""<nothing>"" 으로 정의되어 있음
참고적으로 기존의 경우 보안계정 표기가 달랐으나 표기를 통일적으로 변경하였습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/182
181,데이터마스킹 예외 함수 및 특정 함수 마스킹 예외 처리 방법,"데이터마스킹 예외 함수에 대해서 전달합니다.
DBSAFER 에서는 기본적으로 일부 함수에 대해서는 마스킹을 예외하고 있습니다. 이는 고객사의 요청에 의해서 마스킹을 예외토록 한 것 입니다.
[마스킹 예외 함수(적용 : 2013년 01월 이후 서비스 모듈)]
count()
len()
length()
데이터마스킹이 적용되는 필드여도 상기 함수에 사용이 되는 경우에는 마스킹이 해제되어서 실제 값이 표시가 됩니다. 상기 함수는 소스에 고정된 함수 입니다.
하지만 상기 이외에서도 예외 함수를 사용하는 경우가 있습니다. 이때는 설정으로 마스킹 사용을 해제 시킬 수 있습니다.
[특정 함수에 대한 마스킹 제외(적용 : 2013년 08월 이후 서비스 모듈]
사용 방법
""/dbsafer/.conf/mask_ignore_funcs.conf"" 파일 생성
제외할 함수를 입력하여 사용
입력 예시
substr
rtrim
ltrim
concat
상기와 같이 사용이 가능합니다.
이상입니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/181
177,PKG_DBSAFER5_R15.11 기준 ID/APP 파싱 및 위치지정 마스킹 가능 여부,"[참고사항]
PostgreSQL 과 NETIZZA 그리고 GREENPLUM 의 경우 동일한 엔진을 사용하는 DB 이므로 동일한 형상으로 제공이 됩니다.
단, 레퍼런스가 적고 실제 사용하는 관련 툴이 대부분 고객사 자체 개발 등이 툴마다 특정으로 인하여 어플리케이션을 못잡는 경우가 발생이 됩니다. 이 경우 패킷 분석을 해야 합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/177
174,결과값 저장 정책 없이 결과값 행수 로깅하는 방법,"15년 기준 예전 PKG는 결과값 저장 정책 없이 결과값 행수를 알아낼 수 있었습니다만,
최신 기능에는 해당 기능이 기본적으로 제공되지 않습니다.
GW 서버쪽의 설정값을 변경해야 합니다.
대상 DB: ORACLE, SYBASE_IQ 를 제외한 DBMS
설정파일 : ~/.conf/pnp_dbms_config.conf
기능 추가 일 : 2015년 11월 23일 [Gateway 1.2.24]
변수 : [FULL RETURN PACKET PROCESS]
기본값 Disable
# 결과 패킷에 대하여 전체 파싱 처리하는 옵션.
# 입력할 수 없는 문자열은 ""Enable"", ""Yes"", ""Disable"" 또는 ""No""입니다.(default=Disable)
설정 적용시 결과값 행수가 로깅됩니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/174
171,서비스 모듈의 실시간 감사로그 저장 기능 매뉴얼,"안녕하세요
기술지원부 신현종입니다. D 사 장애건으로 인해 장애 보완할 수 있는 기능이 개발되었습니다.
서비스데몬이 감사로그파일을 추가로 생성하여 장애시에도 감사로그를 만들 수 있게 하는 기능입니다.
| 첨부파일:  서비스 모듈의 실시간 감사로그 저장 기능 매뉴얼.pdf",댓글 없음,https://cafe.naver.com/pnpsecure2/171
170,서비스 가동/정지 시간 성능 조절 방법,"서비스 관리에 대한 부하분산 방법에 대해서 가이드합니다.
다수의 서비스를 시작 혹은 정지를 할 때 작업 시간이 오래 걸리거나 정책을 배포 하는 시점에 시간이 오래 걸리거나 순간 서버의 리소스를 과하게 먹는 문제에 대한 최적화 할 수 있는 방법입니다.
[최적화 처리 방법]
1.    서비스 가동/정지 성능 관리
o ""service_control_jobs"" 의 값을 조정하여서 서비스 관리 thread 를 늘려 많은 thread 가 동시에 작업을 진행하도록 하면서 서비스 가동 시간을 조정 할 수 있음
thread 수를 조절하여서 동시의 량을 조절하는 것 입니다. 동시 작업이 많아 질 경우 성능 소모는 커지고 시간을 짧아 질 것 입니다. 적절한 조절로 설정하는 것이 필요합니다.
[주의사항]
1.    다중처리 값은 서버의 성능(CPU, Memory)에 따라 적당한 값으로 조절해서 사용해야 합니다.
2.    다중처리 값이 너무 높으면, 서비스 시작 시 정책배포가 원활이 이루어지지 않을 수 있으니 CPU 50~80%사용하는 적당한 값을 사용하여야 합니다.
[설정 파일 및 내용]
·  pnp(dbsafer)_agent.conf
######################################################
# The count of Service controlling at once.
# Increase this count for increasing service startup speed.
# Default is 3.
service_control_jobs = 8",댓글 없음,https://cafe.naver.com/pnpsecure2/170
169,CentOS6.7 설치 및 Inline 설정을 위한 rpm 재설치 안내,"안녕하세요
기술지원부 신현종입니다.
CentOS 6.7 에서 bypass 정상동작 확인 후 메뉴얼 작성하여 전달합니다.
[주의사항]
주의사항
CentOS 6.7 Inline 기능 비정상 동작.
prerouting 이후 routing 과정에서 패킷 유실 또는 Drop 으로 추정.
CentOS 6.3 설치 및 yum update 시, Inline 기능 비정상 동작.
최신 kernel(2.6.32.573) 환경에서 정상 확인.
조치사항
Inline 사용시 module-init-tools-3.9-20  으로 반드시 다운그레이드
문제모듈 : module-init-tools
kernel 관련된 rpm으로, 자동적으로 드라이버 설치, 해제 및 조회 하는 기능.
문제버전 : 3.9-25
module-init-tools 의존성.
initscripts
dracut
b43
hwdata
lvm2
[첨부파일]
CentOS6.7 설치 및 기본설정 메뉴얼
module-init-tools 모듈
bypass Driver(silicom)
| 첨부파일:  PxGxBP_Linux.zip  [DBSAFER] CentOS 6.7 Inline 설정 메뉴얼V1.0.pdf  module-init-tools-3.9-20.el6.x86_64.rpm",댓글 없음,https://cafe.naver.com/pnpsecure2/169
168,일부 RDP 프로토콜 에 대해서 접속 불가 되는 현상 안내,"[문제사항]
Windows 2000, 2003 을 제외한 windows 2008, 2012 서버 접속시 차단되는 현상
[telnet 모듈 debuging]
./pnp_telnet --sync--drop-default-thread mr 1 192.168.6.17 3389 0.0.0.0 4044 61 -g
for TELNET SERVICE 3.3.259 128bit -SafetyCMD build (Mar 24 2016 11:54:11) Service is started.
dbsafer_db_session_write_session,781: Idx:0 OUT: 192.168.2.61 -> 192.168.6.17:03389 ID: Action:0 return data
dbsafer_db_session_write_session,781: Idx:0 OUT: 192.168.2.61 -> 192.168.6.17:03389 ID: Action:0 return data
dbsafer_db_session_write_session,781: Idx:0 OUT: 192.168.6.193 -> 192.168.6.17:03389 ID: Action:0 return data
[log 데몬 로그 발췌]
[2016-04-07 10:07:02] [24423] [MISC][INFO__000000000] Information message. : Finding session info from shell. - []
src/dbutil/db_shell.cpp[dbutil_logtable_get_shell_session]:347
[2016-04-07 10:07:02] [24423] [MISC][INFO__000000000] Information message. : Can not find session info... - []
src/dbutil/db_shell.cpp[dbutil_logtable_get_shell_session]:449
[2016-04-07 10:07:05] [24423] [DEBUG][DEBUG_000000000] Debug message. : Connect to mysql...
src/db/mysqlutil.cpp[createMysqlConnection]:80
[2016-04-07 10:07:05] [24423] [MISC][INFO__000000000] Information message. : Finding session info from shell. - []
src/dbutil/db_shell.cpp[dbutil_logtable_get_shell_session]:347
[2016-04-07 10:07:05] [24423] [MISC][INFO__000000000] Information message. : Can not find session info... - []
src/dbutil/db_shell.cpp[dbutil_logtable_get_shell_session]:449
[해결방법]
wta.conf 의 USE_WTA=1로 설정되어 있는지 확인한다.
B15.11R2 PKG 기준으로 wta.conf::USE_WTA 변수의 기본값은 0으로 RDP 프로토콜 사용시 1로 변경하여 사용하는 것이 좋다.
* windows2000, 2003 과 달리 2008,2012 통신 방식이 조금 달라 증상이 차이가 있다.",신현종: 세스코 Poc 진행중 동일 현상 있어서 참고하여 해결함(2019-08-27),https://cafe.naver.com/pnpsecure2/168
167,모듈에서 발생한 core 파일 gdb로 확인하기,"서비스 모듈 또는 다른 데몬 로그에서 발생한 core.##### 파일은 엔지니어 단에서 간단하게나마 원인분석을 할 수 있다.
file 명령어를 통한 관련 데몬 확인
명령어 : file [core파일명]
# file core.5978
core.5978: ELF 32-bit LSB core file Intel 80386, version 1 (SYSV), SVR4-style, from 'dbsafer_ora'
gdb 명령어 이용한 core 파일 분석
명령어 : gdb [데몬명] [Core파일명]
# gdb ./dbsafer_ora core.5978
GNU gdb Red Hat Linux (6.5-37.el5rh)
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type ""show copying"" to see the conditions.
There is absolutely no warranty for GDB.  Type ""show warranty"" for details.
This GDB was configured as ""i386-redhat-linux-gnu""...Using host libthread_db library ""/lib/libthread_db.so.1"".
----생 략 ----
bt 명령어를 이용한 스택탐색
(gdb) bt
#0  0x0808ddc5 in _stDataMaskGroup_::push_back ()
#1  0x080d4bbe in GroupPolicyUpdateUtil<_L_DATAMASK_GROUP_T>::addPolicy ()
#2  0x080d1868 in ShmPolicyUtil::update ()
#3  0x08097330 in ShmPolicyUpdator::applyPolicy ()
#4  0x0807f538 in _PDBMSPolicyHeap::LoadPolicy ()
#5  0x08083237 in _PDBMSPolicyHeap::UpdatePolicy ()
#6  0x0806bcea in _PDBMSPolicy::th_ListenPolicyUpdate_GatewaySlave ()
#7  0x00a9c46b in start_thread () from /lib/libpthread.so.0
#8  0x009f3dbe in clone () from /lib/libc.so.6
분석
상기 bt 결과를 보면 사용한 함수들이 보이는데 해당 함수들 사용시에 문제가 생겼다고 보면 된다.
물론 실제 함수가 어떻게 동작하는지 모르지만, 이름으로 충분히 유추 할 수 있다.
예를 든 bt 내용을 보면, DBMS 정책 처리하는 부분에서 문제가 있는 것으로 보이며,
#0, #1 스택을 보면 DataMask 그룹이나 객체를 처리하는 과정에서 예상치 못한 오류가 발생한 것으로 보인다.
실제 데이타마스킹 객체에 '\n' 개행문자가 들어 있어, svc 데몬이 처리 하지 못한 것으로 예상되며, 객체 수정 요청 및 bugs 처리 하였다.","강정근: 릴리즈 버전 모듈의 경우, bt 를 통해 함수명 목록이 표시되며,
디버그 버전 모듈의 경우, bt 를 통해 함수명 과 파일라인번호 가 추가표시됩니다.
(사내 재현시에는 디버그 버전 모듈로 진행하면 원인분석에 소요되는 시간을 단축할 수 있습니다.) | 윤별이: [추가 정보]
- (gdb) list 명령어를 통하여 해당 스택의 소스를 볼 수 있습니다.",https://cafe.naver.com/pnpsecure2/167
165,[mailer] pnp(dbsafer)_mailer 환경 설정 옵션 추가,"안녕하세요. 기술지원부 최진주입니다.
pnp(dbsafer)_mailer 데몬 환경 설정 파일 옵션 값이 추가되어 다음과 같이 알려드리오니 참고하시기 바랍니다.
[이슈 사항]
메일 서버를 구글메일서버로 설정하였을 경우, mailer 데몬을 통해 메일 전송되지 않는 현상
[문제 원인]
기존 mailer 에서는 아래의 SSL 암호방식만을 지원하고 있었으나, 구글 메일 서버에서 2016.06.16 을 기준으로 SSL v2.3 / SSL v3.0 을 지원안하게 됨.
- SSL v2.3 (환경설정파일 내 secure = 1:SSL)
- SSL v3.0 (환경설정파일 내 secure = 2:TLS)
이로 인해 mailer 데몬에서는 구글메일서버로 메일을 전송할 수 있는 환경을 지원하지 않음.
* 참고자료: http://www.infoworld.com/article/3071171/security/google-to-shutter-sslv3-rc4-from-smtp-servers-gmail.html
[수정 내용]
mailer 환경설정 파일을 통해 SSL 암호화방식을 기존에 제공하는 것은 유지하며, 아래의 암호화방식을 추가함
- TLS v1.0 (환경설정파일 내 secure = 3)
- TLS v1.2 (환경설정파일 내 secure = 4)
[사용 방법]
구글 메일 서버를 대상으로 mailer 데몬을 사용하고자 할 경우, 아래의 조건에 부합하여 사용하시기 바랍니다.
- mailer Rev.140 이상 사용
- 환경설정 파일(.conf/dbsafer_mailer.conf) 내에 secure=3 또는 secure=4 로 설정
[제약 사항]
환경설정 파일(.conf/dbsafer_mailer.conf) 내에서 암호화방식(secure)을 설정 시, DBSAFER에 설치되어 있는 SSL 라이브러리 및 대상 메일서버에서 지원하는 SSL 라이브러리의 버전을 고려하여 설정해 주시기 바랍니다.
* 참고자료: https://en.wikipedia.org/wiki/OpenSSL
구글 메일 서버를 통해 메일을 전달하고자 할 경우, 환경설정 파일 내 secure 는 3( TLS 1.0) 또는 4(TLS 1.2) 로 설정을 해야 합니다.
기본적으로 4(TLS 1.2)로 설정하는 것을 권장하지만, 서버에 설치되어 있는 OpenSSL 라이브러리 버전에 따라서 4가 지원이 안되는 경우(OpenSSL 1.0.1 미만)가 있을 수 있습니다. 이 때는 3( TLS 1.0)으로 설정하면 됩니다.
[참고 사항]
DBSAFER 에 설치되어 있는 OpenSSL 버전은 아래의 명령어를 통해 확인이 가능합니다.
[root@xoxo ~]#  openssl version
이상입니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/165
161,단방향 Packet 에 대한 Sniff 로깅 시의 세션 인식 문제와 해결 방법,"연세의료원의 문제 사항에 대해서 전종현 사원이 문의를 주었습니다.
문의 내용을 보니 다른 분들에게도 모두 공유가 되어야 할 내용 같아서 공유합니다.
[문제사항]
DMZ 에서 넘어노는 Packet 에 대해서 DBSAFER 의 Sniff 모듈에서 세션을 로깅하지 못하는 문제
DBSAFER v 5.0 - CentOS 6 릴리즈 버전에서는 정상적으로 로깅을 하고 있음
DBSAFER v 5.0 - CentOS 5 릴리즈 버전에만 로깅에 문제가 발생되고 있음
확인 결과 Packet 에서 문제가 있었습니다.
SRC 128.134.209.58 에서 DB 128.134.212.177 로의 통신에서 DB 의 응답이 없었습니다. 즉, Client 에서 SYN 을 보냈는데 DB 에서 SYN,ACK 를 보내지 않았습니다. 그렇다는 것은 세션이 정확하기 이루어 지지 않았다고 인식이 되기 때문에 세션을 로깅하지 못하였습니다.
하지만 TTP 옵션이 있을 경우에는 response 가 없는 상태에서도 세션을 인식하기에 일부 서버에서는 로깅을 하였던 것 입니다.
연세의료원의 경우 모듈을 patch 하여 로깅을 할 수 있있지만 네트워크 상에서의 response 에 대한 현재의 상태를 고객에게 알려주고 로깅을 하지 않는 것이 결함이 아닌 정상동작임을 설명하여야 합니다.
또한 상기와 같은 네트워크 동작의 경우 정상적인 통신으로 보기는 어렵기에 response 를 받도록 네트워크 상태를 변경하여야 합니다.
[단뱡향 Packet 세션의 문제]
명령어의 응답 시간을 확인 할 수 없다.
정확한 세션 관리가 되지 않는다. (세션 종료 확인 등)
응답 값에 대한 정보를 확인 할 수 없다.",댓글 없음,https://cafe.naver.com/pnpsecure2/161
159,[sysmon] 시스템 정보 저장 옵션 기능 관련 안내,"안녕하세요. 품질보증팀 최진주입니다.
sysmon 데몬에 시스템 정보 저장 옵션 기능 추가되어 다음과 같이 안내하여 드립니다.
[데몬 버전]
pnp(dbsafer)_sysmon rev 134
[추가된 기능 옵션 설명]
sysmon 데몬 시스템 정보 저장 옵션 추가 (save-sysinfo)
sysmon_main, sysmon_cpu, sysmon_disk, sysmon_network 테이블 기록 관련
variables 테이블의 sysmon_use_save_system_info 값에 따라 동작
[옵션 사용 방법]
./pnp_sysmon save-sysinfo [ status | enable | disable ] 옵션 추가  (기본값 미사용)
status : 상태 확인
enable : 테이블 기록 옵션 켜기
disable : 테이블 기록 옵션 끄기
옵션 변경 후에는 데몬 재시작하여야 합니다.
[참고 사항]
sysmon 데몬 시스템 정보 저장 옵션 미사용 시 일일 시스템 현황 보고서 조회되지 않음
sysmon rev133 이하 사용 시 정상 조회되다가 rev134 이상 패치 시 기본값이 미사용이기 때문에 옵션 변경하지 않을 경우 문제 발생
이상입니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/159
151,[log]log 데몬에서 create table을 수행하지 못하고 log가 buffer로 계속 쌓이는 문제가 발생하였습니다. 어떻게 조치하면 좋을까요?,"MySQL에 알맞게 data 디렉토리 권한을 변경 해주어야 합니다.
이전과 디렉토리의 권한이 그대로인데도MySQL이 접근을 하지 못한다면, 디렉토리의 outher 권한에 권한을 부여해보도록 합니다.
이 때 정상 권한으로 동작이 된다면 서버의 MySQL 계정의 그룹 권한에 대한 변경이 발생이 된 것으로 판단할 수 있습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/151
150,[telnet]telnet 데몬 재시작 후 telnet 데몬이 접속계정을 획득하지 못합니다,"대상 서버 IP 및 Port의 변경이 있었는지 확인(Port #3389가 아닌지 확인)이 필요합니다.
또한 WA, telnet 간통신이 원할 한지 추가적으로 확인이 필요합니다.
마지막으로 데몬(telnet, wta*, wa)의 로그를 확인하여 ERR가 존재하는지 체크를 하고 그에 따른 후속조치가 필요할 것으로 보입니다",댓글 없음,https://cafe.naver.com/pnpsecure2/150
149,모듈을 패치한 적이 없는데 갑자기 라이브러리가 맞지 않는 경우가 발생합니다. 어떻게 된 일인가요?,"su 체인지 명령어로 로그인 하는 경우, MagicCrypto를 비롯한 몇몇 라이브러리의 위치를 파악할 수 없습니다.
“su – “로 유저 변경하거나 source ~/.bash_profiles 하여 변수를 export 시켜주어야합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/149
148,[oms_dms]pnp(dbsafer)_oms_dms 모듈 시작 시에 wrong file format 메세지 발생되며 시작이 되지 않아요. 어떻게 해야 할까요?,"관련 파일이 깨졌을 확률이 높습니다.
관련 파일은 var 아래의 pid, socket 파일 그리고 conf파일입니다.
해당 파일을 정리 후 재시작 해보시길 바랍니다",댓글 없음,https://cafe.naver.com/pnpsecure2/148
147,[Mssql_account_finder]Mssql_account_finder가 서버에 접속하는 주기는 어떻게 되나요?,"접속주기는 세션이 발생 할 때만 접속해 값을 가져오도록 되어있습니다.
쿼리 실행 시 마다 동작하는 것이아닙니다.
이 점 참고하시기 바랍니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/147
146,CentOS 5 커널을 임의로 업그레이드 해도 괜찮은가요?,"커널 업그레이드 시 발생할 수 있는 사이드 effect 를 알 수 없고 현재 커널 버전에 제품이 최적화 되어 있기때문에 하지 않는 것으로 권장 드립니다.
보안취약성에 의한 업데이트가 필요 시에는 본사의 지시사항에 맞게 처리가 되어야 합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/146
145,"[policysync]policysync 가동 시 ""dbsafer3.services_sync_temp"" 가 없다는오류 메시지가 출력 됩니다. 어떻게 조치해야 될까요?","해당 테이블이 없을 경우 자동으로 만들게 되어 있으므로 따로 처리가 필요하지 않습니다.
추가적으로 policysync는 log서버에서 데이터를 가져와서 temp 에 기록한 후 해당 테이블에 동기화하는 방식으로 동작합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/145
143,buffer file이 계속적으로 쌓이고 있으며 MySQL 프로세스를 보니 update 가 동일 세션의 동일 명령어로 계속 실행됩니다. 개선할 수 있는방법이 없을까요?,"연말정산 시간에 금융권에서 rtn값이 높은 데이터를 조회하는데, 이 때 Tool에서 결과 값을 분할해서 받는상황으로 보여집니다.
분할된 결과 값을 합치기 때문에 계속적으로 rtn값 관련된 내용을 업데이트하면서 DB 성능 저하가 발생됩니다.
이럴 경우 로그축약 로깅 방식 전환 등의 기술적인 검토가 필요합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/143
142,RHEL6.4 64비트 OS 설치 시 특별히 선택해야 하는 PKG가 있나요?,RHEL6 설치 시에는 minimal 설치 이후에 Custom PKG 로 필요한 설치 라이브러리를 설치하여야 합니다,댓글 없음,https://cafe.naver.com/pnpsecure2/142
140,"[oms_dms]pnp(dbsafer)_oms_dms 모듈의 ""not found user"" 에러가 왜 발생하나요?","서비스 데몬은 접속된 session에 대해서 보안계정을 확인하기 위해 pnp(dbsafer)_oms_dms 모듈에게 7793 포트를 통해 IP 기준으로 질의를 합니다.
이 때 pnp(dbsafer)_oms_dms 모듈에서 IP 기준으로 정보를 전달하는데, 해당 정보가 없을 때 발생되는 에러입니다.
예를 들어 사용자 앞 단에 공유기가 설치되어 있을 때 사용자가 서비스 데몬에 접속을 했는데 이때 로깅 IP가 공유기 IP인 경우, 실제 pnp(dbsafer)_oms_dms 모듈의 정보와 상이해서 오류가 발생될 수 있습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/140
138,[sysmon]sysmon의 네트워크 자원 계산 방법을 알려 주세요.,"sysmon 은 /proc/net/dev의 네트워크 정보를 1초 전후의 차이로 계산하여 처리합니다.
최대 16개의 인터페이스를 계산 할 수 있습니다.
Drop 등의 불필요한 패킷은 계산 처리를 하지 않습니다.
이로 인해 ESM 과 처리가 발생할 수 있기 때문입니다",댓글 없음,https://cafe.naver.com/pnpsecure2/138
137,데몬의 MySQL 접속 시 오류가 발생합니다.,"pnp(dbsafer)_agent 의 dbconfig 가 정상인데 다른 모듈이 오류일 경우에는 DNS 설정을 인한 DB 접속 지연을 먼저 확인해야 합니다.
“/etc/resolv.conf” 의 설정을 제외하여 DNS 처리를 예외 처리합니다.
그외의 오류상황으로는 DB 의 mysql.user 테이블의 host 가 실제와 다를 수 있으니 이를 맞게 처리해주어야 합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/137
135,[oms_dms]GW서버의 pnp(dbsafer)_oms_dms 모듈을 가동하면 오류가 발생하는데 어떻게 수정을 해야 하나요?,"모듈의 Config 설정에서 오류가 있을 가능성이 첫번째이며 두번째가 DB 접속 상태가 불안정한 경우가 있을 수 있습니다.
이럴 경우 모듈의 로그를 확인하여 DB 인지 Config 오류 인지 확인하여 처리를 하여야 합니다",댓글 없음,https://cafe.naver.com/pnpsecure2/135
134,. /dbsafer3/buffer에 파일들이 많이 쌓이는데 빠르게 이 파일들을처리 할 수 있는 방법이 있나요?,"Buffer 파일이 생성이 되는 사유는 과부하 트래픽으로 인한 부하문제입니다.
이럴경우 로그축약로깅 방식으로 변환 등으로 기능 변경을 통해서 부하를 처리하는 방법이 먼저 처리가 되어야 합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/134
132,"MySQL 부하가 99% 를 차지하고, 실시간 명령어가 로깅 되지 않으며, buffer file이 쌓이고 있는데 어떻게 해결해야 할까요?","DB 의 과부하가 유입 되는 TPS 가 많아서 인지 아니면 DB 오동작인지를 먼저 확인해야 합니다.
DB 의process list 를 확인하여 lock 상태 등을 확인하여야 하며 lock 이외에도 sending data 등도 확인하여야 합니다.
하지만 해당 process 가 없을 경우에도 많을 경우에는 과도한 TPS 를 의심하여야 하며 일별 로그량을 확인 후에 불필요한 데이터에 대한 로깅에 대한 처리 (ex. 접속로그의 예외처리 등) 를 하여야 합니다
DBSAFER5 DB Process List 확인
1. cd /dbsafer
2. ./pnp dbms_info명령어를 통해 DB의 ID와 PASSWORD확인
3. 획득한 ID와 PASSWORD로 DB접속
4. show full processlist; 명령어를 통해 DB상태 체크
DBSAFER3 DB Process List 확인
1. DB접속
2. show full processlist; 명령어를 통해 DB상태 체크",댓글 없음,https://cafe.naver.com/pnpsecure2/132
130,bash 프로세스가 CPU 1 core를 100% 점유하는데 어떻게 조치해야 될까요?,"bash rpm 을 통한 업데이트로 처리를 하여야 합니다.
이는 OS 자체의 문제로 보여지면 오랜 시간 접속 상태를 유지 하는 경우 등에서 발생 case 가 있습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/130
129,CentOS 5.8 x86_64 에서 sniff 서비스 사용 설정 할 시에 주의사항이 있나요?,"pcap 라이브러리가 i386, i686 버전도 함께 설치가 되어 있어야 합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/129
126,[Mssql_account finder] 모듈 스타트 후 서비스를 재시작 해야 하나요?,재시작 하지 않으셔도 괜찮습니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/126
125,"[Mssql_account_finder] 사용 중임에도 불구하고, ID/APP을 파싱하지 못합니다.",Sql server 의 접속 설정을 확인하여야 합니다. 또한 system 테이블에 대한 조회가 가능한지도 확인이 되어야 합니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/125
124,[Mssql_account_finder]SQL SERVER 계정 파싱 기능이 있나요?,"Mssql_account_finder 기능을 이용해서 계정 확인이 가능합니다.
Mssql_accout_finder 은 BBS 게시판의 해당 아래 링크 자료가 있습니다
게시판
https://bbs.pnpsecure.com/showthread.php?tid=4478
메뉴얼
https://bbs.pnpsecure.com/showthread.php?tid=4478",댓글 없음,https://cafe.naver.com/pnpsecure2/124
123,[checkintegrity] 무결성 검사 진행 할 때 해쉬값은 어디에 저장되어 있나요?,"Hash 값은 아래의 Table 에 저장이 됩니다.
-      check_integrity : 바이너리 및 설정파일 무결성 해쉬값 저장
-      log_integrity : 로그데이터 무결성 해쉬값 저장",댓글 없음,https://cafe.naver.com/pnpsecure2/123
119,[oms_dms]GW서버의 메모리 사용량이 갑자기 올라갔어요. (약 40G) 문제 있는 것 아닌가요?,"관련 파일이 깨졌을 확률이 높습니다.
관련 파일은 var 아래의 pid, socket 파일 그리고 conf파일입니다.
해당 파일을 정리 후 재시작 해보시길 바랍니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/119
118,GW서버의 메모리 사용량이 갑자기 올라갔어요. (약 40G) 문제 있는 것 아닌가요?,"실제 서버의 메모리 상태를 확인하여야 합니다.
서버의 “/proc/meminfo” 를 확인하여 cache 를 포함한 전체내역을 확인했을 때에도 메모리가 부족할 경우 메모리 증설이 필요합니다",댓글 없음,https://cafe.naver.com/pnpsecure2/118
117,서버를 오랫동안 재부팅 하지 않아도 괜찮은가요?,"서버의 업 타임이 1000일 이상씩 지속되게 된다면 문제원인이 파악되지 않는 서비스의 접속 불가나 모니터링 불가 등의 이상현상이 발생할 수 있습니다.
주기적인 재부팅을 권장 드립니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/117
116,[sysmon]sysmon의 네트워크 자원 계산 방법을 알려 주세요.,"sysmon 은 /proc/net/dev의 네트워크 정보를 1초 전후의 차이로 계산하여 처리합니다.
최대 16개의 인터페이스를 계산 할 수 있습니다. Drop 등의 불필요한 패킷은 계산 처리를 하지 않습니다.
이로 인해 ESM 과 처리가 발생할 수 있기 때문입니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/116
115,[oms_dms]GW서버의 pnp(dbsafer)_oms_dms 모듈을 가동하면 오류가 발생하는데 어떻게 수정을 해야 하나요?,"두가지의 가능성이 있습니다.
첫번째로 모듈 Config설정에 오류가 있을 가능성이 있기 때문에 /dbsafer/.conf/pnp_oms_dms.conf 파일을 확인해야 합니다.
두번째로 DB접속 상태가 불안정한 경우가 있습니다. 이럴경우 /pnp_sys_log/pnp_oms_dms/폴더 아래에 있는 모듈의 로그를 확인하여 DB 인지 Config 오류 인지 확인하여 처리를 하여야 합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/115
113,DB 서비스 모듈이 결과값 행수를 측정 하는 알고리즘이 무엇인가요? 결과값 행수를 세션 종료 시에 업데이트 하나요?,"PC로 결과값을 전달할 때, 서비스 모듈이 행수를 count해서 실시간으로 업데이트합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/113
109,개인정보 테이블에 접근한 쿼리에 대한 로그를 저장하고 싶은데 어떻게 해야 하나요?,개인정보 테이블을 기준으로 명령어 로그를 조회하면 해당 명령어를 확인 및 저장 할 수 있습니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/109
108,sniff 모듈이 패킷을 누락하지 않고 로깅할 수 있는 세션 및 명령어 처리 수준이 어느 정도인가요?,"고객사 레퍼런스로 보면 약 1만 이상의 세션에서 초당 30,000 TPS 이상의 처리가 가능합니다.
하지만 이는packet 의 구성에 차이가 있을 수 있습니다.
Query 가 매우 긴 것만 존재를 하고 그에 대한 return 값이 매우 크다면 실제 처리 가능한 TPS 는 낮아 질 것 입니다.
또한 정책의 구성에 따라서 반비례적으로 성능 처리가 됩니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/108
107,명령어 로그 조회 시 결과값 행수와 실제 데이터 행수가 달라요.,"명령어 로그 조회 시에 출력되는 결과값 행수는 데이터를 select 했을 때의 결과값의 행수를 의미를 합니다.
따라서 실제 데이터 행수와는 차이가 있을 수 있습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/107
106,Sniffing 로깅이 되지 않습니다. 무엇을 확인해봐야 하나요?,"지정된 NIC 인터페이스로 패킷이 유입되는지를 tcpdump 로 확인을 먼저하여야 합니다.
만약 정상적으로packet 이 유입되는 상황이라면 “SYN” packet 으로 동기화를 수행하는 패킷이 확인하여야 합니다.
만약“SYN” 없는 통신만 있다면 세션 정보를 확인하지 못하여 로깅이 안 될 수 있습니다
.
따라서 /dbsafer/.conf/sniff.conf 파일에 아래의 옵션을 확인해야 합니다.
- SYN PACKET IGNORE = Enable",댓글 없음,https://cafe.naver.com/pnpsecure2/106
105,특정 서비스에서 명령어 로그가 쌓이지 않아요.,"등록된 서비스가 가상IP 이거나 다시 포워딩 하는 상황을 의심해봐야 합니다.
포워딩하는 IP로 서비스를 다시 등록 해보시기 바랍니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/105
104,FTP 서비스 사용자의 보안계정이 누락되어 로그에 나타납니다.,".conf 하단의 natcertid.conf  파일이 없으면 보안계정 request 를 하지 않아서 보안계정이 남지 않을 수 있습니다.
따라서 /dbsafer/.conf 폴더에 touch natcertid.conf 파일을 생성해야 합니다.
그 외의 경우는 매우 짧은 접속 시간(3초 이내) 의 경우 서버 부하와 맞물려서 안 남을 수 있습니다.
이럴 경우 성능이 개선된 모듈로 적용 패치를 고려해야 합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/104
101,감사로그 테이블의 denied 컬럼의 값 종류,"Denied 는 동작 방식을 나타냅니다.
-      0 : 허용 / 1 : 차단 / 2 : 세션 종료(모니터링 상에서 강제 킬) / 4 : 로그인 실패",댓글 없음,https://cafe.naver.com/pnpsecure2/101
100,dbsaferdms.tmpattach 테이블이 존재하지 않다라는 에러 메시지가 출력,"서버와 환경 및 DB 의 권한문제로 인한 table 생성이 안 될 수 있습니다. 아래의 환경 정보를 확인하여야 합니다.
-      Disk 용량 확인
-      Dbsaferdms 계정 권한 : dbsaferdms DB 접근 및 write 권한 확인",댓글 없음,https://cafe.naver.com/pnpsecure2/100
98,[oms_dms]dbsafer_ldap_list 테이블의 'activate' 와 'expire' 컬럼,"유효기간의 시작과 끝의 날짜를 정의합니다. 기본 데이터는 ""0000-00-00 00:00:00""의 형식을 가지고 있습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/98
20,DBSAFER v3.0을 삭제하고 v5.0을 설치 시에 라이브러리 not found 등 오류가 발생되어 설치가 되지 않습니다.,"설치 이후에 변경된 라이브러리 path 가 .bash_profile 에 적용이 되지 않아서 입니다.
/root/.bash_profile 파일을 아래의 명령어와 같이 mysql 에서 mariadb 로 변경된 path 를 다시 지정해 주어야 합니다.
export PATH
export LD_LIBRARY_PATH=/usr/local/magiccrypto/lib:/usr/local/magiccrypto/lib/mariadb",댓글 없음,https://cafe.naver.com/pnpsecure2/20
19,dbsafer3 삭제 후 재설치를 하면 MySQL 설치가 안됩니다. 어떻게 해야 하나요?,DB 가 가동된 상태로 DBSAFER 제품을 삭제를 할 경우 MySQL 의 일부 프로세스에 대한 관련 파일이 존재하여서 문제가 발생이 됩니다. MySQL 을 다시 정리를 하여야 합니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/19
15,DBSAFER v 2.0 1.15 버전에서 1.21로 업그레이드 시 문제가 발생합니다.,"제품의 기능 추가로 인한 DB 상태가 변경이 될 수 있으므로 duf 파일로 DB 를 업데이트 처리 이후에 모듈을변경한 이후에 작업이 되어야 합니다.
단, 주의사항으로 감사로그가 많을 경우 DB 업데이트가 장시간 소요 될수 있으므로 참고하여야 합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/15
