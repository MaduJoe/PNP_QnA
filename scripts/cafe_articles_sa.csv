게시글ID,제목,내용,댓글,URL
7135,"[TIP] 보안 강화 임시 조치 사항으로 MariaDB의 my.cnf ""secure_file_priv"" 설정 시 SA 감사로그 로깅 실패 이슈 사례 전파 및 조치 방안 가이드","[개요]- DBSAFER Enterprise V5.0 취약점 관련 1차 대응 방안 관련 보안 강화 임시 조치 사항으로 MariaDB의 my.cnf ""secure_file_priv"" 설정 시 SA 감사로그 로깅 실패 이슈 사례 전파 및 조치 방안 가이드- 고객사 : 한화투자증권​[요약]1. 이슈 사례 전파2. 조치 방안 가이드3. 조치 관련 TIP 및 스크립트 공유​[이슈 내역]​- /etc/my.cnf 에 secure-file-priv=/tmp 옵션 추가 후 DB 재시작 시 SA 로그가 기록 되지 않으며 /dev/shm 에 csv 파일이 쌓이는 현상* secure_file_priv : MySQL에서 파일 입출력(읽기/쓰기)을 보안상 제한하기 위해 사용하는 시스템 변수, LOAD DATA INFILE, SELECT INTO OUTFILE, LOAD FILE 같은 파일 관련 작업을 할 수 있는 ""허용된 디렉토리""를 지정해주는 설정​[원인]- Server manager 는 /dev/shm/ 에 쌓이는 파일을 읽어서 DB에 로깅하는 동작을 함- 해당 옵션을 적용하면 /tmp에서만 파일 입출력이 되고, /dev 밑에있는 경로에서는 파일 입출력이 제한되어 insert 불가 현상이 발생- 카페글 참고 : https://cafe.naver.com/pnpsecure2/7115​[임시 조치 내역] * 해당 사이트는 즉시 DB 재시작이 불가하여 아직 조치되지 않은 상황입니다.- /dev/shm 파티션 full 을 방지하기 위해 용량 확보가 되어있는 /home 파티션으로 매일 이관하는 스트립트 생성​(스크립트 공유)- /dev/shm/sa_audit 에 1일 전 생성된 파일 이관 스크립트 생성 및 crontab 등록 (새벽 1시 동작) 첨부파일 mv_yesterday.sh null 파일 다운로드 내 컴퓨터 저장 네이버 MYBOX에 저장 - /dev/shm/sa_audit 에 1시간 전 생성된 파일 이관 스크립트 생성 (긴급용) 첨부파일 urgent_mv.sh null 파일 다운로드 내 컴퓨터 저장 네이버 MYBOX에 저장 ​[조치 방법](사전준비). server manager 모듈 빌드 필요- 한화투자증권은 CentOS 6 사용 중으로, 현재 모듈 개발 중 입니다. (30554)- CentOS 7 은 개발완료 되어 있습니다.- (29281) 벅스 확인하여 log-insert 기능 개선 trunk 버전으로 빌드 요청 필요​1. my.cnf 옵션 수정수정 전 : secure-file-priv=/tmp수정 후 : secure-file-priv='' or 해당 옵션 제거​2. 모듈 및 DB 재시작# ./pnp stop# service myql stop# service myql start# ./pnp start​3. DB에 SA 로그 INSERT (*해당 모듈은 /dbsafer 아래에서만 실행됩니다.)# ./pnp_server_manager_log -l csv -f /home/dbsafer/backup/sa_2025_03​[조치 관련 TIP]- ./pnp_server_manager 는 실행된 상태를 유지하면서, ./pnp_server_manager_log 로 모듈 명을 수정하여 데이터 INSERT 가 가능합니다.- DB에 INSERT 시 소요되는 시간 : 1개월 약 5G 용량의 파일, 약 5시간 소요됩니다.- 로그량이 많을 수록 소요 시간이 증가하여, 프로세스를 월별로 분리하여 실행하는 것을 추천 드립니다. (cpu, mem 확인 필요)​(스크립트 공유)- DBMS, TERMINAL SA를 사용하는 경우, db_acl, shell_acl, nodesafer_syslog, nodesafer_console 종류 별로 로그가 쌓이며, 파일 수 가 많아 나누어 mv or cp 를 진행해야 합니다.- 원복 파일 백업 후 진행 권고드립니다. (파티션 용량 확인 필요) 첨부파일 sa_2025_03.sh null 파일 다운로드 내 컴퓨터 저장 네이버 MYBOX에 저장 [관련 벅스 및 참고 자료]- 보안 강화 임시 조치 사항으로 MariaDB의 my.cnf ""secure_file_priv"" 설정 시 SA 감사로그 로깅 실패 이슈- 카페글 : https://cafe.naver.com/pnpsecure2/7115- SA 로그 파일 수동 복원 기능 호환성 추가 요청 (CentOS 6)- 벅스 : https://bugs.pnpsecure.com/view.php?id=30554- [강동구도시관리공단] SA 로그 수동 insert 수행 시 실패하는 현상 관련 문의 드립니다.- 카페글 : https://m.cafe.naver.com/pnpsecure2/6747- [강동구도시관리공단][크로니아이티] SA 로그 파일을 수동 복원할 수 있도록 기능 개발 요청- 벅스 : https://bugs.pnpsecure.com/view.php?id=29281​​이슈 분석 및 조치에 도움을 주신 정현교 대리님, 이승연 과장님께 감사드립니다. ​",댓글 없음,https://cafe.naver.com/pnpsecure2/7135
7132,"[공유] ""Server Agent 관리 설정 및 모니터링 호스트 기반 설정"" 사용 설정 후 미사용 처리 시 관리 대상 모니터링에 대상 서버 정상 조회 불가 현상","[요약]- 매니저 시스템 설정의 ""Server Agent 관리 설정 및 모니터링 호스트 기반 설정"" 사용 설정 시 주체가 host로 변경되면서 dbsafer3.agent_status 테이블에 host_index 컬럼이 생성되며, 해당 기능을 미사용으로 변경해도 host_index 컬럼이 삭제되지 않음> 관리 대상 서버 모니터링과 ./pnp_server_manager -H 명령어 사용 시 매니저의 호스트 값이 없어 정상 조회 불가​> 관련하여 Bugs 등록 및 기능 수정 답변을 받은 상태 이며, 기능 수정 시 내용 추가 할 수 있도록 하겠습니다. : https://bugs.pnpsecure.com/view.php?id=30297​[현상]- 관리 대상 서버 모니터링과 ./pnp_server_manager -H 명령어 사용 시 매니저의 호스트 값이 없어 정상 조회 불가​[상세 내용]1. 시스템 설정 ""Server Agent 관리 설정 및 모니터링 호스트 기반 설정"" 사용 변경 1-2. dbsafer3.agent_status 테이블에 host_index 컬림 생성됨 ​1-3. SA 관리 모드가 호스트 기반으로 변경되어 정상 조회 불가 ​ 2. 시스템 설정 ""Server Agent 관리 설정 및 모니터링 호스트 기반 설정"" 미사용 변경 2-1. 서비스 기반으로 복구해도 dbsafer3.agent_status 테이블이 호스트 기반 관리 형태로 유지되어 SA 상태 정보가 갱신되지 못함​3. 수동으로 dbsafer3.agent_status 테이블 drop 후 정상 조회 확인​[수정사항]1. remakeTable() 함수 추가- 기능: SA 관리 모드에 따라 agent_status 테이블의 host_index 컬럼 유무를 체크하여 형상이 맞지 않는 경우agent_status 테이블을 drop 하고 새 테이블을 생성하는 기능 제공: agent_status 테이블이 존재하지 않는 경우 테이블 생성 기능 포함​2. 기타- agent_status 테이블 이름을 const char[] 의 멤버 변수로 선언하여 쿼리 및 테이블 이름 사용하는 코드에 적용​이슈 해결에 도움주신 이태영 부장님, 양문섭 차장님 감사합니다.​이상입니다.감사합니다.​* 수정이 필요한 부분이나 개선사항이 있다면 댓글로 남겨주시면 감사하겠습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/7132
7039,[공유] 한국교육학술정보원 e학습터 DBSAFER OS 정책 공유,"안녕하세요. 이상민입니다.한국교육학술정보원 e학습터에 도입된 DBSAFER OS에 적용한 정책을 공유하여 드립니다.​[정책 요약]- OS 실행파일 보호- OS 설정파일 보호- OS 암호파일 보호 ​[OS 실행파일 보호] 1) OS 중요실행파일의 위변조 및 삭제를 방지하여 무결성을 보장한다. ​2) 경로 객체 정보 [Path] [Directory] [Group] ""/bin"" ""1"" OS 실행파일 ""/sbin"" ""1"" OS 실행파일 ""/usr/bin"" ""1"" OS 실행파일 ""/usr/sbin"" ""1"" OS 실행파일 3) 프로세스 객체 정보 [Process] [Group] ""ld-linux-x86-64.so.2"" OS 라이브러리 동적링커 ""cp"" 파일 복사변경 ""dd"" 파일 복사변경 ""install"" 파일 복사변경 ""mv"" 파일 복사변경 ""rsync"" 파일 복사변경 ""scp"" 파일 복사변경 ""7z"" 파일 압축 ""ar"" 파일 압축 ""bzip2"" 파일 압축 ""cpio"" 파일 압축 ""gzip"" 파일 압축 ""lzma"" 파일 압축 ""rar"" 파일 압축 ""tar"" 파일 압축 ""xz"" 파일 압축 ""zip"" 파일 압축 ""zstd"" 파일 압축 4) 정책 정보 IP대역 보안계정 접속계정 프로세스 권한 동작 로그 Any Any Any OS 라이브러리 동적링커 All 허용 미 로깅 사용자 대역 OS통제그룹 Any 파일 복사변경 All 차단 로깅 사용자 대역 OS통제그룹 Any 파일 압축 All 차단 로깅 사용자 대역 OS통제그룹 Any Any read, execute 허용 미 로깅 사용자 대역 OS통제그룹 Any Any write, create, delete, rename, mkdir, rmdir 차단 로깅 ​[OS 설정파일 보호] 1) OS 중요설정파일의 위변조 및 삭제를 방지하고 무결성을 보장한다.​2) 경로 객체 정보 [Path] [Directory] [Group] ""/etc/csh.login"" ""0"" OS 설정파일 ""/etc/default/chrony"" ""0"" OS 설정파일 ""/etc/default/grub"" ""0"" OS 설정파일 ""/etc/default/useradd"" ""0"" OS 설정파일 ""/etc/fstab"" ""0"" OS 설정파일 ""/etc/hostname"" ""0"" OS 설정파일 ""/etc/hosts"" ""0"" OS 설정파일 ""/etc/login.defs"" ""0"" OS 설정파일 ""/etc/mke2fs.conf"" ""0"" OS 설정파일 ""/etc/motd"" ""0"" OS 설정파일 ""/etc/networks"" ""0"" OS 설정파일 ""/etc/nfs.conf"" ""0"" OS 설정파일 ""/etc/nsswitch.conf"" ""0"" OS 설정파일 ""/etc/pam.conf"" ""0"" OS 설정파일 ""/etc/pam.d"" ""1"" OS 설정파일 ""/etc/profile"" ""0"" OS 설정파일 ""/etc/protocols"" ""0"" OS 설정파일 ""/etc/rsyslog.conf"" ""0"" OS 설정파일 ""/etc/security"" ""1"" OS 설정파일 ""/etc/security/pam_env.conf"" ""0"" OS 설정파일 ""/etc/services"" ""0"" OS 설정파일 ""/etc/sudo.conf"" ""0"" OS 설정파일 ""/etc/sudo_logsrvd.conf"" ""0"" OS 설정파일 ""/etc/sudoers"" ""0"" OS 설정파일 ""/etc/sysctl.conf"" ""0"" OS 설정파일 ""/etc/usb_modeswitch.conf"" ""0"" OS 설정파일 ""/etc/xattr.conf"" ""0"" OS 설정파일 3) 프로세스 객체 정보 [Process] [Group] ""login"" OS 로그인 ""sshd"" OS 로그인 ""su"" OS 로그인 ""sudo"" OS 로그인 ""cp"" 파일 복사변경 ""dd"" 파일 복사변경 ""install"" 파일 복사변경 ""mv"" 파일 복사변경 ""rsync"" 파일 복사변경 ""scp"" 파일 복사변경 ""7z"" 파일 압축 ""ar"" 파일 압축 ""bzip2"" 파일 압축 ""cpio"" 파일 압축 ""gzip"" 파일 압축 ""lzma"" 파일 압축 ""rar"" 파일 압축 ""tar"" 파일 압축 ""xz"" 파일 압축 ""zip"" 파일 압축 ""zstd"" 파일 압축 4) 정책 정보 IP대역 보안계정 접속계정 프로세스 권한 동작 로그 Any Any Any OS 로그인 All 허용 미 로깅 사용자 대역 OS통제그룹 Any 파일 복사변경 All 차단 로깅 사용자 대역 OS통제그룹 Any 파일 압축 All 차단 로깅 사용자 대역 OS통제그룹 Any Any read 허용 미 로깅 사용자 대역 OS통제그룹 Any Any write, create, delete, rename, mkdir, rmdir, execute 차단 로깅 ​[OS 암호파일 보호]1) OS 계정암호파일의 위변조 및 삭제를 방지하고 무결성을 보장한다. 사용자들의 기본적인 암호파일 접근을 허용한다. (사용자가 직접 조회하는 행위는 차단)​2) 경로 객체 정보 [Path] [Directory] [Group] ""/etc/group"" ""0"" OS 암호파일 ""/etc/passwd"" ""0"" OS 암호파일 ""/etc/shadow"" ""0"" OS 암호파일 3) 프로세스 객체 정보 [Process] [Group] ""login"" OS 로그인 ""sshd"" OS 로그인 ""su"" OS 로그인 ""sudo"" OS 로그인 ""groupadd"" OS 계정관리 ""groupdel"" OS 계정관리 ""groupmod"" OS 계정관리 ""useradd"" OS 계정관리 ""userdel"" OS 계정관리 ""usermod"" OS 계정관리 ""passwd"" OS 암호관리 ""pwconv"" OS 암호관리 ""cp"" 파일 복사변경 ""dd"" 파일 복사변경 ""install"" 파일 복사변경 ""mv"" 파일 복사변경 ""rsync"" 파일 복사변경 ""scp"" 파일 복사변경 ""7z"" 파일 압축 ""ar"" 파일 압축 ""bzip2"" 파일 압축 ""cpio"" 파일 압축 ""gzip"" 파일 압축 ""lzma"" 파일 압축 ""rar"" 파일 압축 ""tar"" 파일 압축 ""xz"" 파일 압축 ""zip"" 파일 압축 ""zstd"" 파일 압축 ""awk"" 파일 조회 ""cat"" 파일 조회 ""cmp"" 파일 조회 ""diff"" 파일 조회 ""echo"" 파일 조회 ""file"" 파일 조회 ""grep"" 파일 조회 ""head"" 파일 조회 ""hexdump"" 파일 조회 ""less"" 파일 조회 ""md5sum"" 파일 조회 ""more"" 파일 조회 ""nl"" 파일 조회 ""od"" 파일 조회 ""sed"" 파일 조회 ""sha256sum"" 파일 조회 ""stat"" 파일 조회 ""strings"" 파일 조회 ""tac"" 파일 조회 ""tail"" 파일 조회 ""vi"" 파일 조회 ""view"" 파일 조회 ""vim"" 파일 조회 ""wc"" 파일 조회 ""xxd"" 파일 조회 4) 정책 정보 IP대역 보안계정 접속계정 프로세스 권한 동작 로그 Any Any Any OS 로그인 All 허용 미 로깅 Any Any Any OS 계정관리 All 허용 미 로깅 Any Any Any OS 암호관리 All 허용 미 로깅 사용자 대역 OS통제그룹 Any 파일 복사변경 All 차단 로깅 사용자 대역 OS통제그룹 Any 파일 압축 All 차단 로깅 사용자 대역 OS통제그룹 Any 파일 조회 All 차단 로깅 사용자 대역 OS통제그룹 Any Any read 허용 미 로깅 사용자 대역 OS통제그룹 Any Any write, create, delete, rename, mkdir, rmdir, execute 차단 로깅 5) 기타- 허용 + 미 로깅은 예외처리에 해당함- OS 계정관리 명령, OS 암호관리 명령 사용에 따라 passwd, shadow, group 파일에 write가 발생되는 경우 허용 + 로깅 처리가 필요할 수 있으나 이번 케이스에서는 적용하지 않음​​​",댓글 없음,https://cafe.naver.com/pnpsecure2/7039
7013,[공유] lsass.exe clone 프로세스 생성 시 PFC 개입으로 인한 Windows Server hang 발생 이슈,"1. 고객사명- 신세계​2. 버전- server_agent 5.1.3.44, PFC 1.0.2.367- windows server 2019​3. 현상- 1월 31일(금) 블라썸(신세계 업무 포털) 3.0 웹 배치 서버 Windows Server hang 발생에 따라 데이터센터팀 담당자가 서버를 강제 재기동함- 장기간 DBSAFEROS 설치 상태로 운영해오던 서버에서 갑자기 발생​4. 원인- 서버 재기동 간 생성 된 memory 덤프의 MS 분석 결과 LSASS 프로세스가 Clone process를 만드는 과정에서 Filter driver(PFC)의 Call back 함수 개입으로 인해 Hang이 유발된 것으로 확인- 일반적으로 lsass.exe의 경우 시스템 기동 시에 1개의 프로세스만 기동되고 운영 간에 추가 기동되지 않아야 하나 DBSAFEROS와 관련없는 외부 개입으로 인해 lsass.exe clone 프로세스가 생성됨- pfcflt는 가동 이후 생성되는 프로세스에 대해 아래 동작을 수행하며 사용자 정보를 획득하는 과정에서 hang 발생​ * 프로세스 정보 획득 과정 1. 파일 접근 제어 Callback 진입 2. 대상 파일 경로 획득 3. 파일에 접근하는 프로세스와 사용자 정보가 이미 존재하는지 확인 (pfcflt에서 리스트를 관리함) 4. 프로세스와 사용자 정보가 없을 시 수집 진행 (사용자 정보 획득 시 사용되는 SecLookupAccountSid 함수 사용 간 Hang 발생) 5. 파일 접근 제어 정책 비교 후 차단/허용​5. 임시 조치 사항- 대상 서버 DBSAFEROS 가동 중지 권고​6. 예정 사항- PFC 구동 시 현재 실행중인 모든 프로세스(사용자 정보 포함) 리스트를 미리 추가하도록 DBSAFEROS PKG 수정 >> PFC 1.2.x 버전에는 이미 적용되어 있으며 PFC 1.0.X 버전에도 적용 예정- 특수 프로세스 사용자 정보 획득 부분 개선 >> lsass, smss, services, csrss 4개 프로세스의 사용자 정보는 항상 SYSTEM >> SecLookupAccountSid API를 사용하지 않고 고정으로 SYSTEM로 설정- PKG 빌드 완료 시 패치 작업 진행​7. 피해도- 대상 서버 강제 재기동이 있었으나 업무 포털 웹배치를 진행하는 서버로 별다른 서비스 영향 없음​8. 고객사 반응- 신속한 대응 요청, MS추가 분석결과를 반영하여 모듈 수정 요청​Bugs : https://bugs.pnpsecure.com/view.php?id=30182#c107631",댓글 없음,https://cafe.naver.com/pnpsecure2/7013
6862,[공유][한국교육학술정보원] DBSAFER OS 자동 설치 모듈(pnp_sa_support),"안녕하세요. 클라우드기술팀 이상민입니다.한국교육학술정보원(NCP) e학습터 MSA 사업 요건으로 개발된 DBSAFER OS 자동설치모듈 정보를 공유하여 드립니다.​[요약]- DBSAFER OS 자동설치 모듈 개발되었음 : pnp_sa_support- 주의사항!! . 네이버 클라우드 쿠버네티스의 워커노드만을 대상으로 함 . 한국교육학술정보원 e학습터 NCP 환경 전용 모듈이며, 현재('24.12.09) 다른 고객사에서 적용 및 사용 불가 . 향후 common module로 고도화 될 예정- 단순 공유 차원의 글로 봐주시면 감사하겠습니다.​​[환경 및 모듈 정보]- CSP : NCP (네이버 클라우드 플랫폼)- NCP 서비스 내 지원 대상 : Naver Kubernetess Server Worker Node- 주요 PKG 및 모듈 버전 정보 . CustomSet_Rocky8.C_20240603.cpio.gz . PKG_DBSAFER7_RelV7-R24.05-RockyLinux_x86_64_20241011.tar.gz . COMMON_UTIL_V2.38_build-1_20240430.tgz . pnp_api-v1.0.67.tar.gz . pnp_cloud_service-1.0.7.tar.gz . pnp_sa_support_rocky8_v0.9.0.6_20241121.tar.gz . server_agent_Ubuntu22_64bit_V5.1.8.22_20241028.tar . DBSAFER_OS_Ubuntu22.04_5.15.0-94-generic.x86_64_64bit_v1.2.0.27_20240903.tar . Enterprise_Manager_7(x64)_Build-3079[7E]_Setup​​[구성도] ​​[자동설치 동작 흐름] 1) NCP pem key를 읽어옴 - pnp_sa_support.properties에서 사용할 pem key 경로 지정 - NCP 콘솔에서 NKS 클러스터 생성 시 생성하거나 등록하는 pem key이며 고객사 측으로 요청해야 함2) pnp_api에 인증 토큰 요청 - 내부 통신용 API 토큰 발행3) ncp_installed.lst 파일에서 OS 설치 uuid 리스트 조회 - 이미 설치된 워커노드들은 무시하기 위함4) pnp_api에 워커노드 리스트를 요청해서 메모리 구조로 생성 - 워커노드 리스트를 페이지 단위로 끊어서 조회 (메모리 사용량을 많이 늘리지 않기 위함)5) 워커노드 리스트에서 ncp_installed.lst 파일의 워커노드 리스트와 비교하여 OS 설치가 안된 워커노드만 설치 대상6) 워커노드 별로 NCP에 SSH 접속 패스워드 요청 후 OS 설치 진행- pnp_sa_support.properties에 SA/OS 설치 파일 경로 지정- 설치 대상 워커노드일지라도 대상 워커노드에 이미 SA/OS가 설치되어 있다면, 설치를 진행하지 않음- 워커노드 설치 경로: /usr/local/pnpsecure/server_agent(고정)- 1차로 private ip로 SSH 접속 시도 후 실패 시, public ip로 재접속 시도7) 설치가 성공한 워커노드는 ncp_installed.lst 파일에 기록8) pnp_sa_support 모듈은 기본 30분 주기로 워커노드에 OS 설치 진행 - pnp_cloud 모듈이 워커 노드 리스트를 갱신하는 주기와 맞춤​​[설치/구성 전 체크사항]1) 방화벽 포트 오픈 체크 - Manager 설치 PC -> DBSAFER TCP 3182 오픈 - DBSAFER <-> SA/OS 포트 오픈 ​2) cloud_service 모듈에서 사용할 IAM의 Accesskey, Secretkey 획득 - Accesskey: ncp_iam_XXXXXXXXXXXXXXXXXXX - Secretkey: ncp_iam_YYYYYYYYYYYYYYYYYYYYY​3) cloud_service 모듈에서 사용할 IAM Role 체크 (Role 부여 안되어 있을 시 요청) Server 보기 권한 Server 변경 권한 NKS 보기 권한 getBlockStorageInstanceListgetNetworkInterfaceListgetPlacementGroupList getServerInstanceListgetNetworkInterfaceDetailgetServerInstanceDetailgetRootPassword setSecondaryIPprotectServerTermination getClusterList getNodePoolList getServerInstancesList getSubnetList getVPCList getWorkerNodeList getClusterDetail 4) DBSAFER OS 자동설치모듈(pnp_sa_support)에서 사용할 pem key 요청 및 획득 (to 고객) - NCP 콘솔에서 NKS 클러스터 생성 시 생성하거나 등록하는 pem key - 해당 pem key는 NKS 워커노드 접속계정의 패스워드 획득 시 입력하거나- NCP API Server측으로 getRootPassword 호출 시 입력하는 privateKey에 해당함 ​​[설치 과정] 1) COMMON UTIL 설치된 상태에서 pnp_api 모듈과 pnp_cloud_service 모듈 설치​# tar xvfz pnp_api-v1.0.67.tar.gz -C /dbsafer/# ls -ld /dbsafer/pnp_apidrwxr-xr-x 2 dbsafer slaps 25 Dec 3 17:22 /dbsafer/pnp_api# ls -l /dbsafer/pnp_api/*-rw-rw-r-- 1 dbsafer slaps 50913731 Nov 14 10:52 /dbsafer/pnp_api/pnp_api.jar# ls -l /dbsafer/.conf/pnp_api.properties*-rw-rw-r-- 1 dbsafer slaps 7051 Sep 19 13:58 /dbsafer/.conf/pnp_api.properties.sample# cp -p /dbsafer/.conf/pnp_api.properties.sample /dbsafer/.conf/pnp_api.properties※ pnp_api.properties 내용 수정 불필요​# tar xvfz pnp_cloud_service-1.0.7.tar.gz -C /dbsafer/# ls -ld /dbsafer/pnp_cloud_servicedrwxr-xr-x 3 dbsafer slaps 47 Dec 3 17:24 /dbsafer/pnp_cloud_service# ls -l /dbsafer/pnp_cloud_service/*-rw-rw-r-- 1 dbsafer slaps 89184801 Nov 18 14:36 /dbsafer/pnp_cloud_service/pnp_cloud_service.jar※ pnp_cloud_service 모듈의 경우 현재 properties를 제공하고 있지 않음 (향후 제공 예정)​# tar xvfz pnp_sa_support_rocky8_v0.9.0.6_20241121.tar.gz -C /dbsafer/# ls -l /dbsafer/pnp_sa_support-rwxr-xr-x 1 dbsafer slaps 9058920 Dec 5 13:41 /dbsafer/pnp_sa_support# ls -l /dbsafer/.conf/sample/pnp_sa_ssuport*-rw-r--r-- 1 dbsafer slaps 108 Nov 21 18:39 pnp_sa_support.debug.sample-rw-r--r-- 1 dbsafer slaps 1449 Nov 21 18:39 pnp_sa_support.properties.sample# cp -p /dbsafer/.conf/sample/pnp_sa_support.properties.sample /dbsafer/.conf/pnp_sa_support.properties※ pnp_su_support.properties 파일은 현시점에서 수정 X 2) pnp_agent.conf의 policy_listener에 GW_IP:3182 추가# vi /dbsafer/.conf/pnp_agent.conf... 중략 ...policy_listeners=127.0.0.1:50011 127.0.0.1:50012 127.0.0.1:21114 127.0.0.1:3140 127.0.0.1:3182 10.0.10.9:3182 3) pnp_agent 재시작, pnp_api 모듈, pnp_cloud_service 모듈 구동※ 가급적 pnp_api -> pnp_cloud_service 순서로 모듈 구동# cd /dbsafer# ./pnp_watcher stop# ./pnp_agent stop# ./pnp_agent start# ./pnp_api.sh start# ./pnp_cloud_service.sh start# ./pnp_watcher start# ./pnp_checkintegrity update# ./pnp_checkintegrity check※ pnp_sa_support 모듈은 현시점에서 구동 X 4) cloud_service 자원관리를 지원하는 Manager 설치- Enterprise_Manager_7(x64)_Build-3079[7E]_Setup ​​[구성 과정]1) Manager 접속 > 동작 설정 > 클라우드 자원 관리 > 객체 추가 > IAM 추가- NCP_GOV: 공공존 (NCP는 민간존과 공공존이 구분됨)- 보안대상 연동방식 : 수동 or 완전자동 선택가능함, e학습터의 경우 운영자 요청으로 수동으로 설정 2) 연동정보 정상동작 확인 3) 보안대상 유형 추가- cloud_service 모듈로 자동 관리(탐지/등록)될 서비스의 종류와 포트를 정의- NKS 워커노드(우분투)만을 대상으로하며 SSH Port는 TCP 22이므로, ""TERMINAL / SSH / 22"" 추가하고 적용 4) 등록된 프로필(IAM) 사용 처리 (보안대상 연동방식: 수동) 5) 프로필을 통해 자동으로 리서치 된 리소스 조회 구분 값 설명 사용여부 사용 리소스 리서치 사용 사용여부 미사용 리소스 리서치 미사용 6) 조회된 리소스를 사용 또는 중지 처리 구분 값 설명 보안대상 사용 리서치된 리소스를 DBSAFER의 보안대상 서비스로 등록되고 구동 됨- 프로필의 속성 중 보안대상 연동방식이 완전 자동일 경우 스킵 됨​NKS 워커노드의 경우 아래와 같이 등록됨- 클러스터(NKS Cluster) ㄴ워커노드 POOL (NKS Node Pool) ㄴ 워커노드 (Server Instance) 보안대상 미사용 리서치되고 보안대상으로 등록된 서비스 중지 됨 (삭제 X) 상태 Start 조작할 수 있는 값이 아님- 리서치 된 리소스의 구동 상태를 의미 상태 Stop 조작할 수 있는 값이 아님- 리서치 된 리소스의 구동 상태를 의미 ※ 리소스가 Scale-In 처리될 경우 보안대상 서비스 목록과 리소스 관리 목록에서 해당 리소스 삭제됨​7) SA/OS 사용 설정 (생략)8) pnp_sa_support.properties 설정- /dbsafer/key 디렉토리 아래에 DBSAFER OS 자동설치모듈(pnp_sa_support)에서 사용할 pem key 업로드- /dbsafer/var/server_agent/pkg 디렉토리 생성- properties 수정※ 아래 4개의 파라미터 값만 주의해서 설정# Manager ID (DEF:admin)MANAGER_ID=admin​# NCP Pem Key Path# Ex: key/ncp_key.pemNCP_PEM_KEY_PATH=key/keristest-key.pem​# NCP Access ID (DEF:ncloud, 민간존:root)NCP_ACCESS_ID=ncloud​# NCP SA/OS Installation Package Path (DEF:""var/server_agent/pkg"")NCP_INSTALL_PKG_PATH=var/server_agent/pkg​※ 자동설치 주기 기본값: 30분# Auto Installation Cycle (DEF:30min, MIN:10min, MAX:60min)INSTALL_CYCLE=30​9) 자동 배포/설치할 SA/OS 패키지 업로드 10) pnp_sa_support 모듈 구동11) pnp_sa_support 자동설치 성공 로그 및 lst 파일 확인# cat /dbsafer/log/pnp_sa_support/2024/12/09/pnp_sa_support_2024120918.logncp_sa_installer.go:113 Run() - OS installation completed NPC Worker Node list file recording completed: 30bytes​# cat /dbsafer/var/pnp_sa_support.ncp_installed.lst100533618,100533615,100533621 (워커노드 인스턴스 식별자)​​[결과] ※ NCP 클러스터 2개 워커노드 Pool 10개 테스트 시 문제 없었음 (비용 문제로 테스트 환경 워커노드 Pool 바로 삭제) ​​[제약사항 및 주의사항]1) NKS 클러스터 별 다중 Pem Key 지원 안 함2) Pem Key를 파일 형태로 보관해야 함 - 현재 GUI 입력 및 DB저장 기능은 제공하지 않음3) SA/OS 설치 패키지는 동일한 OS일지라도 서로 다른 릴리즈 버전이 존재하면 안 됨- OS 배포판 별 패키지 1개만 존재해야 함- 단, DBSAFER OS의 경우 커널 버전이 다른 경우 동일 OS 배포판 이라도 상관없음4) SA/OS 설치 패키지는 서로 호환되는 릴리즈 버전에 맞춰 DBSAFER에 업로드 해야 함5) pnp_sa_support 모듈은 pnp_cloud, pnp_api 모듈과 동일한 서버에 위치해야 함6) pnp_sa_support 모듈을 디버그 레벨로 구동 시 getRootPassword API를 통해 획득한 계정의 패스워드가 로그에 찍힘7) Manager GUI를 통한 자동설치 이력 조회 기능은 아직 제공하지 않음 - /dbsafer/var/pnp_sa_support.ncp_installed.lst 파일에서 설치된 노드의 인스턴스 식별자 확인 가능8) 현재 pnp_sa_support 모듈은 자동 리서치된 모든 NKS 워커노드를 대상으로 자동설치 시도함 - 보안대상 사용/미사용 값을 필터링 해서 자동설치 시도하도록 개선될 예정​",댓글 없음,https://cafe.naver.com/pnpsecure2/6862
6820,[현기차 생산망] 무결성 검사 시 wta_server_manager.conf 로 인한 무결성 검사 실패,"[분류] (에러로그문의 / 기능로직문의 / 기타문의) 기능로직문의​[고객사/채널사] 현기차 생산망​[이슈내용] 1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0 - 무결성 검사 시 wta_server_manager.conf 로 인하여 실패 동작​2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항) - wta_server_manager.conf 의 변경 일자가 최근 일자인 것을 확인 3. 특이사항 (연동 모듈, 커스텀 개발 등) - LOG2EA, GW12EA 구성​4. 사내 재현 정보 - 없음​5. 요청사항 - wta_server_manager.conf를 수동으로 변경하지 않고 시스템에 의해 변경되는 동작이 무엇이 있는지 확인 필요- 내용은 변경되지 않지만 해당 conf 파일의 해쉬값만 변경되는 동작이 있는지 확인 필요​[모듈 로그(Debugging 로그 및 ERROR 로그] (파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함) ​​[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등) ​​​[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)",RDP 서비스를 등록/삭제 할때 해당 파일이 수정되는것으로 확인했습니다,https://cafe.naver.com/pnpsecure2/6820
6791,[LS그룹사]Windows 용 최신 ServerAgent wta 모듈 미포함하여 빌드 가능 여부 문의드립니다.,"[분류] (에러로그문의 / 기능로직문의 / 기타문의) ​​[고객사/채널사] - LS그룹사​[이슈내용] 1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크) - Windows SA wta 모듈이 정지되는 현상​2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항) - 고객사에서는 터미널 서비스를 사용하지 않고 있으며, SA 로그에서 Service Not Found! 로그가 지속적으로 쌓이다 wta 모듈이 정지됨- 첨부 파일 : LS그룹사_SA_log_20241112.log 에서 2024-11-12 17:03:31경 로그 확인 시 대상 컴퓨터에서 연결을 거부했으므로 연결하지 못했습니다. 에리로그 발생 확인 가능​3. 특이사항 (연동 모듈, 커스텀 개발 등) ​​4. 사내 재현 정보 - 없음​5. 요청사항 - 현재 고객사에서 터미널 서비스를 사용하지 않고 있어 wta모듈이 미포함된 SA 빌드 가능 여부를 확인 요청드립니다.1) 최신 ServerAgent 모듈에서 wta 모듈이 없이 빌드 가능 여부 확인 부탁드립니다.2) wta 모듈 미포함시 Enterprise Manager 관리대상서버 모니터링에서 ws장애 상태 표시가 안되는지 확인 부탁드립니다.​[모듈 로그(Debugging 로그 및 ERROR 로그] (파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함) LS그룹사_SA_log_20241112.log​[2024-11-12 17:02:59] [INFO] [1476] [WTA_00020021] [CSendUtil::UpdateWtaConfig, 1508] - [165.243.45.201+165.243.45.202] 에서 WTA 서버 설정을 수신 완료하습니다. ((Service Not Found!))[2024-11-12 17:03:06] [INFO] CWtaConfig::ReceiveWTAServerManagerConfig:786 - Succeed to recv wta_server_manager conf (RecvLen:82, srcPort:58305) CURRENT_TIME=1731398568CLIENT_IP=165.244.33.8NO_SERVICE_FOUND=1​[2024-11-12 17:03:06] [INFO] [4912] [WTA_00020021] [CSendUtil::UpdateWtaConfig, 1508] - [165.243.45.201+165.243.45.202] 에서 WTA 서버 설정을 수신 완료하습니다. ((Service Not Found!))[2024-11-12 17:03:31] [ERROR] [1476] [SOCK_00000006] [CWtaConfig::SendWTAServerManagerConfigToWTS, 1274] - connect() failed[대상 컴퓨터에서 연결을 거부했으므로 연결하지 못했습니다.(10061)][2024-11-12 17:03:31] [INFO] CWtaConfig::ReceiveWTAServerManagerConfig:786 - Succeed to recv wta_server_manager conf (RecvLen:82, srcPort:58308) CURRENT_TIME=1731398594CLIENT_IP=165.244.33.8NO_SERVICE_FOUND=1​[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등) - Windows Server Agent V5.1.8.4- Windows Server Agent V5.1.6.7- pnp_server_manger V5.1.8.35​​[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)- LS그룹사_SA_log_20241112.log 첨부파일 LS그룹사_SA_log_20241112.log null 파일 다운로드 내 컴퓨터 저장 네이버 MYBOX에 저장 ​이상입니다.감사합니다.",해당 대상 서버 대상으로 아래 설정 후 발생하는지 확인 부탁드립니다.Server Agent 관리 설정 > 대상 서버 > 추가설정 : USE_WTA = OFF,https://cafe.naver.com/pnpsecure2/6791
6658,[공유][LS전선] SA로 제어하는 DBSAFER 서버 접속 시 'PC IP(일반 접속 로그) + [DBSAFER VIP](우회 접속 로그) ' 로 두 개의 로그가 남는 현상,"[요약]- SA로 제어하는 DBSAFER 서버 접속 시 'PC IP(일반 접속 로그) + [DBSAFER VIP](우회 접속 로그) ' 로 두 개의 로그가 남는 경우, LOG서버의 /dbsafer/.conf 폴더에 pnp_cloud_ip.conf 파일 생성 및 gw_ip = [VIP] 설정 추가 후 정책 배포 또는 ServerManager 재시작이 필요합니다.- pnp_cloud_ip.conf에 gw_ip=[VIP] 추가 시 대상서버 ServerAgent alias.conf DBSAFER_IP 설정에 +[VIP] 가 추가되며 우회 접속 로그가 발생하지 않습니다. ** 해당 현상은 SA를 사용하여 DBSAFER서버도 제어하는 경우 GW를 통하여 동일 서버 접속 진행 후 # who -m 명령어 사용하여 접속 IP 확인 시 접속 IP가 DBSAFER RIP가 아닌 DBSAFER nic에 설정된 다른 IP or VIP가 출력되는 서버에서 발생 할 수 있는 이상 현상입니다. (SA를 통해 제어하는 모든 DBSAFER 서버에서 발생하는 것이 아님)​[고객사 환경]1. 구성 : Default GW서버 2대 이중화 서버(DBSAFER 서버에 SA설치되어 제어 진행)2. OS : CentOS7.93. DBSAFER : 5.04. 버전 정보 :- ServerManager : V5.1.8.30- ServerAgent : V5.1.8.2​[이슈 내용]1. DBSAFER GW1을 통하여 DBSAFER GW1에 접속 시 서비스 로그에 접속 IP가 DBSAFER 서버 DOWN상태 인 nic로 부여된 10.10.10.1으로 우회 접속 로그, 실제 접속한 사용자 로컬 IP로 일반 접속 로그가 기록 됨2. IP가 부여된 nic에 # ifconfig [NIC] 0.0.0.0 명령어 사용하여 IP 회수 진행 3. IP회수 진행 후 DBSAFER GW1을 통하여 DBSAFER GW1에 접속 시 서비스 로그에 접속 IP가 DBSAFER 서버 VIP로 우회 접속 로그, 실제 접속한 사용자 로컬 IP로 일반 접속 로그가 기록 됨 [1) IP 회수 진행 전 10.10.10.1로 우회 접속 로그 화면] [3) IP 회수 진행 후 서버 VIP로 우회 접속 로그 화면] ​[확인 사항]​​- 리눅스 SA 우회 접속 시 SA의 접속 IP 취득 로직 확인> pnp_shell은 # who -m 명령어를 사용하여 출력된 IP를 바탕으로 접속 IP를 취득함- 현재 고객사에서는 # who -m 명령어 사용 시 VIP가 출력됨 [사용하지 않는 nic에 부여되어 있는 IP가 DBSAFER 서비스 모듈을 통하여 접속하였음에도 who -m 명령어 실행 시 IP가 출력되는 화면]※ 이해를 돕기 위한 예시 화면입니다. - SA alias.conf 확인 결과 DBSAFER_IP 에 DBSAFER RIP만 설정되어 있음을 확인> 이로 인하여 VIP 는 DBSAFER IP로 판단하지 않아 우회 접속 로그 생성​[조치사항]1. LOG 서버 /dbsafer/.conf에 pnp_cloud_ip.conf 생성 후 gw_ip=[VIP] 설정 추가하여 SA 정책 배포 진행> 정책 배포 진행 후 alias.conf DBSAFER_IP=[DBSAFER RIP]+[DBSAFER VIP] 설정 추가됨2. 접속 테스트 진행 및 로그 확인 결과 사용자 로컬 IP 접속로그만 생성 됨을 확인​[추가 내용]- # who -m 명령어 사용하여 접속 IP확인 시 /var/run/utmp 파일에 등록된 접속 IP를 가져옵니다. utmp 파일에 접속 IP가 잘못 기재되는 경우 해당 이슈가 발생 할 수 있습니다.(** /var/run/utmp 파일 내용 확인 명령어 : # strings /var/run/utmp)​이슈 해결에 도움을 주신 남신우 팀장님, 김태윤 실장님, 양문섭 차장님 감사드립니다.​이상입니다.감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6658
6457,[국방 DIDC] SA가 설치된 AIX 7.2 Tibero 서버에서 FAILOVER되는 현상,"[분류] (에러로그문의 / 기능로직문의 / 기타문의) 기능 로직 문의​[고객사/채널사] 고객사 / 국방 DIDC​[이슈내용] 1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크)- 티베로에서 pcap_findalldevs()함수를 이용하여 NIC를 찾는 과정을 수행하는 도중 NIC를 찾지 못하면서 VIP가 deact(비활성화)로 변경- VIP가 deact로 변경된 서버가 1번이면 2번으로 1번 VIP를 전달- VIP가 deact로 변경된 서버가 2번이면 1번으로 2번 VIP를 전달- 1번,2번에서 VIP가 deact로 동시에 빠지게 되면 1,2번의 VIP는 통신 불가- 현재 계속 VIP가 빠지는 현상​2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항) - DBSAFER SA / Tibero 에서 PCAP 라이브러리를 사용하고 있음- SA를 종료하고 나서 Tibero에서는 로그 및 특이 사항이 없음 (현재 문의 시간 기준 7시간 가량 정상 상태)​3. 특이사항 (연동 모듈, 커스텀 개발 등) [SA 설정]operation level = 0 ​[대상 서버 환경]수량 : 6대OS : AIX 7.2DB : Tibero구성 : 이중화 구성 (1번 Active(VIP1) - 2번 Active(VIP2))네트워크 구성 : 1번 RIP, VIP / 2번 RIP, VIP​[티베로 Failover 방식]- Tibero에서 PCAP 라이브러리를 호출하여 사용 가능한 인터페이스에 대해서 RIP, VIP 순서로 확인을 하여 상태체크를 진행- pcap 라이브러리에서 pcap_findalldevs()함수를 이용하여 NIC를 찾는 과정을 수행- NIC를 찾지 못하거나 통신이 안될경우 Failover 발생​[장애 대응 방법]- 티베로 DB 및 인스턴스를 재기동하는 것은 의미가 없이 서버를 재부팅해야 Tibero가 정상으로 전환​4. 사내 재현 정보 -없음​5. 요청사항 - SA에서 pcap 라이브러리를 사용할 때 다른 프로세스에서 사용이 불가한지 확인 부탁드립니다.- SA에서 pcap 라이브러리를 사용하고 나면 다른 프로세스에서 사용하는 pcap 라이브러리 관련 프로세스도 kill 하는지 확인이 필요합니다.​[모듈 로그(Debugging 로그 및 ERROR 로그] (파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함) - 사이트 특성상 반출 불가​[버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등) ServerAgent : v5.1.8.12 (r1347)ServerManager : v5.1.8.25​​[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)",1개 서버 대상으로 2개의 서비스가 등록되어서 발생 된 이슈로 다시 확인하였습니다.현재도 문제가 되는 것인지 확인해주세요.,https://cafe.naver.com/pnpsecure2/6457
6379,[공유] SFTP 서비스 등록 시 자동으로 등록되는 TERMINAL(SSH) 서비스로 SA 정책 배포 실패하는 문제 수정,SA 이슈로 수정되었던 내용이 제대로 전파되지 않아이슈로 확인되었던 내용이 있어 해당 이슈 공유드립니다.동일한 이슈 발생 시 아래 수정 버전에 있는 Server Manager 버전을 참고하여 패치해 주시면 됩니다.​[수정된 이슈] SFTP 서비스 등록 시 자동으로 등록되는 TERMINAL(SSH) 서비스로 SA 정책 배포 실패하는 문제​[수정 버전]- pnp_server_manager . V5.1.6.47 이상 . V5.1.8.6 이상 ​[발생 원인]- SFTP 서비스 등록 후 TERMINAL(SSH) 서비스가 등록될 경우 서비스 포트 (Ex: 22)가 중복됨- SM 은 동일한 서비스 포트를 사용하는 서비스 정보 중 먼저 등록된 서비스를 관리 정보로 구성하도록 되어있음- 그래서 gw_svc_port 정보 구성 시 먼저 등록된 SFTP 서비스를 참조하여 TERMINAL 서비스 포트가 아닌 0을 전달​[수정사항]- Server Manager 가 서비스를 읽고 등록하는 과정에서 SFTP 서비스가 먼저 등록되고 이후에 TERMINAL(SSH) 가 등록되는 경우 SFTP 가 아닌 TERMINAL(SSH) 서비스로 교체​[수정 이슈]https://bugs.pnpsecure.com/view.php?id=23966,댓글 없음,https://cafe.naver.com/pnpsecure2/6379
6295,[TIP] 서버 연결 세션에서 타 서버 접속 시 정책이 중복으로 적용되는 현상 공유,"[요약]- A서버 우회접근 세션에서 B서버로 우회 접근 시 B서버에 A/B서버 정책이 함께 적용되어 허용/차단 동작이 비정상 동작할 수 있음- B서버의 정책만 적용하고자 할 경우 A서버 서버에이전트 관리설정에 AP_JUMP_TRACE=ON 옵션 적용 필요 ​​[증상]- 사용자가 배스천 서버 우회 접속 후 엔드포인트 서버 우회 접속, 위험 명령어 수행(허용 정책 있음) 시 허용되지 않고 차단됨 su change 명령이 허용되었으나 계정 전환 되지 않으며 콘솔 육안 확인 시 'Permission Denied' 발생 ​​[원인]- 사용자 > 배스천 > 엔드포인트 방식으로 서버에 연결할 경우 세션로그는1. 사용자 > 배스천2. 배스천 > 엔드포인트 두개로 중복되어 로깅되며배스천 서버가 목적지 아이피인 세션로그에서 해당 명령어가 차단됨.(배스천 서버는 su 명령어 차단 정책 운영중) ​​​[해결 방법]- 배스천 서버 서버에이전트 관리설정에 AP_JUMP_TRACE=ON 옵션 적용 . 해당 옵션은 중간 AP를 경유해 서버에 접속 할 경우 중간 AP 정책 적용을 건너뛰는 기능입니다. 관리설정 내 옵션 설정 alias.conf 적용 - AP_JUMP_TRACE 옵션을 적용할 경우 원격 서버에 연결된 이후로는 중복으로 로깅되는 내용도 제외됩니다.​ 배스천 서버에서 ssh 명령을 통한 원격 접속 이후 명령어 로깅 제외됨 ​ 엔드포인트 서버에서 su change 명령 허용된 화면 ​​[참고 사항]- 위 내용은 배스천, 엔드포인트 2개 서버에 모두 PNPSHELL을 통한 우회 접근이 이루어졌을 경우에 발생할 수 있는 이슈입니다.​ 해결에 도움을 주신 부사장님, 박재현 팀장님, 정현교 대리님 감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6295
6157,[공유] resource_view 프로세스 stop/start 반복 현상,"1. 버전- server_agent_RedHatServer8_64bit_V5.1.2.51- DBSAFER_OS_RedHatServer8_4.18.0-425.el8_7.x86_64_64bit_v1.0.1.94​2. 현상- DBSAFEROS 설치 서버에서 약 1분20초 간격으로 Server Agent의 resource_view 프로세스가 아래와 같이 stop, start를 반복 3. 확인사항- resource_view 프로세스가 down될 시 exit (0) 신호로 down되어 정상종료로 인식되었고 ulimit -c unlimited 설정 상태에서도 core를 남기지 않음​- 아래와 같이 DBSAFEROS 커널 모듈은 정상 동작상태로 표시되고 policy_manager 프로세스도 특이사항 없으나 resource_view 만 재가동 반복 *** lsmod 명령어란?lsmod는 현재 시스템 메모리에 로드되어 있는 커널모듈들의 리스트를 출력하는 모듈 관련 명령어입니다.출력되는 결과에서 현재 로드되어 있는 커널모듈들에 대하여 모듈명, 모듈사이즈, 사용된 횟수, 참조모듈등의 정보를 볼 수 있습니다.리눅스에서 커널모듈정보를 실시간으로 저장하고 있는 파일은 /proc/modules 파일이며 이 파일을 cat명령어로 확인해 보면 현재 커널이 사용할 수 있도록 로드되어 있는 커널모듈들에 대한 실시간 정보를 확인할 수 있습니다.​4. 원인- resource_view 에서 처리하는 ""LISTEN 포트 수집 기능""의 로그 버퍼 크기: 4096 bytes- policy_manager 에서 resource_view 에서 전송하는 데이터 수신 버퍼 크기: 2048 bytes- policy_manager 는 버퍼 범위 내에서 개행 문자 ('\n') 를 포함하지 않는 경우 데이터를 이어서 수신하는 기능은 제공하나버퍼 범위를 초과하는 데이터는 처리가 불가하여 비정상 세션으로 판단하여 로그 수신 쓰레드를 종료- resource_view 는 구조적으로 빠른 성능을 위해 policy_manager로 send() 후 응답 메시지를 수신하지 않는 구조이기 때문에 위와 같이 비정상 상황 발생 시 종료된 세션의 소켓에 send() 를 시도하기 때문에 SIGPIPE 가 발생하였고 이로인해 resource_view 프로세스 down 발생​5. 수정사항(Server Agent v5.1.2.76 에서 수정)- policy_manager 의 UDS 통신 로그 수집 쓰레드 함수의 수신 버퍼 크기를 2048 -> 4096 bytes 로 확장- 위와 같은 버퍼 크기 동기화 문제 발생을 체크하도록 resource_view가 policy_manager로 send() 실패한 경우 실패 로그 기록되도록 수정​bugs 링크 : https://bugs.pnpsecure.com/view.php?id=26611",수신 버퍼 크기가 달라도 일반적인 상황에서는 문제가 없는데... 다른 2차적인 문제가 추가적으로 있었던 것은 아닌지? 의심되는 부분이 있기는 합니다. 그래도 자세하고 분석적인 리포팅 감사드립니다.,https://cafe.naver.com/pnpsecure2/6157
6138,[TIP] MSSQL ID/APP 수집을 위해 SQL 접속 주소 설정 기능 추가,"[이슈] > SA MSSQL id/app 적재를 위한 localhost 접속 시도 시 TCP 접속 방식으로만 시도하나 고객사 MSSQL 보안 정책상 차단되어 있음 > localhost 이외의 접속 방법 기능 추가​[ SA -> MSSQL 접속 방식 설정 관련 정보] > 접속 테스트 명령어 (-E : windows 계정 인증) sqlcmd -S tcp:127.0.0.1 -E sqlcmd -S np:\\.\pipe\MSSQL$MSSQLSERVER\sql\query -E sqlcmd -S localhost -E​> windows 계정 인증으로 접속이 불가능 할 경우 아래 형식으로 확인 sqlcmd -S tcp:127.0.0.1 -U 계정 -P 비번 세션 접속 방식 확인 쿼리를 포함해서 실행 (명령어) sqlcmd -S localhost -E -Q ""SELECT TRIM(C.net_transport) FROM sys.dm_exec_connections AS C LEFT JOIN sys.sysprocesses AS P ON C.session_id = P.spid WHERE P.program_name='SQLCMD'""​ > 현재 접속된 세션들의 방식 확인 쿼리 SELECT P.loginame, P.program_name, C.net_transport FROM sys.dm_exec_connections AS C LEFT JOIN sys.sysprocesses AS P ON C.session_id = P.spid​ > SA가 MSSQL ID/APP 을 수집하기 위해 사용하는 쿼리는 아래와 같습니다. SELECT P.loginame, P.program_name FROM sys.sysprocesses AS P INNER JOIN sys.dm_exec_connections AS C ON P.spid = C.session_id AND C.client_tcp_port=<Src Port> AND C.client_net_address='<Src IP>'​ > MSSQL 접속 계정 관리에 설정할 계정에 sys.sysprocesses, sys.dm_exec_connections 테이블 접근 권한이 있어야 하며 127.0.0.1, 1433 (named pipe) 접속 권한이 필요합니다.​[SA mssql id/app 수집 현황] > ServerAgent 관리 설정에 MSSQL_ACC_ADDR_<MSSQL 포트> 설정 추가 (설정이 없을 경우 기본 tcp:127.0.0.1로 접속) 예시1) MSSQL_ACC_ADDR_1433=tcp:127.0.0.1 >>> tcp 통신 (기본값, v5.1.8.15 이상 반영) 예시2) MSSQL_ACC_ADDR_1433=pipe\MSSQL$MSSQLSERVER\sql\query >>> named pipe 통신 (v5.1.8.14 반영) 예시3) MSSQL_ACC_ADDR_1433=np:\\.\pipe\MSSQL$MSSQLSERVER\sql\query >>> named pipe 통신 (v5.1.8.15 이상 반영) ** named pipe 명 확인 방법 Sql Server Configuration Manager 실행 -> SQL Server Network Configuration -> Protocols for <InstanceName> -> Named Pipes 활성화 필수 (변경시 MSSQL 재시작 필요) -> 파이프 이름 값 확인 (np:\\.\pipe\MSSQL$MSSQLSERVER\sql\query) 예시4) MSSQL_ACC_ADDR_1433=localhost >>> MSSQL 별칭으로 등록된 키워드 (v5.1.8.15 이상 반영) ​[결론]기본 상태에서 접속이 안 될 경우 Sql Server Configuration Manager 에서 아래 두 가지 방법을 확인하여sqlcmd 명령어를 통하여 테스트하고, 가능한 방법을 serveragent 설정 (MSSQL_ACC_ADDR_1433)으로 적용하면 됩니다.​1. MSSQL에 named pipe 접속 활성화 여부 및 파이프명을 확인 >> 예시) MSSQL_ACC_ADDR_1433=np:\\.\pipe\sql\query2. MSSQL에 접속 가능한 별칭(alias)이 있는지 확인 >> 예시) MSSQL_ACC_ADDR_1433=np_test",댓글 없음,https://cafe.naver.com/pnpsecure2/6138
6114,[TIP][공유] Rocky Linux strings 명령어 부재에 따른 DBSAFER OS 커널모듈 로드 실패,안녕하세요. 클라우드기술팀 이상민입니다.메가존 클라우드 운영인력을 대상으로 DBSAFER OS 교육 및 기능 시연 중 확인된 이슈 및 해결 방안을 공유하여 드립니다.​[증상]- DBSAFER OS 커널모듈 로드되지 않음​[원인]- DBSAFER OS의 커널모듈을 로드 시킬때 strings 명령어가 사용됨- 그러나 로키리눅스는 기본적으로 strings 명령어가 설치되어 있지 않음​[해결]- strings 명령어 설치# yum install binutils※ 메가존 클라우드에서 제공한 테스트 환경이었기 때문에 yum install로 대응했습니다.※ 고객사 서버라면 엔지니어가 임의로 yum or rpm install을 수행하면 안됩니다.​[OS 및 PKG정보]- Rocky Linux 8.8 (4.18.0-477.el8_8.x86_64)- server_agent_RockyLinux8_64bit_V5.1.8.8_20230921.tar- DBSAFER_OS_RockyLinux8_4.18.0-477.el8_8.x86_64_64bit_v1.2.0.11_20231106.tar,폐쇄망의 경우 yum이 안될 수가 있을 것 같은데 DBSAFER OS PKG에 RPM 파일을 추가하는 것은 어떨까 의견 드려봅니다.,https://cafe.naver.com/pnpsecure2/6114
6050,[TIP] DBSAFER7.0 구축 시 우회접근정책에 연결된 한글 객체명 깨짐 현상 공유,"[요약]- DBSAFER7.0 구축 및 우회접근정책 사용(SA 설치) 환경에서 정책 연결 객체를 한글명으로 사용 시 필수로 최신 버전의 에이전트를 사용해야 함 ​​[증상]- DBSAFER7.0 구축 및 SA 설치 후 우회접근정책을 생성시 연결하는 객체(ex. 어플리케이션, 접속계정) 중 한글 객체명이 깨짐 > 정책 오동작으로 허용 대상도 모두 차단됨​[원인]- 7.0에서 변경된 캐릭터셋(UTF8)으로 인해 우회접근정책을 SA로 배포할 때 UTF8로 전송함- 기존 버전 SA의 경우 UTF8 컨버팅이 누락되어 있으므로 정책 내 모든 한글 깨짐 - 컨버팅 자체의 누락이므로 역으로 SA에서 전송하는 우회접근로그의 경우에도 한글 깨짐. ​[해결 방법]- QA를 통해 최신 버전의 SA/SM을 배포받아 사용하시기 바랍니다.- pnp_server_manager : 5.1.8.28 버전 이상 사용- 현재 RHEL7 : 5.1.8.11 / AIX7.2 : 5.1.8.11 / Windows : 5.1.8.12 버전 먼저 선제적으로 개선되어 있는 상태입니다.​​감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/6050
6029,[로그문의] DBSAFER OS 설치 및 실행 시 /var/log/messages에 pfc_hook 관련 failed 로그 발생 원인 문의,"[분류] (에러로그문의 / 기능로직문의 / 기타문의) 에러로그문의​[고객사/채널사] 현대백화점그룹 및 사내테스트​[이슈내용] 1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0 서버에 DBSAFER OS 설치 후 DBSAFER로부터 정책 내려받아 커널모듈이 실행될 때 /var/log/messages에 아래와 같은 로그가 발생Oct 17 08:56:44 dfl203was kernel: pfc_hook: loading out-of-tree module taints kernel.Oct 17 08:56:44 dfl203was kernel: pfc_hook: module verification failed: signature and/or required key missing - tainting kernelOct 17 08:56:45 dfl203was kernel: [PFC] pfc_hook load(pfc_hook_V1.0.1.92(Linux_4.18.0-305.el8.x86_64_64bit)).​2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항) 1) Enterprise Manager 관리대상 서버 모니터링 메뉴에서 확인 시 대상 서버 상태가 ""pfc_hook 장애"", 또는 ""pfc_manager 장애"" 등으로 표기되는지 확인해보았으나 ""정상""으로 표기되어 있음.2) 고객사에 대상 서버에서 아래 명령어 수행을 요청하여 Secure Boot가 설정되어 있는지 확인하였으나, 해당 사항 없음. # mokutil --sb-state3) 고객사에 대상 서버에서 아래 명령어 수행을 요청하여 pfc 모듈이 잘 적재되었는지 확인하였으나, 특이사항 없음. # lsmod | grep pfc​3. 특이사항 (연동 모듈, 커스텀 개발 등) 없음.​4. 사내 재현 정보 DBSAFER 서버 : 192.168.101.83:7795 (SSH : root/dbsafer00, Manager : admin/admin007)SA/OS를 설치한 서버 : 192.168.101.86:22 (SSH : root/dbsafer00)​5. 요청사항 /var/log/messages 상으로 module verification failed 로그가 발생하였으나 실제로는 커널모듈이 정상적으로 적재 및 실행중인 것으로 보입니다.해당 로그가 발생하는 이유가 단순히 pfc 모듈이 kernel module signing이 되어있지 않아 발생한 것인지와, 추후 운영에 영향을 미칠 수 있는 로그인지 등에 대하여 확인 요청드립니다.​[모듈 로그(Debugging 로그 및 ERROR 로그] (파일 첨부를 하는 경우에도 중요한 에러로그(ERROR, WARNING)의 경우 반드시 본문에 포함) ​addon/pfc/log/eventlog /var/log/messages # lsmod | grep pfc# mokutil --sb-state Enterprise Manager - 관리대상 서버 모니터링 [버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등) DBSAFER > PKG_DBSAFER5_RelR22.11-RHEL8_x86_64_20230413Server Agent > server_agent_RedHatServer8_64bit_V5.1.6.12_20230223DBSAFER OS > DBSAFER_OS_RedHatServer8_4.18.0-305.el8.x86_64_64bit_v1.0.1.92_20230213pnp_server_manager > pnp_server_manager-V5.1.6.39 Build(106) P(2.0.0.1) - RelR22.05C-RHEL8 : Linux_4.18.0_x86_64pfc > pfc_loader_V1.0.1.92 > pfc_hook_V1.0.1.92(Linux_4.18.0-305.el8.x86_64_64bit) > pfc_manager_V1.0.1.92(Linux_4.18.0-305.el8.x86_64_64bit) > pfc_current_os_VLinux_4.18.0-305.el8.x86_64_64bit​[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명)-​​위 내용 확인 요청드립니다.항상 감사합니다.","DBSAFER OS 커널 모듈에 서명이 없어서 발생한 로그입니다.secure boot 가 설정되지 않고, 커널 모듈이 정상적으로 로드된 상태라면 기능 동작에 문제는 없습니다.추가로, secure boot 가 설정된 환경에서도 동작할 수 있도록 커널 모듈에 서명을 진행할 예정입니다.관련 벅스 : https://bugs.pnpsecure.com/view.php?id=26276",https://cafe.naver.com/pnpsecure2/6029
5952,pnp_server_manager에서 Table dbsafer3.dbsafer_os_listen_port doesn't exist 발생,"[분류] (에러로그문의 / 기능로직문의 / 기타문의) 에러로그문의​[고객사/채널사] 중앙대학병원​[이슈내용] 1. 증상 (증상 발생 전/후 변경된 사항의 유무를 반드시 체크0 - Table dbsafer3.dbsafer_os_listen_port doesn't exist 발생 - SA설치후 해당 증상이 발생하는 것으로 보이며 설치버전은 아래와 같습니다 Window 5.1.2.60 / 5.1.2.59 LINUX 5.1.2.51 / 5.1.2.36​2. 예상되는 원인 및 확인한 내용 (방화벽 및 보안 프로그램 등의 체크 사항) - SA설치후 해당 증상이 발생하는 것으로 보이며 설치버전은 아래와 같습니다 Window 5.1.2.60 / 5.1.2.59 LINUX 5.1.2.51 / 5.1.2.36​3. 특이사항 (연동 모듈, 커스텀 개발 등) - DBSAFER OS 기능사용 X​4. 사내 재현 정보 - N/A​5. 요청사항 ​[모듈 로그(Debugging 로그 및 ERROR 로그] [버전 정보](서버 PKG, Manager, PC-ASSIST, 클라이언트 툴 버전 등) SA버전 Window 5.1.2.60 / 5.1.2.59 LINUX 5.1.2.51 / 5.1.2.36SM버전 5.1.2.32​[첨부파일](파일명에 이슈와 관련된 모듈이나 제품명 및 사이트명) ​","Server Agent 에서는 기본으로 리슨 포트 수집 기능이 동작하고 있는데,Server Manager 에서는 DBSAFER OS 사용 옵션을 설정해야 관련 테이블을 생성하고 있었습니다.해당 현상은 아래 서버매니저 버전에서 개선됐습니다. (관련 벅스 : https://bugs.pnpsecure.com/view.php?id=20256) - Server Manager 5.1.2.37 이상 버전",https://cafe.naver.com/pnpsecure2/5952
5822,[공유] SA기능은 정상 동작하지만 서버 상태 및 정보(os/hostname)가 정상적으로 업데이트되지 않는 증상,"[요약]- DBSAFER <=> 해외 보안 대상 서버 구간의 통신 속도가 느려 SA 상태 검사에 실패하여 대상 서버의 정보를 취득하지 못함- SA기능은 정상 동작하지만 서버 상태 및 정보(os/hostname)가 정상적으로 업데이트되지 않는 증상 발생- pnp_server_manager.conf 에 서버 연결 대기시간 옵션 추가하여 조치 완료​​​[고객사 환경]- DBSAFER 구성 : 단독구성- DBSAFER 서버 위치 : AWS(서울 리전)- 보안 대상 서버 위치 : AWS(서울 리전, 프랑크푸르트 리전)​​​[상세]1. 이슈 내용- 매니저의 관리 대상 서버 모니터링에서 서버 상태 및 정보가 업데이트 되지 않는 현상 발생- 보안대상 서비스는 정상적으로 등록 및 구동 중이며, pnp_server_manager 데몬도 정상적으로 실행 중임에도 서버 상태가 ""서버 Timeout""으로 표시되고 관리대상 서버 모니터링 및 Server Agent 관리 설정 항목에 OS, 호스트명이 업데이트 되지 않음-이슈가 발생하는 보안 대상 서버에 ServerAgent 정책과 설정 내용은 정상적으로 적용되며, 관리 대상 서버 모니터링의 ""Agent 시작/정지/재시작"" 기능도 정상 동작함- pnp_server_manager, wta_player, wta_proxy_server, wta_server_manager, pnp_telnet 데몬 로그에 오류 없음- 해외 리전(프랑크푸르트 리전)에 있는 보안 대상 서버에서만 해당 이슈 발생(서울 리전에 있는 보안 대상 서버는 서버 상태가 정상) Server Agent 관리 설정 관리 대상 서버 모니터링 ​​2. 확인 과정- 서울 리전 보안 대상 서버와 해외 리전 대상 서버를 대상으로 패킷 덤프 취득 . DBSAFER IP - 10.146.9.218 . 서울 리전 보안 대상 서버 IP - 10.146.10.4 . 프랑크푸르트 리전 보안 대상 서버 IP - 10.146.7.16 [정상 서버] dbsafer<=> 서울리전 보안 대상 서버 [이슈 발생 서버] dbsafer<=> 프랑크푸르트리전 보안 대상 서버 - 보안 대상 서버의 Server Agent와 DBSAFER의 pnp_server_manager 모듈은 주기적으로 통신 검사를 하여 상태를 점검함(TCP 21113 포트 이용)- 해외 리전에 있는 보안 대상 서버는 상태 검사 과정에서 , 3-way handshake가 완성되기 전 RST 패킷이 떨어지는 것을 확인- 정상적인 패킷 덤프 파일과 비교해보았을 때, SYN > SYN+ACK 과정의 통신 시간이 지연되는 것을 확인​​3. 이슈 발생 원인- DBSAFER <=> 해외 보안 대상 서버 구간의 통신 속도가 느려서 SYN > SYN+ACK 과정의 통신 시간이 지연됨- 연결 시간 지연으로 3-way handshake가 완성되기 전에 DBSAFER에서 RST 패킷을 보내 연결이 종료되어 보안 대상 서버의 정보 및 상태를 업데이트하지 못하는 현상 발생​​4. 조치 내용- pnp_server_manager.conf 에 서버 연결 대기시간 옵션 추가 후 pnp_server_manager 모듈 재시작 ################################################## # ADD SERVER CONNECTION WAIT TIME # default: 0 (Min: 0, Max: 10, Unit: 0.1s / 100 ms ################################################## CONN_WAIT_TIME=2 - CONN_WAIT_TIME 옵션은 전체 서버를 대상으로 대기시간을 off 된 서버들이 많으면 servermanager가 1회 순회하는데 시간이 많이 걸릴 수 있어서 적당한 시간으로 설정이 필요함​ Server Agent 관리 설정 관리 대상 서버 모니터링 ​​이슈 추적을 위해 도움을 주신 이상민 팀장님, 신호철 과장님 감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5822
5722,[DBSAFER OS] 이슈 발생 시 수집 파일 정보,"1. 기본적으로 모듈 이슈 발생되면 수집 해야하는 정보​[Windows]1) C:\Program Files\PNP SECURE\NODESAFER\Log2) C:\ProgramData\PFC3) C:\ProgramData\NODESAFER​[Linux/Unix]1) $NODESAFER_HOME/addon/pfc$NODESAFER_HOME = nodesafer 설치위치​​2. 운영체제별 추가 수집 정보​[Windows]​1) 이벤트 뷰어 > Windows로그 탭 > 응용프로그램2) 이벤트 뷰어 > Windows로그 탭 > 시스템​이벤트뷰어의 로그는 이슈 발생시점 전후로 수집하는 것이 가장 좋음.하지만 분류하기 어렵기 때문에 모든 이벤트 저장으로 수집하는데, 전달 시에 이슈 발생시점 시각을 반드시 고지필요​[Linux/Unix]​1) /var/log/messages(또는 syslog)2) dmesg 로그는 모듈 기동 시점에 이슈가 있을 경우 수집​​3. 크리티컬 이슈 시(BSOD, Kernel Panic등)​※ 아래 수집 정보는 운영체제에서 설정이 되어 있어야 남겨지는 파일입니다.​[Windows 7 형 서버 이하일 때]내 컴퓨터 우클릭 > 속성 > 시스템 속성 창에서 고급탭 > 시작 및 복구 란의 설정 클릭덤프파일 위치 확인 ​[Windows 10 이상 서버일 때]내 컴퓨터 우클릭 > 속성 > 출력되는 환경설정창에 화면 오른쪽의 ""관련 설정"" 부분의 고급 시스템 설정이후 Windows 7 과 동일​[Windows 공통 확인 방법]제어판 > 모든 제어판 항목 > 시스템 > 고급 시스템 설정 > 시스템 속성 > 이후 동일 Windows 덤프파일 위치 확인 방법 대부분 %SystemRoot%\MEMORY.DMP 으로 설정 되어있으며 MEMORY.DMP 파일 수집.MEMORY.DMP 파일은 서버 스펙에 따라 사이즈가 다르나 상당히 클 수 있음.고객사 내부에서 반출이 오래 걸리면 Minidump 파일을 우선 반출해서 연구소로 전달.기본 위치는 %SystemRoot%\Minidump ​[Linux]기본 위치 : /var/crash ​[Unix]AIX : /var/adm/rasHP-UX : /var/adm/crashSolaris : /var/crash/""hostname""",댓글 없음,https://cafe.naver.com/pnpsecure2/5722
5658,[TIP][DBSAFER OS] pfc 커널 모듈이 로드되지 않는 경우 (Secure Boot 설정 'enabled' 상태),"[요약]고객사 신세계 담당자분께서 DBSAFER OS 설치 과정 중 pfc 커널모듈 로드 실패 발생으로 기술지원을 했습니다.지원 과정에서 Linux 계열 서버 대상으로 'Secure Boot' 옵션이 'enabled' 상태로 PFC 커널모듈 로드가 불가능한것을 확인했습니다. 결과적으로 'Secure Boot' 가 'enabled' 되어 있는 환경이라면 커널 모듈이 로드되지 못하는 상태가됩니다.​​[증상]- DBSAFER OS 설치 후 ./start.sh 실행 시 nodesafer 관련 프로세스 실행은 정상이나 pfc 커널모듈 로드 실패- 해당 시점에 SA(dbsafer_policy_manager),DBSAFER OS pfc 'eventlog'에서 'Device open failure' 에러 출력 ServerAgent(dbsafer_policy_manager) 로그 eventlog(PFC) 로그 ​- 커널 모듈 로드 시점에 messages, dmesg 로그 확인결과, 'kernel lockdown' 관련 로그 확인 messages 로그​ dmesg 로그 ​[원인]- 해당 원인은 서버내 Secure Boot 옵션이 'enabled' 상태로 커널 모듈 로드가 불가능했습니다. SecureBoot 상태 확인 명령어, 결과 - 해결 방법은 다음과 같습니다. - Secure Boot Disable : 임시 해결 방안 - Module Signing : 근본적인 해결 방안​즉, Secure Boot 상태 변경은 고객사와 협의하여 결정이 되어야 합니다. (서버 리부팅 필요)​* 추가 설명. Secure Boot 옵션이 'enabled' 상태는 DBSAFER OS 뿐만 아니라 DataCrypto도 비정상 동작이 될 경우 원인이 될 수 있습니다.. DBSAFER OS의 커널 모듈 경우, Signing 되어 있지 않습니다.​​* Secure Boot 동작 설정 확인 방법- 다음글에 Secure Boot 옵션 상태와 주의사항에 대해 상세 설명되어 있습니다.​https://cafe.naver.com/pnpsecure2/4221 cafe.naver.com cafe.naver.com https://sites.google.com/pnpsecure.com/engineer-manual/%ED%8A%B8%EB%9F%AC%EB%B8%94%EC%8A%88%ED%8C%85-faq/datacrypto#h.kmli5cb4gi0z Sign in - Google Accounts Sign in Use your Google Account Email or phone Forgot email? Not your computer? Use a private browsing window to sign in. Learn more Next Create account Help Privacy Terms sites.google.com ​[조치]고객사 담당자와 Secure Boot 'disable' 처리 협의, 이후 DBSAFER OS 커널 모듈 로드 성공",SecureBoot enable은 CentOS/RHEL 7버전 보단 8 버전에서 빈번히 설정 됩니다.그래서 사전에 8 버전 이상에 설치 해야한다면 사전에 필히 확인이 필요합니다.,https://cafe.naver.com/pnpsecure2/5658
5655,Windows Server Agent 설치 후 환경설정 불가 현상,"[이슈]- Windows server agent 설치 후 환경설정 버튼 클릭 시 에러 메세지 발생​[상세정보] - 특이사항 : DBSAFER 7.0 분리구성(LOG+GW1+GW2)- 전후상황 : 사이트에서 별도로 수정된 사항은 없음- 모듈/프로그램 버전 :ServerAgent_W_Setup[5.1.6.23].exe​[에러로그]- legacy type - compatible type​ - NODESAFER\Log\Manager 로그 ​[답변]와이어샤크에서 동일하게 NIC 가 나오지 않는지 확인이 필요할 것 같습니다.와이어샤크에서도 winpcap 에서 지원 가능한 NIC 목록만 나오는데 SA도 동일하게 처리를 하고 있습니다.만약 와이어 샤크에서도 NIC 나오지 않는다면 SA 에서도 동일하게 처리가 불가능합니다. 다른 방법으로 NIC 정보를 알아낸다고 해도 winpcap 에서 스니핑이 불가능하여 통제가 되지 않습니다.위와 같은 상황일 경우 윈도우 재부팅 후 확인이 필요합니다.​- 사내 확인 사항 티밍 설정 후 와이어샤크에서 티밍인터페이스 인식 불가 티밍 설정 후 재부팅 하지않은 서버의 인터페이스와 같이 일부 인터페이스 인식이 불가능한 경우가 있는데 SA 제약사항으로 보시면 될 것 같습니다.답변드린 상황이면 재부팅 협의 후 확인을 부탁드립니다.​해당 이슈에 대한 근본적인 해결을 위해서는 자체 개발한 드라이버를 사용한 SA를 설치해야하는데, 해당 SA는 2023년 하반기 정도에 릴리즈 될 예정입니다.​​[조치]고객사에 와이어샤크 설치 가능여부 확인 및 재부팅 협의 예정 (12.08)",댓글 없음,https://cafe.naver.com/pnpsecure2/5655
5651,Server Agent 설치 후 다른 소스ip가 바인딩되어 터미널 로그 미로깅되는 현상,"[이슈]- 윈도우 대상서버에 LOG서버와 통신 가능한 IP가 여러개 존재하는 경우, 서비스 및 SA 환경설정에 NIC등록한 관리대상 IP와는 다른 IP가 바인딩되어 터미널 로그가 남지 않음​[고객사 환경]- DBSAFER 7.0 분리구성(LOG+GW1+GW2) ServerAgent_W_Setup[5.1.6.16].exe pnp_server_manager_v5.1.6.36 pnp_telnet Rev 2220 B3410 pnp_telnet_gateway 2220 B3410 wta_server_manager R55 wta_proxy_server R44 wta_player 1.0.2.1​ - 관리대상 서버 모니터링 : 정상 - rdp_server.lst : 정상 - SA 재설치, 서비스 재기동, pnp_server_manager 재기동, compatible 모드 동일 - 일반접속 시 Server Agent 로그 : 정상 - 일반접속 / 우회접속 서비스 TERMINAL 로그 안남음​[에러로그]-nodesaferwa 로그 [문의사항]-대상서버가 여러개의 ip를 가지지만 매니저 등록 및 관리하는 서비스는 대표ip 1개인 환경에서,Server Agent 환경설정에서 등록한 대표IP, NIC가 아닌 다른 IP로 Source IP가 바인딩되어 wta_server_manager 에서 서비스 매칭을 할 수 없는 상황에 대해 확인 요청- ip가 바인딩되는 조건이 있는지 문의 (windows SA를 설치한 여러 IP를 가지는 대상서버 중 특정 서버들에서만 해당현상 발생)- 참고 벅스 : https://bugs.pnpsecure.com/view.php?id=20317​​[답변]- 두번째 IP 로 바인딩 되는 조건은 서버마다 다를 수 있으며 서버에 따라 어떤 인터페이스를 통해 wta_server_manager에 질의하는지 다르기 때문에 명확한 조건은 없음- 제약사항이 포함된 임시 조치 방법 : 대상서버의 ip를(DBSAFER LOG서버와 통신 가능한 IP) 모두 서비스로 등록 후 해당 IP들의 Shared_nic 설정. 로깅 시, 실제 접속한 서버 IP 주소와 서비스 객체가 불일치할 수 있음​>> 임시 조치방법에 대한 고객사 미수용으로 벅스 등록- 사유 : 서버 등록 시 기존 HITAM에서 사용해왔던 IP 뿐만 아니라 대상서버에 접속하여 모든 IP를 찾은 후 등록, 그룹핑해야 함에 불편,PC AGENT nat 리스트 및 로그에 동일서버에 대한 IP가 여러개 표시되는 것에 대한 혼란​​[개선버전]SA for Windows v5.1.6.23 - C/S 매니저에서 터미널 (RDP) 서비스는 대상 서버 대표 IP 하나만 등록 - shared NIC 설정이 있으면 대표 IP 기준으로 로깅 (기존 설정 유지) - SA (nodesafermgr) 대표 IP 기준으로 설정하거나 ANY 로 설정 (기존 설정 유지)- 로그는 SA 대표 IP 기준 서비스로 기록되고 대상서버 IP는 사용자가 접속에 사용된 실제 IP가 기록됨- 벅스 : https://bugs.pnpsecure.com/view.php?id=23642​",댓글 없음,https://cafe.naver.com/pnpsecure2/5651
5649,"[TIP] Server Agent 정책 및 로깅 비정상 동작 현상, Win10pcap 설정 히든 메뉴 활성화 방법 공유","[이슈]- 윈도우 서버에 server agent를 설치 중, [server agnet > 터미널 세션 로그]가 남지 않는 현상, 정책도 적용받지 않으며, 허용/차단 동작 모두 동일하게 로깅이 되지 않는 현상 확인- 서비스로그는 모두 정상 (서비스로그의 우회로그도 정상적으로 로깅 됨)- 고객사 : 롯데컬처웍스​[확인사항]- 정책배포는 정상적으로 된것을 확인. access_IP.rule에서 확인- 문제서버의 nodesafer 설정파일 차이 없음- 리눅스(centos6.7)에 설치 후 테스트 시 정상적으로 접근제어 및 로깅 확인- 같은 Teaming 환경, 같은 OS 버전에서 테스트 하여도 서버마다 동작이 상이함- server agent v5.1.6.22 / v5.1.6.20 / v5.1.6.7 버전에서 위와같이 정상동작하지 않는 것을 확인​- server agent v5.0.6.0 버전 설치 시 정책 정상 적용 및 [server agnet > 터미널 세션로그] 까지 정상적으로 로깅- server agent v5.1.2.61 WIN10pcap 설치 시 정책 정상 적용 및 [server agnet > 터미널 세션로그] 까지 정상적으로 로깅 server agent v5.1.2.61 WIN10pcap 설치본 : https://bbs.pnpsecure.com/showthread.php?tid=11033&highlight=Win10pcap​[고객사 버전정보]- server manager 버전 : v5.1.6.31 Build (80)- 테스트한 server agent 버전 : v5.0.6.0 / v5.1.2.61 win10pcap / v5.1.6.7 / v5.1.6.20 / v5.1.6.22- OS : RDP - Windows Server 2012 / 2012 R2 / 2016 SSH - Centos 6.7​[활성화 방법] - Win10pcap 호환 방식 변경 1. C:\Program Files\PNP SECURE\NODESAFER\nodesafermgr.exe 실행2. Ctrl + Shift + F8 히든 메뉴 실행3. LogSrv IP 에 DBSAFER LOG SERVER IP(192.168.2.175) 입력4. Winpcap API Type 을 legacy type 에서 compatible type으로 변경5. SA for windows Manager 창에서 서비스 재시작​[기능 설명]- SA 5.1.6.x 릴리즈 버전 부터는 win10pcap 라이브러리 사용 버전의 패키지를 따로 빌드하지 않고, sa 설정 변경을 통해 사용- winpcap 4.1.3 버전이 설치되고 라이브러리 사용 방식만 변경되는 방식​Q : lagcy type 설정과 compatible type 설정의 차이A : SA for Windows 5.1.6.x 버전에서 제공하는 ""lagcy type"" 설정(5.1.2.x SA for Windows 일반 버전) -> winpcap packet.dll 파일에서 제공하는 API 사용 SA for Windows 5.1.6.x 버전에서 제공하는 ""compatible type"" 설정(5.1.2.x SA for Windows win10pcap 호환버전) -> winpcap wpcap.dll 파일에서 제공하는 API 사용​Q : API 차이A : winpcap packet.dll 은 promiscuous_mode=ON 옵션을 활성화 해야 PROMISCUOUS 모드로 동작 winpcap wpcap.dll 은 HW 필터가 기본 PROMISCUOUS 모드로 동작​Q : compatible type 사용 시 제약사항A : 기본 PROMISCUOUS 모드를 사용하기 때문에 일부 수집하지 못하던 패킷까지 수집할 수 있으나 처리 속도는 다소 느려질 수 있음​Q : 일부 OS에 대해 compatible type 으로 설정하지 않을 시 정상동작하지 않는 사유A : 현재 분석결과로 명확한 사유 특정 불가, winpcap 사용할 때 통제해야할 패킷들을 스니핑하지 못하여 PROMISCUOUS 모드 활성화 필요​​[win10pcap 관련 카페글][심텍][아토테크놀로지]윈도우 2012 우회접속 제어 및 로깅 실패 현상 / 김가희 과장- https://cafe.naver.com/pnpsecure2/4376 cafe.naver.com cafe.naver.com [LS글로벌](주)LS win2012R2(teaming 구성)가 설치된 HP서버에서 SA에서 감사로그 미로깅 현상 / 강현구 차장- https://cafe.naver.com/pnpsecure2/4174 cafe.naver.com cafe.naver.com ​이슈 해결에 도움을 주신 신호철 과장님께 감사드립니다.​이상입니다. 감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5649
5646,[TIP][SA] HOST OS(Solaris10) 위에 가상화 OS(Solaris9)가 설치된 구성에서 Server Agent 구동 불가 시 조치 사항 공유,"[요약]- 고객사 환경 : 물리 서버에 HOST OS(Solaris10)가 설치되어 있고, 가상화 OS(Solaris9)을 올려서 가상화 서버에 DB를 설치하여 사용하는 환경- 기존 SA 설치하는 것과 동일하게 실제 DB가 존재하는 가상화 OS(Solaris9)에 SA 설치 진행 및 구동 : SA가 수 초 안에 꺼졌다 켜졌다 반복 (꺼지면서 No DPLI device found, NIC=igb0 에러 출력)​- 조치내역 : HOST OS(Solaris10)에 SA 설치, shared_nic에 'Solaris 10 IP + Solaris 9 IP' 입력하여 가상화 OS 서버에도 SA 정책 배포 및 적용 되도록 조치 > 이후 SA 정상 기동 및 정책 배포 확인 후 종료​[버전정보]- pnp_server_manager : 5.1.2.15- SA for Linux : pkg_server_agent_V5.1.2.30_20210222_SA_for_Unix_221011.tgz​[상세내역]- 물리 서버에 가상화 서버를 올려 가상화 서버에 DB를 설치한 환경- HOST OS(Solaris10) 네트워크 환경, 가상화 OS(Solaris9) 네트워크 환경(사진참고) HOST OS(Solaris10) ifconfig -a 화면 (좌측 사진) 가상화 OS(Solaris9) ifconfig -a (우측 사진) - SA를 가상화 OS(Solaris9)에 설치 후 INTERFACE에 ifconfig -a 했을 때 나오는 가상 인터페이스인 igb0:1를 넣고 SA 시작 시 비정상 동작(좌측 사진 참고)- ifconfig -a 했을 때 나오지는 않지만 물리 OS서버의 네트워크를 통해 오는 환경으로 생각하고 igb0을 넣었을 때 또한 비정상 동작(우측 사진 참고) conf/server_agent.conf 내 INTERFACE=igb0:1 설정 후 SA 기동 시 dbsafer_agent 로그 (좌측 사진)conf/server_agent.conf 내 INTERFACE=igb0 설정 후 SA 기동 시 dbsafer_agent 로그 (우측 사진) ​- 가상화 OS(Solaris9)에서 SA 설치가 정상적으로 되는 환경인지 확인을 위해 아래의 내역 확인 > snoop 명령어 실행 시 No network interface devices found 출력 > tcpdump 설치되어 있지 않음 > /dev 하위에 igb0 인터페이스 없음 (잡혀있는 인터페이스가 없음) : 인터페이스가 잡혀 있으면 아래 잡혀있는 인터페이스명이 보여야 정상 > dladm show-dev, dladm show-link 명령어 결과값 없음(실패 메시지)​- 가상화 OS(Solaris9)에서는 네트워크 인터페이스가 잡혀있지 않아 SERVER AGENT 에서 대상서버 NIC 스니핑 동작이 불가한 상황 ​[조치내역]- 고객사에 확인하여 HOST OS(Solaris10)에 SA 설치 가능 여부 확인하여 HOST OS에 SA 설치 진행- DBSAFER 매니저 > Server Agent 관리 설정 > HOST IP 관리 설정 > 추가 > 'Solaris 10 IP + Solaris 9 IP' 등록하여 설정 후 SA 재기동 후 정상 동작 확인 (DBSAFER 서버에서 /dbsafer/.conf/pnp_server_manager.shared_nic 설정에 'Solaris 10 IP + Solaris 9 IP'를 등록하는 것과 같은 설정)​ ​[결론]- HOST OS + 가상화 OS(DB설치) 로 구성되어 있을경우 해당 Host OS에 Server Agent 설치 후 shared_nic 설정이 필요​문제 해결에 도움주신 문금주 차장님, 신호철 과장님, 서영진 대리님 감사합니다 ! !",댓글 없음,https://cafe.naver.com/pnpsecure2/5646
5597,[TIP][DBSAFER OS] pfc 커널 모듈이 로드되지 않는 경우 (Crash 파일 경로 체크 방식),"[요약]고객사 신세계 담당자분께서 DBSAFER OS 설치 과정 중 pfc 커널모듈 로드 실패 발생으로 기술지원을 했습니다.지원 과정에서 DBSAFER OS의 Linux 계열 서버 대상으로 Crash 파일 경로 체크 방식에 의해 pfc 커널 모듈이 로드 실패하는 Case가 있었으며 증상, 원인, 개선내역에 대해 공유드립니다. ​​[증상]- OracleLinux 7.9 환경에 DBSAFER OS 설치 후 ./start.sh 실행 시 nodesafer 관련 프로세스 실행은 정상이나 pfc 커널모듈 로드 실패- [SA설치경로]/addon/pfc/eventlog 확인결과, 비정상적인 재부팅 이력 관련 로깅 기록이 있으나 서버에서 재부팅 이력과 crash 파일 생성은 없었음 eventlog 로그 - DBSAFER OS 서비스 가동(./start.sh) 실행할때 마다 pfc 커널모듈 로드 실패와 evntlog에서 비정상적인 재부팅 이력 관련 로그 발생​[원인]- DBSAFER OS의 최초 설치 또는 설치 후 운영과정에서 서버의 '비정상 재부팅 감지 기능'을 위해 pfc 커널모듈에서 Crash 파일의 생성여부를 체크하고 있습니다.- 보통 Linux계열 서버 내 Crash 파일 생성은 '/var/crash' 경로에 생성되도록 설정되어 있습니다.> Crash 파일은 /etc/kdump.conf의 'path'에 설정된 경로 기준으로 Crash 파일이 생성됩니다. (kdump 서비스가 활성화 된 경우에 해당됨) /etc/kdump.conf 의'path' 설정 - 해당 서버의 Crash 파일 생성 경로는 서버 담당자의 수정 작업으로 /etc/kdump.conf 'path'에 / 경로로 지정되어 있었으며 DBSAFER OS는 Crash 경로의 모든 디렉토리의 '생성 시간'만 체크하는 로직이었습니다. 결과적으로 / 경로의 모든 디렉토리의 '생성 시간'을 체크하면서 커널 모듈의 로드가 실패했습니다. (비정상 재부팅으로 오탐) 문제 서버의 /etc/kdump.conf의 'path' 설정 값 ​DBSAFER OS 설치 시점인 14:00 경에도 다음과 같은 디렉토리에서 시간 업데이트가 있었습니다. / 경로에서 지속적으로 생성 시간이 업데이트되는 디렉토리 ​​[조치 & 개선내역]- 개선된 DBSAFER OS 패키지 설치 후 pfc 커널모듈 로드 성공(정상동작)- Crash 파일을 특정해서 체크할 수 있도록 비정상 재부팅에 대한 감지 기능이 개선됐습니다. > 현재상태 : Crash 경로의 모든 디렉토리 생성 시간만 체크 > 개선내역 : Crash 경로에서 Crash 파일/디렉토리를 확인해서 시간 체크 즉, /etc/kdump.conf에 설정된 Crash 경로을 체크하고 해당 경로에서 Crash 파일 대상으로 시간 기준으로 비정상 재부팅 여부를 판별함 Crash 디렉토리 예시) 127.0.0.1-2021-10-15-10:10:10 에서 IP를 제외한 시간을 기준으로 판별 ​- 벅스 : https://bugs.pnpsecure.com/view.php?id=20962* 개선버전은 DBSAFER OS(PFC) 1.0.1.89 버전 이상 리눅스 버전에 포함되어 있습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5597
5472,"[TIP]Server Agent 관리설정에서 ""DBMS(ID/APP) 통제로깅"" 기능을 활성화 하였으나, 실제로 ID/APP을 파싱하지 못하는 경우 세션 차단이 안되는 현상","[요약]- Server Agent for Windows (v5.1.2.3), (v5.1.2.60) 버전에서 ""DBMS(ID/APP) 통제로깅 기능"" 활성화 이후 패킷에서 ID/APP을 파싱하지 못하면, 실제 차단 로그가 기록되더라도 세션이 차단되지 않고 허용하는 현상이 발생- 해당 이슈는 (v5.1.6.16) 버전에서 버그로 확인되었으며, v5.1.6.16 버전 이후에서는 정상 동작 하는 것으로 확인- 고객사에서 옵션이 ""DBMS ID/APP 통제 로깅 기능""이 활성화 되어 있었으나, 실제로 패킷에는 (ID/APP) 관련 데이터가 미존재- ""Server Agent 정책"" 설정 시, 사용자 접속계정/어플리케이션 객체 활성화도 되어 있지 않은 상황이었음 → ""DBMS ID/APP 통제 로깅 기능"" 비활성화 후 정상 동작 확인 (하단 [그림 1]참고)​​[ 참고 ]- DBMS ID/APP 활성화 옵션 ① 매니저' > 'Server Agent 관리 설정' > '환경설정' > 'PARSER_LEVEL=2' 확인 or② 매니저' > 'Ctrl + Shift + F8' > '서버에이전트설정' > 'SA DBMS 정책 접속계정/어플리케이션 사용:'​ (좌) Server Agent 관리 설정 / (우) 시스템설정- 서버에이전트 설정 ​​[버전정보]- SA모듈 : pnp_server_manager : v5.1.2.15- 대상서버 : Windows server 2016- SA for Windows : v5.1.2.3, v5.1.2.60 + (win10pcap) 버전​​[상세내역]- 매니저 에서는 차단 로그로 기록되지만, 실제 동작은 대상 DB에 접속이 허용되는 현상 확인​- Wireshark 로 패킷 확인 결과, 세션이 맺어지는 것 확인 (cmd > netstat -ano | findstr X.X.X.117 에서도 세션 EASTABLISHED 확인 가능) > 사진 내 IP정보 : X.X.X.122:1433(대상 DB) / X.X.X.117(사용자 PC) (좌) 매니저 차단 감사로그 / (우) Wireshark 패킷 확인 결과 (비정상동작) ​​- Server Agent 관리 설정 확인 결과 'DBMS(IP/APP) 통제 로깅 ON 설정' 되어 있으나, 매니저에서는 해당 옵션이 비활성화 되어 있는 것 확인 ​​- 대상 DB 접속하여 아래 경로의 로그 확인 결과 ID/APP 파싱이 불가하다는 로그 확인 가능 > 경로 : C:\ProgramData\NODESAFER\Log\Service\202208\20220811.log ​- 담당자에게 확인한 결과, 담당자는 해당 옵션 활성화된 것을 모르는 상황이었음 > ID/APP 파싱 옵션 비활성화 및 정상 차단되는 것 확인 후 정상 처리 ​​[조치 예정]- 안정화 버전으로 pnp_server_manager, SA for Windows 버전 업그레이드 작업 진행 예정​​​* 수정이 필요한 부분이나 개선사항이 있다면 댓글로 남겨주시면 감사하겠습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5472
5430,[TIP] MSSQL 우회접속 시 Server Agent를 통한 접속계정/어플리케이션 통제 기능,"사용자가 MSSQL 우회접속 시 Server Agent를 통해 출발지 IP 뿐만 아니라 DB 접속 계정 및 어플리케이션을 통해 통제 할 수 있는 기능 설정방법 공유드립니다.​[요약]시스템 설정 -> 서버에이전트 설정 -> SA DBMS 정책 접속계정/어플리케이션 사용 체크MSSQL 접속 계정관리(mssql_account_finder) 사용 설정 및 계정 등록Server Agent 관리 설정 -> DBMS(ID/APP) 통제 로깅 ON (PARSER_LEVEL=2)Server Agent 정책 생성 시 접속 계정/어플리케이션 항목 설정 필수Server Manager 5.1.6.34 이상으로 패치 필요Server Agent 5.1.6.10 이상 - (https://bugs.pnpsecure.com/view.php?id=22897) 관련하여 SA V 5.1.6.15 패키지 포함 예정​[상세]시스템 설정 -> 서버에이전트 설정 -> SA DBMS 정책 접속계정/어플리케이션 사용 체크MSSQL 접속 계정관리 사용 설정 ​Server Agent 관리 설정 -> DBMS(ID/APP) 통제 로깅 ON (PARSER_LEVEL=2) - 메니저 or Server Agent 설정 Server Agent 정책 생성- (참고) 어플리케이션 통제 기능 활성화 후 모니터링 통해 Server Agent가 파싱하는 어플리케이션명을 복사하여 사용했습니다. ​대상 서버에서 정상 동작 중 인지 확인- alias.conf / nodsafer service log- alias.conf 파일 확인 시 아래와 같이 입력된다면 Server Manager 패치 필요 (5.1.6.34 이상)MSSQL_ACC_ID_192=1433MSSQL_ACC_PW_192=A9E95C263621AFB32B7FC08EB8A36E21 . 관련 벅스 : https://bugs.pnpsecure.com/view.php?id=22108 ​접속 및 차단 확인Server Agent 로그 -> DBMS 로그 조회를 통해 확인 가능 ​​[기능 동작 방식]​1. Trust Connection 으로 MSSQL 에 접속하여 정보를 수집2. 설정한 MSSQL ID/PW 로 MSSQL 에 접속하여 정보를 수집 3. 패킷을 파싱 (암호화 되어있으면 동작 불가능) -> (SSL_Proxy를 사용해야 하는 환경에서 동작 불가) 예) 1번에서 ID/APP 정보를 수집하면 2, 3번은 시도하지 않습니다.​",2023-02-03에 확인된 내용 추가 합니다. (테스트 버전 5.1.6.28 (WIN))SA의 MSSQL 계정 및 어플리케이션 파싱을 수행하려면 아래와 같이 DBMS Server Agent 정책 설정시접속계정과 어플리케이션을 임의의 객체로 등록 및 정책을 1회라도 배포된 후부터 SA 가 MSSQL 서버에 계정 접속하여 접속계정 및 어플리케이션 파싱을 시작하는 것으로 확인되었습니다.정책을 한 번 배포하고나서 아래와 같이 설정한 임의의 정책을 미사용으로 전환시 서버에서 SA 서비스를 재시작 전까지는 접속계정 및 어플리케이션 로깅을 진행합니다.해당 내용은 접속계정 파싱을 진행하지 않는 서버들에 대해서도 정책이 모두 배포되는 것을 막기 위해(SA의 부하 발생을 줄이기 위해) 설정한 히든 기능으로 확인되었습니다.,https://cafe.naver.com/pnpsecure2/5430
5380,"[TIP][DBSAFER OS] pfc_log, pfc_cert 프로세스의 D(Uninterruptible sleep) 상태에 따른 서비스 영향도","[요약]신세계 그룹사 Linux 서버에 설치된 DBSAFER OS의 pfc_log, pfc_cert 프로세스 상태에 대한 서비스 영향도를 확인 요청받았습니다.문의 받은 pfc_log, pfc_cert 프로세스의 D(Uninterruptible sleep) 상태 경우, call stack 이 'msleep' 상태로 서비스에 영향도가 없습니다.​​[문의사항]* 서버 담당자 메일 문의 내역시스템에 대한 전반적인 성능 점검을 진행하고 있는데요. 점검 중에 특이사항이 있어 문의드립니다.현재 해당 서버는 아직은 서비스 투입이 되지 않았고, CPU, Memory, Disk IO, Network 등에 대한 사용량도 없는 상태입니다.그런데 아래 그림의 load average를 보시면 항상 2.0이 넘고 있습니다. 해당 원인을 파악하던 중에 아래의 두개의 프로세스가 “Uninterruptible Sleep (D)” 상태로 있기 때문인 것으로 보입니다. root 200914 0.0 0.0 0 0 ? D May03 1:53 [pfc_log]root 200915 0.0 0.0 0 0 ? D May03 9:02 [pfc_cert] 웹서버의 CPU가 2 core 이고 또한 OS 입장에서 load average에 대한 권장은 core 보다 낮은 load average인데요.이로 인해 실서비스 전환시에 혹시나 문제가 발생할까봐 우려되어 확인차 문의드립니다.​​[답변]* 연구소 이지은 과장님에게 도움받아 답변했습니다.pfc_log, pfc_cert 프로세스는 DBSAFER OS 커널에서 생성하는 스레드입니다.​- pfc_log : 로그 기록 역할- pfc_cert : 보안계정 정보 획득 역할​# ps -ef | grep pfc로 확인하시면 부모 프로세스의 PID가 2 인 것을 확인하실 수 있습니다.아래 그림처럼 해당 프로세스들의 call stack 상태는 msleep 상태입니다.아무 동작이 없는 상태일 때는 msleep으로 대기하고 있습니다. msleep을 사용하는 이유는 CPU 소모가 없는 커널 API이며 인터럽트를 허용하지 않습니다.따라서 두 프로세스는 거의 D(Uninterruptible sleep) 상태를 유지하도록 표현이 됩니다.​* 일반 프로세스의 경우 D 상태가 되면 스케쥴링에 영향을 줄 수 있으나 위의 프로세스들은 커널에서 DBSAFER OS가 요청한 동작만을 수행하고 msleep으로 대기하기때문에 서버 서비스에 영향을 주지 않습니다. ​​[참고사항]1. 리눅스 프로세스 상태코드 확인 STAT : STAT 코드는 세 개의 필드로 구성되어 프로세스 상태를 보여줍니다.​첫 번째 필드는 D,R,S,T,X,Z 코드가 위치하며 의미는 다음과 같습니다. 코드분류 의미 D IO 와 같이 중지(interrupt)시킬 수 없는 잠자고 있는(휴지) 프로세스 상태 R 현재 동작중이거나 동작할 수 있는 상태 S 잠자고 있지만 중지시킬 수 있는 상태 T 작업 제어 시그널로 정지되었거나 추적중에 있는 프로세스 상태 X 완전히 죽어 있는 프로세스 Z 죽어 있는 좀비 프로세스 두번째, 세번째 필드 코드 코드분류 의미 < 프로세스의 우선 순위가 높은 상태 N 프로세스의 우선 순위가 낮은 상태 L 실시간이나 기존 IO를 위해 메모리 안에 잠겨진 페이지를 가진 상태 s 세션 리더(주도 프로세스) l 멀티 쓰레드 + 포어그라운드 상태로 동작하는 프로세스 ​2. msleep API (CPU 소모가 없는 API)​https://injunech.tistory.com/122 [Kernel] Sleep Time Delay (시간지연) Table of Content 1. Intro 2. 쉬운 API 3. 어려운 API 4. 어려운 API 와 쉬운 API? 5. CPU 소모성 API 6. CPU 소모가 없는 API 7. msleep() 8. msleep_interruptible() 9. ssleep() 10. schedule_timeout_inter.. injunech.tistory.com ​답변에 도움주신 연구소 이지은 과장님 감사합니다.",잘 정리해주셔서 감사합니다.,https://cafe.naver.com/pnpsecure2/5380
5211,[Q&A] 대상 서버에서 DBSAFER OS를 삭제했습니다. 커널 모듈은 왜 계속 로드된 상태인가요?,"[문의사항]대상 서버(Linux/Unix)에서 DBSAFER OS를 삭제했습니다. 왜 커널 모듈(pfc_hook, pfc_manager)은 계속 로드 상태인가요? ​[답변]Linux/Unix DBSAFER OS 완전한 삭제를 위해서는 서버 재부팅이 필요합니다.즉, DBSAFER OS 삭제 후 서버 재부팅을 하지 않은 경우에는 PFC 커널 모듈은 Byass 상태입니다.* 커널 모듈 Bypass 상태 : ServerAgent를 정지 또는 매니저에서 DBSAFER OS 사용 옵션을 제거한 경우로 DBSAFER OS가 동작하지 않음​[기타]Windows DBSAFER OS 경우 SA 서비스 정지 후 '프로그램 및 기능'에서 삭제 시, 커널 모듈은 완전히 제거됩니다.* 별도의 재부팅은 필요 없습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/5211
5113,[TIP][DBSAFER OS] 영문(영어) 가이드 자료,참고사항 : 영어 사용 고객사에서 DBSAFER OS 영문 교육이 필요할 경우 별도로 가공하여 대응하면 좋을 것 같습니다. (bypass policy에 대한 설명은 따로 없기 때문에 필요시 추가해주세요.)​자료 링크 : https://docs.google.com/presentation/d/1WDWifr7KD32K6wJyF7pCedyX3Yx-2BJv/edit?usp=sharing&ouid=107710519660863662864&rtpof=true&sd=true,댓글 없음,https://cafe.naver.com/pnpsecure2/5113
5101,[공유] Server Agent 프로세스 복구 및 알림 설정,"안녕하세요, 프로젝트1팀 송민화입니다.최근 고객사에서 Server Agent 프로세스 Kill 방지, 모니터링 방안을 요청하여 처리한 내용 공유드립니다.​*첨부 매뉴얼에 자세한 과정이 나와있습니다.*복구 기능의 경우 오래된 문서이므로, 기능 적용 전 QA 문의 후 적용 권장드립니다.​ 첨부파일 Server Agent 경고 설정 매뉴얼_20200820.pptx 파일 다운로드 내 컴퓨터 저장 네이버 MYBOX에 저장 첨부파일 Server_Agent_프로세스복구및알림_201509.pptx 파일 다운로드 내 컴퓨터 저장 네이버 MYBOX에 저장 ​[적용 환경]적용 Server Agent 버전 : server_agent_RedHatServer7_64bit_V5.1.2.3_20191216대상서버 : Rhel 7.7​​[적용 내용]​1. 복구기능# .conf/pnp_server_manager.confUSE_AGENT_STATUS_ALERT=ON​# 매니저 - SA관리설정USE_PROCESS_PROTECT=ONUSE_PROTECT_RECOVERY=ON​​2. 알림 기능매니저 팝업 알림으로 설정하였습니다.​1) 매니저 메뉴 활성화# vi pnp_server_manager.confUSE_AGENT_STATUS_ALERT=ON (default=OFF)​2) 서버 관리자 지정 3) 경고 그룹 및 객체 생성 4) Server Agent 경고 설정 ​​[적용 결과]대상서버에서 server agent 관련 프로세스를 강제로 kill 할 경우 매니저 팝업 및 자동 프로세스 복구 확인하였습니다.​​감사합니다.​​",댓글 없음,https://cafe.naver.com/pnpsecure2/5101
4864,[TIP][DBSAFER OS] AIX 6.1 이상 대상서버에서 install.sh 실행 불가 현상,"1. 현상AIX 6.1 이상 대상서버에 DBSAFEROS 패키지 설치 진행 도중 install.sh 파일 실행 시 아래 메시지 출력하며 설치 되지 않음 ​2. 조치 방법AIX 6.1 이상 버전에서 추가된 OS 부가기능 중 kernel storage-protection key 기능이 활성화 되어 있을 경우 DBSAFER OS 커널 모듈의 로드가 불가하여 설치 전 설정 변경 필요(6.1이하 버전은 해당되지 않음)​# skeyctl –v nowStorage Key attributes for current boot session:​Max. number of hardware keys = 8Number of hardware keys enabled = 8Number of user keys = 2Kernel keys state = enabled <-- 설정 확인, enabled로 된 경우 모듈 로드 불가Exclusive kernel key value = disabled​​kernel keys state = enabled 설정인 경우 아래와 같이 사전에 설정 변경 후 서버 재기동을 통한 설정 적용이 필요합니다.​​# skeyctl –k off (Kernel Storage-Protection Key 해제)​# bosboot –ad /dev/ipldevice (부트 이미지 생성)​# skeyctl –v boot (부팅 후 설정될 상태 사전 확인)Storage Key attributes for next boot session:Max. number of hardware keys = defaultNumber of hardware keys enabled = defaultNumber of user keys = defaultKernel keys state = disabledExclusive kernel key value = disabled​위 설정 변경 시 DBSAFEROS 정상 설치가 가능합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/4864
4855,"[SA][TIP] DBSAFER 와 대상 서버가 서로 다른 망(NAT환경) 경우, Linux/Unix 계열 서버의 옵션 설정","1. 요약- SA 또는 DBSAFER OS가 설치되는 Linux/Unix 계열 서버 경우, DBSAFER 서버 망과 다른 외부망에 대상서버가 존재할 수 있습니다.- 이 경우, pnp_shell에서 DBSAFER GW 서버의 NAT IP를 인식하지 못합니다. 결과적으로 우회접속 경우, 접속/명령어 로그가 남지 않습니다.- 이때, 매니저 'Server Agent 관리 설정'-'추가설정'에 다음 옵션을 추가해 조치합니다. NAT_DBSAFER_IP=[DBSAFER GW IP]​​2. 상세 내용 - DBSAFER와 대상 서버가 망이 다른 NAT 환경(외부망)일 경우, Linux/Unix 계열 서버는 정상적으로 우회접속 로깅되지 않습니다.- NAT 환경경우, pnp_shell에서 DBSAFER GW 서버의 NAT IP를 인식하기 위해 다음과 같이 옵션을 지정합니다.​ * pnp_shell - 우회접속시 세션 별로 실행 - 사용자의 세션, 명령어 제어, 로그 기록 역할 (GW서버의 pnp_telnet 과 통신) - SA 설치 시 /sbin/pnp_shell 추가됨​- 매니저 'Server Agent 관리 설정' 해당 서버에 '추가설정'에 'GW NAT IP'를 입력합니다. GW가 1개 이상인 경우, '+' 를 통해 구분합니다. 해당 옵션은 /var/pnp_shell/gw_ip.conf 파일에서 적용 상태를 확인할 수 있습니다. 순서대로 [GW_IP] : [서비스 포트]​ [OPERATUON_LEVEL] [CHECK_CERT_ID] 설정이 적용됩니다. gw_ip.conf ​* 옵션 사용 시 주의 사항- 방화벽 오픈 확인 필요!! 보안 대상 서버 --------------------> GW (NAT IP, DBSAFER 서비스 포트) ""보안 대상 서버에서 GW서버의 NAT IP, DBSAFER 서비스 포트로 통신합니다. 만약에 서비스가 많은 경우, 서비스 포트를 4000번대 이후로 범위를 지정해 포트 오픈이 필요합니다.""​ ** 참고!! Windows 경우, 외부망에서도 기존의 옵션을 통해 WTA 로깅이 가능합니다. 1) NAT_DBSAFER_IP=[DBSAFER GW IP] 2) NAT_LOGSERVER_IP=[DBSAFER LOG IP] https://cafe.naver.com/pnpsecure2/2143 cafe.naver.com cafe.naver.com ​3. 기타 - 지원 버전 : pnp_sever_manager v5.1.2.21 이상 - bugs : https://bugs.pnpsecure.com/view.php?id=18164​​감사합니다.",내용 잘 정리해 주셔서 감사합니다. NAT_LOGSERVER_IP=[DBSAFER LOG IP] 에 대해서 UNIX/LINUX의 경우 설정을 안해줘도 되나요?,https://cafe.naver.com/pnpsecure2/4855
4832,[SA][공유] Server agent 보안계정 이용한 2차인증 기능 관련 수정 내용 공유,"# 이슈 : 불규칙적으로 일반 접속에서 보안계정 2차인증 팝업 발생 # 원인 : WTA 코드 분석 결과 타이머를 사용하여 팝업이 닫히는 방식이라서 타이머 주기보다 빠르게 console close, RDP connection 이 발생하면 팝업이 닫히지 않을 가능성 확인​# 조치 : 5.1.3.44 버전 이상 패치 후 정상 동작 확인 (21.05.18)​# 벅스 번호 : 20190",댓글 없음,https://cafe.naver.com/pnpsecure2/4832
4829,윈도우 SA 의 operation level 기본값 변경 안내,"윈도우 SA 5.1.2.41/5.1.3.41 버전부터 operation level 옵션의 기본값이 1로 변경되었습니다.​아래와 같은 상황에서 운영에 영향이 있을 수 있으니 패치 전 체크 부탁드립니다.- SA 관리 설정에 operation level 설정하지 않고 차단 정책으로 운영 중, 5.1.2.41/5.1.3.41 이상 버전으로 패치하는 경우 > operation level 옵션값이 2 -> 1 로 변경되어 차단이 안되는 현상이 발생할 수 있습니다. > 차단 정책으로 계속 운영하려면 SA 관리 설정에 operation level 옵션을 2로 설정 부탁드립니다.​​** 참고1. operation level 이란 - pnp_shell, nodesaferwa 모듈을 통해 터미널 접속/권한을 통제하는데, operation level 옵션으로 운영 모드를 설정함 > 0 : 통제/로깅 안 함 > 1 : 통제 안 함/로깅 함 (차단 정책이 있을 경우, 로그는 차단으로 남지만 실제 차단은 안 됨) > 2 : 통제/로깅 함2. Linux/Unix SA 도 operation level 기본값은 1 입니다.",정보 공유 감사합니다.,https://cafe.naver.com/pnpsecure2/4829
4788,[SA] [SA for WIN] winpcap 설치 오류 해결 ( watchall agent ),# 이슈 : npf 점유 문제로 winpcap 설치 오류 # 조치 : watchall agent - port control 서비스 정지 후 Server agent 설치 진행 ​,댓글 없음,https://cafe.naver.com/pnpsecure2/4788
4757,[SA][공유] Windows OPERATION LEVEL 미 설정 시,"안녕하세요. 프로젝트팀 3파트 이상민입니다.금일 한미약품에서 있었던 문제 및 대응 내용을 공유하여 드립니다.​[요약] - 윈도우용 SA의 OPERATION LEVEL 기본값은 ""2""임 - nodesafer.conf 및 alias.conf에 OPERATION LEVEL이 정의되지 않을 경우 기본값은 2로 정의됨​[문제 증상] - 서버 to 서버 RDP 접속 차단 - 콘솔 접속 차단 - 작년 10월 SA 설치 후 운용되어 왔으며 고객은 문제를 금일(3/16) 인지하였음 . '20.10 ~ '21.03.06 서버to서버 RDP 접속 및 콘솔 로그인 시도 없었음​[원인] - 윈도우 서버에 SA 설치 후 OPERATION LEVEL 설정하지 않았음 . 기본값은 1로 동작할 것으로 예상하고 따로 체크하지 않았음(엔지니어 fault) - 이로 인해 OPERATION LEVEL 2로 동작​[장애영향도] - 금일(3/16) 서버 to 서버, 콘솔 로그인 불가 외 없음​[해결] - 윈도우 서버 전체 대상 OPERLATION LEVEL 1 설정​감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/4757
4724,[SA] [TIP] telnet보다 traceroute를 통해 조금 더 명확하게 방화벽 포트 오픈을 확인하는 방법,"1. 요약 telnet 명령어만을 사용하여 방화벽 포트 오픈을 확인할 시 어느 구간에서 막히는지, 포트가 확실하게 열려있는지 확인하기 어려운 점이 있습니다.따라서, traceroute 명령어를 사용하게되면 telnet 명령어보다 조금 더 정확하게 현 상황을 파악할 수 있습니다.​2. 상세 내용 ​[테스트 환경]21113 방화벽 오픈 OServer Agent 대상 서버에 설치 X​[telnet / traceroute 비교]- 상단의 '테스트 환경'에서 telnet 명령어를 통해 대상 서버의 '21113' 포트에 대해 확인시 'telnet : connect to address 52.2.163.123: Connection refused' 라고 출력하게 됩니다. - 'telnet : connect to address 52.2.163.123: Connection refused' 출력시 포트 오픈이 미비되었는지, Server Agent가 미설치되어 포트 리스닝 상태가 되지 않아 발생하는지 판단을 하기 어려운 부분이 있습니다. # telnet [대상 서버 IP] [Port] ​- 상단의 '테스트 환경'에서 traceroute 명령어를 통해 대상 서버의 '21113' 포트에 대해 확인시 routing 되는 과정을 추가적으로 확인할 수 있으며, 만약에 중간에 막히게 된다면 해당 구간에서 방화벽이나 다른 장비가 막고있다고 판단하는데 도움을 줍니다. # traceroute -p [Port] [대상 서버 IP] ​추가적으로 traceroute rpm 첨부 드립니다.필요하신 분은 DBSAFER 서버에 설치하여 사용하시면 되십니다.​[설치 명령어]# rpm -ivh traceroute-2.0.xx-2.elx.x86.64.rpm​[CentOS6_64bit] 첨부파일 traceroute-2.0.14-2.el6.x86_64.rpm 파일 다운로드 내 컴퓨터 저장 네이버 MYBOX에 저장 [CentOS7_64bit] 첨부파일 traceroute-2.0.22-2.el7.x86_64.rpm 파일 다운로드 내 컴퓨터 저장 네이버 MYBOX에 저장 ​","nmap 으로 확인하는 방법도 있습니다. 결과화면의 filtered 로 표기가 되었을 경우 방화벽으로 차단된 경우가 해당 됩니다.포트의 listen 상태 및 방화벽의 종류, 차단 형식에 따라서 차이가 있기 때문에 다양한 방법으로 확인하고 원인을 찾는 것이 좋을 것 같습니다. - 명령어 : nmap -sT -p 3306 10.40.128.73참고 URL : https://nmap.org/book/man-port-scanning-basics.html",https://cafe.naver.com/pnpsecure2/4724
4716,[SA] [TIP] Manager '관리 대상 서버 모니터링'에서 SA 원격 패치 실패 경우 (대상 서버 디스크 부족),"1. 요약 ​ 대상 서버에 설치된 Server Agent 또는 DBSAFER OS 관련 모듈 업그레이드가 필요한 경우, 매니저-관리대상서버 모니터링 탭에서 'Agent 업그레이드' 기능을 사용합니다. 이때, 대상서버에 디스크가 부족한 경우, 패치 파일 전송 실패로 정상적인 패치가 불가능합니다.​2. 상세 내용 - LOG 서버 /dbsafer/update/server_agent 경로에 SA 또는 DBSAFER OS 패치 파일을 업로드합니다. 그림 1. Agent 업그레이드 (원격패치) - '그림 1'과 같이 패치 대상 타겟 지정 후 'Agent 업그레이드'를 진행합니다.​ 그림 2. pnp_server_manager 로그 - 패치 과정에서 pnp_server_manager 로그를 확인하면 대상서버(Windows)에 '그림 2'와 같이 ERROR 로그를 확인할 수 있습니다.​ 그림 3. 대상서버 디스크 현황 (용량 부족) - 패치 실패 확인 결과, Server Agent가 설치된 디스크 공간에 용량이 부족한 것을 확인할 수 있습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/4716
4598,[Q&A] DBSAFER OS가 설치된 서버의 OS/커널 업그레이드 시 DBSAFER OS 재설치가 필요한가요?,"[문의사항]DBSAFER OS 설치후 운영중인 서버를 Redhat 7.5 -> Redhat7.7로 OS/커널 업그레이드를 진행하려고합니다.혹시 DBSAFER OS 재설치가 필요한가요?​​​[답변]네 당연히 재설치가 필요합니다...현재 운영 중인 서버의 커널 버전에 맞게 DBSAFER OS 설치(load) 후 운영상태입니다.만약, 현재 운영상태에서 OS/커널 업그레드 작업을 하게 된다면 서버 재부팅 과정이 있습니다.이때, 재부팅 이후 기존 설치된 DBSAFER OS의 커널 모듈은 업그레이드된 커널 버전의 인식을 하지 못해 load 되지 않습니다. ​​[작업 과정 요약]1. DBSFAER OS 정지2. DBSAFER OS (ServerAgent 디렉토리, 부팅스크립트) 삭제 3. OS 버전 업그레이드 - CentOS 7.4 >> CentOS 7.74. 커널 업그레이드 - 3.10.0-693.2.2.el7.x86_64 >> 3.10.0-1062.el7.x86_645. 서버 Reboot6. DBSAFER OS 설치 - Server Agent & DBSAFER OS 7. DBSAFER OS 정상 동작 확인 - 커널모듈(pfc) 정상 load ​* 해당 작업 계획서 첨부파일에 공유했습니다. 첨부파일 커널,OS 업그레이드로 DBSAFER OS 재설치 작업 계획서.xlsx 파일 다운로드 내 컴퓨터 저장 네이버 MYBOX에 저장",댓글 없음,https://cafe.naver.com/pnpsecure2/4598
4594,[TIP][DBSAFER OS] pfc 커널 모듈이 로드되지 않는 경우 (디스크 부족),"1. 요약 ​ 보안 대상서버에 DBSAFER OS 설치 시 커널 모듈(pfc)이 로드되기 전/후 서버의 디스크를 주기적으로 체크합니다. DBSAFER OS가 설치된 경로의 디스크 공간의 여유에 따라 정상적으로 커널 모듈이 load, unload, bypass됩니다. 디스크 체크는 'policy_manager'가 수행하며 기준은 102400KB(100MB)미만인 경우입니다. * 커널 모듈이 정상적으로 로드된 경우만 DBSAFER OS가 동작합니다.​​2. 조건2-1 커널 모듈 로드 시 필요한 디스크 공간의 크기는 100MB (Linux, AIX, HP, SunOS 동일)2-2 디스크 공간은 커널 모듈 최초 로드, 로드 이후 운영 중에도 체크​조건을 상세히 설명드리면 커널 모듈(PFC)의 메모리 체크 방식과 다르게 디스크 체크는 커널 모듈이 로드된 후에도 진행됩니다.즉, DBSAFER OS가 구동 중인 경우, 설치된 디스크 공간이 부족(100MB이하)하면 커널 모듈의 상태가 변경(Bypass)됩니다.​[커널모듈(PFC)의 메모리 체크방식]https://cafe.naver.com/pnpsecure2/4431 cafe.naver.com cafe.naver.com ​​3. 상세 설명3-1 매니저 (관리대상 서버 모니터링) pfc_manager 장애(M) 출력​3-2 매니저(시스템 로그) 'Not enough memory space..' 출력 ​3-3 보안 대상서버 (policy_manager 로그) 'Not enough space..' 출력​3-4 보안 대상서버 pfc 상태 확인 정상적으로 커널 모듈이 'load'된 상태에서 'bypass' 전환 ​",댓글 없음,https://cafe.naver.com/pnpsecure2/4594
4431,[TIP][DBSAFER OS] pfc 커널 모듈이 로드되지 않는 경우 (메모리 부족),"1. 요약 ​ 보안 대상서버에 DBSAFER OS 설치 시 커널 모듈(pfc)이 로드되기 전 서버의 메모리를 체크합니다. 메모리의 여유에 따라 정상적으로 커널 모듈이 로드되거나 로드되지 않습니다. * 커널 모듈이 정상적으로 로드된 경우만 DBSAFER OS가 동작합니다.​​2. 조건 2-1 최초 커널 모듈 로드 시 필요한 free 메모리는 100MB (Linux, AIX, HP, SunOS 동일) 2-2 메모리는 커널 모듈 최초 로드 시에만 체크 (최초 설치 완료 후 ./start.sh 로 실행할 때 메모리 체크) 조건을 상세히 설명드리면 커널 모듈이 로드된 후의 메모리 여유에 따라 로드/언로드 동작은 없습니다.즉, DBSAFER OS가 구동 중인 경우, 메모리 체크로 인하여 커널 모듈의 상태가 변경 되는 사항은 없습니다.​추가로 OS 마다 free 메모리 계산방식은 다음과 같습니다.1) Linux : /proc/meminfo ""MemFree"" 2) AIX : vmstate3) HP, SunOS : 별도 API로 메모리 계산​​3. 상세 설명 3-1 매니저 (관리대상 서버 모니터링) pfc_hook 장애(H) 출력 3-2 매니저(시스템 로그) 'Not enough memory..' 출력 3-3 보안 대상서버 (eventlog) 'Not enough memory..' 출력 ​ 감사합니다.",좋은 정보 공유 감사합니다. DBSAFER OS 의 메모리 측정이 현재 free 영역만인데 cache 여유를 포함해야 할지 고민해야 할 것 같습니다.,https://cafe.naver.com/pnpsecure2/4431
4402,[TIP] nodesaferws.exe 의 주기적인 레지스트리 접근 동작 안내,"nodesaferws 는 화면 녹화 및 RDP 제어를 하는 nodesaferwa 의 관리 및 경로 정보 등을 레지스트리에 주기적으로 저장합니다.(기타 디스크 상태 정보 등도 포함)​해당 레지스트리의 위치는 ""HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run"" 입니다.​사이트에서 레지스트리 접근 사유 문의시 위 내용 참고하시어 답변 부탁드립니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/4402
4240,"[SA][TIP] manager > 모니터링 > ""관리 대상 서버 모니터링"" 에서 OS/호스트명 ""일부"" 안보임","[내용]SA설치후 manager > 모니터링 > 관리 대상 서버 모니터링에서 OS/호스트명이 ""일부""안 보이는 이슈가 있다SA는 정상적으로 동작하며, 모니터링에서만 1) 상태값 : 정상2) OS : - 3) 호스트명 : - 으로 나온다, 특징을 찾기 어려워 연구소에 질의 하고 증상/원인/해결방법을 공유합니다[증상]- 동일한 OS에 대해 정보(OS,호스트명)이 안보이는게 아님(예시, windows 2016의 서버 중 어떤건 보이고, 어떤건 안 보이고)(예시, windows 2012의 서버 중 어떤건 보이고, 어떤건 안 보이고) [버전](200603일자 기준으로 최신버전)1) pnp_server_manager : pnp_server_manager-V5.1.2.2 Build(989) P(2.0.0.1) - RelTBINC-CentOS7 : Linux_4.4.0_x86_64Build Date: 2019/12/11 09:17Default DB Charset : latin12) server_agent : v5.1.2.33) manager version[원인]SA쪽에서 호스트 정보등의 전송은 파일통제 기능을 사용할때 동작하도록 되어 있는 것으로 확인사유는 호스트명 등의 전송을 FAC 프로토콜에서 전송하는 것으로 확인된 사항으로일단 FAC 사용 여부와 상관없이 동작할 수 있도록 벅스에 등록됨(벅스 : https://bugs.pnpsecure.com/<wbr />view.php?id=17219)[해결]SA 관리설정 부분에서 FAC 옵션을 활성화 할 경우 정상 동작(실제 파일통제정책이 없으면 영향은 없음)적용하다가 안되는 부분있으시면 라인/전화주세요감사합니다^^",댓글 없음,https://cafe.naver.com/pnpsecure2/4240
4173,[TIP] [DBSAFER OS] Server Agent 정책과 TCP 제어 정책을 동시에 적용하는 경우 로깅 결과,"1. 요약 가. DBSAFER OS를 설치한 대상서버(1대)에 Server Agent 기능과 TCP 제어 기능 모두 사용 가능 (Linux, Windows 모두 해당) - 하지만 Server Agent 기능과 TCP 제어 정책 동시 적용 불가능 2. 결론 가. DBSAFER OS는 Server Agent 정책을 우선적으로 타고 TCP 제어 정책을 타는 구조 - 대상서버에 Server Agent 정책과 TCP 제어 정책을 모두 적용하면 Server Agent 정책만 타게되어 TCP 제어는 로깅되지 않음 (매니저에서 Server Agent 로그는 남고 TCP 제어 로그에는 로그가 남지 않음) 3. 로그 비교 분석 (Linux) 가. 'pfclog' 파일을 통해 Server Agent, TCP 제어 정책 로그 구분 - Server Agent 로그와 TCP 제어 로그는 동일하게 대상 서버의 'pfclog' 파일에 기록됨 - 로그는 'HF_ACL' 형태로 Server Agent, TCP 제어 로그 모두 동일하게 기록되지만 'SAC' 값을 통해 구분 가능 >> SAC:1 = Server Agent >> SAC:0 = TCP 제어 (DBSAFER OS)","ServerAgent 는 인터페이스에 유입된 패킷을 감지하여 차단을 하는 것 입니다.TCP제어는 시스템콜을 기반으로 차단을 합니다. TCP제어의 경우 통신이 이루어져서 프로세스에서 reaction 이 있는 시점에 감지 및 제어를 하는 것 입니다. 그러므로 그 앞단인 ServerAgent 에서 제어를 하면 TCP 제어에서는 감지 및 제어가 되지 않는 것 입니다.단, 상기 방식이므로 TCP 제어는 프로세스까지 로깅이 가능한 것 입니다.",https://cafe.naver.com/pnpsecure2/4173
4149,[TIP] ServerAgent(SA) for Window 서비스 시작이 안되는 현상,"[현상]ServerAgent for Window에서 서비스 시작시 시작이 안되는 현상: OS업그레이드 후 SA 재설치할 경우 발생.[해결 방법](SA 제거 후에도 서비스가 남아있는지 확인)1. 윈도우 > cmd > 관리자 권한 실행2. 서비스 삭제- sc delete ""NODESAFER WTS""3. 위 화면과 같이 삭제 안될시레지스트리 에서 키 HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\<서비스 이름>을 제거4. 재설치",윈도우 업데이트 이후 왜 이런 현상이 나오는지 정보가 있으면 더 좋을 것 같습니다. 그래도 본 정보 만으로도 많은 도움이 될 것 같네여. ^^,https://cafe.naver.com/pnpsecure2/4149
3881,"[TIP] [DBSAFER OS] Manager에서 파일접근통제, TCP제어 로그가 기록되지 않는 경우 (MySQL 5.7 사용)","1. 상황 가. 보안대상 서버에서 pfclog는 정상적으로 남고있음 나. [Manager] - 파일 접근 통제로그, TCP 제어 로그에 남지 않음 다. DBSAFER 서버에서 로그 조회 1) DB 접속후 dbsafer_log_[year]_[month] 조회 : access_file_[day], etc_acl[day] 테이블에 값이 없음 라. pnp_server_manager 로그 확인[10:27:58][9811] execute_mass_log_query() 906: [ERROR] mysql_query(): [errno:1290] The MySQL server is running with the --secure-file-priv option so it cannot execute this statement query=('LOAD DATA INFILE '/dev/shm/dbsafer_os_csv/.fac.csv.691002075' INTO TABLE `dbsafer_log_2020_01`.`access_file_07` FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '""' LINES TERMINATED BY '\n' (server_ip, server_port, hostname, action, e_time, server_time, policy_no, policy_name, denied, alert, loglevel, cmd_type, process, cmdline, id, login_user, path, client_ip, private_ip, application, ldap_sno, ldap_name, ldap_tel, conn_mode, u_index, process_path);')2. 원인 가. DBSAFER PKG 설치시 MySQL 5.7 DB를 별도로 설치해 DBSAFER를 구축한 경우 1) MySQL에서 LOAD DATA 및 SELECT..INTO OUFILE, LOAD_FILE() 함수를 사용할 경우, 다음과 같은 오류 발생 The MySQL server is running with the --secure-file-priv option so it cannot execute this statement : 이러한 오류는 MySQL 시스템 설정 문제로, 보안설정과 관련이 있음 : 즉, MySQL이 허용하는 경로의 위치에서만 파일을 읽고 쓸 수 있도록 지정하는 옵션 2) MySQL DB에서 쿼리 값 조회 mysql> SHOW VARIABLES LIKE""secure_file_priv""; +------------------+-----------------------+ | Variable_name | Value | +------------------+-----------------------+ | secure_file_priv | /var/lib/mysql-files/ | +------------------+-----------------------+ * 쿼리 결과값을 보면 /var/lib/mysql-files/ 위치에서 파일을 읽고 쓸수 있도록 설정되어 있음 : secure_file_priv 에 대한 해당 값이 없다면 어떠한 위치에서도 파일을 읽고 쓸수 있음 3. 조치 방법 가. DBSAFER 서버에서 my.cnf 파일 수정 : /etc/my.cnf 파일의 [mysqld] 항목에서 secure-file-priv = """" 추가 나. MySQL 서비스 재시작 : # systemctl restart mysqld 다. 변경사항 확인 mysql> SHOW VARIABLES LIKE""secure_file_priv""; +------------------+-------+ | Variable_name | Value | +------------------+-------+ | secure_file_priv | | +------------------+-------+",MySQL 5.7 PKG 부분에 추후 추가 예정입니다.bulk insert 사용 시 문제가 발생하는 상황으로 MariaDB 는 확인 결과 secure_file_priv 의 default 값이 NULL 확인되어 문제 없음을 확인하였습니다. 사이트에 MySQL 5.7이 나가는 경우 해당 설정 필히 포함될 수 있도록 부탁 드립니다.,https://cafe.naver.com/pnpsecure2/3881
3823,[TIP] [DBSAFER OS] 대상서버 비정상 rebooting 후 pfc_hook 모듈이 올라오지 않는 원인,"1. 상황 가. 보안대상 서버의 비정상적인 rebooting 발생 나. Manager - [관리대상 서버 모니터링] 상태가 'pfc_hook 장애(H)' 로 출력 다. 보안대상 서버에서 # lsmod | grep pfc 명령어로 확인결과 커널모듈 unload 상태 2. 원인 가. 보안대상 서버의 비정상적인 rebooting을 pfc 모듈에서 감지해서 모듈을 올리지 않음 (의도된 동작)3. 분석 방법 가. 보안대상 서버 rebooting 유무 확인 : # uptime 나. Manager - [시스템 로그] - '로그 분류: 기타 [SERVER AGENT WARNING] 조회 : [Event] Kernel Module Load failure: (0) detect unexpected reboot. please check your server * 위와 같은 로그를 통해 비정상적인 reboot이 있었음을 확인 다. rebooting된 날짜의 dbsafer_policy_manager 로그 확인 * 예시 : [22:37:26][3810] [INFO] Kernel Module Load : (0) detect unexpected reboot. please check your server * 예시: [22:37:26][3810] manage_addon_modules() 721: [WARNING] Kernel Module Load failure: (0) detect unexpected reboot. please check your server * 비정상 종료 탐지 됐다고 알리고 경고 메시지 출력 라. 보안 대상서버 crash 파일 생성 유무 확인 4. 비정상적인 rebooting 탐지 조건 가. pfc 모듈이 부팅스크립트에 등록된 경우 나. pfc 모듈이 구동될때 탐지 : ""/var/crash"" 디렉토리 아래에 crash 파일이 생성된 시간 기준으로 30분 이내 구동 시에 예상치 못한 리부팅 발생으로 감지 하고 경고 메시지 출력5. 관련 내용 벅스 [BT:13941] 커널 모듈 2차 장애 회피 기능(무한 리부팅 위험 제거) https://bugs.pnpsecure.com/view.php?id=139416. 조치 방법 가. crash 파일이 생성된 경우 연구소 전달 : 비정상적인 rebooting이 pfc에의해 발생한 것인지 분석 필요 나. 보안대상 서버에서 Server Agent 정지 후 재시작 : Server Agent가 커널 모듈을 올려주는 구조",댓글 없음,https://cafe.naver.com/pnpsecure2/3823
3681,SA 설치 경로 검색 팁,"SA 설치 경로 검색하는 방법을 작성합니다.1. find 명령어# find / -name dbsafer_policy_manager/home/pnpsecure/server_agent/dbsafer_policy_manager/home/pnpsecure/server_agent/log/dbsafer_policy_managerfind 명령어를 사용하면 dbsafer_policy_manager 파일이 포함된 경로를 검색할 수 있습니다.해당 명령어 사용 시 IO 부하가 발생할 수 있습니다.2. lsof 명령어# lsof -p [nodesafer_policy_manager PID]COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAMEnodesafer 2768 root cwd DIR 253,0 4096 4124737 /home/pnpsecure/server_agent_CentOS5_64bit_V5.0.6.7_20170410nodesafer 2768 root rtd DIR 253,0 4096 2 /nodesafer 2768 root txt REG 253,0 317249 4124741 /home/pnpsecure/server_agent_CentOS5_64bit_V5.0.6.7_20170410/dbsafer_policy_managernodesafer 2768 root mem REG 253,0 46800 4910588 /lib64/libpam.so.0.81.5.....lsof 명령어를 사용하면 해당 프로세스가 사용하고 있는 파일을 검색할 수 있습니다.서버에 해당 명령어가 없는 경우가 있습니다.3. 부팅스크립트 확인을 통한 검색부팅스크립트 내의 nodesafer_path 정보를 통한 검색# cat ""부팅스크립트 경로"" | grep nodesafer_path= 명령어 사용하시면 nodesafer_path=/home/pnpsecure/server_agent_AIX7.1_x64_V5.1.0.101_20190731 와 같이 부팅스크립트 내에 SA 설치경로가 포함되어 있어 이 정보를 확인하면 됩니다.부팅스크립트 등록 위치는 OS 마다 다름SunOS - /etc/rc3.d/S99nodesaferAIX - /etc/rc.d/rc2.d/S999nodesaferHP_UX - /sbin/rc3.d/S999nodesaferLINUX - /etc/rc3.d/S99nodesafer, /etc/rc5.d/S99nodesafer이상입니다.감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/3681
3659,[SA for win] Parser_level = 2(DB 접속계정/ App명 파싱) 사용 시 제약사항,"[ 제약사항 ]- Oracle 1521포트에 대해 Port redirection 발생 시 Parsel_level=2 사용 불가> 원격 접속 시 실질적인 세션이 1521 포트를 사용하지 않아 발생함> 따라서 실제 세션이 1521포트로 통신하여 이를 추적할 수 있어야 함[ 해결방법 ]- Port redirection 해제1) registry 추가- 실행 -> regedit 입력 후 실행- HKEY_Local_machine\software\<wbr />oracle 또는 HKEY_Local_machine\software\<wbr />oracle\homoe<#>으로 진입- 오른쪽 프레임에서 마우스 우클릭해서 새로만들기 -> 확장 가능한 문자열 값 선택- 값 이름 : USE_SHARED_SOCKET, 값 데이터 : TRUE로 수정- 재부팅2) 시스템 변수 추가<br />- 제어판 -> 시스템 -> 시스템 등록ㅈ정보 -> 시스템 환경설정 -> 고급 탭 -> 시스템 변수 마우스 클릭<br />- 새로 만들기 버튼 클릭 후 변수 이름에 USE_SHARED_SOCKET, 변수 값에 TRUE를 설정",댓글 없음,https://cafe.naver.com/pnpsecure2/3659
3590,[SA] 서버에이전트 설치 방법 기초 ~ 현장기록,"ServerAgent(이하 SA)를 ****공단에 구축하게 되었습니다. 투입된 엔지니어는 손영석 과장님이시구요.아쉽게도 SA교육/실습 시간이 짧아서 구축에 다소의 어려움이 있었습니다.이에 제가 설치/테스트를 도와 드리면서 스텝별로 메모했던 것을 함께 공유 드립니다.메뉴얼 등에 모두 포함되어 있지 않아서 누군가가 본 글을 읽고 좀 더 상세한 가이드 문서로 업그레이드 해 주시면 고맙겠네요.참고로 저도 SA 설치를 해 본지가 6년 넘게 지나서 첫번째 장비를 설치할 때는 패키지 정리하고, 자료 올려 놓고... 로그 서버에 공통 정책 등을 올려 놓고 기타등등 헤맸더니 3시간이 소모 되었습니다. ㅜㅜ이후 식사를 하고 나머지 14대는 이것저것 하면서 총 100분이 소요 되어 1대의 SA를 제대로 구성하는 시간은 7분 정도 소모됨을 확인했습니다. 좀 더 숙달되면 3분 정도로 당길 수도 있을 것 같습니다.또한 perl expect나 조금 더 전문적인 자동화 스크립트를 사용할 경우는 1대당 30초 이내에 설치도 가능할 것 같습니다. 수년전 이미 이러한 작업을 성공한 엔지니어가 있습니다. ^^아무튼 지금부터 구축/테스트에 대한 이야기 시작해 보겠습니다. START.SH1. 사전 준비/조치 사항1.1 2019년 9월18일 조쟁용 대리님이 손영석 과장님에게 보내 주신 SA 환경 변수 설정 및 SA에 공통 배포 방안 ~ 메일을 참조하시면 좋겠습니다. (관련 자료 이미 있는 위치를 조재용 대리님께서 공유해 주시면 더 좋겠네요)1.2 SA 설치/운영 간략 메뉴얼이라도 숙지하고, 반드시 사전에 테스트 환경에서 고객사에 설치될 패키지와 동일한 패키지를 설치/테스트 해 보시기 바랍니다. 꼭 하셔요! 본 기준은 SA설치 뿐만 아니라 모든 솔루션의 설치/운영의 기본 상식입니다. 하지만 요즘 들어서 더 지켜지지 않는 것 같아서 아쉽네요. 너무 QA나 연구소 많이 믿고 있는 것 아닌가요? 아니면 믿지 못하면서도 방관하고 있는 것은 아닌지요?1.3 고객사에 설치할 패키지는 QA의 통제를 받으셔야 합니다. 버전 꼭 확인하시고, 재차 물어 보세요.1.4 또한 특수 고객사나 신제품이 함께 들어가는 사이트의 경우는 1차로 연구소를 통해서 필요 패키지(궁합 체크) 정보를 확인하시고, 2차 QA를 통해서 사이트 및 구축 특징/상황을 설명하시어 연구소에서 가이드한 패키지 버전으로 나가도 문제가 없을지를 확인하는 것이 좋습니다. 돌다리도 두들겨 가며 건너시길 바래요.1.5 최근 ****공단의 겨경우 기존 프로젝이 가이드 버전과 연구소 가이드 버전이 상이하여 혼선이 있었음은 0.4 기준이 왜 필요한지의 반증이라고 볼 수 있겠습니다.1.6 설치할 패키지를 DBSAFER 로그 서버에 복사해 두세요. 결국 SA 패키지를 각 대상 서버에 복사하는 작업은 DBSAFER 로그 서버에서 하게 될 것입니다.1.7 DBSAFER 로그 서버 및 GW 서버에서 감시 대상 서버 쪽으로 ssh/telnet 등이 잘 붙는지 확인하시고, 만약 정상적으로 붙지 않는다면 어떤 문제가 있는지 확인하여 사전에 문제를 제거한 후에 작업을 진행하시기 바랍니다. 네트워크를 통한 서비스가 잘 붙지 않는 원인에 대해서는 기술카페에 이미 글이 있고, 추가로 손영석 과장님께서 기술 공유해 주실 것입니다.1.8 DBSAFER 구축전 방화벽 / 서버보안 /환경설정의 문제 등으로 인하여 DBSAFER LOG/GW 와 고객 서버간의 통신에 문제가 없는지 확인하여 조치하는 것에 시간이 많이 소모되기도 하니 사전에 방화벽정책과 서버보안 정책에 우리 장비들을 통한 작업이 가능하도록 해 놓으세요.1.9 기타 확보해야 할 정보 및 협조- 설치할 서버 목록과 작업 가능한한 root 계정의 PW를 확보 바랍니다. SA는 시스템 레벨에서 동작하는 기능이 있기 때문에 root 계정이 아니면 정상적으로 동작하지 않습니다.- 설치 대상 서버의 IP주소, SSH/telnet 작업 가능 포트번호, OS종류와와 상세 버전 정보 확보- 만약 root 계정에 대하여 PW가 협조되지 않을 경우는 작업해야 할 서버마다 작업시에 고객에게 부탁하여 root 접속을 하셔야 합니다. 불편하더라도 어쩔 수 없습니다.- 최초 작업만 root로 하고 나시면 부팅 스크립트에 적용되면서 이후부터는 root계정이 필요 없게 됩니다.2. 설치/운영 워밍업- 일단 서버 1대에 SA를 설치하여 동작에도 문제가 없고, 로그 서버에 감사 로그도 잘 모니터링 되는지 확인해 보세요.- 첫번째 서버에서 작업한 작업 순서를 메모장 등에 정리하시면 두번째 서버부터는 작업이 훨씬 빨라집니다..- 작업이 완료되어 안심할 수 있는 상황이 되기 전까지는 붙어 있는 작업 콘솔을 닫지 말아 주세요.- 이렇게 하는 이유는 설치/테스트 과정에서 오탐이나 잘못된 정챙 또는 크리티컬 버그로 2차 장애가 발생될 시에 긴급 대응에 쓰일 수도 있기 때문입니다.- 설치/구동까지 되었다면 대상 서버로 신구 ssh/telnet 등을 붙어서 이상 없이 접속되는지와 DBSAFER Manager UI에서도 감사 로그가 보이는지 확인하시기 바랍니다. 상황에 따라 로그 수집이 수십초 걸리기도 하는데, 적어도 5분 뒤에서 로그가 수집되지 않는다면 뭔가 잘못된 것입다. 참고로 금일 ****공단에서는 로그서버의 날짜가 하루가 빨라서 수집된 로그가 당일 보이지 않고 내일에 해당하는 DB 테이블에 기록이 되어 있었습니다. 이 밖에도 시스템이던 사람이 되었던 실수에 의한 여러 상황들이 있을 수 있으니 차근 차근 체크하여 문제 없도록 조치해야 할 것입니다. ~~ 그런데 문금주 과장님 로그서버의 날짜를 왜 하루나 빠르게 설정하셨나요? ^^ 궁금해 지네요... 본 건으로 정확이 12분 39초 날렸습니다. ^^- 여기까지가 기초 작업입니다. 3. 각 서버별 공통 확인/조치 사항3.1 설치 디렉토리 생성, 필요시 권한 조정3.2 디스크 여유 용량 확인- 디스크 여유 용량ㅇ이 100 bytes 이하일 경우는 설치하지 않고, 관리자에게 상황을 알리셔야 합니다. 무리하여 설치하지 마세요. 그리고 우리 제품 설치도 중요하지만 고객 시스템의 이상한 부분은 미리 알려서 사고가 더 커지는 것을 최소화하는 것이 좋습니다.- Disk I/O wait의 이상 유무를 확인하세요.- CPU 과부하가 70%이상이고, 그 과부하 중에서 대부분이 I/O wait인 경운우는 시스템의 디스크 과부하로 인한 2차 장애가 발생될 소소기가 매우 크기 때문에 SA의 설치를 보류하시는 것이 좋습니다.- 위와 같은 정보는 top / topas / sar 등을 통해서 확인할 수 있습니다. 3.3 Disk / CPU / Memory / Traffic 상태의 확인은 기초 중에 기초이고 반드시 하셔야 합니다.- 가급적 CPU과부하가 30%일 경우만 마음 편하게 설치하시고, 30%를 초과할 경우는 시스템의 여러 상태를 분석하여 SA를 설치하는 것이 합당한가를 결정하셔야 합니다. 즉 이미 바쁜 시스템을 더 빠쁘게 해도 될지? SA가 가장 과부하 영향을 많이 받는 트래픽은 적당한지? 종합 분석할 수 있어야 합니다.3.4 우 위 기준에서 Disk / CPU / Memory / Traffic 과부하 상태가 확실하다면 해당 서버에서의 SA설치를 과감하게 유보하시고 QA나 연구소의 가이드를 받아서 지원할 방법은 없는지 확인하는 다음 스텝을 밟으셔야 합니다.~~~설명할 것이 많은데.... 금일 ****공단에서는 노트북도 쓸수 없고 작업 PC에서 작성한 파일의 반출이 안되어 ....지금부터는 사진으로 찍은 부분을 첨부하여 설명하겠습니다. 누군가가 아래의 자료와 메뉴얼을 합쳐서 유익한 정보로 만들어 주시면 좋겠습니다.시간 관계상 제가 고객사 PC에서 작성한 메모의 사진 촬용분만 공유 드립니다.급하게 작성하였지만 SA 설치 단계와 각 단계별 주의 사항을 대부분 기술하였으니 도움이 되리라 믿고 싶네요.참고로 ## 주석 두개는 그냥 설명문이고 # 하나는 명령어 프롬프트로 생각하시면 됩니다.위와 같은 방법으로 첫번째 서버의 작업을 마쳤으며, 작업한 절차 중에서 명령어에 해당하는 부분만 메모장에 정리하여 작업 스크립트를 만드시면 됩니다.그러면 2번째 장비부터는 더 빠르게 작업이 가능하며, 해당 스크립트를 기반으로 자동화 스크립트도 쉽게 만들 수 있습니다.",해당 사이트에 Manager 로그인을 해보지 못해 시간 오류를 인지하지 못하였습니다. 이런한 설정 실수 없도록 주의하겠습니다.,https://cafe.naver.com/pnpsecure2/3590
3495,HP-UX 서버에서 스니핑 디바이스를 사용하는 프로세스 확인 방법,"양문섭 차장님 메일을 기반으로 HP-UX 서버에서 스니핑 디바이스를 사용하는 프로세스 확인 방법에 대해 작성합니다.HP-UX 는 OS 특성상 하나의 프로세스에서 스니핑 디바이스를 사용하고 있는 경우 다른 모듈에서는 스니핑이 불가합니다.스니핑 디바이스를 사용하는 프로세스를 확인하는 방법은 아래와 같습니다.1. lsof 사용- ls -al /dev/dlpi* : 스니핑 디바이스의 장치 번호 확인 (119)- lsof | grep ""119,"" : lsof 정보중 장치번호 119를 검색, ','는 장치번호로 사용되는 경우만 조회되도록 포함** (참고) HP-UX 에서 lsof 는 기본적으로 설치되지 않음2. pfiles 사용$ ps -e | awk '{print ""pfiles ""$1}' | sh - > /tmp/pfiles.log >> /tmp/pfiles.log 에 모든 pid 의 정보를 기록$ vi /tmp/pfiles.log >> /tmp/pfiles.log 를 vi 로 열어서 dlpi 를 검색- dlpi 검색 결과 /dev/dlpi 를 사용하는 프로세스는 >> pid 20070, ./nodesafer_server_<wbr />agent -i lan0 -b -l 로 확인됨추가로, 채널지원에서 스니핑 모듈 제한 설정 변경 방법과 관련된 글을 게시해 두었습니다.카페 게시글 링크 : https://cafe.naver.com/pnpsecure2/3297이상입니다.감사합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/3495
3482,SA 의 상태 체크 프로세스,"서버매니저는 SA 상태를 체크하여 관리대상 모니터링에 나타냅니다.SA 상태 체크 프로세스는 아래와 같습니다.상태 체크 시의 이상 상태 감지 프로세스서버매니저에서 기본 20초 주기로 SA 의 상태를 확인(LOG_COLL_IDLE_TIME 옵션으로 주기 설정 가능, 2~60초)최대 2회 연결 시도 후 실패한 경우 통신 장애로 판단상태정보 체크 스레드 10개policy_manager 는 다른 모듈의 상태 정보를 메모리에 가지고 있다가 서버매니저의 요청이 오면 응답서버매니저는 SA에게 응답받은 데이터를 테이블에 갱신** 상태정보에서 ""통신장애"" 와 ""서버 Timeout""구분 기준 **통신장애: 대상서버에서 할당한 대기시간(CONN_WAIT_TIME 옵션)을 초과한 후에도 통신이 되지 않는 경우ex) 방화벽이나, 서버가 종료된 경우서버 Timeout: ECONNREFUSED(111) 의 에러 메시지를 수신한 경우ex) 대상 서버에 통신 포트 TCP 21113이 bind 되어 있지 않음SA 상태 체크 소모 시간한 서버를 수집하는데 2~3초로 계산하고, 10개의 스레드 동작에서10대 2~3초, 50대 10~15초, 100대 20~30초 소모** 위 수치는 서버 상태에 따라 달리질 수 있음 **",댓글 없음,https://cafe.naver.com/pnpsecure2/3482
3413,[SA] nodesafer_server_agent 데몬 up/down 현상,"[개요]nodesafer_server_agent 데몬이 up/down 되며, 비정상 동작될 경우 체크해보아야하는 포인트에 대하여 설명합니다.알고계신 부분을 댓글로 추가해주시면 Check Point에 추가하겠습니다.[증상]nodesafer_server_agent 데몬 up/down 현상 발생[Check Point]1. SA가 설치된 보안대상서버 IP를 모두 확인합니다. - 보안대상서버IP 뿐아니라 L4에 추가로 설정된 IP가 없는지 문의필요2.1번에서 확인된 IP가 DBSAFER 서비스에 보안대상IP가 정상적으로 서비스 추가되어 있는지 확인vi /dbsafer/.conf/pnp_server_manager.shared_nic에 IP를 묶어 줍니다.(pnp_server_manager 재시작 필수)물리IP1번+가상IP1번+가상IP2번+가상3번물리IP2번+가상IP1번+가상IP2번+가상3번물리IP: 보안대상서버에 지정되어 있어 변경되지 않는 IP 1개가상IP: 보안대상서버에 지정되어 있지만 장애발생시 backup서버로 이동하는 IP=> 2번 설정이 정상적으로 되어있지 않을 경우 해당증상 발생하며 빈도수가 높음3. 보안대상서버가 2대로 이중화되어 있을 경우, 둘다 물리IP로 TCP-21113 통신이 잘되는지 체크필요=> 2대중 하나의 보안대상서버에 통신이 이루어지지 않을 경우, 통신이 정상적으로 이루어지는 서버에서 해당 증상이 일어난다 가상IP를 공유하여 설정하기 때문에 통신이되는 가상IP로 정책을 전송하기 때문에 정상적으로 통신이 이루어지는 보안대상서버에 해당증상이 일어 난다위 증상을 해결하고 싶다면 아래와 같이 설정을 변경한다.(3.0:dbsafer_, 5.0:pnp_)[dbsafer_server_manager][v5.0.0.51][양문섭][RV:유국남][BT:5356][r461]# .conf/dbsafer_server_manager.shared_nic 에 등록된 대표 IP 로 통신이 안 될 때, 2번째, 3번째 IP로 접속하는 기능을 ON/OFF 하는 옵션을 추가 - .conf/dbsafer_server_manager.conf 에 옵션 'USE_RETRY_SHARED_IP'을 추가 - default : ON (옵션 설정이 없을 경우 ON으로 동작) - USE_RETRY_SHARED_IP=OFF 로 설정 후 dbsafer_server_manager 를 재시작하면 대표 IP로 통신이 불가능할 경우 통신 재시도를 하지 않는다4.[SA설치폴더]/conf/sever_agent.conf의 INTERFACE=[NIC] 설정 확인4-1) 물리/이중화NIC를 설정하지 않았을 경우SA가 통제해야하는 물리NIC를 설정해 준다4-2) 가상NIC를 설정하였을 경우물리/이중화NIC의 경우 vnet0 , vnet1, en1, eth0, bond0 등과 같은 형태를 보이며, 가상NIC의 경우 vnet0:1, vnet1:1,bond0:1등과 같이 ':'를 사용하여 NIC가 설정되어 있다. INTERFACE=[NIC] 설정에는물리/이중화NIC만 설정하고 가상NIC는 설정하지 않는다. NIC를 여러개를 사용해야 한다면 '+'로 묶어 준다",댓글 없음,https://cafe.naver.com/pnpsecure2/3413
2827,"[SA for WIN] Intel Teaming 구성 및 RedCastle설치시 재부팅,BSOD 현상 처리 방법","최근 고객사 SA구축중 아래와 같이 이슈가 있어 내용 공유합니다. sa for windows 에서의 차단 동작 시의 Windows server 2008이상에서 reboot 및 BSOD 현상에 대한 원인처리 방법에 대해서 공유합니다. [서버 환경]Windows 2008 R1Intel 드라이브로 구성된 Teaming 구성RedCastle(서버보안솔루션) : SA 설치 하기전 꼭 RedCastle 설치 여부 확인 필요 [증상]Windows 2008의 경우 OS에서 Teaming 드라이버 미 지원 : Windows 2012이상부터 OS자체적으로 Teaming드라이버지원NIC 제조사(Intel, Broadcom)에서 별도의 Teaming 드라이버 제공- Teaming 구성된 NIC의 경우 장치 이름 표시를 할 수 없기 때문에 아래와 같이 장치이름이 빈내용으로 표시됨 : 장치이름의 Any를 선택 후 마침한 후 SA동작 시 바로 reboot, BSOD 증상이 나오거나 시간이 어느정도 지나고 나서 서버에서 reboot 또는 BSOD 발생됨 [조치방법]장치이름 : 이름 미표시 선택 후 마침 클릭 : 장치이름의 Any 미체크 : Windows 2012부터는 Teaming Name이 표시 됨 서비스 가동 : 시작 버튼 클릭하여 SA 서비스 가동 - 첨부파일 : Windows 2008에서 Teaming 구성 방법 공유합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/2827
2483,[SA for WIN] MS Teaming 드라이버 오류에 따른 BSOD 현상 처리 방법,"sa for windows 에서의 차단 동작 시의 Windows server 2012r2 reboot 현상에 대한 원인 분석 및 처리 방법에 대해서 전달합니다. [증상]· sa for windows 을 통한 차단 시에 Windows 2012r2 서버 reboot[원인사항]· Teadming 에서 reset signal 을 전달을 할 때 ""MsLbfoProvider.sys"" 에서 오류 발생o LBFO 는 ms teaming 구성을 처리하는 모듈o https://support.microsoft.com/<wbr />en-us/help/3137691/lbfo-<wbr />dynamic-teaming-mode-may-drop-<wbr />packets-in-windows-server-<wbr />2012-r2상기 정보를 근거로 예상을 할 때 sa for windows 에서 reset 을 전달을 할 때 MS Teaming 에서 정확한 전달 NIC 를 찾지 못하여 오류가 발생한다고 예상됩니다. [네트워크 구성 환경]· BrodcomNIC 를 사용 중인 서버에서 MS Teaming 으로 NIC 를 그룹화하여서 사용· MS Teadming NIC 에 IP 할당 하여 사용o Brodcom 에서 제공하는 teaming software 를 사용하지 않았음 (제주항공 Case) MS Teaming driver 정보​ [처리방법]· sa for windows 에서 Teaming 을 구성하고 있는 NIC 를 직접 지정하여 설정한다.o 하단 주소 구성을 보면 Teaming 이 아닌 Teaming 을 구성하고 있는 실제 NIC 를 지정하였다. (정확한 구성을 모를 경우 가성 혹은 Teaming 을 제오한 모든 NIC 를 설정합니다.)​ 여기서 중요한 점은 실제 Teaming 을 구성하는 NIC 정보를 확인하는 것 입니다. [Teaming NIC네트워크 정보 확인]서버 관리에서 Teaming 정보를 확인 할 수 있습니다. 하지만 해당 정보가 실제 네트워크 인터페이스의 ID 값과 매칭 되지는 않습니다. 아래를 보면 TECHN 이라는 Teaming 인터페이스에 NIC 1, NIC2 를 포함하고 있는 것을 확인 할 수 있습니다.Windows 에서는 NIC 를 사용하기 위해서는 ID 를 호출해서 사용을 합니다. 실제 NIC ID 와 NIC 명을 찾는 방법은 아래와 같습니다. · NIC ID 확인 방법""{sa for windows install path}\nodesafer.conf"" 에서 NIC INFO 를 찾습니다.· NIC NAME 찾는 방법​regedit 의 ""HKEY_LOCAL_MACHINE\SYSTEM\<wbr />CurrentControlSet\Control\<wbr />Network"" 위치에서 폴더의 명이 NIC INFO 와 같은 것을 찾습니다. 그리고 해당 디렉토리 명의 하위 디렉토리인 ""Connection"" 에서 NAME 을 찾습니다. NAME 에서 NIC 1 과 같이 표시가 되어 있습니다.· 정확한 Nodewall NIC 설정 방법""Teaming NIC네트워크 정보 확인"" 과 ""NIC ID 확인 방법"" 과 ""NIC NAME 찾는 방법​"" 으로 실제 Teaming 에 구성된 NIC 를 찾았다면 정확한 Nodewall 의 감시 NIC 를 설정을 할 수 있다. ""{sa for windows install path}\conf/nodesafer.conf"" 에서 ""PACKET_FORWARD=0"" 아래 부분에 Teaming 에 지정된 NIC 의 ID 를 지정해 준다. 그리고 nodewall 의 service 를 재시작한다. 아래는 수집된 이슈 발생 시에 수집된 memory dump 를 분석 한 내용입니다. [Memory dump Analysis] ******************************<wbr />******************************<wbr />******************** <wbr /> <wbr /> ** Bugcheck Analysis <wbr /> ** <wbr /> <wbr /> *******************************<wbr />******************************<wbr />******************* DRIVER_IRQL_NOT_LESS_OR_EQUAL (d1)An attempt was made to access a pageable (or completely invalid) address at aninterrupt request level (IRQL) that is too high. This is usuallycaused by drivers using improper addresses.If kernel debugger is available get stack backtrace.Arguments:Arg1: 0000000000000006, memory referencedArg2: 0000000000000002, IRQLArg3: 0000000000000001, value 0 = read operation, 1 = write operationArg4: fffff8004c9a0d4e, address which referenced memory Debugging Details:------------------ *** ERROR: Module load completed but symbols could not be loaded for b57nd60a.sys DUMP_CLASS: 1 DUMP_QUALIFIER: 401 BUILD_VERSION_STRING: 9600.18505.amd64fre.winblue_<wbr />ltsb.160930-0600 SYSTEM_MANUFACTURER: NEC SYSTEM_PRODUCT_NAME: Express5800/R120f-1E [N8100-2245Y] SYSTEM_SKU: N8100-2245Y SYSTEM_VERSION: FR1.5 BIOS_VENDOR: American Megatrends Inc. BIOS_VERSION: 5.0.A026 BIOS_DATE: 07/26/2016 BASEBOARD_MANUFACTURER: MICRO-STAR BASEBOARD_PRODUCT: MS-S0901-V BASEBOARD_VERSION: 011 DUMP_TYPE: 1 BUGCHECK_P1: 6 BUGCHECK_P2: 2 BUGCHECK_P3: 1 BUGCHECK_P4: fffff8004c9a0d4e WRITE_ADDRESS: 0000000000000006 CURRENT_IRQL: 2 FAULTING_IP:MsLbfoProvider!<wbr />lbfoLBRevertMacAddress+3afffff800`4c9a0d4e 894806 mov dword ptr [rax+6],ecx CPU_COUNT: 10 CPU_MHZ: a28 CPU_VENDOR: GenuineIntel CPU_FAMILY: 6 CPU_MODEL: 3f CPU_STEPPING: 2 CPU_MICROCODE: 6,3f,2,0 (F,M,S,R) SIG: 38'00000000 (cache) 38'00000000 (init) DEFAULT_BUCKET_ID: WIN8_DRIVER_FAULT BUGCHECK_STR: AV PROCESS_NAME: java.exe ANALYSIS_SESSION_HOST: LAPUTA ANALYSIS_SESSION_TIME: 12-23-2017 12:51:46.0876 ANALYSIS_VERSION: 10.0.16299.15 amd64fre DPC_STACK_BASE: FFFFF8037A60BFB0 TRAP_FRAME: fffff8037a60aff0 -- (.trap 0xfffff8037a60aff0)NOTE: The trap frame does not contain all registers.Some register values may be zeroed or incorrect.rax=0000000000000000 rbx=0000000000000000 rcx=00000000919ddf8crdx=0000000000000001 rsi=0000000000000000 rdi=0000000000000000rip=fffff8004c9a0d4e rsp=fffff8037a60b180 rbp=0000000000000000r8=0000000000000000 r9=0000000000000002 r10=fffff8004b707020r11=fffff8004c9a87a8 r12=0000000000000000 r13=0000000000000000r14=0000000000000000 r15=0000000000000000iopl=0 nv up ei ng nz na po ncMsLbfoProvider!<wbr />lbfoLBRevertMacAddress+0x3a:fffff800`4c9a0d4e 894806 mov dword ptr [rax+6],ecx ds:00000000`00000006=????????Resetting default scope LAST_CONTROL_TRANSFER: from fffff80378b6eee9 to fffff80378b633a0 STACK_TEXT: fffff803`7a60aea8 fffff803`78b6eee9 : 00000000`0000000a 00000000`00000006 00000000`00000002 00000000`00000001 : nt!KeBugCheckExfffff803`7a60aeb0 fffff803`78b6d73a : 00000000`00000001 ffffe001`186f0190 ffffe001`1394f600 00000000`00000000 : nt!KiBugCheckDispatch+0x69fffff803`7a60aff0 fffff800`4c9a0d4e : fffff803`7a60b1f0 00000000`00000000 00000000`00000001 ffffe001`137fe4c0 : nt!KiPageFault+0x23afffff803`7a60b180 fffff800`4c9a5043 : ffffe001`186f0030 00000000`00000000 00000000`00000000 00000000`ffffffff : MsLbfoProvider!<wbr />lbfoLBRevertMacAddress+0x3afffff803`7a60b1c0 fffff800`4c9a8867 : 0000e4f6`919ddf8c ffffe001`12ebb2c0 00000000`00000000 ffffe001`137fe4c0 : MsLbfoProvider!<wbr />lbfoDSendComplete+0x57fffff803`7a60b1f0 fffff800`4b6e2ebe : 00000000`00000002 00000000`00000000 00000000`00000003 ffffe001`15dce010 : MsLbfoProvider!<wbr />LbfoSendNetBufferListsComplete<wbr />+0xbffffff803`7a60b260 fffff800`4cbbd046 : ffffe001`13aef1a0 ffffe001`186f0030 ffffe001`186f0030 ffffe001`16b00000 : NDIS!<wbr />NdisMSendNetBufferListsComplet<wbr />e+0x4defffff803`7a60b3d0 fffff800`4b6e3660 : ffffe001`1574f000 ffff0000`00000001 ffffc6ad`7f07b002 ffffe001`186f0030 : NdisImPlatform!<wbr />implatSendNetBufferListsComple<wbr />te+0x18afffff803`7a60b450 fffff800`4b6f8a90 : ffffe001`1357f1a0 ffffe001`186f0030 00000000`00000003 00000000`00000001 : NDIS!<wbr />ndisMSendCompleteNetBufferList<wbr />sInternal+0x140fffff803`7a60b520 fffff800`4c8cfa47 : ffffe001`1357f1a0 ffffe001`186f0030 00000000`00000000 00000004`00000000 : NDIS!<wbr />NdisMSendNetBufferListsComplet<wbr />e+0x160b0fffff803`7a60b690 fffff800`4c8d0751 : ffffe001`146c9000 ffffe001`00000000 ffffe001`00000012 ffffe001`00000062 : b57nd60a+0x46a47fffff803`7a60b770 fffff800`4c89552d : 00000000`00000000 ffffe001`146c9001 ffffe001`146c9000 fffff803`00000000 : b57nd60a+0x47751fffff803`7a60ba20 fffff800`4c88c1ac : ffffe001`146c9000 00000000`00000000 00000000`00000000 00000000`00000001 : b57nd60a+0xc52dfffff803`7a60ba60 fffff800`4c88cb46 : fffff803`7a60bb38 ffffe001`146c9000 fffff803`7a60bb79 00000000`00000000 : b57nd60a+0x31acfffff803`7a60bab0 fffff800`4b6dee02 : ffffe001`1357f1a0 fffff803`7a60bb79 00000000`00000000 fffff803`78d12180 : b57nd60a+0x3b46fffff803`7a60bb00 fffff803`78a51c60 : 00000000`00000000 fffff803`78d12180 00000000`00000001 fffff803`791a758f : NDIS!ndisInterruptDpc+0x1a3fffff803`7a60bbe0 fffff803`78a50fa7 : 00000000`00000000 ffffe001`19085080 fffff803`78d12180 fffff803`00000002 : nt!KiExecuteAllDpcs+0x1b0fffff803`7a60bd30 fffff803`78b664d5 : 00000000`00000000 fffff803`78d12180 ffffd001`e879edc0 00000000`00e05b22 : nt!KiRetireDpcList+0xd7fffff803`7a60bfb0 fffff803`78b662d9 : 00000006`b09bac10 fffff803`78d12180 ffffd001`ee3bab80 00000000`00000000 : nt!KxRetireDpcList+0x5ffffd001`ee3baac0 fffff803`78b68545 : 00000000`0bcd0000 fffff803`78b649b3 00000000`00000000 00000006`b09bac10 : nt!KiDispatchInterruptContinueffffd001`ee3baaf0 fffff803`78b649b3 : 00000000`00000000 00000006`b09bac10 00000000`00000001 ffffe001`19463360 : nt!KiDpcInterruptBypass+0x25ffffd001`ee3bab00 00000000`00f134ff : 00000000`00000000 00000000`00000000 00000000`00000000 00000000`00000000 : nt!KiInterruptDispatch+0x17300000000`0d07f920 00000000`00000000 : 00000000`00000000 00000000`00000000 00000000`00000000 00000000`00000000 : 0xf134ff THREAD_SHA1_HASH_MOD_FUNC: 81336a036639f536a26e869e821cdc<wbr />e28bcbf474 THREAD_SHA1_HASH_MOD_FUNC_<wbr />OFFSET: caf8748d1729e2b7273ad97e0de87b<wbr />50db7209ae THREAD_SHA1_HASH_MOD: efa1a6327b00f07441b0b1473f14e9<wbr />ae2d9d151f FOLLOWUP_IP:MsLbfoProvider!<wbr />lbfoLBRevertMacAddress+3afffff800`4c9a0d4e 894806 mov dword ptr [rax+6],ecx FAULT_INSTR_CODE: f064889 SYMBOL_STACK_INDEX: 3 SYMBOL_NAME: MsLbfoProvider!<wbr />lbfoLBRevertMacAddress+3a FOLLOWUP_NAME: MachineOwner MODULE_NAME: MsLbfoProvider IMAGE_NAME: MsLbfoProvider.sys DEBUG_FLR_IMAGE_TIMESTAMP: 5434e8c4 STACK_COMMAND: .thread ; .cxr ; kb BUCKET_ID_FUNC_OFFSET: 3a FAILURE_BUCKET_ID: AV_MsLbfoProvider!<wbr />lbfoLBRevertMacAddress BUCKET_ID: AV_MsLbfoProvider!<wbr />lbfoLBRevertMacAddress PRIMARY_PROBLEM_CLASS: AV_MsLbfoProvider!<wbr />lbfoLBRevertMacAddress TARGET_TIME: 2017-12-22T06:47:56.000Z OSBUILD: 9600 OSSERVICEPACK: 0 SERVICEPACK_NUMBER: 0 OS_REVISION: 0 SUITE_MASK: 272 PRODUCT_TYPE: 3 OSPLATFORM_TYPE: x64 OSNAME: Windows 8.1 OSEDITION: Windows 8.1 Server TerminalServer SingleUserTS OS_LOCALE: USER_LCID: 0 OSBUILD_TIMESTAMP: 2016-09-30 23:31:28 BUILDDATESTAMP_STR: 160930-0600 BUILDLAB_STR: winblue_ltsb BUILDOSVER_STR: 6.3.9600.18505.amd64fre.<wbr />winblue_ltsb.160930-0600 ANALYSIS_SESSION_ELAPSED_TIME:<wbr /> 123e ANALYSIS_SOURCE: KM FAILURE_ID_HASH_STRING: km:av_mslbfoprovider!<wbr />lbfolbrevertmacaddress FAILURE_ID_HASH: {a23e1b39-1833-7190-bbb8-<wbr />22687ccfcd45} Followup: MachineOwner[세부 플로우 설명] Windows SA에서의 티밍 이슈는 기본적으로 티밍 네트워크 드라이버의 오류로 인한 이슈로드라이버에서 티밍으로 묶인 NIC 중에 reset 패킷을 전송할 NIC의 메모리상 주소를 참조하지 못함(""DRIVER_IRQL_NOT_LESS_OR_<wbr />EQUAL (d1)"")으로써블루스크린이 발생하는 이슈입니다.예를들어 NIC1, NIC2를 TeamA으로 묶은 상태에서 실제 네트워크 목록은 물리NIC1, 물리NIC2, 가상TeamA 세가지가 나타나게 되며SA 등으로 스니핑 대상을 Any로 등록할 경우 TeamA의 드라이버가 실제 통신하는 NIC의 IRQL을 못찾아서 발생하는 이슈입니다.[ 통신이 정상적으로 될 경우] [ 티밍 오류 상황] 때문에 Teaming 상황에서 정상적으로 Sniffing 하기 위해서는 Any를 쓰지 않고 실제 사용하는 NIC를 스니핑 하도록 해야 정상 동작이 가능한 상황입니다.또한 reset 패킷의 경우 Windows SA가 차단 동작을 할때만 발생하는 것이 아닌 일반적인 TCP 통신 중에도 충분히 발생될 수 있는 것으로 네트워크 상황이나 서버의 환경 등의 여러가지 요소에 기인합니다.차단 동작을 사용하지 않는다고 해도 문제가 발생할 가능성이 있으나 다만 차단 동작을 많이 발생 시킬 경우 위 문제의 재현 확률이 많이 높아지게 될 수 있습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/2483
1949,"SA for Unix/Linux 설치 시, 일반계정으로 설치가 가능한가요?",pam 이나 syslog 사용에 제약이 있을 수 있습니다.일반계정에 who 명령어 실행권한이 없으면 pnp_shell 실행에도 문제가 있을 수 있습니다.root 권한으로 실행하시기를 권고합니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/1949
1945,"AIX 5.4 SA 설치 후 실행 시, symbol resolution failed 오류 발생합니다.",AIX 5.3 TL 04 이전 서버에 AIX 5.3 바이너리 사용 시 발생할 수 있는 오류입니다.AIX 5.2 바이너리 사용하시기 바랍니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/1945
1936,SA 에서 그룹당 제어 가능한 IP 객체의 최대 권장 개수,IP 그룹당 약 250개 권장 합니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/1936
175,Shared NIC 설정과 ServerAgent 정책 동작과 기록 여부,"Shared NIC 과 우회접속 기록 방식에 따라서 우회기록이 다르게 기록되는 사항이 있습니다. 이 부분에 대해서 서로 다르게 이해되고 있는 것 같아 정리하여 전달합니다. [우회접속 로깅 방식]SNIFF 방식pnp_server_agent 데몬에서 동작eth 에서 수신되는 패킷을 기반으로 처리함syslog 방식시스템의 로그(utmp, wtmp)를 확인하여 사용자 정보를 확인사용자 차단은 세션 PID 를 kill 하여 처리함PAM(Pluggable Authentication Module) 방식시스템에서 제공하는 인증 중 pam 을 사용하여서 처리pam 인증에 ServerAgent 인증을 추가하는 방식[Shared NIC 설정 시 차이]SNIFF 방식등록된 서비스 기준으로 우회접속 로그가 기록됨dst ip 와 port 를 확인 할 수 있으므로 구분이 가능함Syslog & PAM 방식Shared NIC 에서 설정한 대표 IP 로만 우회접속 로그가 기록됨[제약사항]SNIFF 방식과도한 트래픽 발생 시에 손실이 발생 할 수 있음Syslog & PAM 방식Terminal(telnet, ssh 등)만 제어가 가능함[설정방법]SNIFF 방식 활성화 방안ONLY_PNPSHELL = OFFPAM 활성화 방안USE_PAM = ON (OFF 일 경우 syslog 방식으로 동작됨)[관련 문제사항]Shared NIC 에서 설정한 rip 와 vip 로 등록한 서비스가 다를 경우 vip 의 우회접속 로그가 남지 않음발생원인 - 우회접속로그는 정책이 1개 이상일 때만 동작을 하는데 우회접속 정책을 ServerAgent 에 전달을 할 때 rip 서비스 관련 정책만 전달하면서 B:1433 으로의 유입 패킷을 무시해 버림수정사항 - shared nic 에서 등록한 IP 서비스에 대한 정책을 통합하여 정책 송신ex) Shared NIC = A+B / 서비스 등록 A:1522, B:1433",댓글 없음,https://cafe.naver.com/pnpsecure2/175
173,ServerAgent 의 watch 기능 및 인터페이스 확인 방법,Windows ServerAgent 의 Watcher 기능 동작watch 기능ServerAgent 가 비정상 종료가 될 경우 재시작해주는 모듈동작방식서비스의 상태에 대해서 request 를 날려서 응답 값에 대해서 처리됨응답 값은 관리자가 서비스를 종료한 것과 비정상 종료된 것이 다르게 회신되므로 비정상 종료를 판단함기타사항최초 설치 후 watcher 가 가동상태일 수 있는데 이 것은 wta 가 실행되면서 watcher 를 실행함wta 는 설치 후 설치자가 login 되어서 사용 중이므로 실행이 됨 (단. 실행 시점은 서버 마다 차이가 있음) Unix 서버의 인터페이스 확인인터페이스 확인 기능ServerAgent 가 실행이 되면서 서버의 정보를 확인하여 server_agent.conf 의 인터페이스 정보를 갱신함갱신 시점은 중아서버와의 통신이 이루어진 시점갱신 조건은 server_agent 모듈을 사용을 해야함 (olny_pnpshell = off)동작방식netstat -nr 정보를 확인하여서 인터페이스 정보를 확인함기타사항설치 시에 인터페이스 정보에 대해서 엔지니어 단에서의 갱신이 필요함설치 후 중앙서버와의 통신까지 확인한 상태에서 server_agent 모듈 동작 여부 및 server_agent.conf 갱신 정보 확인 필요,댓글 없음,https://cafe.naver.com/pnpsecure2/173
172,Windows 서버 Agent 설치 시 오류 내용 (netsh.exe / freamdyn.dll),"Windows 서버 Agent 시에 발생 가능한 사항에 대해서 공유합니다.발생내역Windows 서버 Agent 설치 후 서비스 가동 시에 ""freamdyn.dll"" 파일 관련 error 발생동일증상이벤트 뷰어 - 시스템에서 popup 으로 ""freamdyn.dll"" load 에러 발생Windows 방화벽에 Nodesafer SVC 자동 등록이 되지 않음발생원인windows Nodesafer 에서는 netsh 을 사용하여서 방화벽에 nodesafer svc 를 예외로 추가하는데 이때 사용되는 라이브러리가 ""freamdyn.dll"" 입니다.영향성Windows 에서 방화벽에 자동으로 nodesafer svc 가 등록되지 않음""freamdyn.dll"" 파일 load 오류가 세션 접속 시 마다 발생됨 (nodesaferwa 서비스도 가동 시 마다 호출을 하기 때문)기타사항""freamdyn.dll"" 파일을 수동으로 추가를 할 수 있으나 이는 system32 에 직접 추가해야 하므로 PC 보안 솔루션이 있을 경우 불가능 할 수 있음IBK 의 처리예 )IBK 에서는 상기와 같은 형상이 발생 할 경우 우선적으로 관리자에게 보고 후 수동으로 방화벽에 예외 추가함만일 PC 보안으로 방화벽 설정이 어려울 경우 상기 내요을 전파함system32 부분에 대해서 엔지니어가 직접 추가하는 것은 없도록 진행 예정관련 정보 : http://support.microsoft.com/kb/319114/ko",댓글 없음,https://cafe.naver.com/pnpsecure2/172
166,SSH 서비스 만으로 우회접속 로그 처리 기능 알림,"[개선 전]SSH 서비스만 사용하는 보안대상서버에 대해서 22, 23 포트 2개를 모두 서비스객체로 추가하여 가동.반드시 23번 포트 서비스로 등록해야 해당 기능 우회로그 처리가 되었음.[개선 후]SSH 서비스만 사용하는 보안대상서버에 대해서 22 포트를 1개 서비스만 객체로 추가하여 가동./var/pnp_shell/gw_ip.conf 파일을 보게 되면, SSH 서비스 객체 정보를 가져오는 것을 확인 할 수 있음.22번, 23번 포트 모두 서비스로 등록시, 개선 전과 동일하게 처리 됩니다.[권장 버전]dbsafer_sshd, dbsafer_telnet 버전은 릴리즈 PKG(20140922) 보다 높은 버전이므로 Trunk로 사용해야 합니다.ssh, dbsafer_server_manager 모듈은 릴리즈 버전으로 사용 할 수 있습니다.(dbsafer_PKG(20140922), server_manager_5.0.4.0_20140926 버전 이후)./dbsafer_sshd -vsshd version OpenSSH_3.0 DBSAFER_2.30.69./ssh -vOpenSSH_3.0 DBSAFER_2.30.67, SSH protocols 1.5/2.0, OpenSSL 0x0090802f./dbsafer_telnet -vfor TELNET SERVICE 3.3.210 128bit -SafetyCMD Build (3210)./dbsafer_server_manager -vdbsafer_server_manager-V5.0.3.9 Build(511) P(2.0.0.1) : Linux_2.6.18_i686",댓글 없음,https://cafe.naver.com/pnpsecure2/166
163,pnp_shell 이 가동조건 및 SA 주요 체크 사항,"간혹 pnp_shell 가동되지 않는 현상이 있습니다. 결함으로 발생할 수 있지만 환경적 요인에 대해 아래 설명합니다.pnp_shell 가동 조건은 아래와 같습니다.server_agnet 옵션에 의해 기능 ON/OF아래와 같이 설정되어 있어야 pnp_shell이 자연스럽게 가동됩니다.PNPSHELL_CHECK_APP=ONPNPSHELL_CHECK_PROFILE=ONtelnet 또는 ssh 서비스가 가동되어 있어야 한다.서비스 가동 유무는 매니저 서비스 객체에서 확인 가능 또는alias.conf:SHELLPORT=23+22 처럼 변수 등록이 되어 있어야 한다.서비스 가동이 안되어 있는 경우는 SHELLPORT=any 로 되어 있다.gw_ip.conf 에 정상적인 GWIP::PORT 가 입력되어 있다.해당 파일 경로는 /var/pnp_shell 경로이며 자동으로 생성되므로 파일 생성 및 내용 확인 하면됩니다.때때로 해당 파티션이 가득 찼을 경우, 파일이 안만들어지기 때문에 문제 생길 수 있다.[SA 장애시 주요 체크 사항]정책 배포 상태 확인. dbsafer_agent.conf, policy_listener 에서 21114 포트가 되어 있지 않으면 자동으로 정책 배포 하지 않음.프로세스 가동 상태 확인 (SM, PM, SA, RV 등)access.rules / alias.cof 파일 업데이트 확인방화벽에 의해 업데이트 안될 수 있음",댓글 없음,https://cafe.naver.com/pnpsecure2/163
162,"보안대상 서버가 다수의 IP 사용할 경우, SA shared_nic 및 Windows 설정 방법 안내","Shared_nic 설정 해야 하는 경우.보안대상 서버가 vip, 내부망, 외부망 등 2개 이상의 IP 를 사용할 경우.로그 서버의 Server_manager(이하 SM) 가 alias.conf, access.rule 배포를 위해 파일을 만들때 IP 마다 해당 파일을 생성합니다.기본적으로 SM 가 보안대상서버의 IP 몇개쓰는지 모르기 때문에 IP 별로 각각의 정책을 배포 하게 됩니다.그렇게 되면 2개 이상의 IP를 사용하는 서버에 대해서는 정책파일이 2번 전달되며, 마지막에 배포된 정책으로만 통제가 가능합니다.이를 해결하기 위해 SM 가 다수의 하나의 장비인걸로 인식시키기 위해 shared_nic 기능을 사용합니다[TIP 요약]보안대상서버가 2개 이상의 IP 를 사용한다면 shared_nic으로 묵으십시오..conf/pnp_server_manager.shared_nic 파일 수정하십시오.+ 구분자를 사용하여 IP 입력하며 1줄에 하나의 보안대상 서버를 입력하십시오.예) 192.168.1.1+192.168.1.2+172.123.123.123Windows 서버 다수의 IP 통제 할 경우.Windows 에서는 자신이 sniff 할 NIC / IP 를 반드시 선택 해야 합니다.선택되지 않은 IP는 sniff 하지 않으며 통제 되지 않습니다.[선택방법]nodesafermgr.exe 실행우측하단 설정 클릭 추가/수정으로 설정서비스 정보 (IP설정), 주소구성(NIC/IP) 에서 각각 또는 any(전체) 선택[TIP] Linux 에서는 이와 관하여 추가 설정할 필요 없습니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/162
158,"[쟁애대처] Server_agent 헬스체크 했을때, 정상이야할 서버가 ""서버 정지""","보안대상서버에 설치한 Server_agent 와 로그서버의 server_manager 모듈은 주기적으로 통신검사하여, 상태를 점검한다.그런데, 여러가지 환경 요인에 따라 ""정상""이 아닌 다른 상태로 출력될때가 있어, 그 점검 과정을 안내한다.점검 checklist 는 아래와 같다.매니저:: server_agent 관리대상 모니터링 에서 보안대상서버 상태가 비정상(통신장애, Time Out, 등) 으로 출력 확인log server :: server_manager 모듈 가동유무 확인 및 ""-H"" 옵션으로 헬스체크 검사DBSAFER서버에서 작업헬스체크 통신포트 확인# ping [IPADDR]PING 192.168.6.10 (192.168.6.10) 56(84) bytes of data.64 bytes from 192.168.6.10: icmp_seq=1 ttl=64 time=0.271 ms# nc -n -w 3 -z [IPADDR] 21113Connection to 192.168.6.10 21113 port [tcp/*] succeeded!해당 검사시 반응이 없거나, refused 등의 문구가 출력되면, DBSAFER(LOG)와 보안대상서버 간의 통신이 원활하지 않아,헬스 체크 상태가 ""Timeout"", ""통신불가"" 상태로 변경됩니다. 네트워크 사이에 통신을 방해하는 다른 요소(방화벽, IPS, 등)을 먼저 확인해야 합니다.보안대상서버에서 작업보안대상서버 , 프로세스 가동 확인 # ps -ef | grep nodepoliyc_manager, resourceview 가동 확인프로세스가 가동되지 않는 주요 원인은, SA 가 서버 자원에 접근할 수 없는경우가 대부분 입니다.UNIX/LINUX 계열은 다른OS지원하는 모듈로 실행할경우 segment_fault 가 반드시 발생하므로, OS/bit 를 잘 선택하여 설치해야 합니다.server_agent 는 옵션에 의해 선택적으로 가동되므로, server_agent 모듈이 가동되지 않을 경우 SA옵션 활성화 유무, server_agent.conf 값의 INTERFACE_NAME의 변수값이 적절한지, pcap 등 관련 rpm이 설치되지 않아 lib 미지원하는지를 확인해야 한다.server_agent.conf 확인 : bypass_mode=OFF 확인alias.conf 확인 : IP정보, bypass_mode 변수 없음 확인 (정상)debug 모드로 가동 : ./nodesafer_policy_manager -gnodesafer_policy_manager 모듈은 -g 옵션으로 작업내용을 모니터링 할 수 있습니다.주기적으로 헬스체크 및 서버 자원로그를 전송하는 것이 정상입니다.로그가 화면에 출력되지 않거나, ERR, CRTICAL 등의 메시지를 확인하여 모듈 모니터링을 하면 비정상의 동작을 추적할 수 있습니다.추가적으로 invalid_host(##.##.##.##) 으로 기록되는 메시지 확인(비정상)invalid_host 에 기록되는 IP는 server_manager 가 가동되어 있는 또다른 DBSAFER 주소입니다.Server_Agent는 다수의 Server_manager의 통제를 받지 못하므로 1:1 통신이 되도록 환경구성해야 한다.- 다수의 DBSAFER 를 사용하는 환경에서 1:1 통신 되도록 구성을 위해서는1. 정책 전송 및 상태 체크 예외지정 (시스템설정 및 서비스 객체에서 활성화)2. Server_manager 모듈을 하나의 DBSAFER 에서만 가동3. 불필요한 서비스 정지4. ALLOW_LOGSERVER_IP=[IPADDR] 옵션 배포하여 강제로 1:1 통신 구성",댓글 없음,https://cafe.naver.com/pnpsecure2/158
157,[장애대응] 서버 상태가 Timeout 일 경우,"l 가동을 하지 않았거나, 가동을 해도 서버상태가 “서버 Timeout” 으로 되어 있을 경우. 방화벽을 의심할 수 있다.l 미설치한 서버에도 방화벽이 가동되어 있다면 “미설치”가 아닌 “서버 Timeout”으로 출력된다.l 방화벽에 의해 모듈간 통신이 원할 하지 않을 때 디버그 로그 기록은 아래와 같으며, pnp_watcher stop 이후 진행되지 않는다# ./nodesafer_policy_manager -gmain() 273: option=STARTinit_program() 1217z_handler() 1172, sig=17read_rule() 857: Start, conf=read_rule() 979: fod_service[0] = 23, action = 2rule file name = conf/access.rulesdump file name = ./var/dump.pcappatch_pnp_shell_pam() 4152: from main:363patch_pnp_shell_pam() 4152: from main:364comm_thread() 565[INFO] Start accept()push_ds_data() 1894push_cmd_data() 1809push_ds_data() 1894[09:07:25][26402] [INFO] Server Agent Recovery Data has been created - First Start[09:07:25][26402] [INFO] Success to make and back up Agent Recovery Data - First Start[09:07:26][26402] [pnp_watcher] pnp_watcher STOP",댓글 없음,https://cafe.naver.com/pnpsecure2/157
156,[장애대처]Server_manager 가동시 프로세스 강제 종료,"구 버전의 경우, shared_NIC에 등록된 IP가 많으면 segment fault 발생 할 수 있다.",댓글 없음,https://cafe.naver.com/pnpsecure2/156
155,SA 삭제시 추가 삭제 내용,"/etc/rc.d/init.d 의 스크립트, /var/pnp_shell , /sbin/pnp_shell, /etc/profile 파일의 /sbin/pnp_shell 문구 삭제",댓글 없음,https://cafe.naver.com/pnpsecure2/155
154,[장애대처]SA 정책 전송이 되지 않음,1. dbsafer_agent.conf의 policy_listener 로그서버:21114 포트(server_manager)로 등록되어야 한다.2. 2114 서비스 포트가 열려 있어야 한다. # telent [대상 서버 IP] 21114,댓글 없음,https://cafe.naver.com/pnpsecure2/154
153,SA가 가동 중 ./start.sh 실행하는 경우,l 일반적인 경우 기존 프로세스가 종료되고 start.sh 스크립트에 의해 policy_manager가 새롭게 실행된다,댓글 없음,https://cafe.naver.com/pnpsecure2/153
152,"[장애대처] RDP 접속시, 접속계정이 깨져서 저장되는경우","RDP 포트가 3389가 아닌 경우, 접속계정이 깨져서 저장되며, 수동으로 3가지 설정추가한다.■ DBSAFER 서버의 config 파일 수정# cd /dbsafer/.conf# vi rdp_server.lst# vi server_manager.conf - rdp_ports 부분에 포트 추가■ 매니저::시스템설정::로그조회::RDP port",[참고]서비스 재시작 필요합니다.,https://cafe.naver.com/pnpsecure2/152
144,[장애대처] nodesafer_server_agent 모듈이 시작 후 다운,"l server_agent.conf 에 기록된 인터페이스명과, 서버의 인터페이스명이 동일한지 확인 및 수정한다.일부 서버에서는 인터페이스명(NIC명) 을 가져오지 못하는 경우가 있으며, server_agent.conf:: INTERFACE_NAME 변수의 값이 정상적으로 등록되지 않을 경우 server_agent 모듈은 비정상동작한다.",댓글 없음,https://cafe.naver.com/pnpsecure2/144
141,[장애대처] Server Agent가 Fail_open(bypass) 되는 경우,l dbsafer_server_manager 비정상 종료 or DBSAFER log 서버 down 으로 failopen_time 을 초과할 동안 Agent 에서 TCP 21113 포트로 메시지를 못 받는 경우l GW 장애가 인식되어 dbsafer_sysmon 이 var/failopen.tmp 를 생성한 경우l dbsafer_server_manager 에서 1번 서비스 포트로 connect() 시도 를 failopen_time(기본값:300초)/2 주기로 하여 실패한 경우,댓글 없음,https://cafe.naver.com/pnpsecure2/141
139,[장애대처] 과거 설치한 버전으로 파일복원,"l 파일백업하는 시점SA 실행시, 백업파일 및 설치디렉토리/var 디렉토리가 없는경우l 패치가 아닌 재설치 하는 경우 백업 백업 조건에 맞지 않기 때문에 새로 설치한 버전으로 백업하지 않는다../nodesafer_policy_manager –R 명령어를 사용하여 백업파일 수동으로 생성할 수 있다.",댓글 없음,https://cafe.naver.com/pnpsecure2/139
136,[장애대처]syslog 방식으로 FTP 제어 불가,FTP서버에 접속시 로그를 남기는 옵션이 설정되어야 한다./etc/vsftpd.conf 나 /etc/vsftpd/vsftpd.conf에 session_support=YES 설정 추가 / 확인 후/etc/init.d/vsftpd restart 로 ftpd 를 재시작,댓글 없음,https://cafe.naver.com/pnpsecure2/136
133,[장애대처]디버그 모드 가동,"l 보안대상서버의 SA 디버그 모드 가동로그파일 생성 후 모듈 재실행한다. # cd [sa 설치 경로] # touch var/packet_debug # touch var/resource_debug # touch /var/pnp_shell/pam_debug # ./nodesafer_policy_manager start l 로그 서버의 Server_manager , SA모듈 디버그 모드 가동 # ./dbsafer_server_manager -g # ./nodesafer_policy_manager -g",댓글 없음,https://cafe.naver.com/pnpsecure2/133
131,[장애대처] pnp_shell 이 가동되지 않음,"1. redcastle 업체에서 shell 커스텀하면서 pnp_shell 가동을 막는 경우가 있었으며, pnp_shell 사용하지 않도록 옵션 PNPSHELL_CHECK_APP =OFF 처리 한다.2. /sbin/pnp_shell 이 가동되지 않음./etc/profile 에 ""/sbin/pnp_shell"" 구문이 첫 줄에 위치했는지 확인.서비스객체 terminal 이 가동되었는지 확인./var/pnp_shell/gw_ip.conf 파일이 정상적으로 생성되었는지 확인. # cat /etc/profile # cat /var/pnp_shell/gw_ip.conf 192.168.6.184 :4009 1 0 IP : [PORT] [OPERATION_LVL] [CHECK_CERT_ID]",댓글 없음,https://cafe.naver.com/pnpsecure2/131
128,[장애대처]관리대상 서버 모니터링에서 서버상태가 정상으로 출력되지 않음,"1.매니저:: server_agent 관리대상모니터링 에서 보안대상서버 상태가 비정상(통신장애, Time Out, 등) 으로 출력 확인2. log server :: server_manager 모듈 가동유무 확인 및 ""-H"" 옵션으로 헬스체크 검사#/dbsafer/pnp_server_manager -H3. 보안대상서버에서 작업# ps -ef|grep node4. debug 모드로 가동 #./nodesafer_policy_manager -g 추가적으로 invalid_host(##.##.##.##) 으로 기록되는 메시지 확인(비정상) invalid_host 에 기록되는 IP는 server_manager 가 가동되어 있는 또다른 DBSAFER 주소입니다. Server_Agent는 다수의 Server_manager의 통제를 받지 못하므로 1:1 통신이 되도록 환경구성해야 한다. - 다수의 DBSAFER 를 사용하는 환경에서 1:1 통신 되도록 구성을 위해서는 1. 정책 전송 및 상태 체크 예외지정 (시스템설정 및 서비스 객체에서 활성화) 2. Server_manager 모듈을 하나의 DBSAFER 에서만 가동 3. 불필요한 서비스 정지 4. ALLOW_LOGSERVER_IP=[IPADDR] 옵션 배포하여 강제로 1:1 통신 구성",댓글 없음,https://cafe.naver.com/pnpsecure2/128
114,“/dbsafer3/var/telnet_raw”의 경로에 있는 이 파일은 무슨 역할을하나요?,telnet 세션 재현 할 때 사용하는 데이터 값입니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/114
112,dms 사용 시 select 문이 차단되는 현상이 있습니다. 정상인가요?,정책을 통한 select 권한 허용이 되는지를 먼저 확인하여야 합니다. 차단 로그를 조회 정책을 추적하여 어떤정책으로 차단이 되는지 확인하고 예외 정책으로 허용 정책을 수립하여서 처리하여야 합니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/112
111,[pnp_shell]pnp_shell 에 의한 명령어 로깅이 되지 않는 문제가 발생했습니다.,pnp_shell의 가동 상태와 옵션 값을 확인합니다. 또한 동일한 pts로 세션이 가동되어 있다면 pnp_shell이 정상적으로 로깅 작업을 수행하지 못할 수도 있습니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/111
110,[server_manager]MagicCrypto 패치 후에 pnp(dbsafer)_server_manager가 실행되지 않습니다.,"./pnp(dbsafer)_server_manager : error while loading shared librares : libssl.so.0.9.8: cannot open shared object file: No such file or directory 와 같은 에러 메세지가 발생한다면 라이브러리를 확인해보아야 합니다. ldd pnp(dbsafer)_server_manager 명령을 실행하여 참조 사항을 확인합니다. 만약 MagicCrypto 라이브러리가 not found로 확인이 된다면, 해당경로(magiccrypto/lib)의 라이브러리 파일을 확인합니다. 이 때 계정은 root로확인하여야 합니다. 패치 시에 해당 패치의 Target 버전을 꼭 확인하고 패치 하는 것을 권장 드립니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/110
99,"nodesafer_access_dd_hh, nodsafer_console_dd_hh 테이블 정보","Access 테이블은 접속/종료 로그 테이블이고, console 테이블은 사용자 명령어 및 결과값 로그 테이블입니다. 해당 테이블의 컬럼 상세 정보는 DB에 접속하여 확인 가능합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/99
86,[장애대처]Server_manager 헬스체크 결과값 안내,"1. 서버 상태 종류 상태값(매니저) : 매니저의 관리대상 서버 모니터링 메뉴에서 확인 할 수 있는 상태값상태값(콘솔) : 콘솔에서 ./dbsafer(pnp)_server_manager –H로 상태체크했을 때 확인 할 수 있는 상태값2. 서버 상태별 체크 리스트서버상태점검사항명령어Bypass옵션배포 확인[SA 설치 경로]/conf/alias.confTimeout통신불가Log 서버에서 보안대상서버로 통신검사 진행네트워크, 서버의 방화벽 정책 확인tracepath [IPADDR]ping [IPADDR]telnet [IPADDR] 21113 (telnet 패키지)nc -n -w 3 -z [IPADDR] 21113 (netcat 패키지)Server_agent 장애Resource_view 장애프로세스 가동 확인올바른 버전 설치 확인옵션활성화 확인Pcap 설치 유무 확인디버그모드 사용.ps -ef | grep node./nodesafer_policy_manager startONLY_PNPSHELL=OFF, INTERFACE_NAME=값 확인rpm -qa | grep libpcap./nodesafer_policy_manager -g","콘솔(pnp_server_manager -H) 확인시 맨앞이 # 인 경우 아래 3가지 상황일 수 있음> 관리대상모니터링에 해당 IP 확인 불가함1. 서비스가 삭제된 경우2. 해당 IP가 VIP로 shard_nic에 묶여있는 경우3. 정책전송예외(객체/그룹관리 - 서비스 - 정책전송예외 체크가 되어 있는 경우 , .conf/nodesafer_except.conf 파일에 IP가 등록되어 있는 경우)",https://cafe.naver.com/pnpsecure2/86
85,[장애대처]장애 발생시 분석을 위해 전달 항목,"▶ 보안대상서버, 자원정보 및 SA 디렉토리보안대상서버에 있는 디렉토리를 압축하여 전달한다. 주요 모듈, conf 설정이 포함이 되어야 한다. # tar cvf SITENAME_OSTYPE_#NUM.tar server_agent# uname -a# netstat -nr▶ dbsafer 서버, SM 파일Log 또는 GW 서버에서 관련된 SM 모듈, .conf/ 이하의 관련 설정파일, log 파일이 포함되어야 한다# cd /dbsafer3# tar cvfz sitename_SM.tgz dbsafer_server_manager .conf/dbsafer_server* log/dbsafer_server_manager/",댓글 없음,https://cafe.naver.com/pnpsecure2/85
84,[장애대처] 주요 사용 명령어,l 통신확인log 서버에서 보안대상 서버간의 통신 상태를 확인한다. # nc -n -w [0-9] -z [IP] 21113 ( netcat 으로 패키지 설치가 필요) # traceroute [IP] # ping [IP] # telnet [IP] [PORT] l 프로세스확인보안대상서버 (Linux)에서 프로세스 가동 상태를 확인한다. # ps -ef | grep nodesafer # lsof -p [PID] (lsof 패키지 설치 필요)l 관리대상모니터링 에서 불필요 목록 제거.mysql 접속 후 nodesafer_agent_status 테이블에서 해당 IP 레코드를 제거한다.최신 모듈 (v5.0.4.1) 에서는 정지된 서비스는 모니터링 대상에서 삭제 된다. mysql> delete from dbsafer3.nodesafer_agent_status where inet_ntoa(agent_ip)='[IPARRD]';,댓글 없음,https://cafe.naver.com/pnpsecure2/84
83,SA_GUI 개선 전후 비교,"Server_Agent 정책배포 기능은 콘솔에서 수동으로 타이핑하는 것으로 부터 시작되어현재 매니저에서 설정, 배포가 가능하게 만들어졌다.그러나, 이 기능 좀 더 개선할 필요가 있었으며, 아래과 같이 개선작업이 이루어졌다.[이슈사항]기존 기능을 이용하면서 문제는 아래와 같다.설명없이 영문옵션명으로만 이루어져 무슨기능인지 알 수 없다.선행적으로 설정해야 하는 옵션을 확인하는데 직관적이지 않다.설정조회시 불필요한 컬럼 사용, 필요한 컬럼의 누락이 있다.[해결사항]영문옵션출력되던것을 한글화하여, 이해력을 높임.선행 설정해야 하는 옵션들을 그룹으로 묶음OPERATION_LEVEL=2 사용시, CHECK_CERT_ID 사용 가능스니핑 이용한 접속통제 사용시, 패킷포워딩, 사후감사 등 기능 사용.FAILOPEN 기능 사용시, 시간 설정 가능.설정조회시 출력되는 컬럼 추가/삭제보안대상서버IP주소, OS, 호스트명, 기본설정, 추가설정Bypass 지정, 서비스 운영모드 컬럼 삭제[관련모듈]EnterpriseManager : Build-4334 이상Server_manager : V5.0.5.16 이상해당 모듈 이상버전으로 사용시에 variables 테이블에 값이 입력되며 매니저는 해당 버전 체크해서 하휘호환 함 name='sa_manager_version' && value>=V5.0.5.16;[스크린샷]시스템설정 - 개선 전시스템설정 - 개선 후server_Agent 관리설정 - 개선 전Server_Agent 관리설정 - 개선 후",댓글 없음,https://cafe.naver.com/pnpsecure2/83
66,SA에서 어플리케이션명으로 통제할 수 있나요?,Oracle DBMS 에 대해서만 접속계정 및 어플리케이션을 로깅 및 통제 할 수 있습니다.- PARSER_LEVEL=[0|1|2]- 지원 버전SA for Unix/Linux V 5.0.4.x 이상SA for Windows V 1.2.6.x 이상,댓글 없음,https://cafe.naver.com/pnpsecure2/66
65,SA가 Redhat7을 지원하나요?,SA는 Red Hat Linux Server 7.x x86_64을 지원합니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/65
64,PC에 설치한 SA가 bypass상태로 바뀌어서 정책배포가 되지 않습니다.,전체적인 서버 상태 점검 및 설정 값 확인이 필요합니다.- ./pnp_server_manager -H 로 서버 상태 확인- .conf/nodesafer_common.conf에서 내부 값 확인- server Agent 관리설정에서 배포 설정 확인- 관리 대상 서버 모니터링에서 해당 서버 시작,댓글 없음,https://cafe.naver.com/pnpsecure2/64
63,SA 설치 서버에서 pnp_shell 이 새션 접속 시에 가동이 되지 않습니다.,1. Pnp_shell 을 동작 시키기 위한 설정을 확인합니다.- gw_ip.conf : gw ip:port 기록- alias.conf : SHELLPORT = any (any인 경우는 서비스 미가동 상태)- /etc/profile : 상단 pnp_shell 호출 구문 확인2. pnp_sheel 이 정상적으로 동작하는지 수동으로 검사를 합니다.- /sbin/pnp_shel 실행 : 명령어로 수동 가동 시 실행 여부 확인3. Server manager 와 정상적인 정책 동작 확인을 합니다.- “관리 대상 서버 모니터링” 에서 해당 서버와의 정상 여부 확인,댓글 없음,https://cafe.naver.com/pnpsecure2/63
62,SA를 사용 중인 서버에 우회 접속 시 명령어 통제가 가능한가요?,UNIX/Linux 에 한하여서 pnp_shell 을 사용 중일 경우에는 우회접속에 대한 명령어 통제이 가능합니다,댓글 없음,https://cafe.naver.com/pnpsecure2/62
61,관리대상서버 모니터링에서 필요 없는 서버를 제외하고 싶은데 어떻게 하나요?,"DBSAFER 매니저 내의 서비스 객체에서 ""정책 배포 제외"" 기능을 체크하시면 관리대상서버 모니터링에서 제외됩니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/61
60,"관리대상 서버 모니터링의 ""서버 상태""가 정확하게 어떤 것을 의미하나요?","“통신장애”는 policy_manager가 정지됨을 의미하고, “서버 Timeout”은 서버가 다운 상태에 있음을 의미합니다.",댓글 없음,https://cafe.naver.com/pnpsecure2/60
54,SA를 삭제할 때 어떤 추가작업이 필요한가요?,"SA 와 연관된 부가적인 설정 파일에 대한 삭제가 필요합니다.- /etc/rc.d/init.d 내의 부팅 스트립트 삭제- /var/pnp_shell 삭제- /sbin/pnp_shell 삭제- /etc/profile 파일 내의 ""/sbin/pnp_shell"" 문구 삭제",댓글 없음,https://cafe.naver.com/pnpsecure2/54
53,SA를 사용 중인데 정책 전송이 계속 실패합니다.,pnp(dbsafer)_agent.conf의 policy_listener에서 ipaddr(GW_IP:21114)가 등록되어 있거나 잘못 등록되어 있지 않은지 확인해보아야 합니다. 만약 잘못되어 있거나 등록되어 있지 않다면 해당 사항 수정 후 pnp(dbsafer)_agent를 재시작 해주시기 바랍니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/53
52,SA가 가동 중인 상태에서 ./start.sh 스크립트 실행했을 때 SA 가 재실행되나요?,기존 프로세스가 종료되고 새롭게 실행이 됩니다. 하지만 만약 재시작을 목적으로 한다면 ./stopall.sh 로 모든 프로세스의 종료를 정확하게 확인 후에 ./start.sh 로 처리 하는 것을 권장합니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/52
51,server_manager와 SA가 서로 통신을 하지 못 할 경우 어떤 것들을 확인해야 하나요?,중간의 방화벽에 의한 차단을 먼저 확인을 하여야 합니다. SA 와 port 21113 통신을 하는 것을 tcpdump 로 확인하여 통신이 정상적인지 확인하여야 합니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/51
49,[HP_UX] 장비가 서버정지 상태로 변경되어 정상으로 돌아오지 않습니다.,"첫 번째로 서버 상태를 확인하고 해당 서버의 프로세스 가동(ps -ef | grep node : poliyc_manager, resourceview)을 확인합니다. 또한 server_agent.conf의 bypass_mode가 OFF임을 확인하고, alias.conf의 IP정보와 bypass_mode 변수가 없음을 확인합니다. 그 다음으로 “./nodesafer_policy_manager -g”를 사용해 debug모드로 가동합니다",댓글 없음,https://cafe.naver.com/pnpsecure2/49
48,Windows 서버에서 고급으로 1개의 인터페이스에 2개 이상의 IP를 할당 하였을 때 어떻게 대응해야 하나요?,보안서버에서 shaernic 설정으로 해당 서버의 이중화 IP 를 설정을 하여서 처리하여야 합니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/48
47,매니저에서 우회접속로그가 조회되지 않습니다.,SA 를 통한 우회접속로그가 기록되지 않고 있을 경우가 있습니다. Server manager 모듈의 오류 로그를 분석 처리하여야 합니다. 만약 DB insert 오류가 있다면 해당 문제에 대한 분석 및 처리를 하여야 정상적으로 로그가 기록 및 조회가 될 것 입니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/47
46,매니저에서 Server Agent 관리 설정 시 입력된 값이 저장되는 테이블이 어딘가요?,“agent_sync_level” 테이블에 해당 값을 저장하고 있습니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/46
45,policy_manager 실행 시 “포트가 이미 사용 중”이라는 메시지가 출력됩니다.,Port 21113 을 사용하는 프로세스를 확인하여야 합니다. 21113 을 다른 프로세스가 사용 중일 경우 binding port 의 중복 문제가 발생이 됩니다. “Netstat –anp” 정보로 port 21113 을 확인 후에 종료 후 재시작을 하여야 합니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/45
44,Windows 2012 원격 로깅 설치 시 오류가 발생합니다.,Winpcap 버전 문제로 추정되며 설치가 안 되는 문제는 RDP Port 가 well-known 3389가 아닌 3390이라서 문제가 발생합니다. 설치 가능한 Winpcap 버전으로 설치 및 Port 정보 수정이 필요합니다. rdp_server_lst와 wta_server_manager.conf의 설정을 수정하시기 바랍니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/44
43,헬스체크는 어떻게 해야 하나요?,매니저의 관리 대상 서버 모니터링 메뉴에서 확인이 가능합니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/43
32,[IAIX] AIX서버에서 nodesafer_server_agent 모듈이 시작 후 다운되는 현상이 발생합니다.,인터페이스 문제로 추정됩니다. “server_agent.conf” 내 인터페이스 항목을 수정하시기 바랍니다. 또 다른 원인으로는 shell의 보안상의 이유로 인한 커스터마이징으로써 이 경우에는 pnp_shell이 해당 shell 위에서 동작하지 않습니다. 이로 인해 policy_manager 모듈의 hang이 걸리며 nondesafer_server_agent가 다운됩니다. 이 경우는 “nodesafer_common.conf” 수정을 통해 pnp_shell을 사용하지 않는 모드로 등록 조치 해주어야 합니다.,댓글 없음,https://cafe.naver.com/pnpsecure2/32
